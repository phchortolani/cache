<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="Cache" ts="2001-01-01 00:00:00">
<Class name="VAR.CSP.VARContrAtendTransfusional">
<ClassType/>
<IncludeCode>MEDConst,VARConst</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	do ^WWWVAR
	;	
	set method = $get(%request.Data("method",1))
	xecute "do .."_method_"()"
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetProntuario">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set listRetorno = {}
	
	set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
	set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	if (objProntuario '= "") {
		set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)
		set criadoEm				= $$$VARProntuarioEletronicoCriadoEm(objProntuario)
		set numAdmissao			= $$$VARProntuarioEletronicoNumeroAdmisao(objProntuario)
		;
		;
		set objMEDAdmission	= $get(^MEDAdmission(YM, numAdmissao, 1))
		;
		If ($$$MEDAdmissionPatient(objMEDAdmission) '= codPaciente) {
			set codPaciente		= $$$MEDAdmissionPatient(objMEDAdmission)
		}
		;
		Set numProntuario 	= $$SQLGetPatientProntuario^VARSQL(codPaciente)
		;
		Set objMEDPatient = $Get(^MEDPatient(0, codPaciente, 1))
		;
		set nomePaciente		= $$SQLGetPatientName^VARSQL(codPaciente)
		set dataNascimento	= $$SQLGetPatientDataNascimento^VARSQL(codPaciente)
		set qtdeAnos				= $$SQLGetPatientAge^VARSQL(dataNascimento)
		set qtdeMeses				= $$SQLGetPatientMonth^VARSQL(dataNascimento)
		set sexo						= $$SQLGetSexoPaciente^VARSQL(codPaciente)
		;
		set objMEDAdmission	= $get(^MEDAdmission(YM, numAdmissao, 1))
		set codSala					= $$$MEDAdmissionRoom(objMEDAdmission)			
		set codLeito				= $$$MEDAdmissionBed(objMEDAdmission)
		;
		set (descSala, dataSourceLeito) = ""
		if (codSala'="") {
			set objSala					= $get(^VARSalasAtendimentos(YM,codSala,1))
			set descSala 				= $$$VARSalasAtendimentosNome(objSala)
		}
		;
		set dataSourceLeito = ##Class(VAR.CSP.VARContrAtendQuimioterapico).GetLeitos(codSala, codLeito)
		;
		set objPEPTrans 				= $get(^VARPEPTransfuncional(YM, pCodProntuario, 1))
		set dM 									= $$$VARPEPTransfuncionalDM(objPEPTrans)
		set diagnostico 				= $$$VARPEPTransfuncionalDiagnostico(objPEPTrans)
		set arrayDiagnostico = []
		for i=1:1:$length(diagnostico,";") {
			if ($piece(diagnostico,";",i)="") continue
			do arrayDiagnostico.%Push($piece(diagnostico,";",i))
		}
		set medico 							= $$$VARPEPTransfuncionalMedico(objPEPTrans)
		set dispensacao 				= $$$VARPEPTransfuncionalDispensacao(objPEPTrans)
		set observadoPor 				= $$$VARPEPTransfuncionalObservadoPor(objPEPTrans)
		set intercorrencia 			= $$$VARPEPTransfuncionalIntercorrencia(objPEPTrans)
		set intercorrenciaQual	= $$$VARPEPTransfuncionalIntercorrenciaQual(objPEPTrans)
		set outrasObservacoes 	= $$$VARPEPTransfuncionalOutrasObservacoes(objPEPTrans)
		set preMedicacao 				= $$$VARPEPTransfuncionalPreMedicacao(objPEPTrans)
		set medicoExterno 			= $$$VARPEPTransfuncionalMedicoExterno(objPEPTrans)
		set dataHoraAssinatura 	= $$$VARPEPTransfuncionalDataHoraAssinatura(objPEPTrans)
		set assinatura					= $$$VARPEPTransfuncionalUsuarioAssinatura(objPEPTrans)
		;
		set rTTransfusoesAnteriores = $$$VARPEPTransfuncionalRTTransfusoesAnteriores(objPEPTrans)
		set rTTempoAproximado = $$$VARPEPTransfuncionalRTTempoAproximado(objPEPTrans)
		set rTReacaoTransfusionaisA = $$$VARPEPTransfuncionalRTReacaoTransfusionaisA(objPEPTrans)
		set rTTipoComponente = $$$VARPEPTransfuncionalRTTipoComponente(objPEPTrans)
		set rTTipoDeReacao = $$$VARPEPTransfuncionalRTTipoDeReacao(objPEPTrans)
		set rTData = $$$VARPEPTransfuncionalRTData(objPEPTrans)
		set rTHora = $$$VARPEPTransfuncionalRTHora(objPEPTrans)
		set rTComponente = $$$VARPEPTransfuncionalRTComponente(objPEPTrans)
		set rTVolume = $$$VARPEPTransfuncionalRTVolume(objPEPTrans)
		set rTDeleucotizado = $$$VARPEPTransfuncionalRTDeleucotizado(objPEPTrans)
		set rTIrradiado = $$$VARPEPTransfuncionalRTIrradiado(objPEPTrans)
		set rTLavado = $$$VARPEPTransfuncionalRTLavado(objPEPTrans)
		set rTSinSintMaisPulso = $$$VARPEPTransfuncionalRTSinSintMaisPulso(objPEPTrans)
		set rTSinSintMenosPulso = $$$VARPEPTransfuncionalRTSinSintMenosPulso(objPEPTrans)
		set rTSinSintMaisPA = $$$VARPEPTransfuncionalRTSinSintMaisPA(objPEPTrans)
		set rTSinSintMenosPA = $$$VARPEPTransfuncionalRTSinSintMenosPA(objPEPTrans)
		set rTSinSintFebre = $$$VARPEPTransfuncionalRTSinSintFebre(objPEPTrans)
		set rTSinSintCalafrios = $$$VARPEPTransfuncionalRTSinSintCalafrios(objPEPTrans)
		set rTSinSintDispneia = $$$VARPEPTransfuncionalRTSinSintDispneia(objPEPTrans)
		set rTSinSintTremor = $$$VARPEPTransfuncionalRTSinSintTremor(objPEPTrans)
		set rTSinSintVomito = $$$VARPEPTransfuncionalRTSinSintVomito(objPEPTrans)
		set rTSinSintCianose = $$$VARPEPTransfuncionalRTSinSintCianose(objPEPTrans)
		set rTSinSintDorLombar = $$$VARPEPTransfuncionalRTSinSintDorLombar(objPEPTrans)
		set rTSinSintDordeCabeca = $$$VARPEPTransfuncionalRTSinSintDordeCabeca(objPEPTrans)
		set rTSinSintDornoTorax = $$$VARPEPTransfuncionalRTSinSintDornoTorax(objPEPTrans)
		set rTSinSintUrticaria = $$$VARPEPTransfuncionalRTSinSintUrticaria(objPEPTrans)
		set rTSinSintEritema = $$$VARPEPTransfuncionalRTSinSintEritema(objPEPTrans)
		set rTSinSintPrurido = $$$VARPEPTransfuncionalRTSinSintPrurido(objPEPTrans)
		set rTSinSintSangramentos = $$$VARPEPTransfuncionalRTSinSintSangramentos(objPEPTrans)
		set rTSinSintUrinaEscura = $$$VARPEPTransfuncionalRTSinSintUrinaEscura(objPEPTrans)
		set rTSinSintMenosVolUrinario = $$$VARPEPTransfuncionalRTSinSintMenosVolUrinario(objPEPTrans)
		set rTSinSintOutros = $$$VARPEPTransfuncionalRTSinSintOutros(objPEPTrans)
		set rTSinSintOutrosDescrica = $$$VARPEPTransfuncionalRTSinSintOutrosDescrica(objPEPTrans)
		set hemotAntecedentesDiabete = $$$VARPEPTransfuncionalHemotAntecedentesDiabete(objPEPTrans)
		set hemotAntecedentesHiperte = $$$VARPEPTransfuncionalHemotAntecedentesHiperte(objPEPTrans)
		set hemotAntecedentesIRC = $$$VARPEPTransfuncionalHemotAntecedentesIRC(objPEPTrans)
		set hemotAntecedentesICC = $$$VARPEPTransfuncionalHemotAntecedentesICC(objPEPTrans)
		set hemotAntecedentesHepatic = $$$VARPEPTransfuncionalHemotAntecedentesHepatic(objPEPTrans)
		set hemotAntecedentesInsufCo = $$$VARPEPTransfuncionalHemotAntecedentesInsufCo(objPEPTrans)
		set hemotAntecedentesAVC = $$$VARPEPTransfuncionalHemotAntecedentesAVC(objPEPTrans)
		set hemotAntecedentesOutros = $$$VARPEPTransfuncionalHemotAntecedentesOutros(objPEPTrans)
		set hemotAntecedentesOutrosQ = $$$VARPEPTransfuncionalHemotAntecedentesOutrosQ(objPEPTrans)
		set hemotMedicacoes = $$$VARPEPTransfuncionalHemotMedicacoes(objPEPTrans)
		set hemotTransfusaoAnterior = $$$VARPEPTransfuncionalHemotTransfusaoAnterior(objPEPTrans)
		set hemotTransfusaoAnteriorQ = $$$VARPEPTransfuncionalHemotTransfusaoAnteriorQ(objPEPTrans)
		set hemotTransfusaoAnteriorO = $$$VARPEPTransfuncionalHemotTransfusaoAnteriorO(objPEPTrans)
		set hemotReacoesTranPre = $$$VARPEPTransfuncionalHemotReacoesTranPre(objPEPTrans)
		set hemotReacoesTranPreAle = $$$VARPEPTransfuncionalHemotReacoesTranPreAle(objPEPTrans)
		set hemotReacoesTranPreFeb = $$$VARPEPTransfuncionalHemotReacoesTranPreFeb(objPEPTrans)
		set hemotReacoesTranPreHem = $$$VARPEPTransfuncionalHemotReacoesTranPreHem(objPEPTrans)
		set hemotReacoesTranPreOut = $$$VARPEPTransfuncionalHemotReacoesTranPreOut(objPEPTrans)
		set hemotReacoesTranPreOutDes = $$$VARPEPTransfuncionalHemotReacoesTranPreOutDes(objPEPTrans)
		set hemotComponenteDeleucoti = $$$VARPEPTransfuncionalHemotComponenteDeleucoti(objPEPTrans)
		set hemotComponenteIrradiado = $$$VARPEPTransfuncionalHemotComponenteIrradiado(objPEPTrans)
		set hemotComponenteLavado = $$$VARPEPTransfuncionalHemotComponenteLavado(objPEPTrans)
		set hemotMedPreTranDife = $$$VARPEPTransfuncionalHemotMedPreTranDife(objPEPTrans)
		set hemotMedPreTranDifeDose = $$$VARPEPTransfuncionalHemotMedPreTranDifeDose(objPEPTrans)
		set hemotMedPreTranFleb = $$$VARPEPTransfuncionalHemotMedPreTranFleb(objPEPTrans)
		set hemotMedPreTranFlebDose = $$$VARPEPTransfuncionalHemotMedPreTranFlebDose(objPEPTrans)
		set hemotMedPreTranDipi = $$$VARPEPTransfuncionalHemotMedPreTranDipi(objPEPTrans)
		set hemotMedPreTranDipiDose = $$$VARPEPTransfuncionalHemotMedPreTranDipiDose(objPEPTrans)
		set hemotMedPreTranPara = $$$VARPEPTransfuncionalHemotMedPreTranPara(objPEPTrans)
		set hemotMedPreTranParaDose = $$$VARPEPTransfuncionalHemotMedPreTranParaDose(objPEPTrans)
		set hemotMedPreTranFuro = $$$VARPEPTransfuncionalHemotMedPreTranFuro(objPEPTrans)
		set hemotMedPreTranFuroDose = $$$VARPEPTransfuncionalHemotMedPreTranFuroDose(objPEPTrans)
		set hemotMedPreTranOutr = $$$VARPEPTransfuncionalHemotMedPreTranOutr(objPEPTrans)
		set hemotMedPreTranOutrDesc = $$$VARPEPTransfuncionalHemotMedPreTranOutrDesc(objPEPTrans)		
		set hemotMedPreObs = $$$VARPEPTransfuncionalHemotObs(objPEPTrans)	
		set reacoesTransfusionaisObse = $$$VARPEPTransfuncionalReacoesTransfusionaisObse(objPEPTrans)
		set hemotTCLE = $$$VARPEPTransfuncionalHemotTCLE(objPEPTrans)
		set hemotTCLEQuando = $$$VARPEPTransfuncionalHemotTCLEQuando(objPEPTrans)
		;
		set objPEPTransAnamnese = $get(^VARPEPTransfuncionalAnamnese(YM, pCodProntuario, 1))
		set cid = $$$VARPEPTransfuncionalAnamneseCID(objPEPTransAnamnese)
		set comorbidades = $$$VARPEPTransfuncionalAnamneseComorbidades(objPEPTransAnamnese)
		set comorbidadesDM = $$$VARPEPTransfuncionalAnamneseComorbidadesDM(objPEPTransAnamnese)
		set comorbidadesHAS = $$$VARPEPTransfuncionalAnamneseComorbidadesHAS(objPEPTransAnamnese)
		set comorbidadesIRC = $$$VARPEPTransfuncionalAnamneseComorbidadesIRC(objPEPTransAnamnese)
		set comorbidadesICC = $$$VARPEPTransfuncionalAnamneseComorbidadesICC(objPEPTransAnamnese)
		set comorbidadesAVC = $$$VARPEPTransfuncionalAnamneseComorbidadesAVC(objPEPTransAnamnese)
		set comorbidadesCodronariopatia = $$$VARPEPTransfuncionalAnamneseComorbidadesCondronariopa(objPEPTransAnamnese)
		set comorbidadesOutros = $$$VARPEPTransfuncionalAnamneseComorbidadesOutros(objPEPTransAnamnese)
		set alergia = $$$VARPEPTransfuncionalAnamneseAlergia(objPEPTransAnamnese)
		set alergiaAQue = $$$VARPEPTransfuncionalAnamneseAlergiaAQue(objPEPTransAnamnese)
		set infusaoVeiaPeriferica = $$$VARPEPTransfuncionalAnamneseInfusaoVeiaPeriferica(objPEPTransAnamnese)
		set infusaoPort = $$$VARPEPTransfuncionalAnamneseInfusaoPortaCath(objPEPTransAnamnese)
		set infusaoPICC = $$$VARPEPTransfuncionalAnamneseInfusaoPICC(objPEPTransAnamnese)
		set infusao = $$$VARPEPTransfuncionalAnamneseInfusaoLocalizacao(objPEPTransAnamnese)
		set fluxoCateter = $$$VARPEPTransfuncionalAnamneseFluxoCateter(objPEPTransAnamnese)
		set finalizacao = $$$VARPEPTransfuncionalAnamneseFinalizacaoCom(objPEPTransAnamnese)
		set incidente = $$$VARPEPTransfuncionalAnamneseIncidente(objPEPTransAnamnese)
		set incidenteQual = $$$VARPEPTransfuncionalAnamneseIncidenteQual(objPEPTransAnamnese)
		set riscoFlebite = $$$VARPEPTransfuncionalAnamneseRiscodeFlebite(objPEPTransAnamnese)
		set neuropsiquiatrico = $$$VARPEPTransfuncionalAnamneseNeuropsiquiatrico(objPEPTransAnamnese)
		set padraoRespiratorio = $$$VARPEPTransfuncionalAnamnesePadraoRespiratorio(objPEPTransAnamnese)
		set ritmoCardiaco = $$$VARPEPTransfuncionalAnamneseRitmoCardiaco(objPEPTransAnamnese)
		set peleMucosa = $$$VARPEPTransfuncionalAnamnesePeleeMucosa(objPEPTransAnamnese)
		set dor = $$$VARPEPTransfuncionalAnamneseDor(objPEPTransAnamnese)
		set dorDescricao = $$$VARPEPTransfuncionalAnamneseDorDescricao(objPEPTransAnamnese)
		set redeVenoso = $$$VARPEPTransfuncionalAnamneseRedeVenosoPrej(objPEPTransAnamnese)
		set redeVenosoDescricao = $$$VARPEPTransfuncionalAnamneseRedeVenosoPrejDescricao(objPEPTransAnamnese)
		set medoApreensao = $$$VARPEPTransfuncionalAnamneseMedoApreensao(objPEPTransAnamnese)
		set medoApreensaoDescricao = $$$VARPEPTransfuncionalAnamneseMedoApreensaoDescricao(objPEPTransAnamnese)
		set internacaoSocial = $$$VARPEPTransfuncionalAnamneseIntSocPejud(objPEPTransAnamnese)
		set internacaoSocialDescricao = $$$VARPEPTransfuncionalAnamneseIntSocPejudDescricao(objPEPTransAnamnese)
		set colocarEtiqueta = $$$VARPEPTransfuncionalAnamneseColocarEtiqueta(objPEPTransAnamnese)
		set conferirNome = $$$VARPEPTransfuncionalAnamneseConferirNome(objPEPTransAnamnese)
		set orientacao = $$$VARPEPTransfuncionalAnamneseOrientacoesaEnfermagem(objPEPTransAnamnese)
		;
		set medicoOrientacoesaEnferma = $$$VARPEPTransfuncionalAnamneseMedicoOrientacoesaEnferma(objPEPTransAnamnese)
		set dataHoraOrientacoesaEnfer = $$$VARPEPTransfuncionalAnamneseDataHoraOrientacoesaEnfer(objPEPTransAnamnese)
		;
		set peso = $$$VARPEPTransfuncionalAnamneseDadosPreTransfPeso(objPEPTransAnamnese)
		set hb = $$$VARPEPTransfuncionalAnamneseDadosPreTransfHb(objPEPTransAnamnese)
		set htc = $$$VARPEPTransfuncionalAnamneseDadosPreTransfHtc(objPEPTransAnamnese)
		set plaquetas = $$$VARPEPTransfuncionalAnamneseDadosPreTransfPlaquetas(objPEPTransAnamnese)
		SET transfusao = $$$VARPEPTransfuncionalAnamneseTransfusao(objPEPTransAnamnese)
		SET HTCBolsa = $$$VARPEPTransfuncionalAnamneseHTCBolsa(objPEPTransAnamnese)
		SET TipoSanguineo = $$$VARPEPTransfuncionalAnamneseTipoSanguineo(objPEPTransAnamnese)
		SET Pai = $$$VARPEPTransfuncionalAnamnesePAI(objPEPTransAnamnese)
		SET IAC = $$$VARPEPTransfuncionalAnamneseIAC(objPEPTransAnamnese)
		SET TCD = $$$VARPEPTransfuncionalAnamneseTCD(objPEPTransAnamnese)
		;
		set listRetorno.dataHora 						= $zdatetime(criadoEm,4,2)
		set listRetorno.codPaciente 				= numProntuario
		set listRetorno.paciente 						= nomePaciente
		set listRetorno.dataNascimento	 		= $zdate(dataNascimento,4,,4)
		set listRetorno.idade								= qtdeAnos
		set listRetorno.sexo								= sexo
		set listRetorno.codSala							= descSala
		set listRetorno.dSLeito							= dataSourceLeito
		set listRetorno.codLeito						= codLeito
		set listRetorno.dM									= dM
		set listRetorno.diagnostico					= arrayDiagnostico
		set listRetorno.medico							= medico
		set listRetorno.medicoExterno				= medicoExterno
		set listRetorno.dataHoraAssinatura	= $Select(dataHoraAssinatura="":"",1:$ZdateTime(dataHoraAssinatura,4,2))
		set listRetorno.assinatura					= $Select(assinatura="":"",1:$$SQLGetUserName^VARSQL(assinatura))
		//
		set listRetorno.rTTransfusoesAnteriores = rTTransfusoesAnteriores
		set listRetorno.rTTempoAproximado = rTTempoAproximado
		set listRetorno.rTReacaoTransfusionaisA = rTReacaoTransfusionaisA
		set listRetorno.rTTipoComponente = rTTipoComponente
		set listRetorno.rTTipoDeReacao = rTTipoDeReacao
		set listRetorno.rTData = $Select(rTData'="":$Zdate(rTData,3),1:"")
		set listRetorno.rTHora = rTHora
		set listRetorno.rTComponente = rTComponente
		set listRetorno.rTVolume = rTVolume
		set listRetorno.rTDeleucotizado = rTDeleucotizado
		set listRetorno.rTIrradiado = rTIrradiado
		set listRetorno.rTLavado = rTLavado
		Do listRetorno.%Set("rTSinSintMaisPulso",rTSinSintMaisPulso)
		Do listRetorno.%Set("rTSinSintMenosPulso",rTSinSintMenosPulso, "number")
		Do listRetorno.%Set("rTSinSintMaisPA",rTSinSintMaisPA)
		Do listRetorno.%Set("rTSinSintMenosPA",rTSinSintMenosPA, "number")
		Do listRetorno.%Set("rTSinSintFebre",rTSinSintFebre, "number")
		Do listRetorno.%Set("rTSinSintCalafrios",rTSinSintCalafrios, "number")
		Do listRetorno.%Set("rTSinSintDispneia",rTSinSintDispneia, "number")
		Do listRetorno.%Set("rTSinSintTremor",rTSinSintTremor, "number")
		Do listRetorno.%Set("rTSinSintVomito",rTSinSintVomito, "number")
		Do listRetorno.%Set("rTSinSintCianose",rTSinSintCianose, "number")
		Do listRetorno.%Set("rTSinSintDorLombar",rTSinSintDorLombar, "number")
		Do listRetorno.%Set("rTSinSintDordeCabeca",rTSinSintDordeCabeca, "number")
		Do listRetorno.%Set("rTSinSintDornoTorax",rTSinSintDornoTorax, "number")
		Do listRetorno.%Set("rTSinSintUrticaria",rTSinSintUrticaria, "number")
		Do listRetorno.%Set("rTSinSintEritema",rTSinSintEritema, "number")
		Do listRetorno.%Set("rTSinSintPrurido",rTSinSintPrurido, "number")
		Do listRetorno.%Set("rTSinSintSangramentos",rTSinSintSangramentos, "number")
		Do listRetorno.%Set("rTSinSintUrinaEscura",rTSinSintUrinaEscura, "number")
		Do listRetorno.%Set("rTSinSintMenosVolUrinario",rTSinSintMenosVolUrinario, "number")
		Do listRetorno.%Set("rTSinSintOutros",rTSinSintOutros, "number")
		set listRetorno.rTSinSintOutrosDescrica = rTSinSintOutrosDescrica
		Do listRetorno.%Set("hemotAntecedentesDiabete",hemotAntecedentesDiabete, "number")
		Do listRetorno.%Set("hemotAntecedentesHiperte",hemotAntecedentesHiperte, "number")
		Do listRetorno.%Set("hemotAntecedentesIRC",hemotAntecedentesIRC, "number")
		Do listRetorno.%Set("hemotAntecedentesICC",hemotAntecedentesICC, "number")
		Do listRetorno.%Set("hemotAntecedentesHepatic",hemotAntecedentesHepatic, "number")
		Do listRetorno.%Set("hemotAntecedentesInsufCo",hemotAntece]]><![CDATA[dentesInsufCo, "number")
		Do listRetorno.%Set("hemotAntecedentesAVC",hemotAntecedentesAVC, "number")
		Do listRetorno.%Set("hemotAntecedentesOutros",hemotAntecedentesOutros, "number")
		set listRetorno.hemotAntecedentesOutrosQ = hemotAntecedentesOutrosQ
		set listRetorno.hemotMedicacoes = hemotMedicacoes
		set listRetorno.hemotTransfusaoAnterior = hemotTransfusaoAnterior
		set listRetorno.hemotTransfusaoAnteriorQ = $Select(hemotTransfusaoAnteriorQ'="":$Zdate(hemotTransfusaoAnteriorQ,3),1:"")
		set listRetorno.hemotTransfusaoAnteriorO = hemotTransfusaoAnteriorO
		set listRetorno.hemotReacoesTranPre = hemotReacoesTranPre
		Do listRetorno.%Set("hemotReacoesTranPreAle",hemotReacoesTranPreAle, "number")
		Do listRetorno.%Set("hemotReacoesTranPreFeb",hemotReacoesTranPreFeb, "number")
		Do listRetorno.%Set("hemotReacoesTranPreHem",hemotReacoesTranPreHem, "number")
		Do listRetorno.%Set("hemotReacoesTranPreOut",hemotReacoesTranPreOut, "number")
		set listRetorno.hemotReacoesTranPreOutDes = hemotReacoesTranPreOutDes
		Do listRetorno.%Set("hemotComponenteDeleucoti",hemotComponenteDeleucoti, "number")
		Do listRetorno.%Set("hemotComponenteIrradiado",hemotComponenteIrradiado, "number")
		Do listRetorno.%Set("hemotComponenteLavado",hemotComponenteLavado, "number")
		Do listRetorno.%Set("hemotMedPreTranDife",hemotMedPreTranDife, "number")
		set listRetorno.hemotMedPreTranDifeDose = hemotMedPreTranDifeDose
		Do listRetorno.%Set("hemotMedPreTranFleb",hemotMedPreTranFleb, "number")
		set listRetorno.hemotMedPreTranFlebDose = hemotMedPreTranFlebDose
		Do listRetorno.%Set("hemotMedPreTranDipi",hemotMedPreTranDipi, "number")
		set listRetorno.hemotMedPreTranDipiDose = hemotMedPreTranDipiDose
		Do listRetorno.%Set("hemotMedPreTranPara",hemotMedPreTranPara, "number")
		set listRetorno.hemotMedPreTranParaDose = hemotMedPreTranParaDose
		Do listRetorno.%Set("hemotMedPreTranFuro",hemotMedPreTranFuro, "number")
		set listRetorno.hemotMedPreTranFuroDose = hemotMedPreTranFuroDose
		Do listRetorno.%Set("hemotMedPreTranOutr",hemotMedPreTranOutr, "number")
		set listRetorno.hemotMedPreTranOutrDesc = hemotMedPreTranOutrDesc
		set listRetorno.hemotObs = hemotMedPreObs
		Set listRetorno.reacoesTransfusionaisObse = reacoesTransfusionaisObse
		Set listRetorno.hemotTCLE = hemotTCLE
		Set listRetorno.hemotTCLEQuando = $S(hemotTCLEQuando'="":$ZD(hemotTCLEQuando,3),1:"")
		//
		set listRetorno.dispensacao 				= dispensacao
		set listRetorno.observadoPor 				= observadoPor
		set listRetorno.intercorrencia 			= intercorrencia
		set listRetorno.intercorrenciaQual	= intercorrenciaQual
		set listRetorno.outrasObservacoes 	= outrasObservacoes
		set listRetorno.preMedicacao				= preMedicacao
		;
		set arrayCID = []
		for i=1:1:$length(cid,";") {
			if ($piece(cid,";",i)="") continue
			do arrayCID.%Push($piece(cid,";",i))
		}
		set listRetorno.cid	= arrayCID
		;
		;set arrayComorbidades = []
		;for i=1:1:$length(comorbidades,";") {
		;	if ($piece(comorbidades,";",i)="") continue
		;	do arrayComorbidades.%Push($piece(comorbidades,";",i))
		;}
		;
		set listRetorno.comorbidades								= comorbidades ;arrayComorbidades
		do listRetorno.%Set("comorbidadesDM", comorbidadesDM, "number")
		do listRetorno.%Set("comorbidadesHAS", comorbidadesHAS, "number")
		do listRetorno.%Set("comorbidadesIRC", comorbidadesIRC, "number")
		do listRetorno.%Set("comorbidadesICC", comorbidadesICC, "number")
		do listRetorno.%Set("comorbidadesAVC", comorbidadesAVC, "number")
		do listRetorno.%Set("comorbidadesCodronariopatia", comorbidadesCodronariopatia, "number")
		set listRetorno.comorbidadesOutros 					= comorbidadesOutros
		If ($$$MEDPatientAlergia(objMEDPatient) '= "") {
			Set listRetorno.alergia			= $$$MEDPatientAlergia(objMEDPatient)
			Set listRetorno.alergiaAQue	= $$$MEDPatientAllergies(objMEDPatient)
		}Else{
			If ($$$MEDPatientAllergies(objMEDPatient) = "") Set listRetorno.alergia = 0
			Else  Set listRetorno.alergia = "1"
			Set listRetorno.alergiaAQue	= $$$MEDPatientAllergies(objMEDPatient)
		}
		;set listRetorno.alergia											= alergia
		;set listRetorno.alergiaAQue									= alergiaAQue
		do listRetorno.%Set("infusaoVeiaPeriferica", infusaoVeiaPeriferica, "number")
		do listRetorno.%Set("infusaoPort", infusaoPort, "number")
		do listRetorno.%Set("infusaoPICC", infusaoPICC, "number")
		set listRetorno.infusao											= infusao
		set listRetorno.fluxoCateter								= fluxoCateter
		set listRetorno.finalizacao									= finalizacao
		set listRetorno.incidente										= incidente
		set listRetorno.incidenteQual								= incidenteQual
		set listRetorno.riscoFlebite								= riscoFlebite
		set listRetorno.neuropsiquiatrico						= neuropsiquiatrico
		set listRetorno.padraoRespiratorio					= padraoRespiratorio
		set listRetorno.ritmoCardiaco								= ritmoCardiaco
		set listRetorno.peleMucosa									= peleMucosa
		set listRetorno.dor													= dor
		set listRetorno.dorDescricao								= dorDescricao
		set listRetorno.redeVenoso									= redeVenoso
		set listRetorno.redeVenosoDescricao					= redeVenosoDescricao
		set listRetorno.medoApreensao								= medoApreensao
		set listRetorno.medoApreensaoDescricao			= medoApreensaoDescricao
		set listRetorno.internacaoSocial						= internacaoSocial
		set listRetorno.internacaoSocialDescricao		= internacaoSocialDescricao
		do listRetorno.%Set("colocarEtiqueta", colocarEtiqueta, "number")
		do listRetorno.%Set("conferirNome", conferirNome, "number")
		set listRetorno.orientacao 									= orientacao
		;
		set listRetorno.medicoOrientacoesaEnferma = $$SQLGetUserName^VARSQL(medicoOrientacoesaEnferma)
		set listRetorno.dataHoraOrientacoesaEnfer = $Select(dataHoraOrientacoesaEnfer'="":$Zdatetime(dataHoraOrientacoesaEnfer,4,2),1:"")
		;
		set listRetorno.peso 												= peso
		set listRetorno.hb 													= hb
		set listRetorno.htc 												= htc
		set listRetorno.plaquetas 									= plaquetas
		SET listRetorno.transfusao = transfusao
		SET listRetorno.HTCBolsa = HTCBolsa
		SET listRetorno.TipoSanguineo = TipoSanguineo
		SET listRetorno.Pai = Pai
		SET listRetorno.IAC = IAC
		SET listRetorno.TCD = TCD
	}
	
	do listRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmProntuario">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	tstart
	set strStatus	=	""
	set erro			=	0
	try{

		set YBED = $get(%request.Data("YBED",1))
		set pCodProntuario = $get(%request.Data("pCodProntuario",1))
		set pAdmissao = $get(%request.Data("pAdmissao",1))
		set pDiagnostico 		= $get(%request.Data("pDiagnostico",1))
		if (pDiagnostico '= "") set pDiagnostico = $replace(pDiagnostico,",",";")

		;;
		set pRTTransfusoesAnteriores = $Get(%request.Data("pRTTransfusoesAnteriores",1))
		set pRTTempoAproximado = $Get(%request.Data("pRTTempoAproximado",1))
		set pRTReacaoTransfusionaisA = $Get(%request.Data("pRTReacaoTransfusionaisA",1))
		set pRTTipoComponente = $Get(%request.Data("pRTTipoComponente",1))
		set pRTTipoDeReacao = $Get(%request.Data("pRTTipoDeReacao",1))
		set pRTData = $Get(%request.Data("pRTData",1))
		set pRTHora = $Get(%request.Data("pRTHora",1))
		set pRTComponente = $Get(%request.Data("pRTComponente",1))
		set pRTVolume = $Get(%request.Data("pRTVolume",1))
		set pRTDeleucotizado = $Get(%request.Data("pRTDeleucotizado",1))
		set pRTIrradiado = $Get(%request.Data("pRTIrradiado",1))
		set pRTLavado = $Get(%request.Data("pRTLavado",1))
		set pRTSinSintMaisPulso = $Get(%request.Data("pRTSinSintMaisPulso",1))
		set pRTSinSintMenosPulso = $Get(%request.Data("pRTSinSintMenosPulso",1))
		set pRTSinSintMaisPA = $Get(%request.Data("pRTSinSintMaisPA",1))
		set pRTSinSintMenosPA = $Get(%request.Data("pRTSinSintMenosPA",1))
		set pRTSinSintFebre = $Get(%request.Data("pRTSinSintFebre",1))
		set pRTSinSintCalafrios = $Get(%request.Data("pRTSinSintCalafrios",1))
		set pRTSinSintDispneia = $Get(%request.Data("pRTSinSintDispneia",1))
		set pRTSinSintTremor = $Get(%request.Data("pRTSinSintTremor",1))
		set pRTSinSintVomito = $Get(%request.Data("pRTSinSintVomito",1))
		set pRTSinSintCianose = $Get(%request.Data("pRTSinSintCianose",1))
		set pRTSinSintDorLombar = $Get(%request.Data("pRTSinSintDorLombar",1))
		set pRTSinSintDordeCabeca = $Get(%request.Data("pRTSinSintDordeCabeca",1))
		set pRTSinSintDornoTorax = $Get(%request.Data("pRTSinSintDornoTorax",1))
		set pRTSinSintUrticaria = $Get(%request.Data("pRTSinSintUrticaria",1))
		set pRTSinSintEritema = $Get(%request.Data("pRTSinSintEritema",1))
		set pRTSinSintPrurido = $Get(%request.Data("pRTSinSintPrurido",1))
		set pRTSinSintSangramentos = $Get(%request.Data("pRTSinSintSangramentos",1))
		set pRTSinSintUrinaEscura = $Get(%request.Data("pRTSinSintUrinaEscura",1))
		set pRTSinSintMenosVolUrinario = $Get(%request.Data("pRTSinSintMenosVolUrinario",1))
		set pRTSinSintOutros = $Get(%request.Data("pRTSinSintOutros",1))
		set pRTSinSintOutrosDescrica = $Get(%request.Data("pRTSinSintOutrosDescrica",1))
		set pHemotAntecedentesDiabete = $Get(%request.Data("pHemotAntecedentesDiabete",1))
		set pHemotAntecedentesHiperte = $Get(%request.Data("pHemotAntecedentesHiperte",1))
		set pHemotAntecedentesIRC = $Get(%request.Data("pHemotAntecedentesIRC",1))
		set pHemotAntecedentesICC = $Get(%request.Data("pHemotAntecedentesICC",1))
		set pHemotAntecedentesHepatic = $Get(%request.Data("pHemotAntecedentesHepatic",1))
		set pHemotAntecedentesInsufCo = $Get(%request.Data("pHemotAntecedentesInsufCo",1))
		set pHemotAntecedentesAVC = $Get(%request.Data("pHemotAntecedentesAVC",1))
		set pHemotAntecedentesOutros = $Get(%request.Data("pHemotAntecedentesOutros",1))
		set pHemotAntecedentesOutrosQ = $Get(%request.Data("pHemotAntecedentesOutrosQ",1))
		set pHemotMedicacoes = $Get(%request.Data("pHemotMedicacoes",1))
		set pHemotTransfusaoAnterior = $Get(%request.Data("pHemotTransfusaoAnterior",1))
		set pHemotTransfusaoAnteriorQ = $Get(%request.Data("pHemotTransfusaoAnteriorQ",1))
		set pHemotTransfusaoAnteriorO = $Get(%request.Data("pHemotTransfusaoAnteriorO",1))
		set pHemotReacoesTranPre = $Get(%request.Data("pHemotReacoesTranPre",1))
		set pHemotReacoesTranPreAle = $Get(%request.Data("pHemotReacoesTranPreAle",1))
		set pHemotReacoesTranPreFeb = $Get(%request.Data("pHemotReacoesTranPreFeb",1))
		set pHemotReacoesTranPreHem = $Get(%request.Data("pHemotReacoesTranPreHem",1))
		set pHemotReacoesTranPreOut = $Get(%request.Data("pHemotReacoesTranPreOut",1))
		set pHemotReacoesTranPreOutDes = $Get(%request.Data("pHemotReacoesTranPreOutDes",1))
		set pHemotComponenteDeleucoti = $Get(%request.Data("pHemotComponenteDeleucoti",1))
		set pHemotComponenteIrradiado = $Get(%request.Data("pHemotComponenteIrradiado",1))
		set pHemotComponenteLavado = $Get(%request.Data("pHemotComponenteLavado",1))
		set pHemotMedPreTranDife = $Get(%request.Data("pHemotMedPreTranDife",1))
		set pHemotMedPreTranDifeDose = $Get(%request.Data("pHemotMedPreTranDifeDose",1))
		set pHemotMedPreTranFleb = $Get(%request.Data("pHemotMedPreTranFleb",1))
		set pHemotMedPreTranFlebDose = $Get(%request.Data("pHemotMedPreTranFlebDose",1))
		set pHemotMedPreTranDipi = $Get(%request.Data("pHemotMedPreTranDipi",1))
		set pHemotMedPreTranDipiDose = $Get(%request.Data("pHemotMedPreTranDipiDose",1))
		set pHemotMedPreTranPara = $Get(%request.Data("pHemotMedPreTranPara",1))
		set pHemotMedPreTranParaDose = $Get(%request.Data("pHemotMedPreTranParaDose",1))
		set pHemotMedPreTranFuro = $Get(%request.Data("pHemotMedPreTranFuro",1))
		set pHemotMedPreTranFuroDose = $Get(%request.Data("pHemotMedPreTranFuroDose",1))
		set pHemotMedPreTranOutr = $Get(%request.Data("pHemotMedPreTranOutr",1))
		set pHemotMedPreTranOutrDesc = $Get(%request.Data("pHemotMedPreTranOutrDesc",1))
		set pHemotMedPreObs = $Get(%request.Data("pHemotMedPreObs",1))
		set pReacoesTransfusionaisObse = $Get(%request.Data("pReacoesTransfusionaisObse",1))
		set pHemotTCLEQuando = $Get(%request.Data("pHemotTCLEQuando",1))
		;;
		if (pRTData '= "") set pRTData = $zdateh(pRTData,4)
		;;if (pRTSinSintMaisPulso '= "") set pRTSinSintMaisPulso = $select(pRTSinSintMaisPulso="true"||(pRTSinSintMaisPulso=1):1,1:0)
		if (pRTSinSintMenosPulso '= "") set pRTSinSintMenosPulso = $select(pRTSinSintMenosPulso="true"||(pRTSinSintMenosPulso=1):1,1:0)
		;;if (pRTSinSintMaisPA '= "") set pRTSinSintMaisPA = $select(pRTSinSintMaisPA="true"||(pRTSinSintMaisPA=1):1,1:0)
		if (pRTSinSintMenosPA '= "") set pRTSinSintMenosPA = $select(pRTSinSintMenosPA="true"||(pRTSinSintMenosPA=1):1,1:0)
		if (pRTSinSintFebre '= "") set pRTSinSintFebre = $select(pRTSinSintFebre="true"||(pRTSinSintFebre=1):1,1:0)
		if (pRTSinSintCalafrios '= "") set pRTSinSintCalafrios = $select(pRTSinSintCalafrios="true"||(pRTSinSintCalafrios=1):1,1:0)
		if (pRTSinSintDispneia '= "") set pRTSinSintDispneia = $select(pRTSinSintDispneia="true"||(pRTSinSintDispneia=1):1,1:0)
		if (pRTSinSintTremor '= "") set pRTSinSintTremor = $select(pRTSinSintTremor="true"||(pRTSinSintTremor=1):1,1:0)
		if (pRTSinSintVomito '= "") set pRTSinSintVomito = $select(pRTSinSintVomito="true"||(pRTSinSintVomito=1):1,1:0)
		if (pRTSinSintCianose '= "") set pRTSinSintCianose = $select(pRTSinSintCianose="true"||(pRTSinSintCianose=1):1,1:0)
		if (pRTSinSintDorLombar '= "") set pRTSinSintDorLombar = $select(pRTSinSintDorLombar="true"||(pRTSinSintDorLombar=1):1,1:0)
		if (pRTSinSintDordeCabeca '= "") set pRTSinSintDordeCabeca = $select(pRTSinSintDordeCabeca="true"||(pRTSinSintDordeCabeca=1):1,1:0)
		if (pRTSinSintDornoTorax '= "") set pRTSinSintDornoTorax = $select(pRTSinSintDornoTorax="true"||(pRTSinSintDornoTorax=1):1,1:0)
		if (pRTSinSintUrticaria '= "") set pRTSinSintUrticaria = $select(pRTSinSintUrticaria="true"||(pRTSinSintUrticaria=1):1,1:0)
		if (pRTSinSintEritema '= "") set pRTSinSintEritema = $select(pRTSinSintEritema="true"||(pRTSinSintEritema=1):1,1:0)
		if (pRTSinSintPrurido '= "") set pRTSinSintPrurido = $select(pRTSinSintPrurido="true"||(pRTSinSintPrurido=1):1,1:0)
		if (pRTSinSintSangramentos '= "") set pRTSinSintSangramentos = $select(pRTSinSintSangramentos="true"||(pRTSinSintSangramentos=1):1,1:0)
		if (pRTSinSintUrinaEscura '= "") set pRTSinSintUrinaEscura = $select(pRTSinSintUrinaEscura="true"||(pRTSinSintUrinaEscura):1,1:0)
		if (pRTSinSintMenosVolUrinario '= "") set pRTSinSintMenosVolUrinario = $select(pRTSinSintMenosVolUrinario="true"||(pRTSinSintMenosVolUrinario=1):1,1:0)
		if (pRTSinSintOutros '= "") set pRTSinSintOutros = $select(pRTSinSintOutros="true"||(pRTSinSintOutros=1):1,1:0)
		if (pHemotAntecedentesDiabete '= "") set pHemotAntecedentesDiabete = $select(pHemotAntecedentesDiabete="true"||(pHemotAntecedentesDiabete=1):1,1:0)
		if (pHemotAntecedentesHiperte '= "") set pHemotAntecedentesHiperte = $select(pHemotAntecedentesHiperte="true"||(pHemotAntecedentesHiperte=1):1,1:0)
		if (pHemotAntecedentesIRC '= "") set pHemotAntecedentesIRC = $select(pHemotAntecedentesIRC="true"||(pHemotAntecedentesIRC=1):1,1:0)
		if (pHemotAntecedentesICC '= "") set pHemotAntecedentesICC = $select(pHemotAntecedentesICC="true"||(pHemotAntecedentesICC=1):1,1:0)
		if (pHemotAntecedentesHepatic '= "") set pHemotAntecedentesHepatic = $select(pHemotAntecedentesHepatic="true"||(pHemotAntecedentesHepatic=1):1,1:0)
		if (pHemotAntecedentesInsufCo '= "") set pHemotAntecedentesInsufCo = $select(pHemotAntecedentesInsufCo="true"||(pHemotAntecedentesInsufCo=1):1,1:0)
		if (pHemotAntecedentesAVC '= "") set pHemotAntecedentesAVC = $select(pHemotAntecedentesAVC="true"||(pHemotAntecedentesAVC=1):1,1:0)
		if (pHemotAntecedentesOutros '= "") set pHemotAntecedentesOutros = $select(pHemotAntecedentesOutros="true"||(pHemotAntecedentesOutros=1):1,1:0)
		if (pHemotTransfusaoAnteriorQ '= "") set pHemotTransfusaoAnteriorQ = $zdateh(pHemotTransfusaoAnteriorQ,4)
		if (pHemotReacoesTranPreAle '= "") set pHemotReacoesTranPreAle = $select(pHemotReacoesTranPreAle="true"||(pHemotReacoesTranPreAle=1):1,1:0)
		if (pHemotReacoesTranPreFeb '= "") set pHemotReacoesTranPreFeb = $select(pHemotReacoesTranPreFeb="true"||(pHemotReacoesTranPreFeb=1):1,1:0)
		if (pHemotReacoesTranPreHem '= "") set pHemotReacoesTranPreHem = $select(pHemotReacoesTranPreHem="true"||(pHemotReacoesTranPreHem=1):1,1:0)
		if (pHemotReacoesTranPreOut '= "") set pHemotReacoesTranPreOut = $select(pHemotReacoesTranPreOut="true"||(pHemotReacoesTranPreOut=1):1,1:0)
		if (pHemotComponenteDeleucoti '= "") set pHemotComponenteDeleucoti = $select(pHemotComponenteDeleucoti="true"||(pHemotComponenteDeleucoti=1):1,1:0)
		if (pHemotComponenteIrradiado '= "") set pHemotComponenteIrradiado = $select(pHemotComponenteIrradiado="true"||(pHemotComponenteIrradiado=1):1,1:0)
		if (pHemotComponenteLavado '= "") set pHemotComponenteLavado = $select(pHemotComponenteLavado="true"||(pHemotComponenteLavado=1):1,1:0)
		if (pHemotMedPreTranDife '= "") set pHemotMedPreTranDife = $select(pHemotMedPreTranDife="true"||(pHemotMedPreTranDife=1):1,1:0)
		if (pHemotMedPreTranFleb '= "") set pHemotMedPreTranFleb = $select(pHemotMedPreTranFleb="true"||(pHemotMedPreTranFleb=1):1,1:0)
		if (pHemotMedPreTranDipi '= "") set pHemotMedPreTranDipi = $select(pHemotMedPreTranDipi="true"||(pHemotMedPreTranDipi=1):1,1:0)
		if (pHemotMedPreTranPara '= "") set pHemotMedPreTranPara = $select(pHemotMedPreTranPara="true"||(pHemotMedPreTranPara=1):1,1:0)
		if (pHemotMedPreTranFuro '= "") set pHemotMedPreTranFuro = $select(pHemotMedPreTranFuro="true"||(pHemotMedPreTranFuro=1):1,1:0)
		if (pHemotMedPreTranOutr '= "") set pHemotMedPreTranOutr = $select(pHemotMedPreTranOutr="true"||(pHemotMedPreTranOutr=1):1,1:0)
		if (pHemotTCLEQuando '= "") set pHemotTCLEQuando = $zdateh(pHemotTCLEQuando,4)
		;;
		set objPEPTransf = $get(^VARPEPTransfuncional(YM, pCodProntuario, 1))
		;
		set objMEDAdmission	= $get(^MEDAdmission(YM, pAdmissao, 1))
		Set codPaciente = $$$MEDAdmissionPatient(objMEDAdmission)
		if $$$MEDAdmissionDateDischarged(objMEDAdmission) 	'= ""{
			if ($get(%request.Data("pAssinar",1)) '= 1) {
				set erro = 1
				set strStatus = "Passagem já finalizada!"
				quit
			}
		}
		;
		set $$$VARPEPTransfuncionalDM(objPEPTransf) 								= $get(%request.Data("pDM",1))
		set $$$VARPEPTransfuncionalDiagnostico(objPEPTransf) 				= pDiagnostico
		set $$$VARPEPTransfuncionalMedico(objPEPTransf) 						= $get(%request.Data("pMedico",1))
		set $$$VARPEPTransfuncionalDispensacao(objPEPTransf)				= $get(%request.Data("pDispensacao",1))
		set $$$VARPEPTransfuncionalObservadoPor(objPEPTransf)				= $get(%request.Data("pObservadoPor",1))
		set $$$VARPEPTransfuncionalIntercorrencia(objPEPTransf)			= $get(%request.Data("pIntercorrencia",1))
		set $$$VARPEPTransfuncionalIntercorrenciaQual(objPEPTransf)	= $get(%request.Data("pIntercorrenciaQual",1))
		set $$$VARPEPTransfuncionalOutrasObservacoes(objPEPTransf)	= $get(%request.Data("pOutrasObservacoes",1))
		set $$$VARPEPTransfuncionalPreMedicacao(objPEPTransf)				= $get(%request.Data("pPreMedicacao",1))
		set $$$VARPEPTransfuncionalMedicoExterno(objPEPTransf) 			= $get(%request.Data("pMedicoExterno",1))
		if ($get(%request.Data("pAssinar",1)) = 1) {
			set $$$VARPEPTransfuncionalDataHoraAssinatura(objPEPTransf) = $Horolog
			set $$$VARPEPTransfuncionalUsuarioAssinatura(objPEPTransf) 	= YBED
		}else{
			If ($$$VARPEPTransfuncionalUsuarioAssinatura(objPEPTransf) '= YBED) {
				set $$$VARPEPTransfuncionalDataHoraAssinatura(objPEPTransf) = ""
				set $$$VARPEPTransfuncionalUsuarioAssinatura(objPEPTransf) 	= ""
			}else{
				set $$$VARPEPTransfuncionalDataHoraAssinatura(objPEPTransf) = $Horolog
			}
		}
		;
		set $$$VARPEPTransfuncionalRTTransfusoesAnteriores(objPEPTransf) = pRTTransfusoesAnteriores
		set $$$VARPEPTransfuncionalRTTempoAproximado(objPEPTransf) = pRTTempoAproximado
		set $$$VARPEPTransfuncionalRTReacaoTransfusionaisA(objPEPTransf) = pRTReacaoTransfusionaisA
		set $$$VARPEPTransfuncionalRTTipoComponente(objPEPTransf) = pRTTipoComponente
		set $$$VARPEPTransfuncionalRTTipoDeReacao(objPEPTransf) = pRTTipoDeReacao
		set $$$VARPEPTransfuncionalRTData(objPEPTransf) = pRTData
		set $$$VARPEPTransfuncionalRTHora(objPEPTransf) = pRTHora
		set $$$VARPEPTransfuncionalRTComponente(objPEPTransf) = pRTComponente
		set $$$VARPEPTransfuncionalRTVolume(objPEPTransf) = pRTVolume
		set $$$VARPEPTransfuncionalRTDeleucotizado(objPEPTransf) = pRTDeleucotizado
		set $$$VARPEPTransfuncionalRTIrradiado(objPEPTransf) = pRTIrradiado
		set $$$VARPEPTransfuncionalRTLavado(objPEPTransf) = pRTLavado
		set $$$VARPEPTransfuncionalRTSinSintMaisPulso(objPEPTransf) = pRTSinSintMaisPulso
		set $$$VARPEPTransfuncionalRTSinSintMenosPulso(objPEPTransf) = pRTSinSintMenosPulso
		set $$$VARPEPTransfuncionalRTSinSintMaisPA(objPEPTransf) = $Replace(pRTSinSintMaisPA,"_","")
		set $$$VARPEPTransfuncionalRTSinSintMenosPA(objPEPTransf) = pRTSinSintMenosPA
		set $$$VARPEPTransfuncionalRTSinSintFebre(objPEPTransf) = pRTSinSintFebre
		set $$$VARPEPTransfuncionalRTSinSintCalafrios(objPEPTransf) = pRTSinSintCalafrios
		set $$$VARPEPTransfuncionalRTSinSintDispneia(objPEPTransf) = pRTSinSintDispneia
		set $$$VARPEPTransfuncionalRTSinSintTremor(objPEPTransf) = pRTSinSintTremor
		set $$$VARPEPTransfuncionalRTSinSintVomito(objPEPTransf) = pRTSinSintVomito
		set $$$VARPEPTransfuncionalRTSinSintCianose(objPEPTransf) = pRTSinSintCianose
		set $$$VARPEPTransfuncionalRTSinSintDorLombar(objPEPTransf) = pRTSinSintDorLombar
		set $$$VARPEPTransfuncionalRTSinSintDordeCabeca(objPEPTransf) = pRTSinSintDordeCabeca
		set $$$VARPEPTransfuncionalRTSinSintDornoTorax(objPEPTransf) = pRTSinSintDornoTorax
		set $$$VARPEPTransfuncionalRTSinSintUrticaria(objPEPTransf) = pRTSinSintUrticaria
		set $$$VARPEPTransfuncionalRTSinSintEritema(objPEPTransf) = pRTSinSintEritema
		set $$$VARPEPTransfuncionalRTSinSintPrurido(objPEPTransf) = pRTSinSintPrurido
		set $$$VARPEPTransfuncionalRTSinSintSangramentos(objPEPTransf) = pRTSinSintSangramentos
		set $$$VARPEPTransfuncionalRTSinSintUrinaEscura(objPEPTransf) = pRTSinSintUrinaEscura
		set $$$VARPEPTransfuncionalRTSinSintMenosVolUrinario(objPEPTransf) = pRTSinSintMenosVolUrinario
		set $$$VARPEPTransfuncionalRTSinSintOutros(objPEPTransf) = pRTSinSintOutros
		set $$$VARPEPTransfuncionalRTSinSintOutrosDescrica(objPEPTransf) = pRTSinSintOutrosDescrica
		set $$$VARPEPTransfuncionalHemotAntecedentesDiabete(objPEPTransf) = pHemotAntecedentesDiabete
		set $$$VARPEPTransfuncionalHemotAntecedentesHiperte(objPEPTransf) = pHemotAntecedentesHiperte
		set $$$VARPEPTransfuncionalHemotAntecedentesIRC(objPEPTransf) = pHemotAntecedentesIRC
		set $$$VARPEPTransfuncionalHemotAntecedentesICC(objPEPTransf) = pHemotAntecedentesICC
		set $$$VARPEPTransfuncionalHemotAntecedentesHepatic(objPEPTransf) = pHemotAntecedentesHepatic
		set $$$VARPEPTransfuncionalHemotAntec]]><![CDATA[edentesInsufCo(objPEPTransf) = pHemotAntecedentesInsufCo
		set $$$VARPEPTransfuncionalHemotAntecedentesAVC(objPEPTransf) = pHemotAntecedentesAVC
		set $$$VARPEPTransfuncionalHemotAntecedentesOutros(objPEPTransf) = pHemotAntecedentesOutros
		set $$$VARPEPTransfuncionalHemotAntecedentesOutrosQ(objPEPTransf) = pHemotAntecedentesOutrosQ
		set $$$VARPEPTransfuncionalHemotMedicacoes(objPEPTransf) = pHemotMedicacoes
		set $$$VARPEPTransfuncionalHemotTransfusaoAnterior(objPEPTransf) = pHemotTransfusaoAnterior
		set $$$VARPEPTransfuncionalHemotTransfusaoAnteriorQ(objPEPTransf) = pHemotTransfusaoAnteriorQ
		set $$$VARPEPTransfuncionalHemotTransfusaoAnteriorO(objPEPTransf) = pHemotTransfusaoAnteriorO
		set $$$VARPEPTransfuncionalHemotReacoesTranPre(objPEPTransf) = pHemotReacoesTranPre
		set $$$VARPEPTransfuncionalHemotReacoesTranPreAle(objPEPTransf) = pHemotReacoesTranPreAle
		set $$$VARPEPTransfuncionalHemotReacoesTranPreFeb(objPEPTransf) = pHemotReacoesTranPreFeb
		set $$$VARPEPTransfuncionalHemotReacoesTranPreHem(objPEPTransf) = pHemotReacoesTranPreHem
		set $$$VARPEPTransfuncionalHemotReacoesTranPreOut(objPEPTransf) = pHemotReacoesTranPreOut
		set $$$VARPEPTransfuncionalHemotReacoesTranPreOutDes(objPEPTransf) = pHemotReacoesTranPreOutDes
		set $$$VARPEPTransfuncionalHemotComponenteDeleucoti(objPEPTransf) = pHemotComponenteDeleucoti
		set $$$VARPEPTransfuncionalHemotComponenteIrradiado(objPEPTransf) = pHemotComponenteIrradiado
		set $$$VARPEPTransfuncionalHemotComponenteLavado(objPEPTransf) = pHemotComponenteLavado
		set $$$VARPEPTransfuncionalHemotMedPreTranDife(objPEPTransf) = pHemotMedPreTranDife
		set $$$VARPEPTransfuncionalHemotMedPreTranDifeDose(objPEPTransf) = pHemotMedPreTranDifeDose
		set $$$VARPEPTransfuncionalHemotMedPreTranFleb(objPEPTransf) = pHemotMedPreTranFleb
		set $$$VARPEPTransfuncionalHemotMedPreTranFlebDose(objPEPTransf) = pHemotMedPreTranFlebDose
		set $$$VARPEPTransfuncionalHemotMedPreTranDipi(objPEPTransf) = pHemotMedPreTranDipi
		set $$$VARPEPTransfuncionalHemotMedPreTranDipiDose(objPEPTransf) = pHemotMedPreTranDipiDose
		set $$$VARPEPTransfuncionalHemotMedPreTranPara(objPEPTransf) = pHemotMedPreTranPara
		set $$$VARPEPTransfuncionalHemotMedPreTranParaDose(objPEPTransf) = pHemotMedPreTranParaDose
		set $$$VARPEPTransfuncionalHemotMedPreTranFuro(objPEPTransf) = pHemotMedPreTranFuro
		set $$$VARPEPTransfuncionalHemotMedPreTranFuroDose(objPEPTransf) = pHemotMedPreTranFuroDose
		set $$$VARPEPTransfuncionalHemotMedPreTranOutr(objPEPTransf) = pHemotMedPreTranOutr
		set $$$VARPEPTransfuncionalHemotMedPreTranOutrDesc(objPEPTransf) = pHemotMedPreTranOutrDesc
		set $$$VARPEPTransfuncionalHemotObs(objPEPTransf) = pHemotMedPreObs
		set $$$VARPEPTransfuncionalReacoesTransfusionaisObse(objPEPTransf) = pReacoesTransfusionaisObse
		set $$$VARPEPTransfuncionalHemotTCLEQuando(objPEPTransf) = pHemotTCLEQuando
		
		;
		set strStatus	=	$$$Save("VARPEPTransfuncional", pCodProntuario, objPEPTransf, $$$YES)
		if (strStatus '= $$$OK) {
			quit	
		}
		set pCID												= $get(%request.Data("pCID",1))
		set pComorbidades								= $get(%request.Data("pComorbidades",1))
		set pComorbidadesDM							= $get(%request.Data("pComorbidadesDM",1))
		set pComorbidadesHAS						= $get(%request.Data("pComorbidadesHAS",1))
		set pComorbidadesIRC						= $get(%request.Data("pComorbidadesIRC",1))
		set pComorbidadesICC						= $get(%request.Data("pComorbidadesICC",1))
		set pComorbidadesAVC						= $get(%request.Data("pComorbidadesAVC",1))
		set pComorbidadesCodronariopatia= $get(%request.Data("pComorbidadesCodronariopatia",1))
		set pComorbidadesOutros					= $get(%request.Data("pComorbidadesOutros",1))
		set pAlergia										= $get(%request.Data("pAlergia",1))
		set pAlergiaAQue								= $get(%request.Data("pAlergiaAQue",1))
		set pInfusaoVeiaPeriferica			= $get(%request.Data("pInfusaoVeiaPeriferica",1))
		set pInfusaoPort								= $get(%request.Data("pInfusaoPort",1))
		set pInfusaoPICC								= $get(%request.Data("pInfusaoPICC",1))
		set pInfusaoLocalizacao					= $get(%request.Data("pInfusao",1))
		set pFluxoCateter								= $get(%request.Data("pFluxoCateter",1))
		set pFinalizacaoCom							= $get(%request.Data("pFinalizacao",1))
		set pIncidente									= $get(%request.Data("pIncidente",1))
		set pIncidenteQual							= $get(%request.Data("pIncidenteQual",1))
		set pRiscoFlebite								= $get(%request.Data("pRiscoFlebite",1))
		set pNeuropsiquiatrico					= $get(%request.Data("pNeuropsiquiatrico",1))
		set pPadraoRespiratorio					= $get(%request.Data("pPadraoRespiratorio",1))
		set pRitmoCardiaco							= $get(%request.Data("pRitmoCardiaco",1))
		set pPeleMucosa									= $get(%request.Data("pPeleMucosa",1))
		set pDor												= $get(%request.Data("pDor",1))
		set pDorDescricao								= $get(%request.Data("pDorDescricao",1))
		set pRedeVenoso									= $get(%request.Data("pRedeVenoso",1))
		set pRedeVenosoDescricao				= $get(%request.Data("pRedeVenosoDescricao",1))
		set pMedoApreensao							= $get(%request.Data("pMedoApreensao",1))
		set pMedoApreensaoDescricao			= $get(%request.Data("pMedoApreensaoDescricao",1))
		set pInternacaoSocial						= $get(%request.Data("pInternacaoSocial",1))
		set pInternacaoSocialDescricao	= $get(%request.Data("pInternacaoSocialDescricao",1))
		set pColocarEtiqueta						= $get(%request.Data("pColocarEtiqueta",1))
		set pConferirNome								= $get(%request.Data("pConferirNome",1))
		set pOrientacao									= $get(%request.Data("pOrientacao",1))
		set pPeso												= $get(%request.Data("pPeso",1))
		set pHb													= $get(%request.Data("pHb",1))
		set pHtc												= $get(%request.Data("pHtc",1))
		set pPlaquetas									= $get(%request.Data("pPlaquetas",1))
		SET pcampoTransfusao = $GET(%request.Data("pcampoTransfusao",1))
		SET pcampoCTHTCBolsa = $GET(%request.Data("pcampoCTHTCBolsa",1))
		SET pcampoCTTS = $GET(%request.Data("pcampoCTTS",1))
		SET pcampoCTPai = $GET(%request.Data("pcampoCTPai",1))
		SET pcampoCTIAC = $GET(%request.Data("pcampoCTIAC",1))
		SET pcampoCTTCD = $GET(%request.Data("pcampoCTTCD",1))
		;
		if (pCID '= "") set pCID = $replace(pCID,",",";")
		;if (pComorbidades '= "") set pComorbidades = $replace(pComorbidades,",",";")
		if (pComorbidadesDM '= "") set pComorbidadesDM = $select(pComorbidadesDM="true"||(pComorbidadesDM=1):1,1:0)
		if (pComorbidadesHAS '= "") set pComorbidadesHAS = $select(pComorbidadesHAS="true"||(pComorbidadesHAS=1):1,1:0)
		if (pComorbidadesIRC '= "") set pComorbidadesIRC = $select(pComorbidadesIRC="true"||(pComorbidadesIRC=1):1,1:0)
		if (pComorbidadesICC '= "") set pComorbidadesICC = $select(pComorbidadesICC="true"||(pComorbidadesICC=1):1,1:0)
		if (pComorbidadesAVC '= "") set pComorbidadesAVC = $select(pComorbidadesAVC="true"||(pComorbidadesAVC=1):1,1:0)
		if (pComorbidadesCodronariopatia '= "") {
			set pComorbidadesCodronariopatia = $select(pComorbidadesCodronariopatia="true"||(pComorbidadesCodronariopatia=1):1,1:0)
		}
		if (pInfusaoVeiaPeriferica '= "") set pInfusaoVeiaPeriferica = $select(pInfusaoVeiaPeriferica="true"||(pInfusaoVeiaPeriferica=1):1,1:0)
		if (pInfusaoPort '= "") set pInfusaoPort = $select(pInfusaoPort="true"||(pInfusaoPort=1):1,1:0)
		if (pInfusaoPICC '= "") set pInfusaoPICC = $select(pInfusaoPICC="true"||(pInfusaoPICC=1):1,1:0)
		if (pConferirNome '= "") set pConferirNome = $select(pConferirNome="true"||(pConferirNome=1):1,1:0)
		if (pColocarEtiqueta '= "") set pColocarEtiqueta = $select(pColocarEtiqueta="true"||(pColocarEtiqueta=1):1,1:0)
		;
		set objPEPTransfAnamnese = $get(^VARPEPTransfuncionalAnamnese(YM, pCodProntuario, 1))
		set $$$VARPEPTransfuncionalAnamneseCID(objPEPTransfAnamnese)												= pCID
		set $$$VARPEPTransfuncionalAnamneseComorbidades(objPEPTransfAnamnese)								= pComorbidades
		set $$$VARPEPTransfuncionalAnamneseComorbidadesDM(objPEPTransfAnamnese)							= pComorbidadesDM
		set $$$VARPEPTransfuncionalAnamneseComorbidadesHAS(objPEPTransfAnamnese)						= pComorbidadesHAS
		set $$$VARPEPTransfuncionalAnamneseComorbidadesIRC(objPEPTransfAnamnese)						= pComorbidadesIRC
		set $$$VARPEPTransfuncionalAnamneseComorbidadesICC(objPEPTransfAnamnese)						= pComorbidadesICC
		set $$$VARPEPTransfuncionalAnamneseComorbidadesAVC(objPEPTransfAnamnese)						= pComorbidadesAVC
		set $$$VARPEPTransfuncionalAnamneseComorbidadesCondronariopa(objPEPTransfAnamnese)	= pComorbidadesCodronariopatia
		set $$$VARPEPTransfuncionalAnamneseComorbidadesOutros(objPEPTransfAnamnese)					= pComorbidadesOutros
		set $$$VARPEPTransfuncionalAnamneseAlergia(objPEPTransfAnamnese)										= pAlergia
		set $$$VARPEPTransfuncionalAnamneseAlergiaAQue(objPEPTransfAnamnese)								= pAlergiaAQue
		set $$$VARPEPTransfuncionalAnamneseInfusaoVeiaPeriferica(objPEPTransfAnamnese)			= pInfusaoVeiaPeriferica
		set $$$VARPEPTransfuncionalAnamneseInfusaoPortaCath(objPEPTransfAnamnese)						= pInfusaoPort
		set $$$VARPEPTransfuncionalAnamneseInfusaoPICC(objPEPTransfAnamnese)								= pInfusaoPICC
		set $$$VARPEPTransfuncionalAnamneseInfusaoLocalizacao(objPEPTransfAnamnese)					= pInfusaoLocalizacao
		set $$$VARPEPTransfuncionalAnamneseFluxoCateter(objPEPTransfAnamnese)								= pFluxoCateter
		set $$$VARPEPTransfuncionalAnamneseFinalizacaoCom(objPEPTransfAnamnese)							= pFinalizacaoCom
		set $$$VARPEPTransfuncionalAnamneseIncidente(objPEPTransfAnamnese)									= pIncidente
		set $$$VARPEPTransfuncionalAnamneseIncidenteQual(objPEPTransfAnamnese)							= pIncidenteQual
		set $$$VARPEPTransfuncionalAnamneseRiscodeFlebite(objPEPTransfAnamnese)							= pRiscoFlebite
		set $$$VARPEPTransfuncionalAnamneseNeuropsiquiatrico(objPEPTransfAnamnese)					= pNeuropsiquiatrico
		set $$$VARPEPTransfuncionalAnamnesePadraoRespiratorio(objPEPTransfAnamnese)					= pPadraoRespiratorio
		set $$$VARPEPTransfuncionalAnamneseRitmoCardiaco(objPEPTransfAnamnese)							= pRitmoCardiaco
		set $$$VARPEPTransfuncionalAnamnesePeleeMucosa(objPEPTransfAnamnese)								= pPeleMucosa
		set $$$VARPEPTransfuncionalAnamneseDor(objPEPTransfAnamnese)												= pDor
		set $$$VARPEPTransfuncionalAnamneseDorDescricao(objPEPTransfAnamnese)								= pDorDescricao
		set $$$VARPEPTransfuncionalAnamneseRedeVenosoPrej(objPEPTransfAnamnese)							= pRedeVenoso
		set $$$VARPEPTransfuncionalAnamneseRedeVenosoPrejDescricao(objPEPTransfAnamnese)		= pRedeVenosoDescricao
		set $$$VARPEPTransfuncionalAnamneseMedoApreensao(objPEPTransfAnamnese)							= pMedoApreensao
		set $$$VARPEPTransfuncionalAnamneseMedoApreensaoDescricao(objPEPTransfAnamnese)			= pMedoApreensaoDescricao
		set $$$VARPEPTransfuncionalAnamneseIntSocPejud(objPEPTransfAnamnese)								= pInternacaoSocial
		set $$$VARPEPTransfuncionalAnamneseIntSocPejudDescricao(objPEPTransfAnamnese)				= pInternacaoSocialDescricao
		set $$$VARPEPTransfuncionalAnamneseColocarEtiqueta(objPEPTransfAnamnese)						= pColocarEtiqueta
		set $$$VARPEPTransfuncionalAnamneseConferirNome(objPEPTransfAnamnese)								= pConferirNome
		If ($$$VARPEPTransfuncionalAnamneseOrientacoesaEnfermagem(objPEPTransfAnamnese)	'= pOrientacao) {
			set $$$VARPEPTransfuncionalAnamneseOrientacoesaEnfermagem(objPEPTransfAnamnese)	= pOrientacao
			set $$$VARPEPTransfuncionalAnamneseMedicoOrientacoesaEnferma(objPEPTransfAnamnese)	= YBED
			set $$$VARPEPTransfuncionalAnamneseDataHoraOrientacoesaEnfer(objPEPTransfAnamnese)	= $Horolog
		}
		set $$$VARPEPTransfuncionalAnamneseDadosPreTransfPeso(objPEPTransfAnamnese)					= pPeso
		set $$$VARPEPTransfuncionalAnamneseDadosPreTransfHb(objPEPTransfAnamnese)						= pHb
		set $$$VARPEPTransfuncionalAnamneseDadosPreTransfHtc(objPEPTransfAnamnese)					= pHtc
		set $$$VARPEPTransfuncionalAnamneseDadosPreTransfPlaquetas(objPEPTransfAnamnese)		= pPlaquetas
		SET $$$VARPEPTransfuncionalAnamneseTransfusao(objPEPTransfAnamnese) = pcampoTransfusao
		SET $$$VARPEPTransfuncionalAnamneseHTCBolsa(objPEPTransfAnamnese) = pcampoCTHTCBolsa
		SET $$$VARPEPTransfuncionalAnamneseTipoSanguineo(objPEPTransfAnamnese) = pcampoCTTS
		SET $$$VARPEPTransfuncionalAnamnesePAI(objPEPTransfAnamnese) = pcampoCTPai
		SET $$$VARPEPTransfuncionalAnamneseIAC(objPEPTransfAnamnese) = pcampoCTIAC
		SET $$$VARPEPTransfuncionalAnamneseTCD(objPEPTransfAnamnese) = pcampoCTTCD
		set strStatus	=	$$$Save("VARPEPTransfuncionalAnamnese", pCodProntuario, objPEPTransfAnamnese, $$$YES)
		;
		Set objMEDPatient = $Get(^MEDPatient(0, codPaciente, 1))
		If (pAlergia '= $$$MEDPatientAlergia(objMEDPatient) || (pAlergiaAQue '= $$$MEDPatientAllergies(objMEDPatient))) {
			set $$$MEDPatientAlergia(objMEDPatient) = pAlergia
			set $$$MEDPatientAllergies(objMEDPatient) = pAlergiaAQue
			set strStatus	=	$$$Save("MEDPatient", codPaciente, objMEDPatient, $$$YES)
		}
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro	=	err
	}
	set retorno = {}
	if 'erro{
		tcommit
		set retorno.status = strStatus
		set retorno.dataHoraAssinatura = $$$VARPEPTransfuncionalDataHoraAssinatura(objPEPTransf)
	}else{
		trollback
		set retorno.status = strStatus
		set retorno.dataHoraAssinatura = $$$VARPEPTransfuncionalDataHoraAssinatura(objPEPTransf)
	}
	do retorno.%ToJSON()
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetEtiquetas">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select Etiqueta From sqlUSER.VARPEPTransfuncionalEtiqueta"
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"	
	
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		
		set list = {}
		set list.etiqueta	= rSet.%Get("Etiqueta")
		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmEtiqueta">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	tstart
	set strStatus	=	""
	set erro			=	0
	try{
		set pCodProntuario = $get(%request.Data("pCodProntuario",1))
		set pEtiqueta = $get(%request.Data("pEtiqueta",1))
		set pVolume = $get(%request.Data("pVolume",1))
		set pHemocomponentes = $get(%request.Data("pHemocomponentes",1))
		set pNBolsa = $get(%request.Data("pNBolsa",1))
		set pAboRH = $get(%request.Data("pAboRH",1))
		set pAboRHPaciente = $get(%request.Data("pAboRHPaciente",1))
		set pTesteComp = $get(%request.Data("pTesteComp",1))
		set pResponsavelInfusao = $get(%request.Data("pResponsavelInfusao",1))
		set pResponsavelPreparo = $get(%request.Data("pResponsavelPreparo",1))
		set pDataPreparo = $get(%request.Data("pDataPreparo",1))
		set pHoraPreparo = $get(%request.Data("pHoraPreparo",1))
		set pPreMedicacao = $get(%request.Data("pPreMedicacao",1))
		;	
		set objPEPTransfEtiq = $get(^VARPEPTransfuncionalEtiqueta(YM, pCodProntuario, pEtiqueta, 1))
		set $$$VARPEPTransfuncionalEtiquetaVolume(objPEPTransfEtiq) = +pVolume
		set $$$VARPEPTransfuncionalEtiquetaHemocomponentes(objPEPTransfEtiq) = pHemocomponentes
		set $$$VARPEPTransfuncionalEtiquetaNodaBolsa(objPEPTransfEtiq) = pNBolsa
		set $$$VARPEPTransfuncionalEtiquetaAboRH(objPEPTransfEtiq) = pAboRH
		set $$$VARPEPTransfuncionalEtiquetaAboRHPaciente(objPEPTransfEtiq) = pAboRHPaciente
		set $$$VARPEPTransfuncionalEtiquetaTestedeCompatibilidade(objPEPTransfEtiq) = pTesteComp
		set $$$VARPEPTransfuncionalEtiquetaResponsavelpelainfusao(objPEPTransfEtiq) = pResponsavelInfusao
		set $$$VARPEPTransfuncionalEtiquetaResponsavelpeloPreparo(objPEPTransfEtiq) = pResponsavelPreparo
		set $$$VARPEPTransfuncionalEtiquetaDataPreparo(objPEPTransfEtiq) = $Select(pDataPreparo="":"",1:$ZDATEH(pDataPreparo,4,,,,,,,""))
		set $$$VARPEPTransfuncionalEtiquetaHoraPreparo(objPEPTransfEtiq) = $Select(pHoraPreparo="":"",1:$Ztimeh(pHoraPreparo,2,""))
		set $$$VARPEPTransfuncionalEtiquetaPreMedicacao(objPEPTransfEtiq) = pPreMedicacao
		;
		set strStatus	=	$$$Save("VARPEPTransfuncionalEtiqueta", pCodProntuario_$$$COMMA_pEtiqueta, objPEPTransfEtiq, $$$YES)
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro	=	err
	}
	set retorno = {}
	if 'erro{
		tcommit
		set retorno.status = strStatus
	}else{
		trollback
		set retorno.status = strStatus
	}
	do retorno.%ToJSON()
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetDadosEtiqueta">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	set pCodProntuario	= $get(%request.Data("pCodProntuario",1))
	set pEtiqueta 			= $get(%request.Data("pEtiqueta",1))
		
	set objPEPTransfEtiq = ""
	if (pEtiqueta '= "") {
		set objPEPTransfEtiq = $get(^VARPEPTransfuncionalEtiqueta(0, pCodProntuario, pEtiqueta, 1))
	}
	set dataPreparo = $$$VARPEPTransfuncionalEtiquetaDataPreparo(objPEPTransfEtiq)
	set horaPreparo = $$$VARPEPTransfuncionalEtiquetaHoraPreparo(objPEPTransfEtiq)
	set listRetorno = {}
	set listRetorno.volume = $$$VARPEPTransfuncionalEtiquetaVolume(objPEPTransfEtiq)
	set listRetorno.hemocomponentes = $$$VARPEPTransfuncionalEtiquetaHemocomponentes(objPEPTransfEtiq)
	set listRetorno.nBolsa = $$$VARPEPTransfuncionalEtiquetaNodaBolsa(objPEPTransfEtiq)
	set listRetorno.aboRH = $$$VARPEPTransfuncionalEtiquetaAboRH(objPEPTransfEtiq)
	set listRetorno.aboRHPaciente = $$$VARPEPTransfuncionalEtiquetaAboRHPaciente(objPEPTransfEtiq)
	set listRetorno.testeComp = $$$VARPEPTransfuncionalEtiquetaTestedeCompatibilidade(objPEPTransfEtiq)
	set listRetorno.responsavelPreparo = $$$VARPEPTransfuncionalEtiquetaResponsavelpeloPreparo(objPEPTransfEtiq)
	set listRetorno.responsavelInfusao = $$$VARPEPTransfuncionalEtiquetaResponsavelpelainfusao(objPEPTransfEtiq)
	set listRetorno.dataPreparo = $Select(dataPreparo'="":$zdate(dataPreparo,4),1:"")
	set listRetorno.horaPreparo = $Select(horaPreparo'="":$ztime(horaPreparo,2),1:"")
	set listRetorno.preMedicacao = $$$VARPEPTransfuncionalEtiquetaPreMedicacao(objPEPTransfEtiq)
	set listRetorno.status = +$$$VARPEPTransfuncionalEtiquetaStatus(objPEPTransfEtiq)
	set listRetorno.medicoSuspenderMedicament = $$$VARPEPTransfuncionalEtiquetaMedicoSuspenderMedicament(objPEPTransfEtiq)

	do listRetorno.%ToJSON()

	quit $$$OK]]></Implementation>
</Method>

<Method name="allDadosEtiqueta">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	set pCodProntuario	= $get(%request.Data("pCodProntuario",1))
	set lista = []
	set pEtiqueta = ""
	for {
		set pEtiqueta = $order(^VARPEPTransfuncionalEtiqueta(0, pCodProntuario, pEtiqueta)) quit:pEtiqueta=""
		set objPEPTransfEtiq = ^VARPEPTransfuncionalEtiqueta(0, pCodProntuario, pEtiqueta, 1)
		
		set obj = {}
		
		set dataPreparo = $$$VARPEPTransfuncionalEtiquetaDataPreparo(objPEPTransfEtiq)
		set horaPreparo = $$$VARPEPTransfuncionalEtiquetaHoraPreparo(objPEPTransfEtiq)
		
		set obj.etiqueta = pEtiqueta
		set obj.volume = $$$VARPEPTransfuncionalEtiquetaVolume(objPEPTransfEtiq)
		set obj.hemocomponentes = $$$VARPEPTransfuncionalEtiquetaHemocomponentes(objPEPTransfEtiq)
		set obj.nBolsa = $$$VARPEPTransfuncionalEtiquetaNodaBolsa(objPEPTransfEtiq)
		set obj.aboRH = $$$VARPEPTransfuncionalEtiquetaAboRH(objPEPTransfEtiq)
		set obj.aboRHPaciente = $$$VARPEPTransfuncionalEtiquetaAboRHPaciente(objPEPTransfEtiq)
		set obj.testeComp = $$$VARPEPTransfuncionalEtiquetaTestedeCompatibilidade(objPEPTransfEtiq)
		set obj.responsavelPreparo = $$$VARPEPTransfuncionalEtiquetaResponsavelpeloPreparo(objPEPTransfEtiq)
		set obj.responsavelInfusao = $$$VARPEPTransfuncionalEtiquetaResponsavelpelainfusao(objPEPTransfEtiq)
		
		if obj.responsavelInfusao'="" {
			set objMEDProvider = $get(^MEDProvider(0,obj.responsavelInfusao,1))
			set obj.responsavelInfusao = $$$MEDProviderName(objMEDProvider)
		}
		
		
		if dataPreparo'="", horaPreparo'="" {
			set obj.dataPreparo = $Select(dataPreparo'="":$zdate(dataPreparo,4),1:"")_" "_$Select(horaPreparo'="":$ztime(horaPreparo,2),1:"")
		}
		elseif (dataPreparo'="") {
			set obj.dataPreparo = $Select(dataPreparo'="":$zdate(dataPreparo,4),1:"")
		} 
		else {
			set obj.dataPreparo = ""
		}
		
		set obj.preMedicacao = $$$VARPEPTransfuncionalEtiquetaPreMedicacao(objPEPTransfEtiq)
		set obj.status = +$$$VARPEPTransfuncionalEtiquetaStatus(objPEPTransfEtiq)
		set obj.medicoSuspenderMedicament = $$$VARPEPTransfuncionalEtiquetaMedicoSuspenderMedicament(objPEPTransfEtiq)

		do lista.%Push(obj)
	}
	
	do lista.%ToJSON()
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetContDadosVitais">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	set pEtiqueta			 = $get(%request.Data("pEtiqueta",1))
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select Etiqueta, Sequencia, DataHoraAfericao, PressaoArterial, Pulso, Temperatura,"
	set meuSQL($increment(contador))	= "FreqRespiratoria, Responsavel, $$SQLGetProviderName^VARSQL(Responsavel) As Name" 
	set meuSQL($increment(contador))	= "From SQLUser.VARPEPTransfuncionalEtiquetaDadosVitais"
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"
	if (pEtiqueta '= "") {
		set meuSQL($increment(contador))	= "And Etiqueta = '"_pEtiqueta_"'"	
	}
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		
		set data = $zd(+rSet.%Get("DataHoraAfericao"),4)
		set hora = $piece(rSet.%Get("DataHoraAfericao"),",",2)

		set objPEPTransfEtiq 	= $get(^VARPEPTransfuncionalEtiqueta(YM, pCodProntuario, rSet.%Get("Etiqueta"), 1))
		set hemocomponentes		= $$$VARPEPTransfuncionalEtiquetaHemocomponentes(objPEPTransfEtiq)

		set list = {}
		set list.etiqueta					= rSet.%Get("Etiqueta")_" Hemocomponentes: "_hemocomponentes
		set list.sequencia				= rSet.%Get("Sequencia")
		set list.data							= data
		set list.hora 						= $ztime(hora,2)
		set list.pressaoArterial 	= rSet.%Get("PressaoArterial")
		set list.pulso 						= rSet.%Get("Pulso")
		set list.temperatura 			= rSet.%Get("Temperatura")
		set list.freqRespiratoria = rSet.%Get("FreqRespiratoria")
		set list.responsavel 			= $$SQLGetUserName^VARSQL(rSet.%Get("Responsavel"))
		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmContDadosVitais">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pEtiqueta,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	
	if (pSequencia = "") {
		set pSequencia = $$GetNextNumber^COMUtils("VARPEPTransfuncionalEtiquetaDadosVitais","")
	}
	
	set objContDados = $get(^VARPEPTransfuncionalEtiquetaDadosVitais(YM, pCodProntuario, pEtiqueta, pSequencia, 1))

	set index = "" 
	for {
		set index = $order(pDados(index)) 
		quit:index=""
		
		set coluna	= $piece(pDados(index),"~",1)
		set valor		= $piece(pDados(index),"~",2)

		if (coluna = "hora") {
			set hora = +$horolog_","_$ztimeh(valor,4,$piece($horolog,",",2))
			set $$$VARPEPTransfuncionalEtiquetaDadosVitaisDataHoraAfericao(objContDados) = hora
		}
		if (coluna = "pressaoArterial") {
			set valor = $Replace(valor,"_","") 
			set $$$VARPEPTransfuncionalEtiquetaDadosVitaisPressaoArterial(objContDados) = valor
		}
		if (coluna = "pulso") set $$$VARPEPTransfuncionalEtiquetaDadosVitaisPulso(objContDados) = valor
		if (coluna = "temperatura") set $$$VARPEPTransfuncionalEtiquetaDadosVitaisTemperatura(objContDados) = valor
		if (coluna = "freqRespiratoria") set $$$VARPEPTransfuncionalEtiquetaDadosVitaisFreqRespiratoria(objContDados) = valor
	}
	set $$$VARPEPTransfuncionalEtiquetaDadosVitaisResponsavel(objContDados) = YBED


	quit $$$Save("VARPEPTransfuncionalEtiquetaDadosVitais",pCodProntuario_$$$COMMA_pEtiqueta_$$$COMMA_pSequencia,objContDados,$$$YES)]]></Implementation>
</Method>

<Method name="ExcluirContDadosVitais">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pEtiqueta,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	quit $$$Kill("VARPEPTransfuncionalEtiquetaDadosVitais",pCodProntuario_$$$COMMA_pEtiqueta_$$$COMMA_pSequencia)]]></Implementation>
</Method>

<Method name="Imprimir">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM = 0 
	set Y  = "~"
	
	set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
	set pTipo 					= $get(%request.Data("pTipo",1))
	set YBED 						= $get(%request.Data("YBED",1))
	SET pPassagem = $GET(%request.Data("pPassagem",1))
	
	SET codigoPaciente = $$$MEDAdmissionPatient($GET(^MEDAdmission(0,pPassagem,1)))

	set folder = $piece($get(^VARJasper(YM,YM,1)),Y,1)


	if pTipo="T"{	;Termo de Consentimento
	set link=$$Start^VARJasperRun("VARPEPEnfTransfusionalTermo")
	}else{
	set link=$$Start^VARJasperRun("VARPEPEnfTransfusional")
	}
	if pTipo = "RT" SET link=$$Start^VARJasperRun("VARPEPEnfTransfusionalTalassemia")

	set hoje = $zdate($horolog,4)
	set link = $$addUserParameter^VARJasperRun(link,"pDataImpressao","SP "_hoje)
	set link = $$addUserParameter^VARJasperRun(link,"pCodProntuario",pCodProntuario)
	set link = $$addUserParameter^VARJasperRun(link,"CompiledDir",folder)
	set link = $$addUserParameter^VARJasperRun(link,"pCodigoPac",codigoPaciente)
	set link = $$addParameter^VARJasperRun(link,YBED,1)
	
	

	do ViewInForm^VARJasperRun(link,"Impressao",2)
	
	Quit $$$OK]]></Implementation>
</Method>

<Method name="ArmFinalizarBolsa">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	
	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set pEtiqueta 			= $Get(%request.Data("pEtiqueta",1))
	
	set objPEPTransfEtiq = $get(^VARPEPTransfuncionalEtiqueta(0, pCodProntuario, pEtiqueta, 1))
	set $$$VARPEPTransfuncionalEtiquetaStatus(objPEPTransfEtiq) = 1
	;
	set strStatus	=	$$$Save("VARPEPTransfuncionalEtiqueta", pCodProntuario_$$$COMMA_pEtiqueta, objPEPTransfEtiq, $$$YES)
	
	Write strStatus
	
	Quit strStatus]]></Implementation>
</Method>

<Method name="ArmSuspencaoMedicamento">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	
	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set pEtiqueta 			= $Get(%request.Data("pEtiqueta",1))
	Set pMedicoSusp 		= $Get(%request.Data("pMedicoSusp",1))
	
	set objPEPTransfEtiq = $get(^VARPEPTransfuncionalEtiqueta(0, pCodProntuario, pEtiqueta, 1))
	set $$$VARPEPTransfuncionalEtiquetaMedicoSuspenderMedicament(objPEPTransfEtiq) = pMedicoSusp
	;
	set strStatus	=	$$$Save("VARPEPTransfuncionalEtiqueta", pCodProntuario_$$$COMMA_pEtiqueta, objPEPTransfEtiq, $$$YES)
	
	Write strStatus
	
	Quit strStatus]]></Implementation>
</Method>

<Method name="ArmFinalizar">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 		= 0
	set Y 		= "~"
	set erro 	= ""
	try{
		set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
		set pAdmissao				= $get(%request.Data("pAdmissao",1))
		set pTerminoPedido	= $get(%request.Data("pTerminoPedido",1))
	
		set objPEPTrans = $get(^VARPEPTransfuncional(YM, pCodProntuario, 1))
		set $$$VARPEPTransfuncionalTerminodoPedido(objPEPTrans) = pTerminoPedido
		set strStatus	=	$$$Save("VARPEPTransfuncional", pCodProntuario, objPEPTrans, $$$YES)
		
		&sql( Delete From SQLUser.VARPEPLeitoAtendimento Where Company = :YM And Prontuario = :pCodProntuario)
		if (SQLCODE '= 0) {
			set erro = "Erro ao liberar leito."
			quit
		}

		set objMEDAdmission	= $get(^MEDAdmission(YM, pAdmissao, 1))
		;set $$$MEDAdmissionBed(objMEDAdmission) 	= ""
		;set $$$MEDAdmissionRoom(objMEDAdmission) 	= ""
		;set $$$MEDAdmissionFREE1(objMEDAdmission)	= ""
		set $$$MEDAdmissionDateDischarged(objMEDAdmission) 	= +$horolog
		set $$$MEDAdmissionTimeDischarged(objMEDAdmission)	= $piece($horolog,",",2)
		set $$$MEDAdmissionStatus(objMEDAdmission)	= 3
		set strStatus = $$$Save("MEDAdmission", pAdmissao, objMEDAdmission, $$$YES)
		
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro			=	err
	}	
	set objRetorno = {}
	if erro=""{
		set objRetorno.status = $$$OK
	}else{
		set objRetorno.status = erro
	}
		
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmMedico">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM = 0
	Set Y = "~"
		
	Set pNome 			= $Get(%request.Data("pNome",1))
	Set pUFCRM 			= $ZCVT($Get(%request.Data("pUFCRM",1)),"U")
	Set pNumeroCRM 	= $Get(%request.Data("pCRM",1))
	Set YBED				= $Get(%request.Data("YBED",1))
	
	Set id = $Order(^MEDProviders(0,10,pUFCRM,2231,pNumeroCRM,""))
	If (id '= "") {
		set id = ""
		set strStatus = "CRM "_pNumeroCRM_" já cadastrado no sistema!"
	}else{
		Set id = $Order(^MEDProvider(0, ""),-1) + 1	
		set objMEDProvider = $get(^MEDProvider(0, id, 1))
		set $$$MEDProviderName(objMEDProvider) = pNome
		set $$$MEDProviderLicenseType(objMEDProvider) = "2231"
		set $$$MEDProviderLicenseNumber(objMEDProvider) = pNumeroCRM
		set $$$MEDProviderSpeciality(objMEDProvider) = "2231"
		set $$$MEDProviderSSN(objMEDProvider) = pNumeroCRM
		set $$$MEDProviderStatus(objMEDProvider) = 1
		set $$$MEDProviderFREE2(objMEDProvider) = "2231"
		set $$$MEDProviderFREE3(objMEDProvider) = pUFCRM
		set $$$MEDProviderLocalizacao(objMEDProvider) = "E"
		;
		set strStatus	=	$$$Save("MEDProvider", id, objMEDProvider, $$$YES)
	}	
	Write strStatus_"|"_id
	
	Quit $$$OK]]></Implementation>
</Method>

<Method name="ApagarEtiqueta">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	
	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set pEtiqueta 			= $Get(%request.Data("pEtiqueta",1))
	
	set strStatus	=	$$$Kill("VARPEPTransfuncionalEtiqueta", pCodProntuario_$$$COMMA_pEtiqueta)
	
	Kill ^VARPEPTransfuncionalEtiquetaDad(0,pCodProntuario,pEtiqueta)
	
	Write strStatus
	
	Quit strStatus]]></Implementation>
</Method>

<Method name="GetRTDadosVitais">
<Description><![CDATA[///////////////////////////////////////////////////////////////////////////////]]></Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select Sequencia, HoraAfericao, Temperatura, PressaoArterial, Pulso"
	set meuSQL($increment(contador))	= "From SQLUser.VARPEPTransfuncionalRTDadosVitais"
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		
		set hora = rSet.%Get("HoraAfericao")

		set list = {}
		set list.sequencia				= rSet.%Get("Sequencia")
		set list.hora 						= $ztime(hora,2)
		set list.pressaoArterial 	= rSet.%Get("PressaoArterial")
		set list.pulso 						= rSet.%Get("Pulso")
		set list.temperatura 			= rSet.%Get("Temperatura")
		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmTRTDadosVitais">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	
	if (pSequencia = "") {
		set pSequencia = $$GetNextNumber^COMUtils("VARPEPTransfuncionalRTDadosVitais","")
	}
	
	set objContDados = $get(^VARPEPTransfuncionalRTDadosVitais(YM, pCodProntuario, pSequencia, 1))

	set index = "" 
	for {
		set index = $order(pDados(index)) 
		quit:index=""
		
		set coluna	= $piece(pDados(index),"~",1)
		set valor		= $piece(pDados(index),"~",2)

		if (coluna = "hora") {
			set hora = $ztimeh(valor,4,$piece($horolog,",",2))
			set $$$VARPEPTransfuncionalRTDadosVitaisHoraAfericao(objContDados) = hora
		}
		if (coluna = "pressaoArterial") {
			set valor = $Replace(valor,"_","") 
			set $$$VARPEPTransfuncionalRTDadosVitaisPressaoArterial(objContDados) = valor
		}
		if (coluna = "pulso") set $$$VARPEPTransfuncionalRTDadosVitaisPulso(objContDados) = valor
		if (coluna = "temperatura") set $$$VARPEPTransfuncionalRTDadosVitaisTemperatura(objContDados) = valor
	}

	quit $$$Save("VARPEPTransfuncionalRTDadosVitais",pCodProntuario_$$$COMMA_pSequencia,objContDados,$$$YES)]]></Implementation>
</Method>

<Method name="ExcluirRTDadosVitais">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	quit $$$Kill("VARPEPTransfuncionalRTDadosVitais",pCodProntuario_$$$COMMA_pSequencia)]]></Implementation>
</Method>

<Method name="GetRTComponente">
<Description><![CDATA[///////////////////////////////////////////////////////////////////////////////]]></Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select Sequencia, Numero, Componente, DatadaColeta, Validade"
	set meuSQL($increment(contador))	= "From SQLUser.VARPEPTransfuncionalRTComponente"
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		
		set list = {}
		set list.sequencia		= rSet.%Get("Sequencia")
		set list.numero				= rSet.%Get("Numero")
		set list.componente 	= rSet.%Get("Componente")
		set list.datadaColeta	= $Select(rSet.%Get("DatadaColeta")="":"",1:$ZDate(rSet.%Get("DatadaColeta"),4))
		set list.validade 		= rSet.%Get("Validade")
		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmTRTComponente">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	
	if (pSequencia = "") {
		set pSequencia = $$GetNextNumber^COMUtils("VARPEPTransfuncionalRTComponente","")
	}
	
	set objContDados = $get(^VARPEPTransfuncionalRTComponente(YM, pCodProntuario, pSequencia, 1))

	set index = "" 
	for {
		set index = $order(pDados(index)) 
		quit:index=""
		
		set coluna	= $piece(pDados(index),"~",1)
		set valor		= $piece(pDados(index),"~",2)

		if (coluna = "datadaColeta") {
			set data = $zdateh(valor,4,,,,,,,+$h)
			set $$$VARPEPTransfuncionalRTComponenteDatadaColeta(objContDados) = data
		}
		if (coluna = "componente") set $$$VARPEPTransfuncionalRTComponenteComponente(objContDados) = valor
		if (coluna = "validade") set $$$VARPEPTransfuncionalRTComponenteValidade(objContDados) = valor
		if (coluna = "numero") set $$$VARPEPTransfuncionalRTComponenteNumero(objContDados) = valor
	}

	quit $$$Save("VARPEPTransfuncionalRTComponente",pCodProntuario_$$$COMMA_pSequencia,objContDados,$$$YES)]]></Implementation>
</Method>

<Method name="ExcluirRTComponente">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	quit $$$Kill("VARPEPTransfuncionalRTComponente",pCodProntuario_$$$COMMA_pSequencia)]]></Implementation>
</Method>

<Method name="ExibirHistoricoTransfucional">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	SET pPassagem = $GET(%request.Data("pPassagem",1))
	
	SET admissao = ""
	
	SET objRetorno = []
	
	SET codigoPaciente = $$$MEDAdmissionPatient($GET(^MEDAdmission(0,pPassagem,1)))
	
	SET query = "Select ProtEletronico.NumeroAdmisao As Admissao,"
	SET query = query _ " PEPTransfucional.DataCriacao As dtAdmissao , "
	SET query = query _ " PEPTransfucional.RTData As dtReacao, "
	SET query = query _ " PEPTransfucional.RTComponente As Componente, PEPTransfucional.RTData "
	SET query = query _ " As Data, PEPTransfucional.RTDeleucotizado AS Deleucotizado, "
	SET query = query _ " PEPTransfucional.RTHora As Hora, PEPTransfucional.RTIrradiado "
	SET query = query _ " As Irradiado, PEPTransfucional.RTLavado As Lavado, "
	SET query = query _ " PEPTransfucional.RTReacaoTransfusionaisA As ReacaoTransfucionais, "
	SET query = query _ " PEPTransfucional.RTSinSintCalafrios As sintomasCalafrios, "
	SET query = query _ " PEPTransfucional.RTSinSintCianose As Cianose, "
	SET query = query _ " PEPTransfucional.RTSinSintDispneia As Dispneia, "
	SET query = query _ " PEPTransfucional.RTSinSintDorLombar As dorLombar,"
	SET query = query _ " PEPTransfucional.RTSinSintDordeCabeca As dorCabeca, "
	SET query = query _ " PEPTransfucional.RTSinSintDornoTorax As dorTorax, "
	SET query = query _ " PEPTransfucional.RTSinSintEritema As dorEritema, "
	SET query = query _ " PEPTransfucional.RTSinSintFebre As febre, "
	SET query = query _ " PEPTransfucional.RTSinSintMaisPA, "
	SET query = query _ " PEPTransfucional.RTSinSintMaisPulso As Pulso, "
	SET query = query _ " PEPTransfucional.RTSinSintMenosVolUrinario As volumeUrinario, "
	SET query = query _ " PEPTransfucional.RTSinSintOutros As Outros, "
	SET query = query _ " PEPTransfucional.RTSinSintOutrosDescrica As descricao,"
	SET query = query _ " PEPTransfucional.RTSinSintPrurido, "
	SET query = query _ " PEPTransfucional.RTSinSintSangramentos As Sangramentos, "
	SET query = query _ " PEPTransfucional.RTSinSintTremor As Tremor, "
	SET query = query _ " PEPTransfucional.RTSinSintUrinaEscura As urinaEscura, "
	SET query = query _ " PEPTransfucional.RTSinSintUrticaria As Urticaria, "
	SET query = query _ " PEPTransfucional.RTSinSintVomito As Vomito, "
	SET query = query _ " PEPTransfucional.RTTempoAproximado As TempoAproximado, "
	SET query = query _ " PEPTransfucional.RTTipoComponente As Componente, "
	SET query = query _ " PEPTransfucional.RTTipoDeReacao As TipoReacao, "
	SET query = query _ " PEPTransfucional.RTTransfusoesAnteriores As TransfusoesAnteriores, "
	SET query = query _ " PEPTransfucional.RTVolume As Volume, "
	SET query = query _ " PEPTransfucional.ReacoesTransfusionaisObse As Observacao, "
	SET query = query _ " PEPTransfucional.TerminodoPedido As TerminoPedido, "
	SET query = query _ " PEPTransfucional.UsuarioAssinatura As Assinatura "
	SET query = query _ " from VARProntuarioEletronico AS ProtEletronico"
	SET query = query _ " LEFT JOIN SQLUser.VARPEPTransfuncional AS PEPTransfucional"
	SET query = query _ " ON ProtEletronico.Codigo = PEPTransfucional.CodigoProntuarioEletronic"
	SET query = query _ " Where ProtEletronico.Company = 0 and PEPTransfucional.Company = 0"
	SET query = query _ " And ProtEletronico.Setor = 'TRANSFUSAOSANGUE'"
	SET query = query _ " And  ProtEletronico.Paciente = '" _ codigoPaciente _ "'"
	SET query = query _ " ORDER BY ProtEletronico.NumeroAdmisao DESC"
	
	set rs= ##class(%SQL.Statement).%ExecDirect("",.query)
	
	WHILE(rs.%Next())
	{
		SET list = {}
		SET list.admissao = rs.%Get("Admissao")
		SET dtAdmissaoSemConversao = rs.%Get("dtAdmissao")
		IF dtAdmissaoSemConversao = "" 
		{
			SET list.dtAdmissao = ""
		}
		ELSE
		{
			set list.dtAdmissao = $ZDATE($GET(dtAdmissaoSemConversao),4)
		}
		SET dtReacaoSemConversao = rs.%Get("dtReacao")
		IF dtReacaoSemConversao = ""
		 {
			 SET list.dtReacaoSemConversao = ""
		 }
		 ELSE
		 {
			SET list.dtReacao = $ZDATE($GET(dtReacaoSemConversao),4)
		 }
		 SET list.Componente = rs.%Get("Componente")
		SET Data = rs.%Get("Data")
		IF Data = ""
		{
			SET list.dataConvertida = ""
		}
		ELSE
		{
			SET list.dataConvertida = $ZDATE(Data,4)
		}
		SET list.Deleucotizado = rs.%Get("Deleucotizado")
		IF list.Deleucotizado = 1 SET list.Deleucotizado = "Sim"
		IF list.Deleucotizado = 0 SET list.Deleucotizado = "Não"
		SET list.Hora = rs.%Get("Hora")
		SET list.Irradiado = rs.%Get("Irradiado")
		IF list.Irradiado = 1 SET list.Irradiado = "Sim"
		IF list.Irradiado = 0 SET list.Irradiado = "Não"
		SET list.Lavado = rs.%Get("Lavado")
		IF list.Lavado = 1 SET list.Lavado = "Sim"
		IF list.Lavado = 0 SET list.Lavado = "Não"
		SET list.ReacaoTransfucionais = rs.%Get("ReacaoTransfucionais")
		IF list.ReacaoTransfucionais = 1 SET list.ReacaoTransfucionais = "Sim"
		IF list.ReacaoTransfucionais = 0 SET list.ReacaoTransfucionais = "Não"
		SET list.sintomasCalafrios = rs.%Get("sintomasCalafrios")
		IF list.sintomasCalafrios = 1 SET list.sintomasCalafrios = "Sim"
		IF list.sintomasCalafrios = 0 SET list.sintomasCalafrios = "Não"
		SET list.Cianose = rs.%Get("Cianose")
		IF list.Cianose = 1 SET list.Cianose = "Sim"
		IF list.Cianose = 0 SET list.Cianose = "Não"
		SET list.Dispneia = rs.%Get("Dispneia")
		IF list.Dispneia = 1 SET list.Dispneia = "Sim"
		IF list.Dispneia = 0 SET list.Dispneia = "Não"
		SET list.dorLombar = rs.%Get("dorLombar")
		IF list.dorLombar = 1 SET list.dorLombar = "Sim"
		IF list.dorLombar = 0 SET list.dorLombar = "Não"
		SET list.dorCabeca = rs.%Get("dorCabeca")
		IF list.dorCabeca = 1 SET list.dorCabeca = "Sim"
		IF list.dorCabeca = 0 SET list.dorCabeca = "Não"
		SET list.dorTorax = rs.%Get("dorTorax")
		IF list.dorTorax = 1 SET list.dorTorax = "Sim"
		IF list.dorTorax = 0 SET list.dorTorax = "Não"
		SET list.dorEritema = rs.%Get("dorEritema")
		IF list.dorEritema = 1 SET list.dorEritema = "Sim"
		IF list.dorEritema = 0 SET list.dorEritema = "Não"
		SET list.febre = rs.%Get("febre")
		IF list.febre = 1 SET list.febre = "Sim"
		IF list.febre = 0 SET list.febre = "Não"
		SET list.RTSinSintMaisPA = rs.%Get("RTSinSintMaisPA")
		SET list.Pulso = rs.%Get("Pulso")
		SET list.volumeUrinario = rs.%Get("volumeUrinario")
		IF list.volumeUrinario = 1 SET list.volumeUrinario = "Sim"
		IF list.volumeUrinario = 0 SET list.volumeUrinario = "Não"
		SET list.Outros = rs.%Get("Outros")
		IF list.Outros = 1 SET list.Outros = "Sim"
		IF list.Outros = 0 SET list.Outros = "Não"
		SET list.descricao = rs.%Get("descricao")
		SET list.RTSinSintPrurido = rs.%Get("RTSinSintPrurido")
		IF list.RTSinSintPrurido = 1 SET list.RTSinSintPrurido = "Sim"
		IF list.RTSinSintPrurido = 0 SET list.RTSinSintPrurido = "Não"
		SET list.Sangramentos = rs.%Get("Sangramentos")
		IF list.Sangramentos = 1 SET list.Sangramentos = "Sim"
		IF list.Sangramentos = 0 SET list.Sangramentos = "Não"
		SET list.Tremor = rs.%Get("Tremor")
		IF list.Tremor = 1 SET list.Tremor = "Sim"
		IF list.Tremor = 0 SET list.Tremor = "Não"
		SET list.urinaEscura = rs.%Get("urinaEscura")
		IF list.urinaEscura = 1 SET list.urinaEscura = "Sim"
		IF list.urinaEscura = 0 SET list.urinaEscura = "Não"
		SET list.Urticaria = rs.%Get("Urticaria")
		IF list.Urticaria = 1 SET list.Urticaria = "Sim"
		IF list.Urticaria = 0 SET list.Urticaria = "Não"
		SET list.Vomito = rs.%Get("Vomito")
		IF list.Vomito = 1 SET list.Vomito = "Sim"
		IF list.Vomito = 0 SET list.Vomito = "Não"
		SET list.TempoAproximado = rs.%Get("TempoAproximado")
		SET list.Componente = rs.%Get("Componente")
		SET list.TipoReacao = rs.%Get("TipoReacao")
		SET list.TransfusoesAnteriores = rs.%Get("TransfusoesAnteriores")
		IF list.TransfusoesAnteriores = 1 SET list.TransfusoesAnteriores = "Sim"
		IF list.TransfusoesAnteriores = 0 SET list.TransfusoesAnteriores = "Não"
		SET list.Volume = rs.%Get("Volume")
		SET list.Observacao = rs.%Get("Observacao")
		
		DO objRetorno.%Push(list) 
		
	}
	
	do objRetorno.%ToJSON()
	
	QUIT $$$OK]]></Implementation>
</Method>

<Method name="visualizarHistoricoMedicamentos">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	SET pPassagem = $GET(%request.Data("pPassagem",1))
	
	SET admissao = ""
	
	SET objRetorno = []
	
	SET codigoPaciente = $$$MEDAdmissionPatient($GET(^MEDAdmission(0,pPassagem,1)))
	
	SET query = "Select ProtEletronico.NumeroAdmisao As Admissao,"
	SET query = query _ " PEPTransfucional.PreMedicacao AS medicamentosAnteriores "
	SET query = query _ " FROM VARProntuarioEletronico AS ProtEletronico "
	SET query = query _ " LEFT JOIN SQLUser.VARPEPTransfuncional AS PEPTransfucional "
	SET query = query _ " ON ProtEletronico.Codigo = PEPTransfucional.CodigoProntuarioEletronic "
	SET query = query _ " Where ProtEletronico.Company = 0 and PEPTransfucional.Company = 0 "
	SET query = query _ " And ProtEletronico.Setor = 'TRANSFUSAOSANGUE' "
	SET query = query _ " And ProtEletronico.Paciente = '" _ codigoPaciente _ "'"
	SET query = query _ " ORDER BY ProtEletronico.NumeroAdmisao DESC"
	
	set rs= ##class(%SQL.Statement).%ExecDirect("",.query)
	
	WHILE(rs.%Next())
	{
		SET list = {}
		
		SET list.admissao = rs.%Get("Admissao")
		SET list.medicamentosAnteriores = rs.%Get("medicamentosAnteriores")
		
		DO objRetorno.%Push(list) 
		
	}
	
	do objRetorno.%ToJSON()
	
	QUIT $$$OK]]></Implementation>
</Method>

<Method name="visualizarHistoricoHemoterapia">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	SET pPassagem = $GET(%request.Data("pPassagem",1))
	
	SET admissao = ""
	
	SET objRetorno = []
	
	SET codigoPaciente = $$$MEDAdmissionPatient($GET(^MEDAdmission(0,pPassagem,1)))
	
	SET query = "SELECT ProtEletronico.NumeroAdmisao As Admissao, "
	SET query = query _ " PEPTransfucional.HemotAntecedentesAVC As antecedentesAVC, "
	SET query = query _ " PEPTransfucional.HemotAntecedentesDiabete As Diabete, "
	SET query = query _ " PEPTransfucional.HemotAntecedentesHepatic As Hepatica, "
	SET query = query _ " PEPTransfucional.HemotAntecedentesHiperte As Hipertensao, "
	SET query = query _ " PEPTransfucional.HemotAntecedentesICC As antecedentesICC, "
	SET query = query _ " PEPTransfucional.HemotAntecedentesIRC As antecedentesIRC, "
	SET query = query _ " PEPTransfucional.HemotAntecedentesInsufCo As InsufienciaCoroniana, "
	SET query = query _ " PEPTransfucional.HemotAntecedentesOutros As antecedentesOutros, "
	SET query = query _ " PEPTransfucional.HemotAntecedentesOutrosQ As antecedentesOutrosQ, "
	SET query = query _ " PEPTransfucional.HemotComponenteDeleucoti As ComponenteDeleucotizado, "
	SET query = query _ " PEPTransfucional.HemotComponenteIrradiado As Irradiado, "
	SET query = query _ " PEPTransfucional.HemotComponenteLavado As Lavado, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranDife As Difenidramida, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranDifeDose As DoseDifenidramida, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranDipi As Dipirona, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranDipiDose As DoseDipirona, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranFleb As Flebocortid, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranFlebDose As FlebocortidDose, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranFuro As Furosemide, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranFuroDose As FurosemideDose, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranOutr, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranOutrDesc, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranPara As Paracetamol, "
	SET query = query _ " PEPTransfucional.HemotMedPreTranParaDose As ParacetamolDose, "
	SET query = query _ " PEPTransfucional.HemotMedicacoes As Medicacoes, "
	SET query = query _ " PEPTransfucional.HemotReacoesTranPre As TransfusoesPrevias, "
	SET query = query _ " PEPTransfucional.HemotReacoesTranPreAle As Alergia, "
	SET query = query _ " PEPTransfucional.HemotReacoesTranPreFeb As Febril, "
	SET query = query _ " PEPTransfucional.HemotReacoesTranPreHem As Hemolitica, "
	SET query = query _ " PEPTransfucional.HemotReacoesTranPreOut As PreviaOutro, "
	SET query = query _ " PEPTransfucional.HemotReacoesTranPreOutDes As PreviaDescricao, "
	SET query = query _ " PEPTransfucional.HemotTransfusaoAnterior As transfusaoAnterior, "
	SET query = query _ " PEPTransfucional.HemotTransfusaoAnteriorO As transfusaoAnteriorLocal, "
	SET query = query _ " PEPTransfucional.HemotTransfusaoAnteriorQ As transfusaoAnteriorDia "
	SET query = query _ " FROM VARProntuarioEletronico AS ProtEletronico "
	SET query = query _ " LEFT JOIN SQLUser.VARPEPTransfuncional AS PEPTransfucional "
	SET query = query _ " ON ProtEletronico.Codigo = PEPTransfucional.CodigoProntuarioEletronic "
	SET query = query _ " Where ProtEletronico.Company = 0 and PEPTransfucional.Company = 0 "
	SET query = query _ " And  ProtEletronico.Paciente = '" _ codigoPaciente _ "'"
	SET query = query _ " ORDER BY ProtEletronico.NumeroAdmisao DESC"
	
	set rs= ##class(%SQL.Statement).%ExecDirect("",.query)
	
	WHILE(rs.%Next())
	{
		SET list = {}
		SET list.admissao = rs.%Get("Admissao")
		SET list.antecedentesAVC = rs.%Get("antecedentesAVC")
		IF list.antecedentesAVC = 0 SET list.antecedentesAVC = ""
		IF list.antecedentesAVC = 1 SET list.antecedentesAVC = "Sim"
		SET list.Diabete = rs.%Get("Diabete")
		IF list.Diabete = 0 SET list.Diabete = ""
		IF list.Diabete = 1 SET list.Diabete = "Sim"
		SET list.Hepatica = rs.%Get("Hepatica")
		IF list.Hepatica = 0 SET list.Hepatica = ""
		IF list.Hepatica = 1 SET list.Hepatica = "Sim"
		SET list.Hipertensao = rs.%Get("Hipertensao")
		IF list.Hipertensao = 0 SET list.Hipertensao = ""
		IF list.Hipertensao = 1 SET list.Hipertensao = "Sim"
		SET list.antecedentesICC = rs.%Get("antecedentesICC")
		IF list.antecedentesICC = 0 SET list.antecedentesICC = ""
		IF list.antecedentesICC = 1 SET list.antecedentesICC = "Sim"
		SET list.antecedentesIRC = rs.%Get("antecedentesIRC")
		IF list.antecedentesIRC = 0 SET list.antecedentesIRC = ""
		IF list.antecedentesIRC = 1 SET list.antecedentesIRC = "Sim"
		SET list.InsufienciaCoroniana = rs.%Get("InsufienciaCoroniana")
		IF list.InsufienciaCoroniana = 0 SET list.InsufienciaCoroniana = ""
		IF list.InsufienciaCoroniana = 1 SET list.InsufienciaCoroniana = "Sim"
		SET list.antecedentesOutros = rs.%Get("antecedentesOutros")
		IF list.antecedentesOutros = 0 SET list.InsufienciaCoroniana = ""
		IF list.antecedentesOutros = 1 SET list.InsufienciaCoroniana = "Sim"
		SET list.antecedentesOutrosQ = rs.%Get("antecedentesOutrosQ")
		SET list.ComponenteDeleucotizado = rs.%Get("ComponenteDeleucotizado")
		IF list.ComponenteDeleucotizado = 0 SET list.ComponenteDeleucotizado = ""
		IF list.ComponenteDeleucotizado = 1 SET list.ComponenteDeleucotizado = "Sim"
		SET list.Irradiado = rs.%Get("Irradiado")
		IF list.Irradiado = 0 SET list.Irradiado = ""
		IF list.Irradiado = 1 SET list.Irradiado = "Sim"
		SET list.Lavado = rs.%Get("Lavado")
		IF list.Lavado = 0 SET list.Lavado = ""
		IF list.Lavado = 1 SET list.Lavado = "Sim"
		SET list.Difenidramida = rs.%Get("Difenidramida")
		IF list.Difenidramida = 0 SET list.Difenidramida = ""
		IF list.Difenidramida = 1 SET list.Difenidramida = "Sim"
		SET list.DoseDifenidramida = rs.%Get("DoseDifenidramida")
		SET list.Dipirona = rs.%Get("Dipirona")
		IF list.Dipirona = 0 SET list.Dipirona = ""
		IF list.Dipirona = 1 SET list.Dipirona = "Sim"
		SET list.DoseDipirona = rs.%Get("DoseDipirona")
		SET list.Flebocortid = rs.%Get("Flebocortid")
		IF list.Flebocortid = 0 SET list.Flebocortid = ""
		IF list.Flebocortid = 1 SET list.Flebocortid = "Sim"
		SET list.FlebocortidDose = rs.%Get("FlebocortidDose")
		SET list.Furosemide = rs.%Get("Furosemide")
		IF list.Furosemide = 0 SET list.Furosemide = ""
		IF list.Furosemide = 1 SET list.Furosemide = "Sim"
		SET list.FurosemideDose = rs.%Get("FurosemideDose")
		SET list.HemotMedPreTranOutr = rs.%Get("HemotMedPreTranOutr")
		IF list.HemotMedPreTranOutr = 0 SET list.HemotMedPreTranOutr = ""
		IF list.HemotMedPreTranOutr = 1 SET list.HemotMedPreTranOutr = "Sim"
		SET list.HemotMedPreTranOutrDesc = rs.%Get("HemotMedPreTranOutrDesc")
		SET list.Paracetamol = rs.%Get("Paracetamol")
		IF list.Paracetamol = 0 SET list.Paracetamol = ""
		IF list.Paracetamol = 1 SET list.Paracetamol = "Sim"
		SET list.ParacetamolDose = rs.%Get("ParacetamolDose")
		SET list.Medicacoes = rs.%Get("Medicacoes")
		SET list.TransfusoesPrevias = rs.%Get("TransfusoesPrevias")
		IF list.TransfusoesPrevias = 0 SET list.TransfusoesPrevias = ""
		IF list.TransfusoesPrevias = 1 SET list.TransfusoesPrevias = "Sim"
		SET list.Alergia = rs.%Get("Alergia")
		IF list.Alergia = 0 SET list.Alergia = ""
		IF list.Alergia = 1 SET list.Alergia = "Sim"
		SET list.Febril = rs.%Get("Febril")
		IF list.Febril = 0 SET list.Febril = ""
		IF list.Febril = 1 SET list.Febril = "Sim"
		SET list.Hemolitica = rs.%Get("Hemolitica")
		IF list.Hemolitica = 0 SET list.Hemolitica = ""
		IF list.Hemolitica = 1 SET list.Hemolitica = "Sim"
		SET list.PreviaOutro = rs.%Get("PreviaOutro")
		IF list.PreviaOutro = 0 SET list.PreviaOutro = ""
		IF list.PreviaOutro = 1 SET list.PreviaOutro = "Sim"
		SET list.PreviaDescricao = rs.%Get("PreviaDescricao")
		SET list.transfusaoAnterior = rs.%Get("transfusaoAnterior")
		IF list.transfusaoAnterior = 0 SET list.transfusaoAnterior = ""
		IF list.transfusaoAnterior = 1 SET list.transfusaoAnterior = "Sim"
		SET list.transfusaoAnteriorLocal = rs.%Get("transfusaoAnteriorLocal")
		SET transfusaoAnteriorDiaSemConversao = rs.%Get("transfusaoAnteriorDia")
		IF transfusaoAnteriorDiaSemConversao = "" SET list.transfusaoAnteriorDia = ""
		IF transfusaoAnteriorDiaSemConversao '= "" SET list.transfusaoAnteriorDia = $ZDATE(transfusaoAnteriorDiaSemConversao,4)
		
		DO objRetorno.%Push(list)
		
	}
	
	do objRetorno.%ToJSON()
	
	QUIT $$$OK]]></Implementation>
</Method>

<Method name="ExibirHistoricoTalessemia">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	SET pPassagem = $GET(%request.Data("pPassagem",1))
	
	SET objRetorno = []
	
	SET codigoPaciente = $$$MEDAdmissionPatient($GET(^MEDAdmission(0,pPassagem,1)))
	
	SET query = "SELECT ProtEletronico.NumeroAdmisao As Admissao, ProtEletronico.CriadoEm AS Data, "
	SET query = query _ " PEPAnamnese.DadosPreTransfHb as HB, PEPAnamnese.DadosPreTransfHtc AS HTC, "
	SET query = query _ " PEPAnamnese.DadosPreTransfPeso AS Peso, PEPAnamnese.Transfusao, "
	SET query = query _ " PEPAnamnese.HTCBolsa, PEPAnamnese.TipoSanguineo, PEPAnamnese.PAI, "
	SET query = query _ " PEPAnamnese.IAC, PEPAnamnese.TCD, COUNT(PEPEtiqueta.Etiqueta) AS qtdBolsas, "
	SET query = query _ " SUM(PEPEtiqueta.Volume) As VolumeBolsa "
	SET query = query _ " FROM VARPEPTransfuncionalAnamnese AS PEPAnamnese LEFT JOIN "
	SET query = query _ " SQLUser.VARProntuarioEletronico AS ProtEletronico ON "
	SET query = query _ " ProtEletronico.Codigo = PEPAnamnese.CodigoProntuarioEletronic "
	SET query = query _ " LEFT JOIN VARPEPTransfuncionalEtiqueta AS PEPEtiqueta ON "
	SET query = query _ " PEPEtiqueta.CodigoProntuarioEletronic = PEPAnamnese.CodigoProntuarioEletronic "
	SET query = query _ " WHERE ProtEletronico.Company = 0 And "
	SET query = query _ " ProtEletronico.Setor = 'TRANSFUSAOSANGUE' And "
	SET query = query _ " ProtEletronico.Paciente = '" _ codigoPaciente _ "'"
	SET query = query _ " GROUP BY ProtEletronico.Codigo "
	SET query = query _ " ORDER BY ProtEletronico.NumeroAdmisao DESC"
	
	set rs= ##class(%SQL.Statement).%ExecDirect("",.query)
	WHILE(rs.%Next())
	{
		SET list = {}
		SET list.admissao = rs.%Get("Admissao")
		SET data = rs.%Get("Data")
		SET list.DataConvertida = $ZD(data,4)
		SET list.HB = rs.%Get("HB")
		SET list.HTC = rs.%Get("HTC")
		SET list.Peso = rs.%Get("Peso")
		SET list.Transfusao = rs.%Get("Transfusao")
		SET list.HTCBolsa = rs.%Get("HTCBolsa")
		SET list.TipoSanguineo = rs.%Get("TipoSanguineo")
		SET list.PAI = rs.%Get("PAI")
		IF list.PAI = 0 SET list.PAI = "Negativo"
		IF list.PAI = 1 SET list.PAI = "Positivo"
		SET list.IAC = rs.%Get("IAC")
		IF list.IAC = 0 SET list.IAC = "Negativo"
		IF list.IAC = 1 SET list.IAC = "Positivo"
		SET list.TCD = rs.%Get("TCD")
		IF list.TCD = 0 SET list.TCD = "Negativo"
		IF list.TCD = 1 SET list.TCD = "Positivo"
		SET list.qtdBolsas = rs.%Get("qtdBolsas")
		SET list.VolumeBolsa = rs.%Get("VolumeBolsa")
		
		DO objRetorno.%Push(list)
		
	}
	
	do objRetorno.%ToJSON()
	
	QUIT $$$OK]]></Implementation>
</Method>

<Method name="visualizarMedia">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	SET pPassagem = $GET(%request.Data("pPassagem",1))
	
	SET objRetorno = []
	
	SET codigoPaciente = $$$MEDAdmissionPatient($GET(^MEDAdmission(0,pPassagem,1)))
	
	SET query = "SELECT ProtEletronico.NumeroAdmisao As Admissao, "
	SET query = query _ " ProtEletronico.CriadoEm AS Data, "
	SET query = query _ " PEPAnamnese.DadosPreTransfHb as HBPaciente, "
 	SET query = query _ " COUNT(PEPEtiqueta.Etiqueta) AS mediaQtdBolsas, "
 	SET query = query _ " SUM(PEPEtiqueta.Volume) As mediaVolumeBolsa, "
 	SET query = query _ " PEPAnamnese.DadosPreTransfPeso AS pesoPaciente, "
 	SET query = query _ " $$DiferencaDias^VARSQL('" _ codigoPaciente_ "', ProtEletronico.CriadoEm) As Intervalo, "
 	SET query = query _ " nvl(PEPAnamnese.DadosPreTransfPeso,'') AS Peso, "
 	SET query = query _ " nvl(PEPAnamnese.DadosPreTransfHtc,'') AS HTC, "
 	SET query = query _ " nvl($$DiferencaDias^VARSQL('" _ codigoPaciente_ "',ProtEletronico.CriadoEm),'') As Intervalo "
 	SET query = query _ " FROM VARPEPTransfuncionalAnamnese AS PEPAnamnese "
 	SET query = query _ " LEFT JOIN SQLUser.VARProntuarioEletronico AS ProtEletronico "
 	SET query = query _ " ON ProtEletronico.Codigo = PEPAnamnese.CodigoProntuarioEletronic "
 	SET query = query _ " LEFT JOIN VARPEPTransfuncionalEtiqueta AS PEPEtiqueta ON "
 	SET query = query _ " PEPEtiqueta.CodigoProntuarioEletronic = PEPAnamnese.CodigoProntuarioEletronic "
 	SET query = query _ " WHERE ProtEletronico.Company = 0 And ProtEletronico.Setor = 'TRANSFUSAOSANGUE' "
 	SET query = query _ " And %upper(ProtEletronico.Paciente) = '" _ codigoPaciente _ "'"
 	SET query = query _ " GROUP BY ProtEletronico.Codigo "
 	SET query = query _ " ORDER BY ProtEletronico.CriadoEm DESC"
	
	set rs= ##class(%SQL.Statement).%ExecDirect("",.query)
	
	SET ^Kaue = query
	
	SET aData = ""
	
	Set (totBolsa, totVolGV, totHTC, totMediaML, totVolume, totPeso, totIntervalo, qtde) = 0  	

	WHILE(rs.%Next())
	{
		Set qtde = qtde + 1
		SET list = {}
		SET list.admissao = rs.%Get("Admissao")
		SET DataSemConversao = +rs.%Get("Data")
		SET list.Ano = $Piece($ZD(DataSemConversao, 4),"/",3)
		SET list.Data = $ZD(DataSemConversao, 4)
		SET list.HBPaciente = rs.%Get("HBPaciente")
		SET list.mediaQtdBolsas = rs.%Get("mediaQtdBolsas")
		SET list.mediaVolumeBolsa = rs.%Get("mediaVolumeBolsa")
		SET list.pesoPaciente = rs.%Get("pesoPaciente")
		SET list.Intervalo = rs.%Get("Intervalo")
		;SET list.Intervalo = $SELECT(aData = "": "", 1: +rs.%Get("Data") - aData )
		;SET aData = +rs.%Get("Data")
		
		Set totBolsa 		= totBolsa + rs.%Get("mediaQtdBolsas")
		Set totPeso 		= totPeso + rs.%Get("pesoPaciente")
		Set totHTC 			= totHTC + rs.%Get("HTC")
		Set totVolume 	= totVolume + rs.%Get("mediaVolumeBolsa")   	
		Set totIntervalo = totIntervalo + rs.%Get("Intervalo") 
		DO objRetorno.%Push(list)
		
	}
	If (qtde = 0) Set qtde = 1
	Set listRetorno = {}
	Set listRetorno.grid = objRetorno
	Set listRetorno.totBolsa = totBolsa
	Set listRetorno.totVolGV = (totPeso/qtde)*(totHTC/qtde)
	Set listRetorno.totHTC = totHTC/qtde
	Set listRetorno.totMediaML = $Select(+qtde>0&&(+totPeso>0):(totIntervalo/qtde)/(totPeso/qtde),1:0)
	Set listRetorno.totVolume = totVolume
	do listRetorno.%ToJSON()
	
	QUIT $$$OK]]></Implementation>
</Method>

<Method name="historicoReacao">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	Set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)

	Set arrayRetorno 	= []

	Set meuSQL = "Select Pront.*, Trans.* From SQLUser.VARProntuarioEletronico As Pront, "
	Set meuSQL = meuSQL _ "SQLUser.VARPEPTransfuncional As Trans "
	Set meuSQL = meuSQL _ "Where Pront.Company = 0 And Trans.Company = 0 "
	Set meuSQL = meuSQL _ "And Pront.Paciente = '"_codPaciente_"' "
	Set meuSQL = meuSQL _ "And Trans.CodigoProntuarioEletronic = Pront.Codigo "
	Set meuSQL = meuSQL _ "Order By Pront.CriadoEm Desc "
	Set rSet 	 = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
	
	While(rSet.%Next()){
		Set list = {}
		Set list.admissao = rSet.%Get("NumeroAdmisao")
		Set list.dataHora = $ZDateTime(rSet.%Get("CriadoEm"),4,2)
		Set list.hTTransfAnt = $Select(rSet.%Get("RTTransfusoesAnteriores")=1:"Sim",rSet.%Get("RTTransfusoesAnteriores")=0:"Não",1:"")
		Set list.hTTempoApro = rSet.%Get("RTTempoAproximado")
		Set list.hTReacaoAnt = $Select(rSet.%Get("RTReacaoTransfusionaisA")=1:"Sim",rSet.%Get("RTReacaoTransfusionaisA")=0:"Não",1:"")
		Set list.hTTipoComp = rSet.%Get("RTTipoComponente")
		Set list.hTTipoReacao = rSet.%Get("RTTipoDeReacao")
		Set list.rTData = $Select(rSet.%Get("RTData")="":"",1:$ZDate(rSet.%Get("RTData"),4))
		Set list.rTHora = rSet.%Get("RTHora")
		Set list.rTComponente = rSet.%Get("RTComponente")
		Set list.rTVolume = rSet.%Get("RTVolume")
		Set list.rTDeleucotizado = $Select(rSet.%Get("RTDeleucotizado")=1:"Sim",rSet.%Get("RTDeleucotizado")=0:"Não",1:"")
		Set list.rTIrradiado = $Select(rSet.%Get("RTIrradiado")=1:"Sim",rSet.%Get("RTIrradiado")=0:"Não",1:"")
		Set list.rTLavado = $Select(rSet.%Get("RTLavado")=1:"Sim",rSet.%Get("RTLavado")=0:"Não",1:"")

		Set list.ssPulso = rSet.%Get("RTSinSintMaisPulso")
		Set list.ssPressaoArterial = $Extract(rSet.%Get("RTSinSintMaisPA"),1,3)_"/"_$Extract(rSet.%Get("RTSinSintMaisPA"),4,6)
		Set list.ssFebre = $Select(rSet.%Get("RTSinSintFebre")=1:"Sim",1:"Não")
		Set list.ssVomito = $Select(rSet.%Get("RTSinSintVomito")=1:"Sim",1:"Não")
		Set list.ssDorTorax = $Select(rSet.%Get("RTSinSintDornoTorax")=1:"Sim",1:"Não")
		Set list.ssSangramentos = $Select(rSet.%Get("RTSinSintSangramentos")=1:"Sim",1:"Não")
		Set list.ssCalafrios = $Select(rSet.%Get("RTSinSintCalafrios")=1:"Sim",1:"Não")
		Set list.ssCianose = $Select(rSet.%Get("RTSinSintCianose")=1:"Sim",1:"Não")
		Set list.ssUrticaria = $Select(rSet.%Get("RTSinSintUrticaria")=1:"Sim",1:"Não")
		Set list.ssUrinaEscura = $Select(rSet.%Get("RTSinSintUrinaEscura")=1:"Sim",1:"Não")
		Set list.ssDispneia = $Select(rSet.%Get("RTSinSintDispneia")=1:"Sim",1:"Não")
		Set list.ssDorLombar = $Select(rSet.%Get("RTSinSintDorLombar")=1:"Sim",1:"Não")
		Set list.ssEritema = $Select(rSet.%Get("RTSinSintEritema")=1:"Sim",1:"Não")
		Set list.ssVolUrinario = $Select(rSet.%Get("RTSinSintMenosVolUrinario")=1:"Sim",1:"Não")
		Set list.ssTremor = $Select(rSet.%Get("RTSinSintTremor")=1:"Sim",1:"Não")
		Set list.ssDorCabeca = $Select(rSet.%Get("RTSinSintDordeCabeca")=1:"Sim",1:"Não")
		Set list.ssPrurido = $Select(rSet.%Get("RTSinSintPrurido")=1:"Sim",1:"Não")
		Set list.ssOutros = $Select(rSet.%Get("RTSinSintOutros")=1:"Sim",1:"Não")
		Set list.ssDescricao = rSet.%Get("RTSinSintOutrosDescrica")
		;
		Do arrayRetorno.%Push(list)
	}
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="historicoAnamnese">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	Set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)

	Set arrayRetorno 	= []

	Set sql = "SELECT * "
					_ "FROM SQLUser.VARProntuarioEletronico As P "
					_ "INNER JOIN SQLUser.VARPEPTransfuncionalAnamnese AS A ON A.CodigoProntuarioEletronic = P.Codigo "
					_ "WHERE A.Company = 0 AND P.Company = 0 And P.Paciente = '"_codPaciente_"' "
					_ "ORDER BY P.CriadoEm DESC"
	
	Set rSet 	 = ##class(%SQL.Statement).%ExecDirect("",sql)
	
	While(rSet.%Next()){
		Set list = {}
		Set list.admissao = rSet.%Get("NumeroAdmisao")
		Set list.dataHora = $ZDateTime(rSet.%Get("CriadoEm"),4,2)
		Set list.ComorbidadesDM = $Select(rSet.%Get("ComorbidadesDM")=1:"Sim",1:"")
		Set list.ComorbidadesICC = $Select(rSet.%Get("ComorbidadesICC")=1:"Sim",1:"")
		Set list.ComorbidadesHAS = $Select(rSet.%Get("ComorbidadesHAS")=1:"Sim",1:"")
		Set list.ComorbidadesAVC = $Select(rSet.%Get("ComorbidadesAVC")=1:"Sim",1:"")
		Set list.ComorbidadesIRC = $Select(rSet.%Get("ComorbidadesIRC")=1:"Sim",1:"")
		Set list.ComorbidadesCondronariopa = $Select(rSet.%Get("ComorbidadesCondronariopa")=1:"Sim",1:"")
		Set list.ComorbidadesOutros = rSet.%Get("ComorbidadesOutros")
		
		Set list.InfusaoVeiaPeriferica = $Select(rSet.%Get("InfusaoVeiaPeriferica")=1:"Sim",1:"")
		Set list.InfusaoPortaCath = $Select(rSet.%Get("InfusaoPortaCath")=1:"Sim",1:"")
		Set list.InfusaoPICC = $Select(rSet.%Get("InfusaoPICC")=1:"Sim",1:"")
		Set list.InfusaoLocalizacao = rSet.%Get("InfusaoLocalizacao")
		
		;Set list.molestias = "" 
		Set list.AlergiaAQue = rSet.%Get("AlergiaAQue")
		Set list.FluxoCateter = $Select(rSet.%Get("FluxoCateter")=1:"Ótimo",rSet.%Get("FluxoCateter")=0:"Ruim",1:"")
		Set list.FinalizacaoCom = $Select(rSet.%Get("FinalizacaoCom")=1:"Salinização",rSet.%Get("FinalizacaoCom")=0:"Heparinização",1:"")
		Set list.IncidenteQual = rSet.%Get("IncidenteQual")
		
		Set list.RiscodeFlebite = $Select(rSet.%Get("RiscodeFlebite")=1:"Sim",1:"")
		Set list.DorDescricao = rSet.%Get("DorDescricao")
		Set list.MedoApreensaoDescricao = rSet.%Get("MedoApreensaoDescricao")
		Set list.Neuropsiquiatrico = rSet.%Get("Neuropsiquiatrico")
		Set list.RitmoCardiaco = rSet.%Get("RitmoCardiaco")
		Set list.PadraoRespiratorio = rSet.%Get("PadraoRespiratorio")
		Set list.PeleeMucosa = rSet.%Get("PeleeMucosa")
		Set list.RedeVenosoPrejDescricao = rSet.%Get("RedeVenosoPrejDescricao")
		Set list.IntSocPejudDescricao = rSet.%Get("IntSocPejudDescricao")
		
		Set list.DadosPreTransfPeso = rSet.%Get("DadosPreTransfPeso")
		Set list.DadosPreTransfHtc = rSet.%Get("DadosPreTransfHtc")
		Set list.DadosPreTransfHb = rSet.%Get("DadosPreTransfHb")
		Set list.DadosPreTransfPlaquetas = rSet.%Get("DadosPreTransfPlaquetas")
		Set list.OrientacoesaEnfermagem = rSet.%Get("OrientacoesaEnfermagem")
		
		
		Do arrayRetorno.%Push(list)
	}
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="historicoDadosVitais">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	Set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)

	Set arrayRetorno 	= []

	Set sql = "SELECT * "
					_ "FROM SQLUser.VARProntuarioEletronico As P "
					_ "INNER JOIN SQLUser.VARPEPTransfuncionalEtiqueta AS E ON E.CodigoProntuarioEletronic = P.Codigo "
					_ "WHERE E.Company = 0 AND P.Company = 0 And P.Paciente = '"_codPaciente_"' "
					_ "ORDER BY P.CriadoEm DESC"
	
	Set rSet 	 = ##class(%SQL.Statement).%ExecDirect("",sql)
	
	While(rSet.%Next()){
		Set list = {}
		Set list.admissao = rSet.%Get("NumeroAdmisao")
		Set list.dataHora = $ZDateTime(rSet.%Get("CriadoEm"),4,2)
		
		set dataPreparo = rSet.%Get("DataPreparo")
		set horaPreparo = rSet.%Get("HoraPreparo")
		
		if dataPreparo'="", horaPreparo'="" {
			Set list.dataPreparo = $Select(dataPreparo'="":$zdate(dataPreparo,4),1:"")_" "_$Select(horaPreparo'="":$ztime(horaPreparo,2),1:"")
		}
		elseif (dataPreparo'="") {
			Set list.dataPreparo = $Select(dataPreparo'="":$zdate(dataPreparo,4),1:"")
		} 
		else {
			Set list.dataPreparo = ""
		}
		
		Set list.etiqueta = rSet.%Get("Etiqueta")
		Set list.volume = rSet.%Get("Volume")
		Set list.hemocomponentes = rSet.%Get("Hemocomponentes")
		Set list.nBolsa = rSet.%Get("NodaBolsa")
		Set list.aboRH = rSet.%Get("AboRH")
		Set list.aboRHPaciente = rSet.%Get("AboRHPaciente")
		Set list.testeComp = rSet.%Get("TestedeCompatibilidade")
		Set list.responsavelPreparo = rSet.%Get("ResponsavelpeloPreparo")
		Set list.responsavelInfusao = rSet.%Get("Responsavelpelainfusao")
		
		if list.responsavelInfusao'="" {
			Set objMEDProvider = $get(^MEDProvider(0,list.responsavelInfusao,1))
			Set list.responsavelInfusao = $$$MEDProviderName(objMEDProvider)
		}
		
		Set list.preMedicacao = rSet.%Get("PreMedicacao")
		Set list.status = $Select(rSet.%Get("Status")=1:"Sim",1:"")
		Set list.medicoSuspenderMedicament = rSet.%Get("MedicoSuspenderMedicament")
		
		Do arrayRetorno.%Push(list)
	}
	
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="historicoPreTransfusional">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	Set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)

	Set arrayRetorno 	= []

	Set sql = "SELECT P.NumeroAdmisao,P.CriadoEm,A.* "
					_ "FROM SQLUser.VARProntuarioEletronico As P "
					_ "INNER JOIN SQLUser.VARPEPTransfuncionalAnamnese AS A ON A.CodigoProntuarioEletronic = P.Codigo "
					_ "WHERE A.Company = 0 AND P.Company = 0 And P.Paciente = '"_codPaciente_"' "
					_ "ORDER BY P.CriadoEm DESC"
	
	Set rSet 	 = ##class(%SQL.Statement).%ExecDirect("",sql)
	
	While(rSet.%Next()){
		Set list = {}
		Set list.admissao = rSet.%Get("NumeroAdmisao")
		Set list.dataHora = $ZDateTime(rSet.%Get("CriadoEm"),4,2)
		
		Set list.dadosPreTransfPeso = rSet.%Get("DadosPreTransfPeso")
		Set list.dadosPreTransfHtc = rSet.%Get("DadosPreTransfHtc")
		Set list.dadosPreTransfHb = rSet.%Get("DadosPreTransfHb")
		Set list.dadosPreTransfPlaquetas = rSet.%Get("DadosPreTransfPlaquetas")
		
		Do arrayRetorno.%Push(list)
	}
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="recebeFileTCLE">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
	
	Set data = {}
	Set data.status = 0
	
	Set prontuario = $Get(%request.Data("pCodProntuario",1))
	Set file = $Get(%request.MimeData("fileTCLE",1))
	
	if file {
		
		set dname = $$GetDiretorioFisico^VARBRDiretorios(0,16)
			
		if $$$isWINDOWS
		{
			if ($extract(dname, $length(dname)) '= "\") set dname = dname _ "\"
		}
		else
		{
			if ($extract(dname, $length(dname)) '= "/") set dname = dname _ "/"
		}
			
		// checa e cria se não houver, o diretorio
		if ('##class(%File).DirectoryExists(dname)) {
			do ##class(%File).CreateDirectoryChain(dname)
		}
		
		//nome do arquivo
		set fname = file.FileName
		set fname = $piece(fname, "\", $length(fname, "\"))
		;Troca os espaços por underline
		set fname = $translate(fname, " ", "_")
		
		// alterado nome do arquivo 
		set $p(fname,".",1) = "TCLE_" _ prontuario
		
		set caminhoFile = dname _ fname
		if $$$isWINDOWS set caminhoFile = $replace(caminhoFile,"/","\")
		else  set caminhoFile = $replace(caminhoFile,"\","/")

		// remove arquivo existente com mesmo nome
		set strStatus = ##class(%Library.File).Delete(caminhoFile)

		Set stream = ##class(%FileBinaryStream).%New()
		Set stream.Filename = caminhoFile

		do stream.CopyFrom(file)
		do stream.Flush()
		do stream.SaveStream()
		
		set dirVirtual = $$GetDiretorioVirtual^VARBRDiretorios(0,16)_"/"
		
		set objPEPTrans = $get(^VARPEPTransfuncional(0, prontuario, 1))
		set $$$VARPEPTransfuncionalHemotTCLE(objPEPTrans) = dirVirtual _ fname
		set strStatus	=	$$$Save("VARPEPTransfuncional", prontuario, objPEPTrans, $$$YES)
		
		Set data.fileName = dirVirtual _ fname
		Set data.status = strStatus
	}
	
	do data.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>
</Class>
</Export>