<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="Cache" ts="2001-01-01 00:00:00">
<Class name="VAR.CSP.VARContrAtendQuimioterapico">
<ClassType/>
<IncludeCode>WWWConst,MEDConst,VARConst,INConst</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	do ^WWWVAR
	;	
	set method = $get(%request.Data("method",1))
	xecute "do .."_method_"()"
	quit $$$OK]]></Implementation>
</Method>

<Method name="RecuperaGraduacaoToxicidade">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodigo</FormalSpec>
<Implementation><![CDATA[	Set descricao = ""
	
	Quit:pCodigo="" descricao
	
	If ($Data(^VARPARA(0,"GRADUACAOTOXICIDADE","PT",pCodigo))) {
		Set descricao = $Piece(^VARPARA(0,"GRADUACAOTOXICIDADE","PT",pCodigo,1),"~",1)
	}
	
	Quit descricao]]></Implementation>
</Method>

<Method name="GetGraduacaoToxicidade">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	Set codSintomas = $Get(%request.Data("codSintomas",1))
	
	Set meuSQL = "Select Sequencia, Grau From SQLuser.VARGraduacaoToxicidade Where Company = 0 And Doenca = '"_codSintomas_"'"
	Set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",meuSQL)
	Set objRetorno 	= []
	
	While(rSet.%Next()){

		Set listRetorno = {}
		Set listRetorno.sequencia = rSet.%Get("Sequencia")
		Set listRetorno.grau = rSet.%Get("Grau")
		Do objRetorno.%Push(listRetorno)
	
	}
	Do objRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="RecuperaGrauGraduacaoToxicidade">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodigo</FormalSpec>
<Implementation><![CDATA[	Set descricao = ""
	
	Quit:pCodigo="" descricao
	
	If ($Data(^VARGraduacaoToxicidade(0,pCodigo))) {
		Set descricao = $Piece(^VARGraduacaoToxicidade(0,pCodigo,1),"~",2)
	}
	
	Quit descricao]]></Implementation>
</Method>

<Method name="GetAvaliacaoToxicidade">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	;;
	if '$data(^VARPEPQuimioterapiaAvaToxicidade(0,pCodProntuario)){
		set rs = ##class(%SQL.Statement).%ExecDirect("","Select SearchWord from VARPARA where Company=0 and parametername='GRADUACAOTOXICIDADE' and language1='PT' order by text")
		set sequencia = 1
		while(rs.%Next()){
			set CodigodaDoenca = rs.%Get("SearchWord")
			set obj 	= ""
			set $$$VARPEPQuimioterapiaAvaToxicidadeCodigodaDoenca(obj) = CodigodaDoenca
			set strSave = $$$Save("VARPEPQuimioterapiaAvaToxicidade",pCodProntuario_","_$increment(sequencia),obj,$$$YES)
		}

	}
	;;
	set contador = 0
	set meuSQL($increment(contador))	= "Select CodigodaDoenca,Sequencia, Toxicidade, Medicacao,PossuiToxicidade"
	set meuSQL($increment(contador))	= "From sqlUSER.VARPEPQuimioterapiaAvaToxicidade"
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"	
	
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		
		set codDoenca = rSet.%Get("CodigodaDoenca")
		set codToxicidade = rSet.%Get("Toxicidade")
		set PossuiToxicidade = rSet.%Get("PossuiToxicidade")
		Set descToxicidade = ..RecuperaGrauGraduacaoToxicidade(codToxicidade)
		if codDoenca=""{
			If (codToxicidade '= "") {
				Set codDoenca = $Piece(^VARGraduacaoToxicidade(0,codToxicidade,1),"~",1)
			}
		}
		Set descDoenca = ..RecuperaGraduacaoToxicidade(codDoenca)
		
		set list = {}
		set list.sequencia			= rSet.%Get("Sequencia")
		set list.toxicidade 		= codDoenca
		set list.toxicidadeDesc 	= descDoenca
		set list.grau				= codToxicidade
		set list.grauDesc			= descToxicidade
		set list.possuiToxicidade	= +PossuiToxicidade
		set list.medicacao 			= rSet.%Get("Medicacao")
		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmAvaliacaoToxicidade">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	set novo = 0
	If (pSequencia = "") {
		set pSequencia = $Order(^VARPEPQuimioterapiaAvaToxicidade(YM, pCodProntuario, ""),-1) + 1
		set novo = 1
	}
	
	set objAvaToxicidade = $get(^VARPEPQuimioterapiaAvaToxicidade(YM, pCodProntuario, pSequencia, 1))
	if novo=1 set $$$VARPEPQuimioterapiaAvaToxicidadePossuiToxicidade(objAvaToxicidade) = 1
	set index = "" 
	for {
		set index = $order(pDados(index)) 
		quit:index=""
		
		set coluna	= $piece(pDados(index),"~",1)
		set valor		= $piece(pDados(index),"~",2)
		if (coluna = "toxicidade") set $$$VARPEPQuimioterapiaAvaToxicidadeCodigodaDoenca(objAvaToxicidade) = valor
		if (coluna = "grau") set $$$VARPEPQuimioterapiaAvaToxicidadeToxicidade(objAvaToxicidade) = valor
		if (coluna = "medicacao") set $$$VARPEPQuimioterapiaAvaToxicidadeMedicacao(objAvaToxicidade) = valor
		if (coluna = "possuiToxicidade") {
			if valor="true" set valor=1
			else  set valor=0
			set $$$VARPEPQuimioterapiaAvaToxicidadePossuiToxicidade(objAvaToxicidade) = valor
		}
		
	}

	quit $$$Save("VARPEPQuimioterapiaAvaToxicidade",pCodProntuario_$$$COMMA_pSequencia,objAvaToxicidade,$$$YES)]]></Implementation>
</Method>

<Method name="ExcluirAvaliacaoToxicidade">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	quit $$$Kill("VARPEPQuimioterapiaAvaToxicidade",pCodProntuario_$$$COMMA_pSequencia)]]></Implementation>
</Method>

<Method name="GetInteracaoMedicamentosa">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select Sequencia, Droga, Dose, ViaAdm, Frequencia, Motivo, Interacao, Conduta "
	set meuSQL($increment(contador))	= "From SQLUser.VARPEPQuimioterapiaIntMedic"
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"	
	
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		
		set codProduto 	= rSet.%Get("Droga")
		set descDroga		= $$SQLGetDescricaoProduto^VARSQL(codProduto)
		
		set list = {}
		set list.sequencia	= rSet.%Get("Sequencia")
		set list.droga 			= codProduto
		set list.descDroga 	= "("_codProduto_") "_descDroga
		set list.dose 			= rSet.%Get("Dose")
		set list.viaAdm 		= rSet.%Get("ViaAdm")
		set list.frequencia = rSet.%Get("Frequencia")
		set list.motivo 		= rSet.%Get("Motivo")
		set list.interacao 	= rSet.%Get("Interacao")
		set list.conduta 		= rSet.%Get("Conduta")
		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmInteracaoMedicamentosa">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	
	if (pSequencia = "") {
		set pSequencia = $$GetNextNumber^COMUtils("VARPEPQuimioterapiaIntMedic","")
	}
	
	set objIntMedic = $get(^VARPEPQuimioterapiaIntMedic(YM, pCodProntuario, pSequencia, 1))

	set index = "" 
	for {
		set index = $order(pDados(index)) 
		quit:index=""
		
		set coluna	= $piece(pDados(index),"~",1)
		set valor		= $piece(pDados(index),"~",2)

		if (coluna = "droga") set $$$VARPEPQuimioterapiaIntMedicDroga(objIntMedic) = valor
		if (coluna = "dose") set $$$VARPEPQuimioterapiaIntMedicDose(objIntMedic) = valor
		if (coluna = "viaAdm") set $$$VARPEPQuimioterapiaIntMedicViaAdm(objIntMedic) = valor
		if (coluna = "frequencia") set $$$VARPEPQuimioterapiaIntMedicFrequencia(objIntMedic) = valor
		if (coluna = "motivo") set $$$VARPEPQuimioterapiaIntMedicMotivo(objIntMedic) = valor
		if (coluna = "interacao") set $$$VARPEPQuimioterapiaIntMedicInteracao(objIntMedic) = valor
		if (coluna = "conduta") set $$$VARPEPQuimioterapiaIntMedicConduta(objIntMedic) = valor

	}

	quit $$$Save("VARPEPQuimioterapiaIntMedic",pCodProntuario_$$$COMMA_pSequencia,objIntMedic,$$$YES)]]></Implementation>
</Method>

<Method name="ExcluirInteracaoMedicamentosa">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	quit $$$Kill("VARPEPQuimioterapiaIntMedic",pCodProntuario_$$$COMMA_pSequencia)]]></Implementation>
</Method>

<Method name="GetLeitos">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodSala,pCodLeito</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	
	if pCodSala = "" quit $$$OK
	
	set objSala  = $get(^VARSalasAtendimentos(YM, pCodSala, 1))
	set qtdeLeito	= $$$VARSalasAtendimentosQtdeLeito(objSala)

	set objRetorno = []
	
	for leito=1:1:qtdeLeito {
		set objLeito = $get(^VARPEPLeitoAtendimento(YM, pCodSala, leito, 1))
		if (pCodLeito'=leito && (objLeito '= "")) continue
		
		set list = {}
		set list.Codigo = leito
		set list.Descricao = "Leito "_leito
		
		do objRetorno.%Push(list)
	}

	quit objRetorno.%ToJSON()]]></Implementation>
</Method>

<Method name="GetProntuario">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set listRetorno = {}
	
	set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
	set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	if (objProntuario '= "") {
		set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)
		set criadoEm				= $$$VARProntuarioEletronicoCriadoEm(objProntuario)
		set numAdmissao			= $$$VARProntuarioEletronicoNumeroAdmisao(objProntuario)
		;
		set objMEDAdmission	= $get(^MEDAdmission(YM, numAdmissao, 1))
		;
		If ($$$MEDAdmissionPatient(objMEDAdmission) '= codPaciente) {
			set codPaciente		= $$$MEDAdmissionPatient(objMEDAdmission)
		}
		;
		Set objMEDPatient = $Get(^MEDPatient(0, codPaciente, 1))
		;
		Set numProntuario 	= $$SQLGetPatientProntuario^VARSQL(codPaciente)
		;
		set nomePaciente		= $$SQLGetPatientName^VARSQL(codPaciente)
		set dataNascimento	= $$SQLGetPatientDataNascimento^VARSQL(codPaciente)
		set qtdeAnos				= $$SQLGetPatientAge^VARSQL(dataNascimento)
		set qtdeMeses				= $$SQLGetPatientMonth^VARSQL(dataNascimento)
		set sexo						= $$SQLGetSexoPaciente^VARSQL(codPaciente)
		;
		set codSala					= $$$MEDAdmissionRoom(objMEDAdmission)			
		set codLeito				= $$$MEDAdmissionBed(objMEDAdmission)
		;
		set (descSala, dataSourceLeito) = ""
		If (codSala '= "") {
			set objSala					= $get(^VARSalasAtendimentos(YM,codSala,1))
			set descSala 				= $$$VARSalasAtendimentosNome(objSala)
			;
			set dataSourceLeito = ..GetLeitos(codSala, codLeito)
		}
		;
		set objPEPQuim 				= $get(^VARPEPQuimioterapia(YM, pCodProntuario, 1))
		set protocoloEsquema 	= $$$VARPEPQuimioterapiaProtocoloEsquema(objPEPQuim)
		set numCiclo 					= $$$VARPEPQuimioterapiaNumCiclo(objPEPQuim)
		set diaCiclo 					= $$$VARPEPQuimioterapiaDiaCiclo(objPEPQuim)
		set diagnostico 			= $$$VARPEPQuimioterapiaDiagnostico(objPEPQuim)
		set medicoExterno 		= $$$VARPEPQuimioterapiaMedicoExterno(objPEPQuim)
		set dataHoraAssinatura 	= $$$VARPEPQuimioterapiaDataHoraAssinatura(objPEPQuim)
		set assinatura					= $$$VARPEPQuimioterapiaUsuarioAssinatura(objPEPQuim)
		set dispensacao 			= $$$VARPEPQuimioterapiaDispensacao(objPEPQuim)
		set observadoPor 			= $$$VARPEPQuimioterapiaObservadoPor(objPEPQuim)
		set intercorrencia 		= $$$VARPEPQuimioterapiaIntercorrencia(objPEPQuim)
		set intercorrenciaQual= $$$VARPEPQuimioterapiaIntercorrenciaQual(objPEPQuim)
		set outrasObservacoes = $$$VARPEPQuimioterapiaOutrasObservacoes(objPEPQuim)
		set observacoesEnfermagem = $$$VARPEPQuimioterapiaObservacoesEnfermagem(objPEPQuim)
		set prescAmbHb 				= $$$VARPEPQuimioterapiaPrescricaoHB(objPEPQuim)
		set prescAmbHtc 			= $$$VARPEPQuimioterapiaPrescricaoHTC(objPEPQuim)
		set prescAmbPlaq 			= $$$VARPEPQuimioterapiaPrescricaoPlaqueta(objPEPQuim)
		set prescAmbLeuc 			= $$$VARPEPQuimioterapiaPrescricaoLeuc(objPEPQuim)
		set prescAmbNeutrof 	= $$$VARPEPQuimioterapiaPrescricaoNeotrof(objPEPQuim)
		set prescAmbMedido 		= $$$VARPEPQuimioterapiaPrescricaoMedico(objPEPQuim)
		set prescAmbBombainf 	= $$$VARPEPQuimioterapiaUsoBombaInfusao(objPEPQuim)
		;
		set prescAmbIntervalo 	= $$$VARPEPQuimioterapiaPrescricaoIntervalo(objPEPQuim)
		set prescAmbNCiclo 			= $$$VARPEPQuimioterapiaPrescricaoNoCicloProposto(objPEPQuim)
		set prescAmbInicioAplic = $$$VARPEPQuimioterapiaPrescricaoIniciodaAplicac(objPEPQuim)
		set prescAmbDias 				= $$$VARPEPQuimioterapiaPrescricaoDias(objPEPQuim)
		;
		set aplicMedicamentosPerdSa 		= $$$VARPEPQuimioterapiaAplicMedicamentosPerdSa(objPEPQuim)
		set aplicMedicamentosBariatr 		= $$$VARPEPQuimioterapiaAplicMedicamentosBariatr(objPEPQuim)
		set aplicMedicamentosOutrosD509 = $$$VARPEPQuimioterapiaAplicMedicamentosOutrosD509(objPEPQuim)
		set aplicMedicamentosOutros 		= $$$VARPEPQuimioterapiaAplicMedicamentosOutros(objPEPQuim)
		set aplicMedicamentosAlerta			= $$$VARPEPQuimioterapiaAplicMedicamentosAlerta(objPEPQuim)
		set aplicMedicamentosDiagnosticoSecundario = $$$VARPEPQuimioterapiaAplicMedicamentosDiagnosticoSecundario(objPEPQuim)
		;
		set nomeMedicamento = $$$VARPEPQuimioterapiaReacaoMedicamento(objPEPQuim)
		set nomeFabriacente = $$$VARPEPQuimioterapiaReacaoFabricante(objPEPQuim)
		set dataInicio = $$$VARPEPQuimioterapiaReacaoDataInicio(objPEPQuim)
		set dataAparecimento = $$$VARPEPQuimioterapiaReacaoDataAparecimento(objPEPQuim)
		set reacaoMedLote = $$$VARPEPQuimioterapiaReacaoLote(objPEPQuim)
		set reacaoMedValidad = $$$VARPEPQuimioterapiaReacaoValidade(objPEPQuim)
		set reacaoMedPeso = $$$VARPEPQuimioterapiaReacaoPeso(objPEPQuim)
		set reacaoMedAlt = $$$VARPEPQuimioterapiaReacaoAlt(objPEPQuim)
		set medicacoesAntes = $$$VARPEPQuimioterapiaReacaoJaRecebeuMedicament(objPEPQuim)
		set medicacoesAntesFreq = $$$VARPEPQuimioterapiaReacaoFrequenciaMedicamen(objPEPQuim)
		set medicacosAntesFreqEsp = $$$VARPEPQuimioterapiaReacaoFrequenciaEspecificacao(objPEPQuim)
		set gotejamento = $$$VARPEPQuimioterapiaReacaoModAplicInfusao(objPEPQuim)
		set diluicao1 = $$$VARPEPQuimioterapiaReacaoModAplicInfusaoDil1(objPEPQuim)
		set diluicao2 = $$$VARPEPQuimioterapiaReacaoModAplicInfusaoDil2(objPEPQuim)
		set gotejamentoSF = $$$VARPEPQuimioterapiaReacaoModAplicInfusaoSF(objPEPQuim)
		set bolus = $$$VARPEPQuimioterapiaReacaoModAplicInjecao(objPEPQuim)
		set bolusDuracao = $$$VARPEPQuimioterapiaReacaoModAplicInjecaoD(objPEPQuim)
		set intramoscular = $$$VARPEPQuimioterapiaReacaoModAplicIntra(objPEPQuim)
		set intramoscularDuracao = $$$VARPEPQuimioterapiaReacaoModAplicIntraD(objPEPQuim)
		set oral = $$$VARPEPQuimioterapiaReacaoModAplicOral(objPEPQuim)
		set oralPosologia = $$$VARPEPQuimioterapiaReacaoModAplicOralPosologia(objPEPQuim)
		set ingestao = $$$VARPEPQuimioterapiaReacaoIngestao(objPEPQuim)
		set sinaisSintomas = $$$VARPEPQuimioterapiaReacaoSinaiseSintomas(objPEPQuim)
		set irritante = $$$VARPEPQuimioterapiaReacaoIncidenteIrritante(objPEPQuim)
		set vesicante = $$$VARPEPQuimioterapiaReacaoIncidenteVesicante(objPEPQuim)
		set incidenteLocalNao = $$$VARPEPQuimioterapiaReacaoIncidenteExtravasam(objPEPQuim)
		set incidenteLocal = $$$VARPEPQuimioterapiaReacaoIncidenteDescricao(objPEPQuim)
		set compressaQuente = $$$VARPEPQuimioterapiaReacaoCompressaQuente(objPEPQuim)
		set compressaFria = $$$VARPEPQuimioterapiaReacaoCompressaFria(objPEPQuim)
		set compressaNao = $$$VARPEPQuimioterapiaReacaoCompressaNaoUtiliza(objPEPQuim)
		set condutaAcompanhamento = $$$VARPEPQuimioterapiaReacaoCondutaeAcompanhame(objPEPQuim)
		set conclusao = $$$VARPEPQuimioterapiaReacaoConclusao(objPEPQuim)
		set historico = $$$VARPEPQuimioterapiaReacaoHistorico(objPEPQuim)
		set medico = $$$VARPEPQuimioterapiaReacaoMedico(objPEPQuim)
		;
		set objPEPQuimAnamnese = $get(^VARPEPQuimioterapiaAnamnese(YM, pCodProntuario, 1))
		set cid = $$$VARPEPQuimioterapiaAnamneseCID(objPEPQuimAnamnese)
		set comorbidades = $$$VARPEPQuimioterapiaAnamneseComorbidades(objPEPQuimAnamnese)
		set comorbidadesDM = $$$VARPEPQuimioterapiaAnamneseComorbidadesDM(objPEPQuimAnamnese)
		set comorbidadesHAS = $$$VARPEPQuimioterapiaAnamneseComorbidadesHAS(objPEPQuimAnamnese)
		set comorbidadesIRC = $$$VARPEPQuimioterapiaAnamneseComorbidadesIRC(objPEPQuimAnamnese)
		set comorbidadesICC = $$$VARPEPQuimioterapiaAnamneseComorbidadesICC(objPEPQuimAnamnese)
		set comorbidadesAVC = $$$VARPEPQuimioterapiaAnamneseComorbidadesAVC(objPEPQuimAnamnese)
		set comorbidadesCodronariopatia = $$$VARPEPQuimioterapiaAnamneseComorbidadesCondronariopa(objPEPQuimAnamnese)
		set comorbidadesOutros = $$$VARPEPQuimioterapiaAnamneseComorbidadesOutros(objPEPQuimAnamnese)
		set cirugiasAnteriores = $$$VARPEPQuimioterapiaAnamneseCirugiasAnterior(objPEPQuimAnamnese)
		set cirugiasAnterioresOnde = $$$VARPEPQuimioterapiaAnamneseCirugiasAnteriorOnde(objPEPQuimAnamnese)
		set alergia = $$$VARPEPQuimioterapiaAnamneseAlergia(objPEPQuimAnamnese)
		set alergiaAQue = $$$VARPEPQuimioterapiaAnamneseAlergiaAQue(objPEPQuimAnamnese)
		set infusaoVeiaPeriferica = $$$VARPEPQuimioterapiaAnamneseInfusaoVeiaPeriferica(objPEPQuimAnamnese)
		set infusaoPort = $$$VARPEPQuimioterapiaAnamneseInfusaoPortaCath(objPEPQuimAnamnese)
		set infusaoPICC = $$$VARPEPQuimioterapiaAnamneseInfusaoPICC(objPEPQuimAnamnese)
		set infusaoSC = $$$VARPEPQuimioterapiaAnamneseInfusaoSC(objPEPQuimAnamnese)
		set infusaoIM = $$$VARPEPQuimioterapiaAnamneseInfusaoIM(objPEPQuimAnamnese)
		set infusao = $$$VARPEPQuimioterapiaAnamneseInfusaoLocalizacao(objPEPQuimAnamnese)
		set fluxoCateter = $$$VARPEPQuimioterapiaAnamneseFluxoCateter(objPEPQuimAnamnese)
		set finalizacao = $$$VARPEPQuimioterapiaAnamneseFinalizacaoCom(objPEPQuimAnamnese)
		set incidente = $$$VARPEPQuimioterapiaAnamneseIncidente(objPEPQuimAnamnese)
		set incidenteQual = $$$VARPEPQuimioterapiaAnamneseIncidenteQual(objPEPQuimAnamnese)
		set peso = $$$VARPEPQuimioterapiaAnamneseDadAntPeso(objPEPQuimAnamnese)
		set altura = $$$VARPEPQuimioterapiaAnamneseDadAntAltura(objPEPQuimAnamnese)
		set sC = $$$VARPEPQuimioterapiaAnamneseDadAntSC(objPEPQuimAnamnese)
		set riscoFlebite = $$$VARPEPQuimioterapiaAnamneseRiscodeFlebite(objPEPQuimAnamnese)
		set neuropsiquiatrico = $$$VARPEPQuimioterapiaAnamneseNeuropsiquiatrico(objPEPQuimAnamnese)
		set padraoRespiratorio = $$$VARPEPQuimioterapiaAnamnesePadraoRespiratorio(objPEPQuimAnamnese)
		set ritmoCardiaco = $$$VARPEPQuimioterapiaAnamneseRitmoCardiaco(objPEPQuimAnamnese)
		set peleMucosa = $$$VARPEPQuimioterapiaAnamnesePeleeMucosa(objPEPQuimAnamnese)
		set dor = $$$VARPEPQuimioterapiaAnamneseDor(objPEPQuimAnamnese)
		set dorDescricao = $$$VARPEPQuimioterapiaAnamneseDorDescricao(objPEPQuimAnamnese)
		set redeVenoso = $$$VARPEPQuimioterapiaAnamneseRedeVenosoPrej(objPEPQuimAnamnese)
		set redeVenosoDescricao = $$$VARPEPQuimioterapiaAnamneseRedeVenosoPrejDescricao(objPEPQuimAnamnese)
		set medoApreensao = $$$VARPEPQuimioterapiaAnamneseMedoApreensao(objPEPQuimAnamnese)
		set medoApreensaoDescricao = $$$VARPEPQuimioterapiaAnamneseMedoApreensaoDescricao(objPEPQuimAnamnese)
		set internacaoSocial = $$$VARPEPQuimioterapiaAnamneseIntSocPejud(objPEPQuimAnamnese)
		set internacaoSocialDescricao = $$$VARPEPQuimioterapiaAnamneseIntSocPejudDescricao(objPEPQuimAnamnese)
		set hemograma = $$$VARPEPQuimioterapiaAnamneseHemograma(objPEPQuimAnamnese)
		set funcaoRenal = $$$VARPEPQuimioterapiaAnamneseFuncaoRenal(objPEPQuimAnamnese)
		set hipatica = $$$VARPEPQuimioterapiaAnamneseFuncaoHipatica(objPEPQuimAnamnese)
		set neurologicas = $$$VARPEPQuimioterapiaAnamneseAlteracaoNeurologica(objPEPQuimAnamnese)
		set conferirPaciente = $$$VARPEPQuimioterapiaAnamneseConferirPaciente(objPEPQuimAnamnese)
		set conferirPrescricao = $$$VARPEPQuimioterapiaAnamneseConferirPrescricao(objPEPQuimAnamnese)
		set conferirEtiqueta = $$$VARPEPQuimioterapiaAnamneseConferirEtiqueta(objPEPQuimAnamnese)
		set conferirSinais = $$$VARPEPQuimioterapiaAnamneseConferirSinais(objPEPQuimAnamnese)
		set medicamentoUso = $$$VARPEPQuimioterapiaAnamneseMedicacaoemUso(objPEPQuimAnamnese)
		;
		set arrayDiagnostico = []
		for i=1:1:$length(diagnostico,";") {
			if ($piece(diagnostico,";",i)="") continue
			do arrayDiagnostico.%Push($piece(diagnostico,";",i))
		}
		;
		set arrayMedicamentoUso = []
		for i=1:1:$length(medicamentoUso,";") {
			if ($piece(medicamentoUso,";",i)="") continue
			do arrayMedicamentoUso.%Push($piece(medicamentoUso,";",i))
		}	
		set listRetorno.medicamentoUso		= arrayMedicamentoUso
		;
		set listRetorno.dataHora 					= $zdatetime(criadoEm,4,2)
		set listRetorno.codPaciente 			= numProntuario
		set listRetorno.paciente 					= nomePaciente
		set listRetorno.dataNascimento 		= $zdate(dataNascimento,4,,4)
		set listRetorno.idade							= qtdeAnos
		set listRetorno.sexo							= sexo
		set listRetorno.codSala						= descSala
		set listRetorno.dSLeito						= dataSourceLeito
		set listRetorno.codLeito					= codLeito
		set listRetorno.protocoloEsquema	= protocoloEsquema
		set listRetorno.numCiclo					= numCiclo
		set listRetorno.diaCiclo					= diaCiclo
		set listRetorno.diagnostico				= arrayDiagnostico
		set listRetorno.medicoExterno 		= medicoExterno
		set listRetorno.dataHoraAssinatura	= $Select(dataHoraAssinatura="":"",1:$ZdateTime(dataHoraAssinatura,4,2))
		set listRetorno.assinatura					= $Select(assinatura="":"",1:$$SQLGetUserName^VARSQL(assinatura))
		set listRetorno.dispensacao				= dispensacao
		set listRetorno.observadoPor			= observadoPor
		set listRetorno.intercorrencia		= intercorrencia
		set listRetorno.intercorrenciaQual= intercorrenciaQual
		set listRetorno.outrasObservacoes	= outrasObservacoes
		set listRetorno.observacoesEnfermagem = observacoesEnfermagem
		set listRetorno.prescAmbHb				= prescAmbHb
		set listRetorno.prescAmbHtc				= prescAmbHtc
		set listRetorno.prescAmbPlaq			= prescAmbPlaq
		set listRetorno.prescAmbLeuc			= prescAmbLeuc
		set listRetorno.prescAmbNeutrof		= prescAmbNeutrof
		set listRetorno.prescAmbMedido		= prescAmbMedido
		set listRetorno.prescAmbBombainf	= prescAmbBombainf
		;
		set listRetorno.prescAmbIntervalo = prescAmbIntervalo
		set listRetorno.prescAmbNCiclo = prescAmbNCiclo
		set listRetorno.prescAmbInicioAplic = prescAmbInicioAplic
		set listRetorno.prescAmbDias = prescAmbDias
		;
		do listRetorno.%Set("aplicMedicamentosPerdSa", aplicMedicamentosPerdSa, "number")
		do listRetorno.%Set("aplicMedicamentosBariatr", aplicMedicamentosBariatr, "number")
		do listRetorno.%Set("aplicMedicamentosOutrosD509", aplicMedicamentosOutrosD509, "number")
		set listRetorno.aplicMedicamentosOutros			= aplicMedicamentosOutros
		set listRetorno.aplicMedicamentosAlerta			= aplicMedicamentosAlerta
		set arrayAplicMedicamentosDiagnosticoSecundario = []
		for i=1:1:$length(aplicMedicamentosDiagnosticoSecundario,";") {
			if ($piece(aplicMedicamentosDiagnosticoSecundario,";",i)="") continue
			do arrayAplicMedicamentosDiagnosticoSecundario.%Push($piece(aplicMedicamentosDiagnosticoSecundario,";",i))
		}
		set listRetorno.aplicMedicamentosDiagnosticoSecundario = arrayAplicMedicamentosDiagnosticoSecundario
		;
		set arrayCID = []
		for i=1:1:$length(cid,";") {
			if ($piece(cid,";",i)="") continue
			do arrayCID.%Push($piece(cid,";",i))
		}
		set listRetorno.cid	= arrayCID
		;
		/*set arrayComorbidades = []
		for i=1:1:$length(comorbidades,";") {
			if ($piece(comorbidades,";",i)="") continue
			do arrayComorbidades.%Push($piece(comorbidades,";",i))
		}
		;
		set listRetorno.comorbidades = arrayComorbidades*/
		do listRetorno.%Set("comorbidades", comorbidades, "string")
		do listRetorno.%Set("comorbidadesDM", comorbidadesDM, "number")
		do listRetorno.%Set("comorbidadesHAS", comorbidadesHAS, "number")
		do listRetorno.%Set("comorbidadesIRC", comorbidadesIRC, "number")
		do listRetorno.%Set("comorbidadesICC", comorbidadesICC, "number")
		do listRetorno.%Set("comorbidadesAVC", comorbidadesAVC, "number")
		do listRetorno.%Set("comorbidadesCodronariopatia", comorbidadesCodronariopatia, "number")
		set listRetorno.comorbidadesOutros 					= comorbidadesOutros
		set listRetorno.cirugiasAnteriores					= cirugiasAnteriores
		set listRetorno.cirugiasAnterioresOnde			= cirugiasAnterioresOnde
		If ($$$MEDPatientAlergia(objMEDPatient) '= "") {
			Set listRetorno.alergia			= $$$MEDPatientAlergia(objMEDPatient)
			Set listRetorno.alergiaAQue	= $$$MEDPatientAllergies(objMEDPatient)
		}Else{
			If ($$$MEDPatientAllergies(objMEDPatient) = "") Set listRetorno.alergia = 0
			Else  Set listRetorno.alergia = "1"
			Set listRetorno.alergiaAQue	= $$$MEDPatientAllergies(objMEDPatient)
		}
		;set listRetorno.alergia											= alergia
		;set listRetorno.alergiaAQue									= alergiaAQue
		do listRetorno.%Set("infusaoVeiaPeriferica", infusaoVeiaPeriferica, "number")
		do listRetorno.%Set("infusaoPort", infusaoPort, "number")
		do listRetorno.%Set("infusaoPICC", infusaoPICC, "number")
		do listRetorno.%Set("infusaoSC", infusaoSC, "number")
		do listRetorno.%Set("infusaoIM", infusaoIM, "number")
		set listRetorno.infusao											= infusao
		set listRetorno.fluxoCateter								= fluxoCateter
		set listRetorno.finalizacao									= finalizacao
		set listRetorno.incidente										= incidente
		set listRetorno.incidenteQual								= incidenteQual
		set listRetorno.peso												= peso
		set listRetorno.altura											= altura
		set listRetorno.sC													= sC
		set listRetorno.riscoFlebite								= riscoFlebite
		set listRetorno.neuropsiquiatrico						= neuropsiquiatrico
		set listRetorno.padraoRespiratorio					= padraoRespiratorio
		set listRetorno.ritmoCardiaco								= ritmoC]]><![CDATA[ardiaco
		set listRetorno.peleMucosa									= peleMucosa
		set listRetorno.dor													= dor
		set listRetorno.dorDescricao								= dorDescricao
		set listRetorno.redeVenoso									= redeVenoso
		set listRetorno.redeVenosoDescricao					= redeVenosoDescricao
		set listRetorno.medoApreensao								= medoApreensao
		set listRetorno.medoApreensaoDescricao			= medoApreensaoDescricao
		set listRetorno.internacaoSocial						= internacaoSocial
		set listRetorno.internacaoSocialDescricao		= internacaoSocialDescricao
		set listRetorno.hemograma										= hemograma
		set listRetorno.funcaoRenal									= funcaoRenal
		set listRetorno.hipatica										= hipatica
		set listRetorno.neurologicas								= neurologicas
		do listRetorno.%Set("conferirPaciente", conferirPaciente, "number")
		do listRetorno.%Set("conferirPrescricao", conferirPrescricao, "number")
		do listRetorno.%Set("conferirEtiqueta", conferirEtiqueta, "number")
		do listRetorno.%Set("conferirSinais", conferirSinais, "number")
		//
		//
		set listRetorno.nomeMedicamento = nomeMedicamento
		set listRetorno.nomeFabriacente = nomeFabriacente
		set listRetorno.dataInicio = $Select(dataInicio="":"",1:$Zdate(dataInicio,3))
		set listRetorno.dataAparecimento = $Select(dataAparecimento="":"",1:$Zdate(dataAparecimento,3))
		set listRetorno.reacaoMedLote = reacaoMedLote
		set listRetorno.reacaoMedValidad = $Select(reacaoMedValidad="":"",1:$Zdate(reacaoMedValidad,3))
		set listRetorno.reacaoMedPeso = reacaoMedPeso
		set listRetorno.reacaoMedAlt = reacaoMedAlt
		set listRetorno.medicacoesAntes = medicacoesAntes
		set listRetorno.medicacoesAntesFreq = medicacoesAntesFreq
		set listRetorno.medicacosAntesFreqEsp = medicacosAntesFreqEsp
		set listRetorno.gotejamento = +gotejamento
		set listRetorno.diluicao1 = diluicao1
		set listRetorno.diluicao2 = diluicao2
		set listRetorno.gotejamentoSF = gotejamentoSF
		set listRetorno.bolus = +bolus
		set listRetorno.bolusDuracao = bolusDuracao
		set listRetorno.intramoscular = +intramoscular
		set listRetorno.intramoscularDuracao = intramoscularDuracao
		set listRetorno.oral		 	= +oral
		set listRetorno.oralPosologia 	= oralPosologia
		set listRetorno.ingestao 		= ingestao
		set listRetorno.sinaisSintomas 	= sinaisSintomas
		set listRetorno.irritante 		= +irritante
		set listRetorno.vesicante 		= +vesicante
		set listRetorno.incidenteLocalNao = +incidenteLocalNao
		set listRetorno.incidenteLocal 	= incidenteLocal
		set listRetorno.compressaQuente = +compressaQuente
		set listRetorno.compressaFria 	= +compressaFria
		set listRetorno.compressaNao 	= +compressaNao
		set listRetorno.condutaAcompanhamento = condutaAcompanhamento
		set listRetorno.conclusao 		= conclusao
		set listRetorno.historico 		= historico
		set listRetorno.medico	 		= medico
		
	}
	
	do listRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="AlteraLeito">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 		= 0
	set Y 		= "~"
	set erro 	= ""
	try{
		set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
		set pAdmissao				= $get(%request.Data("pAdmissao",1))
		set pCodLeito				= $get(%request.Data("pCodLeito",1))
	
		&sql( Select Sala, Leito Into :CodSala, :CodLeito From SQLUser.VARPEPLeitoAtendimento
			 		Where Company = :YM And Prontuario = :pCodProntuario)
	
		if (SQLCODE '= 0) {
			set erro = "Erro ao checar a Sala Atual."
			quit
		}

		if (CodLeito = pCodLeito) quit
		
		set prontuarioLeito = ""
		&sql(Select Prontuario Into :prontuarioLeito From SQLUser.VARPEPLeitoAtendimento
				 Where Company = :YM And Sala = :CodSala And Leito = :pCodLeito)
	
		if (prontuarioLeito '= "") {
			set erro = "Leito já ocupado "_prontuarioLeito_"."
			quit
		}
		
		set objMEDAdmission	= $get(^MEDAdmission(YM, pAdmissao, 1))
		set $$$MEDAdmissionBed(objMEDAdmission) = pCodLeito
		set strStatus = $$$Save("MEDAdmission", pAdmissao, objMEDAdmission, $$$YES)
		
		if (strStatus = $$$OK) {
			set objLeitoAtendimento = $get(^VARPEPLeitoAtendimento(YM,CodSala,CodLeito,1))
			set strStatus = $$$Kill("VARPEPLeitoAtendimento", CodSala_$$$COMMA_CodLeito)
			set strStatus = $$$Save("VARPEPLeitoAtendimento", CodSala_$$$COMMA_pCodLeito, objLeitoAtendimento, $$$YES)
		}
	
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro			=	err
	}	
	set objRetorno = {}
	if erro=""{
		set objRetorno.status = $$$OK
	}else{
		set objRetorno.status = erro
	}
		
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmProntuario">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	tstart
	set strStatus	=	""
	set erro			=	0
	try{

		set YBED = $get(%request.Data("YBED",1))
		set pCodProntuario = $get(%request.Data("pCodProntuario",1))
		set pAdmissao = $get(%request.Data("pAdmissao",1))
		;
		set objMEDAdmission	= $get(^MEDAdmission(YM, pAdmissao, 1))
		Set codPaciente = $$$MEDAdmissionPatient(objMEDAdmission)
		if $$$MEDAdmissionDateDischarged(objMEDAdmission) 	'= ""{
			if ($get(%request.Data("pAssinar",1)) '= 1) {
				set erro = 1
				set strStatus = "Passagem já finalizada!"
				quit
			}
		}
		;
		set objPEPQuim = $get(^VARPEPQuimioterapia(YM, pCodProntuario, 1))
		set $$$VARPEPQuimioterapiaProtocoloEsquema(objPEPQuim) 	= $get(%request.Data("pProtocoloEsquema",1))
		set $$$VARPEPQuimioterapiaNumCiclo(objPEPQuim) 					= $get(%request.Data("pNumCiclo",1)) 
		set $$$VARPEPQuimioterapiaDiaCiclo(objPEPQuim) 					= $get(%request.Data("pDiaCiclo",1))
		set pDiagnostico = $get(%request.Data("pDiagnostico",1))
		if (pDiagnostico '= "") set pDiagnostico = $replace(pDiagnostico,",",";")
		set $$$VARPEPQuimioterapiaDiagnostico(objPEPQuim) 			= pDiagnostico
		set $$$VARPEPQuimioterapiaMedicoExterno(objPEPQuim) 		= $get(%request.Data("pMedicoExterno",1))
		set $$$VARPEPQuimioterapiaDispensacao(objPEPQuim)				= $get(%request.Data("pDispensacao",1))
		set $$$VARPEPQuimioterapiaObservadoPor(objPEPQuim)			= $get(%request.Data("pObservadoPor",1))
		set $$$VARPEPQuimioterapiaIntercorrencia(objPEPQuim)		= $get(%request.Data("pIntercorrencia",1))
		set $$$VARPEPQuimioterapiaIntercorrenciaQual(objPEPQuim)= $get(%request.Data("pIntercorrenciaQual",1))
		set $$$VARPEPQuimioterapiaOutrasObservacoes(objPEPQuim)	= $get(%request.Data("pOutrasObservacoes",1))
		set $$$VARPEPQuimioterapiaObservacoesEnfermagem(objPEPQuim)	= $get(%request.Data("pObservacoesEnfermagem",1))
		;Prescrição Ambulatorial
		set $$$VARPEPQuimioterapiaPrescricaoHB(objPEPQuim)	= $get(%request.Data("pPrescAmbHb",1))
		set $$$VARPEPQuimioterapiaPrescricaoHTC(objPEPQuim)	= $get(%request.Data("pPrescAmbHtc",1))
		set $$$VARPEPQuimioterapiaPrescricaoPlaqueta(objPEPQuim)	= $get(%request.Data("pPrescAmbPlaq",1))
		set $$$VARPEPQuimioterapiaPrescricaoLeuc(objPEPQuim)	= $get(%request.Data("pPrescAmbLeuc",1))
		set $$$VARPEPQuimioterapiaPrescricaoNeotrof(objPEPQuim)	= $get(%request.Data("pPrescAmbNeutrof",1))
		set $$$VARPEPQuimioterapiaPrescricaoMedico(objPEPQuim)	= $get(%request.Data("pPrescAmbMedido",1))
		set $$$VARPEPQuimioterapiaUsoBombaInfusao(objPEPQuim)	= $get(%request.Data("pPrescAmbBombainf",1))
		;
		set $$$VARPEPQuimioterapiaPrescricaoIntervalo(objPEPQuim)	= $get(%request.Data("pPrescAmbIntervalo",1))
		set $$$VARPEPQuimioterapiaPrescricaoNoCicloProposto(objPEPQuim)	= $get(%request.Data("pPrescAmbNCiclo",1))
		set $$$VARPEPQuimioterapiaPrescricaoIniciodaAplicac(objPEPQuim)	= $get(%request.Data("pPrescAmbInicioAplic",1))
		set $$$VARPEPQuimioterapiaPrescricaoDias(objPEPQuim)	= $get(%request.Data("pPrescAmbDias",1))
		;
		set pAplicMedicamentosPerdSa 			= $get(%request.Data("pAplicMedicamentosPerdSa",1))
		set pAplicMedicamentosBariatr 		= $get(%request.Data("pAplicMedicamentosBariatr",1))
		set pAplicMedicamentosOutrosD509 	= $get(%request.Data("pAplicMedicamentosOutrosD509",1)) 
		if (pAplicMedicamentosPerdSa '= "") set pAplicMedicamentosPerdSa = $select(pAplicMedicamentosPerdSa="true"||(pAplicMedicamentosPerdSa=1):1,1:0)
		if (pAplicMedicamentosBariatr '= "") set pAplicMedicamentosBariatr = $select(pAplicMedicamentosBariatr="true"||(pAplicMedicamentosBariatr=1):1,1:0)
		if (pAplicMedicamentosOutrosD509 '= "") set pAplicMedicamentosOutrosD509 = $select(pAplicMedicamentosOutrosD509="true"||(pAplicMedicamentosOutrosD509=1):1,1:0)
		set $$$VARPEPQuimioterapiaAplicMedicamentosPerdSa(objPEPQuim)			= pAplicMedicamentosPerdSa
		set $$$VARPEPQuimioterapiaAplicMedicamentosBariatr(objPEPQuim)		= pAplicMedicamentosBariatr
		set $$$VARPEPQuimioterapiaAplicMedicamentosOutrosD509(objPEPQuim)	= pAplicMedicamentosOutrosD509
		set $$$VARPEPQuimioterapiaAplicMedicamentosOutros(objPEPQuim)			= $get(%request.Data("pAplicMedicamentosOutros",1))
		set $$$VARPEPQuimioterapiaAplicMedicamentosAlerta(objPEPQuim)			= $get(%request.Data("pAplicMedicamentosAlerta",1))
		Set pApliMedDiagnostico = $get(%request.Data("pApliMedDiagnostico",1))
		if (pApliMedDiagnostico '= "") set pApliMedDiagnostico = $replace(pApliMedDiagnostico,",",";")
		set $$$VARPEPQuimioterapiaAplicMedicamentosDiagnosticoSecundario(objPEPQuim) = pApliMedDiagnostico
		;
		;
		set $$$VARPEPQuimioterapiaReacaoMedicamento(objPEPQuim)	= $Get(%request.Data("pNomeMedicamento",1))
		set $$$VARPEPQuimioterapiaReacaoFabricante(objPEPQuim)	= $Get(%request.Data("pNomeFabriacente",1))
		Set pDataInicio = $Get(%request.Data("pDataInicio",1))
		set $$$VARPEPQuimioterapiaReacaoDataInicio(objPEPQuim)	= $Select(pDataInicio'="":$ZDATEH(pDataInicio,4),1:"")
		Set pDataAparecimento = $Get(%request.Data("pDataAparecimento",1))
		set $$$VARPEPQuimioterapiaReacaoDataAparecimento(objPEPQuim) = $Select(pDataAparecimento'="":$ZDATEH(pDataAparecimento,4),1:"")
		set $$$VARPEPQuimioterapiaReacaoLote(objPEPQuim)	= $Get(%request.Data("pReacaoMedLote",1))
		Set pReacaoMedValidad = $Get(%request.Data("pReacaoMedValidad",1))
		set $$$VARPEPQuimioterapiaReacaoValidade(objPEPQuim)	= $Select(pReacaoMedValidad'="":$ZDATEH(pReacaoMedValidad,4),1:"")
		set $$$VARPEPQuimioterapiaReacaoPeso(objPEPQuim)	= $Get(%request.Data("pReacaoMedPeso",1))
		set $$$VARPEPQuimioterapiaReacaoAlt(objPEPQuim)	= $Get(%request.Data("pReacaoMedAlt",1))
		set $$$VARPEPQuimioterapiaReacaoJaRecebeuMedicament(objPEPQuim)	= $Get(%request.Data("pMedicacoesAntes",1))
		set $$$VARPEPQuimioterapiaReacaoFrequenciaMedicamen(objPEPQuim)	= $Get(%request.Data("pMedicacoesAntesFreq",1))
		set $$$VARPEPQuimioterapiaReacaoFrequenciaEspecificacao(objPEPQuim)	= $Get(%request.Data("pMedicacosAntesFreqEsp",1))
		Set pGotejamento = $Get(%request.Data("pGotejamento",1))
		set $$$VARPEPQuimioterapiaReacaoModAplicInfusao(objPEPQuim)	= $Select(pGotejamento="":"",(pGotejamento="true"||(pGotejamento=1)):1,1:0)
		set $$$VARPEPQuimioterapiaReacaoModAplicInfusaoDil1(objPEPQuim)	= $Get(%request.Data("pDiluicao1",1))
		set $$$VARPEPQuimioterapiaReacaoModAplicInfusaoDil2(objPEPQuim)	= $Get(%request.Data("pDiluicao2",1))
		set $$$VARPEPQuimioterapiaReacaoModAplicInfusaoSF(objPEPQuim)	= $Get(%request.Data("pGotejamentoSF",1))
		Set pBolus = $Get(%request.Data("pBolus",1))
		set $$$VARPEPQuimioterapiaReacaoModAplicInjecao(objPEPQuim)	= $Select(pBolus="":"",(pBolus="true"||(pBolus=1)):1,1:0)
		set $$$VARPEPQuimioterapiaReacaoModAplicInjecaoD(objPEPQuim) = $Get(%request.Data("pBolusDuracao",1))
		Set pIntramoscular = $Get(%request.Data("pIntramoscular",1))
		set $$$VARPEPQuimioterapiaReacaoModAplicIntra(objPEPQuim)	= $Select(pIntramoscular="":"",(pIntramoscular="true"||(pIntramoscular=1)):1,1:0)
		set $$$VARPEPQuimioterapiaReacaoModAplicIntraD(objPEPQuim)	= $Get(%request.Data("pIntramoscularDuracao",1))
		Set pOral = $Get(%request.Data("pOral",1))
		set $$$VARPEPQuimioterapiaReacaoModAplicOral(objPEPQuim)	= $Select(pOral="":"",(pOral="true"||(pOral=1)):1,1:0)
		set $$$VARPEPQuimioterapiaReacaoModAplicOralPosologia(objPEPQuim)	= $Get(%request.Data("pOralPosologia",1))
		set $$$VARPEPQuimioterapiaReacaoIngestao(objPEPQuim)	= $Get(%request.Data("pIngestao",1))
		set $$$VARPEPQuimioterapiaReacaoSinaiseSintomas(objPEPQuim)	= $Get(%request.Data("pSinaisSintomas",1))
		Set pIrritante = $Get(%request.Data("pIrritante",1))
		set $$$VARPEPQuimioterapiaReacaoIncidenteIrritante(objPEPQuim)	= $Select(pIrritante="":"",(pIrritante="true"||(pIrritante=1)):1,1:0)
		Set pVesicante = $Get(%request.Data("pVesicante",1))
		set $$$VARPEPQuimioterapiaReacaoIncidenteVesicante(objPEPQuim)	= $Select(pVesicante="":"",(pVesicante="true"||(pVesicante=1)):1,1:0)
		Set pIncidenteLocalNao = $Get(%request.Data("pIncidenteLocalNao",1))
		set $$$VARPEPQuimioterapiaReacaoIncidenteExtravasam(objPEPQuim)	= $Select(pIncidenteLocalNao="":"",(pIncidenteLocalNao="true"||(pIncidenteLocalNao=1)):1,1:0)
		set $$$VARPEPQuimioterapiaReacaoIncidenteDescricao(objPEPQuim)	= $Get(%request.Data("pIncidenteLocal",1))
		Set pCompressaQuente = $Get(%request.Data("pCompressaQuente",1))
		set $$$VARPEPQuimioterapiaReacaoCompressaQuente(objPEPQuim)	= $Select(pCompressaQuente="":"",(pCompressaQuente="true"||(pCompressaQuente=1)):1,1:0)
		Set pCompressaFria = $Get(%request.Data("pCompressaFria",1))
		set $$$VARPEPQuimioterapiaReacaoCompressaFria(objPEPQuim)	= $Select(pCompressaFria="":"",(pCompressaFria="true"||(pCompressaFria=1)):1,1:0)
		Set pCompressaNao = $Get(%request.Data("pCompressaNao",1))
		set $$$VARPEPQuimioterapiaReacaoCompressaNaoUtiliza(objPEPQuim)	= $Select(pCompressaNao="":"",(pCompressaNao="true"||(pCompressaNao=1)):1,1:0)
		set $$$VARPEPQuimioterapiaReacaoCondutaeAcompanhame(objPEPQuim)	= $replace($Get(%request.Data("pCondutaAcompanhamento",1)),"~"," ")
		set $$$VARPEPQuimioterapiaReacaoConclusao(objPEPQuim)			= $replace($Get(%request.Data("pConclusao",1)),"~"," ")
		set $$$VARPEPQuimioterapiaReacaoHistorico(objPEPQuim)			= $replace($Get(%request.Data("pHistorico",1)),"~"," ")
		set $$$VARPEPQuimioterapiaReacaoMedico(objPEPQuim)				= $Get(%request.Data("pMedico",1))
		;
		if ($get(%request.Data("pAssinar",1)) = 1) {
			set $$$VARPEPQuimioterapiaDataHoraAssinatura(objPEPQuim) = $Horolog
			set $$$VARPEPQuimioterapiaUsuarioAssinatura(objPEPQuim) 	= YBED
		}else{
			If ($$$VARPEPQuimioterapiaUsuarioAssinatura(objPEPQuim) '= YBED) {
				set $$$VARPEPQuimioterapiaDataHoraAssinatura(objPEPQuim) = ""
				set $$$VARPEPQuimioterapiaUsuarioAssinatura(objPEPQuim) 	= ""
			}else{
				set $$$VARPEPQuimioterapiaDataHoraAssinatura(objPEPQuim) = $Horolog
			}
		}	
		;
		set strStatus	=	$$$Save("VARPEPQuimioterapia", pCodProntuario, objPEPQuim, $$$YES)

		if (strStatus '= $$$OK) {
			quit	
		}
		set pCID												= $get(%request.Data("pCID",1))
		set pComorbidades								= $get(%request.Data("pComorbidades",1))
		set pComorbidadesDM							= $get(%request.Data("pComorbidadesDM",1))
		set pComorbidadesHAS						= $get(%request.Data("pComorbidadesHAS",1))
		set pComorbidadesIRC						= $get(%request.Data("pComorbidadesIRC",1))
		set pComorbidadesICC						= $get(%request.Data("pComorbidadesICC",1))
		set pComorbidadesAVC						= $get(%request.Data("pComorbidadesAVC",1))
		set pComorbidadesCodronariopatia= $get(%request.Data("pComorbidadesCodronariopatia",1))
		set pComorbidadesOutros					= $get(%request.Data("pComorbidadesOutros",1))
		set pCirugiasAnterior						= $get(%request.Data("pCirugiasAnteriores",1))
		set pCirugiasAnteriorOnde				= $get(%request.Data("pCirugiasAnterioresOnde",1))
		set pAlergia										= $get(%request.Data("pAlergia",1))
		set pAlergiaAQue								= $get(%request.Data("pAlergiaAQue",1))
		set pInfusaoVeiaPeriferica			= $get(%request.Data("pInfusaoVeiaPeriferica",1))
		set pInfusaoPort								= $get(%request.Data("pInfusaoPort",1))
		set pInfusaoPICC								= $get(%request.Data("pInfusaoPICC",1))
		set pInfusaoSC									= $get(%request.Data("pInfusaoSC",1))
		set pInfusaoIM									= $get(%request.Data("pInfusaoIM",1))
		set pInfusaoLocalizacao					= $get(%request.Data("pInfusao",1))
		set pFluxoCateter								= $get(%request.Data("pFluxoCateter",1))
		set pFinalizacaoCom							= $get(%request.Data("pFinalizacao",1))
		set pIncidente									= $get(%request.Data("pIncidente",1))
		set pIncidenteQual							= $get(%request.Data("pIncidenteQual",1))
		set pPeso												= $get(%request.Data("pPeso",1))
		set pAltura											= $get(%request.Data("pAltura",1))
		set pSC													= $get(%request.Data("pSC",1))
		set pRiscoFlebite								= $get(%request.Data("pRiscoFlebite",1))
		set pNeuropsiquiatrico					= $get(%request.Data("pNeuropsiquiatrico",1))
		set pPadraoRespiratorio					= $get(%request.Data("pPadraoRespiratorio",1))
		set pRitmoCardiaco							= $get(%request.Data("pRitmoCardiaco",1))
		set pPeleMucosa									= $get(%request.Data("pPeleMucosa",1))
		set pDor												= $get(%request.Data("pDor",1))
		set pDorDescricao								= $get(%request.Data("pDorDescricao",1))
		set pRedeVenoso									= $get(%request.Data("pRedeVenoso",1))
		set pRedeVenosoDescricao				= $get(%request.Data("pRedeVenosoDescricao",1))
		set pMedoApreensao							= $get(%request.Data("pMedoApreensao",1))
		set pMedoApreensaoDescricao			= $get(%request.Data("pMedoApreensaoDescricao",1))
		set pInternacaoSocial						= $get(%request.Data("pInternacaoSocial",1))
		set pInternacaoSocialDescricao	= $get(%request.Data("pInternacaoSocialDescricao",1))
		set pHemograma									= $get(%request.Data("pHemograma",1))
		set pFuncaoRenal								= $get(%request.Data("pFuncaoRenal",1))
		set pHipatica										= $get(%request.Data("pHipatica",1))
		set pNeurologicas								= $get(%request.Data("pNeurologicas",1))
		set pConferirPaciente						= $get(%request.Data("pConferirPaciente",1))
		set pConferirPrescricao					= $get(%request.Data("pConferirPrescricao",1))
		set pConferirEtiqueta						= $get(%request.Data("pConferirEtiqueta",1))
		set pConferirSinais							= $get(%request.Data("pConferirSinais",1))
		set pMedicamentoUso 						= $get(%request.Data("pMedicamentoUso",1))
		;;
		if (pMedicamentoUso '= "") set pMedicamentoUso = $replace(pMedicamentoUso,",",";")
		if (pCID '= "") set pCID = $replace(pCID,",",";")
		;if (pComorbidades '= "") set pComorbidades = $replace(pComorbidades,",",";")
		if (pComorbidadesDM '= "") set pComorbidadesDM = $select(pComorbidadesDM="true"||(pComorbidadesDM=1):1,1:0)
		if (pComorbidadesHAS '= "") set pComorbidadesHAS = $select(pComorbidadesHAS="true"||(pComorbidadesHAS=1):1,1:0)
		if (pComorbidadesIRC '= "") set pComorbidadesIRC = $select(pComorbidadesIRC="true"||(pComorbidadesIRC=1):1,1:0)
		if (pComorbidadesICC '= "") set pComorbidadesICC = $select(pComorbidadesICC="true"||(pComorbidadesICC=1):1,1:0)
		if (pComorbidadesAVC '= "") set pComorbidadesAVC = $select(pComorbidadesAVC="true"||(pComorbidadesAVC=1):1,1:0)
		if (pComorbidadesCodronariopatia '= "") {
			set pComorbidadesCodronariopatia = $select(pComorbidadesCodronariopatia="true"||(pComorbidadesCodronariopatia=1):1,1:0)
		}
		if (pInfusaoVeiaPeriferica '= "") set pInfusaoVeiaPeriferica = $select(pInfusaoVeiaPeriferica="true"||(pInfusaoVeiaPeriferica=1):1,1:0)
		if (pInfusaoPort '= "") set pInfusaoPort = $select(pInfusaoPort="true"||(pInfusaoPort=1):1,1:0)
		if (pInfusaoPICC '= "") set pInfusaoPICC = $select(pInfusaoPICC="true"||(pInfusaoPICC=1):1,1:0)
		if (pInfusaoSC '= "") set pInfusaoSC = $select(pInfusaoSC="true"||(pInfusaoSC=1):1,1:0)
		if (pInfusaoIM '= "") set pInfusaoIM = $select(pInfusaoIM="true"||(pInfusaoIM=1):1,1:0)
		if (pConferirPaciente '= "") set pConferirPaciente = $select(pConferirPaciente="true"||(pConferirPaciente=1):1,1:0)
		if (pConferirPrescricao '= "") set pConferirPrescricao = $select(pConferirPrescricao="true"||(pConferirPrescricao=1):1,1:0)
		if (pConferirEtiqueta '= "") set pConferirEtiqueta = $select(pConferirEtiqueta="true"||(pConferirEtiqueta=1):1,1:0)
		if (pConferirSinais '= "") set pConferirSinais = $select(pConferirSinais="true"||(pConferirSinais=1):1,1:0)
		;
		set objPEPQuimAnamnese = $get(^VARPEPQuimioterapiaAnamnese(YM, pCodProntuario, 1))
		set $$$VARPEPQuimioterapiaAnamneseCID(objPEPQuimAnamnese)												= pCID
		set $$$VARPEPQuimioterapiaAnamneseComorbidades(objPEPQuimAnamnese)							= pComorbidades
		set $$$VARPEPQuimioterapiaAnamneseComorbidadesDM(objPEPQuimAnamnese)						= pComorbidadesDM
		set $$$VARPEPQuimioterapiaAnamneseComorbidadesHAS(objPEPQuimAnamnese)						= pComorbidadesHAS
		set $$$VARPEPQuimioterapiaAnamneseComorbidadesIRC(objPEPQuimAnamnese)						= pComorbidadesIRC
		set $$$VARPEPQuimioterapiaAnamneseComorbidadesICC(objPEPQuimAnamnese)						= pComorbidadesICC
		set $$$VARPEPQuimioterapiaAnamneseComorbidadesAVC(objPEPQuimAnamnese)						= pComorbidadesAVC
		set $$$VARPEPQuimioterapiaAnamneseComorbidadesCondronariopa(objPEPQuimAnamnese)	= pComorbidadesCodronariopatia
		set $$$VARPEPQuimioterapiaAnamneseComorbidadesOutros(objPEPQuimAnamnese)				= pComorbidadesOutros
		set $$$VARPEPQuimioterapiaAnamneseCirugiasAnterior(objPEPQuimAnamnese)					= pCirugiasAnterior
		set $$$VARPEPQuimioterapiaAnamneseCirugiasAnteriorOnde(objPEPQuimAnamnese)			= pCirugiasAnteriorOnde
		set $$$VARPEPQuimioterapiaAnamneseAlergia(objPEPQ]]><![CDATA[uimAnamnese)										= pAlergia
		set $$$VARPEPQuimioterapiaAnamneseAlergiaAQue(objPEPQuimAnamnese)								= pAlergiaAQue
		set $$$VARPEPQuimioterapiaAnamneseInfusaoVeiaPeriferica(objPEPQuimAnamnese)			= pInfusaoVeiaPeriferica
		set $$$VARPEPQuimioterapiaAnamneseInfusaoPortaCath(objPEPQuimAnamnese)					= pInfusaoPort
		set $$$VARPEPQuimioterapiaAnamneseInfusaoPICC(objPEPQuimAnamnese)								= pInfusaoPICC
		set $$$VARPEPQuimioterapiaAnamneseInfusaoSC(objPEPQuimAnamnese)									= pInfusaoSC
		set $$$VARPEPQuimioterapiaAnamneseInfusaoIM(objPEPQuimAnamnese)									= pInfusaoIM
		set $$$VARPEPQuimioterapiaAnamneseInfusaoLocalizacao(objPEPQuimAnamnese)				= pInfusaoLocalizacao
		set $$$VARPEPQuimioterapiaAnamneseFluxoCateter(objPEPQuimAnamnese)							= pFluxoCateter
		set $$$VARPEPQuimioterapiaAnamneseFinalizacaoCom(objPEPQuimAnamnese)						= pFinalizacaoCom
		set $$$VARPEPQuimioterapiaAnamneseIncidente(objPEPQuimAnamnese)									= pIncidente
		set $$$VARPEPQuimioterapiaAnamneseIncidenteQual(objPEPQuimAnamnese)							= pIncidenteQual
		set $$$VARPEPQuimioterapiaAnamneseDadAntPeso(objPEPQuimAnamnese)								= pPeso
		set $$$VARPEPQuimioterapiaAnamneseDadAntAltura(objPEPQuimAnamnese)							= pAltura
		set $$$VARPEPQuimioterapiaAnamneseDadAntSC(objPEPQuimAnamnese)									= pSC
		set $$$VARPEPQuimioterapiaAnamneseRiscodeFlebite(objPEPQuimAnamnese)						= pRiscoFlebite
		set $$$VARPEPQuimioterapiaAnamneseNeuropsiquiatrico(objPEPQuimAnamnese)					= pNeuropsiquiatrico
		set $$$VARPEPQuimioterapiaAnamnesePadraoRespiratorio(objPEPQuimAnamnese)				= pPadraoRespiratorio
		set $$$VARPEPQuimioterapiaAnamneseRitmoCardiaco(objPEPQuimAnamnese)							= pRitmoCardiaco
		set $$$VARPEPQuimioterapiaAnamnesePeleeMucosa(objPEPQuimAnamnese)								= pPeleMucosa
		set $$$VARPEPQuimioterapiaAnamneseDor(objPEPQuimAnamnese)												= pDor
		set $$$VARPEPQuimioterapiaAnamneseDorDescricao(objPEPQuimAnamnese)							= pDorDescricao
		set $$$VARPEPQuimioterapiaAnamneseRedeVenosoPrej(objPEPQuimAnamnese)						= pRedeVenoso
		set $$$VARPEPQuimioterapiaAnamneseRedeVenosoPrejDescricao(objPEPQuimAnamnese)		= pRedeVenosoDescricao
		set $$$VARPEPQuimioterapiaAnamneseMedoApreensao(objPEPQuimAnamnese)							= pMedoApreensao
		set $$$VARPEPQuimioterapiaAnamneseMedoApreensaoDescricao(objPEPQuimAnamnese)		= pMedoApreensaoDescricao
		set $$$VARPEPQuimioterapiaAnamneseIntSocPejud(objPEPQuimAnamnese)								= pInternacaoSocial
		set $$$VARPEPQuimioterapiaAnamneseIntSocPejudDescricao(objPEPQuimAnamnese)			= pInternacaoSocialDescricao
		set $$$VARPEPQuimioterapiaAnamneseHemograma(objPEPQuimAnamnese)									= pHemograma
		set $$$VARPEPQuimioterapiaAnamneseFuncaoRenal(objPEPQuimAnamnese)								= pFuncaoRenal
		set $$$VARPEPQuimioterapiaAnamneseFuncaoHipatica(objPEPQuimAnamnese)						= pHipatica
		set $$$VARPEPQuimioterapiaAnamneseAlteracaoNeurologica(objPEPQuimAnamnese)			= pNeurologicas
		set $$$VARPEPQuimioterapiaAnamneseConferirPaciente(objPEPQuimAnamnese)					= pConferirPaciente
		set $$$VARPEPQuimioterapiaAnamneseConferirPrescricao(objPEPQuimAnamnese)				= pConferirPrescricao
		set $$$VARPEPQuimioterapiaAnamneseConferirEtiqueta(objPEPQuimAnamnese)					= pConferirEtiqueta
		set $$$VARPEPQuimioterapiaAnamneseConferirSinais(objPEPQuimAnamnese)						= pConferirSinais
		set $$$VARPEPQuimioterapiaAnamneseMedicacaoemUso(objPEPQuimAnamnese)						= pMedicamentoUso
		set strStatus	=	$$$Save("VARPEPQuimioterapiaAnamnese", pCodProntuario, objPEPQuimAnamnese, $$$YES)
		;
		Set objMEDPatient = $Get(^MEDPatient(0, codPaciente, 1))
		If (pAlergia '= $$$MEDPatientAlergia(objMEDPatient) || (pAlergiaAQue '= $$$MEDPatientAllergies(objMEDPatient))) {
			set $$$MEDPatientAlergia(objMEDPatient) 	= pAlergia
			set $$$MEDPatientAllergies(objMEDPatient) = pAlergiaAQue
			set strStatus	=	$$$Save("MEDPatient", codPaciente, objMEDPatient, $$$YES)
		}
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro	=	err
	}
	set retorno = {}
	if 'erro{
		tcommit
		set retorno.status = strStatus
		set retorno.dataHoraAssinatura = $$$VARPEPQuimioterapiaDataHoraAssinatura(objPEPQuim)
	}else{
		trollback
		set retorno.status = strStatus
		set retorno.dataHoraAssinatura = $$$VARPEPQuimioterapiaDataHoraAssinatura(objPEPQuim)
	}
	do retorno.%ToJSON()
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetContDadosVitais">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	set pQuimio = $get(%request.Data("pQuimio",1))

	set objProntuario	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))
	set admissao 			= $$$VARProntuarioEletronicoNumeroAdmisao(objProntuario)
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select Dados.Sequencia, Dados.DataHoraAfericao,"
	set meuSQL($increment(contador))	= "Dados.PressaoArterial, Dados.Pulso, Dados.Temperatura,"
	set meuSQL($increment(contador))	= "Dados.FreqRespiratoria, Dados.Responsavel,"
	set meuSQL($increment(contador))	= "$$SQLGetProviderName^VARSQL(Dados.Responsavel) As Name,"
	set meuSQL($increment(contador))	= "Dados.Observacao"
	set meuSQL($increment(contador))	= "From SQLUser.VARPEPQuimContDadosVitDados As Dados"
	set meuSQL($increment(contador))	= "Where Dados.Company = 0"
	set meuSQL($increment(contador))	= "And Dados.CodigoProntuarioEletronic = '"_pCodProntuario_"'" 
	
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		
		set hora = $piece(rSet.%Get("DataHoraAfericao"),",",2)
		
		set list = {}
		set list.sequencia				= rSet.%Get("Sequencia")
		set list.hora 						= $ztime(hora,2)
		set list.pressaoArterial 	= rSet.%Get("PressaoArterial")
		set list.pulso 						= rSet.%Get("Pulso")
		set list.temperatura 			= rSet.%Get("Temperatura")
		set list.freqRespiratoria = rSet.%Get("FreqRespiratoria")
		set list.responsavel 			= $$SQLGetUserName^VARSQL(rSet.%Get("Responsavel"))		
		set list.local 	= "E"
		set list.observacao				= rSet.%Get("Observacao")
		
		do objRetorno.%Push(list)
	
	}
	
	;;PEP Médico
	/*kill meuSQL
	set contador = 0, sequencia = 0
	set meuSQL($increment(contador))	= "Select Hora, PA1||'x'||PA2 As PressaoArterial, Pulso, Temp "
	set meuSQL($increment(contador))	= "From SQLUser.VARPEPEvolucao"
	set meuSQL($increment(contador))	= "Where Company = 0 And NumerodoPEP = '"_admissao_"'" 
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	while(rSet.%Next()){
		set list = {}
		set list.sequencia				= $increment(sequencia)
		set list.hora 						= $ztime(rSet.%Get("Hora"),2)
		set list.pressaoArterial 	= rSet.%Get("PressaoArterial")
		set list.pulso 						= rSet.%Get("Pulso")
		set list.temperatura 			= rSet.%Get("Temp")
		set list.freqRespiratoria = "-"
		set list.responsavel 			= ""
		set list.responsavelDesc 	= ""
		set list.local 	= "M"
		
		do objRetorno.%Push(list)
	
	}*/
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmContDadosVitais">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pQuimio,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	
	if (pSequencia = "") {
		set pSequencia = $Order(^VARPEPQuimContDadosVitDados(YM, pCodProntuario, ""),-1)+1
	}
	
	set objContDados = $get(^VARPEPQuimContDadosVitDados(YM, pCodProntuario, pSequencia, 1))

	set index = "" 
	for {
		set index = $order(pDados(index)) 
		quit:index=""
		
		set coluna	= $piece(pDados(index),"~",1)
		set valor		= $piece(pDados(index),"~",2)

		if (coluna = "hora") {
			set hora = +$horolog_","_$ztimeh(valor,4,$piece($horolog,",",2))
			set $$$VARPEPQuimContDadosVitDadosDataHoraAfericao(objContDados) = hora
		}
		if (coluna = "pressaoArterial") {
			set valor = $Replace(valor,"_","") 
			set $$$VARPEPQuimContDadosVitDadosPressaoArterial(objContDados) = valor
		}
		if (coluna = "pulso") set $$$VARPEPQuimContDadosVitDadosPulso(objContDados) = valor
		if (coluna = "temperatura") set $$$VARPEPQuimContDadosVitDadosTemperatura(objContDados) = valor
		if (coluna = "freqRespiratoria") set $$$VARPEPQuimContDadosVitDadosFreqRespiratoria(objContDados) = valor
		if (coluna = "observacao") set $$$VARPEPQuimContDadosVitDadosObservacao(objContDados) = valor
	}

	Set $$$VARPEPQuimContDadosVitDadosResponsavel(objContDados) = YBED

	quit $$$Save("VARPEPQuimContDadosVitDados",pCodProntuario_$$$COMMA_pSequencia,objContDados,$$$YES)]]></Implementation>
</Method>

<Method name="ExcluirContDadosVitais">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pQuimio,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	quit $$$Kill("VARPEPQuimContDadosVitDados",pCodProntuario_$$$COMMA_pSequencia)]]></Implementation>
</Method>

<Method name="CarregaProdutos">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	set pFiltro 	= $get(%request.Data("pFiltro",1))
	set pKey			= $get(%request.Data("pKey",1))
	set pTake			= $get(%request.Data("pTake",1))
	set pSkip			= $get(%request.Data("pSkip",1))
	set YLOCATION = $get(%request.Data("YLOCATION",1))
	set pContaContabil = $Get(%request.Data("pContaContabil",1))
	
	if (pTake = "") set pTake = 20
	
	set pTake = pTake + pSkip
	set pSkip = pSkip + 1
		
	set meuSQL = "Select * From (Select top "_pTake_" ItemNumber, SearchName From SQLUser.INART "
	set meuSQL = meuSQL_"Where Company = 0 "
	If (pContaContabil '= "") {
		set meuSQL = meuSQL_"And FREE3 in ('"_pContaContabil_"') "
	}
	if (pKey '= "") {
		set meuSQL = meuSQL_"And ItemNumber = '"_pKey_"' "
	}else{
		if (pFiltro'="") {
			set meuSQL = meuSQL_"And %UPPER('('||ItemNumber||') '||SearchName) LIKE %UPPER('%"_pFiltro_"%') "
			;set meuSQL = meuSQL_"And HoldReason = 0 "
		}
	}
	set meuSQL = meuSQL_") Where %VID Between "_pSkip_" and "_pTake_" "
	;
	set objStatement	= ##class(%SQL.Statement).%New() 
	set qStatus 			= objStatement.%Prepare(meuSQL)
	set rSet 					= objStatement.%Execute()
	;
	set arrayDados = []
	;
 	while (rSet.%Next()) {
	 	set codProduto 	= rSet.%Get("ItemNumber")
	 	set descProduto = rSet.%Get("SearchName")
	 	;
	 	set descProdFormatado = "("_codProduto_") "_descProduto
	 	;
		set listDados = {}
		do listDados.%Set("CodProduto", codProduto)
		do listDados.%Set("DescProduto", descProdFormatado)
		do arrayDados.%Push(listDados)
 	}
 	;
 	do arrayDados.%ToJSON()
	quit $$$OK]]></Implementation>
</Method>

<Method name="RecuperaProduto">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProduto</FormalSpec>
<Implementation><![CDATA[	set objINART = $get(^INART(0,pCodProduto,1))

	set descProduto			= $$SQLGetDescricaoProduto^VARSQL(pCodProduto)

	quit "1~"_pCodProduto_"~"_"("_pCodProduto_") "_descProduto]]></Implementation>
</Method>

<Method name="CarregaProfissional">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	set pFiltro 	= $get(%request.Data("pFiltro",1))
	set pFlagExterno = $get(%request.Data("pFlagExterno",1))
	set pKey			= $get(%request.Data("pKey",1))
	set pTake			= $get(%request.Data("pTake",1))
	set pSkip			= $get(%request.Data("pSkip",1))
	set YLOCATION = $get(%request.Data("YLOCATION",1))
	set pLicenseType = $get(%request.Data("pLicenseType",1))
	
	if (pTake = "") set pTake = 20
	
	set pTake = pTake + pSkip
	set pSkip = pSkip + 1
		
	set meuSQL = "Select * From (Select top "_pTake_" ID1, Name, LicenseNumber From SQLUser.MEDProvider  "
	set meuSQL = meuSQL_"Where Company = 0 "
	If (pFlagExterno = "E") {
		set meuSQL = meuSQL_"And NVL(Localizacao,'I') in ('E') "
	}Else{
		;set meuSQL = meuSQL_"And NVL(Localizacao,'I') in ('I') "
	}
	if (pKey '= "") {
		set meuSQL = meuSQL_"And ID1 = '"_pKey_"' "
	} 
	else {
		set meuSQL = meuSQL_"And Status = 1 "
		if (pFiltro'="") {
			set meuSQL = meuSQL_"And (%UPPER('('||LicenseNumber||') '||Name) LIKE %UPPER('%"_pFiltro_"%') "
			set meuSQL = meuSQL_"Or %UPPER(Name) LIKE %UPPER('%"_pFiltro_"%')) "
		}
		if (pLicenseType'="") set meuSQL = meuSQL_"And LicenseType = '"_pLicenseType_"' "
	}
	set meuSQL = meuSQL_"ORDER BY Name"
	set meuSQL = meuSQL_") Where %VID Between "_pSkip_" and "_pTake_" "
	
	set objStatement	= ##class(%SQL.Statement).%New() 
	set qStatus 			= objStatement.%Prepare(meuSQL)
	set rSet 					= objStatement.%Execute()
	;
	set arrayDados = []
	;
 	while (rSet.%Next()) {
	 	set codProvider 	= rSet.%Get("ID1")
	 	set descProvider 	= $$capitalize^VARSQL(rSet.%Get("Name"))
	 	set licenseNumber = rSet.%Get("LicenseNumber")
	 	if (licenseNumber = "") set licenseNumber = codProvider
	 	;
	 	set descProviderFormatado = "("_licenseNumber_") "_descProvider
	 	;
		set listDados = {}
		do listDados.%Set("CodProvider", codProvider)
		do listDados.%Set("DescProvider", descProviderFormatado)
		do listDados.%Set("CRM", licenseNumber)
		do arrayDados.%Push(listDados)
 	}
 	;
 	do arrayDados.%ToJSON()
	quit $$$OK]]></Implementation>
</Method>

<Method name="RecuperaProfissional">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProvider</FormalSpec>
<Implementation><![CDATA[	set objMEDProvider 	= $get(^MEDProvider(0,pCodProvider,1))
	set nameProvider		= $$$MEDProviderName(objMEDProvider)

	quit "1~"_pCodProvider_"~"_"("_pCodProvider_") "_nameProvider]]></Implementation>
</Method>

<Method name="GetAplicMedicamento">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select Sequencia, Data, Hora, PressaoArterial, Pulso, Temperatura,"
	set meuSQL($increment(contador))	= "Medicacao, $$SQLGetDescricaoProduto^VARSQL(Medicacao) As MedicacaoDesc,"
	set meuSQL($increment(contador))	= "Qtde, SolucaoFisiologica, Reacao, Funcionario,"
	set meuSQL($increment(contador))	= "$$SQLGetProviderName^VARSQL(Funcionario) As FuncionarioNome" 
	set meuSQL($increment(contador))	= "From SQLUser.VARPEPQuimioterapiaAplicMedicamento"
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"	
	
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		set list = {}
		set list.sequencia					= rSet.%Get("Sequencia")
		set list.data 							= $select(rSet.%Get("Data")'="":$zdate(rSet.%Get("Data"),2),1:"")
		set list.hora 							= $select(rSet.%Get("Hora")'="":$ztime(rSet.%Get("Hora"),2),1:"")
		set list.pressaoArterial 		= rSet.%Get("PressaoArterial")
		set list.pulso 							= rSet.%Get("Pulso")
		set list.temperatura 				= rSet.%Get("Temperatura")
		set list.medicacao 					= rSet.%Get("Medicacao")
		set list.medicacaoDesc 			= rSet.%Get("MedicacaoDesc")
		set list.qtde 							= rSet.%Get("Qtde")
		set list.solucaoFisiologica = rSet.%Get("SolucaoFisiologica")
		set list.reacao 						= rSet.%Get("Reacao")
		set list.funcionario 				= rSet.%Get("Funcionario")
		set list.funcionarioNome 		= "("_rSet.%Get("Funcionario")_") "_rSet.%Get("FuncionarioNome")
		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmAplicMedicamento">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	
	if (pSequencia = "") {
		set pSequencia = $order(^VARPEPQuimioterapiaAplicMedicamento(YM, pCodProntuario, ""),-1) + 1
	}
	
	set objAplicMedic = $get(^VARPEPQuimioterapiaAplicMedicamento(YM, pCodProntuario, pSequencia, 1))

	set index = "" 
	for {
		set index = $order(pDados(index)) 
		quit:index=""
		
		set coluna	= $piece(pDados(index),"~",1)
		set valor		= $piece(pDados(index),"~",2)

		if (coluna = "data") {
			set $$$VARPEPQuimioterapiaAplicMedicamentoData(objAplicMedic) = $zdateh($piece(valor," ",2,4),7)
		}
		if (coluna = "hora") set $$$VARPEPQuimioterapiaAplicMedicamentoHora(objAplicMedic) = $ztimeh(valor,4,$piece($horolog,",",2))
		if (coluna = "pressaoArterial") set $$$VARPEPQuimioterapiaAplicMedicamentoPressaoArterial(objAplicMedic) = valor
		if (coluna = "pulso") set $$$VARPEPQuimioterapiaAplicMedicamentoPulso(objAplicMedic) = valor
		if (coluna = "temperatura") set $$$VARPEPQuimioterapiaAplicMedicamentoTemperatura(objAplicMedic) = valor
		if (coluna = "medicacao") set $$$VARPEPQuimioterapiaAplicMedicamentoMedicacao(objAplicMedic) = valor
		if (coluna = "qtde") set $$$VARPEPQuimioterapiaAplicMedicamentoQtde(objAplicMedic) = valor
		if (coluna = "solucaoFisiologica") set $$$VARPEPQuimioterapiaAplicMedicamentoSolucaoFisiologica(objAplicMedic) = valor
		if (coluna = "reacao") set $$$VARPEPQuimioterapiaAplicMedicamentoReacao(objAplicMedic) = valor
		if (coluna = "funcionario") set $$$VARPEPQuimioterapiaAplicMedicamentoFuncionario(objAplicMedic) = valor
	}

	quit $$$Save("VARPEPQuimioterapiaAplicMedicamento",pCodProntuario_$$$COMMA_pSequencia,objAplicMedic,$$$YES)]]></Implementation>
</Method>

<Method name="ExcluirAplicMedicamento">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	quit $$$Kill("VARPEPQuimioterapiaAplicMedicamento",pCodProntuario_$$$COMMA_pSequencia)]]></Implementation>
</Method>

<Method name="ArmFinalizar">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 		= 0
	set Y 		= "~"
	set erro 	= ""
	try{
		set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
		set pAdmissao				= $get(%request.Data("pAdmissao",1))
		set pTerminoPedido	= $get(%request.Data("pTerminoPedido",1))
		set pOrigem					= $get(%request.Data("origem",1))
	
		if (pOrigem = "Q") {
			set objPEPTrans = $get(^VARPEPQuimioterapia(YM, pCodProntuario, 1))
			set $$$VARPEPQuimioterapiaTerminodoPedido(objPEPTrans) = pTerminoPedido
			set strStatus	=	$$$Save("VARPEPQuimioterapia", pCodProntuario, objPEPTrans, $$$YES)
		}elseif (pOrigem = "A") {
			set objPEPTrans = $get(^VARPEPAplicacaoMedicamento(YM, pCodProntuario, 1))
			set $$$VARPEPAplicacaoMedicamentoTerminodoPedido(objPEPTrans) = pTerminoPedido
			set strStatus	=	$$$Save("VARPEPAplicacaoMedicamento", pCodProntuario, objPEPTrans, $$$YES)
		}
		

		&sql( Delete From SQLUser.VARPEPLeitoAtendimento Where Company = :YM And Prontuario = :pCodProntuario)
	
		if (SQLCODE '= 0) {
			set erro = "Erro ao liberar leito."
			quit
		}

		set objMEDAdmission	= $get(^MEDAdmission(YM, pAdmissao, 1))
		;set $$$MEDAdmissionBed(objMEDAdmission) 	= ""
		;set $$$MEDAdmissionRoom(objMEDAdmission) 	= ""
		;set $$$MEDAdmissionFREE1(objMEDAdmission)	= ""
		set $$$MEDAdmissionDateDischarged(objMEDAdmission) 	= +$horolog
		set $$$MEDAdmissionTimeDischarged(objMEDAdmission)	= $piece($horolog,",",2)
		set $$$MEDAdmissionStatus(objMEDAdmission)	= 3
		set strStatus = $$$Save("MEDAdmission", pAdmissao, objMEDAdmission, $$$YES)
		
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro			=	err
	}	
	set objRetorno = {}
	if erro=""{
		set objRetorno.status = $$$OK
	}else{
		set objRetorno.status = erro
	}
		
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetPrescricao">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select Sequencia, Descricao, Inicio, Termino" 
	set meuSQL($increment(contador))	= "From SQLUser.VARPEPQuimioterapiaPrescricao"
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"	
	
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		set list = {}
		set list.sequencia	= rSet.%Get("Sequencia")
		set list.descricao	= rSet.%Get("Descricao")
		set list.inicio 		= $select(rSet.%Get("Inicio")'="":$ztime(rSet.%Get("Inicio"),2),1:"")
		set list.termino 		= $select(rSet.%Get("Termino")'="":$ztime(rSet.%Get("Termino"),2),1:"")
		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmPrescricao">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	
	if (pSequencia = "") {
		set pSequencia = $order(^VARPEPQuimioterapiaPrescricao(YM, pCodProntuario, ""),-1) + 1
	}
	
	set objAplicMedic = $get(^VARPEPQuimioterapiaPrescricao(YM, pCodProntuario, pSequencia, 1))

	set index = "" 
	for {
		set index = $order(pDados(index)) 
		quit:index=""
		
		set coluna	= $piece(pDados(index),"~",1)
		set valor		= $piece(pDados(index),"~",2)

		if (coluna = "descricao") set $$$VARPEPQuimioterapiaPrescricaoDescricao(objAplicMedic) = valor
		if (coluna = "inicio") set $$$VARPEPQuimioterapiaPrescricaoInicio(objAplicMedic) = $ztimeh(valor,4,$piece($horolog,",",2))
		if (coluna = "termino") set $$$VARPEPQuimioterapiaPrescricaoTermino(objAplicMedic) = $ztimeh(valor,4,$piece($horolog,",",2))
	}

	quit $$$Save("VARPEPQuimioterapiaPrescricao",pCodProntuario_$$$COMMA_pSequencia,objAplicMedic,$$$YES)]]></Implementation>
</Method>

<Method name="ExcluirPrescricao">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	quit $$$Kill("VARPEPQuimioterapiaPrescricao",pCodProntuario_$$$COMMA_pSequencia)]]></Implementation>
</Method>

<Method name="ImprimirIcones">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	;
	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	set pCodSetor			 = $get(%request.Data("pCodSetor",1))
	;
	set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))
	set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)
	set admissao		 		= $$$VARProntuarioEletronicoNumeroAdmisao(objProntuario)
	;
	set dataNascimento	= $$SQLGetPatientDataNascimento^VARSQL(codPaciente)
	set qtdeAnos				= $$SQLGetPatientAge^VARSQL(dataNascimento)
	;
	do ..RetornaIcones(qtdeAnos, pCodSetor, pCodProntuario, admissao, .rIcones)
	;
	set sequencia = ""
	for {
		set sequencia=$order(rIcones(sequencia))
		quit:sequencia=""
		
		set imagem 	= $piece(rIcones(sequencia),Y,1)
		set title 	= $piece(rIcones(sequencia),Y,2)
		set color 	= $piece(rIcones(sequencia),Y,3)
		if (color?1"") set color="red;"
		write "<i class='"_imagem_"' title='"_title_"' style='color:"_color_";font-size: 20px;'></i>&nbsp;",!
	}
	;
	quit $$$OK]]></Implementation>
</Method>

<Method name="RetornaIcones">
<ClassMethod>1</ClassMethod>
<FormalSpec>pAno,pCodSetor,pCodProntuario,pAdmissao,*rIcones</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	set horaAfericao = $horolog
	set (valorPA, valorPulso, valorTemperatura, valorFreqRespiratoria) = "-"

	set ObjVARProntuarioEletronico = $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))
	set codPaciente = $$$VARProntuarioEletronicoPaciente(ObjVARProntuarioEletronico)	

	if (pCodSetor = "QUIMIOTERAPIA") {
		&SQL(	Select DataHoraAfericao, PressaoArterial, Pulso, Temperatura, FreqRespiratoria 
					Into :horaAfericao, :valorPA, :valorPulso, :valorTemperatura, :valorFreqRespiratoria
					From SQLUser.VARPEPQuimioterapiaContDadosVitais 
					Where Company = :YM And CodigoProntuarioEletronic = :pCodProntuario
					Order By DataHoraAfericao Desc 
				)	
	}
	if (pCodSetor = "TRANSFUSAOSANGUE") {
		&SQL(	Select DataHoraAfericao, PressaoArterial, Pulso, Temperatura, FreqRespiratoria 
					Into :horaAfericao, :valorPA, :valorPulso, :valorTemperatura, :valorFreqRespiratoria
					From SQLUser.VARPEPTransfuncionalEtiquetaDadosVitais
					Where Company = :YM And CodigoProntuarioEletronic = :pCodProntuario
					Order By DataHoraAfericao Desc
				)	
	}
	if (pCodSetor = "SANGRIATERAPEUTICA") {
		set (valorPulso, valorTemperatura, valorFreqRespiratoria) = "-"
		&SQL(	Select Hora, PAPre, TemperaturaPre 
					Into :horaAfericao, :valorPA, :valorTemperatura
					From SQLUser.VARPEPSangriaTerapeuticaDados
					Where Company = :YM And CodigoProntuarioEletronic = :pCodProntuario
					Order By Hora Desc
				)	
		set horaAfericao = +$horolog_","_horaAfericao
	}
	if (pAno >= 60) set rIcones(1) = "fas fa-blind~Idoso~"
	if (pAno >= 80) set rIcones(1) = "fas fa-blind~Idoso~red"
	;<i class="fas fa-wheelchair" title="Cadeirante"></i>&nbsp;					| 
	;<i class="fas fa-bong" title="Aguardando Exame"></i>&nbsp;					| 
	;<i class="fas fa-pills" title="Tomando Medicamento"></i>&nbsp;			| 
	if (valorPA'="" && (valorPA'="-")) {
		if (+$piece(valorPA,"/",1)>140 || (+$piece(valorPA,"/",2)>90)) {
			set rIcones(5) = "fas fa-heartbeat~Pressão Alta~"
		}
		if (+$piece(valorPA,"/",1)<90) {
			set rIcones(5) = "fas fa-heartbeat~Pressão Baixa~"
		}
	}
	if (valorTemperatura'="" && (valorTemperatura'="-")) {
		if (+valorTemperatura>37.8) {
			set rIcones(6) = "fas fa-thermometer-full~Hipertermia~"
		}
		if (+valorTemperatura'=0 && (+valorTemperatura<35)) {
			set rIcones(6) = "fas fa-thermometer-full~Hipotermia~"
		}
	}
	if (valorFreqRespiratoria'="" && (valorFreqRespiratoria'="-")) {
		if (+valorFreqRespiratoria>20) {
			set rIcones(7) = "fas fa-lungs~Frequência Respiratória~"
		}
		if (+valorFreqRespiratoria<12) {
			set rIcones(7) = "fas fa-lungs~Frequência Respiratória~"
		}
	}
	if (valorPulso'="" && (valorPulso'="-")) {
		if (+valorPulso>100) {
			set rIcones(8) = "fas fa-heart~Pulso~"
		}
		if (+valorPulso<60) {
			set rIcones(8) = "fas fa-heart~Pulso~"
		}
	}
	set obj = $get(^MEDPatient(0,codPaciente,1))
	set temAlergia 	= $$$MEDPatientAlergia(obj)
	set alergias 		= $$$MEDPatientAllergies(obj)
	if (temAlergia = 1 || (alergias '= "")) {
		set rIcones(10) = "fas fa-allergies~Alergias: "_alergias_"~"
	}else{
		if (pCodSetor = "APLICACAOMEDICAMENTO") {
			Set alergia = 0
			&SQL(	Select Count(ID) Into :alergia From SQLUser.VARPEPAplicacaoMedicamentoDados
						Where  Company = 0 And CodigoProntuarioEletronic = :pCodProntuario
						And Alergia = '1'
					)
			if (+alergia > 0) set rIcones(10) = "fas fa-allergies~Alergias~"
		}
	}	
	
	set rIcones = horaAfericao_"~"_valorPA_"~"_valorPulso_"~"_valorTemperatura_"~"_valorFreqRespiratoria

	If (pAdmissao '= "") {
		set meuSQL($increment(contador))	= "Select Eventos.ID From SQLUser.VARProntuarioEletronicoEventosAdversos As Eventos"
		set meuSQL($increment(contador))	= "Join SQLUser.VARProntuarioEletronico As Pront"
		set meuSQL($increment(contador))	= "On Pront.Codigo = Eventos.CodigoProntuarioEletronic"
		set meuSQL($increment(contador))	= "Where Eventos.Company = 0 And Pront.NumeroAdmisao = '"_pAdmissao_"'"
		set meuSQL($increment(contador))	= "Union"
		set meuSQL($increment(contador))	= "Select ID From SQLUser.VARPEPAdversos"
		set meuSQL($increment(contador))	= "Where Company = 0 And Passagem = '"_pAdmissao_"'"
		set meuSQL 			= $order(meuSQL(""),-1)
		set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
		If (rSet.%Next()){
			set rIcones(9) = "text-primary fa-blink fas fa-exclamation-triangle'~Eventos Adversos~red"
		}
	}

	If (pCodSetor = "TRANSFUSAOSANGUE") {
		Set (RTSinSintMaisPulso, RTSinSintMenosPulso, RTSinSintMaisPA, RTSinSintMenosPA, RTSinSintFebre) = ""
		Set (RTSinSintCalafrios, RTSinSintDispneia, RTSinSintTremor, RTSinSintVomito, RTSinSintCianose) = ""
		Set (RTSinSintDorLombar, RTSinSintDordeCabeca, RTSinSintDornoTorax, RTSinSintUrticaria, RTSinSintEritema) = ""
		Set (RTSinSintPrurido, RTSinSintSangramentos, RTSinSintUrinaEscura, RTSinSintMenosVolUrinario) = ""
		Set (RTSinSintOutros, RTSinSintOutrosDescrica) = ""
		&SQL(	Select 
						RTSinSintMaisPulso, RTSinSintMenosPulso, RTSinSintMaisPA, RTSinSintMenosPA, RTSinSintFebre,
						RTSinSintCalafrios, RTSinSintDispneia, RTSinSintTremor, RTSinSintVomito, RTSinSintCianose, 
						RTSinSintDorLombar, RTSinSintDordeCabeca, RTSinSintDornoTorax, RTSinSintUrticaria, RTSinSintEritema,
						RTSinSintPrurido, RTSinSintSangramentos, RTSinSintUrinaEscura, RTSinSintMenosVolUrinario, 
						RTSinSintOutros, RTSinSintOutrosDescrica
					Into
						:RTSinSintMaisPulso, :RTSinSintMenosPulso, :RTSinSintMaisPA, :RTSinSintMenosPA, :RTSinSintFebre,
						:RTSinSintCalafrios, :RTSinSintDispneia, :RTSinSintTremor, :RTSinSintVomito, :RTSinSintCianose, 
						:RTSinSintDorLombar, :RTSinSintDordeCabeca, :RTSinSintDornoTorax, :RTSinSintUrticaria, :RTSinSintEritema,
						:RTSinSintPrurido, :RTSinSintSangramentos, :RTSinSintUrinaEscura, :RTSinSintMenosVolUrinario, 
						:RTSinSintOutros, :RTSinSintOutrosDescrica
					From 
						SQLUser.VARPEPTransfuncional
					Where 
						Company = :YM And CodigoProntuarioEletronic =  :pCodProntuario
				)	
		Set sinaisSintomas = "",conctena = ""
		If (+RTSinSintMaisPulso > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "+ Pulso",conctena = ", "
		If (+RTSinSintMenosPulso > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "- Pulso",conctena = ", "
		If (+RTSinSintMaisPA > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "+ P.A.",conctena = ", "
		If (+RTSinSintMenosPA > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "- P.A.",conctena = ", "
		If (+RTSinSintFebre > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Febre",conctena = ", "
		If (+RTSinSintCalafrios > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Calafrios",conctena = ", "
		If (+RTSinSintDispneia > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Dispnéia",conctena = ", "
		If (+RTSinSintTremor > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Tremor",conctena = ", "
		If (+RTSinSintVomito > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Vomito",conctena = ", "
		If (+RTSinSintCianose > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Cianose",conctena = ", "
		If (+RTSinSintDorLombar > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Dor Lombar",conctena = ", "
		If (+RTSinSintDordeCabeca > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Dor de Cabeça",conctena = ", "
		If (+RTSinSintDornoTorax > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Dor no Torax",conctena = ", "
		If (+RTSinSintUrticaria > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Urticária",conctena = ", "
		If (+RTSinSintEritema > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Eritema",conctena = ", "
		If (+RTSinSintPrurido > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Prurido",conctena = ", "
		If (+RTSinSintSangramentos > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Sangramentos",conctena = ", "
		If (+RTSinSintUrinaEscura > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Urina Escura",conctena = ", "
		If (+RTSinSintMenosVolUrinario > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "- Vol. Urinário",conctena = ", "
		If (+RTSinSintOutros > 0) Set sinaisSintomas = sinaisSintomas _ conctena _ "Outro",conctena = ", "
		set:sinaisSintomas'="" rIcones(11) = "text-primary fa-blink fas fa-exclamation-circle~Sinais e Sintomas: "_sinaisSintomas_"~orange"
		
	}
	quit $$$OK]]></Implementation>
</Method>

<Method name="Imprimir">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM = 0 
	set Y  = "~"
	
	set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
	set pTipo 					= $get(%request.Data("pTipo",1))
	set YBED 						= $get(%request.Data("YBED",1))

	set folder = $piece($get(^VARJasper(YM,YM,1)),Y,1)

	if pTipo="T"{	;Termo de Consentimento
		set link=$$Start^VARJasperRun("VARPEPEnfQuimioterapicoTermo")
	}else{
		set link=$$Start^VARJasperRun("VARPEPEnfQuimioterapico")
	}
	set hoje = $zdate($horolog,4)
	set link = $$addUserParameter^VARJasperRun(link,"pDataImpressao","SP, "_hoje)
	set link = $$addUserParameter^VARJasperRun(link,"pCodProntuario",pCodProntuario)
	set link = $$addUserParameter^VARJasperRun(link,"CompiledDir",folder)
	set link = $$addParameter^VARJasperRun(link,YBED,1)
	do ViewInForm^VARJasperRun(link,"Impressao",2)
	
	Quit $$$OK]]></Implementation>
</Method>

<Method name="ImprimirReceituario">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM = 0 
	set Y  = "~"
	
	set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
	set pSequencia 			= $get(%request.Data("pSequencia",1))
	set YBED 						= $get(%request.Data("YBED",1))
	set codProvider 		= $Order(^MEDProviders(0,1,YBED,""))
	set (objMEDProvider, conselho) = ""
	If (codProvider '= "") {
		set objMEDProvider = $Get(^MEDProvider(0,codProvider,1))
		set codConselho = $$$MEDProviderFREE2(objMEDProvider)
		set:codConselho'="" conselho = $p(^INPARA(0,"VARMEDCONSELHO","PT",codConselho,1),"~",1)
	}
	set meses = "Janeiro;Fevereiro;Marco;Abril;Maio;Junho;Julho;Agosto;Setembro;Outubro;Novembro;Dezembro"
	set folder = $piece($get(^VARJasper(YM,YM,1)),Y,1)
	set link=$$Start^VARJasperRun("VARReceituarioEnfermagem")
	set hoje = $zdate($horolog,4)
	set dia = $piece(hoje,"/",1)
	set mes = $piece(meses,";",+$piece(hoje,"/",2))
	set ano = $piece(hoje,"/",3)
	set link=$$addUserParameter^VARJasperRun(link,"pDataImpressao",dia_" de "_mes_" de "_ano)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeMedico",$$$MEDProviderName(objMEDProvider))
	set link=$$addUserParameter^VARJasperRun(link,"pConselho",conselho)
	set link=$$addUserParameter^VARJasperRun(link,"pNumConselho",$$$MEDProviderLicenseNumber(objMEDProvider))
	;
	set email = ""
	set usuario = $$$MEDProviderUser1(objMEDProvider)
	if usuario'=""{
		set objUsuario 	= $get(^WWW013(0,usuario,1))
		set email 		= $$$WWW013EMailAddress(objUsuario)
	}
	;
	set link=$$addUserParameter^VARJasperRun(link,"pEmail",email)
	set link = $$addUserParameter^VARJasperRun(link,"pCodProntuario",pCodProntuario)
	set link = $$addUserParameter^VARJasperRun(link,"pSequencia",pSequencia)
	set link = $$addUserParameter^VARJasperRun(link,"CompiledDir",folder)
	set link = $$addParameter^VARJasperRun(link,YBED,1)
	do ViewInForm^VARJasperRun(link,"Impressao",2)
	Quit $$$OK]]></Implementation>
</Method>

<Method name="ArmEventosAdversos">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 		= 0
	set Y 		= "~"
	set erro 	= ""
	try{
		set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
		set pAdmissao				= $get(%request.Data("pAdmissao",1))
		set pData						= $get(%request.Data("pData",1))
		set pHora						= $get(%request.Data("pHora",1))
		set pDescricao			= $get(%request.Data("pDescricao",1))
		set pConduta				= $get(%request.Data("pConduta",1))
		set YBED						= $get(%request.Data("YBED",1))
		
		if pData="" {
			set pData = +$horolog
		}else{
			set pData = $zdateh($piece(pData," ",2,4),7)	
		}
		if pHora="" {
			set pHora = $piece($horolog,",",2)
		}else{
			set pHora = $ztimeh(pHora,4,$piece($horolog,",",2))
		}
		
		set objEventos = ""
		set $$$VARProntuarioEletronicoEventosAdversosDescricao(objEventos) 	= pDescricao
		set $$$VARProntuarioEletronicoEventosAdversosConduta(objEventos) 		= pConduta
	
		set strStatus	=	$$$Save("VARProntuarioEletronicoEventosAdversos", pCodProntuario_$$$COMMA_pData_$$$COMMA_pHora, objEventos, $$$YES)
	
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro			=	err
	}	
	set objRetorno = {}
	if erro=""{
		set objRetorno.status = $$$OK
	}else{
		set objRetorno.status = erro
	}
		
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetEventosAdversos">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	set pAdmissao = $get(%request.Data("pAdmissao",1))
	Set objAdmission = $G(^MEDAdmission(0,pAdmissao,1))
	Set codPaciente = $$$MEDAdmissionPatient(objAdmission)
	
	set meuSQL($increment(contador))	= "Select Eventos.ID, Eventos.Data, Eventos.Hora, Eventos.Descricao,"
 	set meuSQL($increment(contador))	= "Eventos.Conduta From SQLUser.VARProntuarioEletronicoEventosAdversos As Eventos,"
 	set meuSQL($increment(contador))	= "SQLUser.VARProntuarioEletronico As Pront,"
 	set meuSQL($increment(contador))	= "SQLUser.MEDAdmission As Adm Where Eventos.Company = 0 "
 	set meuSQL($increment(contador))	= "And Pront.Codigo = Eventos.CodigoProntuarioEletronic"
	set meuSQL($increment(contador))	= "And Adm.AdmissionID = Pront.NumeroAdmisao"
 	set meuSQL($increment(contador))	= "And Adm.Patient = '"_codPaciente_"' Order By Eventos.ID Desc"
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
		
	while(rSet.%Next()){

		set listRetorno = {}
		set listRetorno.id = rSet.%Get("ID")
		set listRetorno.data = $zdate(rSet.%Get("Data"),4)
		set listRetorno.hora = $ztime(rSet.%Get("Hora"),2)
		set listRetorno.descricao = rSet.%Get("Descricao")
		set listRetorno.conduta = rSet.%Get("Conduta")
		set listRetorno.local = "E"

		do objRetorno.%Push(listRetorno)
	}
		
	;PEP Médico
	kill meuSQL, contador
	set meuSQL($increment(contador))	= "Select ID, Data, Hora, Descricao, Conduta From SQLUser.VARPEPAdversos"
	set meuSQL($increment(contador))	= "Where Company = 0 And Passagem = '"_pAdmissao_"'"
	set meuSQL 	= $order(meuSQL(""),-1)
	set rSet 		= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
		
	while(rSet.%Next()){

		set listRetorno = {}
		set listRetorno.id = rSet.%Get("ID")
		set listRetorno.data = $zdate(rSet.%Get("Data"),4)
		set listRetorno.hora = $ztime(rSet.%Get("Hora"),2)
		set listRetorno.descricao = rSet.%Get("Descricao")
		set listRetorno.conduta = rSet.%Get("Conduta")
		set listRetorno.local = "M"

		do objRetorno.%Push(listRetorno)
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ExcluirEventosAdversos">
<ClassMethod>1</ClassMethod>
<FormalSpec>pId,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM 		= 0
	set Y 		= "~"

	if (pId = "") quit $$$OK
		
	quit $$$Kill("VARProntuarioEletronicoEventosAdversos",$piece(pId,"||",2)_$$$COMMA_$piece(pId,"||",3)_$$$COMMA_$piece(pId,"||",4))]]></Implementation>
</Method>

<Method name="RecuperaUltimoEventoAdverso">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	set pAdmissao				= $get(%request.Data("pAdmissao",1))
	Set objMEDAdmission	= $Get(^MEDAdmission(0, pAdmissao, 1))
	Set codPaciente		= $$$MEDAdmissionPatient(objMEDAdmission)
	
	set meuSQL($increment(contador))	= "Select Top 1 Eventos.ID, Eventos.Data, Eventos.Hora, Eventos.Descricao,"
	set meuSQL($increment(contador))	= "Eventos.Conduta From SQLUser.VARProntuarioEletronicoEventosAdversos As Eventos"
	set meuSQL($increment(contador))	= "Join SQLUser.VARProntuarioEletronico As Pront"
	set meuSQL($increment(contador))	= "On Pront.Codigo = Eventos.CodigoProntuarioEletronic"
	set meuSQL($increment(contador))	= "Where Eventos.Company = 0 And Pront.Paciente = '"_codPaciente_"'" ;Pront.NumeroAdmisao = '"_pAdmissao_"'"
	set meuSQL($increment(contador))	= "Order By Eventos.Data Desc, Eventos.Hora Desc"
	
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set listRetorno = {}
		
	while(rSet.%Next()){
		set listRetorno.data = $zdate(rSet.%Get("Data"),4)
		set listRetorno.hora = $ztime(rSet.%Get("Hora"),2)
		set listRetorno.descricao = rSet.%Get("Descricao")
		set listRetorno.conduta = rSet.%Get("Conduta")
	}

	do listRetorno.%ToJSON()

	Quit $$$OK]]></Implementation>
</Method>

<Method name="GetQuimio">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select Quimio From sqlUSER.VARPEPQuimContDadosVitaisQuimio "
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"	
	
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		
		set list = {}
		set list.quimio	= rSet.%Get("Quimio")
		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmQuimio">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	tstart
	set strStatus	=	""
	set erro			=	0
	try{
		set pCodProntuario = $get(%request.Data("pCodProntuario",1))
		set pQuimio = $get(%request.Data("pQuimio",1))
		set pMedicamento = $get(%request.Data("pMedicamento",1))
		set pDose = $get(%request.Data("pDose",1))
		set pDiluente = $get(%request.Data("pDiluente",1))
		set pViaInfusao = $get(%request.Data("pViaInfusao",1))
		set pTempoInfusao = $get(%request.Data("pTempoInfusao",1))
		set pDataInicio = $get(%request.Data("pDataInicio",1))
		set pHoraInício = $get(%request.Data("pHoraInício",1))
		set pDataTermino = $get(%request.Data("pDataTermino",1))
		set pHoraTermino = $get(%request.Data("pHoraTermino",1))
		set pInteracaoConduta = $get(%request.Data("pInteracaoConduta",1))
		;	
		If (pQuimio = "") {
			Set pQuimio = $Order(^VARPEPQuimContDadosVitaisQuimio(YM, pCodProntuario, ""),-1) + 1	
		}
		If (pDataInicio="") {
			Set pDataInicio = +$horolog
		}Else{
			Set pDataInicio = $zdateh(pDataInicio,4,,,,,,,+$horolog)
		}
		If (pHoraInício="") {
			Set pHoraInício = $Piece($Horolog,",",2)
		}else{
			Set pHoraInício = $ztimeh(pHoraInício,2,$Piece($Horolog,",",2))
		}
		If (pDataTermino'="") {
			Set pDataTermino = $zdateh(pDataTermino,4,,,,,,,+$horolog)
		}
		If (pHoraTermino'="") {
			Set pHoraTermino = $ztimeh(pHoraTermino,2,$Piece($Horolog,",",2))
		}
		;
		set objPEPQumio = $get(^VARPEPQuimContDadosVitaisQuimio(YM, pCodProntuario, pQuimio, 1))
		set $$$VARPEPQuimContDadosVitaisQuimioMedicamento(objPEPQumio) = pMedicamento
		set $$$VARPEPQuimContDadosVitaisQuimioDose(objPEPQumio) = pDose
		set $$$VARPEPQuimContDadosVitaisQuimioDiluente(objPEPQumio) = pDiluente
		set $$$VARPEPQuimContDadosVitaisQuimioViadeInfusao(objPEPQumio) = pViaInfusao
		set $$$VARPEPQuimContDadosVitaisQuimioTempodeInfusao(objPEPQumio) = pTempoInfusao
		set $$$VARPEPQuimContDadosVitaisQuimioDatadeInicio(objPEPQumio) = pDataInicio
		set $$$VARPEPQuimContDadosVitaisQuimioHoradeInicio(objPEPQumio) = pHoraInício
		set $$$VARPEPQuimContDadosVitaisQuimioDatadeTermino(objPEPQumio) = pDataTermino
		set $$$VARPEPQuimContDadosVitaisQuimioHoradeTermino(objPEPQumio) = pHoraTermino
		set $$$VARPEPQuimContDadosVitaisQuimioInteracaoConduta(objPEPQumio) = pInteracaoConduta
		;
		set strStatus	=	$$$Save("VARPEPQuimContDadosVitaisQuimio", pCodProntuario_$$$COMMA_pQuimio, objPEPQumio, $$$YES)
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro	=	err
	}
	set retorno = {}
	if 'erro{
		tcommit
		set retorno.status = strStatus
	}else{
		trollback
		set retorno.status = strStatus
	}
	do retorno.%ToJSON()
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetDadosQuimio">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	set pCodProntuario	= $get(%request.Data("pCodProntuario",1))
	set pQuimio 				= $get(%request.Data("pQuimio",1))
		
	set objPEPQuimio = ""
	if (pQuimio '= "") {
		set objPEPQuimio = $get(^VARPEPQuimContDadosVitaisQuimio(0, pCodProntuario, pQuimio, 1))
	}
	Set codMedicamento = $$$VARPEPQuimContDadosVitaisQuimioMedicamento(objPEPQuimio)
	Set descMedicamento = $$SQLGetDescricaoProduto^VARSQL(codMedicamento)
	set listRetorno = {}
	set listRetorno.medicamento = $$$VARPEPQuimContDadosVitaisQuimioMedicamento(objPEPQuimio)
	set listRetorno.descMedicamento = descMedicamento
	set listRetorno.dose =  $$$VARPEPQuimContDadosVitaisQuimioDose(objPEPQuimio)
	set listRetorno.diluente =  $$$VARPEPQuimContDadosVitaisQuimioDiluente(objPEPQuimio)
	set listRetorno.viadeInfusao = $$$VARPEPQuimContDadosVitaisQuimioViadeInfusao(objPEPQuimio)
	set listRetorno.tempodeInfusao = $$$VARPEPQuimContDadosVitaisQuimioTempodeInfusao(objPEPQuimio)
	set listRetorno.dataInicio = $Select($$$VARPEPQuimContDadosVitaisQuimioDatadeInicio(objPEPQuimio)="":"",1:$ZD($$$VARPEPQuimContDadosVitaisQuimioDatadeInicio(objPEPQuimio),1))
	set listRetorno.dataInicioExterno = $Select($$$VARPEPQuimContDadosVitaisQuimioDatadeInicio(objPEPQuimio)="":"",1:$ZD($$$VARPEPQuimContDadosVitaisQuimioDatadeInicio(objPEPQuimio),4))
	set listRetorno.horaInicio = $Select($$$VARPEPQuimContDadosVitaisQuimioHoradeInicio(objPEPQuimio)="":"",1:$ZT($$$VARPEPQuimContDadosVitaisQuimioHoradeInicio(objPEPQuimio),2))
	set listRetorno.dataTermino = $Select($$$VARPEPQuimContDadosVitaisQuimioDatadeTermino(objPEPQuimio)="":"",1:$ZD($$$VARPEPQuimContDadosVitaisQuimioDatadeTermino(objPEPQuimio),1))
	set listRetorno.dataTerminoExterno = $Select($$$VARPEPQuimContDadosVitaisQuimioDatadeTermino(objPEPQuimio)="":"",1:$ZD($$$VARPEPQuimContDadosVitaisQuimioDatadeTermino(objPEPQuimio),4))
	set listRetorno.horaTermino = $Select($$$VARPEPQuimContDadosVitaisQuimioHoradeTermino(objPEPQuimio)="":"",1:$ZT($$$VARPEPQuimContDadosVitaisQuimioHoradeTermino(objPEPQuimio),2))
	set listRetorno.interacaoConduta = $$$VARPEPQuimContDadosVitaisQuimioInteracaoConduta(objPEPQuimio)
	set listRetorno.status = $Select($$$VARPEPQuimContDadosVitaisQuimioDatadeTermino(objPEPQuimio)="":0,1:1)
	If (listRetorno.medicamento '= "") {
		set objChecaInteracoes = ..ChecaInteracoes(pCodProntuario, listRetorno.medicamento)
		if (objChecaInteracoes.status = 1){
			set listRetorno.interacaoProduto = objChecaInteracoes.mensagem
		}else{
			set listRetorno.interacaoProduto = ""
		}
	}else{
		set listRetorno.interacaoProduto = ""
	}
	do listRetorno.%ToJSON()

	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmFinalizarQuimio">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	
	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set pQuimio 				= $Get(%request.Data("pQuimio",1))
	
	set objPEPQuimio = $get(^VARPEPQuimContDadosVitaisQuimio(0, pCodProntuario, pQuimio, 1))
	set $$$VARPEPQuimContDadosVitaisQuimioDatadeTermino(objPEPQuimio) = +$Horolog
	set $$$VARPEPQuimContDadosVitaisQuimioHoradeTermino(objPEPQuimio) = $Piece($Horolog,",",2)
	;
	set strStatus	=	$$$Save("VARPEPQuimContDadosVitaisQuimio", pCodProntuario_$$$COMMA_pQuimio, objPEPQuimio, $$$YES)
	
	Write strStatus
	
	Quit strStatus]]></Implementation>
</Method>

<Method name="recReceitas">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	Set pCodProntuario = $Get(%request.Data("pCodProntuario",1))
	set retorno = []
	Set meuSQL = "Select NumerodaLinha, Receituario, RemoveDataHoraImpressao "
	Set meuSQL = meuSQL _ "From SQLUser.VARPEPReceituarioEnfermagem "
	Set meuSQL = meuSQL _ "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"
	set rs = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
	while(rs.%Next()){
		set linha = {}
		set linha.SeqReceita 	= rs.%Get("NumerodaLinha")
		set linha.Receituario = rs.%Get("Receituario")
		set linha.removeDataHoraImp = +rs.%Get("RemoveDataHoraImpressao")
		set linha.removeDataHoraImpExt = $select(rs.%Get("RemoveDataHoraImpressao")="1":"Sim",1:"Não")
		do retorno.%Push(linha)
	}
	write retorno.%ToJSON()
	quit]]></Implementation>
</Method>

<Method name="addReceita">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	Set pCodProntuario = $Get(%request.Data("pCodProntuario",1))
	set nseq = $get(%request.Data("nseq",1))
	set receita = $get(%request.Data("receita",1))
	set removeDataHoraImp = $get(%request.Data("impressao",1))
	if (receita'=""){ 
		set:nseq="" nseq = $order(^VARPEPReceituarioEnfermagem(0, pCodProntuario, ""),-1)+1
		set ^VARPEPReceituarioEnfermagem(0, pCodProntuario, nseq, 1)=receita_"~"_removeDataHoraImp
	}
	write 1
	quit]]></Implementation>
</Method>

<Method name="deletaReceita">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	Set pCodProntuario = $Get(%request.Data("pCodProntuario",1))
	set codigo = $get(%request.Data("codigo",1))
	if (codigo'=""){ 
		kill ^VARPEPReceituarioEnfermagem(0, pCodProntuario, codigo)
	}
	write 1
	quit]]></Implementation>
</Method>

<Method name="recDeclaracoes">
<Description><![CDATA[/////////////////////]]></Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	Set pCodProntuario = $Get(%request.Data("pCodProntuario",1))
	set retorno = []
	Set meuSQL = "Select NumerodaLinha, Declaracao, RemoveDataHoraImpressao "
	Set meuSQL = meuSQL _ "From SQLUser.VARPEPDeclaracaoEnfermagem "
	Set meuSQL = meuSQL _ "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"
	set rs = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
	while(rs.%Next()){
		set linha = {}
		set linha.SeqDeclaracao	= rs.%Get("NumerodaLinha")
		set linha.Declaracao = rs.%Get("Declaracao")
		set linha.removeDataHoraImp = +rs.%Get("RemoveDataHoraImpressao")
		set linha.removeDataHoraImpExt = $select(rs.%Get("RemoveDataHoraImpressao")="1":"Sim",1:"Não")
		do retorno.%Push(linha)
	}
	write retorno.%ToJSON()
	quit]]></Implementation>
</Method>

<Method name="addDeclaracao">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	Set pCodProntuario = $Get(%request.Data("pCodProntuario",1))
	set nseq = $get(%request.Data("nseq",1))
	set declaracao = $get(%request.Data("declaracao",1))
	set removeDataHoraImp = $get(%request.Data("impressao",1))
	if (declaracao'=""){ 
		set:nseq="" nseq = $order(^VARPEPDeclaracaoEnfermagem(0, pCodProntuario, ""),-1)+1
		set ^VARPEPDeclaracaoEnfermagem(0, pCodProntuario, nseq, 1)=declaracao_"~"_removeDataHoraImp
	}
	write 1
	quit]]></Implementation>
</Method>

<Method name="deletaDeclaracao">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	Set pCodProntuario = $Get(%request.Data("pCodProntuario",1))
	set codigo = $get(%request.Data("codigo",1))
	if (codigo'=""){ 
		kill ^VARPEPDeclaracaoEnfermagem(0, pCodProntuario, codigo)
	}
	write 1
	quit]]></Implementation>
</Method>

<Method name="ImprimirDeclaracao">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM = 0 
	set Y  = "~"
	
	set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
	set pSequencia 			= $get(%request.Data("pSequencia",1))
	set YBED 						= $get(%request.Data("YBED",1))
	set codProvider 		= $Order(^MEDProviders(0,1,YBED,""))
	set (objMEDProvider, conselho) = ""
	If (codProvider '= "") {
		set objMEDProvider = $Get(^MEDProvider(0,codProvider,1))
		set codConselho = $$$MEDProviderFREE2(objMEDProvider)
		set:codConselho'="" conselho = $p(^INPARA(0,"VARMEDCONSELHO","PT",codConselho,1),"~",1)
	}
	set meses = "Janeiro;Fevereiro;Marco;Abril;Maio;Junho;Julho;Agosto;Setembro;Outubro;Novembro;Dezembro"
	set folder = $piece($get(^VARJasper(YM,YM,1)),Y,1)
	set link=$$Start^VARJasperRun("VARDeclaracaoEnfermagem")
	set hoje = $zdate($horolog,4)
	set dia = $piece(hoje,"/",1)
	set mes = $piece(meses,";",+$piece(hoje,"/",2))
	set ano = $piece(hoje,"/",3)
	set link=$$addUserParameter^VARJasperRun(link,"pDataImpressao",dia_" de "_mes_" de "_ano)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeMedico",$$$MEDProviderName(objMEDProvider))
	set link=$$addUserParameter^VARJasperRun(link,"pConselho",conselho)
	set link=$$addUserParameter^VARJasperRun(link,"pNumConselho",$$$MEDProviderLicenseNumber(objMEDProvider))
	set email = ""
	set usuario = $$$MEDProviderUser1(objMEDProvider)
	if usuario'=""{
		set objUsuario 	= $get(^WWW013(0,usuario,1))
		set email 		= $$$WWW013EMailAddress(objUsuario)
	}
	set link=$$addUserParameter^VARJasperRun(link,"pEmail",email)
	set link = $$addUserParameter^VARJasperRun(link,"pCodProntuario",pCodProntuario)
	set link = $$addUserParameter^VARJasperRun(link,"pSequencia",pSequencia)
	set link = $$addUserParameter^VARJasperRun(link,"CompiledDir",folder)
	set link = $$addParameter^VARJasperRun(link,YBED,1)
	do ViewInForm^VARJasperRun(link,"Impressao",2)
	Quit $$$OK]]></Implementation>
</Method>

<Method name="ArmIntercorrencias">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 		= 0
	set Y 		= "~"
	set erro 	= ""
	try{
		set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
		set pAdmissao				= $get(%request.Data("pAdmissao",1))
		set pData						= $get(%request.Data("pData",1))
		set pHora						= $get(%request.Data("pHora",1))
		set pDescricao			= $get(%request.Data("pDescricao",1))
		set YBED						= $get(%request.Data("YBED",1))
		
		if pData="" {
			set pData = +$horolog
		}else{
			set pData = $zdateh(pData,4)	
		}
		if pHora="" {
			set pHora = $piece($horolog,",",2)
		}else{
			set pHora = $ztimeh(pHora,2)
		}
		
		set objIntercorrencias = $Get(^VARPEPIntercorrenciasEnfermagem(0, pCodProntuario, pData, pHora, 1))
		set $$$VARPEPIntercorrenciasEnfermagemDescricao(objItercorrencias) = pDescricao
	
		set strStatus	=	$$$Save("VARPEPIntercorrenciasEnfermagem", pCodProntuario_$$$COMMA_pData_$$$COMMA_pHora, objItercorrencias, $$$YES)
	
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro			=	err
	}	
	set objRetorno = {}
	if erro=""{
		set objRetorno.status = $$$OK
	}else{
		set objRetorno.status = erro
	}
		
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetIntercorrencias">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	
	set meuSQL($increment(contador))	= "Select ID, DataCadastro, HoraCadastro, Descricao "
	set meuSQL($increment(contador))	= "From VARPEPIntercorrenciasEnfermagem "
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"' "
	set meuSQL($increment(contador))	= "Order By DataCadastro Desc, HoraCadastro Desc"
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
		
	while(rSet.%Next()){

		set listRetorno = {}
		set listRetorno.ID = rSet.%Get("ID")
		set listRetorno.data = $zdate(rSet.%Get("DataCadastro"),4)
		set listRetorno.hora = $ztime(rSet.%Get("HoraCadastro"))
		set listRetorno.descricao = rSet.%Get("Descricao")
		
		do objRetorno.%Push(listRetorno)
	}
		
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ExcluirIntercorrencias">
<ClassMethod>1</ClassMethod>
<FormalSpec>pId,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM 		= 0
	set Y 		= "~"

	if (pId = "") quit $$$OK
		
	quit $$$Kill("VARPEPIntercorrenciasEnfermagem",$piece(pId,"||",2)_$$$COMMA_$piece(pId,"||",3)_$$$COMMA_$piece(pId,"||",4))]]></Implementation>
</Method>

<Method name="recuperarEtiqueta">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	Set pCodProntuario = $Get(%request.Data("pCodProntuario",1))
	Set pAdmissao = $Get(%request.Data("pAdmissao",1))
	Set YBED = $Get(%request.Data("YBED",1))
	
	Set objMEDAdmission	= $Get(^MEDAdmission(0, pAdmissao, 1))
	Set codPaciente		= $$$MEDAdmissionPatient(objMEDAdmission)
	
	Set objMEDPatient = $Get(^MEDPatient(0, codPaciente, 1))
	
	Set listRetorno = {}
	Set listRetorno.paciente = $$SQLGetTextoSemAcento^VARSQL($ZCVT($$$MEDPatientName(objMEDPatient),"U")) 
	Set listRetorno.dataAdm = $ZD($$$MEDAdmissionDateAdmitted(objMEDAdmission),4)
	Set listRetorno.dataNasc = $ZD($$$MEDPatientDOB(objMEDPatient),4)
	Set listRetorno.prontuario = $$SQLGetPatientProntuario^VARSQL(codPaciente) 
	Set listRetorno.mae = $$SQLGetTextoSemAcento^VARSQL($ZCVT($$$MEDPatientMothersName(objMEDPatient),"U")) 
	Set listRetorno.medico = $ZCVT("","U")
	Set listRetorno.responsavel = $$SQLGetTextoSemAcento^VARSQL($ZCVT($$SQLGetUserName^VARSQL(YBED),"U"))

	Write listRetorno.%ToJSON()

	
	Quit $$$OK]]></Implementation>
</Method>

<Method name="getArquivos">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YGIF 			= $get(%request.Data("YGIF",1))
	;set pAdmissao = $TR($Get(%request.Data("pAdmissao",1)),"/","_")
	set pAdmissao 	= $Get(%request.Data("pAdmissao",1))
	Set codPaciente = $Piece(^MEDAdmission(0, pAdmissao, 1),"~",1)
	Set fileset=##class(%ResultSet).%New("%Library.File:FileSet")
	Set empresa 	= 0
	Set modulo 		= 16
	Set dname = $$GetDiretorioFisico^VARBRDiretorios(empresa,modulo)
	If ($extract(dname, $length(dname)) '= "\") {
		Set dname = dname _ "\"
	}
	set dname = dname _ codPaciente
	set sc=fileset.Execute(##class(%File).NormalizeDirectory(dname),"*",,1)
	set array = []
	while fileset.Next(.sc) { 
		set arquivo = $piece(fileset.Get("Name"),"\",$l(fileset.Get("Name"),"\"))
		set dataModificacao = fileset.Get("DateModified")
		Set dataModificacao = $ZDATE($ZDATEH($Piece(dataModificacao," ",1),3),4)_" "_$Piece(dataModificacao," ",2)
		
		set name = $piece($piece(fileset.Get("Name"),"\",$l(fileset.Get("Name"),"\")),".",1) 
		Set list = {}
		set list.Documento = name
		set list.dataModificacao = dataModificacao
		set list.Arquivo = YGIF_"PEP/Enfermagem/"_codPaciente_"/"_arquivo //fileset.Get("Name")
		do array.%Push(list)
	}
	Do array.%ToJSON()
	Quit $$$OK]]></Implementation>
</Method>

<Method name="removerArquivo">
<ClassMethod>1</ClassMethod>
<FormalSpec>pArquivo</FormalSpec>
<Implementation><![CDATA[	Set arquivo = $Replace(pArquivo,"/","\")
	Set arquivo = $Piece(arquivo,"\",$length(arquivo,"\")-1,$length(arquivo,"\"))
	;
	Set modulo 	= 16
	Set empresa = 0
		
	Set dname = $$GetDiretorioFisico^VARBRDiretorios(empresa,modulo)
	If ($extract(dname, $length(dname)) '= "\") {
		Set dname = dname _ "\"
	}
	if (##class(%File).Exists(dname_arquivo)){
		do ##class(%File).Delete(dname_arquivo)
	}
	quit $$$OK]]></Implementation>
</Method>

<Method name="getCID">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	set codigo = $get(%request.Data("codigo",1))
	Set take 	= $Get(%request.Data("take",1))
	Set skip 	= $Get(%request.Data("skip",1))
	Set searchValue = $Get(%request.Data("searchValue",1))
	Set filter = $Get(%request.Data("filter",1))
	if filter'=""{
		set objFilter = [].%FromJSON(filter)
		set filter=""
		if objFilter.%Size()>0{
			set pri=1
			for {
				set campo = objFilter.%Pop()
				quit:campo=""
				if campo="Codigo" set campo="CodigodoCID"
				if $isObject(campo){
					set pri1=1,pri=0
					if campo.%Size()>0{		
						for {
							set campo1 = campo.%Pop()
							quit:campo1=""
							if campo1="Codigo" set campo1="CodigodoCID"
							set filter = $select(pri1:"'",1:"")_campo1_$select(pri1:"'",1:"")_" "_filter
							set pri1=0
						}
					}	
				}else{
					set filter = $select(pri:"'",1:"")_campo_$select(pri:"'",1:"")_" "_filter
					set pri=0
				}
				
			}
		}
	}
	set top = take
	if top<=0 set top = 200
	set contador = 0
	set SQL = " SELECT Count(*) as totalCount,CodigodoCID, DescricaoCompleta,DescricaoResumida,Categoria FROM VARCID where company = 0 "
	if filter '= "" {
		set SQL = SQL_" and ("_filter_") "
	}elseif codigo '= "" {
		set SQL = SQL_" and CodigodoCID = '"_codigo_"' "
	}else{
		if searchValue'="" set SQL = SQL_" and (%upper(CodigodoCID) like %upper('%"_searchValue_"%') or %upper(DescricaoCompleta) like %upper('%"_searchValue_"%'))"
	}
	set meuSelect = "select * from ("_SQL_")"
	if skip'="" set meuSelect=meuSelect_" where %VID between "_(skip+1)_" and "_(skip+take)_""
	set rs = ##class(%SQL.Statement).%ExecDirect("",meuSelect)
	set array = []
	set Total = 0
	while(rs.%Next()){
		set totalCount=rs.%Get("totalCount")
		set ID=rs.%Get("CodigodoCID")
		set DescR=rs.%Get("DescricaoResumida")
		set Name=rs.%Get("DescricaoCompleta")
		if Name="" set Name = DescR
		set Categoria=rs.%Get("Categoria")
		set retorno(Categoria,ID) = Name
		set descCat = $piece(^VARCIDCategorias(0,Categoria,1),"~",4)
		;
		set linha = {}
		set linha.Codigo = ID
		set linha.Descricao = "("_ID_") "_Name
		set linha.Categoria = descCat
		do array.%Push(linha)
	}
	write array.%ToJSON()
	quit
	set retorno = []
	set Categoria=""
	for {
		set Categoria = $order(retorno(Categoria)) quit:Categoria=""
		set descCat = $piece(^VARCIDCategorias(0,Categoria,1),"~",4)
		set grupo = {}
		set grupo.key = descCat
		set array = []
		set id=""
		for {
			set id = $order(retorno(Categoria,id)) quit:id=""
			set nome = retorno(Categoria,id)
			set linha = {}
			set linha.Codigo = id
			set linha.Descricao = "("_id_") "_nome
			do array.%Push(linha)
		}
		set grupo.items = array
		do retorno.%Push(grupo)
	}
	set ret = {}
	set ret.data = retorno
	set ret.totalCount = totalCount
	write ret.%ToJSON()
	quit $$$OK]]></Implementation>
</Method>

<Method name="getListCID">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	set SQL = "Select CodigodoCID, DescricaoResumida, Categoria, $$GetDescCategoriaCID^VARSQL(Categoria) AS DescCategoria From SQLUser.VARCID"
	set rs = ##class(%SQL.Statement).%ExecDirect("",SQL)
	set array = []
	while(rs.%Next()){
		;
		set linha = {}
		set linha.CodigodoCID = rs.%Get("CodigodoCID")
		set linha.DescricaoResumida = rs.%Get("DescricaoResumida")
		set linha.DescCategoria = rs.%Get("DescCategoria")
		do array.%Push(linha)
	}
	write array.%ToJSON()
	quit]]></Implementation>
</Method>

<Method name="ChecaInteracoes">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario="",pCodProduto=""</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	Set status = 0
	Set mensagem = ""
	Set retorno = 1
	If (pCodProduto = "") {
		set pCodProntuario = $get(%request.Data("pCodProntuario",1))
		set pCodProduto	= $get(%request.Data("pCodProduto",1))
		Set retorno = 0
	}	
	If (pCodProduto '= "") {
		set objPEPQuimAnamnese = $get(^VARPEPQuimioterapiaAnamnese(YM, pCodProntuario, 1))
		set medicamentoUso = $$$VARPEPQuimioterapiaAnamneseMedicacaoemUso(objPEPQuimAnamnese)
		
		If (medicamentoUso '= "") {
			for i=1:1:$length(medicamentoUso,";") {
				if ($piece(medicamentoUso,";",i)="") continue
				set xProduto = $piece(medicamentoUso,";",i)
				if ($Data(^MEDDrugInteraction(0,xProduto,pCodProduto))) {
					Set objMEDDrugInteraction = $Get(^MEDDrugInteraction(0,xProduto,pCodProduto,1))
					If ($$$MEDDrugInteractionActive1(objMEDDrugInteraction) = 1) {				
						Set objINART = $Get(^INART(0, xProduto, 1))
						Set status = 1
						Set mensagem = "Interações Medicamentosas com o produto "_$$$INARTSearchName(objINART)_"."
						Quit	
					}
				}
				if ($Data(^MEDDrugInteraction(0,pCodProduto,xProduto))) {
					Set objMEDDrugInteraction = $Get(^MEDDrugInteraction(0,pCodProduto,xProduto,1))
					If ($$$MEDDrugInteractionActive1(objMEDDrugInteraction) = 1) {				
						Set objINART = $Get(^INART(0, xProduto, 1))
						Set status = 1
						Set mensagem = "Interações Medicamentosas com o produto "_$$$INARTSearchName(objINART)_"."
						Quit	
					}
				}
			}	
		}
	}
	;
	set linha = {}
	set linha.status = status
	set linha.mensagem = mensagem
	;
	If (retorno = 0) {
		write linha.%ToJSON()
		Quit $$$OK
	}Else{
		Quit linha
	}]]></Implementation>
</Method>

<Method name="GetPrescricaoAtendimento">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	Set pCodProntuario = $Get(%request.Data("pCodProntuario",1))
	;
	set objProntuario 	= $get(^VARProntuarioEletronico(0, pCodProntuario, 1))	
	set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)
	;If ($$$VARProntuarioEletronicoSetor(objProntuario) = "TRANSFUSAOSANGUE") {
	;	Set meuSQL = "Select * From SQLUser.VARPEPPrescricaoAtendimento Where Company = 0 And " _
	;	"CodigoProntuarioEletronic = '"_pCodProntuario_"'"
	;}Else{
		Set meuSQL = "SELECT CodigoProntuarioEletronic,Atendimento.ID ID,Atendimento.Data Data,Atendimento.hora Hora, "
		set meuSQL = meuSQL_" Atendimento.Medicamento Medicamento,Atendimento.Dose Dose,Atendimento.ObservacaoMedico ObservacaoMedico, "
		set meuSQL = meuSQL_" Atendimento.ResponsavelMedico ResponsavelMedico,Atendimento.DataHoraEnfermagem DataHoraEnfermagem, "
		set meuSQL = meuSQL_" Atendimento.ObservacaoEnfermagem ObservacaoEnfermagem,Atendimento.ResponsavelEnfermagem ResponsavelEnfermagem, "
		set meuSQL = meuSQL_" Atendimento.Status Status, Atendimento.DataHoraMedico DataHoraMedico "
		set meuSQL = meuSQL_" FROM VARProntuarioEletronico PEP "
		set meuSQL = meuSQL_" inner join VARPEPPrescricaoAtendimento Atendimento " 
		set meuSQL = meuSQL_" on Atendimento.Company=0 and Atendimento.CodigoProntuarioEletronic = PEP.Codigo "
		set meuSQL = meuSQL_" WHERE PEP.Company=0 and PEP.Paciente = '"_codPaciente_"'"
		set meuSQL = meuSQL_" order by Atendimento.data desc, Atendimento.hora desc"
	;}
	;
	Set rS = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
	Set retorno = []
	While(rS.%Next()){
		set consultaAtual = $select(rS.%Get("CodigoProntuarioEletronic")=pCodProntuario:1,1:0)
		Set linha = {}
		Set linha.id = rS.%Get("ID")
		Set linha.dataHoraMedico = $ZDate(rS.%Get("DataHoraMedico"),3)_"T"_$ZTime($Piece(rS.%Get("DataHoraMedico"),",",2),2)
		Set linha.codMedicamento = rS.%Get("Medicamento")
		Set linha.descMedicamento = "("_rS.%Get("Medicamento")_") "_$$SQLGetDescricaoProduto^VARSQL(rS.%Get("Medicamento"))
		Set linha.dose = rS.%Get("Dose")
		Set linha.observacaoMedico = rS.%Get("ObservacaoMedico")
		Set linha.responsavelMedico = $$SQLGetUserName^VARSQL(rS.%Get("ResponsavelMedico"))
		Set linha.dataHoraEnfermagem = $Select(rS.%Get("DataHoraEnfermagem")="":"",1:$Zdate(rS.%Get("DataHoraEnfermagem"),3)_" "_$ZTime($Piece(rS.%Get("DataHoraEnfermagem"),",",2),2))
		Set linha.observacaoEnfermagem = rS.%Get("ObservacaoEnfermagem")
		Set linha.responsavelEnfermagem = $$SQLGetUserName^VARSQL(rS.%Get("ResponsavelEnfermagem"))
		Set linha.status = rS.%Get("Status")
		Set linha.statusDesc = $Select(rS.%Get("Status")="CA":"Cancelado",rS.%Get("Status")="AP":"Aplicado",1:"Aguard. Aplicação")
		Set linha.consultaAtual = consultaAtual
		Do retorno.%Push(linha)
	}
	Do retorno.%ToJSON()
	Return]]></Implementation>
</Method>

<Method name="ArmPrescricaoAtendimento">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pFlagUsuarioMedico,pId,objDados,pYBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	Set YM 		= 0
	Set Y	 		= "~"
	Set YBED 	= pYBED
	
	If (pId '= "") {
		Set data = $Piece(pId,"||",3) 	
		Set hora = $Piece(pId,"||",4) 	
	}else{
		Set data = +$Horolog 	
		Set hora = $Piece($Horolog,",",2) 	
	}
	
	Set (dataMedico, horaMedico) = ""
	
	Set objVARPEPPrescricaoAtendimento = $Get(^VARPEPPrescricaoAtendimento(YM, pCodProntuario, data, hora, 1))
	
	set index = "" 
	for {
		set index = $order(objDados(index)) 
		quit:index=""
		
		If ($piece(objDados(index),"~",1) = "codMedicamento") {
			Set $$$VARPEPPrescricaoAtendimentoMedicamento(objVARPEPPrescricaoAtendimento) = $piece(objDados(index),"~",2)
		}
		If ($piece(objDados(index),"~",1) = "dataHoraMedico") {
			Set dataMedico = $ZDateH($Piece($Piece(objDados(index),"~",2),"T",1),3)
			Set horaMedico = $ZTimeH($Piece($Piece(objDados(index),"~",2),"T",2),2)
			Set $$$VARPEPPrescricaoAtendimentoDataHoraMedico(objVARPEPPrescricaoAtendimento) = dataMedico_","_horaMedico
		}
		If ($piece(objDados(index),"~",1) = "dataHoraEnfermagem") {
			Set dataEnfermagem = $ZDateH($Piece($Piece(objDados(index),"~",2),"T",1),3)
			Set horaEnfermagem = $ZTimeH($Piece($Piece(objDados(index),"~",2),"T",2),2)
			Set $$$VARPEPPrescricaoAtendimentoDataHoraEnfermagem(objVARPEPPrescricaoAtendimento) = dataEnfermagem_","_horaEnfermagem
		}
		If ($piece(objDados(index),"~",1) = "dose") {
			Set $$$VARPEPPrescricaoAtendimentoDose(objVARPEPPrescricaoAtendimento) = $piece(objDados(index),"~",2)
		}
		If ($piece(objDados(index),"~",1) = "observacaoMedico") {
			Set $$$VARPEPPrescricaoAtendimentoObservacaoMedico(objVARPEPPrescricaoAtendimento) = $piece(objDados(index),"~",2)
		}
		If ($piece(objDados(index),"~",1) = "observacaoEnfermagem") {
			Set $$$VARPEPPrescricaoAtendimentoObservacaoEnfermagem(objVARPEPPrescricaoAtendimento) = $piece(objDados(index),"~",2)
		}
		If ($piece(objDados(index),"~",1) = "status"){
			Set $$$VARPEPPrescricaoAtendimentoStatus(objVARPEPPrescricaoAtendimento) = $piece(objDados(index),"~",2)
			If ($piece(objDados(index),"~",2) = "AP") {
				Set $$$VARPEPPrescricaoAtendimentoDataHoraEnfermagem(objVARPEPPrescricaoAtendimento) = $Horolog
				Set $$$VARPEPPrescricaoAtendimentoResponsavelEnfermagem(objVARPEPPrescricaoAtendimento) = YBED
			}
		}
	}
	If (pId = "" || (pFlagUsuarioMedico = 1)) {
		If ($$$VARPEPPrescricaoAtendimentoDataHoraMedico(objVARPEPPrescricaoAtendimento) = "") {
			Set $$$VARPEPPrescricaoAtendimentoDataHoraMedico(objVARPEPPrescricaoAtendimento) = data_","_hora
		}
		Set $$$VARPEPPrescricaoAtendimentoResponsavelMedico(objVARPEPPrescricaoAtendimento) = YBED
	}Else{
		If ($$$VARPEPPrescricaoAtendimentoDataHoraEnfermagem(objVARPEPPrescricaoAtendimento) = "") {
			Set $$$VARPEPPrescricaoAtendimentoDataHoraEnfermagem(objVARPEPPrescricaoAtendimento) = $Horolog
		}
		Set $$$VARPEPPrescricaoAtendimentoResponsavelEnfermagem(objVARPEPPrescricaoAtendimento) = YBED
	}

	Set status = $$$Save("VARPEPPrescricaoAtendimento",pCodProntuario_","_data_","_hora,objVARPEPPrescricaoAtendimento,1)

	Quit status]]></Implementation>
</Method>

<Method name="AlertaPrescricao">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario</FormalSpec>
<Implementation><![CDATA[	set retorno = {}
	set sql = "SELECT TOP 1 "
					_  "SUM(CASE WHEN Status = 'AA' THEN 1 WHEN Status IS NULL THEN 1 ELSE 0 END) AS AA,"
					_  "SUM(CASE Status WHEN 'CA' THEN 1 ELSE 0 END) AS CA "
					_ "FROM SQLUser.VARPEPPrescricaoAtendimento "
					_ "WHERE Company = 0 AND CodigoProntuarioEletronic = ?"
	
	set rs = ##class(%SQL.Statement).%New()
	set status = rs.%Prepare(sql)
	set rs = rs.%Execute(pCodProntuario)
	do rs.%Next()
	
	set retorno.AA = +rs.%Get("AA")
	set retorno.CA = +rs.%Get("CA")
	
	Return retorno.%ToJSON()]]></Implementation>
</Method>

<Method name="MedicamentoDados">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))

	Set meuSQL = "Select Quimio, Medicamento, $$SQLGetDescricaoProduto^VARSQL(Medicamento) As Descricao "
	Set meuSQL = meuSQL _ " from VARPEPQuimContDadosVitaisQuimio "
	Set meuSQL = meuSQL _ "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"' "
	Set meuSQL = meuSQL _ "Group By Medicamento"
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		set list = {}
		set list.medicamento = rSet.%Get("Quimio")_"|"_rSet.%Get("Medicamento")
		set list.descricao = rSet.%Get("Descricao")
	
		Do objRetorno.%Push(list)
	
	}

	Do objRetorno.%ToJSON()

	Return $$$OK]]></Implementation>
</Method>

<Method name="historicoReacao">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	Set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)

	Set arrayRetorno 	= []

	Set meuSQL = "Select Pront.*, Quimio.* From SQLUser.VARProntuarioEletronico As Pront, "
	Set meuSQL = meuSQL _ "SQLUser.VARPEPQuimioterapia As Quimio "
	Set meuSQL = meuSQL _ "Where Pront.Company = 0 And Quimio.Company = 0 "
	Set meuSQL = meuSQL _ "And Pront.Paciente = '"_codPaciente_"' "
	Set meuSQL = meuSQL _ "And Quimio.CodigoProntuarioEletronic = Pront.Codigo "
	Set meuSQL = meuSQL _ "Order By Pront.CriadoEm Desc "
	Set rSet 	 = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
	
	While(rSet.%Next()){
		Set list = {}
		Set list.admissao = rSet.%Get("Codigo")
		Set list.dataHora = $ZDateTime(rSet.%Get("CriadoEm"),4,2)
		Set list.diagHist = rSet.%Get("ReacaoHistorico")
		Set list.diagNomeMed = $$SQLGetDescricaoProduto^VARSQL($Piece(rSet.%Get("ReacaoMedicamento"),"|",2))
		Set list.diagNomeFab = rSet.%Get("ReacaoFabricante")
		Set list.diagDtIniMed = $Select(rSet.%Get("ReacaoDataInicio")="":"",1:$ZDate(rSet.%Get("ReacaoDataInicio"),4))
		Set list.diagDtApSint = $Select(rSet.%Get("ReacaoDataAparecimento")="":"",1:$ZDate(rSet.%Get("ReacaoDataAparecimento"),4))
		Set list.diagLote = rSet.%Get("ReacaoLote")
		Set list.diagValidade = $Select(rSet.%Get("ReacaoValidade")="":"",1:$ZDate(rSet.%Get("ReacaoValidade"),4))
		Set list.diagPeso = rSet.%Get("ReacaoPeso")
		Set list.diagAlt = rSet.%Get("ReacaoAlt")
		Set list.diagJaRecMedic = $Select(rSet.%Get("ReacaoJaRecebeuMedicament")=1:"Sim",rSet.%Get("ReacaoJaRecebeuMedicament")="0":"Não",1:"")
		Set list.diagQualFreq = $Select(rSet.%Get("ReacaoFrequenciaMedicamen")="D":"Diária",rSet.%Get("ReacaoFrequenciaMedicamen")="S":"Semanal",rSet.%Get("ReacaoFrequenciaMedicamen")="M":"Mensal",rSet.%Get("ReacaoFrequenciaMedicamen")="O":"Outros",1:"")
		Set list.diagEspecfica = rSet.%Get("ReacaoFrequenciaEspecificacao")
		Set list.modApliIVInfusGotej = $Select(rSet.%Get("ReacaoModAplicInfusao")=1:"Sim",rSet.%Get("ReacaoModAplicInfusao")="0":"Não",1:"")
		Set list.modApliIVInfusGotejDiluicao = $Select(+rSet.%Get("ReacaoModAplicInfusao")=0:"",1:rSet.%Get("ReacaoModAplicInfusaoDil1")_" mL em "_rSet.%Get("ReacaoModAplicInfusaoDil2")_" mL de"_$Select(rSet.%Get("ReacaoModAplicInfusaoSF")=1:"SF 0,9%",rSet.%Get("ReacaoModAplicInfusaoSF")=2:"SG 5%",rSet.%Get("ReacaoModAplicInfusaoSF")=3:"Água destilada",1:""))
		Set list.modApliIVInfusBolus = $Select(rSet.%Get("ReacaoModAplicInjecao")=1:"Sim",rSet.%Get("ReacaoModAplicInjecao")="0":"Não",1:"")
		Set list.modApliIVInfusBolusDuracao = rSet.%Get("ReacaoModAplicInjecaoD")
		Set list.modApliIntramuscular = $Select(rSet.%Get("ReacaoModAplicIntra")=1:"Sim",rSet.%Get("ReacaoModAplicIntra")="0":"Não",1:"")
		Set list.modAplOral = $Select(rSet.%Get("ReacaoModAplicOral")=1:"Sim",rSet.%Get("ReacaoModAplicOral")="0":"Não",1:"")
		Set list.modAplOralPosilogia = rSet.%Get("ReacaoModAplicOralPosologia")
		Set list.ingestaoInfusao = rSet.%Get("ReacaoIngestao")
		Set list.sinaisSintomas = rSet.%Get("ReacaoSinaiseSintomas")
		Set list.incLocalIrritante = $Select(rSet.%Get("ReacaoIncidenteIrritante")=1:"Sim",rSet.%Get("ReacaoIncidenteIrritante")="0":"Não",1:"")
		Set list.incLocalVesicamente = $Select(rSet.%Get("ReacaoIncidenteVesicante")=1:"Sim",rSet.%Get("ReacaoIncidenteVesicante")="0":"Não",1:"")
		Set list.incLocalExtravasamento = $Select(rSet.%Get("ReacaoIncidenteExtravasam")=1:"Sim",rSet.%Get("ReacaoIncidenteExtravasam")="0":"Não",1:"")
		Set list.descricao = rSet.%Get("ReacaoIncidenteDescricao")
		Set list.usoCompQuente = $Select(rSet.%Get("ReacaoCompressaQuente")=1:"Sim",rSet.%Get("ReacaoCompressaQuente")="0":"Não",1:"")
		Set list.usoCompFria = $Select(rSet.%Get("ReacaoCompressaFria")=1:"Sim",rSet.%Get("ReacaoCompressaFria")="0":"Não",1:"")
		Set list.usoCompNaoUtil = $Select(rSet.%Get("ReacaoCompressaNaoUtiliza")=1:"Sim",rSet.%Get("ReacaoCompressaNaoUtiliza")="0":"Não",1:"")
		Set list.condAcompa = rSet.%Get("ReacaoCondutaeAcompanhame")
		Set list.conclusao = rSet.%Get("ReacaoConclusao")
		Do arrayRetorno.%Push(list)
	}
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="historicoAnamnese">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	Set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)

	Set arrayRetorno 	= []

	Set sql = "SELECT * "
					_ "FROM SQLUser.VARProntuarioEletronico As P "
					_ "INNER JOIN SQLUser.VARPEPQuimioterapiaAnamnese AS A ON A.CodigoProntuarioEletronic = P.Codigo "
					_ "WHERE A.Company = 0 AND P.Company = 0 And P.Paciente = '"_codPaciente_"' "
					_ "ORDER BY P.CriadoEm DESC"
	
	Set rSet 	 = ##class(%SQL.Statement).%ExecDirect("",sql)
	
	While(rSet.%Next()){
		Set list = {}
		Set list.admissao = rSet.%Get("NumeroAdmisao")
		Set list.dataHora = $ZDateTime(rSet.%Get("CriadoEm"),4,2)
		Set list.ComorbidadesDM = $Select(rSet.%Get("ComorbidadesDM")=1:"Sim",1:"")
		Set list.ComorbidadesICC = $Select(rSet.%Get("ComorbidadesICC")=1:"Sim",1:"")
		Set list.ComorbidadesHAS = $Select(rSet.%Get("ComorbidadesHAS")=1:"Sim",1:"")
		Set list.ComorbidadesAVC = $Select(rSet.%Get("ComorbidadesAVC")=1:"Sim",1:"")
		Set list.ComorbidadesIRC = $Select(rSet.%Get("ComorbidadesIRC")=1:"Sim",1:"")
		Set list.ComorbidadesCondronariopa = $Select(rSet.%Get("ComorbidadesCondronariopa")=1:"Sim",1:"")
		Set list.ComorbidadesOutros = rSet.%Get("ComorbidadesOutros")
		
		Set list.InfusaoVeiaPeriferica = $Select(rSet.%Get("InfusaoVeiaPeriferica")=1:"Sim",1:"")
		Set list.InfusaoPortaCath = $Select(rSet.%Get("InfusaoPortaCath")=1:"Sim",1:"")
		Set list.InfusaoPICC = $Select(rSet.%Get("InfusaoPICC")=1:"Sim",1:"")
		Set list.InfusaoIM = $Select(rSet.%Get("InfusaoIM")=1:"Sim",1:"")
		Set list.InfusaoSC = $Select(rSet.%Get("InfusaoSC")=1:"Sim",1:"")
		Set list.InfusaoLocalizacao = rSet.%Get("InfusaoLocalizacao")

		Set list.AlergiaAQue = rSet.%Get("AlergiaAQue")
		Set list.FluxoCateter = $Select(rSet.%Get("FluxoCateter")=1:"Ótimo",rSet.%Get("FluxoCateter")=0:"Ruim",1:"")
		Set list.FinalizacaoCom = $Select(rSet.%Get("FinalizacaoCom")=1:"Salinização",rSet.%Get("FinalizacaoCom")=0:"Heparinização",1:"")
		Set list.IncidenteQual = rSet.%Get("IncidenteQual")
		Set list.MedicacaoemUso = rSet.%Get("MedicacaoemUso")
		
		Set list.DadAntPeso = rSet.%Get("DadAntPeso")
		Set list.DadAntAltura = rSet.%Get("DadAntAltura")
		Set list.DadAntSC = rSet.%Get("DadAntSC")
		Set list.RiscodeFlebite = $Select(rSet.%Get("RiscodeFlebite")=1:"Sim",1:"")
		Set list.DorDescricao = rSet.%Get("DorDescricao")
		Set list.MedoApreensaoDescricao = rSet.%Get("MedoApreensaoDescricao")
		Set list.Neuropsiquiatrico = rSet.%Get("Neuropsiquiatrico")
		Set list.RitmoCardiaco = rSet.%Get("RitmoCardiaco")
		Set list.PadraoRespiratorio = rSet.%Get("PadraoRespiratorio")
		Set list.PeleeMucosa = rSet.%Get("PeleeMucosa")
		Set list.RedeVenosoPrejDescricao = rSet.%Get("RedeVenosoPrejDescricao")
		Set list.IntSocPejudDescricao = rSet.%Get("IntSocPejudDescricao")
		
		Set list.Hemograma = $Select(rSet.%Get("Hemograma")=1:"Sim",1:"")
		Set list.FuncaoRenal = $Select(rSet.%Get("FuncaoRenal")=1:"Sim",1:"")
		Set list.FuncaoHipatica = $Select(rSet.%Get("FuncaoHipatica")=1:"Sim",1:"")
		Set list.AlteracaoNeurologica = $Select(rSet.%Get("AlteracaoNeurologica")=1:"Sim",1:"")
		
		Set list.ConferirPaciente = $Select(rSet.%Get("ConferirPaciente")=1:"Sim",1:"")
		Set list.ConferirPrescricao = $Select(rSet.%Get("ConferirPrescricao")=1:"Sim",1:"")
		Set list.ConferirEtiqueta = $Select(rSet.%Get("ConferirEtiqueta")=1:"Sim",1:"")
		Set list.ConferirSinais = $Select(rSet.%Get("ConferirSinais")=1:"Sim",1:"")
		
		
		Do arrayRetorno.%Push(list)
	}
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>
</Class>
</Export>