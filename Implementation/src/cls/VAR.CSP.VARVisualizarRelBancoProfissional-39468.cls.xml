<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="Cache" ts="2001-01-01 00:00:00">
<Class name="VAR.CSP.VARVisualizarRelBancoProfissional">
<ClassType/>
<IncludeCode>MEDConst,VARConst,INConst,WWWConst,FATConst</IncludeCode>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	$$$VAR
	#Dim %request as %CSP.Request
	#Dim %response as %CSP.Response
	;
	Set job = %session.SessionId
	Set method = $Get(%request.Data("method",1))
	Xecute "do .."_method_"()"
	Return $$$OK]]></Implementation>
</Method>

<Method name="ValidaSessao">
<ClassMethod>1</ClassMethod>
<FormalSpec>callMode=""</FormalSpec>
<Implementation><![CDATA[	Set status = $$VerifySession^VARCSPUtils(YBED, YUSER)
	If status=0||(YBED="UNKNOWN"){
		Set status=0
		Set %response.Status="401 Unauthorized"
		Set resp={}
		Set resp.status=0
		Set resp.mensagem="Usuário não está logado ou a sessão expirou."
		DO resp.%ToJSON()
	}ElseIf callMode=""{
		Set resp={}
		Set resp.status=1
		Do resp.%ToJSON()
	}
	Return status]]></Implementation>
</Method>

<Method name="MontaTela">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	

	Set arrayRetorno = []
	Set arrayGrupo 	 = []

	Set meuSQL = "Select $$GrupoRelatorio^VARSQL(Campo,1) As Grupo, * From SQLUser.VARCadRelBancoProfisFiltro "
	Set meuSQL = meuSQL _ "Where Company = 0 And Ativo In (1) And Relatorio = '"_pCodRelatorio_"' "
	Set meuSQL = meuSQL _ "Order By NVL(Sequencia,999999), Campo"
	
	;W meuSQL
	
	
	Set aGrupo = ""
	Set rSet = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
 	While (rSet.%Next()) {
		
		Set grupo			= rSet.%Get("Grupo")
		Set campo 		= rSet.%Get("Campo")
		Set legFormul = rSet.%Get("LegendanoFormulario")

		IF ($Piece(campo,"||",2)="VARHabilidade") {
			If ($Piece(campo,"||",4)="Descricao") {
				Set objWWW003="Descrição~Descrição~6~30~~~~VARHabilidades~"_$Piece(campo,"||",3)_"~1~~~~~~~~~~~~~~~VARHabiliade||Descricao~~~~~~~~~~~~~~"		
				Set classe = "VARHabilidades~"_$Piece(campo,"||",3)_""
			}Else{
				Set objWWW003="Nível~Nível~6~30~~~~VARPARA~""NIVELHABILIDADE"",SPRACHE~1~~~~~~~~~~~~~~~VARHabiliade||Nivel~~~~~~~~~~~~~~"	
			}			
		}ElseIF ($Piece(campo,"||",2)="VARIdioma") {
			Set objWWW003="Idioma~Idioma~6~30~~~~VARPARA~""IDIOMA"",SPRACHE~1~~~~~~~~~~~~~~~VARIdioma||Idioma~~~~~~~~~~~~~~"		
		}Else{
			Set classe 		= $Piece(campo,"||",$Length(campo,"||")-1)
			Set campoPrep = $Piece(campo,"||",$Length(campo,"||"))

			Set flagCampoCalc = 0 
			Set indexClass = $Order(^WWW003s(YM, 3, $ZConvert(classe,"U"), $ZConvert(campoPrep,"U"), classe, ""))
			if (indexClass = "") {
				Set indexClass = $Order(^WWW003Calcs(YM, 1, $ZConvert(campoPrep,"U"), classe, ""))
				If (indexClass = "") Continue
				Set objWWW003Calc = $Get(^WWW003Calc(0,"GCONPaciente",indexClass,1))
				Set $$$WWW003CaptionInForms(objWWW003) = $$$WWW003CalcCaption(objWWW003Calc)
				Set $$$WWW003InputType(objWWW003) 		 = "4"
			}Else{
				Set objWWW003 		= $Get(^WWW003(YM, classe, indexClass, 1))
				Set objWWW003Calc = ""
			}
		}
		
		;w objWWW003_"*|*"_$$$WWW003InputType(objWWW003)_"*|*"_$$$WWW003RelationDatabase(objWWW003)_"*|*"

		Set flagSelParametro = 0
		If ($$$WWW003InputType(objWWW003) = "6") {
			If ($$$WWW003RelationDatabase(objWWW003) = "VARPARA") Set flagSelParametro = 1 
			If ($$$WWW003RelationDatabase(objWWW003) = "INPARA") Set flagSelParametro = 1 
			If ($$$WWW003RelationDatabase(objWWW003) = "WWW100") Set flagSelParametro = 1 
			If ($$$WWW003RelationDatabase(objWWW003) = "WWW101") Set flagSelParametro = 1 
		}
		
		If (aGrupo '= grupo) {
			If (aGrupo '= "") {
				Set listGroup 				 	= {}
				Set listGroup.itemType 	= "group"
				Set listGroup.caption		= aGrupo
				Set listGroup.colCount	= 5
				Set listGroup.items			= arrayGrupo
				Do arrayRetorno.%Push(listGroup)
			}
			Set arrayGrupo 	= []
			Set aGrupo 			= grupo
		}

		Set xEditorType 		= "dxTextBox"
		Set xEditorOptions 	= {}
		If ($$$WWW003InputType(objWWW003) = "1") {
			Set xEditorType = "dxDateBox"	
			Set xEditorOptions.type = "date"
			Set xEditorOptions.dateSerializationFormat = "yyyy-MM-dd"
			Set xEditorOptions.useMaskBehavior = 1
			Set xEditorOptions.openOnFieldClick = 0
			Set xEditorOptions.showDropDownButton = 1
			Set xEditorOptions.showClearButton = 1	
			;Set xEditorOptions.value = "2022-06-01"		
		}ElseIf ($$$WWW003InputType(objWWW003) = "2" || (flagSelParametro = 1)) {
			Set clasRel 		= $$$WWW003RelationDatabase(objWWW003)
			Set chaveRel 		= $Replace($Piece($$$WWW003RelationalPrimaryKeys(objWWW003),",",1),"""","")
			Set xEditorType = "dxSelectBox"	
			If (flagSelParametro = 1 && (rSet.%Get("Tipo") = 3)) {
				Set xEditorType = "dxTagBox"	
			}
			Set xEditorOptions.searchEnabled = +1
			Set xEditorOptions.dataSource = "'getClassesParam('"_clasRel_"', '"_chaveRel_"', "_flagSelParametro_")'"
			Set xEditorOptions.valueExpr = "codigo" 
			Set xEditorOptions.displayExpr = "descricao"
			Set xEditorOptions.showClearButton = 1
		}ElseIf ($$$WWW003InputType(objWWW003) = "4") {
			Set xEditorType = "dxNumberBox"	
			Set xEditorOptions.min = 0
			Set xEditorOptions.showSpinButtons = 1
			Set xEditorOptions.value = 0
		}ElseIf ($$$WWW003InputType(objWWW003) = "6" && ($$$WWW003RelationDatabase(objWWW003) '= "")) {
			Set xEditorType = "dxSelectBox"	
			if (rSet.%Get("Tipo") = 3) {
				Set xEditorType = "dxTagBox"	
			}
			Set xEditorOptions.searchEnabled = +1
			Set xEditorOptions.dataSource = "'getClassesRelacao('"_classe_"',"_indexClass_",'"_$$$WWW003PermiteFiltro(objWWW003)_"')'"
			Set xEditorOptions.valueExpr = "codigo" 
			Set xEditorOptions.displayExpr = "descricao"
			Set xEditorOptions.showClearButton = 1
		}

	 	Set arrayValidRules 				= []
	 	Set listValidRules 					= {}
	 	Set listValidRules.type 		= "required"
	 	Do arrayValidRules.%Push(listValidRules)
		
		if (rSet.%Get("Tipo") '= 2) {
		 	Set listDados = {}
		 	Set:rSet.%Get("ColSpan")'="" listDados.colSpan = +$FNumber(rSet.%Get("ColSpan"),"",0)
			Set listDados.dataField 			= rSet.%Get("Campo") 
			Set listDados.editorType 			= xEditorType
			Set listDados.editorOptions 	= xEditorOptions
			Set listLabel 								= {}
			Set listLabel.text 						= $Select(legFormul="":$$$WWW003CaptionInForms(objWWW003),1:legFormul)
			Set listDados.label 					= listLabel
		 	Set:+rSet.%Get("Obrigatorio")=1 listDados.validationRules = arrayValidRules
		 	Do arrayGrupo.%Push(listDados)
		}Else{
		 	Set listDados = {}
		 	Set:rSet.%Get("ColSpan")'="" listDados.colSpan = +$FNumber(rSet.%Get("ColSpan"),"",0)
			Set listDados.itemType 		= "group"
			Set listDados.colCount 		= 2
			Set arrayItem 						= []
			;
			Set listItem 									= {}
			Set listItem.dataField 				= rSet.%Get("Campo")_"||DE" 
			Set listItem.editorType 			= xEditorType
			Set listItem.editorOptions 		= xEditorOptions
			Set listLabel 								= {}
			Set listLabel.text 						= $Select(legFormul="":$$$WWW003CaptionInForms(objWWW003),1:legFormul) _ " - De"
			Set listItem.label 						= listLabel
		 	Set:+rSet.%Get("Obrigatorio")=1 listItem.validationRules 	= arrayValidRules
			Do arrayItem.%Push(listItem)
			;
			Set listItem 									= {}
			Set listItem.dataField 				= rSet.%Get("Campo")_"||ATE" 
			Set listItem.editorType 			= xEditorType
			Set listItem.editorOptions 		= xEditorOptions
			Set listLabel 								= {}
			Set listLabel.text 						= "Até"
			Set listItem.label 						= listLabel
		 	;Set:+rSet.%Get("Obrigatorio")=1 listItem.validationRules	= arrayValidRules
			Do arrayItem.%Push(listItem)
			;
			Set listDados.items = arrayItem
			Do arrayGrupo.%Push(listDados)
		}
 	}
 	;
 	If (arrayGrupo.%Size() > 0) {
		Set listGroup 				 	= {}
		Set listGroup.itemType 	= "group"
		Set listGroup.caption		= aGrupo
		Set listGroup.colCount	= 5
		Set listGroup.items			= arrayGrupo
		Do arrayRetorno.%Push(listGroup)
 	}
	;
	Write $Replace($Replace(arrayRetorno.%ToJSON(),"""'",""),"'""","")
	Return $$$OK]]></Implementation>
</Method>

<Method name="GetClassesParam">
<Description><![CDATA[Metodo generico para recupera dados de classe de paramentros]]></Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pClasse 			= $Get(%request.Data("pClasse",1))
	Set pParametro 		= $Get(%request.Data("pParametro",1))
	Set pExibirCod		= $Get(%request.Data("pExibirCod",1))
	Set pOrder				= $Get(%request.Data("pOrder",1))
	Set pCodSearch		= $Get(%request.Data("pCodSearch",1))
	Set pSkip					= $Get(%request.Data("pSkip",1))	
	Set pTake					= $Get(%request.Data("pTake",1))
	Set pFilter				= $Get(%request.Data("pFilter",1))
	Set pSearchValue	= $Get(%request.Data("pSearchValue",1))
	
	Set nomeParam 	= $$$WWW002PropertyName($Get(^WWW002(YM, pClasse, 1, 1)))
	Set langParam 	= $$$WWW002PropertyName($Get(^WWW002(YM, pClasse, 2, 1)))
	Set codParam 		= $$$WWW002PropertyName($Get(^WWW002(YM, pClasse, 3, 1)))
	Set descParam		= $$$WWW003PropertyName($Get(^WWW003(YM, pClasse, 1, 1)))
	
	If (pTake = "") Set pTake = 20
	Set pTake = pTake + pSkip
	Set pSkip = pSkip + 1
	
	If (pClasse = "VARPARA" || (pClasse = "INPARA") || (pClasse = "WWW100") || (pClasse = "WWW101")) {
		Set pExibirCod = 0	
	}
	
	Set meuSQL = "Select * From (Select Top "_pTake_" "_codParam_" As Codigo, "_descParam_" As Descricao "
	Set meuSQL = meuSQL _ "From SQLUser."_pClasse_" Where 1 = 1 And "_langParam_" = 'PT' "
	Set meuSQL = meuSQL _ "And "_nomeParam_" = '"_pParametro_"' "
	If (pCodSearch '= "") {
		Set meuSQL = meuSQL_"And "_codParam_" = '"_pCodRelatorio_"' "
	}Else{
		If (pSearchValue'="") {
			Set:pExibirCod=1 meuSQL = meuSQL_"And %Upper('('||"_codParam_"||') '||"_descParam_") Like %Upper('%"_pSearchValue_"%')"
			Set:pExibirCod'=1 meuSQL = meuSQL_"And %Upper("_descParam_") Like %Upper('%"_pSearchValue_"%')"
		}
	}
	If pOrder '="" Set meuSQL = meuSQL _ "Order By "_descParam_" "_pOrder
	Set meuSQL = meuSQL_") Where %VID Between "_pSkip_" and "_pTake_" "

	Set arrayRetorno = []
	Set rSet = ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	While(rSet.%Next()){

		Set listDados 					= {}
		Set listDados.codigo 		= rSet.%Get("Codigo")
		Set listDados.descricao = rSet.%Get("Descricao")
		If (pExibirCod = 1) {
			Set listDados.descricao = "("_rSet.%Get("Codigo")_") "_rSet.%Get("Descricao")
		}
		Do arrayRetorno.%Push(listDados)
	}
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="GetClassesRelacao">
<Description><![CDATA[Metodo generico para recupera dados de classe de relação]]></Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pClasse 			= $Get(%request.Data("pClasse",1))
	Set pIndexCampo		= $Get(%request.Data("pIndexCampo",1)) 
	Set pFiltro				= $Get(%request.Data("pFiltro",1))
	Set pCodSearch		= $Get(%request.Data("pCodSearch",1))
	Set pSkip					= $Get(%request.Data("pSkip",1))	
	Set pTake					= $Get(%request.Data("pTake",1))
	Set pFilter				= $Get(%request.Data("pFilter",1))
	Set pSearchValue	= $Get(%request.Data("pSearchValue",1))

	Set xComposto	= $Piece(pFiltro,"-",2)
	Set xCompPos	= $Piece(pFiltro,"-",3)

	Set codTabela 		= $$$WWW002PropertyName($Get(^WWW002(YM, pClasse, 1, 1)))
	Set nomeCampo			= $$$WWW003PropertyName($Get(^WWW003(YM, pClasse, pIndexCampo, 1)))
	If (xComposto '= "") {
		Set nomeCampComp = $$$WWW003PropertyName($Get(^WWW003(YM, pClasse, xComposto, 1)))	
	}
	
	If (pTake = "") Set pTake = 20
	Set pTake = pTake + pSkip
	Set pSkip = pSkip + 1

	If ($Piece(pClasse,"~",1)="VARHabilidades") {
		Set codTabela = "Sequencia"
		Set nomeCampo = "Descricao"
		Set xComposto = ""
	}
	
	Set meuSQL = "Select * From (Select Top "_pTake_" * From SQLUser."_$Piece(pClasse,"~",1)_" Where Company = 0 "
	If ($Piece(pClasse,"~",1)="VARHabilidades") {
			Set meuSQL = meuSQL_"And Tipo = '"_$Piece(pClasse,"~",2)_"' "
	}
	If (pCodSearch '= "") {
		Set meuSQL = meuSQL_"And "_codTabela_" = '"_pCodSearch_"' "
	}Else{
		If (pSearchValue'="") {
			If (xComposto '= "") {
				Set:xCompPos="D" meuSQL = meuSQL_"And %Upper('('||"_nomeCampComp_"||') '||"_nomeCampo_") Like %Upper('%"_pSearchValue_"%')"
				Set:xCompPos'="D" meuSQL = meuSQL_"And %Upper('('||"_nomeCampo_"||') '||"_nomeCampComp_") Like %Upper('%"_pSearchValue_"%')"
			}Else{
				Set meuSQL = meuSQL_"And %Upper("_nomeCampo_") Like %Upper('%"_pSearchValue_"%')"
			}
		}
	}
	Set meuSQL = meuSQL_") Where %VID Between "_pSkip_" and "_pTake_" "
	
	Set arrayRetorno = []
	Set rSet = ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	While(rSet.%Next()){
		Set listDados 					= {}
		Set listDados.codigo 		= rSet.%Get(codTabela)
		Set listDados.descricao = rSet.%Get(nomeCampo)
		If (xComposto '= "") {
			Set:xCompPos="D" listDados.descricao = "("_rSet.%Get(nomeCampComp)_") "_rSet.%Get(nomeCampo)
			Set:xCompPos'="D" listDados.descricao = "("_rSet.%Get(nomeCampo)_") "_rSet.%Get(nomeCampComp)
		}
		Do arrayRetorno.%Push(listDados)
	}
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="ListarRelatorio">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y		= "~"
	;
	Set YBED 					= $Get(%request.Data("YBED",1))
	Set pObjFiltros 	= $Get(%request.Data("pObjFiltros",1))
	Set pCodRelatorio	= $Get(%request.Data("pCodRelatorio",1))
	
	Set objFiltros = [].%FromJSON(pObjFiltros)

	K ^mtemp.JULIO

	;
	Set colunas = ""
	Set meuSQL 	= "Select *, $$GrupoRelatorio^VARSQL(Coluna) As DescCol From SQLUser.VARCadRelBancoProfisColunas Where Company = 0 "
	Set meuSQL 	= meuSQL _ "And Nvl(Opcao,0) Not In (0) And Relatorio = '"_pCodRelatorio_"' "
	Set rSet 		= ##class(%SQL.Statement).%ExecDirect("",meuSQL)
 	While (rSet.%Next()) {

		Set xIndex 	= ($Length(rSet.%Get("Coluna"),"||")-1)\2
		Set xTabela = $Piece(rSet.%Get("Coluna"),"||",$Length(rSet.%Get("Coluna"),"||")-1)
		Set xTabNam = $Piece(rSet.%Get("Coluna"),"||",1,$Length(rSet.%Get("Coluna"),"||")-1)
		Set xColuna = $Piece(rSet.%Get("Coluna"),"||",$Length(rSet.%Get("Coluna"),"||"))

		If (xTabNam = "VARHabilidade" || (xTabNam = "VARIdioma")) Continue
		
		Set indexClass = $Order(^WWW003s(YM, 3, $ZConvert(xTabela,"U"), $ZConvert(xColuna,"U"), xTabela, ""))
		if (indexClass = "") {
			Continue
		}Else{
			Set objWWW003 		= $Get(^WWW003(YM, xTabela, indexClass, 1))
			Set objWWW003Calc = ""
		}
		
		Set colunas(rSet.%Get("Coluna")) = ""

		Set colunas = colunas _ 
									$Select(colunas="":"",1:", ") _ 
									$Replace(xTabNam,"||","")_"."_xColuna _ 
									" As "_
									$Replace(xTabNam,"||","")_"_"_xColuna 
	}
	;
	If ('$Data(colunas("||VARBancoProfissional||Codigo"))) {
		Set colunas = colunas _  $Select(colunas="":"",1:", ") _ "VARBancoProfissional.Codigo As VARBancoProfissional_Codigo"
	}
	;
	
	Set listRetorno 				= {}
	Set listRetorno.columns = ..GetColumns(pCodRelatorio)
	
	Set whereL3 = ""
	Kill tempFilto
	Set countFilt = 0
	Set meuSQL = "Select * From SQLUser.VARCadRelBancoProfisFiltro Where Company = 0 "
	Set meuSQL = meuSQL _ "And Relatorio = '"_pCodRelatorio_"' And Ativo In (1)"
	Set rSet = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
 	While (rSet.%Next()) {
		Set tempFiltro($Increment(countFilt)) = rSet.%Get("Campo")_"~"_rSet.%Get("Tipo")	
 	}
		
	Set countFilt = ""
	For {		
		Set countFilt = $Order(tempFiltro(countFilt))
		Quit:countFilt=""
		
		Set campo = $Piece(tempFiltro(countFilt),Y,1)
		
		If ($Piece(campo,"||",2) = "VARHabilidade") {
			Set proxCountFilt = $Order(tempFiltro(countFilt))
			If (proxCountFilt'=""&&
				 ($Piece(campo,"||",2)=$Piece($Piece(tempFiltro(countFilt),"~",1),"||",2))&&
				 ($Piece(campo,"||",3)=$Piece($Piece(tempFiltro(countFilt),"~",1),"||",3))&&
				 (objFiltros.%Get($Piece(tempFiltro(proxCountFilt),Y,1)) '= "")) {
				
				If ($IsObject(objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)))) {
					If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Size() = 0) Continue
					If ($IsObject(objFiltros.%Get($Piece(tempFiltro(proxCountFilt),Y,1)))) {
						Set codHabil = $Piece($Piece(tempFiltro(countFilt),Y,1),"||",3)
						Set xWhere = ""
						For i = 1 : 1 : objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Size() {
							For ii = 1 : 1 : objFiltros.%Get($Piece(tempFiltro(proxCountFilt),Y,1)).%Size() {
								Set xCodigo = objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Get(i-1)_"-"_objFiltros.%Get($Piece(tempFiltro(proxCountFilt),Y,1)).%Get(ii-1)
								If (xCodigo = "") Continue
								Set xWhere = xWhere_$Select(xWhere="":"",1:" or ")_"$Find($$GetHabilidade^VARSQL(VARBancoProfissional.Codigo, 'VARHabilidades_"_codHabil_"_Grupo', 1, 'T'),';"_xCodigo_";') > 0"
							}
						}
						Set whereL3 = whereL3 _ " And ("_xWhere_") "						
					}Else{
						Set codHabil = $Piece($Piece(tempFiltro(countFilt),Y,1),"||",3)
						Set xWhere = ""
						For i = 1 : 1 : objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Size() {
							Set xCodigo = objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Get(i-1)_"-"_objFiltros.%Get($Piece(tempFiltro(proxCountFilt),Y,1))
							If (xCodigo = "") Continue
							Set xWhere = xWhere_$Select(xWhere="":"",1:" or ")_"$Find($$GetHabilidade^VARSQL(VARBancoProfissional.Codigo, 'VARHabilidades_"_codHabil_"_Grupo', 1, 'T'),';"_xCodigo_";') > 0"
						}
						Set whereL3 = whereL3 _ " And ("_xWhere_") "						
					}
				}Else{
					If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)) '= "") {
						If ($IsObject(objFiltros.%Get($Piece(tempFiltro(proxCountFilt),Y,1)))) {
							Set xWhere = ""
							Set codHabil = $Piece($Piece(tempFiltro(countFilt),Y,1),"||",3)
							For i = 1 : 1 : objFiltros.%Get($Piece(tempFiltro(proxCountFilt),Y,1)).%Size() {
								Set xCodigo = objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1))_"-"_objFiltros.%Get($Piece(tempFiltro(proxCountFilt),Y,1)).%Get(i-1)
								If (xCodigo = "") Continue
								Set xWhere = xWhere_$Select(xWhere="":"",1:" or ")_"$Find($$GetHabilidade^VARSQL(VARBancoProfissional.Codigo, 'VARHabilidades_"_codHabil_"_Grupo', 1, 'T'),';"_xCodigo_";') > 0"
							}
							Set whereL3 = whereL3 _ " And ("_xWhere_") "
						}Else{
							Set xWhere = ""
							Set codHabil = $Piece($Piece(tempFiltro(countFilt),Y,1),"||",3)
							Set xCodigo = objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1))_"-"_objFiltros.%Get($Piece(tempFiltro(proxCountFilt),Y,1))
							Set xWhere = xWhere_$Select(xWhere="":"",1:" or ")_"$Find($$GetHabilidade^VARSQL(VARBancoProfissional.Codigo, 'VARHabilidades_"_codHabil_"_Grupo', 1, 'T'),';"_xCodigo_";') > 0"
							Set whereL3 = whereL3 _ " And ("_xWhere_") "
						}
					}
				}	
				Set countFilt = proxCountFilt 

				Continue
			}Else{
				If ($IsObject(objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)))) {
					If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Size() = 0) Continue
					Set codHabil = $Piece($Piece(tempFiltro(countFilt),Y,1),"||",3)
					Set tipo = "D"
					If ($Piece(campo,"||",4) = "Nivel")	Set tipo = "N"
					Set xWhere = ""
					For i = 1 : 1 : objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Size() {
						Set xCodigo = objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Get(i-1)
						If (xCodigo = "") Continue
						Set xWhere = xWhere_$Select(xWhere="":"",1:" or ")_"$Find($$GetHabilidade^VARSQL(VARBancoProfissional.Codigo, 'VARHabilidades_"_codHabil_"_Grupo', 1, '"_tipo_"'),';"_xCodigo_";') > 0"
					}
					Set whereL3 = whereL3 _ " And ("_xWhere_") "
				}Else{
					If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)) '= "") {
						Set xWhere = ""
						Set codHabil = $Piece($Piece(tempFiltro(countFilt),Y,1),"||",3)
						Set xCodigo = objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1))
						Set tipo = "D"
						If ($Piece(campo,"||",4) = "Nivel")	Set tipo = "N"
						Set xWhere = xWhere_$Select(xWhere="":"",1:" or ")_"$Find($$GetHabilidade^VARSQL(VARBancoProfissional.Codigo, 'VARHabilidades_"_codHabil_"_Grupo', 1, '"_tipo_"'),';"_xCodigo_";') > 0"
						Set whereL3 = whereL3 _ " And ("_xWhere_") "
					}
				}	
				Continue
			}
		}ElseIf ($Piece(campo,"||",2) = "VARIdioma") {
			If ($IsObject(objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)))) {
				If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Size() = 0) Continue
				Set xWhere = ""
				For i = 1 : 1 : objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Size() {
					Set xCodigo = objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Get(i-1)
					If (xCodigo = "") Continue
					Set xWhere = xWhere_$Select(xWhere="":"",1:" or ")_"$Find($$GetIdioma^VARSQL(VARBancoProfissional.Codigo, 'VARIdioma_Grupo_1_1_1', 1),';"_xCodigo_";') > 0"
				}
				Set whereL3 = whereL3 _ " And ("_xWhere_") "
			}Else{
				If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)) '= "") {
					Set xWhere = ""
					Set xCodigo = objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1))
					Set xWhere = xWhere_$Select(xWhere="":"",1:" or ")_"$Find($$GetIdioma^VARSQL(VARBancoProfissional.Codigo, 'VARIdioma_Grupo_1_1_1', 1),';"_xCodigo_";') > 0"
					Set whereL3 = whereL3 _ " And ("_xWhere_") "
				}
			}	
			Continue
		}Else{
			Set classe 			= $Piece(campo,"||",($Length(campo,"||")-1))
			Set coluna 			= $Piece(campo,"||",$Length(campo,"||"))
			
			Set indexClass = $Order(^WWW003s(YM, 3, $ZConvert(classe,"U"), $ZConvert(coluna,"U"), classe, ""))
				if (indexClass = "") {
				Set indexClass = $Order(^WWW003Calcs(YM, 1, $ZConvert(coluna,"U"), classe, ""))
				If (indexClass = "") Continue
				Set objWWW003Calc = $Get(^WWW003Calc(0,"GCONPaciente",indexClass,1))
				Set $$$WWW003CaptionInForms(objWWW003) = $$$WWW003CalcCaption(objWWW003Calc)
				Set $$$WWW003InputType(objWWW003) 		 = "4"
			}Else{
				Set objWWW003 		= $Get(^WWW003(YM, classe, indexClass, 1))
				Set objWWW003Calc = ""
			}
			Set flagSelParametro = 0
			If ($$$WWW003InputType(objWWW003) = "6") {
				If ($$$WWW003RelationDatabase(objWWW003) = "VARPARA") Set flagSelParametro = 1 
				If ($$$WWW003RelationDatabase(objWWW003) = "INPARA") Set flagSelParametro = 1 
				If ($$$WWW003RelationDatabase(objWWW003) = "WWW100") Set flagSelParametro = 1 
				If ($$$WWW003RelationDatabase(objWWW003) = "WWW101") Set flagSelParametro = 1 
			}
			Set xEditorType 		= "dxTextBox"
			Set xEditorOptions 	= {}
			If ($$$WWW003InputType(objWWW003) = "1") {
				Set xEditorType = "dxDateBox"	
			}ElseIf ($$$WWW003InputType(objWWW003) = "2" || (flagSelParametro = 1)) {
				Set xEditorType = "dxSelectBox"	
				if ($Piece(tempFiltro(countFilt),Y,2) = 3) {
					Set xEditorType = "dxTagBox"	
				}
			}ElseIf ($$$WWW003InputType(objWWW003) = "4") {
				Set xEditorType = "dxNumberBox"	
			}ElseIf ($$$WWW003InputType(objWWW003) = "6" && ($$$WWW003RelationDatabase(objWWW003) '= "")) {
				Set xEditorType = "dxSelectBox"	
				if ($Piece(tempFiltro(countFilt),Y,2) = 3) {
					Set xEditorType = "dxTagBox"	
				}
			}
			If ($Piece(tempFiltro(countFilt),Y,2) '= 2) {
				If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)) = "") Continue
				Set xCla 	= $Replace($Piece($Piece(tempFiltro(countFilt),Y,1),"||",1,($Length($Piece(tempFiltro(countFilt),Y,1),"||")-1)),"||","")
				Set xCol 	= $Piece($Piece(tempFiltro(countFilt),Y,1),"||",$Length($Piece(tempFiltro(countFilt),Y,1),"||"))
				If (xEditorType = "dxDateBox") {
					Set whereL3 = whereL3 _ " And " _ xCla _ "." _ xCol _ " = "_ $ZDateH(objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)),3)
				}ElseIf (xEditorType = "dxNumberBox") {
					If (+objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)) = 0) Continue
					Set whereL3 = whereL3 _ " And "_ xCla _ "." _ xCol _ " = "_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1))
				}ElseIf (xEditorType = "dxSelectBox") {
					If (flagSelParametro = 1) {
						Set whereL3 = whereL3 _ " And "_ xCla _ "." _ xCol _ " = '"_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1))_"'"
					}Else{
						Set xCla1 = xCla 
						Set xCol1 = xCol 
						If ($Length($Piece(tempFiltro(countFilt),Y,1),"||")>3) {
							Set xCla1 = $Replace($Piece($Piece(tempFiltro(countFilt),Y,1),"||",1,($Length($Piece(tempFiltro(countFilt),Y,1),"||")-3)),"||","")
							Set xCol1 = $Piece($Piece(tempFiltro(countFilt),Y,1),"||",$Length($Piece(tempFiltro(countFilt),Y,1),"||")-2)
						}
						Set whereL3 = whereL3 _ " And "_ xCla1 _ "." _ xCol1 _ " = '"_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1))_"'"
					}
				}ElseIf (xEditorType = "dxTagBox") {
					If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Size() = 0) Continue
					Set ids = ""
					For i = 1 : 1 : objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Size() {
						Set ids = ids _$Select(ids="":"'",1:",'")_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)).%Get(i-1)_"'"
					}
					
					Set xCla1 = xCla, xCol1 = xCol
					If ($Length($Piece(tempFiltro(countFilt),Y,1),"||")>3) {
						Set xCla1 = $Replace($Piece($Piece(tempFiltro(countFilt),Y,1),"||",1,($Length($Piece(tempFiltro(countFilt),Y,1),"||")-3)),"||","")
						Set xCol1 = $Piece($Piece(tempFiltro(countFilt),Y,1),"||",$Length($Piece(tempFiltro(countFilt),Y,1),"||")-2)
					}
					
					Set whereL3 = whereL3 _ " And "_ xCla1 _ "." _ xCol1 _ " In ("_ids_") "
				}Else{
					 Set whereL3 = whereL3 _ " And %Upper(" _ xCla _ "." _ xCol _ ") Like %Upper('%"_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1))_"%')"
				}
			}Else{
				If (xEditorType = "dxDateBox") {
					If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE") = "" && (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE") = "")) Continue
					Set xCla 	= $Replace($Piece($Piece(tempFiltro(countFilt),Y,1),"||",1,($Length($Piece(tempFiltro(countFilt),Y,1),"||")-1)),"||","")
					Set xCol 	= $Piece($Piece(tempFiltro(countFilt),Y,1),"||",$Length($Piece(tempFiltro(countFilt),Y,1),"||"))
					If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE") '= "" && (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE") '= "")) {
						Set whereL3 =  whereL3 _" And " _ xCla _ "." _ xCol _
													 " BetWeen "_ $ZDateH(objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE"),3) _
													 " And "_ $ZDateH(objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE"),3) 
					}ElseIf (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE") '= "" && (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE") = "")) {
						Set whereL3 =  whereL3 _" And " _ xCla _ "." _ xCol _
													 " BetWeen "_ $ZDateH(objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE"),3) _
													 " And "_ $ZDateH(objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE"),3) 
					}Else{
						Set whereL3 =  whereL3 _" And " _ xCla _ "." _ xCol _
													 " BetWeen "_ $ZDateH(objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE"),3) _
													 " And "_ $ZDateH(objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE"),3) 
					}
				}Else{
					If (+objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE") = 0 && (+objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE") = 0)) Continue
					Set xCla 	= $Replace($Piece($Piece(tempFiltro(countFilt),Y,1),"||",1,($Length($Piece(tempFiltro(countFilt),Y,1),"||")-1)),"||","")
					Set xCol 	= $Piece($Piece(tempFiltro(countFilt),Y,1),"||",$Length($Piece(tempFiltro(countFilt),Y,1),"||"))
					If (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE") '= "" && (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE") '= "")) {
						Set whereL3 =  whereL3 _" And " _ xCla _ "." _ xCol _
													 " BetWeen "_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE") _
													 " And "_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE") 
					}ElseIf (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE") '= "" && (objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE") = "")) {
						Set whereL3 =  whereL3 _" And " _ xCla _ "." _ xCol _
													 " BetWeen "_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE") _
													 " And "_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||DE") 
					}Else{
						Set whereL3 =  whereL3 _" And " _ xCla _ "." _ xCol _
													 " BetWeen "_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE") _
													 " And "_ objFiltros.%Get($Piece(tempFiltro(countFilt),Y,1)_"||ATE") 
					}
				}
			}
	 	}
 	}
	;
	
	Set arrayDados = []
 	Set meuSQLRel = "Select "_colunas_" From SQLUser.VARBancoProfissional As VARBancoProfissional " _
 									"Where VARBancoProfissional.Company = 0 "_whereL3
 									
 	Set rSetRel 	= ##class(%SQL.Statement).%ExecDirect("",meuSQLRel)
	While (rSetRel.%Next()) {
		
		Set listDados = {}
		Set dScolumn = ""
		For {
			Set dScolumn = $Order(tempColunas(dScolumn))
			Quit:dScolumn=""
		
			If ($Piece(dScolumn,"_",1) = "VARHabilidade") {
				Set retForm = $$GetHabilidade^VARSQL(rSetRel.%Get("VARBancoProfissional_Codigo"), dScolumn)
				Do listDados.%Set(dScolumn, retForm)
			}ElseIf ($Piece(dScolumn,"_",1) = "VARIdioma") {
				Set retForm = $$GetIdioma^VARSQL(rSetRel.%Get("VARBancoProfissional_Codigo"), dScolumn)
				If ($Piece(dScolumn,"_",2) '= "Grupo") {
					Do listDados.%Set(dScolumn, retForm)
				}Else{
					Do listDados.%Set($Piece(dScolumn,"_",1,2), retForm)
				}
			}Else{

				Set valorInf	= rSetRel.%Get(dScolumn)
				Set classe 		= $Piece(dScolumn,"_",$Length(dScolumn,"_")-1)
				Set campoDesm = $Piece(dScolumn,"_",$Length(dScolumn,"_"))
				
				If ($Find($ZConvert(campoDesm,"U"),"CRIADOEM")||(($Find($ZConvert(campoDesm,"U"),"ALTERADOEM")))) {
					Set:valorInf'="" valorInf	= $ZDateTime(rSetRel.%Get(dScolumn),4,1)	
				}
				
				Set ind]]><![CDATA[exClass = $Order(^WWW003s(YM, 3, $ZConvert(classe,"U"), $ZConvert(campoDesm,"U"), classe, ""))
				If (indexClass = "") Continue
				Set objWWW003 = $Get(^WWW003(YM, classe, indexClass, 1))
				
				If ($$$WWW003InputType(objWWW003) = "1") {
					Do listDados.%Set(dScolumn, $Select(valorInf="":"",1:$ZDate(valorInf,3)))
				}Else{
					Set flagSelParametro = 0
					If ($$$WWW003InputType(objWWW003) = "6" || ($$$WWW003InputType(objWWW003) = "2")) {
						If ($$$WWW003RelationDatabase(objWWW003) = "VARPARA") Set flagSelParametro = 1 
						If ($$$WWW003RelationDatabase(objWWW003) = "INPARA") Set flagSelParametro = 2 
						If ($$$WWW003RelationDatabase(objWWW003) = "WWW100") Set flagSelParametro = 3 
						If ($$$WWW003RelationDatabase(objWWW003) = "WWW101") Set flagSelParametro = 4
					}			
					If (flagSelParametro '= 0) {
						
						If (valorInf '= "") {
							If (flagSelParametro=1) {
								Set conteudo = ""
								For xI = 1 : 1 : $Length(valorInf,";") {
									Set conteudo = conteudo_ $Select(conteudo="":"",1:" | ")_ $Piece($Get(^VARPARA(0, $Replace($Piece($Piece(objWWW003,"~",9),",",1),"""",""), "PT", $Piece(valorInf,";",xI), 1)),"~",1)
								}
							}
							If (flagSelParametro=2) {
								Set conteudo = $Piece($Get(^INPARA(0, $Replace($Piece($Piece(objWWW003,"~",9),",",1),"""",""), "PT", valorInf, 1)),"~",1)
							}
							If (flagSelParametro=3) {
								Set conteudo = $Piece($Get(^WWW100(0, $Replace($Piece($Piece(objWWW003,"~",9),",",1),"""",""), "PT", valorInf, 1)),"~",1)
							}
							If (flagSelParametro=4) {
								Set conteudo = $Piece($Get(^WWW101(0, $Replace($Piece($Piece(objWWW003,"~",9),",",1),"""",""), "PT", valorInf, 1)),"~",1)
							}
							Do listDados.%Set(dScolumn, conteudo)
						}Else{
							Do listDados.%Set(dScolumn, "")
						}
					}Else{
						Do listDados.%Set(dScolumn, valorInf) 
					}
				}

			}
		}
		Do arrayDados.%Push(listDados)
	}
	;
	Set listRetorno.dados = arrayDados
	;
	Write $Replace($Replace(listRetorno.%ToJSON(),"""'",""),"'""","") 
	Return $$$OK]]></Implementation>
</Method>

<Method name="GetColumns">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodRelatorio</FormalSpec>
<ReturnType>%Library.DynamicArray</ReturnType>
<Implementation><![CDATA[	Set arrayColumns = []
	
	Kill tempGrupoHab
	Kill tempColunas
	
	Set flagGrupo = 1, grupo = ""
	Set meuSQL = "Select $$GrupoRelatorio^VARSQL(Coluna, 1) As GrupoDesc, * "
	Set meuSQL = meuSQL _ "From SQLUser.VARCadRelBancoProfisColunas Where Company = 0 And Nvl(Opcao,0) Not In (0) "
	Set meuSQL = meuSQL _ "And Relatorio = '"_pCodRelatorio_"' Order By Nvl(Sequencia,999999), $$GrupoRelatorio^VARSQL(Coluna, 1) "
	
	Set rSet = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
 	While (rSet.%Next()) {
		Set compColuna = rSet.%Get("Coluna")
		If ($Piece(compColuna,"||",2) = "VARHabilidade") {
			If (grupo '= "") {
				Set listGrupo = {}
				Set listGrupo.visible = flagGrupoVisible
				Set listGrupo.caption = grupo
				Set listGrupo.columns	= arrayGrupo
				Do arrayColumns.%Push(listGrupo)
			}
			Set grupo = ""
			If ($Data(tempGrupoHab($Piece(compColuna,"||",3)))) Continue
			Do ..PrepGetColumnsHabilidades(pCodRelatorio, $Piece(compColuna,"||",3), .arrayColumns, .tempColunas)
			Set tempGrupoHab($Piece(compColuna,"||",3)) = 1
			Continue
		}
		If ($Piece(compColuna,"||",2) = "VARIdioma") {
			If (grupo '= "") {
				Set listGrupo = {}
				Set listGrupo.visible = flagGrupoVisible
				Set listGrupo.caption = grupo
				Set listGrupo.columns	= arrayGrupo
				Do arrayColumns.%Push(listGrupo)
			}
			Set grupo = ""
			If ($Data(tempGrupoHab($Piece(compColuna,"||",3)))) Continue
			Do ..PrepGetColumnsIdioma(pCodRelatorio, $Piece(compColuna,"||",3), .arrayColumns, .tempColunas)
			Set tempGrupoHab($Piece(compColuna,"||",3)) = 1
			Continue
		}
		
		If (grupo '= rSet.%Get("GrupoDesc")) {
			If (grupo '= "") {
				Set listGrupo = {}
				Set listGrupo.visible = flagGrupoVisible
				Set listGrupo.caption = grupo
				Set listGrupo.columns	= arrayGrupo
				Do arrayColumns.%Push(listGrupo)
			}
			Set flagGrupoVisible = 0
			Set arrayGrupo = []
			Set grupo = rSet.%Get("GrupoDesc")
		}
		Do PrepGetColumns
 	}
	If (grupo '= "") {
		Set listGrupo = {}
		Set listGrupo.visible = flagGrupoVisible
		Set listGrupo.caption = grupo
		Set listGrupo.columns	= arrayGrupo
		Do arrayColumns.%Push(listGrupo)
	}
	;
	
	Return arrayColumns
	
PrepGetColumns
	
	Set objeto 			= $Get(^VARCadRelBancoProfisColunas(0,pCodRelatorio,compColuna,1))
	
	Set opcao 			= +$$$VARCadRelBancoProfisColunasOpcao(objeto)
	Set classe 			= $Piece(compColuna,"||",($Length(compColuna,"||")-1))
	Set coluna 			= $Piece(compColuna,"||",$Length(compColuna,"||"))
	Set grupoIndex 	= +$$$VARCadRelBancoProfisColunasGrupo(objeto)
	Set legenda 		= $$$VARCadRelBancoProfisColunasLegendanoGrid(objeto)
	Set grpColuna 	= $$$VARCadRelBancoProfisColunasGrupoColunas(objeto)
	
	Set indexClass 	= $Order(^WWW003s(YM, 3, $ZConvert(classe,"U"), $ZConvert(coluna,"U"), classe, ""))
	If (indexClass = "") {
		Set indexClass = $Order(^WWW003Calcs(YM, 1, $ZConvert(coluna,"U"), classe, ""))
		Quit:(indexClass = "")
		Set objWWW003Calc = $Get(^WWW003Calc(0,"GCONPaciente",indexClass,1))
		Set $$$WWW003CaptionInForms(objWWW003) = $$$WWW003CalcCaption(objWWW003Calc)
		Set $$$WWW003InputType(objWWW003) 		 = "4"
		Set $$$WWW003InputLength(objWWW003) 	 = 8
	}Else{
		Set objWWW003 		= $Get(^WWW003(YM, classe, indexClass, 1))
		Set objWWW003Calc = ""
	}
	
	
	Set flagSelParametro = 0
	If ($$$WWW003InputType(objWWW003) = "6") {
		If ($$$WWW003RelationDatabase(objWWW003) = "VARPARA") Set flagSelParametro = 1 
		If ($$$WWW003RelationDatabase(objWWW003) = "INPARA") Set flagSelParametro = 1 
		If ($$$WWW003RelationDatabase(objWWW003) = "WWW100") Set flagSelParametro = 1 
	}

	Set listColuna = {}
	Set listColuna.dataField 	= $Replace($Piece(compColuna,"||",1,$Length(compColuna,"||")-1),"||","") _ 
															"_" _ 
															$Piece(compColuna,"||",$Length(compColuna,"||"))
	Set tempColunas(listColuna.dataField) = ""
	
	Set listColuna.caption		= $Select(legenda="":$$$WWW003CaptionInForms(objWWW003),1:legenda) ;_"|"_rSet.%Get("GrupoColunas")
	Set:+grupoIndex'=0 listColuna.groupIndex = (+grupoIndex - 1)
	If ($$$WWW003InputLength(objWWW003) = 30) {
		;Set listColuna.width			= $$$WWW003InputLength(objWWW003) * 10
		Set listColuna.minWidth		= $$$WWW003InputLength(objWWW003) * 10
	}else{
		Set:classe'["GCONAtendimentoFormulario" listColuna.width			= $$$WWW003InputLength(objWWW003) * 10
		Set listColuna.minWidth		= 100
	}
	Set listColuna.visible 		= +$Select(rSet.%Get("Opcao")=1:"1",1:0)
	If (rSet.%Get("Opcao") = 1) {
		Set flagGrupoVisible = 1
	}
	If ($$$WWW003InputType(objWWW003) = "1") {
		Set listColuna.width		= 100
		Set listColuna.dataType = "date"
	}ElseIf ($$$WWW003InputType(objWWW003) = "4") {
		Set listColuna.dataType = "number"
		Set listColuna.width		= 100
	}
	
	If ($Find($ZConvert(listColuna.dataField,"U"),"CRIADOEM")||(($Find($ZConvert(listColuna.dataField,"U"),"ALTERADOEM")))) {
		Set listColuna.dataType = "datetime"
		Set listColuna.width		= 130
	}
			
	;Do:flagGrupo=0 arrayColumns.%Push(listColuna)
	Do:flagGrupo=1 arrayGrupo.%Push(listColuna)
	Quit]]></Implementation>
</Method>

<Method name="PrepGetColumnsHabilidades">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodRelatorio,pCodHabilidade,*arrayGrupo,*tempColunas</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[	Set flagGrupo = +$Get(^VARCadRelBancoProfisGrpColunas(0,pCodRelatorio,1,pCodHabilidade,1))

	If (flagGrupo = 1) {
		Set arrayColumns = []
		Set listColuna = {}
		Set listColuna.dataField 	= "VARHabilidade_"_pCodHabilidade_"_Grupo"
		Set tempColunas(listColuna.dataField) = ""
		Set listColuna.caption		= "Grupo"
		Set listColuna.width			= 350
		Do arrayColumns.%Push(listColuna)
		Set listGrupo = {}
		Set listGrupo.visible = 1
		Set listGrupo.caption = "Profissional - "_$Piece(^VARPARA(0,"TIPOHABILIDADE","PT", pCodHabilidade, 1),"~",1)
		Set listGrupo.columns	= arrayColumns
		Do arrayGrupo.%Push(listGrupo)
	}Else{
		Set flagNivel = 1, flagGrupo = 0, flagDescricao = 1
		Set meuSQLH = "Select * From SQLUser.VARCadRelBancoProfisColunas Where Company = 0 "
	  Set meuSQLH = meuSQLH _ "And Nvl(Opcao,0) Not In (0)  And Relatorio = '"_pCodRelatorio_"' " 
	  Set meuSQLH = meuSQLH _ "And $Piece(Coluna,'||',2) = 'VARHabilidade' And $Piece(Coluna,'||',3) = "_pCodHabilidade_" "
	  Set meuSQLH = meuSQLH _ "And $Piece(Coluna,'||',4) = 'Grupo' "
		Set meuSQLH = meuSQLH _ "Order By  Nvl(Sequencia,999999), $$GrupoRelatorio^VARSQL(Coluna, 1)"
		Set rSetH = ##class(%SQL.Statement).%ExecDirect("",meuSQLH)
	 	While (rSetH.%Next()) {
			Set flagGrupo = 1
			Quit
		}
		;		
		Set arrayColumns = []
		Set meuSQLH = "Select * From SQLUser.VARHabilidades Where Company = 0 "
		Set meuSQLH = meuSQLH _ "And Tipo = "_pCodHabilidade_" " 
		Set meuSQLH = meuSQLH _ "Order By Pacote, Descricao "
		Set rSetH = ##class(%SQL.Statement).%ExecDirect("",meuSQLH)
	 	While (rSetH.%Next()) {
			Set listColuna = {}
			Set listColuna.dataField 	= "VARHabilidade_"_pCodHabilidade_"_"_rSetH.%Get("Sequencia")
			Set tempColunas(listColuna.dataField) = ""
			Set listColuna.caption 		= rSetH.%Get("Descricao")
			If (flagGrupo = 1 && (rSetH.%Get("Pacote") '= "")) {
				Set listColuna.caption 		= rSetH.%Get("Pacote")_" - "_rSetH.%Get("Descricao")
			}
			Set listColuna.width			= 150
			Do arrayColumns.%Push(listColuna)
	 	}
		;
		Set listGrupo = {}
		Set listGrupo.visible = 1
		Set listGrupo.caption = "Profissional - "_$Piece(^VARPARA(0,"TIPOHABILIDADE","PT", pCodHabilidade, 1),"~",1)
		Set listGrupo.columns	= arrayColumns
		Do arrayGrupo.%Push(listGrupo)
	}

	Return $$$OK]]></Implementation>
</Method>

<Method name="PrepGetColumnsIdioma">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodRelatorio,pCodHabilidade,*arrayGrupo,*tempColunas</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[	Set flagGrupo = +$Get(^VARCadRelBancoProfisGrpColunas(0,pCodRelatorio,2,pCodHabilidade,1))

	Set flagIdioma = 1, flagCompreensao = 0, flagEscrita = 0, flagFala = 0
	Set meuSQLH = "Select * From SQLUser.VARCadRelBancoProfisColunas Where Company = 0 "
  Set meuSQLH = meuSQLH _ "And Nvl(Opcao,0) Not In (0)  And Relatorio = '"_pCodRelatorio_"' " 
  Set meuSQLH = meuSQLH _ "And $Piece(Coluna,'||',2) = 'VARIdioma' "
	Set meuSQLH = meuSQLH _ "Order By  Nvl(Sequencia,999999), $$GrupoRelatorio^VARSQL(Coluna, 1)"
	Set rSetH = ##class(%SQL.Statement).%ExecDirect("",meuSQLH)
 	While (rSetH.%Next()) {
		If ($Piece(rSetH.%Get("Coluna"),"||",4)="Compreensao") Set flagCompreensao = 1 
		If ($Piece(rSetH.%Get("Coluna"),"||",4)="Escrita") Set flagEscrita = 1 
		If ($Piece(rSetH.%Get("Coluna"),"||",4)="Fala") Set flagFala = 1 
	}
	Set grupoD = ""
	Set:flagCompreensao=1 grupoD = grupoD _$Select(grupoD="":"",1:" - ") _ "Compreensão"
	Set:flagEscrita=1 grupoD = grupoD _$Select(grupoD="":"",1:" - ") _ "Escrita"
	Set:flagFala=1 grupoD = grupoD _$Select(grupoD="":"",1:" - ") _ "Fala"

	If (flagGrupo = 1) {
		Set arrayColumns = []
		Set listColuna = {}
		Set listColuna.dataField 	= "VARIdioma_Grupo"
		Set tempColunas(listColuna.dataField_"_"_flagCompreensao_"_"_flagEscrita_"_"_flagFala) = ""
		Set listColuna.caption		= "Grupo ("_grupoD_")"
		Set listColuna.width			= 350
		Do arrayColumns.%Push(listColuna)
		Set listGrupo = {}
		Set listGrupo.visible = 1
		Set listGrupo.caption = "Profissional - Idioma"
		Set listGrupo.columns	= arrayColumns
		Do arrayGrupo.%Push(listGrupo)
	}Else{
		Set arrayColumns = []
		Set meuSQLH = "Select * From SQLUser.VARPARA Where Company = 0 And ParameterName = 'IDIOMA' "
		Set meuSQLH = meuSQLH _ "And %Upper(Text) <> 'OUTRAS' Order By Text" 
		Set rSetH = ##class(%SQL.Statement).%ExecDirect("",meuSQLH)
	 	While (rSetH.%Next()) {
			Set arrayIdioma = []
			Set listColuna = {}
			Set listColuna.dataField 	= "VARIdioma_"_rSetH.%Get("SearchWord")_"_Compreensao"
			Set tempColunas(listColuna.dataField) = ""
			Set listColuna.caption 		= "Compreensão"
			Set listColuna.width			= 110
			Do:flagCompreensao=1 arrayIdioma.%Push(listColuna)
			Set listColuna = {}
			Set listColuna.dataField 	= "VARIdioma_"_rSetH.%Get("SearchWord")_"_Escrita"
			Set tempColunas(listColuna.dataField) = ""
			Set listColuna.caption 		= "Escrita"
			Set listColuna.width			= 110
			Do:flagEscrita=1 arrayIdioma.%Push(listColuna)
			Set listColuna = {}
			Set listColuna.dataField 	= "VARIdioma_"_rSetH.%Get("SearchWord")_"_Fala"
			Set tempColunas(listColuna.dataField) = ""
			Set listColuna.caption 		= "Fala"
			Set listColuna.width			= 110
			Do:flagFala=1 arrayIdioma.%Push(listColuna)
			;
			Set listColuna = {}
			Set listColuna.caption 	= rSetH.%Get("Text")
			Set listColuna.columns		= arrayIdioma
			Do arrayColumns.%Push(listColuna)
	 	}
		;
		Set listGrupo = {}
		Set listGrupo.visible = 1
		Set listGrupo.caption = "Profissional - Idioma"
		Set listGrupo.columns	= arrayColumns
		Do arrayGrupo.%Push(listGrupo)
	}

	Return $$$OK]]></Implementation>
</Method>
</Class>
</Export>