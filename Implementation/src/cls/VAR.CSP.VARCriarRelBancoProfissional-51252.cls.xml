<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="Cache" ts="2001-01-01 00:00:00">
<Class name="VAR.CSP.VARCriarRelBancoProfissional">
<ClassType/>
<IncludeCode>MEDConst,VARConst,INConst,WWWConst,FATConst</IncludeCode>
<ProcedureBlock>0</ProcedureBlock>
<Super>%CSP.Page</Super>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	$$$VAR
	#Dim %request as %CSP.Request
	#Dim %response as %CSP.Response
	;Return:$$$ISERR(..ValidaSessao(1)) %response
	Set job = %session.SessionId
	Set method = $Get(%request.Data("method",1))
	Xecute "do .."_method_"()"
	Return $$$OK]]></Implementation>
</Method>

<Method name="ValidaSessao">
<ClassMethod>1</ClassMethod>
<FormalSpec>callMode=""</FormalSpec>
<Implementation><![CDATA[	Set status = $$VerifySession^VARCSPUtils(YBED, YUSER)
	If status=0||(YBED="UNKNOWN"){
		Set status=0
		Set %response.Status="401 Unauthorized"
		Set resp={}
		Set resp.status=0
		Set resp.mensagem="Usuário não está logado ou a sessão expirou."
		DO resp.%ToJSON()
	}ElseIf callMode=""{
		Set resp={}
		Set resp.status=1
		Do resp.%ToJSON()
	}
	Return status]]></Implementation>
</Method>

<Method name="ArmRelatorio">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	#Dim err As %Exception.SystemException

	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 							= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio 		= $Get(%request.Data("pCodRelatorio",1))	
	Set pObjDados					= $Get(%request.Data("pObjDados",1))	

	Set objDados 					= [].%FromJSON(pObjDados)

	TStart
	Set strStatus = ""
	Set erro = 0
	Try{
		Set applicationName = "VARMegaRH"
		Set menuItemNumber 	= "475.40."

		If (pCodRelatorio = "" || (pCodRelatorio = "+")) {
			Set pCodRelatorio = $$GetNextNumber^COMUtils("VARCadRelBancoProfis","")
		}

		Set objVARCadRelBancoProfis = $Get(^VARCadRelBancoProfis(YM, pCodRelatorio, 1))
		
		Set $$$VARCadRelBancoProfisNome(objVARCadRelBancoProfis) 							= objDados.nome
		Set $$$VARCadRelBancoProfisDescricao(objVARCadRelBancoProfis) 				= objDados.descricao
		Set $$$VARCadRelBancoProfisDesativado(objVARCadRelBancoProfis)				= objDados.desativado
		Set $$$VARCadRelBancoProfisAlteracoes(objVARCadRelBancoProfis) 				= $$$VARCadRelBancoProfisAlteracoes(objVARCadRelBancoProfis) + 1

		If ($$$VARCadRelBancoProfisCriadoEm(objVARCadRelBancoProfis) = "") {
			For i = 1 : 1 : 100 {
				If (i=100) {
					Set xMenuItemNumber = ""
					Quit
				}
				Set iF = $Extract("00",1,2-$Length(i))_i
				Set xMenuItemNumber = menuItemNumber_iF_"."
				If ($Data(^WWW004(YM,"VARMegaRH",xMenuItemNumber))) Continue
				Quit	
			}
			Set $$$VARCadRelBancoProfisIndiceMenu(objVARCadRelBancoProfis)= xMenuItemNumber
			Set $$$VARCadRelBancoProfisCriadoEm(objVARCadRelBancoProfis) 	= $Horolog
			Set $$$VARCadRelBancoProfisCriadoPor(objVARCadRelBancoProfis) = YBED
		}Else{
			Set $$$VARCadRelBancoProfisAlteradoEm(objVARCadRelBancoProfis) 	= $Horolog
			Set $$$VARCadRelBancoProfisAlteradoPor(objVARCadRelBancoProfis) = YBED
		}

		If ($$$VARCadRelBancoProfisIndiceMenu(objVARCadRelBancoProfis) '= "") {
			Set xMenuItemNumber = $$$VARCadRelBancoProfisIndiceMenu(objVARCadRelBancoProfis)
			If ($$$VARCadRelBancoProfisDesativado(objVARCadRelBancoProfis) = 1) {
				Kill ^WWW004(YM, applicationName, xMenuItemNumber, 1)
				Do RebuildIndexes^COMUtils("WWW004")
			}Else{
				Set objWWW004 = ""
				Set $$$WWW004MenuDescription(objWWW004) = objDados.nome
				Set $$$WWW004FormName(objWWW004) = "VARVisualizarRelBancoProfissional"
				Set $$$WWW004UserAccess(objWWW004) = "1;500"
				Set $$$WWW004TransferTriggerForForm(objWWW004) = pCodRelatorio
				Set $$$WWW004ImageFilegif(objWWW004) = "iconTela.gif"
				Set $$$WWW004EntryDate(objWWW004) = +$Horolog
				Set $$$WWW004EnteredBy(objWWW004) = YBED
				Set strStatus = $$$Save("WWW004", applicationName_$$$COMMA_xMenuItemNumber, objWWW004, $$$YES)
			}
		}

		Set strStatus = $$$Save("VARCadRelBancoProfis", pCodRelatorio, objVARCadRelBancoProfis, $$$YES)

	}
	Catch(err){
		Set strStatus = err.DisplayString()
		Set erro = err
	}
	;
	Set retorno = {}
	If ('erro) {
		If $Tl TCommit
		Set retorno.codRelatorio = pCodRelatorio
		Set retorno.status = strStatus
	}Else{
		TRollback
		Set retorno.status = strStatus
	}
	Do retorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="ListRelatorio">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	
	Set pSkip					= $Get(%request.Data("pSkip",1))	
	Set pTake					= $Get(%request.Data("pTake",1))
	Set pFilter				= $Get(%request.Data("pFilter",1))
	Set pSearchValue	= $Get(%request.Data("pSearchValue",1))

	If (pTake = "") Set pTake = 20

	Set arrayRetorno = []

	Set pTake = pTake + pSkip
	Set pSkip = pSkip + 1
		
	Set meuSQL = "Select * From (Select Top "_pTake_" * From SQLUser.VARCadRelBancoProfis Where Company = 0 "
	If (pCodRelatorio '= "") {
		Set meuSQL = meuSQL_"And Sequencia = '"_pCodRelatorio_"' "
	}Else{
		If (pSearchValue'="") {
			Set meuSQL = meuSQL_"And %Upper('('||Sequencia||') '||Nome) Like %Upper('%"_pSearchValue_"%')"
		}
	}
	Set meuSQL = meuSQL_") Where %VID Between "_pSkip_" and "_pTake_" "
	Set rSet = ##class(%SQL.Statement).%ExecDirect("",meuSQL)

 	While (rSet.%Next()) {
	 	Set listDados = {}
	 	Set listDados.sequencia = rSet.%Get("Sequencia")
	 	Set listDados.nome 			= "("_rSet.%Get("Sequencia")_") "_rSet.%Get("Nome")
	 	Do arrayRetorno.%Push(listDados)
 	}
 	;
 	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="GetRelatorio">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	

	Set objVARCadRelBancoProfis = $Get(^VARCadRelBancoProfis(YM, pCodRelatorio, 1))

	Set listDados 								= {}
	Set listDados.nome						= $$$VARCadRelBancoProfisNome(objVARCadRelBancoProfis)
	Set listDados.descricao				= $$$VARCadRelBancoProfisDescricao(objVARCadRelBancoProfis)
	Set listDados.desativado			= +$$$VARCadRelBancoProfisDesativado(objVARCadRelBancoProfis)
	Set listDados.criadoEm				= $ZDateTime($$$VARCadRelBancoProfisCriadoEm(objVARCadRelBancoProfis),4,2)
	Set listDados.criadoPor			= $$SQLGetUserName^VARSQL($$$VARCadRelBancoProfisCriadoPor(objVARCadRelBancoProfis))
	Set listDados.alteradoEm			= ""
	Set listDados.alteradoPor		= ""
	If ($$$VARCadRelBancoProfisAlteradoPor(objVARCadRelBancoProfis) '= "") {
		Set listDados.alteradoEm		= $ZDateTime($$$VARCadRelBancoProfisAlteradoEm(objVARCadRelBancoProfis),4,2)
		Set listDados.alteradoPor	= $$SQLGetUserName^VARSQL($$$VARCadRelBancoProfisAlteradoPor(objVARCadRelBancoProfis))
	}
 	Do listDados.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="ListFiltros">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 						= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio 	= $Get(%request.Data("pCodRelatorio",1))

	Set arrayRetorno = []
	
	Kill tempClasse
	Set tempClasse("||VARBancoProfissional") = ""
	
	Set xComp = ""
	For {
		Set xComp = $Order(tempClasse(xComp))
		Quit:xComp=""
		
		If (tempClasse(xComp) = "") {
			Do ListFiltrosPrep(xComp, arrayRetorno)
			Set tempClasse(xComp) = 1
			Set xComp = ""
		}
	}
	
	Do FiltroHabilidades(arrayRetorno)
	Do FiltroIdioma(arrayRetorno)
	
	Do arrayRetorno.%ToJSON()
	Return $$$OK	
	
FiltroHabilidades(arrayRetorno)
	Set tipoHabiliade = ""
	For {
		Set tipoHabiliade = $Order(^VARPARA(0,"TIPOHABILIDADE","PT", tipoHabiliade))
		Quit:tipoHabiliade=""

		Set listLinha 							= {}
		Set listLinha.codigo 				= "||VARHabilidade||"_tipoHabiliade_"||Descricao"
		Set listLinha.grupo 				= "Profissional - "_$Piece(^VARPARA(0,"TIPOHABILIDADE","PT", tipoHabiliade, 1),"~",1)
		Set listLinha.campo 				= "Descrição"
		Set listLinha.permFilt			= "1"
		Set listLinha.sequencia			= ""
		Set listLinha.tipo					= ""
		Set listLinha.tipoDesc			= ""
		Set listLinha.colSpan				= ""
		Set listLinha.legFormulario = ""
		Set listLinha.ativo					= +0
		Set listLinha.obrigatorio		= +0
		Set listLinha.tipoCampo			= "6"
		If ($Data(^VARCadRelBancoProfisFiltro(0, pCodRelatorio, listLinha.codigo, 1))) {
			Set objVARCadRelFil 				= $Get(^VARCadRelBancoProfisFiltro(0, pCodRelatorio, listLinha.codigo, 1))
			Set listLinha.sequencia			= $$$VARCadRelBancoProfisFiltroSequencia(objVARCadRelFil)
			Set listLinha.tipo					= $$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)
			Set listLinha.tipoDesc			= $Select(
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=1:"Simples",
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=2:"De - Até",
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=3:"Múltiplo",
																			1:"")
			Set listLinha.legFormulario = $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objVARCadRelFil)
			Set listLinha.colSpan				= $$$VARCadRelBancoProfisFiltroColSpan(objVARCadRelFil)
			Set listLinha.ativo					= +$$$VARCadRelBancoProfisFiltroAtivo(objVARCadRelFil)
			Set listLinha.obrigatorio		= +$$$VARCadRelBancoProfisFiltroObrigatorio(objVARCadRelFil)
			Set listLinha.legFormulario = $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objVARCadRelFil)
		}
		Do arrayRetorno.%Push(listLinha) 

		Set listLinha 							= {}
		Set listLinha.codigo 				= "||VARHabilidade||"_tipoHabiliade_"||Nivel"
		Set listLinha.grupo 				= "Profissional - "_$Piece(^VARPARA(0,"TIPOHABILIDADE","PT", tipoHabiliade, 1),"~",1)
		Set listLinha.campo 				= "Nível"
		Set listLinha.permFilt			= "1"
		Set listLinha.sequencia			= ""
		Set listLinha.tipo					= ""
		Set listLinha.tipoDesc			= ""
		Set listLinha.colSpan				= ""
		Set listLinha.legFormulario = ""
		Set listLinha.ativo					= +0
		Set listLinha.obrigatorio		= +0
		Set listLinha.tipoCampo			= "6"
		If ($Data(^VARCadRelBancoProfisFiltro(0, pCodRelatorio, listLinha.codigo, 1))) {
			Set objVARCadRelFil 				= $Get(^VARCadRelBancoProfisFiltro(0, pCodRelatorio, listLinha.codigo, 1))
			Set listLinha.sequencia			= $$$VARCadRelBancoProfisFiltroSequencia(objVARCadRelFil)
			Set listLinha.tipo					= $$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)
			Set listLinha.tipoDesc			= $Select(
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=1:"Simples",
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=2:"De - Até",
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=3:"Múltiplo",
																			1:"")
			Set listLinha.legFormulario = $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objVARCadRelFil)
			Set listLinha.colSpan				= $$$VARCadRelBancoProfisFiltroColSpan(objVARCadRelFil)
			Set listLinha.ativo					= +$$$VARCadRelBancoProfisFiltroAtivo(objVARCadRelFil)
			Set listLinha.obrigatorio		= +$$$VARCadRelBancoProfisFiltroObrigatorio(objVARCadRelFil)
			Set listLinha.legFormulario = $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objVARCadRelFil)
		}
		Do arrayRetorno.%Push(listLinha) 

	}
	Quit	
	
FiltroIdioma(arrayRetorno)
	
	Set listLinha 							= {}
	Set listLinha.codigo 				= "||VARIdioma||Idioma"
	Set listLinha.grupo 				= "Profissional - Idioma"
	Set listLinha.campo 				= "Idioma"
	Set listLinha.permFilt			= "1"
	Set listLinha.sequencia			= ""
	Set listLinha.tipo					= ""
	Set listLinha.tipoDesc			= ""
	Set listLinha.colSpan				= ""
	Set listLinha.legFormulario = ""
	Set listLinha.ativo					= +0
	Set listLinha.obrigatorio		= +0
	Set listLinha.tipoCampo			= "6"
	If ($Data(^VARCadRelBancoProfisFiltro(0, pCodRelatorio, listLinha.codigo, 1))) {
		Set objVARCadRelFil 				= $Get(^VARCadRelBancoProfisFiltro(0, pCodRelatorio, listLinha.codigo, 1))
		Set listLinha.sequencia			= $$$VARCadRelBancoProfisFiltroSequencia(objVARCadRelFil)
		Set listLinha.tipo					= $$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)
		Set listLinha.tipoDesc			= $Select(
																		$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=1:"Simples",
																		$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=2:"De - Até",
																		$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=3:"Múltiplo",
																		1:"")
		Set listLinha.legFormulario = $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objVARCadRelFil)
		Set listLinha.colSpan				= $$$VARCadRelBancoProfisFiltroColSpan(objVARCadRelFil)
		Set listLinha.ativo					= +$$$VARCadRelBancoProfisFiltroAtivo(objVARCadRelFil)
		Set listLinha.obrigatorio		= +$$$VARCadRelBancoProfisFiltroObrigatorio(objVARCadRelFil)
		Set listLinha.legFormulario = $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objVARCadRelFil)
	}
	Do arrayRetorno.%Push(listLinha) 

	Quit	

	
ListFiltrosPrep(pComp, arrayRetorno)
	New (pComp, arrayRetorno, tempClasse, pCodRelatorio)	

	Set numNivel = $Length(pComp,"||") 
	
	Set pCampo 	= $Piece(pComp,"||",1,numNivel-1)
	Set pClasse = $Piece(pComp,"||",numNivel)
	
	Set objWWW001 = $Get(^WWW001(0,pClasse,1))
	
	Set nSeqCampo = ""
	For {
		Set nSeqCampo = $Order(^WWW003(0,pClasse,nSeqCampo))
		Quit:nSeqCampo=""
		
		Set objWWW003 = $Get(^WWW003(0,pClasse,nSeqCampo,1))
		
		If (+$$$WWW003PermiteFiltro(objWWW003)=0) Continue

		If ($$$WWW003InputType(objWWW003)=6&&($$$WWW003RelationDatabase(objWWW003)'="")) {
			If ('$Data(tempClasse(pCampo_"||"_pClasse_"||"_$$$WWW003PropertyName(objWWW003)_"||"_$$$WWW003RelationDatabase(objWWW003)))) {
				;Set tempClasse(pCampo_"||"_pClasse_"||"_$$$WWW003PropertyName(objWWW003)_"||"_$$$WWW003RelationDatabase(objWWW003)) = ""
			}	
		}

		Set campoFormatado 				= pCampo_"||"_pClasse_"||"_$$$WWW003PropertyName(objWWW003)
		Set listLinha 						= {}
		Set listLinha.codigo 			= campoFormatado
		Set fGrupo = ""
		For index = 2 : 2 : $Length(campoFormatado,"||") {
			If (index > 2) {
				Set yClasse = $Piece(campoFormatado,"||",index-2)
				Set yColuna = $Piece(campoFormatado,"||",index-1)
				Set yIndex 	= $Order(^WWW003s(0,3,$ZConvert(yClasse,"U"),$ZConvert(yColuna,"U"),yClasse,""))
				Set objWWW003Grupo = $Get(^WWW003(0,yClasse,yIndex,1))
				Set fGrupo = fGrupo _ $Select(fGrupo="":"",1:" - ") _ $$$WWW003CaptionInForms(objWWW003Grupo)
			}Else{
				Set objWWW001Grupo = $Get(^WWW001(0,$Piece(campoFormatado,"||",index),1))
				Set fGrupo = fGrupo _ $Select(fGrupo="":"",1:" - ") _ $Piece($$$WWW001ClassDescription(objWWW001Grupo)," - ",2)
			}
		}
		Set listLinha.grupo 				= fGrupo
		Set listLinha.campo 				= $$$WWW003CaptionInForms(objWWW003)
		Set listLinha.permFilt			= $$$WWW003PermiteFiltro(objWWW003)
		Set listLinha.sequencia			= ""
		Set listLinha.tipo					= ""
		Set listLinha.tipoDesc			= ""
		Set listLinha.colSpan				= ""
		Set listLinha.legFormulario = ""
		Set listLinha.ativo					= +0
		Set listLinha.obrigatorio		= +0
		Set listLinha.tipoCampo			= $$$WWW003InputType(objWWW003)
		If ($Data(^VARCadRelBancoProfisFiltro(0, pCodRelatorio, campoFormatado, 1))) {
			Set objVARCadRelFil 				= $Get(^VARCadRelBancoProfisFiltro(0, pCodRelatorio, campoFormatado, 1))
			Set listLinha.sequencia			= $$$VARCadRelBancoProfisFiltroSequencia(objVARCadRelFil)
			Set listLinha.tipo					= $$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)
			Set listLinha.tipoDesc			= $Select(
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=1:"Simples",
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=2:"De - Até",
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=3:"Múltiplo",
																			1:"")
			Set listLinha.legFormulario = $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objVARCadRelFil)
			Set listLinha.colSpan				= $$$VARCadRelBancoProfisFiltroColSpan(objVARCadRelFil)
			Set listLinha.ativo					= +$$$VARCadRelBancoProfisFiltroAtivo(objVARCadRelFil)
			Set listLinha.obrigatorio		= +$$$VARCadRelBancoProfisFiltroObrigatorio(objVARCadRelFil)
			Set listLinha.legFormulario = $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objVARCadRelFil)
		}
		Do arrayRetorno.%Push(listLinha) 
	}
	
	;Campos Calculados 
	Set nSeqCampo = ""
	For {
		Set nSeqCampo = $Order(^WWW003Calc(0,pClasse,nSeqCampo))
		Quit:nSeqCampo=""
		Set objWWW003Calc = $Get(^WWW003Calc(0,pClasse,nSeqCampo,1))
		
		Set campoFormatado 				= pCampo_"||"_pClasse_"||"_$$$WWW003CalcFieldName(objWWW003Calc)
		Set listLinha 						= {}
		Set listLinha.codigo 			= campoFormatado
		Set fGrupo = ""
		For index = 2 : 2 : $Length(campoFormatado,"||") {
			If (index > 2) {
				Set yClasse = $Piece(campoFormatado,"||",index-2)
				Set yColuna = $Piece(campoFormatado,"||",index-1)
				Set yIndex 	= $Order(^WWW003s(0,3,$ZConvert(yClasse,"U"),$ZConvert(yColuna,"U"),yClasse,""))
				Set objWWW003Grupo = $Get(^WWW003(0,yClasse,yIndex,1))
				Set fGrupo = fGrupo _ $Select(fGrupo="":"",1:" - ") _ $$$WWW003CaptionInForms(objWWW003Grupo)
			}Else{
				Set objWWW001Grupo = $Get(^WWW001(0,$Piece(campoFormatado,"||",index),1))
				Set fGrupo = fGrupo _ $Select(fGrupo="":"",1:" - ") _ $Piece($$$WWW001ClassDescription(objWWW001Grupo)," - ",2)
			}
		}
		Set listLinha.grupo 				= fGrupo
		Set listLinha.campo 				= $$$WWW003CalcCaption(objWWW003Calc)
		Set listLinha.permFilt			= 1
		Set listLinha.sequencia			= ""
		Set listLinha.tipo					= ""
		Set listLinha.tipoDesc			= ""
		Set listLinha.colSpan				= ""
		Set listLinha.legFormulario = ""
		Set listLinha.ativo					= +0
		Set listLinha.obrigatorio		= +0
		Set listLinha.tipoCampo			= 4
		If ($Data(^VARCadRelBancoProfisFiltro(0, pCodRelatorio, campoFormatado, 1))) {
			Set objVARCadRelFil 				= $Get(^VARCadRelBancoProfisFiltro(0, pCodRelatorio, campoFormatado, 1))
			Set listLinha.sequencia			= $$$VARCadRelBancoProfisFiltroSequencia(objVARCadRelFil)
			Set listLinha.tipo					= $$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)
			Set listLinha.tipoDesc			= $Select(
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=1:"Simples",
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=2:"De - Até",
																			$$$VARCadRelBancoProfisFiltroTipo(objVARCadRelFil)=3:"Múltiplo",
																			1:"")
			Set listLinha.legFormulario = $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objVARCadRelFil)
			Set listLinha.colSpan				= $$$VARCadRelBancoProfisFiltroColSpan(objVARCadRelFil)
			Set listLinha.ativo					= +$$$VARCadRelBancoProfisFiltroAtivo(objVARCadRelFil)
			Set listLinha.obrigatorio		= +$$$VARCadRelBancoProfisFiltroObrigatorio(objVARCadRelFil)
			Set listLinha.legFormulario = $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objVARCadRelFil)
		}
		Do arrayRetorno.%Push(listLinha) 
	}
	
	Quit]]></Implementation>
</Method>

<Method name="SetFiltros">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	
	Set pCampo				= $Get(%request.Data("pCampo",1))	
	Set pCouluna			= $Get(%request.Data("pCouluna",1))	
	Set pConteudo			= $Get(%request.Data("pConteudo",1))	

	Set objeto = $Get(^VARCadRelBancoProfisFiltro(YM, pCodRelatorio, pCampo, 1))
	
	Set:pCouluna="sequencia" $$$VARCadRelBancoProfisFiltroSequencia(objeto) = pConteudo
	Set:pCouluna="tipo" $$$VARCadRelBancoProfisFiltroTipo(objeto) = pConteudo
	Set:pCouluna="colSpan" $$$VARCadRelBancoProfisFiltroColSpan(objeto) = pConteudo
	Set:pCouluna="ativo" $$$VARCadRelBancoProfisFiltroAtivo(objeto) = +pConteudo
	Set:pCouluna="obrigatorio" $$$VARCadRelBancoProfisFiltroObrigatorio(objeto) = +pConteudo
	Set:pCouluna="legFormulario" $$$VARCadRelBancoProfisFiltroLegendanoFormulario(objeto) = pConteudo

	Set strStatus = $$$Save("VARCadRelBancoProfisFiltro", pCodRelatorio_$$$COMMA_pCampo, objeto, $$$YES)]]></Implementation>
</Method>

<Method name="LimparFiltros">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	

	Kill ^VARCadRelBancoProfisFiltro(YM, pCodRelatorio)
	Do RebuildIndexes^COMUtils("VARCadRelBancoProfisFiltro")
	
	Return $$$OK]]></Implementation>
</Method>

<Method name="ListColunas">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
	
	Set YBED 						= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio 	= $Get(%request.Data("pCodRelatorio",1))	

	Set arrayRetorno = []
	
	Kill tempClasse
	Set tempClasse("||VARBancoProfissional") = ""
	;Set tempClasse("||VARHabilidades") = ""

	Set xComp = ""
	For {
		Set xComp = $Order(tempClasse(xComp))
		Quit:xComp=""
		
		If (tempClasse(xComp) = "") {
			Do ListColunasPrep(xComp, arrayRetorno)
			Set tempClasse(xComp) = 1
			Set xComp = ""
		}
	}
	;
	Do ColumHabilidades(arrayRetorno)
	Do ColumIdioma(arrayRetorno)
	;
	Do arrayRetorno.%ToJSON()
	Return $$$OK	

ColumHabilidades(arrayRetorno)
	Set tipoHabiliade = ""
	For {
		Set tipoHabiliade = $Order(^VARPARA(0,"TIPOHABILIDADE","PT", tipoHabiliade))
		Quit:tipoHabiliade=""
		
		Set listLinha 						= {}
		Set listLinha.tipo 				= 1
		Set listLinha.grpHabil 		= 1
		Set listLinha.selGrpHabil = +$Get(^VARCadRelBancoProfisGrpColunas(0, pCodRelatorio, 1, tipoHabiliade , 1))
		Set listLinha.coluna 			= "Grupo"
		Set listLinha.codigo 			= "||VARHabilidade||"_tipoHabiliade_"||"_listLinha.coluna
		Set listLinha.grupo 			= "Profissional - "_$Piece(^VARPARA(0,"TIPOHABILIDADE","PT", tipoHabiliade, 1),"~",1)
		Set listLinha.idCampo 		= ""
		Set listLinha.opcao				= ""
		Set listLinha.legGrid			= ""
		Set listLinha.grupoSeq  	= ""
		Set listLinha.sequencia		= ""
		Set listLinha.tipoDados		= ""
		Set listLinha.flagEdit		= 0
		Set listLinha.grpColunaCod 	= ""
		Set listLinha.grpColunaDesc = ""
		If ($Data(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo, 1))) {
			Set objVARCadRelColuna 	= $Get(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo , 1))
			Set listLinha.legGrid		= $$$VARCadRelBancoProfisColunasLegendanoGrid(objVARCadRelColuna)
			Set listLinha.opcao	 		= +$$$VARCadRelBancoProfisColunasOpcao(objVARCadRelColuna)
			Set listLinha.sequencia	= $$$VARCadRelBancoProfisColunasSequencia(objVARCadRelColuna)
			Set listLinha.grpColunaCod 	= $$$VARCadRelBancoProfisColunasGrupoColunas(objVARCadRelColuna)
		}
		Do arrayRetorno.%Push(listLinha)

		Set listLinha 					= {}
		Set listLinha.tipo 			= 1
		Set listLinha.grpHabil 	= 1
		Set listLinha.coluna 		= "Descrição"
		Set listLinha.codigo 		= "||VARHabilidade||"_tipoHabiliade_"||Descricao"
		Set listLinha.grupo 		= "Profissional - "_$Piece(^VARPARA(0,"TIPOHABILIDADE","PT", tipoHabiliade, 1),"~",1)
		Set listLinha.idCampo 	= ""
		Set listLinha.opcao			= ""
		Set listLinha.legGrid		= ""
		Set listLinha.grupoSeq  = ""
		Set listLinha.sequencia	= ""
		Set listLinha.tipoDados	= ""
		Set listLinha.flagEdit	= 0
		Set listLinha.grpColunaCod 	= ""
		Set listLinha.grpColunaDesc = ""
		If ($Data(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo, 1))) {
			Set objVARCadRelColuna 	= $Get(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo, 1))
			Set listLinha.legGrid		= $$$VARCadRelBancoProfisColunasLegendanoGrid(objVARCadRelColuna)
			Set listLinha.opcao	 		= +$$$VARCadRelBancoProfisColunasOpcao(objVARCadRelColuna)
			Set listLinha.sequencia	= $$$VARCadRelBancoProfisColunasSequencia(objVARCadRelColuna)
			Set listLinha.grpColunaCod 	= $$$VARCadRelBancoProfisColunasGrupoColunas(objVARCadRelColuna)
		}
		Do arrayRetorno.%Push(listLinha)

		Set listLinha 					= {}
		Set listLinha.tipo 			= 1
		Set listLinha.grpHabil 	= 1
		Set listLinha.coluna 		= "Nível"
		Set listLinha.codigo 		= "||VARHabilidade||"_tipoHabiliade_"||Nivel"
		Set listLinha.grupo 		= "Profissional - "_$Piece(^VARPARA(0,"TIPOHABILIDADE","PT", tipoHabiliade, 1),"~",1)
		Set listLinha.idCampo 	= ""
		Set listLinha.opcao			= ""
		Set listLinha.legGrid		= ""
		Set listLinha.grupoSeq  = ""
		Set listLinha.sequencia	= ""
		Set listLinha.tipoDados	= ""
		Set listLinha.flagEdit	= 0
		Set listLinha.grpColunaCod 	= ""
		Set listLinha.grpColunaDesc = ""
		If ($Data(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo, 1))) {
			Set objVARCadRelColuna 	= $Get(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo , 1))
			Set listLinha.legGrid		= $$$VARCadRelBancoProfisColunasLegendanoGrid(objVARCadRelColuna)
			Set listLinha.opcao	 		= +$$$VARCadRelBancoProfisColunasOpcao(objVARCadRelColuna)
			Set listLinha.sequencia	= $$$VARCadRelBancoProfisColunasSequencia(objVARCadRelColuna)
			Set listLinha.grpColunaCod 	= $$$VARCadRelBancoProfisColunasGrupoColunas(objVARCadRelColuna)
		}
		Do arrayRetorno.%Push(listLinha)
	}
	Quit

ColumIdioma(arrayRetorno)
	Set listLinha 						= {}
	Set listLinha.tipo 				= 2
	Set listLinha.grpHabil 		= 1
	Set listLinha.selGrpHabil = +$Get(^VARCadRelBancoProfisGrpColunas(0, pCodRelatorio, 2, 1 , 1))
	Set listLinha.coluna 			= "Idioma"
	Set listLinha.codigo 			= "||VARIdioma||"_1_"||"_listLinha.coluna
	Set listLinha.grupo 			= "Profissional - Idioma"
	Set listLinha.idCampo 		= ""
	Set listLinha.opcao				= ""
	Set listLinha.legGrid			= ""
	Set listLinha.grupoSeq  	= ""
	Set listLinha.sequencia		= ""
	Set listLinha.tipoDados		= ""
	Set listLinha.flagEdit		= 0
	Set listLinha.grpColunaCod 	= ""
	Set listLinha.grpColunaDesc = ""
	If ($Data(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo, 1))) {
		Set objVARCadRelColuna 	= $Get(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo , 1))
		Set listLinha.legGrid		= $$$VARCadRelBancoProfisColunasLegendanoGrid(objVARCadRelColuna)
		Set listLinha.opcao	 		= +$$$VARCadRelBancoProfisColunasOpcao(objVARCadRelColuna)
		Set listLinha.sequencia	= $$$VARCadRelBancoProfisColunasSequencia(objVARCadRelColuna)
		Set listLinha.grpColunaCod 	= $$$VARCadRelBancoProfisColunasGrupoColunas(objVARCadRelColuna)
	}
	Do arrayRetorno.%Push(listLinha)

	Set listLinha 						= {}
	Set listLinha.tipo 				= 2
	Set listLinha.grpHabil 		= 1
	Set listLinha.selGrpHabil = +$Get(^VARCadRelBancoProfisGrpColunas(0, pCodRelatorio, 2, 1 , 1))
	Set listLinha.coluna 			= "Compreensão"
	Set listLinha.codigo 			= "||VARIdioma||"_1_"||Compreensao"
	Set listLinha.grupo 			= "Profissional - Idioma"
	Set listLinha.idCampo 		= ""
	Set listLinha.opcao				= ""
	Set listLinha.legGrid			= ""
	Set listLinha.grupoSeq  	= ""
	Set listLinha.sequencia		= ""
	Set listLinha.tipoDados		= ""
	Set listLinha.flagEdit		= 0
	Set listLinha.grpColunaCod 	= ""
	Set listLinha.grpColunaDesc = ""
	If ($Data(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo, 1))) {
		Set objVARCadRelColuna 	= $Get(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo, 1))
		Set listLinha.legGrid		= $$$VARCadRelBancoProfisColunasLegendanoGrid(objVARCadRelColuna)
		Set listLinha.opcao	 		= +$$$VARCadRelBancoProfisColunasOpcao(objVARCadRelColuna)
		Set listLinha.sequencia	= $$$VARCadRelBancoProfisColunasSequencia(objVARCadRelColuna)
		Set listLinha.grpColunaCod 	= $$$VARCadRelBancoProfisColunasGrupoColunas(objVARCadRelColuna)
	}
	Do arrayRetorno.%Push(listLinha)

	Set listLinha 						= {}
	Set listLinha.tipo 				= 2
	Set listLinha.grpHabil 		= 1
	Set listLinha.selGrpHabil = +$Get(^VARCadRelBancoProfisGrpColunas(0, pCodRelatorio, 2, 1 , 1))
	Set listLinha.coluna 			= "Fala"
	Set listLinha.codigo 			= "||VARIdioma||"_1_"||"_listLinha.coluna
	Set listLinha.grupo 			= "Profissional - Idioma"
	Set listLinha.idCampo 		= ""
	Set listLinha.opcao				= ""
	Set listLinha.legGrid			= ""
	Set listLinha.grupoSeq  	= ""
	Set listLinha.sequencia		= ""
	Set listLinha.tipoDados		= ""
	Set listLinha.flagEdit		= 0
	Set listLinha.grpColunaCod 	= ""
	Set listLinha.grpColunaDesc = ""
	If ($Data(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo, 1))) {
		Set objVARCadRelColuna 	= $Get(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo , 1))
		Set listLinha.legGrid		= $$$VARCadRelBancoProfisColunasLegendanoGrid(objVARCadRelColuna)
		Set listLinha.opcao	 		= +$$$VARCadRelBancoProfisColunasOpcao(objVARCadRelColuna)
		Set listLinha.sequencia	= $$$VARCadRelBancoProfisColunasSequencia(objVARCadRelColuna)
		Set listLinha.grpColunaCod 	= $$$VARCadRelBancoProfisColunasGrupoColunas(objVARCadRelColuna)
	}
	Do arrayRetorno.%Push(listLinha)

	Set listLinha 						= {}
	Set listLinha.tipo 				= 2
	Set listLinha.grpHabil 		= 1
	Set listLinha.selGrpHabil = +$Get(^VARCadRelBancoProfisGrpColunas(0, pCodRelatorio, 2, 1 , 1))
	Set listLinha.coluna 			= "Escrita"
	Set listLinha.codigo 			= "||VARIdioma||"_1_"||"_listLinha.coluna
	Set listLinha.grupo 			= "Profissional - Idioma"
	Set listLinha.idCampo 		= ""
	Set listLinha.opcao				= ""
	Set listLinha.legGrid			= ""
	Set listLinha.grupoSeq  	= ""
	Set listLinha.sequencia		= ""
	Set listLinha.tipoDados		= ""
	Set listLinha.flagEdit		= 0
	Set listLinha.grpColunaCod 	= ""
	Set listLinha.grpColunaDesc = ""
	If ($Data(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo, 1))) {
		Set objVARCadRelColuna 	= $Get(^VARCadRelBancoProfisColunas(0, pCodRelatorio, listLinha.codigo , 1))
		Set listLinha.legGrid		= $$$VARCadRelBancoProfisColunasLegendanoGrid(objVARCadRelColuna)
		Set listLinha.opcao	 		= +$$$VARCadRelBancoProfisColunasOpcao(objVARCadRelColuna)
		Set listLinha.sequencia	= $$$VARCadRelBancoProfisColunasSequencia(objVARCadRelColuna)
		Set listLinha.grpColunaCod 	= $$$VARCadRelBancoProfisColunasGrupoColunas(objVARCadRelColuna)
	}
	Do arrayRetorno.%Push(listLinha)
	Quit

	
ListColunasPrep(pComp, arrayRetorno)
	New (pComp, arrayRetorno, tempClasse, pCodRelatorio)	

	Set numNivel = $Length(pComp,"||") 
	
	Set pCampo 	= $Piece(pComp,"||",1,numNivel-1)
	Set pClasse = $Piece(pComp,"||",numNivel)

	Set objWWW001 = $Get(^WWW001(0,pClasse,1))

	Set nSeqCampo = ""
	For {
		Set nSeqCampo = $Order(^WWW003(0,pClasse,nSeqCampo))
		Quit:nSeqCampo=""
		Set objWWW003 = $Get(^WWW003(0,pClasse,nSeqCampo,1))
		
		;If ($ZConvert($$$WWW003PropertyName(objWWW003),"U") = "CRIADOPOR" || ($ZConvert($$$WWW003PropertyName(objWWW003),"U") = "ALTERADOPOR")) Continue
		;If ($ZConvert($$$WWW003PropertyName(objWWW003),"U") = "CRIADOEM" || ($ZConvert($$$WWW003PropertyName(objWWW003),"U") = "ALTERADOEM")) Continue

		;If ($ZConvert($$$WWW003PropertyName(objWWW003),"U") = "CRIADOPOR" || ($ZConvert($$$WWW003PropertyName(objWWW003),"U") = "ALTERADOPOR")) Continue
		;If ($ZConvert($$$WWW003PropertyName(objWWW003),"U") = "CRIADOEM") Continue
		
		If ($$$WWW003InputType(objWWW003)=6&&
			 ($$$WWW003RelationDatabase(objWWW003)'="")&&
			 ($$$WWW003RelationDatabase(objWWW003)'="VARPARA")&&
			 ($$$WWW003RelationDatabase(objWWW003)'="WWW013")&&
			 ($$$WWW003RelationDatabase(objWWW003)'="INPARA")&&
			 ($$$WWW003RelationDatabase(objWWW003)'="WWW001")&&
			 ($$$WWW003RelationDatabase(objWWW003)'="WWW101")&&
			 ($$$WWW003RelationDatabase(objWWW003)'="WWW102")) {
			If ('$Data(tempClasse(pCampo_"||"_pClasse_"||"_$$$WWW003PropertyName(objWWW003)_"||"_$$$WWW003RelationDatabase(objWWW003)))) {
				Set tempClasse(pCampo_"||"_pClasse_"||"_$$$WWW003PropertyName(objWWW003)_"||"_$$$WWW003RelationDatabase(objWWW003)) = ""
			}	
		}
		Set campoFormatado 				= pCampo_"||"_pClasse_"||"_$$$WWW003PropertyName(objWWW003)
		Set listLinha 						= {}
		Set listLinha.codigo 			= campoFormatado
		Set fGrupo = ""
		For index = 2 : 2 : $Length(campoFormatado,"||") {
			If (index > 2) {
				Set yClasse = $Piece(campoFormatado,"||",index-2)
				Set yColuna = $Piece(campoFormatado,"||",index-1)
				Set yIndex 	= $Order(^WWW003s(0,3,$ZConvert(yClasse,"U"),$ZConvert(yColuna,"U"),yClasse,""))
				Set objWWW003Grupo = $Get(^WWW003(0,yClasse,yIndex,1))
				Set fGrupo = fGrupo _ " - " _ $$$WWW003CaptionInForms(objWWW003Grupo)
			}Else{
				Set objWWW001Grupo = $Get(^WWW001(0,$Piece(campoFormatado,"||",index),1))
				Set fGrupo = fGrupo _ "" _ $Piece($$$WWW001ClassDescription(objWWW001Grupo)," - ",2)
			}
		}
		Set flagEdit 						= 0
		Set listLinha.grpHabil 	= 0
		Set listLinha.grupo 		= fGrupo
		Set listLinha.coluna 		= $$$WWW003CaptionInForms(objWWW003)
		Set listLinha.idCampo 	= $$$WWW003PropertyName(objWWW003)
		Set listLinha.opcao			= ""
		Set listLinha.legGrid		= ""
		Set listLinha.grupoSeq  = ""
		Set listLinha.sequencia	= ""
		Set listLinha.tipoDados	= ""
		Set listLinha.flagEdit	= +flagEdit
		Set listLinha.grpColunaCod 	= ""
		Set listLinha.grpColunaDesc = ""
		If ($Data(^VARCadRelBancoProfisColunas(0, pCodRelatorio, campoFormatado, 1))) {
			Set objVARCadRelColuna 	= $Get(^VARCadRelBancoProfisColunas(0, pCodRelatorio, campoFormatado, 1))
			Set listLinha.legGrid		= $$$VARCadRelBancoProfisColunasLegendanoGrid(objVARCadRelColuna)
			Set listLinha.opcao	 		= +$$$VARCadRelBancoProfisColunasOpcao(objVARCadRelColuna)
			Set listLinha.sequencia	= $$$VARCadRelBancoProfisColunasSequencia(objVARCadRelColuna)
			Set listLinha.grupoSeq  = $$$VARCadRelBancoProfisColunasGrupo(objVARCadRelColuna)
			Set listLinha.tipoDados	= $$$VARCadRelBancoProfisColunasTipodeDados(objVARCadRelColuna)
			Set listLinha.grpColunaCod 	= $$$VARCadRelBancoProfisColunasGrupoColunas(objVARCadRelColuna)
		}
		Do arrayRetorno.%Push(listLinha) 
	}

	;Campos Calculados 
	Set nSeqCampo = ""
	For {
		Set nSeqCampo = $Order(^WWW003Calc(0,pClasse,nSeqCampo))
		Quit:nSeqCampo=""
		Set objWWW003Calc = $Get(^WWW003Calc(0,pClasse,nSeqCampo,1))

		Set campoFormatado 			= pCampo_"||"_pClasse_"||"_$$$WWW003CalcFieldName(objWWW003Calc)
		Set listLinha 					= {}
		Set listLinha.codigo 		= campoFormatado
		Set fGrupo = ""
		For index = 2 : 2 : $Length(campoFormatado,"||") {
			If (index > 2) {
				Set yClasse = $Piece(campoFormatado,"||",index-2)
				Set yColuna = $Piece(campoFormatado,"||",index-1)
				Set yIndex 	= $Order(^WWW003s(0,3,$ZConvert(yClasse,"U"),$ZConvert(yColuna,"U"),yClasse,""))
				Set objWWW003Grupo = $Get(^WWW003(0,yClasse,yIndex,1))
				Set fGrupo = fGrupo _ " - " _ $$$WWW003CaptionInForms(objWWW003Grupo)
			}Else{
				Set objWWW001Grupo = $Get(^WWW001(0,$Piece(campoFormatado,"||",index),1))
				Set fGrupo = fGrupo _ "" _ $Piece($$$WWW001ClassDescription(objWWW001Grupo)," - ",2)
			}
		}
		Set listLinha.grpHabil 	= 0
		Set listLinha.grupo 		= fGrupo
		Set listLinha.coluna 		= $$$WWW003CalcCaption(objWWW003Calc)
		Set listLinha.idCampo 	= $$$WWW003CalcFieldName(objWWW003Calc)
		Set listLinha.opcao			= ""
		Set listLinha.legGrid		= ""
		Set listLinha.sequencia	= ""
		Set listLinha.grpColunaCod 	= ""
		Set listLinha.grpColunaDesc = ""
		If ($Data(^VARCadRelBancoProfisColunas(0, pCodRelatorio, campoFormatado, 1))) {
			Set objVARCadRelColuna 	= $Get(^VARCadRelBancoProfisColunas(0, pCodRelatorio, campoFormatado, 1))
			Set listLinha.legGrid		= $$$VARCadRelBancoProfisColunasLegendanoGrid(objVARCadRelColuna)
			Set listLinha.opcao	 		= +$$$VARCadRelBancoProfisColunasOpcao(objVARCadRelColuna)
			Set listLinha.sequencia	= $$$VARCadRelBancoProfisColunasSequencia(objVARCadRelColuna)
			Set listLinha.grpColunaCod 	= $$$VARCadRelBancoProfisColunasGrupoColunas(objVARCadRelColuna)
		}
		Do arrayRetorno.%Push(listLinha) 
	}
	
	Quit]]></Implementation>
</Method>

<Method name="SetColunas">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	
	Set pCampo				= $Get(%request.Data("pCampo",1))	
	Set pCouluna			= $Get(%request.Data("pCouluna",1))	
	Set pConteudo			= $Get(%request.Data("pConteudo",1))	

	Set objeto = $Get(^VARCadRelBancoProfisColunas(YM, pCodRelatorio, pCampo, 1))
	
	Set:pCouluna="opcao" $$$VARCadRelBancoProfisColunasOpcao(objeto) = pConteudo
	Set:pCouluna="sequencia" $$$VARCadRelBancoProfisColunasSequencia(objeto) = pConteudo
	Set:pCouluna="grupoSeq" $$$VARCadRelBancoProfisColunasGrupo(objeto) = pConteudo
	Set:pCouluna="legGrid" $$$VARCadRelBancoProfisColunasLegendanoGrid(objeto) = pConteudo
	Set:pCouluna="tipoDados" $$$VARCadRelBancoProfisColunasTipodeDados(objeto) = pConteudo
	Set:pCouluna="grpColunaCod" $$$VARCadRelBancoProfisColunasGrupoColunas(objeto) = pConteudo

	Set strStatus = $$$Save("VARCadRelBancoProfisColunas", pCodRelatorio_$$$COMMA_pCampo, objeto, $$$YES)]]></Implementation>
</Method>

<Method name="SetGrpColunas">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	
	Set pTipo					= $Get(%request.Data("pTipo",1))	
	Set pCampo				= $Get(%request.Data("pCampo",1))	
	Set pValue				= $Get(%request.Data("pValue",1))	

	If (pValue = 1 || (pValue = "true")) Set pValue = 1
	Else  Set pValue = 0
	
	Set ^VARCadRelBancoProfisGrpColunas(0, pCodRelatorio, pTipo, $Piece(pCampo,"||",3) , 1) = pValue]]></Implementation>
</Method>

<Method name="LimparColunas">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	

	Kill ^VARCadRelBancoProfisColunas(YM, pCodRelatorio)
	Do RebuildIndexes^COMUtils("VARCadRelBancoProfisColunas")
	
	Return $$$OK]]></Implementation>
</Method>

<Method name="GetColunasSelecionadas">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	
	
	Set arrayRetorno = []
	
	Set meuSQL = "Select $$GrupoRelatorio^VARSQL(Coluna) As grupoCampo, * From SQLUser.VARCadRelBancoProfisColunas "
	Set meuSQL = meuSQL _ "Where Company = 0 And Nvl(Opcao,0) <> 0 And Relatorio = '"_pCodRelatorio_"' "
	Set meuSQL = meuSQL _ "Order By $$GrupoRelatorio^VARSQL(Coluna) "
	Set rSet = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
 	While (rSet.%Next()) {
		Set coluna		= rSet.%Get("Coluna")
		Set campo		= $Piece(coluna,"||",$Length(coluna,"||"))
		Set classe	= $Piece(coluna,"||",$Length(coluna,"||")-1)
		
		Set indexClass = $Order(^WWW003s(YM, 3, $ZConvert(classe,"U"), $ZConvert(campo,"U"), classe, ""))
		if (indexClass = "") {
			Set indexClass = $Order(^WWW003Calcs(YM, 1, $ZConvert(campo,"U"), classe, ""))
			If (indexClass = "") Continue
			Set objWWW003Calc = $Get(^WWW003Calc(0,"GCONPaciente",indexClass,1))
			Set descricao 		= $$$WWW003CalcCaption(objWWW003Calc)
		}Else{
			Set objWWW003		= $Get(^WWW003(0, classe, indexClass, 1))
			Set descricao 	= $$$WWW003CaptionInForms(objWWW003)
		}
		
		Set temp(coluna) = ""
		
		
		Set listDados 					= {}
		Set listDados.codigo 		= coluna
		Set listDados.grupo 		= rSet.%Get("grupoCampo")
		Set listDados.descricao = descricao
		
		Do arrayRetorno.%Push(listDados)
 	}
	
	
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="ListDashboard">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	

	Set arrayRetorno = []

	Set nSeq = ""
	For {
		Set nSeq = $Order(^VARCadRelBancoProfisGraficos(YM, pCodRelatorio, nSeq))
		Quit:nSeq=""
		
		Set objVARCadRelBancoProfisGraficos = $Get(^VARCadRelBancoProfisGraficos(YM, pCodRelatorio, nSeq, 1))	
	
		Set nome 						= $$$VARCadRelBancoProfisGraficosNome(objVARCadRelBancoProfisGraficos)
		Set tpGrafico 			= $$$VARCadRelBancoProfisGraficosTipodoGrafico(objVARCadRelBancoProfisGraficos)
		Set tpDados 				= $$$VARCadRelBancoProfisGraficosGrafico(objVARCadRelBancoProfisGraficos)
		Set colunaSerie 		= $$$VARCadRelBancoProfisGraficosColunaSerie(objVARCadRelBancoProfisGraficos)
		Set colunaCategoria = $$$VARCadRelBancoProfisGraficosColunaCategoria(objVARCadRelBancoProfisGraficos)

		Set serie = $$GrupoRelatorio^VARSQL(colunaSerie, 1)
		Set xClaSerie = $Piece(colunaSerie,"||",$Length(colunaSerie,"||")-1)
		Set xColSerie = $Piece(colunaSerie,"||",$Length(colunaSerie,"||"))
		Set indexClass = $Order(^WWW003s(YM, 3, $ZConvert(xClaSerie,"U"), $ZConvert(xColSerie,"U"), xClaSerie, ""))
		if (indexClass = "") {
			Set indexClass = $Order(^WWW003Calcs(YM, 1, $ZConvert(xColSerie,"U"), xClaSerie, ""))
			If (indexClass = "") Continue
			Set objWWW003Calc = $Get(^WWW003Calc(0,xClaSerie,indexClass,1))
			Set serie = serie _" - "_$$$WWW003CalcCaption(objWWW003Calc)
		}Else{
			Set objWWW003 = $Get(^WWW003(YM, xClaSerie, indexClass, 1))
			Set serie = serie _" - "_$$$WWW003CaptionInForms(objWWW003)
		}
	
		Set categoria = ""
		If (colunaCategoria '= "") {
			Set categoria = $$GrupoRelatorio^VARSQL(colunaCategoria, 1)
			Set xClaCateg = $Piece(colunaCategoria,"||",$Length(colunaCategoria,"||")-1)
			Set xColCateg = $Piece(colunaCategoria,"||",$Length(colunaCategoria,"||"))
			Set indexClass = $Order(^WWW003s(YM, 3, $ZConvert(xClaCateg,"U"), $ZConvert(xColCateg,"U"), xClaCateg, ""))
			if (indexClass = "") {
				Set indexClass = $Order(^WWW003Calcs(YM, 1, $ZConvert(xColCateg,"U"), xClaCateg, ""))
				If (indexClass = "") Continue
				Set objWWW003Calc = $Get(^WWW003Calc(0,xClaCateg,indexClass,1))
				Set categoria = categoria _" - "_$$$WWW003CalcCaption(objWWW003Calc)
			}Else{
				Set objWWW003 = $Get(^WWW003(YM, xClaCateg, indexClass, 1))
				Set categoria = categoria _" - "_$$$WWW003CaptionInForms(objWWW003)
			}
		}

		Set list = {}
		Set list.nSeq = nSeq
		Set list.nome = nome
		Set list.tipoGrafico = $Select(
														tpGrafico=1:"Barra",
														tpGrafico=2:"Coluna",
														tpGrafico=3:"Coluna e Linha",
														tpGrafico=4:"Linha",
														tpGrafico=5:"Pizza",
														1:""
													)
		Set list.serie	= serie
		Set list.categoria = categoria
		
		Do arrayRetorno.%Push(list)
	}
	Do arrayRetorno.%ToJSON() 
	Return $$$OK]]></Implementation>
</Method>

<Method name="IsertDashboard">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	
	Set pObjDados			= $Get(%request.Data("pObjDados",1))	

	Set objDados = [].%FromJSON(pObjDados)

	Set nSeq					= $Order(^VARCadRelBancoProfisGraficos(YM, pCodRelatorio, ""),-1) + 1
	
	Set objeto = ""
	Set $$$VARCadRelBancoProfisGraficosNome(objeto) = objDados.nome
	Set $$$VARCadRelBancoProfisGraficosTipodoGrafico(objeto) = objDados.tipoGrafico
	Set $$$VARCadRelBancoProfisGraficosColunaSerie(objeto) = objDados.serie
	Set $$$VARCadRelBancoProfisGraficosColunaCategoria(objeto) = objDados.categoria
	
	Write $$$Save("VARCadRelBancoProfisGraficos", pCodRelatorio_$$$COMMA_nSeq, objeto, $$$YES)
	
	Return $$$OK]]></Implementation>
</Method>

<Method name="DeleteDashboard">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"
		
	Set YBED 					= $Get(%request.Data("YBED",1))	
	Set pCodRelatorio = $Get(%request.Data("pCodRelatorio",1))	
	Set pNSeq					= $Get(%request.Data("pNSeq",1))	
	
	Return $$$Kill("VARCadRelBancoProfisGraficos", pCodRelatorio_$$$COMMA_pNSeq)]]></Implementation>
</Method>
</Class>
</Export>