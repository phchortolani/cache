<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="Cache" ts="2001-01-01 00:00:00">
<Class name="VAR.CSP.VARContrAtendMielograma">
<ClassType/>
<IncludeCode>MEDConst,VARConst</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	do ^WWWVAR
	;	
	set method = $get(%request.Data("method",1))
	xecute "do .."_method_"()"
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetProntuario">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set listRetorno = {}
	
	set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
	set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	if (objProntuario '= "") {
		set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)
		set criadoEm				= $$$VARProntuarioEletronicoCriadoEm(objProntuario)
		set numAdmissao			= $$$VARProntuarioEletronicoNumeroAdmisao(objProntuario)
		;
		set objMEDAdmission	= $get(^MEDAdmission(YM, numAdmissao, 1))
		;
		If ($$$MEDAdmissionPatient(objMEDAdmission) '= codPaciente) {
			set codPaciente		= $$$MEDAdmissionPatient(objMEDAdmission)
		}
		;
		Set numProntuario 	= $$SQLGetPatientProntuario^VARSQL(codPaciente)
		;
		Set objMEDPatient = $Get(^MEDPatient(0, codPaciente, 1))
		;
		set nomePaciente		= $$SQLGetPatientName^VARSQL(codPaciente)
		set dataNascimento	= $$SQLGetPatientDataNascimento^VARSQL(codPaciente)
		set qtdeAnos				= $$SQLGetPatientAge^VARSQL(dataNascimento)
		set qtdeMeses				= $$SQLGetPatientMonth^VARSQL(dataNascimento)
		set sexo						= $$SQLGetSexoPaciente^VARSQL(codPaciente)
		;
		set objMEDAdmission	= $get(^MEDAdmission(YM, numAdmissao, 1))
		set codSala					= $$$MEDAdmissionRoom(objMEDAdmission)			
		set codLeito				= $$$MEDAdmissionBed(objMEDAdmission)
		;
		set (descSala, dataSourceLeito) = ""
		If (codSala '= "") {
			set objSala					= $get(^VARSalasAtendimentos(YM,codSala,1))
			set descSala 				= $$$VARSalasAtendimentosNome(objSala)
			;
			set dataSourceLeito = ##Class(VAR.CSP.VARContrAtendQuimioterapico).GetLeitos(codSala, codLeito)
		}
		;
		set objPEPMielograma = $get(^VARPEPMielograma(YM, pCodProntuario, 1))
		;
		set dataHoraAssinatura 	= $$$VARPEPMielogramaDataHoraAssinatura(objPEPMielograma)
		set assinatura					= $$$VARPEPMielogramaUsuarioAssinatura(objPEPMielograma)
		;
		set listRetorno.dataHora 									= $zdatetime(criadoEm,4,2)
		set listRetorno.codPaciente 							= numProntuario
		set listRetorno.paciente 									= nomePaciente
		set listRetorno.dataNascimento	 					= $zdate(dataNascimento,4,,4)
		set listRetorno.idade											= qtdeAnos
		set listRetorno.sexo											= sexo
		set listRetorno.codSala										= descSala
		set listRetorno.dSLeito										= dataSourceLeito
		set listRetorno.codLeito									= codLeito
		;
		set listRetorno.dataHoraAssinatura	= $Select(dataHoraAssinatura="":"",1:$ZdateTime(dataHoraAssinatura,4,2))
		set listRetorno.assinatura					= $Select(assinatura="":"",1:$$SQLGetUserName^VARSQL(assinatura))
		;
		do listRetorno.%Set("solExameMielograma", $$$VARPEPMielogramaSolExameMielograma(objPEPMielograma), "number")
		do listRetorno.%Set("solExameImunofenotipagem", $$$VARPEPMielogramaSolExameImunofenotipagem(objPEPMielograma), "number")
		do listRetorno.%Set("solExameCariotipoFish", $$$VARPEPMielogramaSolExameCariotipoFish(objPEPMielograma), "number")
		do listRetorno.%Set("solExameBiopsiaMO", $$$VARPEPMielogramaSolExameBiopsiaMO(objPEPMielograma), "number")
		set listRetorno.medicoExterno							= $$$VARPEPMielogramaMedicoExterno(objPEPMielograma)
		set listRetorno.medico										= $$$VARPEPMielogramaMedico(objPEPMielograma)
		do listRetorno.%Set("materialMO", $$$VARPEPMielogramaMateiralMO(objPEPMielograma), "number")
		do listRetorno.%Set("materialSP", $$$VARPEPMielogramaMaterialSP(objPEPMielograma), "number")
		do listRetorno.%Set("materialLCR", $$$VARPEPMielogramaMaterialLCR(objPEPMielograma), "number")
		set listRetorno.materialOutros						= $$$VARPEPMielogramaMaterialOutros(objPEPMielograma)
		set listRetorno.outrasInformacoes					= $$$VARPEPMielogramaOutrasInformacoesPertinen(objPEPMielograma)
		set listRetorno.hipoteseDiagnostica				= $$$VARPEPMielogramaHipoteseDiagnostica(objPEPMielograma)
		set listRetorno.controle									= $$$VARPEPMielogramaControle(objPEPMielograma)
		set listRetorno.crista										= $$$VARPEPMielogramaCristaIliacaPosterior(objPEPMielograma)
		do listRetorno.%Set("puncao", $$$VARPEPMielogramaPuncao(objPEPMielograma), "number")
		set listRetorno.puncaoOutro								= $$$VARPEPMielogramaPuncaoOutroLocal(objPEPMielograma)
		set listRetorno.resistencia								= $$$VARPEPMielogramaResistenciaOssea(objPEPMielograma)
		set listRetorno.historia									= $$$VARPEPMielogramaHistoriaClinica(objPEPMielograma)
		set listRetorno.tempoDiagnostico					= $$$VARPEPMielogramaTempodeDiagnosticodaDoenc(objPEPMielograma)
		set listRetorno.radioterapia							= $$$VARPEPMielogramaRadioterapia(objPEPMielograma)
		set listRetorno.quimioterapia							= $$$VARPEPMielogramaQuimioterapia(objPEPMielograma)
		set listRetorno.quimioterapiaQual					= $$$VARPEPMielogramaQuimioterapiaQual(objPEPMielograma)
		set listRetorno.submetido									= $$$VARPEPMielogramaSubCelTronco(objPEPMielograma)
		set listRetorno.submetidoQual							= $$$VARPEPMielogramaSubCelTroncoQual(objPEPMielograma)
		set listRetorno.autologo									= $$$VARPEPMielogramaAutologo(objPEPMielograma)
		set listRetorno.algRel										= $$$VARPEPMielogramaAlogRel(objPEPMielograma)
		set listRetorno.algNaoRel									= $$$VARPEPMielogramaAlogNaoRel(objPEPMielograma)
		set listRetorno.algNaoRelCordao						= $$$VARPEPMielogramaAlogNaoRelCordaoUmbilical(objPEPMielograma)
		set listRetorno.sexoDoador								= $$$VARPEPMielogramaSexoDoador(objPEPMielograma)
		set listRetorno.hemogramaHb								= $$$VARPEPMielogramaHemogramaHb(objPEPMielograma)
		set listRetorno.hemogramaHT								= $$$VARPEPMielogramaHemogramaHT(objPEPMielograma)
		set listRetorno.hemogramaVCM							= $$$VARPEPMielogramaHemogramaVCM(objPEPMielograma)
		set listRetorno.hemogramaGB								= $$$VARPEPMielogramaHemogramaGB(objPEPMielograma)
		set listRetorno.hemogramaPLA							= $$$VARPEPMielogramaHemogramaPLA(objPEPMielograma)
		set listRetorno.hemogramaOutros						= $$$VARPEPMielogramaHemogramaOutrosExames(objPEPMielograma)
		If ($$$MEDPatientAlergia(objMEDPatient) '= "") {
			Set listRetorno.alergia			= $$$MEDPatientAlergia(objMEDPatient)
			Set listRetorno.alergiaAQue	= $$$MEDPatientAllergies(objMEDPatient)
		}Else{
			If ($$$MEDPatientAllergies(objMEDPatient) = "") Set listRetorno.alergia = 0
			Else  Set listRetorno.alergia = "1"
			Set listRetorno.alergiaAQue	= $$$MEDPatientAllergies(objMEDPatient)
		}
		;;;
		set reacaoSinSintPulso = $$$VARPEPMielogramaReacaoSinSintPulso(objPEPMielograma)
		set reacaoSinSintPA = $$$VARPEPMielogramaReacaoSinSintPA(objPEPMielograma)
		set reacaoSinSintFebre = $$$VARPEPMielogramaReacaoSinSintFebre(objPEPMielograma)
		set reacaoSinSintCalafrios = $$$VARPEPMielogramaReacaoSinSintCalafrios(objPEPMielograma)
		set reacaoSinSintDispneia = $$$VARPEPMielogramaReacaoSinSintDispneia(objPEPMielograma)
		set reacaoSinSintTremor = $$$VARPEPMielogramaReacaoSinSintTremor(objPEPMielograma)
		set reacaoSinSintVomito = $$$VARPEPMielogramaReacaoSinSintVomito(objPEPMielograma)
		set reacaoSinSintCianose = $$$VARPEPMielogramaReacaoSinSintCianose(objPEPMielograma)
		set reacaoSinSintDorLombar = $$$VARPEPMielogramaReacaoSinSintDorLombar(objPEPMielograma)
		set reacaoSinSintDordeCabeca = $$$VARPEPMielogramaReacaoSinSintDordeCabeca(objPEPMielograma)
		set reacaoSinSintDornoTorax = $$$VARPEPMielogramaReacaoSinSintDornoTorax(objPEPMielograma)
		set reacaoSinSintUrticaria = $$$VARPEPMielogramaReacaoSinSintUrticaria(objPEPMielograma)
		set reacaoSinSintEritema = $$$VARPEPMielogramaReacaoSinSintEritema(objPEPMielograma)
		set reacaoSinSintPrurido = $$$VARPEPMielogramaReacaoSinSintPrurido(objPEPMielograma)
		set reacaoSinSintSangramentos = $$$VARPEPMielogramaReacaoSinSintSangramentos(objPEPMielograma)
		set reacaoSinSintUrinaEscura = $$$VARPEPMielogramaReacaoSinSintUrinaEscura(objPEPMielograma)
		set reacaoSinSintMenosVolUrinario = $$$VARPEPMielogramaReacaoSinSintMenosVolUrinario(objPEPMielograma)
		set reacaoSinSintOutros = $$$VARPEPMielogramaReacaoSinSintOutros(objPEPMielograma)
		set reacaoSinSintOutrosDescricao = $$$VARPEPMielogramaReacaoSinSintOutrosDescricao(objPEPMielograma)
		;
		set sSIncidenteNomomentodaf = $$$VARPEPMielogramaSSIncidenteNomomentodaf(objPEPMielograma)
		set sSIncidentePosteriormen = $$$VARPEPMielogramaSSIncidentePosteriormen(objPEPMielograma)
		set sSIncidentePostData = $$$VARPEPMielogramaSSIncidentePostData(objPEPMielograma)
		set sSIncidenteHematoma = $$$VARPEPMielogramaSSIncidenteHematoma(objPEPMielograma)
		set sSIncidenteDorexcepSSiva = $$$VARPEPMielogramaSSIncidenteDorexcessiva(objPEPMielograma)
		set sSIncDorOutLocBra = $$$VARPEPMielogramaSSIncDorOutLocBra(objPEPMielograma)
		set sSIncDorOutLocBraDesc = $$$VARPEPMielogramaSSIncDorOutLocBraDesc(objPEPMielograma)
		set sSIncidenteAdormeciment = $$$VARPEPMielogramaSSIncidenteAdormeciment(objPEPMielograma)
		set sSIncidenteChoques = $$$VARPEPMielogramaSSIncidenteChoques(objPEPMielograma)
		set sSIncidenteHiperemia = $$$VARPEPMielogramaSSIncidenteHiperemia(objPEPMielograma)
		set sSIncidenteHiperemiaDes = $$$VARPEPMielogramaSSIncidenteHiperemiaDes(objPEPMielograma)
		set sSIncidentePopSSivelpunc = $$$VARPEPMielogramaSSIncidentePossivelpunc(objPEPMielograma)
		set sSIncidenteInfiltracao = $$$VARPEPMielogramaSSIncidenteInfiltracao(objPEPMielograma)
		set sSIncidenteQueda = $$$VARPEPMielogramaSSIncidenteQueda(objPEPMielograma)
		set sSIncidenteNenhumalesao = $$$VARPEPMielogramaSSIncidenteNenhumalesao(objPEPMielograma)
		set sSIncPopSSivelLesao = $$$VARPEPMielogramaSSIncPossivelLesao(objPEPMielograma)
		set sSIncPopSSivelLesaoDesc = $$$VARPEPMielogramaSSIncPossivelLesaoDesc(objPEPMielograma)
		set sSConclusao = $$$VARPEPMielogramaSSConclusao(objPEPMielograma)
		set sSIncidenteInfiltracaoD = $$$VARPEPMielogramaSSIncidenteInfiltracaoD(objPEPMielograma)
		set sSIncidenteHematomaDesc = $$$VARPEPMielogramaSSIncidenteHematomaDesc(objPEPMielograma)
		;
		set sSDescricaoIncidente = $$$VARPEPMielogramaSSDescricaodoIncidente(objPEPMielograma)
		set sSConduta	= $$$VARPEPMielogramaSSConduta(objPEPMielograma)
		Do listRetorno.%Set("rTSinSintMaisPulso",reacaoSinSintPulso)
		Do listRetorno.%Set("rTSinSintMaisPA",reacaoSinSintPA)
		Do listRetorno.%Set("rTSinSintFebre",reacaoSinSintFebre, "number")
		Do listRetorno.%Set("rTSinSintCalafrios",reacaoSinSintCalafrios, "number")
		Do listRetorno.%Set("rTSinSintDispneia",reacaoSinSintDispneia, "number")
		Do listRetorno.%Set("rTSinSintTremor",reacaoSinSintTremor, "number")
		Do listRetorno.%Set("rTSinSintVomito",reacaoSinSintVomito, "number")
		Do listRetorno.%Set("rTSinSintCianose",reacaoSinSintCianose, "number")
		Do listRetorno.%Set("rTSinSintDorLombar",reacaoSinSintDorLombar, "number")
		Do listRetorno.%Set("rTSinSintDordeCabeca",reacaoSinSintDordeCabeca, "number")
		Do listRetorno.%Set("rTSinSintDornoTorax",reacaoSinSintDornoTorax, "number")
		Do listRetorno.%Set("rTSinSintUrticaria",reacaoSinSintUrticaria, "number")
		Do listRetorno.%Set("rTSinSintEritema",reacaoSinSintEritema, "number")
		Do listRetorno.%Set("rTSinSintPrurido",reacaoSinSintPrurido, "number")
		Do listRetorno.%Set("rTSinSintSangramentos",reacaoSinSintSangramentos, "number")
		Do listRetorno.%Set("rTSinSintUrinaEscura",reacaoSinSintUrinaEscura, "number")
		Do listRetorno.%Set("rTSinSintMenosVolUrinario",reacaoSinSintMenosVolUrinario, "number")
		Do listRetorno.%Set("rTSinSintOutros",reacaoSinSintOutros, "number")
		set listRetorno.rTSinSintOutrosDescrica = reacaoSinSintOutrosDescricao
		;
		Do listRetorno.%Set("sSIncidenteNomomentodaf",sSIncidenteNomomentodaf, "number")
		Do listRetorno.%Set("sSIncidentePosteriormen",sSIncidentePosteriormen, "number")
		set listRetorno.sSIncidentePostData = $Select(sSIncidentePostData="":"",1:$zdate(sSIncidentePostData,3))
		Do listRetorno.%Set("sSIncidenteHematoma",sSIncidenteHematoma, "number")
		Do listRetorno.%Set("sSIncidenteDorexcepSSiva",sSIncidenteDorexcepSSiva, "number")
		Do listRetorno.%Set("sSIncDorOutLocBra",sSIncDorOutLocBra, "number")
		set listRetorno.sSIncDorOutLocBraDesc = sSIncDorOutLocBraDesc
		Do listRetorno.%Set("sSIncidenteAdormeciment",sSIncidenteAdormeciment, "number")
		Do listRetorno.%Set("sSIncidenteChoques",sSIncidenteChoques, "number")
		Do listRetorno.%Set("sSIncidenteHiperemia",sSIncidenteHiperemia, "number")
		set listRetorno.sSIncidenteHiperemiaDes = sSIncidenteHiperemiaDes
		Do listRetorno.%Set("sSIncidentePopSSivelpunc",sSIncidentePopSSivelpunc, "number")
		Do listRetorno.%Set("sSIncidenteInfiltracao",sSIncidenteInfiltracao, "number")
		Do listRetorno.%Set("sSIncidenteQueda",sSIncidenteQueda, "number")
		Do listRetorno.%Set("sSIncidenteNenhumalesao",sSIncidenteNenhumalesao, "number")
		Do listRetorno.%Set("sSIncPopSSivelLesao",sSIncPopSSivelLesao, "number")
		set listRetorno.sSIncPopSSivelLesaoDesc = sSIncPopSSivelLesaoDesc
		set listRetorno.sSConclusao = sSConclusao
		set listRetorno.sSIncidenteInfiltracaoD = sSIncidenteInfiltracaoD
		set listRetorno.sSIncidenteHematomaDesc = sSIncidenteHematomaDesc		
		;;
		set listRetorno.sSDescricaoIncidente = sSDescricaoIncidente
		set listRetorno.sSConduta = sSConduta
		;;;
	}
	
	do listRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmProntuario">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	tstart
	set strStatus	=	""
	set erro			=	0
	try{

		set YBED = $get(%request.Data("YBED",1))
		set pCodProntuario = $get(%request.Data("pCodProntuario",1))
		set pAdmissao = $get(%request.Data("pAdmissao",1))
		;
		set objMEDAdmission	= $get(^MEDAdmission(YM, pAdmissao, 1))
		Set codPaciente = $$$MEDAdmissionPatient(objMEDAdmission)
		if $$$MEDAdmissionDateDischarged(objMEDAdmission) 	'= ""{
			if ($get(%request.Data("pAssinar",1)) '= 1) {
				set erro = 1
				set strStatus = "Passagem já finalizada!"
				quit
			}
		}
		;		
		set pSolExameMielograma = $get(%request.Data("pSolExameMielograma",1))
		set pSolExameImunofenotipagem = $get(%request.Data("pSolExameImunofenotipagem",1))
		set pSolExameCariotipoFish = $get(%request.Data("pSolExameCariotipoFish",1))
		set pSolExameBiopsiaMO = $get(%request.Data("pSolExameBiopsiaMO",1))
		;
		set pMedico = $get(%request.Data("pMedico",1))
		set pMaterialMO = $get(%request.Data("pMaterialMO",1))
		set pMaterialSP = $get(%request.Data("pMaterialSP",1))
		set pMaterialLCR = $get(%request.Data("pMaterialLCR",1))
		set pMaterialOutros = $get(%request.Data("pMaterialOutros",1))
		set pOutrasInformacoes = $get(%request.Data("pOutrasInformacoes",1))
		;
		set pHipoteseDiagnostica = $get(%request.Data("pHipoteseDiagnostica",1))
		set pControle = $get(%request.Data("pControle",1))
		set pCrista = $get(%request.Data("pCrista",1))
		set pPuncao = $get(%request.Data("pPuncao",1))
		set pPuncaoOutro = $get(%request.Data("pPuncaoOutro",1))
		set pResistencia = $get(%request.Data("pResistencia",1))
		set pHistoria = $get(%request.Data("pHistoria",1))
		set pAlergia = $get(%request.Data("pAlergia",1))
		set pSelAlergia	= $get(%request.Data("pSelAlergia",1))
		set pTempoDiagnostico = $get(%request.Data("pTempoDiagnostico",1))
		;
		set pRadioterapia = $get(%request.Data("pRadioterapia",1))
		set pQuimioterapia = $get(%request.Data("pQuimioterapia",1))
		set pQuimioterapiaQual = $get(%request.Data("pQuimioterapiaQual",1))
		;
		set pSubmetido = $get(%request.Data("pSubmetido",1))
		set pSubmetidoQual = $get(%request.Data("pSubmetidoQual",1))
		set pAutologo = $get(%request.Data("pAutologo",1))
		set pAlgRel = $get(%request.Data("pAlgRel",1))
		set pAlgNaoRel = $get(%request.Data("pAlgNaoRel",1))
		set pAlgNaoRelCordao = $get(%request.Data("pAlgNaoRelCordao",1))
		set pSexoDoador = $get(%request.Data("pSexoDoador",1))
		;	
		set pHemogramaHb = $get(%request.Data("pHemogramaHb",1))
		set pHemogramaHT = $get(%request.Data("pHemogramaHT",1))
		set pHemogramaVCM = $get(%request.Data("pHemogramaVCM",1))
		set pHemogramaGB = $get(%request.Data("pHemogramaGB",1))
		set pHemogramaPLA = $get(%request.Data("pHemogramaPLA",1))
		set pHemogramaOutros = $get(%request.Data("pHemogramaOutros",1))
		;		
		if (pSolExameMielograma '= "") set pSolExameMielograma = $select(pSolExameMielograma="true"||(pSolExameMielograma=1):1,1:0)
		if (pSolExameImunofenotipagem '= "") set pSolExameImunofenotipagem = $select(pSolExameImunofenotipagem="true"||(pSolExameImunofenotipagem=1):1,1:0)
		if (pSolExameCariotipoFish '= "") set pSolExameCariotipoFish = $select(pSolExameCariotipoFish="true"||(pSolExameCariotipoFish=1):1,1:0)
		if (pSolExameBiopsiaMO '= "") set pSolExameBiopsiaMO = $select(pSolExameBiopsiaMO="true"||(pSolExameBiopsiaMO=1):1,1:0)
		if (pMaterialMO '= "") set pMaterialMO = $select(pMaterialMO="true"||(pMaterialMO=1):1,1:0)
		if (pMaterialSP '= "") set pMaterialSP = $select(pMaterialSP="true"||(pMaterialSP=1):1,1:0)
		if (pMaterialLCR '= "") set pMaterialLCR = $select(pMaterialLCR="true"||(pMaterialLCR=1):1,1:0)
		if (pPuncao '= "") set pPuncao = $select(pPuncao="true"||(pPuncao=1):1,1:0)
		;
		set pSSIncidenteNomomentodaf = $Get(%request.Data("pSSIncidenteNomomentodaf",1))
		set pSSIncidentePosteriormen = $Get(%request.Data("pSSIncidentePosteriormen",1))
		set pSSIncidentePostData = $Get(%request.Data("pSSIncidentePostData",1))
		set pSSIncidenteHematoma = $Get(%request.Data("pSSIncidenteHematoma",1))
		set pSSIncidenteDorexcepSSiva = $Get(%request.Data("pSSIncidenteDorexcepSSiva",1))
		set pSSIncDorOutLocBra = $Get(%request.Data("pSSIncDorOutLocBra",1))
		set pSSIncDorOutLocBraDesc = $Get(%request.Data("pSSIncDorOutLocBraDesc",1))
		set pSSIncidenteAdormeciment = $Get(%request.Data("pSSIncidenteAdormeciment",1))
		set pSSIncidenteChoques = $Get(%request.Data("pSSIncidenteChoques",1))
		set pSSIncidenteHiperemia = $Get(%request.Data("pSSIncidenteHiperemia",1))
		set pSSIncidenteHiperemiaDes = $Get(%request.Data("pSSIncidenteHiperemiaDes",1))
		set pSSIncidentePopSSivelpunc = $Get(%request.Data("pSSIncidentePopSSivelpunc",1))
		set pSSIncidenteInfiltracao = $Get(%request.Data("pSSIncidenteInfiltracao",1))
		set pSSIncidenteQueda = $Get(%request.Data("pSSIncidenteQueda",1))
		set pSSIncidenteNenhumalesao = $Get(%request.Data("pSSIncidenteNenhumalesao",1))
		set pSSIncPopSSivelLesao = $Get(%request.Data("pSSIncPopSSivelLesao",1))
		set pSSIncPopSSivelLesaoDesc = $Get(%request.Data("pSSIncPopSSivelLesaoDesc",1))
		set pSSDescricaoIncidente = $Get(%request.Data("pSSDescricaoIncidente",1))
		set pSSConduta = $Get(%request.Data("pSSConduta",1))
		set pSSConclusao = $Get(%request.Data("pSSConclusao",1))
		set pSSIncidenteInfiltracaoD = $Get(%request.Data("pSSIncidenteInfiltracaoD",1))
		set pSSIncidenteHematomaDesc = $Get(%request.Data("pSSIncidenteHematomaDesc",1))		
		;
		set pRTSinSintMaisPulso = $Get(%request.Data("pRTSinSintMaisPulso",1))
		set pRTSinSintMenosPulso = $Get(%request.Data("pRTSinSintMenosPulso",1))
		set pRTSinSintMaisPA = $Get(%request.Data("pRTSinSintMaisPA",1))
		set pRTSinSintMenosPA = $Get(%request.Data("pRTSinSintMenosPA",1))
		set pRTSinSintFebre = $Get(%request.Data("pRTSinSintFebre",1))
		set pRTSinSintCalafrios = $Get(%request.Data("pRTSinSintCalafrios",1))
		set pRTSinSintDispneia = $Get(%request.Data("pRTSinSintDispneia",1))
		set pRTSinSintTremor = $Get(%request.Data("pRTSinSintTremor",1))
		set pRTSinSintVomito = $Get(%request.Data("pRTSinSintVomito",1))
		set pRTSinSintCianose = $Get(%request.Data("pRTSinSintCianose",1))
		set pRTSinSintDorLombar = $Get(%request.Data("pRTSinSintDorLombar",1))
		set pRTSinSintDordeCabeca = $Get(%request.Data("pRTSinSintDordeCabeca",1))
		set pRTSinSintDornoTorax = $Get(%request.Data("pRTSinSintDornoTorax",1))
		set pRTSinSintUrticaria = $Get(%request.Data("pRTSinSintUrticaria",1))
		set pRTSinSintEritema = $Get(%request.Data("pRTSinSintEritema",1))
		set pRTSinSintPrurido = $Get(%request.Data("pRTSinSintPrurido",1))
		set pRTSinSintSangramentos = $Get(%request.Data("pRTSinSintSangramentos",1))
		set pRTSinSintUrinaEscura = $Get(%request.Data("pRTSinSintUrinaEscura",1))
		set pRTSinSintMenosVolUrinario = $Get(%request.Data("pRTSinSintMenosVolUrinario",1))
		set pRTSinSintOutros = $Get(%request.Data("pRTSinSintOutros",1))
		set pRTSinSintOutrosDescrica = $Get(%request.Data("pRTSinSintOutrosDescrica",1))
		;;if (pRTSinSintMaisPulso '= "") set pRTSinSintMaisPulso = $select(pRTSinSintMaisPulso="true"||(pRTSinSintMaisPulso=1):1,1:0)
		if (pRTSinSintMenosPulso '= "") set pRTSinSintMenosPulso = $select(pRTSinSintMenosPulso="true"||(pRTSinSintMenosPulso=1):1,1:0)
		;;if (pRTSinSintMaisPA '= "") set pRTSinSintMaisPA = $select(pRTSinSintMaisPA="true"||(pRTSinSintMaisPA=1):1,1:0)
		if (pRTSinSintMenosPA '= "") set pRTSinSintMenosPA = $select(pRTSinSintMenosPA="true"||(pRTSinSintMenosPA=1):1,1:0)
		if (pRTSinSintFebre '= "") set pRTSinSintFebre = $select(pRTSinSintFebre="true"||(pRTSinSintFebre=1):1,1:0)
		if (pRTSinSintCalafrios '= "") set pRTSinSintCalafrios = $select(pRTSinSintCalafrios="true"||(pRTSinSintCalafrios=1):1,1:0)
		if (pRTSinSintDispneia '= "") set pRTSinSintDispneia = $select(pRTSinSintDispneia="true"||(pRTSinSintDispneia=1):1,1:0)
		if (pRTSinSintTremor '= "") set pRTSinSintTremor = $select(pRTSinSintTremor="true"||(pRTSinSintTremor=1):1,1:0)
		if (pRTSinSintVomito '= "") set pRTSinSintVomito = $select(pRTSinSintVomito="true"||(pRTSinSintVomito=1):1,1:0)
		if (pRTSinSintCianose '= "") set pRTSinSintCianose = $select(pRTSinSintCianose="true"||(pRTSinSintCianose=1):1,1:0)
		if (pRTSinSintDorLombar '= "") set pRTSinSintDorLombar = $select(pRTSinSintDorLombar="true"||(pRTSinSintDorLombar=1):1,1:0)
		if (pRTSinSintDordeCabeca '= "") set pRTSinSintDordeCabeca = $select(pRTSinSintDordeCabeca="true"||(pRTSinSintDordeCabeca=1):1,1:0)
		if (pRTSinSintDornoTorax '= "") set pRTSinSintDornoTorax = $select(pRTSinSintDornoTorax="true"||(pRTSinSintDornoTorax=1):1,1:0)
		if (pRTSinSintUrticaria '= "") set pRTSinSintUrticaria = $select(pRTSinSintUrticaria="true"||(pRTSinSintUrticaria=1):1,1:0)
		if (pRTSinSintEritema '= "") set pRTSinSintEritema = $select(pRTSinSintEritema="true"||(pRTSinSintEritema=1):1,1:0)
		if (pRTSinSintPrurido '= "") set pRTSinSintPrurido = $select(pRTSinSintPrurido="true"||(pRTSinSintPrurido=1):1,1:0)
		if (pRTSinSintSangramentos '= "") set pRTSinSintSangramentos = $select(pRTSinSintSangramentos="true"||(pRTSinSintSangramentos=1):1,1:0)
		if (pRTSinSintUrinaEscura '= "") set pRTSinSintUrinaEscura = $select(pRTSinSintUrinaEscura="true"||(pRTSinSintUrinaEscura):1,1:0)
		if (pRTSinSintMenosVolUrinario '= "") set pRTSinSintMenosVolUrinario = $select(pRTSinSintMenosVolUrinario="true"||(pRTSinSintMenosVolUrinario=1):1,1:0)
		if (pRTSinSintOutros '= "") set pRTSinSintOutros = $select(pRTSinSintOutros="true"||(pRTSinSintOutros=1):1,1:0)
		;
		if (pSSIncidentePostData '= "") set pSSIncidentePostData = $zdateh(pSSIncidentePostData,4)
		if (pSSIncidenteNomomentodaf '= "") set pSSIncidenteNomomentodaf = $select(pSSIncidenteNomomentodaf="true"||(pSSIncidenteNomomentodaf=1):1,1:0)
		if (pSSIncidentePosteriormen '= "") set pSSIncidentePosteriormen = $select(pSSIncidentePosteriormen="true"||(pSSIncidentePosteriormen=1):1,1:0)
		if (pSSIncidenteHematoma '= "") set pSSIncidenteHematoma = $select(pSSIncidenteHematoma="true"||(pSSIncidenteHematoma=1):1,1:0)
		if (pSSIncidenteDorexcepSSiva '= "") set pSSIncidenteDorexcepSSiva = $select(pSSIncidenteDorexcepSSiva="true"||(pSSIncidenteDorexcepSSiva=1):1,1:0)
		if (pSSIncDorOutLocBra '= "") set pSSIncDorOutLocBra = $select(pSSIncDorOutLocBra="true"||(pSSIncDorOutLocBra=1):1,1:0)
		if (pSSIncidenteAdormeciment '= "") set pSSIncidenteAdormeciment = $select(pSSIncidenteAdormeciment="true"||(pSSIncidenteAdormeciment=1):1,1:0)
		if (pSSIncidenteChoques '= "") set pSSIncidenteChoques = $select(pSSIncidenteChoques="true"||(pSSIncidenteChoques=1):1,1:0)
		if (pSSIncidenteHiperemia '= "") set pSSIncidenteHiperemia = $select(pSSIncidenteHiperemia="true"||(pSSIncidenteHiperemia=1):1,1:0)
		if (pSSIncidentePopSSivelpunc '= "") set pSSIncidentePopSSivelpunc = $select(pSSIncidentePopSSivelpunc="true"||(pSSIncidentePopSSivelpunc=1):1,1:0)
		if (pSSIncidenteInfiltracao '= "") set pSSIncidenteInfiltracao = $select(pSSIncidenteInfiltracao="true"||(pSSIncidenteInfiltracao=1):1,1:0)
		if (pSSIncidenteQueda '= "") set pSSIncidenteQueda = $select(pSSIncidenteQueda="true"||(pSSIncidenteQueda=1):1,1:0)
		if (pSSIncidenteNenhumalesao '= "") set pSSIncidenteNenhumalesao = $select(pSSIncidenteNenhumalesao="true"||(pSSIncidenteNenhumalesao=1):1,1:0)
		if (pSSIncPopSSivelLesao '= "") set pSSIncPopSSivelLesao = $select(pSSIncPopSSivelLesao="true"||(pSSIncPopSSivelLesao=1):1,1:0)
		;
		set objPEPMielograma = $get(^VARPEPMielograma(YM, pCodProntuario, 1))
		set $$$VARPEPMielogramaSolExameMielograma(objPEPMielograma) 				= pSolExameMielograma
		set $$$VARPEPMielogramaSolExameImunofenotipagem(objPEPMielograma)		= pSolExameImunofenotipagem
		set $$$VARPEPMielogramaSolExameCariotipoFish(objPEPMielograma) 			= pSolExameCariotipoFish
		set $$$VARPEPMielogramaSolExameBiopsiaMO(objPEPMielograma) 					= pSolExameBiopsiaMO
		Set $$$VARPEPMielogramaMedicoExterno(objPEPMielograma) 							= $Get(%request.Data("pMedicoExterno",1))
		set $$$VARPEPMielogramaMedico(objPEPMielograma) 										= pMedico
		set $$$VARPEPMielogramaMateiralMO(objPEPMielograma) 								= pMaterialMO
		set $$$VARPEPMielogramaMaterialSP(objPEPMielograma) 								= pMaterialSP
		set $$$VARPEPMielogramaMaterialLCR(objPEPMielograma) 								= pMaterialLCR
		set $$$VARPEPMielogramaMaterialOutros(objPEPMielograma) 						= pMaterialOutros
		set $$$VARPEPMielogramaOutrasInformacoesPertinen(objPEPMielograma)	= pOutrasInformacoes
		set $$$VARPEPMielogramaHipoteseDiagnostica(objPEPMielograma) 				= pHipoteseDiagnostica
		set $$$VARPEPMielogramaControle(objPEPMielograma)										= pControle
		set $$$VARPEPMielogramaCristaIliacaPosterior(objPEPMielograma) 			= pCrista
		set $$$VARPEPMielogramaPuncao(objPEPMielograma) 										= pPuncao
		set $$$VARPEPMielogramaPuncaoOutroLocal(objPEPMielograma) 					= pPuncaoOutro
		set $$$VARPEPMielogramaResistenciaOssea(objPEPMielograma) 					= pResistencia
		set $$$VARPEPMielogramaHistoriaClinica(objPEPMielograma) 						= pHistoria
		set $$$VARPEPMielogramaTempodeDiagnosticodaDoenc(objPEPMielograma) 	= pTempoDiagnostico
		set $$$VARPEPMielogramaRadioterapia(objPEPMielograma) 							= pRadioterapia
		set $$$VARPEPMielogramaQuimioterapia(objPEPMielograma) 							= pQuimioterapia
		set $$$VARPEPMielogramaQuimioterapiaQual(objPEPMielograma) 					= pQuimioterapiaQual
		set $$$VARPEPMielogramaSubCelTronco(objPEPMielograma) 							= pSubmetido
		set $$$VARPEPMielogramaSubCelTroncoQual(objPEPMielograma) 					= pSubmetidoQual
		set $$$VARPEPMielogramaAutologo(objPEPMielograma) 									= pAutologo	
		set $$$VARPEPMielogramaAlogRel(objPEPMielograma)										= pAlgRel
		set $$$VARPEPMielogramaAlogNaoRel(objPEPMielograma) 								= pAlgNaoRel
		set $$$VARPEPMielogramaAlogNaoRelCordaoUmbilical(objPEPMielograma) 	= pAlgNaoRelCordao
		set $$$VARPEPMielogramaSexoDoador(objPEPMielograma) 								= pSexoDoador
		set $$$VARPEPMielogramaHemogramaHb(objPEPMielograma) 								= pHemogramaHb
		set $$$VARPEPMielogramaHemogramaHT(objPEPMielograma) 								= pHemogramaHT
		set $$$VARPEPMielogramaHemogramaVCM(objPEPMielograma) 							= pHemogramaVCM
		set $$$VARPEPMielogramaHemogramaGB(objPEPMielograma) 								= pHemogramaGB
		set $$$VARPEPMielogramaHemogramaPLA(objPEPMielograma) 							= pHemogramaPLA
		set $$$VARPEPMielogramaHemogramaOutrosExames(objPEPMielograma) 			= pHemogramaOutros
		set $$$VARPEPMielogramaAlergia(objPEPMielograma) 										= pAlergia
		if ($get(%request.Data("pAssinar",1)) = 1) {
			set $$$VARPEPMielogramaDataHoraAssinatura(objPEPMielograma) = $Horolog
			set $$$VARPEPMielogramaUsuarioAssinatura(objPEPMielograma) 	= YBED
		}else{
			If ($$$VARPEPMielogramaUsuarioAssinatura(objPEPMielograma) '= YBED) {
				set $$$VARPEPMielogramaDataHoraAssinatura(objPEPMielograma) = ""
				set $$$VARPEPMielogramaUsuarioAssinatura(objPEPMielograma) 	= ""
			}else{
				set $$$VARPEPMielogramaDataHoraAssinatura(objPEPMielograma) = $Horolog
			}
		}
		;;;;;
		set $$$VARPEPMielogramaReacaoSinSintPulso(objPEPMielograma) = pRTSinSintMaisPulso
		set $$$VARPEPMielogramaReacaoSinSintPA(objPEPMielograma) = $Replace(pRTSinSintMaisPA,"_","")
		set $$$VARPEPMielogramaReacaoSinSintFebre(objPEPMielograma) = pRTSinSintFebre
		set $$$VARPEPMielogramaReacaoSinSintCalafrios(objPEPMielograma) = pRTSinSintCalafrios
		set $$$VARPEPMielogramaReacaoSinSintDispneia(objPEPMielograma) = pRTSinSintDispneia
		set $$$VARPEPMielogramaReacaoSinSintTremor(objPEPMielograma) = pRTSinSintTremor
		set $$$VARPEPMielogramaReacaoSinSintVomito(objPEPMielograma) = pRTSinSintVomito
		set $$$VARPEPMielogramaReacaoSinSintCianose(objPEPMielograma) = pRTSinSintCianose
		set $$$VARPEPMielogramaReacaoSinSintDorLombar(objPEPMielograma) = pRTSinSintDorLombar
		set $$$VARPEPMielogramaReacaoSinSintDordeCabeca(objPEPMielograma) = pRTSinSintDordeCabeca
		set $$$VARPEPMielogramaReacaoSinSintDornoTorax(objPEPMielograma) = pRTSinSintDornoTorax
		set $$$VARPEPMielogramaReacaoSinSintUrticaria(objPEPMielograma) = pRTSinSintUrticaria
		set $$$VARPEPMielogramaReacaoSinSintEritema(objPEPMielograma) = pRTSinSintEritema
		set $$$VARPEPMielogramaReacaoSinSintPrurido(objPEPMielograma) = pRTSinSintPrurido
		set $$$VARPEPMielogramaReacaoSinSintSangramentos(objPEPMielograma) = pRTSinSintSangramentos
		set $$$VARPEPMielogramaReacaoSinSintUrinaEscura(objPEPMielograma) = pRTSinSintUrinaEscura
		set $$$VARPEPMielogramaReacaoSinSintMenosVolUrinario(objPEPMielograma) = pRTSinSintMenosVolUrinario
		set $$$VARPEPMielogramaReacaoSinSintOutros]]><![CDATA[(objPEPMielograma) = pRTSinSintOutros
		set $$$VARPEPMielogramaReacaoSinSintOutrosDescricao(objPEPMielograma) = pRTSinSintOutrosDescrica
		;
		set $$$VARPEPMielogramaSSIncidenteNomomentodaf(objPEPMielograma) = pSSIncidenteNomomentodaf
		set $$$VARPEPMielogramaSSIncidentePosteriormen(objPEPMielograma) = pSSIncidentePosteriormen
		set $$$VARPEPMielogramaSSIncidentePostData(objPEPMielograma) = pSSIncidentePostData
		set $$$VARPEPMielogramaSSIncidenteHematoma(objPEPMielograma) = pSSIncidenteHematoma
		set $$$VARPEPMielogramaSSIncidenteDorexcessiva(objPEPMielograma) = pSSIncidenteDorexcepSSiva
		set $$$VARPEPMielogramaSSIncDorOutLocBra(objPEPMielograma) = pSSIncDorOutLocBra
		set $$$VARPEPMielogramaSSIncDorOutLocBraDesc(objPEPMielograma) = pSSIncDorOutLocBraDesc
		set $$$VARPEPMielogramaSSIncidenteAdormeciment(objPEPMielograma) = pSSIncidenteAdormeciment
		set $$$VARPEPMielogramaSSIncidenteChoques(objPEPMielograma) = pSSIncidenteChoques
		set $$$VARPEPMielogramaSSIncidenteHiperemia(objPEPMielograma) = pSSIncidenteHiperemia
		set $$$VARPEPMielogramaSSIncidenteHiperemiaDes(objPEPMielograma) = pSSIncidenteHiperemiaDes
		set $$$VARPEPMielogramaSSIncidentePossivelpunc(objPEPMielograma) = pSSIncidentePopSSivelpunc
		set $$$VARPEPMielogramaSSIncidenteInfiltracao(objPEPMielograma) = pSSIncidenteInfiltracao
		set $$$VARPEPMielogramaSSIncidenteQueda(objPEPMielograma) = pSSIncidenteQueda
		set $$$VARPEPMielogramaSSIncidenteNenhumalesao(objPEPMielograma) = pSSIncidenteNenhumalesao
		set $$$VARPEPMielogramaSSIncPossivelLesao(objPEPMielograma) = pSSIncPopSSivelLesao
		set $$$VARPEPMielogramaSSIncPossivelLesaoDesc(objPEPMielograma) = pSSIncPopSSivelLesaoDesc
		set $$$VARPEPMielogramaSSConclusao(objPEPMielograma) = pSSConclusao
		set $$$VARPEPMielogramaSSIncidenteInfiltracaoD(objPEPMielograma) = pSSIncidenteInfiltracaoD
		set $$$VARPEPMielogramaSSIncidenteHematomaDesc(objPEPMielograma) = pSSIncidenteHematomaDesc
		;;
		set $$$VARPEPMielogramaSSDescricaodoIncidente(objPEPMielograma) = pSSDescricaoIncidente
		set $$$VARPEPMielogramaSSConduta(objPEPMielograma) = pSSConduta
		;;;;;
		set strStatus	=	$$$Save("VARPEPMielograma", pCodProntuario, objPEPMielograma, $$$YES)
		;
		Set objMEDPatient = $Get(^MEDPatient(0, codPaciente, 1))
		If (pSelAlergia '= $$$MEDPatientAlergia(objMEDPatient) || (pAlergia '= $$$MEDPatientAllergies(objMEDPatient))) {
			set $$$MEDPatientAlergia(objMEDPatient) 	= pSelAlergia
			set $$$MEDPatientAllergies(objMEDPatient) = pAlergia
			set strStatus	=	$$$Save("MEDPatient", codPaciente, objMEDPatient, $$$YES)
		}
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro	=	err
	}
	set retorno = {}
	if 'erro{
		tcommit
		set retorno.status = strStatus
		set retorno.dataHoraAssinatura = $$$VARPEPMielogramaDataHoraAssinatura(objPEPMielograma)
	}else{
		trollback
		set retorno.status = strStatus
		set retorno.dataHoraAssinatura = $$$VARPEPMielogramaDataHoraAssinatura(objPEPMielograma)
	}
	do retorno.%ToJSON()
	quit $$$OK]]></Implementation>
</Method>

<Method name="Imprimir">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM = 0 
	set Y  = "~"
	
	set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
	set pTipo 					= $get(%request.Data("pTipo",1))
	set YBED 						= $get(%request.Data("YBED",1))

	if pTipo="T"{	;Termo de Consentimento
		set link=$$Start^VARJasperRun("VARPEPEnfMielogramaTermo")
	}else{
		set link=$$Start^VARJasperRun("VARPEPEnfMielograma")
	}
	set hoje = $zdate($horolog,4)
	set link=$$addUserParameter^VARJasperRun(link,"pDataImpressao","São Paulo, "_hoje)
	set link=$$addUserParameter^VARJasperRun(link,"pCodProntuario",pCodProntuario)
	set link=$$addParameter^VARJasperRun(link,YBED,1)
	do ViewInForm^VARJasperRun(link,"Impressao",2)
	
	Quit $$$OK]]></Implementation>
</Method>

<Method name="historicoReacao">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	Set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)

	Set arrayRetorno 	= []

	Set meuSQL = "Select Pront.*, Mielo.* From SQLUser.VARProntuarioEletronico As Pront, "
	Set meuSQL = meuSQL _ "SQLUser.VARPEPMielograma As Mielo "
	Set meuSQL = meuSQL _ "Where Pront.Company = 0 And Mielo.Company = 0 "
	Set meuSQL = meuSQL _ "And Pront.Paciente = '"_codPaciente_"' "
	Set meuSQL = meuSQL _ "And Mielo.CodigoProntuarioEletronic = Pront.Codigo "
	Set meuSQL = meuSQL _ "Order By Pront.CriadoEm Desc "
	Set rSet 	 = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
	
	While(rSet.%Next()){
		Set list = {}
		Set list.admissao = rSet.%Get("Codigo")
		Set list.dataHora = $ZDateTime(rSet.%Get("CriadoEm"),4,2)

		Set list.ssPulso = rSet.%Get("ReacaoSinSintPulso")
		Set list.ssPressaoArterial = $Extract(rSet.%Get("ReacaoSinSintPA"),1,3)_"/"_$Extract(rSet.%Get("ReacaoSinSintPA"),4,6)
		Set list.ssFebre = $Select(rSet.%Get("ReacaoSinSintFebre")=1:"Sim",1:"Não")
		Set list.ssVomito = $Select(rSet.%Get("ReacaoSinSintVomito")=1:"Sim",1:"Não")
		Set list.ssDorTorax = $Select(rSet.%Get("ReacaoSinSintDornoTorax")=1:"Sim",1:"Não")
		Set list.ssSangramentos = $Select(rSet.%Get("ReacaoSinSintSangramentos")=1:"Sim",1:"Não")
		Set list.ssCalafrios = $Select(rSet.%Get("ReacaoSinSintCalafrios")=1:"Sim",1:"Não")
		Set list.ssCianose = $Select(rSet.%Get("ReacaoSinSintCianose")=1:"Sim",1:"Não")
		Set list.ssUrticaria = $Select(rSet.%Get("ReacaoSinSintUrticaria")=1:"Sim",1:"Não")
		Set list.ssUrinaEscura = $Select(rSet.%Get("ReacaoSinSintUrinaEscura")=1:"Sim",1:"Não")
		Set list.ssDispneia = $Select(rSet.%Get("ReacaoSinSintDispneia")=1:"Sim",1:"Não")
		Set list.ssDorLombar = $Select(rSet.%Get("ReacaoSinSintDorLombar")=1:"Sim",1:"Não")
		Set list.ssEritema = $Select(rSet.%Get("ReacaoSinSintEritema")=1:"Sim",1:"Não")
		Set list.ssVolUrinario = $Select(rSet.%Get("ReacaoSinSintMenosVolUrinario")=1:"Sim",1:"Não")
		Set list.ssTremor = $Select(rSet.%Get("ReacaoSinSintTremor")=1:"Sim",1:"Não")
		Set list.ssDorCabeca = $Select(rSet.%Get("ReacaoSinSintDordeCabeca")=1:"Sim",1:"Não")
		Set list.ssPrurido = $Select(rSet.%Get("ReacaoSinSintPrurido")=1:"Sim",1:"Não")
		Set list.ssOutros = $Select(rSet.%Get("ReacaoSinSintOutros")=1:"Sim",1:"Não")
		Set list.ssDescricao = rSet.%Get("ReacaoSinSintOutrosDescricao")
		Set list.iQDFlebotomia = $Select(rSet.%Get("SSIncidenteNomomentodaf")=1:"Sim",1:"Não")
		Set list.iQDPosteriormente = $Select(rSet.%Get("SSIncidentePosteriormen")=1:"Sim",1:"Não")
		Set list.iQDData = $Select(rSet.%Get("SSIncidentePostData")="":"",1:$ZDate(rSet.%Get("SSIncidentePostData"),4))
		Set list.iHematoma = $Select(rSet.%Get("SSIncidenteHematoma")=1:"Sim",1:"Não")
		Set list.iHematomaDesc = rSet.%Get("SSIncidenteHematomaDesc")
		Set list.iDorExessiva = $Select(rSet.%Get("SSIncidenteDorexcessiva")=1:"Sim",1:"Não")
		Set list.iDorLocBraco = $Select(rSet.%Get("SSIncDorOutLocBra")=1:"Sim",1:"Não")
		Set list.iDorLocBracoDesc = rSet.%Get("SSIncDorOutLocBraDesc")
		Set list.iAdormecimento = $Select(rSet.%Get("SSIncidenteAdormeciment")=1:"Sim",1:"Não")
		Set list.iChoques = $Select(rSet.%Get("SSIncidenteChoques")=1:"Sim",1:"Não")
		Set list.iHiperemia = $Select(rSet.%Get("SSIncidenteHiperemia")=1:"Sim",1:"Não")
		Set list.iHiperemiaDesc = rSet.%Get("SSIncidenteHiperemiaDes")
		Set list.iPuncaoArterial = $Select(rSet.%Get("SSIncidentePossivelpunc")=1:"Sim",1:"Não")
		Set list.iInfiltracao = $Select(rSet.%Get("SSIncidenteInfiltracao")=1:"Sim",1:"Não")
		Set list.iInfiltracaoDesc = rSet.%Get("SSIncidenteInfiltracaoD")
		Set list.iQueda = $Select(rSet.%Get("SSIncidenteQueda")=1:"Sim",1:"Não")
		Set list.iNenhumaLesao = $Select(rSet.%Get("SSIncidenteNenhumalesao")=1:"Sim",1:"Não")
		Set list.iPossivelLesao = $Select(rSet.%Get("SSIncPossivelLesao")=1:"Sim",1:"Não")
		Set list.iPossivelLesaoDesc = rSet.%Get("SSIncPossivelLesaoDesc")
		Set list.descricaoIncidente = rSet.%Get("SSDescricaodoIncidente")
		Set list.condutaTratamento = rSet.%Get("SSConduta")
		Set list.conclusao = rSet.%Get("SSConclusao")
		;
		Do arrayRetorno.%Push(list)
	}
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="historicoDadosVitais">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	Set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)

	Set arrayRetorno 	= []

	Set sql = "SELECT P.NumeroAdmisao,P.CriadoEm,M.* "
					_ "FROM SQLUser.VARProntuarioEletronico AS P "
					_ "INNER JOIN SQLUser.VARPEPMielograma AS M ON M.CodigoProntuarioEletronic = P.Codigo "
					_ "WHERE M.Company = 0 AND P.Company = 0 AND P.Paciente = '"_codPaciente_"' "
					_ "ORDER BY P.CriadoEm DESC"
	
	Set rSet 	 = ##class(%SQL.Statement).%ExecDirect("",sql)
	
	While(rSet.%Next()){
		Set list = {}
		Set list.admissao = rSet.%Get("NumeroAdmisao")
		Set list.dataHora = $ZDateTime(rSet.%Get("CriadoEm"),4,2)
		
		Set list.medico = rSet.%Get("Medico")

		if list.medico'="" {
			Set objMEDProvider = $get(^MEDProvider(0,list.medico,1))
			Set list.medico = $$$MEDProviderName(objMEDProvider)
		}
		
		Set list.mateiralMO = $S(rSet.%Get("MateiralMO")=1:"Sim",1:"")
		Set list.materialSP = $S(rSet.%Get("MaterialSP")=1:"Sim",1:"")
		Set list.materialLCR = $S(rSet.%Get("MaterialLCR")=1:"Sim",1:"")
		Set list.materialOutros = rSet.%Get("MaterialOutros")
		Set list.OutrasInformacoesPertinen = rSet.%Get("OutrasInformacoesPertinen")
		
		// Tratamento Prévio
		Set list.radioterapia = $S(rSet.%Get("Radioterapia")=1:"Sim",1:"")
		Set list.quimioterapia = rSet.%Get("QuimioterapiaQual")
		
		Set list.hipoteseDiagnostica = rSet.%Get("HipoteseDiagnostica")
		Set list.controle = $S(rSet.%Get("Controle")=1:"Sim",1:"")
		Set list.cristaIliacaPosterior = $CASE(+rSet.%Get("CristaIliacaPosterior"),1:"Direita",2:"Esquerda",:"")
		Set list.puncao = $S(rSet.%Get("Puncao")=1:"Sim",1:"")
		Set list.puncaoOutroLocal = rSet.%Get("PuncaoOutroLocal")
		Set list.resistenciaOssea = $CASE(+rSet.%Get("ResistenciaOssea"),1:"Normal",2:"Aumentada",3:"Diminuída",:"")
		Set list.historiaClinica = rSet.%Get("HistoriaClinica")
		Set list.alergia = rSet.%Get("Alergia")
		Set list.tempodeDiagnosticodaDoenc = rSet.%Get("TempodeDiagnosticodaDoenc")
		
		Set list.SubCelTronco = $S(rSet.%Get("SubCelTronco")=1:"Sim"_$S(rSet.%Get("SubCelTroncoQual")'="":" - "_rSet.%Get("SubCelTroncoQual"),1:""),1:"")
		Set list.autologo = $S(rSet.%Get("Autologo")=1:"Sim",1:"")
		Set list.alogRel = $S(rSet.%Get("AlogRel")=1:"Sim",1:"")
		Set list.alogNaoRel = $S(rSet.%Get("AlogNaoRel")=1:"Sim",1:"")
		Set list.alogNaoRelCordaoUmbilical = $S(rSet.%Get("AlogNaoRelCordaoUmbilical")=1:"Sim",1:"")
		Set list.sexoDoador = $CASE(+rSet.%Get("SexoDoador"),1:"M",2:"F",:"")
		
		// Hemograma 
		Set list.HemogramaHb = rSet.%Get("HemogramaHb")
		Set list.HemogramaHT = rSet.%Get("HemogramaHT")
		Set list.HemogramaVCM = rSet.%Get("HemogramaVCM")
		Set list.HemogramaGB = rSet.%Get("HemogramaGB")
		Set list.HemogramaPLA = rSet.%Get("HemogramaPLA")
		Set list.HemogramaOutrosExames = rSet.%Get("HemogramaOutrosExames")
		
		Do arrayRetorno.%Push(list)
	}
	
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>
</Class>
</Export>