<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="Cache" ts="2001-01-01 00:00:00">
<Class name="VAR.update.ScriptRelease01r06">
<ClassType/>
<Import>VAR.infra.util</Import>
<IncludeCode>VARConst,COMSYS,VARLog,INConst,MEDConst,COMConst,WWWConst</IncludeCode>
<ProcedureBlock>0</ProcedureBlock>
<Super>VAR.update.ScriptRelease</Super>

<Parameter name="PARAMSETPRODUCTION">
<Type>%String</Type>
<Default>PARAM_SET_PRODUCTION</Default>
</Parameter>

<Parameter name="PARAMLIMPASERVICOCMM">
<Type>%String</Type>
<Default>PARAM_LIMPA_SERVICO_CMM</Default>
</Parameter>

<Parameter name="PARAMWWWSTATUS">
<Type>%String</Type>
<Default>PARAM_WWW_STATUS</Default>
</Parameter>

<Parameter name="PARAMMEDFREQUENCY">
<Type>%String</Type>
<Default>PARAM_MED_FREQUENCY</Default>
</Parameter>

<Parameter name="PARAMMODFORNECEDORAVALIACAO">
<Type>%String</Type>
<Default>PARAM_MOD_FORNECEDORAVALIACAO</Default>
</Parameter>

<Parameter name="PARAMADDFORMMEDHOOK">
<Type>%String</Type>
<Default>PARAM_ADD_FORMMED_HOOK</Default>
</Parameter>

<Parameter name="PARAMMEDMETADATAASDE3">
<Type>%String</Type>
<Default>PARAM_MED_METADATA_ASDE3</Default>
</Parameter>

<Parameter name="PARAMMEDMETADATA2ASDE3">
<Type>%String</Type>
<Default>PARAM_MED_METADATA2_ASDE3</Default>
</Parameter>

<Parameter name="PARAMWWW122INDEX">
<Type>%String</Type>
<Default>PARAM_WWW122_INDEX</Default>
</Parameter>

<Parameter name="PARAMWWW120HOOKMETADATAMED">
<Type>%String</Type>
<Default>PARAM_WWW120HOOK_METADATA_MED</Default>
</Parameter>

<Parameter name="PARAMSR18130">
<Type>%String</Type>
<Default>SR18130</Default>
</Parameter>

<Parameter name="PARAMMEDADMISSIONINDEX">
<Type>%String</Type>
<Default>PARAM_MEDADMISSION_INDEX</Default>
</Parameter>

<Parameter name="PARAMMEDSCAN">
<Type>%String</Type>
<Default>PARAM_MED_SCAN</Default>
</Parameter>

<Parameter name="PARAMCORRIGEWWW120SCAN">
<Default>PARAM_CORRIGE_WWW120SCAN</Default>
</Parameter>

<Parameter name="PARAMSR18176">
<Type>%String</Type>
<Default>SR18176</Default>
</Parameter>

<Parameter name="PARAMREINDEXCLASSES">
<Type>%String</Type>
<Default>PARAM_REINDEX_CLASSES</Default>
</Parameter>

<Parameter name="PARAMSR18195">
<Type>%String</Type>
<Default>SR18195</Default>
</Parameter>

<Parameter name="PARAMPRESCFREQPADRAO">
<Type>%String</Type>
<Default>PARAM_PRESC_FREQ_PADRAO</Default>
</Parameter>

<Parameter name="PARAMSR18213">
<Type>%String</Type>
<Default>SR18213</Default>
</Parameter>

<Parameter name="PARAMDEFMESANOFORNFECHAMENTO">
<Type>%String</Type>
<Default>PARAM_DEFINE_MESANOFORNECEDOR_FECHAMENTO</Default>
</Parameter>

<Parameter name="PARAMDEFCENTROCUSTOPADRAO">
<Type>%String</Type>
<Default>PARAM_DEFINE_CENTROCUSTO_PADRAO</Default>
</Parameter>

<Parameter name="PARAMINFUSETIME">
<Type>%String</Type>
<Default>PARAM_INFUSE_TIME</Default>
</Parameter>

<Parameter name="PARAMHEVA700">
<Type>%String</Type>
<Default>HEVA-700</Default>
</Parameter>

<Parameter name="PARAMHEVA673">
<Type>%String</Type>
<Default>HEVA-673</Default>
</Parameter>

<Parameter name="PARAMSERVICOFAVORITOS">
<Type>%String</Type>
<Default>PARAM_SERVICO_FAVORITOS</Default>
</Parameter>

<Parameter name="PARAMINICPERCUSOPART">
<Type>%String</Type>
<Default>PARAM_INIC_PERC_USO_PART</Default>
</Parameter>

<Parameter name="PARAMPAGQTFARMAC">
<Type>%String</Type>
<Default>PARAM_PAG_QT_FARMACIA</Default>
</Parameter>

<Parameter name="PARAMRECOMPSERVICERUNNER">
<Type>%String</Type>
<Default>PARAM_RECOMP_SERVICE_RUNNER</Default>
</Parameter>

<Parameter name="PARAMHEVA751">
<Type>%String</Type>
<Default>HEVA-751</Default>
</Parameter>

<Parameter name="PARAMHEVA782">
<Type>%String</Type>
<Default>HEVA-782</Default>
</Parameter>

<Parameter name="PARAMHEVA751V2">
<Type>%String</Type>
<Default>HEVA-751V2</Default>
</Parameter>

<Parameter name="PARAMUSUARIOVALIDARDISPENSACAO">
<Type>%String</Type>
<Default>PARAM_USUARIO_VALIDAR_DISPENSACAO</Default>
</Parameter>

<Parameter name="PARAMREINDEXPREVISAO">
<Type>%String</Type>
<Default>PARAM_REINDEX_PREVISAO</Default>
</Parameter>

<Parameter name="PARAMHEVA816">
<Type>%String</Type>
<Default>HEVA-816</Default>
</Parameter>

<Parameter name="PARAMLIMPAVARINTERACOESMEDICAMENTOSAS">
<Type>%String</Type>
<Default>PARAM_LIMPA_VARINTERACOESMEDICAMENTOSAS</Default>
</Parameter>

<Parameter name="PARAMHEVATRANSFORISSUECALC">
<Type>%String</Type>
<Default>PARAM_TRANSF_OR_ISSUE_CALC</Default>
</Parameter>

<Parameter name="PARAMHEVA811">
<Type>%String</Type>
<Default>HEVA-811</Default>
</Parameter>

<Parameter name="PARAMHEVA154">
<Type>%String</Type>
<Default>HEVA-154</Default>
</Parameter>

<Parameter name="PARAMHEVA154R2">
<Type>%String</Type>
<Default>HEVA-154.2</Default>
</Parameter>

<Parameter name="PARAMCORE82">
<Type>%String</Type>
<Default>CORE-82</Default>
</Parameter>

<Parameter name="PARAMUNINSTALLDCMSERVICE">
<Type>%String</Type>
<Default>PARAM_UNINSTALL_DCM_SERVICE</Default>
</Parameter>

<Parameter name="PARAMHEVA811V2">
<Type>%String</Type>
<Default>HEVA-811V2</Default>
</Parameter>

<Parameter name="CORE81">
<Type>%String</Type>
<Default>CORE-81</Default>
</Parameter>

<Parameter name="CORE114">
<Type>%String</Type>
<Default>CORE-114</Default>
</Parameter>

<Parameter name="PARAMCORE83">
<Type>%String</Type>
<Default>CORE-83</Default>
</Parameter>

<Parameter name="PARAMCREATESHADOWUSER">
<Type>%String</Type>
<Default>PARAM_CREATE_SHADOW_USER</Default>
</Parameter>

<Parameter name="PARAMRIGHTCLICKMEDDISPENSELINE">
<Type>%String</Type>
<Default>PARAM_RIGHT_CLICK_MEDISPENSELINE</Default>
</Parameter>

<Parameter name="PARAMSAVEHOTKEY">
<Type>%String</Type>
<Default>PARAM_SAVE_HOTKEY</Default>
</Parameter>

<Parameter name="PARAMRECOMPILEAL">
<Type>%String</Type>
<Default>PARAM_RECOMPILE_AL</Default>
</Parameter>

<Method name="UpdateBuild012">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()
	
	if (+..GetParameter(..#PARAMRECOMPILEAL) = 0) {
        $$$VAR
        do CreateAndCompileProject^COMObject("al",1)
        do ..SetParameter(..#PARAMRECOMPILEAL, 1) 
    }

	if (+..GetParameter(..#PARAMSAVEHOTKEY)  = 0) {
		$$$VAR

		set hotKey = "SAVE"
		set objHotKey = $get(^WWWFORMHOTKEY(YM,hotKey,1))
		
		set $$$WWWFORMHOTKEYAlt(objHotKey)	 = ""
		set $$$WWWFORMHOTKEYCtrl(objHotKey)	 = 1
		set $$$WWWFORMHOTKEYShift(objHotKey) = ""
		set $$$WWWFORMHOTKEYKey1(objHotKey)	 = 83
		
		set strStatus = $$$Save("WWWFORMHOTKEY",hotKey,objHotKey,$$$YES)

		if ($$$ISOK(strStatus)) {
			do ..SetParameter(..#PARAMSAVEHOTKEY, 1)
		} else {
			write !, "Erro ao criar a hotkey do botão salvar!", !
		}
	}
	
	do ..IncMajorRelease()
	do ..IncMajorRelease()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild011">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()
    
    if (+..GetParameter(..#PARAMRIGHTCLICKMEDDISPENSELINE)  = 0) {
        set ^CacheTempEvent(##class(Util).GetNamespace(),"MEDDispenseLine","RightClick") = "1"
        do ..SetParameter(..#PARAMRIGHTCLICKMEDDISPENSELINE, 1) 
    }
    
    do ..IncBuild()
    
    quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild010">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()
    
    if (+..GetParameter(..#PARAMUNINSTALLDCMSERVICE)  = 0) {
        do ##class(VAR.infra.dcm.DcmRunner).Unregister()
        do ..SetParameter(..#PARAMUNINSTALLDCMSERVICE, 1) 
    }
    
    if (+..GetParameter(..#PARAMHEVA811V2) = 0) {
        $$$VAR
        ; Clean up from missing COMConst INBrand
        set strStatus=$$Save^COMUtils("COMConst","INBrand","1~0",1)
        do Generate^COMConst("IN")
        do ROUTINE^%R("INBundleUtils",,,"LCS")
        ;do $System.OBJ.Compile("IN.update.ScriptRelease01r70", "cfkvo3byr")
        do ..SetParameter(..#PARAMHEVA811V2, 1) 
    }
    
    if (+..GetParameter(..#CORE81) = 0) {
        ; Clean up some constants that haven't been defined.
        set id="WWWFORMHOTKEY"
        if '$data(^COMConst(YM,id,1)) {
            set obj=""
            set $$$COMConstGenerate(obj)=$$$YES
            set strStatus=$$$Save("COMConst",id,obj,$$$YES)
        }
        set id="WWWDASHBOARD"
        if '$data(^COMConst(YM,id,1)) {
            set obj=""
            set $$$COMConstGenerate(obj)=$$$YES
            set strStatus=$$$Save("COMConst",id,obj,$$$YES)
        }
        set id="WWWWEEK"
        if '$data(^COMConst(YM,id,1)) {
            set obj=""
            set $$$COMConstGenerate(obj)=$$$YES
            set strStatus=$$$Save("COMConst",id,obj,$$$YES)
        }
        do ..SetParameter(..#CORE81, 1) 
    }
    
    if (+..GetParameter(..#CORE114) = 0) {
        ;CORE-114
        set id="WWW122C2"
        if '$data(^COMConst(YM,id,1)) {
            set obj=""
            set $$$COMConstGenerate(obj)=$$$YES
            set strStatus=$$$Save("COMConst",id,obj,$$$YES)
        }
        do ..SetParameter(..#CORE114, 1) 
    }
    
    if (+..GetParameter(..#PARAMCORE83) = 0) {
        $$$VAR
        do CreateAndCompileProject^COMObject("al",1)
        do ..SetParameter(..#PARAMCORE83, 1) 
    }
    
    if (+..GetParameter(..#PARAMCREATESHADOWUSER) = 0) {
        new strStatus
        $$$VAR
        set keyUser = "SHADOW"
        set objUser = "Shadow User~^1585,1972,11008,1936,1873,1972,1945,1990,1891,1612,1945,11035,1891,1450,1432,1441,1459,~1~~0~PT~~~shadow@disclinc.com~~~WWWBLANK~601~62976~59283~Your Visit No.: 601,  Last Visit: 06/03/2013, 13:44:25~~~61625~62976,59259~SOSTHENES~~~~~~~~~~~~~~~~~BR~~~~~~1.1~~~~~~~~~~~~~~~0~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~1.1;0;1;1.2;1.3;1.4;1.5;03501002.1;03501002.2;03501004.1;03501004.1.1;03501004.2;03501004.2.1;03501004.3;03501004.4;03501006;03501006.1;03501007;03501007.1;03501008;03501008.1;03501009.1;03501009.1.1;03501009.2;03501009.2.1;03501010;03501010.1;03501011.1;03501011.1.1;03501011.2;03501011.2.1;03501012;03501012.1;03501013.1;03501013.2;03501013.3;03501013.4;03501013.4.1;03501013.5;03501013.5.1;03501013.6;03501013.6.1;03501013.7;03501013.7.1;03501013.8;03501013.9;03501017.1;03501017.2;03501017.2.1;03501018;03501018.1;03503007;03503009;03503009.1;03503010;03503011;03503011.1;03503012;03503012.1;03503014;03503014.1;03503015~~~~~~~~~~~~~~~~~~~~~~GFIUZAPT~Disclinc~~~~~~~~~~~~~~~~~~~~~~~~~~"
        set strStatus = $$$Save("WWW013",keyUser,objUser,$$$YES)
        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMCORE83, 1)
        } 
        else {
            $$$VARLOGERROR(strStatus)
        }     
    }
    
    do ..IncBuild()
    
    quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild009">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()
    
    do ..IncBuild()
    
    quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild008">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()
    
    if (+..GetParameter(..#PARAMHEVATRANSFORISSUECALC)  = 0) {
        
        do ^WWWVAR
        set objINVORG = $get(^INVORG(YM,YM,1))
        set $$$INVORGTransferorIssueCalc(objINVORG) = 2
        set strStatus = $$Save^COMUtils("INVORG",YM,objINVORG,1)
    
        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMHEVATRANSFORISSUECALC, 1)
        }       
    }
    
    if (+..GetParameter(..#PARAMHEVA811) = 0) {
        ;HEVA-811
        $$$VAR
        do ReIndex^COMIndex("WWW0121",1)
        do ..SetParameter(..#PARAMHEVA811, 1) 
    }
    
    if (+..GetParameter(..#PARAMHEVA154) = 0) {
        set strStatus = ..HEVA154()
        if $$$ISOK(strStatus) do ..SetParameter(..#PARAMHEVA154, 1) 
    }
    
    if (+..GetParameter(..#PARAMHEVA154R2) = 0) {
        set strStatus = ..HEVA154R2()
        if $$$ISOK(strStatus) do ..SetParameter(..#PARAMHEVA154R2, 1) 
    }
    
    if (+..GetParameter(..#PARAMCORE82) = 0) {
        $$$VAR
        do Execute^COMPIT17929(0)
        do ..SetParameter(..#PARAMCORE82, 1) 
    }
    do ..IncBuild()
    
    quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild007">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()
    do ..IncBuild()
    
    quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild006">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()
    do ..IncBuild()
    
    quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild005">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()
    
    if (+..GetParameter(..#PARAMRECOMPSERVICERUNNER)  = 0) {
        
        do $System.OBJ.Compile("VAR.infra.services.ServiceRunner","cuko3b-u")
        
        do ..SetParameter(..#PARAMRECOMPSERVICERUNNER, 1)
    }
    
    if (+..GetParameter(..#PARAMHEVA751) = 0) {
        do ^WWWVAR
        set strStatus = $$$OK
        set keyMeta = "MEDPrescriptionSolLine,12"
        set objMeta = "OnAfterRowChange^MEDPrescriptionHospLine(YFORM,YROW)~.."
        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWW120Hook",keyMeta,objMeta,1)
        }

        if $$$ISOK(strStatus) do ..SetParameter(..#PARAMHEVA751, 1)
    }
    
    if (+..GetParameter(..#PARAMHEVA782)  = 0) {
        
        set strStatus = $$CargaVARParametroAtivar^VARParametroAtivarTabela()
        
        if $$$ISOK(strStatus) do ..SetParameter(..#PARAMHEVA782, 1)
    }
    
    if (+..GetParameter(..#PARAMHEVA751V2) = 0) {
        do ^WWWVAR
        set strStatus = $$$OK
        set keyMeta = "MEDPrescriptionSolLine,12"
        set objMeta = "OnAfterRowChange^MEDPrescriptionSolLine(YFORM,YROW)~.."
        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWW120Hook",keyMeta,objMeta,1)
        }

        if $$$ISOK(strStatus) do ..SetParameter(..#PARAMHEVA751V2, 1)
    }
    
    if (+..GetParameter(..#PARAMREINDEXPREVISAO) = 0) {
        do ^WWWVAR
        do ReIndex^COMIndex("INREC")
        do ReIndex^COMIndex("INRECLine")
        do ReIndex^COMIndex("VARCompraEntrega")
        do ReIndex^COMIndex("VARCompraEntregaLinha")
        do ReIndex^COMIndex("VARCompraAgendamento")
        do ReIndex^COMIndex("INAUF")
        do ReIndex^COMIndex("INAUP")
        set strStatus = $$$OK
        if $$$ISOK(strStatus) do ..SetParameter(..#PARAMREINDEXPREVISAO, 1)
    }

    if (+..GetParameter(..#PARAMUSUARIOVALIDARDISPENSACAO) = 0) {
        
        $$$VAR

        set user        = "INTEGRA"
        set objWWW013   = ""
        set strStatus   = $$$OK
        
        set $$$WWW013Name(objWWW013)        = "Integração InfoSaúde"
        set $$$WWW013UserAccess(objWWW013)  = "1"
        
        set strStatus = $$$Save("WWW013",user,objWWW013,$$$YES)
        
        if ($$$ISOK(strStatus)){
            set idDispense = ""
            
            for{
                set idDispense = $order(^MEDDispense(YM,idDispense))
                quit:((idDispense="")||($$$ISERR(strStatus)))
                
                set idDispenseLine = ""
                
                for{
                    set idDispenseLine = $order(^MEDDispenseLine(YM,idDispense,idDispenseLine))
                    quit:idDispenseLine=""
                    
                    set objDispenseLine = $get(^MEDDispenseLine(YM,idDispense,idDispenseLine,1))
                    
                    set validatedBy = $$$MEDDispenseLineValidatedBy(objDispenseLine)
                    
                    if (validatedBy = "WEBSERVICE"){
                        set $$$MEDDispenseLineValidatedBy(objDispenseLine) = user
                        
                        set strStatus = $$$Save("MEDDispenseLine",idDispense_$$$COMMA_idDispenseLine,objDispenseLine,$$$YES)
                        
                        quit:$$$ISERR(strStatus)
                    }
                }
            }
        }
        
        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMUSUARIOVALIDARDISPENSACAO, 1)
        } else {
            write !, "Erro ao criar o usuário INTEGRA e atualizar as linhas das dispensações."
        }
    }
    
    if (+..GetParameter(..#PARAMHEVA816) = 0) {
        set strStatus = ##class(IN.update.ScriptRelease01r70).UpdateEINHEITWWW101()
        if $$$ISOK(strStatus) do ..SetParameter(..#PARAMHEVA816, 1)
    }
    
    if ('+..GetParameter(..#PARAMLIMPAVARINTERACOESMEDICAMENTOSAS)) {
        
        $$$VAR
        
        if (##class(%Dictionary.ClassDefinition).%ExistsId("User.VARInteracoesMedicamentosas")) {
            do ##class(%Dictionary.ClassDefinition).%DeleteId("User.VARInteracoesMedicamentosas")
            set VORG(1) = "VARInteracoesMedicamentosas"
            set VORG(2) = 1
            set VORG(3) = 0
            do ^WWWDLOE
        }
        
        if (##class(%Library.Routine).Exists("VARInteracoesMedicamentosas")) {
            do ##class(%Library.Routine).Delete("VARInteracoesMedicamentosas")
        }
        
        set VORGX = "VARInteracoesMedicamentosas"
        do DEL1^WWWFLOE
        
        do ..SetParameter(..#PARAMLIMPAVARINTERACOESMEDICAMENTOSAS, 1)
    }
    
    do ..IncBuild()

    quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild004">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()
    
    if (+..GetParameter(..#PARAMMEDMETADATA2ASDE3) '= 2) {
        $$$VAR
        set strStatus = $$$OK

        set keyMeta = "MEDPrescription"_$$$COMMA_"10"
        set objMeta = "WWW00180~MEDRxStatus-10.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }
        
        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMMEDMETADATA2ASDE3, 2)
        }
        else {
            write !, "Error on update metadata"
        }
    }

    do ..IncBuild()

    quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild003">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()

    if (+..GetParameter(..#PARAMDEFCENTROCUSTOPADRAO) = 0) {
        $$$VAR

        set objVARParametroCliente = ^VARParametroCliente(YM,YM,1)
        
        if ( ($znspace = "AME") || ($znspace = "TREINA-AME") ){
            set $$$VARParametroClienteCentroCustoPadraoInventario(objVARParametroCliente) = "24700001"
            set $$$VARParametroClienteCentroCustoPadraoDevolucao(objVARParametroCliente) = "24706015"
            set strStatus = $$$Save("VARParametroCliente",YM,objVARParametroCliente,$$$YES)
        } else {
            set $$$VARParametroClienteCentroCustoPadraoInventario(objVARParametroCliente) = "03500001"
            set $$$VARParametroClienteCentroCustoPadraoDevolucao(objVARParametroCliente) = "03501011"
            set strStatus = $$$Save("VARParametroCliente",YM,objVARParametroCliente,$$$YES)
        }
        if ($$$ISOK(strStatus)) { 
            $$$VARLOGINFO("Definidos os centros de custo do fechamento com sucesso!")
        }
        else {
            $$$VARLOGERROR("Erro ao gravar os centros de custo do fechamento!")
        }

        do ..SetParameter(..#PARAMDEFCENTROCUSTOPADRAO, 1)
    }
    
    if (+..GetParameter(..#PARAMDEFMESANOFORNFECHAMENTO) = 0) {
        $$$VAR

        set objVARParametroCliente = ^VARParametroCliente(YM,YM,1)
        
        if ( ($znspace = "AME") || ($znspace = "TREINA-AME") ){
            set $$$VARParametroClienteFornecPadraoRecebDevoluca(objVARParametroCliente) = "AME"
            set $$$VARParametroClienteMesSaldoInicialReceb(objVARParametroCliente) = "11"
            set $$$VARParametroClienteAnoSaldoInicialReceb(objVARParametroCliente) = "2012"
            set strStatus = $$$Save("VARParametroCliente",YM,objVARParametroCliente,$$$YES)
        } else {
            set $$$VARParametroClienteFornecPadraoRecebDevoluca(objVARParametroCliente) = "HEVA"
            set $$$VARParametroClienteMesSaldoInicialReceb(objVARParametroCliente) = "7"
            set $$$VARParametroClienteAnoSaldoInicialReceb(objVARParametroCliente) = "2012"
            set strStatus = $$$Save("VARParametroCliente",YM,objVARParametroCliente,$$$YES)
        }
        if ($$$ISOK(strStatus)) { 
            $$$VARLOGINFO("Definidas as variáveis do fechamento com sucesso!")
        }
        else {
            $$$VARLOGERROR("Erro ao gravar as variáveis do fechamento!")
        }

        do ..SetParameter(..#PARAMDEFMESANOFORNFECHAMENTO, 1)
    }

    if (+..GetParameter(..#PARAMINFUSETIME) = 0) {
        $$$VAR

        set objMEDInfuseTime = ""
        set $$$MEDInfuseTimeUnitspermL(objMEDInfuseTime) = 1
        set $$$MEDInfuseTimeUnitsperHour(objMEDInfuseTime) = 1
        set strStatus = $$$Save("MEDInfuseTime", "L", objMEDInfuseTime, $$$YES)

        set objMEDInfuseTime = ""
        set $$$MEDInfuseTimeUnitspermL(objMEDInfuseTime) = 60
        set $$$MEDInfuseTimeUnitsperHour(objMEDInfuseTime) = 60
        set strStatus = $$$Save("MEDInfuseTime", "M", objMEDInfuseTime, $$$YES)

        set objMEDInfuseTime = ""
        set $$$MEDInfuseTimeUnitspermL(objMEDInfuseTime) = 20
        set $$$MEDInfuseTimeUnitsperHour(objMEDInfuseTime) = 60
        set strStatus = $$$Save("MEDInfuseTime", "G", objMEDInfuseTime, $$$YES)

        if ($$$ISOK(strStatus)) {
            do ..SetParameter(..#PARAMINFUSETIME, 1)
        }
    }
    
    if (+..GetParameter(..#PARAMHEVA673) = 0) {
        $$$VAR

        set IdWWW003Calc = "MEDPrescription"_$$$COMMA_50
        set objWWW003Calc = $get(^WWW003Calc(0,"MEDPrescription",50,1))
        set $$$WWW003CalcRelationClass(objWWW003Calc) = "WWW0121"
        set strStatus = $$$Save("WWW003Calc",IdWWW003Calc,objWWW003Calc, $$$YES)

        if ($$$ISOK(strStatus)) {
            do ..SetParameter(..#PARAMHEVA673, 1)
        }
    }

    set ^CacheTempEvent(##class(Util).GetNamespace(), "INReqLine", "DeleteAll") = 0
    
    if (+..GetParameter(..#PARAMHEVA700) = 0) {
        if ..HEVA700() do ..SetParameter(..#PARAMHEVA700, 1)
    }
    
    if (+..GetParameter(..#PARAMSERVICOFAVORITOS) = 0) {
        $$$VAR
        set objCliente  = $get(^VARParametroCliente(0,0,1))
        set $$$VARParametroClienteLimparDadosColUser(objCliente) = 1
        set strStatus   = $$$Save("VARParametroCliente",0,objCliente,$$$YES)
        if ($$$ISOK(strStatus)) {
            do ..SetParameter(..#PARAMSERVICOFAVORITOS, 1)
        }
    }

    if (+..GetParameter(..#PARAMINICPERCUSOPART) = 0) {
        $$$VAR

        set objVARParametroCliente = $get(^VARParametroCliente(YM, YM, 1))
        set $$$VARParametroClientePercMaxAceitUsoParticao(objVARParametroCliente) = 90
        set strStatus = $$$Save("VARParametroCliente", YM, objVARParametroCliente, 1)

        do ..SetParameter(..#PARAMINICPERCUSOPART, 1)

        write !!, "Valor inicial máximo de percentual de uso de disco salvo "_
            "no sistema."
    }

    
    if (+..GetParameter(..#PARAMPAGQTFARMAC) = 0) {
        $$$VAR
        set objCliente  = $get(^VARParametroCliente(0,0,1))
        set $$$VARParametroClienteQuantidadedelinhasnapagin(objCliente) = 50
        set strStatus   = $$$Save("VARParametroCliente",0,objCliente,$$$YES)
        if ($$$ISOK(strStatus)) {
            do ..SetParameter(..#PARAMPAGQTFARMAC, 1)
        }
    }

    do ..IncBuild()

    quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild002">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()

    if (+..GetParameter(..#PARAMSR18176) = 0) {
        $$$VAR
        set strStatus = $$$OK
        set keyMeta = "MEDPrescriptionPat,14"
        set objMeta = "$$GetFixedFilter^MEDPrescriptionPat()~"
        
        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWW120Hook",keyMeta,objMeta,1)
        }

        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMSR18176, 1)
        }
    }
    
    if (+..GetParameter(..#PARAMCORRIGEWWW120SCAN) = 0) {

        $$$VAR
    
        new formScan, objScan, strStatus
    
        set formScan = ""
        set strStatus = $$$OK
    
        for{
            set formScan = $order(^WWW120Scan(YM,formScan))
            quit:((formScan="")||('$$$ISOK(strStatus)))
        
            set objScan = $get(^WWW120Scan(YM,formScan,1))
            set EnableScanning = $$$WWW120ScanEnableScanning(objScan)
        
            if (EnableScanning = $$$YES){
                set $$$WWW120ScanEnableScanning(objScan) = ""
                set strStatus = $$$Save("WWW120Scan",formScan,objScan,$$$YES)
            }
        
            if $$$ISERR(strStatus) {
                set strStatus = "Erro ao atualizar os form com scan = "_$$DecodeError^COMUtilError(strStatus,$$$YES)
                quit
            }
        }
    
        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMCORRIGEWWW120SCAN, 1)
        } else {
            write !,strStatus,!
        }
    }
    
    if (+..GetParameter(..#PARAMREINDEXCLASSES) = 0) {
        do ^WWWVAR

        set VORG(1) = "INREC"
        do ^WWWSORT
        
        set VORG(1) = "INART"
        do ^WWWSORT
        
        set VORG(1) = "INAUF"
        do ^WWWSORT
        
        set VORG(1) = "INPROJECT"
        do ^WWWSORT
        
        set VORG(1) = "INReq"
        do ^WWWSORT
        
        set VORG(1) = "INReqLine"
        do ^WWWSORT
        
        set VORG(1) = "INTFR"
        do ^WWWSORT
        
        set VORG(1) = "INTFRLine"
        do ^WWWSORT
        
        do ..SetParameter(..#PARAMREINDEXCLASSES, 1)
    }
    
    if (+..GetParameter(..#PARAMSR18195) = 0) {
        $$$VAR

        do ReIndex^COMIndex("MEDPrescriptionLine",1)
        
        do ..SetParameter(..#PARAMSR18195, 1)
    }

    if (+..GetParameter(..#PARAMPRESCFREQPADRAO) = 0) {
        $$$VAR

        set objMEDPrescriptionSetup = $get(^MEDPrescriptionSetup(0, YM, 1))
        set $$$MEDPrescriptionSetupDefaultFrequency(objMEDPrescriptionSetup) = "24H"
        set strStatus = $$Save^COMUtils("MEDPrescriptionSetup", YM, objMEDPrescriptionSetup, 1)

        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMPRESCFREQPADRAO, 1)
        }
    }
    
    if (+..GetParameter(..#PARAMSR18213) = 0) {
        kill ^CacheTempEvent    
        do ..SetParameter(..#PARAMSR18213, 1)
    }

    do ..IncBuild()

    quit $$$OK]]></Implementation>
</Method>

<Method name="UpdateBuild000">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	write !, "Current Version: ", ..GetCurrentVersion()

    if (+..GetParameter(..#PARAMWWWSTATUS) = 0) {
        set objWWWStatus = ""
        set $$$WWWStatusDescription(objWWWStatus) = "WWW00116"
        set strStatus = $$$Save("WWWStatus", """MEDDispense"""_$$$COMMA_1, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00167"
        set strStatus = $$$Save("WWWStatus", """MEDDispense"""_$$$COMMA_2, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00169"
        set strStatus = $$$Save("WWWStatus", """MEDDispense"""_$$$COMMA_3, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00116"
        set $$$WWWStatusImage(objWWWStatus) = "MEDRxStatus-0.gif"
        set strStatus = $$$Save("WWWStatus", """MEDPrescription"""_$$$COMMA_0, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00170"
        set $$$WWWStatusImage(objWWWStatus) = "MEDRxStatus-1.gif"
        set strStatus = $$$Save("WWWStatus", """MEDPrescription"""_$$$COMMA_1, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00171"
        set $$$WWWStatusImage(objWWWStatus) = "MEDRxStatus-2.gif"
        set strStatus = $$$Save("WWWStatus", """MEDPrescription"""_$$$COMMA_2, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00172"
        set $$$WWWStatusImage(objWWWStatus) = "MEDRxStatus-3.gif"
        set strStatus = $$$Save("WWWStatus", """MEDPrescription"""_$$$COMMA_3, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00173"
        set $$$WWWStatusImage(objWWWStatus) = "MEDRxStatus-4.gif"
        set strStatus = $$$Save("WWWStatus", """MEDPrescription"""_$$$COMMA_4, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00174"
        set $$$WWWStatusImage(objWWWStatus) = "MEDRxStatus-5.gif"
        set strStatus = $$$Save("WWWStatus", """MEDPrescription"""_$$$COMMA_5, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00175"
        set $$$WWWStatusImage(objWWWStatus) = "MEDRxStatus-6.gif"
        set strStatus = $$$Save("WWWStatus", """MEDPrescription"""_$$$COMMA_6, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00122"
        set $$$WWWStatusImage(objWWWStatus) = "MEDRxStatus-8.gif"
        set strStatus = $$$Save("WWWStatus", """MEDPrescription"""_$$$COMMA_8, objWWWStatus, $$$YES)

        set $$$WWWStatusDescription(objWWWStatus) = "WWW00123"
        set $$$WWWStatusImage(objWWWStatus) = "MEDRxStatus-9.gif"
        set strStatus = $$$Save("WWWStatus", """MEDPrescription"""_$$$COMMA_9, objWWWStatus, $$$YES)

        do ..SetParameter(..#PARAMWWWSTATUS, 1)
    }

    if (+..GetParameter(..#PARAMMEDFREQUENCY) = 0) {
        set idMEDFrequency = $order(^MEDFrequency(YM, ""))
        while ($length(idMEDFrequency) > 0) {
            set strStatus = $$$Kill("MEDFrequency", idMEDFrequency)

            set idMEDFrequency = $order(^MEDFrequency(YM, idMEDFrequency))
        }

        set objMEDFrequency = ""
        set $$$MEDFrequencyFrequency(objMEDFrequency) = "1/1h"
        set $$$MEDFrequencyConversion(objMEDFrequency) = 24
        set strStatus = $$$Save("MEDFrequency", "1H", objMEDFrequency, $$$YES)

        set objMEDFrequency = ""
        set $$$MEDFrequencyFrequency(objMEDFrequency) = "30/30min"
        set $$$MEDFrequencyConversion(objMEDFrequency) = 48
        set strStatus = $$$Save("MEDFrequency", "30M", objMEDFrequency, $$$YES)

        set objMEDFrequency = ""
        set $$$MEDFrequencyFrequency(objMEDFrequency) = "2/2h"
        set $$$MEDFrequencyConversion(objMEDFrequency) = 12
        set strStatus = $$$Save("MEDFrequency", "2H", objMEDFrequency, $$$YES)

        set objMEDFrequency = ""
        set $$$MEDFrequencyFrequency(objMEDFrequency) = "3/3h"
        set $$$MEDFrequencyConversion(objMEDFrequency) = 8
        set strStatus = $$$Save("MEDFrequency", "3H", objMEDFrequency, $$$YES)

        set objMEDFrequency = ""
        set $$$MEDFrequencyFrequency(objMEDFrequency) = "4/4h"
        set $$$MEDFrequencyConversion(objMEDFrequency) = 6
        set strStatus = $$$Save("MEDFrequency", "4H", objMEDFrequency, $$$YES)

        set objMEDFrequency = ""
        set $$$MEDFrequencyFrequency(objMEDFrequency) = "6/6h"
        set $$$MEDFrequencyConversion(objMEDFrequency) = 4
        set strStatus = $$$Save("MEDFrequency", "6H", objMEDFrequency, $$$YES)

        set objMEDFrequency = ""
        set $$$MEDFrequencyFrequency(objMEDFrequency) = "8/8h"
        set $$$MEDFrequencyConversion(objMEDFrequency) = 3
        set strStatus = $$$Save("MEDFrequency", "8H", objMEDFrequency, $$$YES)

        set objMEDFrequency = ""
        set $$$MEDFrequencyFrequency(objMEDFrequency) = "12/12h"
        set $$$MEDFrequencyConversion(objMEDFrequency) = 2
        set strStatus = $$$Save("MEDFrequency", "12H", objMEDFrequency, $$$YES)

        set objMEDFrequency = ""
        set $$$MEDFrequencyFrequency(objMEDFrequency) = "24/24h"
        set $$$MEDFrequencyConversion(objMEDFrequency) = 1
        set strStatus = $$$Save("MEDFrequency", "24H", objMEDFrequency, $$$YES)

        do ..SetParameter(..#PARAMMEDFREQUENCY, 1)
    }

    if (+..GetParameter(..#PARAMMODFORNECEDORAVALIACAO) = 0) {
        // Criação do módulo de Avaliação do Fornecedor
        new idModulo, objModulo
        set idModulo = 11
        set $$$VARBRModuloNomeModulo(objModulo) = "FornecedorAvaliacao"
        set $$$VARBRModuloSiglaModulo(objModulo) = "FOA"
        set strStatus = $$$Save("VARBRModulo",idModulo,objModulo)

        // Criação do Diretórios para Arquivos do módulo de Avaliação do Fornecedor
        new idDiretorio, objDiretorio
        set idDiretorio = 11
        set $$$VARBRDiretoriosDiretorioFisico(objDiretorio) = "FornecedorAvaliacao"
        set $$$VARBRDiretoriosDescricao(objDiretorio) = "Arquivo de Avaliação do Fornecedor"
        set $$$VARBRDiretoriosDiretorioVirtual(objDiretorio) = "FornecedorAvaliacao"
        set $$$VARBRDiretoriosDiretorioPai(objDiretorio) = 0
        set strStatus = $$$Save("VARBRDiretorios",idDiretorio,objDiretorio)
        
        // Cria o novo diretório para Avaliação do Fornecedor
        do ##class(%File).CreateDirectory($$GetDiretorioFisico^VARBRDiretorios(0,0)_"\FornecedorAvaliacao")
        do ..SetParameter(..#PARAMMODFORNECEDORAVALIACAO, 1)
    }
    
    if (+..GetParameter(..#PARAMADDFORMMEDHOOK) = 0) {
        $$$VAR
        set keyHook = """MEDPresAsIssue"""_","_11
        set objHook = "OnBeforeFormat^MEDPresAsIssue(YFIELDNAME,"""",YFELD)~"
        set strStatus = $$$Save("WWW120Hook",keyHook,objHook,$$$YES)
    
        if $$$ISOK(strStatus) {
            set keyHook = """MEDPresDispLine"""_","_11
            set objHook = "OnBeforeFormat^MEDPresDispLine(YFIELDNAME,"""",YFELD)~"
            set strStatus = $$$Save("WWW120Hook",keyHook,objHook,$$$YES)
        }
        if $$$ISOK(strStatus) {
            set keyHook = """MEDPrescriptionHospLine"""_","_12
            set objHook = "OnAfterRowChange^MEDPrescriptionHospLine(YFORM,YROW)~.."
            set strStatus = $$$Save("WWW120Hook",keyHook,objHook,$$$YES)
        }
    
        if $$$ISOK(strStatus) {
            set keyHook = """MEDPrescriptionSolLine"""_","_11
            set objHook = "OnBeforeFormat^MEDPrescriptionSolLine(YFIELDNAME,"""",YFELD)~"
            set strStatus = $$$Save("WWW120Hook",keyHook,objHook,$$$YES)
        }
    
        if $$$ISOK(strStatus) {
            set keyHook = """MEDPrescriptionSolLine"""_","_13
            set objHook = "OnBeforeValidation^MEDPrescriptionSolLine()~"
            set strStatus = $$$Save("WWW120Hook",keyHook,objHook,$$$YES)
        }

        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMADDFORMMEDHOOK, 1)
        }
        else {
            write !, "Error saving WWW120Hook metadata"
        }
    }
    
    if (+..GetParameter(..#PARAMMEDMETADATAASDE3) =0) {
        $$$VAR
        set strStatus = $$$OK
        
        set keyMeta = "MED"
        set objMeta = "1~1"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("COMConst",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDDispense"
        set objMeta = "1~1"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("COMConst",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPatient"
        set objMeta = "1~1"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("COMConst",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescription"
        set objMeta = "1~1"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("COMConst",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescriptionLine"
        set objMeta = "1"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("COMConst",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDFrequency"
        set objMeta = "1"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("COMConst",keyMeta,objMeta,1)
        }

        set keyMeta = "MED"
        set objMeta = "1~1"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("COMConst",keyMeta,objMeta,1)
        }

        set keyMeta = "MED"
        set objMeta = "1~1"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("COMConst",keyMeta,objMeta,1)
        }

        set keyMeta = "MED"
        set objMeta = "1~1"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("COMConst",keyMeta,objMeta,1)
        }


        set keyMeta = "MEDDispense,1"
        set objMeta = "WWW00116~"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDDispense,2"
        set objMeta = "WWW00167~"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDDispense,3"
        set objMeta = "WWW00169~"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescription,0"
        set objMeta = "WWW00116~MEDRxStatus-0.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescription,1"
        set objMeta = "WWW00170~MEDRxStatus-1.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescription,2"
        set objMeta = "WWW00171~MEDRxStatus-2.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescription,3"
        set objMeta = "WWW00172~MEDRxStatus-3.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescription,4"
        set objMeta = "WWW00173~MEDRxStatus-4.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescription,5"
        set objMeta = "WWW00174~MEDRxStatus-5.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescription,6"
        set objMeta = "WWW00175~MEDRxStatus-6.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescription,8"
        set objMeta = "WWW00122~MEDRxStatus-8.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        set keyMeta = "MEDPrescription,9"
        set objMeta = "WWW00123~MEDRxStatus-9.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }

        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMMEDMETADATAASDE3, 1)
        }
        else {
            write !, "Error on update metadata"
        }
    }
    if (+..GetParameter(..#PARAMMEDMETADATA2ASDE3) =0) {
        $$$VAR
        set strStatus = $$$OK
        

        set keyMeta = "MEDPrescription,10"
        set objMeta = "WWW00180~MEDRxStatus-10.gif"

        if $$$ISOK(strStatus) {
            set strStatus = $$Save^COMUtils("WWWStatus",keyMeta,objMeta,1)
        }
        
        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMMEDMETADATA2ASDE3, 1)
        }
        else {
            write !, "Error on update metadata"
        }
    }
    if (+..GetParameter(..#PARAMWWW122INDEX) = 0) {
        $$$VAR
        do ReIndex^COMIndex("WWW122",1)
        do ..SetParameter(..#PARAMWWW122INDEX, 1) 
    }
    
    if (+..GetParameter(..#PARAMWWW120HOOKMETADATAMED) = 0) {
        $$$VAR
        set strStatus = $$$OK
        set keyMeta = "MEDPresAsIssue,11"
        set objMeta = "OnBeforeFormat^MEDPresAsIssue(YFIELDNAME,"""",YFELD)~"
        
        if $$$ISOK(strStatus) {
            set strStatus = $$$Save("WWW120Hook",keyMeta,objMeta,$$$YES)
        }
        
        set keyMeta = "MEDPresDispLine,11"
        set objMeta = "OnBeforeFormat^MEDPresDispLine(YFIELDNAME,"""",YFELD)~"
        
        if $$$ISOK(strStatus) {
            set strStatus = $$$Save("WWW120Hook",keyMeta,objMeta,$$$YES)
        }
        
        set keyMeta = "MEDPrescriptionHospLine,12"
        set objMeta = "OnAfterRowChange^MEDPrescriptionHospLine(YFORM,YROW)~.."
        
        if $$$ISOK(strStatus) {
            set strStatus = $$$Save("WWW120Hook",keyMeta,objMeta,$$$YES)
        }
        
        set keyMeta = "MEDPrescriptionSolLine,11"
        set objMeta = "OnBeforeFormat^MEDPrescriptionSolLine(YFIELDNAME,"""",YFELD)~"
        
        if $$$ISOK(strStatus) {
            set strStatus = $$$Save("WWW120Hook",keyMeta,objMeta,$$$YES)
        }
        
        set keyMeta = "MEDPrescriptionSolLine,13"
        set objMeta = "OnBeforeValidation^MEDPrescriptionSolLine()~"
        
        if $$$ISOK(strStatus) {
            set strStatus = $$$Save("WWW120Hook",keyMeta,objMeta,$$$YES)
        }
        
        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMWWW120HOOKMETADATAMED, 1)
        }
        else {
            write !, "Error on update WWW120Hook metadata"
        }
    }
    
    if (+..GetParameter(..#PARAMMEDADMISSIONINDEX) = 0) {
        ;SR18130.1
        $$$VAR
        do ReIndex^COMIndex("MEDAdmission",1)
        do ..SetParameter(..#PARAMMEDADMISSIONINDEX, 1) 
    }
    
    if (+..GetParameter(..#PARAMMEDSCAN) = 0) {
        ; SR18166
        $$$VAR
        set keyMeta = "MEDDispensePickLine"
        set objMeta = "Dispense Pick Lines~~INART~AddScanLine^MEDDispensePickLineScan(pidScan)"
        
        if $$$ISOK(strStatus) {
            set strStatus = $$$Save("WWW120Scan",keyMeta,objMeta,$$$YES)
        }
        
        do ..SetParameter(..#PARAMMEDSCAN, 1) 
    }
    
    if (+..GetParameter(..#PARAMSR18130) = 0) {
        set sc=..SR18130()
        if $$$ISOK(sc) do ..SetParameter(..#PARAMSR18130, 1)
    }
    
    if (+..GetParameter(..#PARAMCORRIGEWWW120SCAN) = 0) {
        ;----------------------------------------------------------
        ; VARINADJLinha
        ;----------------------------------------------------------
        set Form = "VARINADJLinha"
        set objINADJLinha = $get(^WWW120Scan(0,Form,1))
        set $$$WWW120ScanEnableScanning(objINADJLinha) = ""
        set strStatus = $$$Save("WWW120Scan",Form,objINADJLinha,1)

        if $$$ISERR(strStatus) {
            set strStatus = "Erro ao atualizar o form para scan VARINADJLinha = "_$$DecodeError^COMUtilError(strStatus,$$$YES)
            quit strStatus
        }
        
        ;----------------------------------------------------------
        ; VARINADJDoacaoLinha
        ;----------------------------------------------------------
        set Form = "VARINADJDoacaoLinha"
        set objINADJDoacaoLinha = $get(^WWW120Scan(0,Form,1))
        set $$$WWW120ScanEnableScanning(objINADJDoacaoLinha) = ""
     ]]><![CDATA[   set strStatus = $$$Save("WWW120Scan",Form,objINADJDoacaoLinha,1)

        if $$$ISERR(strStatus) {
            set strStatus = "Erro ao atualizar o form para scan VARINADJDoacaoLinha = "_$$DecodeError^COMUtilError(strStatus,$$$YES)
            quit strStatus
        }
                                                                    
        if $$$ISOK(strStatus) {
            do ..SetParameter(..#PARAMCORRIGEWWW120SCAN, 1)
        }
    }
    
    do ..IncBuild()
    do ..IncBuild()
    
    quit status]]></Implementation>
</Method>

<Method name="HEVA154R2">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	; This routine creates INBrand data based on the contents of the Brand field of various classes.
    #include INConst
    
    set strStatus=$$$OK
    $$$VAR
    
    set id = "" for { set id =$order(^INADJATTLine(YM,id)) quit:id=""
        set idLine = "" for { set idLine =$order(^INADJATTLine(YM,id,idLine)) quit:idLine=""
            set obj=$get(^INADJATTLine(YM,id,idLine,1))
            if $$$INADJATTLineNewBrand(obj) '= "" {
                set arrBrand($$$INADJATTLineNewBrand(obj))=""
            }
        }
    }
    set id = "" for { set id =$order(^INADJLine(YM,id)) quit:id=""
        set idLine = "" for { set idLine =$order(^INADJLine(YM,id,idLine)) quit:idLine=""
            set obj=$get(^INADJLine(YM,id,idLine,1))
            if $$$INADJLineBrand(obj) '= "" {
                set arrBrand($$$INADJLineBrand(obj))=""
            }
        }
    }
    set id = "" for { set id =$order(^INRECLine(YM,id)) quit:id=""
        set idLine = "" for { set idLine =$order(^INRECLine(YM,id,idLine)) quit:idLine=""
            set obj=$get(^INRECLine(YM,id,idLine,1))
            if $$$INRECLineBrand(obj) '= "" {
                set arrBrand($$$INRECLineBrand(obj))=""
            }
        }
    }
    set id = "" for { set id =$order(^INRECScanLine(YM,id)) quit:id=""
        set idLine = "" for { set idLine =$order(^INRECScanLine(YM,id,idLine)) quit:idLine=""
            set obj=$get(^INRECScanLine(YM,id,idLine,1))
            if $$$INRECScanLineBrand(obj) '= "" {
                set arrBrand($$$INRECScanLineBrand(obj))=""
            }
        }
    }
    set id = "" for { set id =$order(^INWEINV(YM,id)) quit:id=""
        set idLine = "" for { set idLine =$order(^INWEINV(YM,id,idLine)) quit:idLine=""
            set obj=$get(^INWEINV(YM,id,idLine,1))
            if $$$INWEINVBrand(obj) '= "" {
                set arrBrand($$$INWEINVBrand(obj))=""
            }
        }
    }
    
    set id="" for { set id=$order(arrBrand(id)) quit:id=""
        quit:$$$ISERR(strStatus)
        set obj=""
        if '$data(^INBrand(YM,id,1)) {
            set $$$INBrandDescription(obj)=id
            set strStatus=$$$Save("INBrand",id,obj,1)
        }
        ;write !,strStatus_":"_id_":"_$get(^INBrand(YM,id,1))
    }

    quit strStatus]]></Implementation>
</Method>

<Method name="HEVA154">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	; This routine creates INOWNER data based on the contents of the Owner field of various classes.
    #include INConst
    
    set strStatus=$$$OK
    $$$VAR
    
    set id = "" for { set id =$order(^INADJATTLine(YM,id)) quit:id=""
        set idLine = "" for { set idLine =$order(^INADJATTLine(YM,id,idLine)) quit:idLine=""
            set obj=$get(^INADJATTLine(YM,id,idLine,1))
            if $$$INADJATTLineNewOwner(obj) '= "" {
                set arrOwner($$$INADJATTLineNewOwner(obj))=""
            }
        }
    }
    set id = "" for { set id =$order(^INADJLine(YM,id)) quit:id=""
        set idLine = "" for { set idLine =$order(^INADJLine(YM,id,idLine)) quit:idLine=""
            set obj=$get(^INADJLine(YM,id,idLine,1))
            if $$$INADJLineOwner(obj) '= "" {
                set arrOwner($$$INADJLineOwner(obj))=""
            }
        }
    }
    set id = "" for { set id =$order(^INRECLine(YM,id)) quit:id=""
        set idLine = "" for { set idLine =$order(^INRECLine(YM,id,idLine)) quit:idLine=""
            set obj=$get(^INRECLine(YM,id,idLine,1))
            if $$$INRECLineOwner(obj) '= "" {
                set arrOwner($$$INRECLineOwner(obj))=""
            }
        }
    }
    set id = "" for { set id =$order(^INRECScanLine(YM,id)) quit:id=""
        set idLine = "" for { set idLine =$order(^INRECScanLine(YM,id,idLine)) quit:idLine=""
            set obj=$get(^INRECScanLine(YM,id,idLine,1))
            if $$$INRECScanLineOwner(obj) '= "" {
                set arrOwner($$$INRECScanLineOwner(obj))=""
            }
        }
    }
    set id = "" for { set id =$order(^INWEINV(YM,id)) quit:id=""
        set idLine = "" for { set idLine =$order(^INWEINV(YM,id,idLine)) quit:idLine=""
            set obj=$get(^INWEINV(YM,id,idLine,1))
            if $$$INWEINVOwner(obj) '= "" {
                set arrOwner($$$INWEINVOwner(obj))=""
            }
        }
    }
    
    set id="" for { set id=$order(arrOwner(id)) quit:id=""
        quit:$$$ISERR(strStatus)
        set obj=""
        if '$data(^INOWNER(YM,id,1)) {
            set $$$INOWNERDescription(obj)=id
            set strStatus=$$$Save("INOWNER",id,obj,1)
        }
        ;write !,strStatus_":"_id_":"_$get(^INOWNER(YM,id,1))
    }
    
    if $$$ISOK(strStatus) {
        set id="INRECScanLine"
        if '$data(^COMConst(YM,id,1)) {
            set obj=""
            set $$$COMConstGenerate(obj)=$$$YES
            set strStatus=$$$Save("COMConst",id,obj,$$$YES)
        }
    }
    if $$$ISOK(strStatus) {
        set id="INOWNER"
        if '$data(^COMConst(YM,id,1)) {
            set obj=""
            set $$$COMConstGenerate(obj)=$$$YES
            set strStatus=$$$Save("COMConst",id,obj,$$$YES)
        }
    }
    quit strStatus]]></Implementation>
</Method>

<Method name="HEVA700">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	new (Y)
    #include INConst
    
    set strStatus=$$$OK
    do ^WWWVAR

    set idINART="" for { set idINART=$order(^INART(0,idINART)) quit:idINART=""
        set objINART=$get(^INART(0,idINART,1))
        if ($$$INARTMultidoseInjectable(objINART)'=$piece(objINART,Y,296)) ||($piece(objINART,Y,296)'="") {
            w !,idINART
            set $$$INARTMultidoseInjectable(objINART)=$piece(objINART,Y,296)
            set $piece(objINART,Y,296)=""
            set strStatus= strStatus && $$Save^COMUtils("INART",idINART,objINART,1)
        }
    }
    do KILL^COMUtils("WWW122D", "INART,296,0")
    quit strStatus]]></Implementation>
</Method>

<Method name="SR18130">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	;-------------------------------------------------------------------------------
    ; Recalculates MEDPatients that are current in an 'Admitted' state.
    ;
    ; History :
    ; 08-Oct-2012   shobby      SR18130: Created
    ;-------------------------------------------------------------------------------
    new idMEDAdmission,objMEDAdmission,arrOpenAdmissions,idPatient,objMEDPatient,blnAdmitted
    new strStatus

    $$$VAR
    set idMEDAdmission="" 
    set strStatus = $$$OK
    set count = 0
    
    w !!,"Recalculando pacientes que estão atualmente admitidos...",!
    
    for { 
        set idMEDAdmission=$order(^MEDAdmission(0,idMEDAdmission),-1) 
        quit:((idMEDAdmission="")||('$$$ISOK(strStatus)))
        
        set objMEDAdmission=$get(^MEDAdmission(YM,idMEDAdmission,1))
        set idPatient=$$$MEDAdmissionPatient(objMEDAdmission)
        
        if idPatient'="" {
            if '$data(arrOpenAdmissions(idPatient)) {   ;Only deal with the last admission for this patient
                set arrOpenAdmissions(idPatient)=""
                set blnAdmitted=($$$MEDAdmissionDateDischarged(objMEDAdmission)="")
                set objMEDPatient=$get(^MEDPatient(0,idPatient,1))
                if $$$MEDPatientCurrentlyAdmitted(objMEDPatient)'=blnAdmitted {
                    set $$$MEDPatientCurrentlyAdmitted(objMEDPatient)=blnAdmitted
                    set strStatus=$$$Save("MEDPatient",idPatient,objMEDPatient,$$$YES)
                    
                    set count = $i(count)
                    
                    if (count#1000 = 0) {
                        w !,count_" registros alterados até o momento."
                    }
                }
            }
        }
    }
    
    if (count > 0) {
        w "Os registros já estão atualizados.",!
    } else {
        w !!,"Registros alterados com sucesso!",!
    }
    
    if (+..GetParameter(..#PARAMSETPRODUCTION) = 0) {
        do ..SetProductionComputers("AMEDISC1,AMEDISC2")
        do ..SetAcceptanceTestComputers("MORENA,AMEDISC1,AMEDISC2")
        do ..SetParameter(..#PARAMSETPRODUCTION, 1)
    }
    
    if ('+..GetParameter(..#PARAMLIMPASERVICOCMM)) {
        
        if (##class(%Dictionary.ClassDefinition).%ExistsId("VAR.infra.cmm.CMMCalcRunner")) {
            do ##class(%Dictionary.ClassDefinition).%DeleteId("VAR.infra.cmm.CMMCalcRunner")
        }
        
        if (##class(%Library.Routine).Exists("VARCMM2")) {
            do ##class(%Library.Routine).Delete("VARCMM2")
        }

        do ..SetParameter(..#PARAMLIMPASERVICOCMM, 1)
    }
    
    quit strStatus]]></Implementation>
</Method>
</Class>
</Export>