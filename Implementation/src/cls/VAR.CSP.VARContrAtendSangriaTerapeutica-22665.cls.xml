<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="Cache" ts="2001-01-01 00:00:00">
<Class name="VAR.CSP.VARContrAtendSangriaTerapeutica">
<ClassType/>
<IncludeCode>MEDConst,VARConst</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	do ^WWWVAR
	;	
	set method = $get(%request.Data("method",1))
	xecute "do .."_method_"()"
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetProntuario">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set listRetorno = {}
	
	set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
	set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	if (objProntuario '= "") {
		set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)
		set criadoEm				= $$$VARProntuarioEletronicoCriadoEm(objProntuario)
		set numAdmissao			= $$$VARProntuarioEletronicoNumeroAdmisao(objProntuario)
		;
		set objMEDAdmission	= $get(^MEDAdmission(YM, numAdmissao, 1))
		;
		If ($$$MEDAdmissionPatient(objMEDAdmission) '= codPaciente) {
			set codPaciente		= $$$MEDAdmissionPatient(objMEDAdmission)
		}
		;
		Set numProntuario 	= $$SQLGetPatientProntuario^VARSQL(codPaciente)
		;
		Set objMEDPatient = $Get(^MEDPatient(0, codPaciente, 1))
		;
		set nomePaciente		= $$SQLGetPatientName^VARSQL(codPaciente)
		set dataNascimento	= $$SQLGetPatientDataNascimento^VARSQL(codPaciente)
		set qtdeAnos				= $$SQLGetPatientAge^VARSQL(dataNascimento)
		set qtdeMeses				= $$SQLGetPatientMonth^VARSQL(dataNascimento)
		set sexo						= $$SQLGetSexoPaciente^VARSQL(codPaciente)
		;
		set objMEDAdmission	= $get(^MEDAdmission(YM, numAdmissao, 1))
		set codSala					= $$$MEDAdmissionRoom(objMEDAdmission)			
		set codLeito				= $$$MEDAdmissionBed(objMEDAdmission)
		;
		set (descSala, dataSourceLeito) = ""
		If (codSala '= "") {
			set objSala					= $get(^VARSalasAtendimentos(YM,codSala,1))
			set descSala 				= $$$VARSalasAtendimentosNome(objSala)
			;
			set dataSourceLeito = ##Class(VAR.CSP.VARContrAtendQuimioterapico).GetLeitos(codSala, codLeito)
		}
		;
		set objPEPMielograma = $get(^VARPEPSangriaTerapeutica(YM, pCodProntuario, 1))
		;
		set listRetorno.dataHora 									= $zdatetime(criadoEm,4,2)
		set listRetorno.codPaciente 							= numProntuario
		set listRetorno.paciente 									= nomePaciente
		set listRetorno.dataNascimento	 					= $zdate(dataNascimento,4,,4)
		set listRetorno.idade											= qtdeAnos
		set listRetorno.sexo											= sexo
		set listRetorno.codSala										= descSala
		set listRetorno.dSLeito										= dataSourceLeito
		set listRetorno.codLeito									= codLeito

		set diagnostico = $$$VARPEPSangriaTerapeuticaDiagnostico(objPEPMielograma)
		set arrayDiagnostico = []
		for i=1:1:$length(diagnostico,";") {
			if ($piece(diagnostico,";",i)="") continue
			do arrayDiagnostico.%Push($piece(diagnostico,";",i))
		}

		set dataHoraAssinatura 	= $$$VARPEPSangriaTerapeuticaDataHoraAssinatura(objPEPMielograma)
		set assinatura					= $$$VARPEPSangriaTerapeuticaUsuarioAssinatura(objPEPMielograma)
		;;
		set sSPalidez = $$$VARPEPSangriaTerapeuticaSSPalidez(objPEPMielograma)
		set sSInconscienciadesmaio = $$$VARPEPSangriaTerapeuticaSSInconscienciadesmaio(objPEPMielograma)
		set sSPulsorapidoefino = $$$VARPEPSangriaTerapeuticaSSPulsorapidoefino(objPEPMielograma)
		set sSSudorese = $$$VARPEPSangriaTerapeuticaSSSudorese(objPEPMielograma)
		set sSPulsolento = $$$VARPEPSangriaTerapeuticaSSPulsolento(objPEPMielograma)
		set sSHipotensao = $$$VARPEPSangriaTerapeuticaSSHipotensao(objPEPMielograma)
		set sSNervosismo = $$$VARPEPSangriaTerapeuticaSSNervosismo(objPEPMielograma)
		set sSTetania = $$$VARPEPSangriaTerapeuticaSSTetania(objPEPMielograma)
		set sSVomitos = $$$VARPEPSangriaTerapeuticaSSVomitos(objPEPMielograma)
		set sSConvulsoes = $$$VARPEPSangriaTerapeuticaSSConvulsoes(objPEPMielograma)
		set sSHiperventilacao = $$$VARPEPSangriaTerapeuticaSSHiperventilacao(objPEPMielograma)
		set sSIncontinencia = $$$VARPEPSangriaTerapeuticaSSIncontinencia(objPEPMielograma)
		set sSOutros = $$$VARPEPSangriaTerapeuticaSSOutros(objPEPMielograma)
		set sSOutrosDescricao = $$$VARPEPSangriaTerapeuticaSSOutrosDescricao(objPEPMielograma)
		;
		set reacaoSinSintPulso = $$$VARPEPSangriaTerapeuticaReacaoSinSintPulso(objPEPMielograma)
		set reacaoSinSintPA = $$$VARPEPSangriaTerapeuticaReacaoSinSintPA(objPEPMielograma)
		set reacaoSinSintFebre = $$$VARPEPSangriaTerapeuticaReacaoSinSintFebre(objPEPMielograma)
		set reacaoSinSintCalafrios = $$$VARPEPSangriaTerapeuticaReacaoSinSintCalafrios(objPEPMielograma)
		set reacaoSinSintDispneia = $$$VARPEPSangriaTerapeuticaReacaoSinSintDispneia(objPEPMielograma)
		set reacaoSinSintTremor = $$$VARPEPSangriaTerapeuticaReacaoSinSintTremor(objPEPMielograma)
		set reacaoSinSintVomito = $$$VARPEPSangriaTerapeuticaReacaoSinSintVomito(objPEPMielograma)
		set reacaoSinSintCianose = $$$VARPEPSangriaTerapeuticaReacaoSinSintCianose(objPEPMielograma)
		set reacaoSinSintDorLombar = $$$VARPEPSangriaTerapeuticaReacaoSinSintDorLombar(objPEPMielograma)
		set reacaoSinSintDordeCabeca = $$$VARPEPSangriaTerapeuticaReacaoSinSintDordeCabeca(objPEPMielograma)
		set reacaoSinSintDornoTorax = $$$VARPEPSangriaTerapeuticaReacaoSinSintDornoTorax(objPEPMielograma)
		set reacaoSinSintUrticaria = $$$VARPEPSangriaTerapeuticaReacaoSinSintUrticaria(objPEPMielograma)
		set reacaoSinSintEritema = $$$VARPEPSangriaTerapeuticaReacaoSinSintEritema(objPEPMielograma)
		set reacaoSinSintPrurido = $$$VARPEPSangriaTerapeuticaReacaoSinSintPrurido(objPEPMielograma)
		set reacaoSinSintSangramentos = $$$VARPEPSangriaTerapeuticaReacaoSinSintSangramentos(objPEPMielograma)
		set reacaoSinSintUrinaEscura = $$$VARPEPSangriaTerapeuticaReacaoSinSintUrinaEscura(objPEPMielograma)
		set reacaoSinSintMenosVolUrinario = $$$VARPEPSangriaTerapeuticaReacaoSinSintMenosVolUrinario(objPEPMielograma)
		set reacaoSinSintOutros = $$$VARPEPSangriaTerapeuticaReacaoSinSintOutros(objPEPMielograma)
		set reacaoSinSintOutrosDescricao = $$$VARPEPSangriaTerapeuticaReacaoSinSintOutrosDescricao(objPEPMielograma)
		;
		set sSIncidenteNomomentodaf = $$$VARPEPSangriaTerapeuticaSSIncidenteNomomentodaf(objPEPMielograma)
		set sSIncidentePosteriormen = $$$VARPEPSangriaTerapeuticaSSIncidentePosteriormen(objPEPMielograma)
		set sSIncidentePostData = $$$VARPEPSangriaTerapeuticaSSIncidentePostData(objPEPMielograma)
		set sSIncidenteHematoma = $$$VARPEPSangriaTerapeuticaSSIncidenteHematoma(objPEPMielograma)
		set sSIncidenteDorexcepSSiva = $$$VARPEPSangriaTerapeuticaSSIncidenteDorexcessiva(objPEPMielograma)
		set sSIncDorOutLocBra = $$$VARPEPSangriaTerapeuticaSSIncDorOutLocBra(objPEPMielograma)
		set sSIncDorOutLocBraDesc = $$$VARPEPSangriaTerapeuticaSSIncDorOutLocBraDesc(objPEPMielograma)
		set sSIncidenteAdormeciment = $$$VARPEPSangriaTerapeuticaSSIncidenteAdormeciment(objPEPMielograma)
		set sSIncidenteChoques = $$$VARPEPSangriaTerapeuticaSSIncidenteChoques(objPEPMielograma)
		set sSIncidenteHiperemia = $$$VARPEPSangriaTerapeuticaSSIncidenteHiperemia(objPEPMielograma)
		set sSIncidenteHiperemiaDes = $$$VARPEPSangriaTerapeuticaSSIncidenteHiperemiaDes(objPEPMielograma)
		set sSIncidentePopSSivelpunc = $$$VARPEPSangriaTerapeuticaSSIncidentePossivelpunc(objPEPMielograma)
		set sSIncidenteInfiltracao = $$$VARPEPSangriaTerapeuticaSSIncidenteInfiltracao(objPEPMielograma)
		set sSIncidenteQueda = $$$VARPEPSangriaTerapeuticaSSIncidenteQueda(objPEPMielograma)
		set sSIncidenteNenhumalesao = $$$VARPEPSangriaTerapeuticaSSIncidenteNenhumalesao(objPEPMielograma)
		set sSIncPopSSivelLesao = $$$VARPEPSangriaTerapeuticaSSIncPossivelLesao(objPEPMielograma)
		set sSIncPopSSivelLesaoDesc = $$$VARPEPSangriaTerapeuticaSSIncPossivelLesaoDesc(objPEPMielograma)
		set sSConclusao = $$$VARPEPSangriaTerapeuticaSSConclusao(objPEPMielograma)
		set sSIncidenteInfiltracaoD = $$$VARPEPSangriaTerapeuticaSSIncidenteInfiltracaoD(objPEPMielograma)
		set sSIncidenteHematomaDesc = $$$VARPEPSangriaTerapeuticaSSIncidenteHematomaDesc(objPEPMielograma)
		;
		set sSDescricaoIncidente = $$$VARPEPSangriaTerapeuticaSSDescricaodoIncidente(objPEPMielograma)
		set sSConduta	= $$$VARPEPSangriaTerapeuticaSSConduta(objPEPMielograma)
		;;
		set listRetorno.diagnostico	= arrayDiagnostico
		set listRetorno.medico			= $$$VARPEPSangriaTerapeuticaMedico(objPEPMielograma)
		set listRetorno.medicacoes	= $$$VARPEPSangriaTerapeuticaMedicacoes(objPEPMielograma)
		set listRetorno.orientacoes	= $$$VARPEPSangriaTerapeuticaOrientacoesReacoesAlertas(objPEPMielograma)
		
		If ($$$MEDPatientAlergia(objMEDPatient) '= "") {
			Set listRetorno.alergia			= $$$MEDPatientAlergia(objMEDPatient)
			Set listRetorno.alergiaAQue	= $$$MEDPatientAllergies(objMEDPatient)
		}Else{
			If ($$$MEDPatientAllergies(objMEDPatient) = "") Set listRetorno.alergia = 0
			Else  Set listRetorno.alergia = "1"
			Set listRetorno.alergiaAQue	= $$$MEDPatientAllergies(objMEDPatient)
		}
		
		;set listRetorno.alergia			= $$$VARPEPSangriaTerapeuticaAlergia(objPEPMielograma)
		set listRetorno.medicoExterno	= $$$VARPEPSangriaTerapeuticaMedicoExterno(objPEPMielograma)
		set listRetorno.naoCompareceu	= $$$VARPEPSangriaTerapeuticaNaoCompareceu(objPEPMielograma)
		set listRetorno.dataHoraAssinatura	= $Select(dataHoraAssinatura="":"",1:$ZdateTime(dataHoraAssinatura,4,2))
		set listRetorno.assinatura					= $Select(assinatura="":"",1:$$SQLGetUserName^VARSQL(assinatura))
		//
		Do listRetorno.%Set("sSPalidez",sSPalidez, "number")
		Do listRetorno.%Set("sSInconscienciadesmaio",sSInconscienciadesmaio, "number")
		Do listRetorno.%Set("sSPulsorapidoefino",sSPulsorapidoefino, "number")
		Do listRetorno.%Set("sSSudorese",sSSudorese, "number")
		Do listRetorno.%Set("sSPulsolento",sSPulsolento, "number")
		Do listRetorno.%Set("sSHipotensao",sSHipotensao, "number")
		Do listRetorno.%Set("sSNervosismo",sSNervosismo, "number")
		Do listRetorno.%Set("sSTetania",sSTetania, "number")
		Do listRetorno.%Set("sSVomitos",sSVomitos, "number")
		Do listRetorno.%Set("sSConvulsoes",sSConvulsoes, "number")
		Do listRetorno.%Set("sSHiperventilacao",sSHiperventilacao, "number")
		Do listRetorno.%Set("sSIncontinencia",sSIncontinencia, "number")
		Do listRetorno.%Set("sSOutros",sSOutros, "number")
		set listRetorno.sSOutrosDescricao = sSOutrosDescricao
		;
		Do listRetorno.%Set("rTSinSintMaisPulso",reacaoSinSintPulso)
		Do listRetorno.%Set("rTSinSintMaisPA",reacaoSinSintPA)
		Do listRetorno.%Set("rTSinSintFebre",reacaoSinSintFebre, "number")
		Do listRetorno.%Set("rTSinSintCalafrios",reacaoSinSintCalafrios, "number")
		Do listRetorno.%Set("rTSinSintDispneia",reacaoSinSintDispneia, "number")
		Do listRetorno.%Set("rTSinSintTremor",reacaoSinSintTremor, "number")
		Do listRetorno.%Set("rTSinSintVomito",reacaoSinSintVomito, "number")
		Do listRetorno.%Set("rTSinSintCianose",reacaoSinSintCianose, "number")
		Do listRetorno.%Set("rTSinSintDorLombar",reacaoSinSintDorLombar, "number")
		Do listRetorno.%Set("rTSinSintDordeCabeca",reacaoSinSintDordeCabeca, "number")
		Do listRetorno.%Set("rTSinSintDornoTorax",reacaoSinSintDornoTorax, "number")
		Do listRetorno.%Set("rTSinSintUrticaria",reacaoSinSintUrticaria, "number")
		Do listRetorno.%Set("rTSinSintEritema",reacaoSinSintEritema, "number")
		Do listRetorno.%Set("rTSinSintPrurido",reacaoSinSintPrurido, "number")
		Do listRetorno.%Set("rTSinSintSangramentos",reacaoSinSintSangramentos, "number")
		Do listRetorno.%Set("rTSinSintUrinaEscura",reacaoSinSintUrinaEscura, "number")
		Do listRetorno.%Set("rTSinSintMenosVolUrinario",reacaoSinSintMenosVolUrinario, "number")
		Do listRetorno.%Set("rTSinSintOutros",reacaoSinSintOutros, "number")
		set listRetorno.rTSinSintOutrosDescrica = reacaoSinSintOutrosDescricao
		;
		Do listRetorno.%Set("sSIncidenteNomomentodaf",sSIncidenteNomomentodaf, "number")
		Do listRetorno.%Set("sSIncidentePosteriormen",sSIncidentePosteriormen, "number")
		set listRetorno.sSIncidentePostData = $Select(sSIncidentePostData="":"",1:$zdate(sSIncidentePostData,3))
		Do listRetorno.%Set("sSIncidenteHematoma",sSIncidenteHematoma, "number")
		Do listRetorno.%Set("sSIncidenteDorexcepSSiva",sSIncidenteDorexcepSSiva, "number")
		Do listRetorno.%Set("sSIncDorOutLocBra",sSIncDorOutLocBra, "number")
		set listRetorno.sSIncDorOutLocBraDesc = sSIncDorOutLocBraDesc
		Do listRetorno.%Set("sSIncidenteAdormeciment",sSIncidenteAdormeciment, "number")
		Do listRetorno.%Set("sSIncidenteChoques",sSIncidenteChoques, "number")
		Do listRetorno.%Set("sSIncidenteHiperemia",sSIncidenteHiperemia, "number")
		set listRetorno.sSIncidenteHiperemiaDes = sSIncidenteHiperemiaDes
		Do listRetorno.%Set("sSIncidentePopSSivelpunc",sSIncidentePopSSivelpunc, "number")
		Do listRetorno.%Set("sSIncidenteInfiltracao",sSIncidenteInfiltracao, "number")
		Do listRetorno.%Set("sSIncidenteQueda",sSIncidenteQueda, "number")
		Do listRetorno.%Set("sSIncidenteNenhumalesao",sSIncidenteNenhumalesao, "number")
		Do listRetorno.%Set("sSIncPopSSivelLesao",sSIncPopSSivelLesao, "number")
		set listRetorno.sSIncPopSSivelLesaoDesc = sSIncPopSSivelLesaoDesc
		set listRetorno.sSConclusao = sSConclusao
		set listRetorno.sSIncidenteInfiltracaoD = sSIncidenteInfiltracaoD
		set listRetorno.sSIncidenteHematomaDesc = sSIncidenteHematomaDesc		
		;;
		set listRetorno.sSDescricaoIncidente = sSDescricaoIncidente
		set listRetorno.sSConduta = sSConduta
	}
	
	do listRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmProntuario">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	tstart
	set strStatus	=	""
	set erro			=	0
	try{
		set YBED 						= $get(%request.Data("YBED",1))

		set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
		set pAdmissao 			= $get(%request.Data("pAdmissao",1))
		;
		set pDiagnostico 		= $get(%request.Data("pDiagnostico",1))
		if (pDiagnostico '= "") set pDiagnostico = $replace(pDiagnostico,",",";")
		set pMedico 				= $get(%request.Data("pMedico",1))
		set pMedicacoes 		= $get(%request.Data("pMedicacoes",1))
		set pOrientacoes 		= $get(%request.Data("pOrientacoes",1))
		set pAlergia 				= $get(%request.Data("pAlergia",1))
		set pSelAlergia			= $get(%request.Data("pSelAlergia",1))
		set pMedicoExterno	= $get(%request.Data("pMedicoExterno",1))
		;
		set pSSPalidez = $Get(%request.Data("pSSPalidez",1))
		set pSSInconscienciadesmaio = $Get(%request.Data("pSSInconscienciadesmaio",1))
		set pSSPulsorapidoefino = $Get(%request.Data("pSSPulsorapidoefino",1))
		set pSSSudorese = $Get(%request.Data("pSSSudorese",1))
		set pSSPulsolento = $Get(%request.Data("pSSPulsolento",1))
		set pSSHipotensao = $Get(%request.Data("pSSHipotensao",1))
		set pSSNervosismo = $Get(%request.Data("pSSNervosismo",1))
		set pSSTetania = $Get(%request.Data("pSSTetania",1))
		set pSSVomitos = $Get(%request.Data("pSSVomitos",1))
		set pSSConvulsoes = $Get(%request.Data("pSSConvulsoes",1))
		set pSSHiperventilacao = $Get(%request.Data("pSSHiperventilacao",1))
		set pSSIncontinencia = $Get(%request.Data("pSSIncontinencia",1))
		set pSSOutros = $Get(%request.Data("pSSOutros",1))
		set pSSOutrosDescricao = $Get(%request.Data("pSSOutrosDescricao",1))
		set pSSIncidenteNomomentodaf = $Get(%request.Data("pSSIncidenteNomomentodaf",1))
		set pSSIncidentePosteriormen = $Get(%request.Data("pSSIncidentePosteriormen",1))
		set pSSIncidentePostData = $Get(%request.Data("pSSIncidentePostData",1))
		set pSSIncidenteHematoma = $Get(%request.Data("pSSIncidenteHematoma",1))
		set pSSIncidenteDorexcepSSiva = $Get(%request.Data("pSSIncidenteDorexcepSSiva",1))
		set pSSIncDorOutLocBra = $Get(%request.Data("pSSIncDorOutLocBra",1))
		set pSSIncDorOutLocBraDesc = $Get(%request.Data("pSSIncDorOutLocBraDesc",1))
		set pSSIncidenteAdormeciment = $Get(%request.Data("pSSIncidenteAdormeciment",1))
		set pSSIncidenteChoques = $Get(%request.Data("pSSIncidenteChoques",1))
		set pSSIncidenteHiperemia = $Get(%request.Data("pSSIncidenteHiperemia",1))
		set pSSIncidenteHiperemiaDes = $Get(%request.Data("pSSIncidenteHiperemiaDes",1))
		set pSSIncidentePopSSivelpunc = $Get(%request.Data("pSSIncidentePopSSivelpunc",1))
		set pSSIncidenteInfiltracao = $Get(%request.Data("pSSIncidenteInfiltracao",1))
		set pSSIncidenteQueda = $Get(%request.Data("pSSIncidenteQueda",1))
		set pSSIncidenteNenhumalesao = $Get(%request.Data("pSSIncidenteNenhumalesao",1))
		set pSSIncPopSSivelLesao = $Get(%request.Data("pSSIncPopSSivelLesao",1))
		set pSSIncPopSSivelLesaoDesc = $Get(%request.Data("pSSIncPopSSivelLesaoDesc",1))
		set pSSDescricaoIncidente = $Get(%request.Data("pSSDescricaoIncidente",1))
		set pSSConduta = $Get(%request.Data("pSSConduta",1))
		set pSSConclusao = $Get(%request.Data("pSSConclusao",1))
		set pSSIncidenteInfiltracaoD = $Get(%request.Data("pSSIncidenteInfiltracaoD",1))
		set pSSIncidenteHematomaDesc = $Get(%request.Data("pSSIncidenteHematomaDesc",1))		
		;
		set pRTSinSintMaisPulso = $Get(%request.Data("pRTSinSintMaisPulso",1))
		set pRTSinSintMenosPulso = $Get(%request.Data("pRTSinSintMenosPulso",1))
		set pRTSinSintMaisPA = $Get(%request.Data("pRTSinSintMaisPA",1))
		set pRTSinSintMenosPA = $Get(%request.Data("pRTSinSintMenosPA",1))
		set pRTSinSintFebre = $Get(%request.Data("pRTSinSintFebre",1))
		set pRTSinSintCalafrios = $Get(%request.Data("pRTSinSintCalafrios",1))
		set pRTSinSintDispneia = $Get(%request.Data("pRTSinSintDispneia",1))
		set pRTSinSintTremor = $Get(%request.Data("pRTSinSintTremor",1))
		set pRTSinSintVomito = $Get(%request.Data("pRTSinSintVomito",1))
		set pRTSinSintCianose = $Get(%request.Data("pRTSinSintCianose",1))
		set pRTSinSintDorLombar = $Get(%request.Data("pRTSinSintDorLombar",1))
		set pRTSinSintDordeCabeca = $Get(%request.Data("pRTSinSintDordeCabeca",1))
		set pRTSinSintDornoTorax = $Get(%request.Data("pRTSinSintDornoTorax",1))
		set pRTSinSintUrticaria = $Get(%request.Data("pRTSinSintUrticaria",1))
		set pRTSinSintEritema = $Get(%request.Data("pRTSinSintEritema",1))
		set pRTSinSintPrurido = $Get(%request.Data("pRTSinSintPrurido",1))
		set pRTSinSintSangramentos = $Get(%request.Data("pRTSinSintSangramentos",1))
		set pRTSinSintUrinaEscura = $Get(%request.Data("pRTSinSintUrinaEscura",1))
		set pRTSinSintMenosVolUrinario = $Get(%request.Data("pRTSinSintMenosVolUrinario",1))
		set pRTSinSintOutros = $Get(%request.Data("pRTSinSintOutros",1))
		set pRTSinSintOutrosDescrica = $Get(%request.Data("pRTSinSintOutrosDescrica",1))
		;;if (pRTSinSintMaisPulso '= "") set pRTSinSintMaisPulso = $select(pRTSinSintMaisPulso="true"||(pRTSinSintMaisPulso=1):1,1:0)
		if (pRTSinSintMenosPulso '= "") set pRTSinSintMenosPulso = $select(pRTSinSintMenosPulso="true"||(pRTSinSintMenosPulso=1):1,1:0)
		;;if (pRTSinSintMaisPA '= "") set pRTSinSintMaisPA = $select(pRTSinSintMaisPA="true"||(pRTSinSintMaisPA=1):1,1:0)
		if (pRTSinSintMenosPA '= "") set pRTSinSintMenosPA = $select(pRTSinSintMenosPA="true"||(pRTSinSintMenosPA=1):1,1:0)
		if (pRTSinSintFebre '= "") set pRTSinSintFebre = $select(pRTSinSintFebre="true"||(pRTSinSintFebre=1):1,1:0)
		if (pRTSinSintCalafrios '= "") set pRTSinSintCalafrios = $select(pRTSinSintCalafrios="true"||(pRTSinSintCalafrios=1):1,1:0)
		if (pRTSinSintDispneia '= "") set pRTSinSintDispneia = $select(pRTSinSintDispneia="true"||(pRTSinSintDispneia=1):1,1:0)
		if (pRTSinSintTremor '= "") set pRTSinSintTremor = $select(pRTSinSintTremor="true"||(pRTSinSintTremor=1):1,1:0)
		if (pRTSinSintVomito '= "") set pRTSinSintVomito = $select(pRTSinSintVomito="true"||(pRTSinSintVomito=1):1,1:0)
		if (pRTSinSintCianose '= "") set pRTSinSintCianose = $select(pRTSinSintCianose="true"||(pRTSinSintCianose=1):1,1:0)
		if (pRTSinSintDorLombar '= "") set pRTSinSintDorLombar = $select(pRTSinSintDorLombar="true"||(pRTSinSintDorLombar=1):1,1:0)
		if (pRTSinSintDordeCabeca '= "") set pRTSinSintDordeCabeca = $select(pRTSinSintDordeCabeca="true"||(pRTSinSintDordeCabeca=1):1,1:0)
		if (pRTSinSintDornoTorax '= "") set pRTSinSintDornoTorax = $select(pRTSinSintDornoTorax="true"||(pRTSinSintDornoTorax=1):1,1:0)
		if (pRTSinSintUrticaria '= "") set pRTSinSintUrticaria = $select(pRTSinSintUrticaria="true"||(pRTSinSintUrticaria=1):1,1:0)
		if (pRTSinSintEritema '= "") set pRTSinSintEritema = $select(pRTSinSintEritema="true"||(pRTSinSintEritema=1):1,1:0)
		if (pRTSinSintPrurido '= "") set pRTSinSintPrurido = $select(pRTSinSintPrurido="true"||(pRTSinSintPrurido=1):1,1:0)
		if (pRTSinSintSangramentos '= "") set pRTSinSintSangramentos = $select(pRTSinSintSangramentos="true"||(pRTSinSintSangramentos=1):1,1:0)
		if (pRTSinSintUrinaEscura '= "") set pRTSinSintUrinaEscura = $select(pRTSinSintUrinaEscura="true"||(pRTSinSintUrinaEscura):1,1:0)
		if (pRTSinSintMenosVolUrinario '= "") set pRTSinSintMenosVolUrinario = $select(pRTSinSintMenosVolUrinario="true"||(pRTSinSintMenosVolUrinario=1):1,1:0)
		if (pRTSinSintOutros '= "") set pRTSinSintOutros = $select(pRTSinSintOutros="true"||(pRTSinSintOutros=1):1,1:0)
		;
		if (pSSIncidentePostData '= "") set pSSIncidentePostData = $zdateh(pSSIncidentePostData,4)
		if (pSSPalidez '= "") set pSSPalidez = $select(pSSPalidez="true"||(pSSPalidez=1):1,1:0)
		if (pSSInconscienciadesmaio '= "") set pSSInconscienciadesmaio = $select(pSSInconscienciadesmaio="true"||(pSSInconscienciadesmaio=1):1,1:0)
		if (pSSPulsorapidoefino '= "") set pSSPulsorapidoefino = $select(pSSPulsorapidoefino="true"||(pSSPulsorapidoefino=1):1,1:0)
		if (pSSSudorese '= "") set pSSSudorese = $select(pSSSudorese="true"||(pSSSudorese=1):1,1:0)
		if (pSSPulsolento '= "") set pSSPulsolento = $select(pSSPulsolento="true"||(pSSPulsolento=1):1,1:0)
		if (pSSHipotensao '= "") set pSSHipotensao = $select(pSSHipotensao="true"||(pSSHipotensao=1):1,1:0)
		if (pSSNervosismo '= "") set pSSNervosismo = $select(pSSNervosismo="true"||(pSSNervosismo=1):1,1:0)
		if (pSSTetania '= "") set pSSTetania = $select(pSSTetania="true"||(pSSTetania=1):1,1:0)
		if (pSSVomitos '= "") set pSSVomitos = $select(pSSVomitos="true"||(pSSVomitos=1):1,1:0)
		if (pSSConvulsoes '= "") set pSSConvulsoes = $select(pSSConvulsoes="true"||(pSSConvulsoes=1):1,1:0)
		if (pSSHiperventilacao '= "") set pSSHiperventilacao = $select(pSSHiperventilacao="true"||(pSSHiperventilacao=1):1,1:0)
		if (pSSIncontinencia '= "") set pSSIncontinencia = $select(pSSIncontinencia="true"||(pSSIncontinencia=1):1,1:0)
		if (pSSOutros '= "") set pSSOutros = $select(pSSOutros="true"||(pSSOutros=1):1,1:0)
		if (pSSIncidenteNomomentodaf '= "") set pSSIncidenteNomomentodaf = $select(pSSIncidenteNomomentodaf="true"||(pSSIncidenteNomomentodaf=1):1,1:0)
		if (pSSIncidentePosteriormen '= "") set pSSIncidentePosteriormen = $select(pSSIncidentePosteriormen="true"||(pSSIncidentePosteriormen=1):1,1:0)
		if (pSSIncidenteHematoma '= "") set pSSIncidenteHematoma = $select(pSSIncidenteHematoma="true"||(pSSIncidenteHematoma=1):1,1:0)
		if (pSSIncidenteDorexcepSSiva '= "") set pSSIncidenteDorexcepSSiva = $select(pSSIncidenteDorexcepSSiva="true"||(pSSIncidenteDorexcepSSiva=1):1,1:0)
		if (pSSIncDorOutLocBra '= "") set pSSIncDorOutLocBra = $select(pSSIncDorOutLocBra="true"||(pSSIncDorOutLocBra=1):1,1:0)
		if (pSSIncidenteAdormeciment '= "") set pSSIncidenteAdormeciment = $select(pSSIncidenteAdormeciment="true"||(pSSIncidenteAdormeciment=1):1,1:0)
		if (pSSIncidenteChoques '= "") set pSSIncidenteChoques = $select(pSSIncidenteChoques="true"||(pSSIncidenteChoques=1):1,1:0)
		if (pSSIncidenteHiperemia '= "") set pSSIncidenteHiperemia = $select(pSSIncidenteHiperemia="true"||(pSSIncidenteHiperemia=1):1,1:0)
		if (pSSIncidentePopSSivelpunc '= "") set pSSIncidentePopSSivelpunc = $select(pSSIncidentePopSSivelpunc="true"||(pSSIncidentePopSSivelpunc=1):1,1:0)
		if (pSSIncidenteInfiltracao '= "") set pSSIncidenteInfiltracao = $select(pSSIncidenteInfiltracao="true"||(pSSIncidenteInfiltracao=1):1,1:0)
		if (pSSIncidenteQueda '= "") set pSSIncidenteQueda = $select(pSSIncidenteQueda="true"||(pSSIncidenteQueda=1):1,1:0)
		if (pSSIncidenteNenhumalesao '= "") set pSSIncidenteNenhumalesao = $select(pSSIncidenteNenhumalesao="true"||(pSSIncidenteNenhumalesao=1):1,1:0)
		if (pSSIncPopSSivelLesao '= "") set pSSIncPopSSivelLesao = $select(pSSIncPopSSivelLesao="true"||(pSSIncPopSSivelLesao=1):1,1:0)
		;
		set objPEPSangria = $get(^VARPEPSangriaTerapeutica(YM, pCodProntuario, 1))
		set objMEDAdmission	= $get(^MEDAdmission(YM, pAdmissao, 1))
		Set codPaciente = $$$MEDAdmissionPatient(objMEDAdmission)
		if $$$MEDAdmissionDateDischarged(objMEDAdmission) '= ""{
			if ($get(%request.Data("pAssinar",1)) '= 1) {
				set erro = 1
				set strStatus = "Passagem já finalizada!"
				quit
			}
		}
		set $$$VARPEPSangriaTerapeuticaDiagnostico(objPEPSangria) 							= pDiagnostico
		set $$$VARPEPSangriaTerapeuticaMedico(objPEPSangria)										= pMedico
		set $$$VARPEPSangriaTerapeuticaMedicacoes(objPEPSangria) 								= pMedicacoes
		set $$$VARPEPSangriaTerapeuticaOrientacoesReacoesAlertas(objPEPSangria) = pOrientacoes
		set $$$VARPEPSangriaTerapeuticaAlergia(objPEPSangria) 									= pAlergia
		set $$$VARPEPSangriaTerapeuticaMedicoExterno(objPEPSangria) 						= pMedicoExterno
		;
		if ($get(%request.Data("pAssinar",1)) = 1) {
			set $$$VARPEPSangriaTerapeuticaDataHoraAssinatura(objPEPSangria) = $Horolog
			set $$$VARPEPSangriaTerapeuticaUsuarioAssinatura(objPEPSangria) 	= YBED
			Set nSeqDados = ""
			For {
				Set nSeqDados = $Order(^VARPEPSangriaTerapeuticaDados(0, pCodProntuario, nSeqDados))
				Quit:nSeqDados=""
				If ($Piece(^VARPEPSangriaTerapeuticaDados(0, pCodProntuario, nSeqDados,1),"~",11) '= "") Continue
				Set $Piece(^VARPEPSangriaTerapeuticaDados(0, pCodProntuario, nSeqDados,1),"~",11) = YBED
			}
		}else{
			If ($$$VARPEPSangriaTerapeuticaUsuarioAssinatura(objPEPSangria) '= YBED) {
				set $$$VARPEPSangriaTerapeuticaDataHoraAssinatura(objPEPSangria) = ""
				set $$$VARPEPSangriaTerapeuticaUsuarioAssinatura(objPEPSangria) 	= ""
			}else{
				set $$$VARPEPSangriaTerapeuticaDataHoraAssinatura(objPEPSangria) = $Horolog
			}
		}
		;
		set $$$VARPEPSangriaTerapeuticaSSPalidez(objPEPSangria) = pSSPalidez
		set $$$VARPEPSangriaTerapeuticaSSInconscienciadesmaio(objPEPSangria) = pSSInconscienciadesmaio
		set $$$VARPEPSangriaTerapeuticaSSPulsorapidoefino(objPEPSangria) = pSSPulsorapidoefino
		set $$$VARPEPSangriaTerapeuticaSSSudorese(objPEPSangria) = pSSSudorese
		set $$$VARPEPSangriaTerapeuticaSSPulsolento(objPEPSangria) = pSSPulsolento
		set $$$VARPEPSangriaTerapeuticaSSHipotensao(objPEPSangria) = pSSHipotensao
		set $$$VARPEPSangriaTerapeuticaSSNervosismo(objPEPSangria) = pSSNervosismo
		set $$$VARPEPSangriaTerapeuticaSSTetania(objPEPSangria) = pSSTetania
		set $$$VARPEPSangriaTerapeuticaSSVomitos(objPEPSangria) = pSSVomitos
		set $$$VARPEPSangriaTerapeuticaSSConvulsoes(objPEPSangria) = pSSConvulsoes
		set $$$VARPEPSangriaTerapeuticaSSHiperventilacao(objPEPSangria) = pSSHiperventilacao
		set $$$VARPEPSangriaTerapeuticaSSIncontinencia(objPEPSangria) = pSSIncontinencia
		set $$$VARPEPSangriaTerapeuticaSSOutros(objPEPSangria) = pSSOutros
		set $$$VARPEPSangriaTerapeuticaSSOutrosDescricao(objPEPSangria) = pSSOutrosDescricao
		;
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintPulso(objPEPSangria) = pRTSinSintMaisPulso
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintPA(objPEPSangria) = $Replace(pRTSinSintMaisPA,"_","")
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintFebre(objPEPSangria) = pRTSinSintFebre
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintCalafrios(objPEPSangria) = pRTSinSintCalafrios
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintDispneia(objPEPSangria) = pRTSinSintDispneia
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintTremor(objPEPSangria) = pRTSinSintTremor
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintVomito(objPEPSangria) = pRTSinSintVomito
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintCianose(objPEPSangria) = pRTSinSintCianose
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintDorLombar(objPEPSangria) = pRTSinSintDorLombar
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintDordeCabeca(objPEPSangria) = pRTSinSintDordeCabeca
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintDornoTorax(objPEPSangria) = pRTSinSintDornoTorax
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintUrticaria(objPEPSangria) = pRTSinSintUrticaria
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintEritema(objPEPSangria) = pRTSinSintEritema
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintPrurido(objPEPSangria) = pRTSinSintPrurido
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintSangramentos(objPEPSangria) = pRTSinSintSangramentos
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintUrinaEscura(objPEPSangria) = pRTSinSintUrinaEscura
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintMenosVolUrinario(objPEPSangria) = pRTSinSintMenosVolUrinario
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintOutros(objPEPSangria) = pRTSinSintOutros
		set $$$VARPEPSangriaTerapeuticaReacaoSinSintOutrosDescricao(objPEPSangria) = pRTSinSintOutrosDescrica
		;
		set $$$VARPEPSangriaTerapeuticaSSIncidenteNomomentodaf(objPEPSangria) = pSSIncidenteNomomentodaf
		set $$$VARPEPSangriaTerapeuticaSSIncidentePosteriormen(objPEPSangria) = pSSIncidentePosteriormen
		set $$$VARPEPSangriaTerapeuticaSSIncidentePostData(objPEPSangria) = pSSIncidentePostData
		set $$$VARPEPSangriaTerapeuticaSSIncidenteHematoma(objPEPSangria) = pSSIncidenteHematoma
		set $$$VARPEPSangriaTerapeuticaSSIncidenteDorexcessiva(objPEPSangria) = pSSIncidenteDorexcepSSiva
		set $$$VARPEPSangriaTerapeuticaSSIncDorOutLocBra(objPEPSangria) = pSSIncDorOutLocBra
		set $$$VARPEPSangriaTerapeuticaSSIncDorOutLocBraDesc(objPEPSangria) = pSSIncDorOutLocBraDesc
		set $$$VARPEPSangriaTerapeuticaSSIncidenteAdormeciment(objPEPSangria) = pSSIncidenteAdormeciment
		set $$$VARPEPSangriaTerapeuticaSSIncidenteChoques(objPEPSangria) = pSSIncidenteChoques
		set $$$VARPEPSangriaTerapeuticaSSIncidenteHiperemia(objPEPSangria) = pSSIncidenteHiperemia
		set $$$VARPEPSangriaTerapeuticaSSIncidenteHiperemiaDes(objPEPSangria) = pSSIncidenteHiperemiaDes
		set $$$VARPEPSangriaTerapeuticaSSIncidentePossivelpunc(objPEPS]]><![CDATA[angria) = pSSIncidentePopSSivelpunc
		set $$$VARPEPSangriaTerapeuticaSSIncidenteInfiltracao(objPEPSangria) = pSSIncidenteInfiltracao
		set $$$VARPEPSangriaTerapeuticaSSIncidenteQueda(objPEPSangria) = pSSIncidenteQueda
		set $$$VARPEPSangriaTerapeuticaSSIncidenteNenhumalesao(objPEPSangria) = pSSIncidenteNenhumalesao
		set $$$VARPEPSangriaTerapeuticaSSIncPossivelLesao(objPEPSangria) = pSSIncPopSSivelLesao
		set $$$VARPEPSangriaTerapeuticaSSIncPossivelLesaoDesc(objPEPSangria) = pSSIncPopSSivelLesaoDesc
		set $$$VARPEPSangriaTerapeuticaSSConclusao(objPEPSangria) = pSSConclusao
		set $$$VARPEPSangriaTerapeuticaSSIncidenteInfiltracaoD(objPEPSangria) = pSSIncidenteInfiltracaoD
		set $$$VARPEPSangriaTerapeuticaSSIncidenteHematomaDesc(objPEPSangria) = pSSIncidenteHematomaDesc
		;;
		set $$$VARPEPSangriaTerapeuticaSSDescricaodoIncidente(objPEPSangria) = pSSDescricaoIncidente
		set $$$VARPEPSangriaTerapeuticaSSConduta(objPEPSangria) = pSSConduta
		;;
		;
		set strStatus	=	$$$Save("VARPEPSangriaTerapeutica", pCodProntuario, objPEPSangria, $$$YES)
		;
		Set objMEDPatient = $Get(^MEDPatient(0, codPaciente, 1))
		If (pSelAlergia '= $$$MEDPatientAlergia(objMEDPatient) || (pAlergia '= $$$MEDPatientAllergies(objMEDPatient))) {
			set $$$MEDPatientAlergia(objMEDPatient) 	= pSelAlergia
			set $$$MEDPatientAllergies(objMEDPatient) = pAlergia
			set strStatus	=	$$$Save("MEDPatient", codPaciente, objMEDPatient, $$$YES)
		}
	}
	catch(err){
		#dim err as %Exception.SystemException
		set strStatus = err.DisplayString()
		set erro	=	err
	}
	set retorno = {}
	if 'erro{
		tcommit
		set retorno.status = strStatus
		set retorno.dataHoraAssinatura = $$$VARPEPSangriaTerapeuticaDataHoraAssinatura(objPEPSangria)
	}else{
		trollback
		set retorno.status = strStatus
		set retorno.dataHoraAssinatura = $$$VARPEPSangriaTerapeuticaDataHoraAssinatura(objPEPSangria)
	}
	do retorno.%ToJSON()
	quit $$$OK]]></Implementation>
</Method>

<Method name="GetDados">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))

	Set objVARProntuarioEletronico = $Get(^VARProntuarioEletronico(YM, pCodProntuario, 1))
	Set numAdmisao = $$$VARProntuarioEletronicoNumeroAdmisao(objVARProntuarioEletronico)
	
	Set objMEDAdmission = $Get(^MEDAdmission(YM, numAdmisao, 1))
	Set codPaciente = $$$MEDAdmissionPatient(objMEDAdmission)
	
	
	set objPEPMielograma = $get(^VARPEPSangriaTerapeutica(YM, pCodProntuario, 1))
	Set medico = $$$VARPEPSangriaTerapeuticaUsuarioAssinatura(objPEPMielograma)
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select TOP ALL"
	set meuSQL($increment(contador))	= "Dados.CodigoProntuarioEletronic, Dados.Sequencia, Dados.Data,"
	set meuSQL($increment(contador))	= "Dados.Hora, Dados.Peso, Dados.HbHt, Dados.VolumeRetirado,"
	set meuSQL($increment(contador))	= "Dados.SF09, Dados.PAPre, Dados.FCPre,Dados.TemperaturaPre,"
	set meuSQL($increment(contador))	= "Dados.PAPos, Dados.FCPos, Dados.Func, Dados.Medico,"
	set meuSQL($increment(contador))	= "$$SQLGetProviderName^VARSQL(Dados.Medico) As NomeMedico, Dados.Situacao,"
	set meuSQL($increment(contador))	= "Dados.SequenciaLivre, Adm.Status From"
	set meuSQL($increment(contador))	= "SQLUser.MEDAdmission As Adm,"
	set meuSQL($increment(contador))	= "SQLUser.VARProntuarioEletronico As PEP,"
	set meuSQL($increment(contador))	= "SQLUser.VARPEPSangriaTerapeuticaDados As Dados"
	set meuSQL($increment(contador))	= "Where"
	set meuSQL($increment(contador))	= "Adm.Company = 0"
	set meuSQL($increment(contador))	= "And Adm.AdmissionID = PEP.NumeroAdmisao"
	set meuSQL($increment(contador))	= "And Dados.CodigoProntuarioEletronic = PEP.Codigo"
	set meuSQL($increment(contador))	= "And Adm.Patient = '"_codPaciente_"'"
	set meuSQL($increment(contador))	= "And PEP.Setor = 'SANGRIATERAPEUTICA'"
	set meuSQL($increment(contador))	= "Order By"
	set meuSQL($increment(contador))	= "Dados.CodigoProntuarioEletronic Desc,"
	set meuSQL($increment(contador))	= "Dados.SequenciaLivre, Dados.Sequencia Desc"
	set meuSQL($increment(contador))	= "UNION"
	set meuSQL($increment(contador))	= "SELECT NULL,NULL,DataAgendamento,HoraAgendamento,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'I',"
	set meuSQL($increment(contador))	= "AdmissionID,Status"
	set meuSQL($increment(contador))	= "FROM SQLUser.MEDAdmission WHERE Company = 0"
	set meuSQL($increment(contador))	= "AND Patient = '"_codPaciente_"' AND DataAgendamento = CURRENT_DATE-1"
	set meuSQL($increment(contador))	= "AND Status = 4 AND DateAdmitted IS NULL"
	
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		
		set situacao = $Select(rSet.%Get("Situacao")="":"A",1:rSet.%Get("Situacao"))
		
		set list = {}
		SET list.sequenciaLivre	= rSet.%Get("SequenciaLivre")
		set list.sequencia			= rSet.%Get("Sequencia")
		set list.data 					= $zdate(rSet.%Get("Data"),3)
		set list.hora 					= $ztime(rSet.%Get("Hora"),2)
		set list.peso 					= rSet.%Get("Peso")
		set list.hbHt 					= rSet.%Get("HbHt")
		set list.volumeRetirado = rSet.%Get("VolumeRetirado")
		set list.sF09 					= rSet.%Get("SF09")
		set list.pAPre 					= rSet.%Get("PAPre")
		set list.fCPre 					= rSet.%Get("FCPre")
		set list.temperaturaPre = rSet.%Get("TemperaturaPre")
		set list.pAPos 					= rSet.%Get("PAPos")
		set list.fCPos 					= rSet.%Get("FCPos")
		set list.func 					= rSet.%Get("Func")
		set list.status 				= rSet.%Get("Status")
		set list.situacao 			= situacao
		set list.situacaoDesc 	= $Select(situacao="A":"Ativo",1:"Inativo")
		Set list.codigoProntuarioEletronic = rSet.%Get("codigoProntuarioEletronic")

		set list.medico 				=  $$SQLGetUserName^VARSQL(rSet.%Get("Medico"))

		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmDados">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	
	if (pSequencia = "") {
		set pSequencia = $$GetNextNumber^COMUtils("VARPEPSangriaTerapeuticaDados","")
	}
	
	set objDados = $get(^VARPEPSangriaTerapeuticaDados(YM, pCodProntuario, pSequencia, 1))

	set index = "" 
	for {
		set index = $order(pDados(index)) 
		quit:index=""
		
		set coluna	= $piece(pDados(index),"~",1)
		set valor		= $piece(pDados(index),"~",2)

		if (coluna = "data") {
			If (valor'="") { 
				set pData = $zdh($p(valor," ",3)_" "_$p(valor," ",2)_" "_$p(valor," ",4),2,,,,,,,+$horolog)
			}else{
				set pData = +$horolog
			}
			set $$$VARPEPSangriaTerapeuticaDadosData(objDados) = pData
		}
		if (coluna = "hora") {
			if (valor="") {
				set $$$VARPEPSangriaTerapeuticaDadosHora(objDados) = $piece($horolog,",",2)
			}else{
				set $$$VARPEPSangriaTerapeuticaDadosHora(objDados) = $ztimeh(valor,4,$piece($horolog,",",2))
			}
		}
		if (coluna = "sequenciaLivre") set $$$VARPEPSangriaTerapeuticaDadosSequenciaLivre(objDados) = valor
		if (coluna = "peso") set $$$VARPEPSangriaTerapeuticaDadosPeso(objDados) = valor
		if (coluna = "hbHt") set $$$VARPEPSangriaTerapeuticaDadosHbHt(objDados) = valor
		if (coluna = "volumeRetirado") set $$$VARPEPSangriaTerapeuticaDadosVolumeRetirado(objDados) = valor
		if (coluna = "sF09") set $$$VARPEPSangriaTerapeuticaDadosSF09(objDados) = valor
		if (coluna = "pAPre") {
			set valor = $Replace(valor,"_","") 
			set $$$VARPEPSangriaTerapeuticaDadosPAPre(objDados) = valor
		}
		if (coluna = "fCPre") set $$$VARPEPSangriaTerapeuticaDadosFCPre(objDados) = valor
		if (coluna = "temperaturaPre") set $$$VARPEPSangriaTerapeuticaDadosTemperaturaPre(objDados) = valor
		if (coluna = "pAPos") {
			set valor = $Replace(valor,"_","") 
			set $$$VARPEPSangriaTerapeuticaDadosPAPos(objDados) = valor
		}
		if (coluna = "fCPos") set $$$VARPEPSangriaTerapeuticaDadosFCPos(objDados) = valor
		if (coluna = "situacao") set $$$VARPEPSangriaTerapeuticaDadosSituacao(objDados) = valor
	}
	set $$$VARPEPSangriaTerapeuticaDadosFunc(objDados) = $$SQLGetUserName^VARSQL(YBED)
	if ($$$VARPEPSangriaTerapeuticaDadosData(objDados) = "") {
		set $$$VARPEPSangriaTerapeuticaDadosData(objDados) = +$horolog
	}
	if ($$$VARPEPSangriaTerapeuticaDadosHora(objDados) = "") {
		set $$$VARPEPSangriaTerapeuticaDadosHora(objDados) = $piece($horolog,",",2)
	}		
	quit $$$Save("VARPEPSangriaTerapeuticaDados",pCodProntuario_$$$COMMA_pSequencia,objDados,$$$YES)]]></Implementation>
</Method>

<Method name="ExcluirDados">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	quit $$$Kill("VARPEPSangriaTerapeuticaDados",pCodProntuario_$$$COMMA_pSequencia)]]></Implementation>
</Method>

<Method name="Imprimir">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM = 0 
	set Y  = "~"
	
	set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
	set pTipo 					= $get(%request.Data("pTipo",1))
	set YBED 						= $get(%request.Data("YBED",1))

	if pTipo="T"{	;Termo de Consentimento
		set link=$$Start^VARJasperRun("VARPEPEnfSangTerapTermo")
		set hoje = $zdate($horolog,4)
		set link=$$addUserParameter^VARJasperRun(link,"pDataImpressao","SP "_hoje)
	}else{
		set link=$$Start^VARJasperRun("VARPEPEnfSangTerap")
	}
	set link=$$addUserParameter^VARJasperRun(link,"pCodProntuario",pCodProntuario)
	set link=$$addParameter^VARJasperRun(link,YBED,1)
	do ViewInForm^VARJasperRun(link,"Impressao",2)
	
	Quit $$$OK]]></Implementation>
</Method>

<Method name="NaoCompareceu">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	Set YM = 0
	Set Y = "~"
	
	set obj = $get(^VARPEPSangriaTerapeutica(0, pCodProntuario, 1))
	Set $$$VARPEPSangriaTerapeuticaNaoCompareceu(obj) = 1
	Set strStatus = $$$Save("VARPEPSangriaTerapeutica", pCodProntuario, obj, 1)]]></Implementation>
</Method>

<Method name="GetSTSinaisVitais">
<Description><![CDATA[///////////////////////////////////////////////////////////////////////////////]]></Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	set YM 	= 0
	set Y 	= "~"

	set pCodProntuario = $get(%request.Data("pCodProntuario",1))
	set pAba					 = $get(%request.Data("pAba",1))
	
	set contador = 0
	set meuSQL($increment(contador))	= "Select Sequencia, HoraAfericao, PressaoArterial, Pulso, Temperatura"
	set meuSQL($increment(contador))	= "From SQLUser.VARPEPSangriaTSinaisVitais"
	set meuSQL($increment(contador))	= "Where Company = 0 And CodigoProntuarioEletronic = '"_pCodProntuario_"'"
	
	if pAba="dados" set meuSQL($increment(contador)) = "AND Aba = 'dados'"
	else  set meuSQL($increment(contador)) = "AND (Aba IS NULL OR Aba = 'reacao')"
	
	set meuSQL 			= $order(meuSQL(""),-1)
	set rSet 			 	= ##class(%SQL.Statement).%ExecDirect("",.meuSQL)
	set objRetorno 	= []
	
	while(rSet.%Next()){
		
		set hora = rSet.%Get("HoraAfericao")

		set list = {}
		set list.sequencia				= rSet.%Get("Sequencia")
		set list.hora 						= $ztime(hora,2)
		set list.pressaoArterial 	= rSet.%Get("PressaoArterial")
		set list.pulso 						= rSet.%Get("Pulso")
		set list.temperatura			= rSet.%Get("Temperatura")
		
		do objRetorno.%Push(list)
	
	}
	
	do objRetorno.%ToJSON()
	
	quit $$$OK]]></Implementation>
</Method>

<Method name="ArmTSTSinaisVitais">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"
	
	if (pSequencia = "") {
		set pSequencia = $$GetNextNumber^COMUtils("VARPEPSangriaTSinaisVitais","")
	}
	
	set objContDados = $get(^VARPEPSangriaTSinaisVitais(YM, pCodProntuario, pSequencia, 1))

	set index = "" 
	for {
		set index = $order(pDados(index)) 
		quit:index=""
		
		set coluna	= $piece(pDados(index),"~",1)
		set valor		= $piece(pDados(index),"~",2)

		if (coluna = "hora") {
			set hora = $ztimeh(valor,4,$piece($horolog,",",2))
			set $$$VARPEPSangriaTSinaisVitaisHoraAfericao(objContDados) = hora
		}
		if (coluna = "pressaoArterial") {
			set valor = $Replace(valor,"_","") 
			set $$$VARPEPSangriaTSinaisVitaisPressaoArterial(objContDados) = valor
		}
		if (coluna = "pulso") set $$$VARPEPSangriaTSinaisVitaisPulso(objContDados) = valor
		if (coluna = "temperatura") set $$$VARPEPSangriaTSinaisVitaisTemperatura(objContDados) = valor
		if (coluna = "aba") set $$$VARPEPSangriaTSinaisVitaisAba(objContDados) = valor
	}

	quit $$$Save("VARPEPSangriaTSinaisVitais",pCodProntuario_$$$COMMA_pSequencia,objContDados,$$$YES)]]></Implementation>
</Method>

<Method name="ExcluirSTSinaisVitais">
<ClassMethod>1</ClassMethod>
<FormalSpec>pCodProntuario,pSequencia,pDados,YBED</FormalSpec>
<Implementation><![CDATA[	$$$VAR
	set YM = 0
	set Y	 = "~"

	quit $$$Kill("VARPEPSangriaTSinaisVitais",pCodProntuario_$$$COMMA_pSequencia)]]></Implementation>
</Method>

<Method name="historicoReacao">
<Description><![CDATA[///////////////////////////////////////////////////////////////////////////////]]></Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	Set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)

	Set arrayRetorno 	= []

	Set meuSQL = "Select Pront.*, Sang.* From SQLUser.VARProntuarioEletronico As Pront, "
	Set meuSQL = meuSQL _ "SQLUser.VARPEPSangriaTerapeutica As Sang "
	Set meuSQL = meuSQL _ "Where Pront.Company = 0 And Sang.Company = 0 "
	Set meuSQL = meuSQL _ "And Pront.Paciente = '"_codPaciente_"' "
	Set meuSQL = meuSQL _ "And Sang.CodigoProntuarioEletronic = Pront.Codigo "
	Set meuSQL = meuSQL _ "Order By Pront.CriadoEm Desc "
	Set rSet 	 = ##class(%SQL.Statement).%ExecDirect("",meuSQL)
	
	While(rSet.%Next()){
		Set list = {}
		Set list.admissao = rSet.%Get("Codigo")
		Set list.dataHora = $ZDateTime(rSet.%Get("CriadoEm"),4,2)

		Set list.ssPulso = rSet.%Get("ReacaoSinSintPulso")
		Set list.ssPressaoArterial = $Extract(rSet.%Get("ReacaoSinSintPA"),1,3)_"/"_$Extract(rSet.%Get("ReacaoSinSintPA"),4,6)
		Set list.ssFebre = $Select(rSet.%Get("ReacaoSinSintFebre")=1:"Sim",1:"Não")
		Set list.ssVomito = $Select(rSet.%Get("ReacaoSinSintVomito")=1:"Sim",1:"Não")
		Set list.ssDorTorax = $Select(rSet.%Get("ReacaoSinSintDornoTorax")=1:"Sim",1:"Não")
		Set list.ssSangramentos = $Select(rSet.%Get("ReacaoSinSintSangramentos")=1:"Sim",1:"Não")
		Set list.ssCalafrios = $Select(rSet.%Get("ReacaoSinSintCalafrios")=1:"Sim",1:"Não")
		Set list.ssCianose = $Select(rSet.%Get("ReacaoSinSintCianose")=1:"Sim",1:"Não")
		Set list.ssUrticaria = $Select(rSet.%Get("ReacaoSinSintUrticaria")=1:"Sim",1:"Não")
		Set list.ssUrinaEscura = $Select(rSet.%Get("ReacaoSinSintUrinaEscura")=1:"Sim",1:"Não")
		Set list.ssDispneia = $Select(rSet.%Get("ReacaoSinSintDispneia")=1:"Sim",1:"Não")
		Set list.ssDorLombar = $Select(rSet.%Get("ReacaoSinSintDorLombar")=1:"Sim",1:"Não")
		Set list.ssEritema = $Select(rSet.%Get("ReacaoSinSintEritema")=1:"Sim",1:"Não")
		Set list.ssVolUrinario = $Select(rSet.%Get("ReacaoSinSintMenosVolUrinario")=1:"Sim",1:"Não")
		Set list.ssTremor = $Select(rSet.%Get("ReacaoSinSintTremor")=1:"Sim",1:"Não")
		Set list.ssDorCabeca = $Select(rSet.%Get("ReacaoSinSintDordeCabeca")=1:"Sim",1:"Não")
		Set list.ssPrurido = $Select(rSet.%Get("ReacaoSinSintPrurido")=1:"Sim",1:"Não")
		Set list.ssOutros = $Select(rSet.%Get("ReacaoSinSintOutros")=1:"Sim",1:"Não")
		Set list.ssDescricao = rSet.%Get("ReacaoSinSintOutrosDescricao")
		Set list.iQDFlebotomia = $Select(rSet.%Get("SSIncidenteNomomentodaf")=1:"Sim",1:"Não")
		Set list.iQDPosteriormente = $Select(rSet.%Get("SSIncidentePosteriormen")=1:"Sim",1:"Não")
		Set list.iQDData = $Select(rSet.%Get("SSIncidentePostData")="":"",1:$ZDate(rSet.%Get("SSIncidentePostData"),4))
		Set list.iHematoma = $Select(rSet.%Get("SSIncidenteHematoma")=1:"Sim",1:"Não")
		Set list.iHematomaDesc = rSet.%Get("SSIncidenteHematomaDesc")
		Set list.iDorExessiva = $Select(rSet.%Get("SSIncidenteDorexcessiva")=1:"Sim",1:"Não")
		Set list.iDorLocBraco = $Select(rSet.%Get("SSIncDorOutLocBra")=1:"Sim",1:"Não")
		Set list.iDorLocBracoDesc = rSet.%Get("SSIncDorOutLocBraDesc")
		Set list.iAdormecimento = $Select(rSet.%Get("SSIncidenteAdormeciment")=1:"Sim",1:"Não")
		Set list.iChoques = $Select(rSet.%Get("SSIncidenteChoques")=1:"Sim",1:"Não")
		Set list.iHiperemia = $Select(rSet.%Get("SSIncidenteHiperemia")=1:"Sim",1:"Não")
		Set list.iHiperemiaDesc = rSet.%Get("SSIncidenteHiperemiaDes")
		Set list.iPuncaoArterial = $Select(rSet.%Get("SSIncidentePossivelpunc")=1:"Sim",1:"Não")
		Set list.iInfiltracao = $Select(rSet.%Get("SSIncidenteInfiltracao")=1:"Sim",1:"Não")
		Set list.iInfiltracaoDesc = rSet.%Get("SSIncidenteInfiltracaoD")
		Set list.iQueda = $Select(rSet.%Get("SSIncidenteQueda")=1:"Sim",1:"Não")
		Set list.iNenhumaLesao = $Select(rSet.%Get("SSIncidenteNenhumalesao")=1:"Sim",1:"Não")
		Set list.iPossivelLesao = $Select(rSet.%Get("SSIncPossivelLesao")=1:"Sim",1:"Não")
		Set list.iPossivelLesaoDesc = rSet.%Get("SSIncPossivelLesaoDesc")
		Set list.descricaoIncidente = rSet.%Get("SSDescricaodoIncidente")
		Set list.condutaTratamento = rSet.%Get("SSConduta")
		Set list.conclusao = rSet.%Get("SSConclusao")
		;
		Do arrayRetorno.%Push(list)
	}
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>

<Method name="historicoDadosVitais">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	$$$VAR
	Set YM 	= 0
	Set Y 	= "~"

	Set pCodProntuario 	= $Get(%request.Data("pCodProntuario",1))
	Set objProntuario 	= $get(^VARProntuarioEletronico(YM, pCodProntuario, 1))	
	Set codPaciente 		= $$$VARProntuarioEletronicoPaciente(objProntuario)

	Set arrayRetorno 	= []

	Set sql = "SELECT P.NumeroAdmisao,P.CriadoEm,S.* "
					_ "FROM SQLUser.VARProntuarioEletronico AS P "
					_ "INNER JOIN SQLUser.VARPEPSangriaTerapeutica AS S ON S.CodigoProntuarioEletronic = P.Codigo "
					_ "WHERE S.Company = 0 AND P.Company = 0 AND P.Paciente = '"_codPaciente_"' "
					_ "ORDER BY P.CriadoEm DESC"
	
	Set rSet 	 = ##class(%SQL.Statement).%ExecDirect("",sql)
	
	While(rSet.%Next()){
		Set list = {}
		Set list.admissao = rSet.%Get("NumeroAdmisao")
		Set list.dataHora = $ZDateTime(rSet.%Get("CriadoEm"),4,2)
		
		Set list.diagnostico = rSet.%Get("Diagnostico")
		Set list.medicacoes = rSet.%Get("Medicacoes")
		Set list.orientacoesReacoesAlertas = rSet.%Get("OrientacoesReacoesAlertas")
		Set list.alergia = rSet.%Get("Alergia")

		Do arrayRetorno.%Push(list)
	}
	
	Do arrayRetorno.%ToJSON()
	Return $$$OK]]></Implementation>
</Method>
</Class>
</Export>