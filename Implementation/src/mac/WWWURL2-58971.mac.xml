<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWURL2" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWURL2 ;WWWURL2;FAN;URLAUBSERFASSUNG;21.08.02
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		URLAUBSERFASSUNG
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| 02-Sep-2005	JW		SR12966: WWW013 is shared
	;| FAN	21.08.02
	;|
	;\------------------------------------------------------------------/
	;
	NEW MIT,DATE,JAHR
	SET MIT=$GET(VORG(1))    ;MITARBEITER
	SET VORG(2)=$GET(VORG(2))    ;URLAUB VON      2 ;holiday 
	SET VORG(3)=$GET(VORG(3))    ;URLAUB BIS ;holiday until 
	SET VORG(4)=$GET(VORG(4))    ;KRANK VON       3 ;sick 
	SET VORG(5)=$GET(VORG(5))    ;KRANK VON ;sick 
	SET VORG(6)=$GET(VORG(6))    ;ABWESEND VON    1 ;absent 
	SET VORG(7)=$GET(VORG(7))    ;ABWESEND VON ;absent 
	SET VORG(8)=$GET(VORG(8))    ;LÖSCHEN VON  ;Delete 
	SET VORG(9)=$GET(VORG(9))    ;LÖSCHEN BIS ;Delete until 
	SET VORG(10)=$GET(VORG(10))  ;HALBER URLAUBSTAG ;on account of 
	SET JAHR=+$H                 ;EINTRAG DATEN
	SET $PIECE(^WWW122(0,"WWWURL2",1,1),Y,15)=""            ;FELD VORGABE AUF "" SETZEN  ; SEHEN START^WWWURL2
	IF VORG(1)="" DO ^WWWINFO($$^WWWTEXT(32942))  QUIT     ;NICHT BEARBEITET! BITTE PRÜFEN SIE IHRE EINGABEN ;Not please sift they their 
	IF VORG(2)="" IF VORG(3)="" IF VORG(4)="" IF VORG(5)="" IF VORG(6)="" IF VORG(7)="" IF VORG(8)="" IF VORG(9)="" DO ^WWWINFO($$^WWWTEXT(32942))  QUIT
	IF VORG(2)'="" IF VORG(3)'="" IF VORG(3)<VORG(2) DO ^WWWINFO($$^WWWTEXT(32942))  QUIT
	IF VORG(4)'="" IF VORG(5)'="" IF VORG(5)<VORG(4) DO ^WWWINFO($$^WWWTEXT(32942))  QUIT
	IF VORG(6)'="" IF VORG(7)'="" IF VORG(7)<VORG(6) DO ^WWWINFO($$^WWWTEXT(32942))  QUIT
	IF VORG(8)'="" IF VORG(9)'="" IF VORG(9)<VORG(8) DO ^WWWINFO($$^WWWTEXT(32942))  QUIT
	IF VORG(2)'="" IF VORG(3)'="" IF VORG(2)'=VORG(3) IF VORG(10)=1 DO ^WWWINFO($$^WWWTEXT(32942))  QUIT
	IF VORG(2)'="" SET JAHR=VORG(2) IF VORG(3)="" IF $$^WWWDAY(VORG(2))<6 SET $PIECE(^TERMIN(YM,MIT,VORG(2),0,1),Y,1)=2
	IF VORG(3)'="" SET JAHR=VORG(3) IF VORG(2)="" IF $$^WWWDAY(VORG(3))<6 SET $PIECE(^TERMIN(YM,MIT,VORG(3),0,1),Y,1)=2
	IF VORG(4)'="" SET JAHR=VORG(4) IF VORG(5)="" IF $$^WWWDAY(VORG(4))<6 SET $PIECE(^TERMIN(YM,MIT,VORG(4),0,1),Y,1)=3
	IF VORG(5)'="" SET JAHR=VORG(5) IF VORG(4)="" IF $$^WWWDAY(VORG(5))<6 SET $PIECE(^TERMIN(YM,MIT,VORG(5),0,1),Y,1)=3
	IF VORG(6)'="" SET JAHR=VORG(6) IF VORG(7)="" IF $$^WWWDAY(VORG(6))<6 SET $PIECE(^TERMIN(YM,MIT,VORG(6),0,1),Y,1)=1
	IF VORG(7)'="" SET JAHR=VORG(7) IF VORG(6)="" IF $$^WWWDAY(VORG(7))<6 SET $PIECE(^TERMIN(YM,MIT,VORG(7),0,1),Y,1)=1
	IF VORG(8)'="" SET JAHR=VORG(8) IF VORG(9)="" KILL ^TERMIN(YM,MIT,VORG(8),0,1)
	IF VORG(9)'="" SET JAHR=VORG(9) IF VORG(8)="" KILL ^TERMIN(YM,MIT,VORG(9),0,1) 
	IF VORG(2)'="" IF VORG(3)'="" IF +VORG(10)=0 DO
	. FOR DATE=VORG(2):1 QUIT:DATE>VORG(3)  DO 
	. . ;Q:$$^WWWDAY(DATE)>5
	. . QUIT:$$^WWWCALDAY(DATE,$PIECE($GET(^WWW013(0,MIT,1)),Y,120),1)'=0  ;25452;30.03.04;FIS;KEIN ARBEITSTAG
	. . SET $PIECE(^TERMIN(YM,MIT,DATE,0,1),Y,1)=2  ;URLAUB ;holiday 
	. . QUIT
	. QUIT
	;ULM 26.11.2002
	IF VORG(2)'=""!(VORG(2)=VORG(3)) IF VORG(10)=1 DO
	. QUIT:$$^WWWCALDAY(VORG(2),$PIECE($GET(^WWW013(0,MIT,1)),Y,120),1)'=0  ;25452;30.03.04;FIS;KEIN ARBEITSTAG
	. SET $PIECE(^TERMIN(YM,MIT,VORG(2),0,1),Y,1)=4  ;HALBER URLAUBSTAG ;on account of 
	. QUIT
	IF VORG(4)'="" IF VORG(5)'="" DO
	. FOR DATE=VORG(4):1 QUIT:DATE>VORG(5)  DO  ;KRANK ;sick 
	. . ;QUIT:$$^WWWDAY(DATE)>5 
	. . QUIT:$$^WWWCALDAY(DATE,$PIECE($GET(^WWW013(0,MIT,1)),Y,120),1)'=0  ;25452;30.03.04;FIS;KEIN ARBEITSTAG
	. . SET $PIECE(^TERMIN(YM,MIT,DATE,0,1),Y,1)=3
	. . QUIT
	. QUIT
	IF VORG(6)'="" IF VORG(7)'="" DO
	. FOR DATE=VORG(6):1 QUIT:DATE>VORG(7)  DO  ;AUSSER HAUS ;household 
	. . ;Q:$$^WWWDAY(DATE)>5 
	. . QUIT:$$^WWWCALDAY(DATE,$PIECE($GET(^WWW013(0,MIT,1)),Y,120),1)'=0  ;25452;30.03.04;FIS;KEIN ARBEITSTAG
	. . SET $PIECE(^TERMIN(YM,MIT,DATE,0,1),Y,1)=1
	. . QUIT
	. QUIT
	IF VORG(8)'="" IF VORG(9)'="" DO
	. FOR DATE=VORG(8):1 QUIT:DATE>VORG(9)  DO 
	. . KILL ^TERMIN(YM,MIT,DATE,0,1)
	. . QUIT
	. QUIT
	DO
	. NEW VORG           ;VORG VON FORMULAR WWWURL ;form 
	. SET %(YQUERY,"YKEY")=MIT
	. SET %(YQUERY,"MITARB")=MIT
	. SET %(YQUERY,"RUECK")="WWWURL2"   ;=BACK=HISTORYBACK
	. SET $PIECE(^WWWUSER(0,YUSER,1),Y,11)=JAHR    ;FAN; 21.05.03;23397;
	. DO ^WWWURL
	. QUIT
	QUIT
	
START
	; AUFRUF VON MITARBEITERSTAMM BUTTON  ;FAN;16.03.04;25225
	NEW YFORM
	IF YKEY'=""  S $P(^WWW122(0,"WWWURL2",1,1),Y,15)=YKEY            ;FELD VORGABE ;field default 
	SET %("VAR","YFORM")="WWWURL2"
	DO ^WWWFORM
	QUIT
]]></Routine>
</Export>