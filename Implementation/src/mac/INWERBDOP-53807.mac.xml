<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INWERBDOP" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INWERBDOP ;INWERBDOP;FIS;Prüfen nach doppelten Anschriften;08.01.2001
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		Prüfen nach doppelten Anschriften
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FIS	08.01.2001
	;|
	;\------------------------------------------------------------------/
	;
	NEW PLZ,ORT,YFELD,YFELD1,STR,BEZ,ADR,NAME,NAME1,YKEY
	QUIT:YINHALT=""
	SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"D",1))
	IF $PIECE(YFELD,Y,8)="" SET $PIECE(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"D",1),Y,8)=$P(YFELD,Y,4)
	SET YKEY=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"P",1))
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"D",1)=YFELD
	SET ORT=$$^WWWUMLAU($PIECE(YFELD,Y,16),1)
	SET:ORT="" ORT=" "
	SET PLZ=$PIECE(YFELD,Y,12)
	SET:PLZ="" PLZ=" "
	SET STR=$$^WWWUMLAU($PIECE(YFELD,Y,10),1)
	SET:STR="" STR=" "
	SET BEZ=$$^WWWUMLAU($PIECE(YFELD,Y,8),1)
	QUIT:BEZ=""
	IF ORT=" " QUIT
	SET YQ=0
	IF BEZ'=" " IF $DATA(^INKUNDEs(YM,1,BEZ)) DO
	. IF ORT'=" " IF $DATA(^INKUNDEs(YM,3,ORT)) DO
	. . SET KUNDE="" FOR  SET KUNDE=$ORDER(^INKUNDEs(YM,1,BEZ,KUNDE)) QUIT:KUNDE=""  IF '$FIND(YKEY,KUNDE) QUIT:$$^WWWUMLAU($PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,16),1)=ORT
	. . QUIT:KUNDE=""
	. . ;IF STR'=$$^WWWUMLAU($PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,10)) QUIT  ;NICHT GLEICH
	. . SET ADR1=KUNDE_" "_$PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,8)_", "_$PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,16)
	. . QUIT:ADR1=""
	. . IF $PIECE($GET(^INVORG(YM,YM,1)),Y,131)=1 SET %TXT(1)="!"_$$^WWWTEXT(32207,,1)_$CHAR(13)_"("_ADR1_" )"  ;DOPPELTER
	. . SET YQ=1
	. . QUIT
	. QUIT
	I YFORM="INLIEF" IF BEZ'=" " IF $DATA(^INLIEFs(YM,1,BEZ)) DO
	. IF ORT'=" " IF $DATA(^INLIEFs(YM,3,ORT)) DO
	. . SET KUNDE="" FOR  SET KUNDE=$ORDER(^INLIEFs(YM,1,BEZ,KUNDE)) QUIT:KUNDE=""  IF '$FIND(YKEY,KUNDE) QUIT:$$^WWWUMLAU($PIECE($GET(^INLIEF(YM,KUNDE,1)),Y,16),1)=ORT
	. . QUIT:KUNDE=""
	. . ;IF STR'=$$^WWWUMLAU($PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,10)) QUIT  ;NICHT GLEICH
	. . SET ADR1=KUNDE_" "_$PIECE($GET(^INLIEF(YM,KUNDE,1)),Y,8)_", "_$PIECE($GET(^INLIEF(YM,KUNDE,1)),Y,16)
	. . QUIT:ADR1=""
	. . IF $PIECE($GET(^INVORG(YM,YM,1)),Y,131)=1 SET %TXT(1)="!"_$$^WWWTEXT(32796,,1)_$CHAR(13)_"("_ADR1_" )"  ;DOPPELTER
	. . SET YQ=1
	. . QUIT
	. QUIT
	IF YFORM="INWERBADR" IF $PIECE($GET(^INVORG(YM,YM,1)),Y,131)=1 IF $DATA(^INWERBADRs(YM,6,PLZ,STR,BEZ)) DO
	. SET ADR=$ORDER(^INWERBADRs(YM,6,PLZ,STR,BEZ,""))
	. QUIT:ADR=""
	. IF ADR=YKEY SET ADR=$ORDER(^INWERBADRs(YM,6,PLZ,STR,BEZ,ADR))
	. QUIT:ADR=""
	. SET NAME=$PIECE($GET(^INWERBADR(YM,ADR,1)),Y,8)
	. SET %TXT(1)="!"_$$^WWWTEXT(32204,,1)_$CHAR(13)_"("_ADR_" "_NAME_$PIECE($GET(^INWERBADR(YM,ADR,1)),Y,16)_")"
	. IF YQ=1 SET %TXT(1)="!"_$$^WWWTEXT(32207,,1)_$CHAR(13)_"("_ADR1_" "_NAME1_")"_$CHAR(13)_" "_"&"_" "_$$^WWWTEXT(32204,,1)_$CHAR(13)_"("_ADR_" "_NAME_", "_$PIECE($GET(^INWERBADR(YM,ADR,1)),Y,16)_")"
	. QUIT
	QUIT
]]></Routine>
</Export>