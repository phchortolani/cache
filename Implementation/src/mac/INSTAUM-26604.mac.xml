<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INSTAUM" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INSTAUM        ;INSTAUM;FAN-FIS;ERSTELLEN UND DRUCKEN VON UMSATZLISTEN;15.01.2001  ; Compiled March 3, 2005 16:55:59
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		ERSTELLEN UND DRUCKEN VON UMSATZLISTEN
	;
	; Inputs : 
	;
	;
	; ByRef :
	;	VORG(1)=YEAR
	;	VORG(2)=SALESTYPE
	;	VORG(3)=LOCATION
	;	VORG(4)=1=GRAPHIC
	;	VORG(5)=FROM
	;	VORG(6)=TO
	;	VORG(7)=1 = LAST 13 MONTH ;charge 
	;	VORG(8)=FROM ITEM/ARTIKEL SUBSELECTION
	;	VORG(9)=BIS ITEM/ARTIKEL  SUBSELECTION
	;
	; Returns :
	;
	;
	; History :
	; 07-Jun-2010	GRF		SR17146: call "DD.MM.YYYY" wrapper for WWWDATE1
	; 23-APR-2005	TYBD	CHANGE IN LABEL SORTGG; QUIT IF NO CUSTOMER NO IN CUSTOMER ORDER
	; 15.01.2001	FAN-FIS
	;-------------------------------------------------------------------------------
	;
	;PARAMETERÜBERGABE AUS BENUTZERMENÜ: KU = SORTKU = SORTIEREN UMSATZ NACH KUNDEN ;out of assortment volume of trade within 
	;                                    GU = SORTGU = SORTIEREN UMSATZ NACH GEBIET
	;                                    LU = SORTLU = SORTIEREN UMSATZ NACH LIEFERANTEN
	;                                    AU = SORTAU = SORTIEREN UMSATZ NACH ARTIKEL
	;                                    WU = SORTWU = SORTIEREN UMSATZ NACH WARENGRUPPEN
	;UMSATZLISTEN WERDEN IN SORTX (S.O.) VORSORTIERT UND IN WWWSOR ZWISCHENGESPEICHERT. IM DRUCK-LABEL WERDEN ;will within And within will 
	;DIE DATENSÄTZE NEU GELESEN UND IN TABELLE ODER GRAPH GEDRUCKT. ;who recent And within tabulation Or 
	;ACHTUNG;-------->AUFRUF AUCH DURCH BUTTON VON KUNDESTAMMEM:^INKUNDESTAT      ;26071;FAN;15.07.04 ;NOKOPF=1      
	NEW SORTX,YVON,YBIS,ABGE,YVAR,NAME,UMSATZ,UMSATZ1,LFN,ZAHL,ZAHL1,YAUSW1,YAUSW2,UMSATZA
	NEW UES,YI,YZ,SUMME,YFELD,YMONATE,YSUM,YSUM1,SUBSELECT,SUBFROM,SUBTO,SPALTEN
	
	WRITE "<FONT FACE=ARIAL>"
	WRITE "<FONT SIZE=1>"
	
	DO ^WWWBACK
	SET VORG(2)=$GET(VORG(2))  ;VORGABE UMSATZART ;default 
	SET VORG(4)=$GET(VORG(4))
	SET VORG(5)=$GET(VORG(5))
	SET VORG(6)=$GET(VORG(6))
	SET VORG(7)=$GET(VORG(7))
	SET VORG(8)=$GET(VORG(8))
	SET VORG(9)=$GET(VORG(9))
	;
	NEW VMON,BMON,RMON,YVON1,YBIS1
	SET VORG(1)=$GET(VORG(1))  ;VORGABE JAHR ;default year 
	IF VORG(1)="" SET VORG(1)=$$^WWWYEAR($HOROLOG)  ;DIESES JAHR ;this year 
	
	;ET YVON = $$^WWWDATE1("01.01."_VORG(1))
	;ET YBIS = $$^WWWDATE1("31.12."_VORG(1))
	SET YVON = $$DMY^WWWDATE1("01.01."_VORG(1))
	SET YBIS = $$DMY^WWWDATE1("31.12."_VORG(1))
	
	SET VMON = 1              ;VON MONAT ;month 
	SET BMON = 12             ;BIS MONAT ;until month 
	
	;IF VORG(7)=1 DO                                   ;13 MONATE                    ; SR17146
	;. SET VORG(1) = $$^WWWYEAR($HOROLOG)              ;DIESES JAHR ;this year 
	;. SET YVON    = $$^WWWDATE1("01.01."_VORG(1))     ;AKTUELLES JAHR ;year 
	;. SET YBIS    = $$^WWWDATE1("31.12."_VORG(1))     ;AKTUELLES JAHR ;year 
	;. SET YVON1   = $$^WWWDATE1("01.01."_(VORG(1)-1)) ;EIN jAHR ZURÜCK ;uni- back 
	;. SET YBIS1   = $$^WWWDATE1("31.12."_(VORG(1)-1)) ;EIN jAHR ZURÜCK ;uni- back 
	;. SET VMON    = $$^WWWMONTH(+$HOROLOG)            ;VOM AKTUELLEN MONAT ;month 
	;. SET BMON    = VMON+12                           ;BIS 12 MONATE ZURÜCK (13 MONATE) ;until back 
	
	IF VORG(7)=1 DO                                      ;13 MONATE
	. SET VORG(1) = $$^WWWYEAR($HOROLOG)                 ;DIESES JAHR ;this year 
	. SET YVON    = $$DMY^WWWDATE1("01.01."_VORG(1))     ;AKTUELLES JAHR ;year 
	. SET YBIS    = $$DMY^WWWDATE1("31.12."_VORG(1))     ;AKTUELLES JAHR ;year 
	. SET YVON1   = $$DMY^WWWDATE1("01.01."_(VORG(1)-1)) ;EIN jAHR ZURÜCK ;uni- back 
	. SET YBIS1   = $$DMY^WWWDATE1("31.12."_(VORG(1)-1)) ;EIN jAHR ZURÜCK ;uni- back 
	. SET VMON    = $$^WWWMONTH(+$HOROLOG)               ;VOM AKTUELLEN MONAT ;month 
	. SET BMON    = VMON+12                              ;BIS 12 MONATE ZURÜCK (13 MONATE) ;until back 
	
	SET SUBSELECT=""
	SET SUBFROM=""
	SET SUBTO=""
	SET SPALTEN=0  ;ANZAHL TABELLENSPALTEN ;Number 
	
	KILL ^WWWSOR(YUSER)  ;LÖSCHEN ZWISCHENDATEI ;Delete 
	
	SET SORTX="SORT"_$GET(YPARA)  ;AUSWAHL SORT-LABEL ;Selection 
	IF $GET(YPARA)'="" DO @SORTX
	
	DO DRUCK   ;WERTE DRUCKEN ;print 
	IF $GET(NOKOPF)'=1 DO LEER^WWWTAB(15,SPALTEN)
	IF YOPTION'=2 IF $GET(NOKOPF)'=1 DO GESAMT  ;SUMMENZEILE
	
	DO STOP^WWWTAB  ;ENDE TABELLE ;termination tabulation 
	KILL ^WWWSOR(YUSER)  ;LÖSCHEN ZWISCHENDATEI ;Delete 
	
	QUIT
	
	
SORTKU   ;VORSORTIERUNG KUNDEN
	;
	;
	;
	;SET YVAR="" FOR  SET YVAR=$ORDER(^INAUFs(YM,1,YVAR)) QUIT:YVAR=""  DO
	;QUIT:$TRANSLATE(YVAR," "_"""")=""  ;KEIN KUNDE  ;DEAKTIVIERT DA VIELLEICHT KUNDE ABER NICHT AUFTRAG GELÖSCHT WURDE
	;
	;ULM: ÄNDERUNG VOM 01.07.02 - ZUSÄTZLICHE SUCHE NACH KUNDEN ;alteration search within 
	;BEC: ÄNDERUNG VERLAUF LETZTEN 12 MONATE EINGEBAUT 11.02.03 ;alteration trend in-built 
	;BEC: ÄNDERUNG SUBSELECT 12.02.03 ;alteration 
	NEW UMSATZ1
	
	SET YVAR=""
	
	SET SUBFROM=VORG(8)
	SET SUBTO=VORG(9)
	IF SUBFROM'="" SET SUBSELECT=1
	IF SUBTO'="" SET SUBSELECT=1
	
	IF VORG(5)'="" SET YVAR=$ORDER(^INAUFs(YM,1,VORG(5)),-1)  ;FINDEN DES STARTPUNKTES KUNDE ;find customer 
	FOR  SET YVAR=$ORDER(^INAUFs(YM,1,YVAR)) QUIT:YVAR=""  DO  IF VORG(6)'="" QUIT:YVAR]]VORG(6)  ;
	. IF VORG(6)'="" QUIT:YVAR]]VORG(6)  ;DAMIT KEIN WERT ANGEZEIGT WIRD, WENN NICHTS VORHANDEN IST
	. QUIT:YVAR=" " 
	. SET YDATE=YVON-1
	. FOR  SET YDATE=$ORDER(^INAUFs(YM,1,YVAR,YDATE)) QUIT:YDATE=""  QUIT:YDATE>YBIS  DO  QUIT  ;VON BIS DATUM ;until Date 
	. . SET UMSATZ=$$^INUMS(YVON,YBIS,0,YVAR,+$GET(VORG(2)),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO)  ;SUCHEN KUNDENUMSATZ (AKTUELLES JAHR) ;seek 
	. . IF $PIECE(UMSATZ,",",12)="" SET $PIECE(UMSATZ,",",12)=""  ;FÜR AUSRICHTUNG  ;to 
	. . IF VORG(7)=1 SET UMSATZ=",,,,,,,,,,,,"_UMSATZ     ;SUCHEN KUNDENUMSATZ VORJAHR/AKTUELL JAHR ;seek year 
	. . QUIT:$TRANSLATE(UMSATZ,",.0")=""  ;KEIN UMSATZ ;no volume of trade 
	. . SET NAME=""
	. . SET NAME=$PIECE($GET(^INKUNDE(YM,YVAR,1)),Y,8)
	. . IF NAME="" SET NAME=" "
	. . SET UMSATZ1=$GET(^WWWSOR(YUSER,NAME,YVAR))
	. . FOR YI=1:1:24 QUIT:$PIECE(UMSATZ,",",YI,99)=""  SET $PIECE(UMSATZ1,",",YI)=$PIECE(UMSATZ1,",",YI)+$PIECE(UMSATZ,",",YI)
	. . SET ^WWWSOR(YUSER,NAME,YVAR)=UMSATZ1
	. ;
	. IF VORG(7)=1 DO
	. . SET YDATE=YVON1-1
	. . FOR  SET YDATE=$ORDER(^INAUFs(YM,1,YVAR,YDATE)) QUIT:YDATE=""  QUIT:YDATE>YBIS1  DO  QUIT  ;VON BIS DATUM ;until Date 
	. . . SET UMSATZA=$$^INUMS(YVON1,YBIS1,0,YVAR,+$GET(VORG(2)),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO) ;VORJAHR
	. . . IF $PIECE(UMSATZA,",",12)="" SET $PIECE(UMSATZA,",",12)=""
	. . . SET UMSATZ=UMSATZA_",,,,,,,,,,,,"                   ;SUCHEN KUNDENUMSATZ VORJAHR/AKTUELL JAHR ;seek year 
	. . . QUIT:$TRANSLATE(UMSATZ,",.0")=""  ;KEIN UMSATZ ;no volume of trade 
	. . . SET NAME=""
	. . . SET NAME=$PIECE($GET(^INKUNDE(YM,YVAR,1)),Y,8)
	. . . IF NAME="" SET NAME=" "
	. . . SET UMSATZ1=$GET(^WWWSOR(YUSER,NAME,YVAR))
	. . . FOR YI=1:1:24 QUIT:$PIECE(UMSATZ,",",YI,99)=""  SET $PIECE(UMSATZ1,",",YI)=$PIECE(UMSATZ1,",",YI)+$PIECE(UMSATZ,",",YI)
	. . . SET ^WWWSOR(YUSER,NAME,YVAR)=UMSATZ1
	
	SET YAUSW1="K"
	SET YAUSW2="INKUNDE"
	
	;ÜBERSCHRIFT BEARBEITEN ;superscription 
	SET UES(1)=$$^WWWTEXT(31403)_Y_$$^WWWTEXT(31505)
	SET YMONATE=$$^WWWTEXT(30024,,1)
	SET YMONATE=YMONATE_","_YMONATE
	FOR YI=VMON:1:BMON SET UES(1)=UES(1)_Y_$PIECE(YMONATE,",",YI)  ;MONATE
	SET UES(1)=UES(1)_Y_$$^WWWTEXT(32059)
	
	QUIT
	
	
SORTGU   ;VORSORTIERUNG GEBIETE
	;BEC: ÄNDERUNG VERLAUF LETZTEN 12 MONATE EINGEBAUT 12.02.03 ;alteration trend in-built 
	SET YKUNDE=""
	FOR  SET YKUNDE=$ORDER(^INAUFs(YM,1,YKUNDE)) QUIT:YKUNDE=""  DO  
	. QUIT:$TRANSLATE(YKUNDE," "_"""")=""  ;KEIN KUNDE ;no customer 
	. SET YDATE=YVON-1
	. FOR  SET YDATE=$ORDER(^INAUFs(YM,1,YKUNDE,YDATE)) QUIT:YDATE=""  QUIT:YDATE>YBIS  DO  QUIT  ;VON BIS DATUM ;until Date 
	. . SET YVAR=$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,18)  ;GEBIET ;zone 
	. . ;
	. . ;ULM, 01.07.02 VON BIS GEBIET
	. . IF (VORG(5)'="") || (VORG(6))'="" QUIT:YVAR=""
	. . IF VORG(5)'="" QUIT:VORG(5)]]YVAR  ;GEBIET ZU KLEIN ;zone within wee 
	. . IF VORG(6)'="" QUIT:YVAR]]VORG(6)  ;GEBIET ZU GROSS ;zone within 
	. . DO
	. . . SET NAME=$PIECE($GET(^INPARA(YM,"REGION",SPRACHE,YVAR,1)),Y,1)
	. . . IF NAME="" SET NAME=" "
	. . . SET UMSATZ=$$^INUMS(YVON,YBIS,0,YKUNDE,+VORG(2),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO)  ;SUCHEN UMSATZ DES KUNDEN ;seek volume of trade 
	. . . QUIT:$TRANSLATE(UMSATZ,",;.0 "_"""")=""  ;KEINE WERTE
	. . . IF $PIECE(UMSATZ,",",12)="" SET $PIECE(UMSATZ,",",12)=""  ;FÜR AUSRICHTUNG ;to 
	. . . IF VORG(7)=1 SET UMSATZ=",,,,,,,,,,,,"_UMSATZ 
	. . . SET UMSATZ1=$GET(^WWWSOR(YUSER,NAME,YVAR))
	. . . FOR YI=1:1:24 QUIT:$PIECE(UMSATZ,",",YI,99)=""  SET $PIECE(UMSATZ1,",",YI)=$PIECE(UMSATZ1,",",YI)+$PIECE(UMSATZ,",",YI)
	. . . SET ^WWWSOR(YUSER,NAME,YVAR)=UMSATZ1
	. ;
	. IF VORG(7)=1 DO
	. . SET YDATE=YVON1-1
	. . FOR  SET YDATE=$ORDER(^INAUFs(YM,1,YKUNDE,YDATE)) QUIT:YDATE=""  QUIT:YDATE>YBIS1  DO  QUIT  ;VON BIS DATUM ;until Date 
	. . . SET YVAR=$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,18)  ;GEBIET ;zone 
	. . . ;
	. . . ;ULM, 01.07.02 VON BIS GEBIET
	. . . IF (VORG(5)'="") || (VORG(6))'="" QUIT:YVAR=""
	. . . IF VORG(5)'="" QUIT:VORG(5)]]YVAR  ;GEBIET ZU KLEIN ;zone within wee 
	. . . IF VORG(6)'="" QUIT:YVAR]]VORG(6)  ;GEBIET ZU GROSS ;zone within 
	. . . DO
	. . . . SET NAME=$PIECE($GET(^INPARA(YM,"REGION",SPRACHE,YVAR,1)),Y,1)
	. . . . IF NAME="" SET NAME=" "
	. . . . SET UMSATZA=$$^INUMS(YVON1,YBIS1,0,YKUNDE,+VORG(2),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO)  ;SUCHEN UMSATZ DES KUNDEN VOR EINEM JAHR ;seek volume of trade pre- year 
	. . . . IF $PIECE(UMSATZA,",",12)="" SET $PIECE(UMSATZA,",",12)=""
	. . . . SET UMSATZ=UMSATZA_",,,,,,,,,,,,"                  ;SUCHEN KUNDENUMSATZ VORJAHR/AKTUELL JAHR ;seek year 
	. . . . QUIT:$TRANSLATE(UMSATZ,",;.0 "_"""")=""  ;KEINE WERTE
	. . . . SET UMSATZ1=$GET(^WWWSOR(YUSER,NAME,YVAR))
	. . . . FOR YI=1:1:24 QUIT:$PIECE(UMSATZ,",",YI,99)=""  SET $PIECE(UMSATZ1,",",YI)=$PIECE(UMSATZ1,",",YI)+$PIECE(UMSATZ,",",YI)
	. . . . SET ^WWWSOR(YUSER,NAME,YVAR)=UMSATZ1
	
	SET YAUSW1="G"
	SET YAUSW2=0
	
	;ÜBERSCHRIFT BEARBEITEN ;superscription 
	SET UES(1)  = $$^WWWTEXT(32195)_Y_$$^WWWTEXT(32026)
	SET YMONATE = $$^WWWTEXT(30024,,1)
	SET YMONATE = YMONATE_","_YMONATE
	FOR YI=VMON:1:BMON SET UES(1)=UES(1)_Y_$PIECE(YMONATE,",",YI)   ;MONATE
	SET UES(1)=UES(1)_Y_$$^WWWTEXT(32059)
	
	QUIT
	
	
SORTLU   ;VORSORTIERUNG LIEFERANTEN
	;ULM, 01.07.02
	;BEC: ÄNDERUNG VERLAUF LETZTEN 12 MONATE EINGEBAUT 12.02.03 ;alteration trend in-built 
	SET YVAR=""
	IF VORG(5)'="" SET YVAR=$ORDER(^INLIEF(YM,VORG(5)),-1)  ;FINDEN DES STARTPUNKTES ;find
	SET SUBFROM=VORG(8)    ;ARTIKELNUMMER;09.12.2004;FAN;26826 
	SET SUBTO=VORG(8)
	IF SUBFROM'="" SET SUBSELECT=1
	IF SUBTO'="" SET SUBSELECT=1
	
	FOR  SET YVAR=$ORDER(^INLIEF(YM,YVAR)) QUIT:YVAR=""  DO  IF VORG(6)'="" QUIT:YVAR]]VORG(6)  ;
	. IF VORG(6)'="" QUIT:YVAR]]VORG(6)  ;DAMIT KEIN WERT ANGEZEIGT WIRD, WENN NICHTS VORHANDEN IST
	. ;
	. QUIT:$TRANSLATE(YVAR," "_"""")=""  ;KEIN LIEFERANT ;no supplier 
	. SET UMSATZ=$$^INUMS(YVON,YBIS,1,YVAR,+$GET(VORG(2)),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO)  ;SUCHEN LIEFERANTENUMSATZ ;seek 
	. IF VORG(7)=1 DO
	. . SET UMSATZA=$$^INUMS(YVON1,YBIS1,1,YVAR,+$GET(VORG(2)),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO)  ;SUCHEN UMSATZ DES KUNDEN VOR EINEM JAHR ;seek volume of trade pre- year 
	. . IF $PIECE(UMSATZA,",",12)="" SET $PIECE(UMSATZA,",",12)=""
	. . IF $PIECE(UMSATZ,",",12)="" SET $PIECE(UMSATZ,",",12)=""  ;FÜR AUSRICHTUNG  ;to 
	. . SET UMSATZ=UMSATZA_","_UMSATZ                     ;SUCHEN KUNDENUMSATZ VORJAHR/AKTUELL JAHR ;seek year 
	. ;
	. QUIT:$TRANSLATE(UMSATZ,",.0")=""  ;KEIN UMSATZ ;no volume of trade 
	. SET NAME=""
	. SET NAME=$PIECE($GET(^INLIEF(YM,YVAR,1)),Y,8)
	. IF NAME="" SET NAME=" "
	. SET ^WWWSOR(YUSER,NAME,YVAR)=UMSATZ
	
	SET YAUSW1="L"
	SET YAUSW2="INLIEF"
	
	;ÜBERSCHRIFT BEARBEITEN ;superscription 
	SET UES(1)  = $$^WWWTEXT(32022)_Y_$$^WWWTEXT(32171)
	SET YMONATE = $$^WWWTEXT(30024,,1)
	SET YMONATE = YMONATE_","_YMONATE
	FOR YI=VMON:1:BMON SET UES(1)=UES(1)_Y_$PIECE(YMONATE,",",YI)   ;MONATE
	SET UES(1)=UES(1)_Y_$$^WWWTEXT(32059)
	
	QUIT
	
	
SORTAA   ;VORSORTIERUNG ARTIKELART
	SET YART=""
	FOR  SET YART=$ORDER(^INAUFPs(YM,6,YART)) QUIT:YART=""  DO
	. QUIT:$TRANSLATE(YART," "_"""")=""  ;KEIN ARTIKEL ;no item 
	. SET YDATE=YVON-1
	. FOR  SET YDATE=$ORDER(^INAUFPs(YM,6,YART,YDATE)) QUIT:YDATE=""  QUIT:YDATE>YBIS  DO  QUIT  ;VON BIS DATUM ;until Date 
	. . SET YVAR=$PIECE($GET(^INART(YM,YART,1)),Y,26)  ;ARTIKELART
	. . ;
	. . ;ULM, 01.07.02 VON BIS
	. . ;BEC:12.02.03 13 MONATE VERLAUF  ;trend 
	. . IF (VORG(5)'="") || (VORG(6))'="" QUIT:YVAR=""
	. . IF VORG(5)'="" QUIT:VORG(5)]]YVAR  ;ARTIKELART ZU KLEIN ;within wee 
	. . IF VORG(6)'="" QUIT:YVAR]]VORG(6)  ;ARTIKELART ZU GROSS ;within 
	. . ;
	. . SET NAME=$PIECE($GET(^WWW101(0,"ARTIKEL-ART",SPRACHE,YVAR,1)),Y,1)
	. . IF NAME="" SET NAME=" "
	. . SET UMSATZ=$$^INUMS(YVON,YBIS,2,YART,VORG(2),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO)  ;SUCHEN UMSATZ DES KUNDEN ;seek volume of trade 
	. . IF $PIECE(UMSATZ,",",12)="" SET $PIECE(UMSATZ,",",12)=""  ;FÜR AUSRICHTUNG  ;to 
	. . IF VORG(7)=1 SET UMSATZ=",,,,,,,,,,,,"_UMSATZ
	. . QUIT:$TRANSLATE(UMSATZ,",;.0 "_"""")=""  ;KEINE WERTE
	. . SET UMSATZ1=$GET(^WWWSOR(YUSER,NAME,YVAR))
	. . FOR YI=1:1:24 QUIT:$PIECE(UMSATZ,",",YI,99)=""  SET $PIECE(UMSATZ1,",",YI)=$PIECE(UMSATZ1,",",YI)+$PIECE(UMSATZ,",",YI)
	. . SET ^WWWSOR(YUSER,NAME,YVAR)=UMSATZ1
	. ;
	. IF VORG(7)=1 DO
	. . SET YDATE=YVON1-1
	. . FOR  SET YDATE=$ORDER(^INAUFPs(YM,6,YART,YDATE)) QUIT:YDATE=""  QUIT:YDATE>YBIS1  DO  QUIT  ;VON BIS DATUM ;until Date 
	. . . SET YVAR=$PIECE($GET(^INART(YM,YART,1)),Y,26)  ;ARTIKELART
	. . . ;
	. . . IF (VORG(5)'="") || (VORG(6))'="" QUIT:YVAR=""
	. . . IF VORG(5)'="" QUIT:VORG(5)]]YVAR  ;ARTIKELART ZU KLEIN ;within wee 
	. . . IF VORG(6)'="" QUIT:YVAR]]VORG(6)  ;ARTIKELART ZU GROSS ;within 
	. . . ;
	. . . SET NAME=$PIECE($GET(^WWW101(0,"ARTIKEL-ART",SPRACHE,YVAR,1)),Y,1)
	. . . IF NAME="" SET NAME=" "
	. . . SET UMSATZA=$$^INUMS(YVON1,YBIS1,2,YART,VORG(2),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO)  ;SUCHEN UMSATZ DES KUNDEN ;seek volume of trade 
	. . . IF $PIECE(UMSATZA,",",12)="" SET $PIECE(UMSATZA,",",12)=""
	. . . SET UMSATZ=UMSATZA_",,,,,,,,,,,,"                     ;SUCHEN KUNDENUMSATZ VORJAHR/AKTUELL JAHR ;seek year 
	. . . QUIT:$TRANSLATE(UMSATZ,",;.0 "_"""")=""  ;KEINE WERTE
	. . . SET UMSATZ1=$GET(^WWWSOR(YUSER,NAME,YVAR))
	. . . FOR YI=1:1:24 QUIT:$PIECE(UMSATZ,",",YI,99)=""  SET $PIECE(UMSATZ1,",",YI)=$PIECE(UMSATZ1,",",YI)+$PIECE(UMSATZ,",",YI)
	. . . SET ^WWWSOR(YUSER,NAME,YVAR)=UMSATZ1
	
	SET YAUSW1="AA"
	SET YAUSW2=0
	
	;ÜBERSCHRIFT BEARBEITEN ;superscription 
	SET UES(1)  = $$^WWWTEXT(32215)_Y_$$^WWWTEXT(32026)
	SET YMONATE = $$^WWWTEXT(30024,,1)
	SET YMONATE = YMONATE_","_YMONATE
	FOR YI=VMON:1:BMON SET UES(1)=UES(1)_Y_$PIECE(YMONATE,",",YI)   ;MONATE
	SET UES(1)=UES(1)_Y_$$^WWWTEXT(32059)
	
	QUIT
	
	
SORTAU   ;VORSORTIERUNG ARTIKEL ;item 
	;ULM 01.07.02
	SET YVAR=""
	IF VORG(5)'="" SET YVAR=$ORDER(^INAUFPs(YM,6,VORG(5)),-1)  ;FINDEN DES STARTPUNKTES ;find 
	FOR  SET YVAR=$ORDER(^INAUFPs(YM,6,YVAR)) QUIT:YVAR=""  DO  IF VORG(6)'="" QUIT:YVAR]]VORG(6)  ;
	. IF VORG(6)'="" QUIT:YVAR]]VORG(6)  ;DAMIT KEIN WERT ANGEZEIGT WIRD, WENN NICHTS VORHANDEN IST
	. ;
	. ;SET YVAR="" FOR  SET YVAR=$ORDER(^INAUFPs(YM,6,YVAR)) QUIT:YVAR=""  DO
	. QUIT:$TRANSLATE(YVAR," "_"""")=""  ;KEIN ARTIKEL ;no item 
	. ;
	. SET YDATE=YVON-1
	. FOR  SET YDATE=$ORDER(^INAUFPs(YM,6,YVAR,YDATE)) QUIT:YDATE=""  QUIT:YDATE>YBIS  DO  QUIT  ;VON BIS DATUM ;until Date 
	. . SET UMSATZ=$$^INUMS(YVON,YBIS,2,YVAR,+$GET(VORG(2)),1,$GET(VORG(3)),,,,,)  ;SUCHEN ARTIKELUMSATZ ;seek 
	. . IF $PIECE(UMSATZ,",",12)="" SET $PIECE(UMSATZ,",",12)=""  ;FÜR AUSRICHTUNG  ;to 
	. . IF VORG(7)=1 SET UMSATZ=",,,,,,,,,,,,"_UMSATZ                     ;SUCHEN KUNDENUMSATZ VORJAHR/AKTUELL JAHR ;seek year 
	. . QUIT:$TRANSLATE(UMSATZ,",.0")=""  ;KEIN UMSATZ ;no volume of trade 
	. . SET NAME=""
	. . SET NAME=$PIECE($GET(^INART(YM,YVAR,1)),Y,1)
	. . IF NAME="" SET NAME=" "
	. . SET UMSATZ1=$GET(^WWWSOR(YUSER,NAME,YVAR))
	. . FOR YI=1:1:24 QUIT:$PIECE(UMSATZ,",",YI,99)=""  SET $PIECE(UMSATZ1,",",YI)=$PIECE(UMSATZ1,",",YI)+$PIECE(UMSATZ,",",YI)
	. . SET ^WWWSOR(YUSER,NAME,YVAR)=UMSATZ1
	. ;
	. IF VORG(7)=1 DO
	. . SET YDATE=YVON1-1
	. . FOR  SET YDATE=$ORDER(^INAUFPs(YM,6,YVAR,YDATE)) QUIT:YDATE=""  QUIT:YDATE>YBIS1  DO  QUIT  ;VON BIS DATUM ;until Date 
	. . . SET UMSATZA=$$^INUMS(YVON1,YBIS1,2,YVAR,+$GET(VORG(2)),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO)  ;SUCHEN ARTIKELUMSATZ ;seek 
	. . . IF $PIECE(UMSATZA,",",12)="" SET $PIECE(UMSATZA,",",12)=""
	. . . SET UMSATZ=UMSATZA_",,,,,,,,,,,,"                     ;SUCHEN KUNDENUMSATZ VORJAHR/AKTUELL JAHR ;seek year 
	. . . QUIT:$TRANSLATE(UMSATZ,",.0")=""  ;KEIN UMSATZ ;no volume of trade 
	. . . SET NAME=""
	. . . SET NAME=$PIECE($GET(^INART(YM,YVAR,1)),Y,1)
	. . . IF NAME="" SET NAME=" "
	. . . SET UMSATZ1=$GET(^WWWSOR(YUSER,NAME,YVAR))
	. . . FOR YI=1:1:24 QUIT:$PIECE(UMSATZ,",",YI,99)=""  SET $PIECE(UMSATZ1,",",YI)=$PIECE(UMSATZ1,",",YI)+$PIECE(UMSATZ,",",YI)
	. . . SET ^WWWSOR(YUSER,NAME,YVAR)=UMSATZ1
	
	SET YAUSW1="A"
	SET YAUSW2="INART"
	
	;ÜBERSCHRIFT BEARBEITEN ;superscription 
	SET UES(1)=$$^WWWTEXT(32024)_Y_$$^WWWTEXT(32026)
	SET YMONATE=$$^WWWTEXT(30024,,1)
	SET YMONATE=YMONATE_","_YMONATE
	FOR YI=VMON:1:BMON SET UES(1)=UES(1)_Y_$PIECE(YMONATE,",",YI)   ;MONATE
	SET UES(1)=UES(1)_Y_$$^WWWTEXT(32059)
	
	QUIT
	
	
SORTWU
	;-------------------------------------------------------------------------------
	; VORSORTIERUNG WARENGRUPPEN
	;
	; Params:
	;
	; ByRefs:
	;
	; Returns:
	;
	; History:
	; 27-Nov-2006	JW		BR014285: Item group change
	; 01.07.02		ULM
	;-------------------------------------------------------------------------------
	SET SUBFROM=VORG(8)
	SET SUBTO=VORG(9)
	IF VORG(8)'="" SET SUBSELECT=4
	IF VORG(9)'="" SET SUBSELECT=4
	SET YVAR=""
	//IF VORG(5)'="" SET YVAR=$ORDER(^INPARA(YM,"WARENGRUPPE",SPRACHE,VORG(5)),-1)
	//FOR  SET YVAR=$ORDER(^INPARA(YM,"WARENGRUPPE",SPRACHE,YVAR)) QUIT:YVAR=""  DO  
	IF VORG(5)'="" SET YVAR=$ORDER(^INItemGroup(YM,VORG(5)),-1)		//BR014285
	FOR  SET YVAR=$ORDER(^INItemGroup(YM,YVAR)) QUIT:YVAR=""  DO  
	. IF VORG(6)'="" QUIT:YVAR]]VORG(6) 
	. //SET NAME=$PIECE($GET(^INPARA(YM,"WARENGRUPPE",SPRACHE,YVAR,1)),Y,1)
	. set NAME = $$GetDescription^INDItemGroup(YVAR)	//BR014285
	. IF NAME="" SET NAME=" "
	. SET UMSATZ=$$^INUMS(YVON,YBIS,3,YVAR,VORG(2),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO)  ;SUCHEN UMSATZ DES WARENGRUPPE ;seek volume of trade 
	. IF VORG(7)=1 DO
	. . SET UMSATZA=$$^INUMS(YVON1,YBIS1,3,YVAR,VORG(2),1,$GET(VORG(3)),,,SUBSELECT,SUBFROM,SUBTO)  ;SUCHEN UMSATZ DES WARENGRUPPE ;seek volume of trade 
	. . IF $PIECE(UMSATZA,",",12)="" SET $PIECE(UMSATZA,",",12)=""
	. . IF $PIECE(UMSATZ,",",12)=""  SET $PIECE(UMSATZ,",",12)=""  ;FÜR AUSRICHTUNG  ;to 
	. . SET UMSATZ=UMSATZA_","_UMSATZ                     ;SUCHEN KUNDENUMSATZ VORJAHR/AKTUELL JAHR ;seek year 
	. ;
	. QUIT:$TRANSLATE(UMSATZ,",;.0 "_"""")=""  ;KEINE WERTE
	. SET ^WWWSOR(YUSER,NAME,YVAR)=UMSATZ
	
	SET YAUSW1="W"
	SET YAUSW2=0

	
	;ÜBERSCHRIFT BEARBEITEN ;superscription 
	SET UES(1)  = $$^WWWTEXT(32082)_Y_$$^WWWTEXT(32026)
	SET YMONATE = $$^WWWTEXT(30024,,1)
	SET YMONATE = YMONATE_","_YMONATE
	FOR YI=VMON:1:BMON SET UES(1)=UES(1)_Y_$PIECE(YMONATE,",",YI)   ;MONATE
	SET UES(1)=UES(1)_Y_$$^WWWTEXT(32059)
	
	QUIT
	
	
SORTGG ;VORSORTIERUNG GRAFISCHE GESAMTÜBERSICHT
	;
	;
	SET YOPTION=2  ;KUNDENUMSATZ
	IF VORG(4)'=1 DO
	. SET YSUM=""
	. SET YVAR=""
	. FOR  SET YVAR=$ORDER(^INAUFs(YM,1,YVAR)) QUIT:YVAR=""  DO 
	. . QUIT:$TRANSLATE(YVAR," "_"""")=""  ;NO CUSTOMER, THAN WRONG RESULT;TYBD;23-APR-2005 
	. . SET YDATE=YVON-1
	. . FOR  SET YDATE=$ORDER(^INAUFs(YM,1,YVAR,YDATE)) QUIT:YDATE=""  QUIT:YDATE>YBIS  DO  QUIT  ;VON BIS DATUM ;until Date 
	. . . SET UMSATZ=$$^INUMS(YVON,YBIS,0,YVAR,+$GET(VORG(2)),1000,$GET(VORG(3)))  ;SUCHEN KUNDENUMSATZ ;seek 
	. . . QUIT:$TRANSLATE(UMSATZ,",.0")=""  ;KEIN UMSATZ ;no volume of trade 
	. . . FOR YI=1:1:12 DO
	. . . . SET $PIECE(YSUM,",",YI)=$PIECE(YSUM,",",YI)+$PIECE(UMSATZ,",",YI)
	
	QUIT:VORG(4)=0
	;
	SET YSUM1=""  ;LIEFERANTENUMSATZ
	SET YVAR="" FOR  SET YVAR=$ORDER(^INLIEF(YM,YVAR)) QUIT:YVAR=""  DO  
	. SET UMSATZ=$$^INUMS(YVON,YBIS,1,YVAR,+$GET(VORG(2)),1000,$GET(VORG(3)))  ;SUCHEN LIEFERANTENUMSATZ ;seek 
	. QUIT:$TRANSLATE(UMSATZ,",.0")=""  ;KEIN UMSATZ ;no volume of trade 
	. FOR YZ=1:1:12 DO
	. . SET $PIECE(YSUM1,",",YZ)=$PIECE(YSUM1,",",YZ)+$PIECE(UMSATZ,",",YZ)
	
	QUIT
	
	
DRUCK
	;AUSWERTUNG DRUCKEN ;print 
	;DO ^INLISTKOPF  ;DRUCKEN DECKBLATT
	IF $GET(NOKOPF)'=1 DO ^INLISTKOPF  ;DRUCKEN DECKBLATT  ;26071;FAN;IN KUNDESTAMMEN GLEICHAUFRUFEN OHNE KOPF;15.07.04
	
	SET YDDSATZ=0
	
	;GRAPHISCHE AUSWERTUNG
	IF YOPTION=2 DO  QUIT  
	. WRITE "<BR>"
	. SET YFELD=""
	. SET $PIECE(YFELD,Y,1)="gif"_$PIECE($HOROLOG,",",2)_YUSER_".gif"
	. SET $PIECE(YFELD,Y,2)=0      ;0 BOX,1 LINES,2 STACK,3 STOCK
	. SET $PIECE(YFELD,Y,3)=YKOPF  ;HEADER
	. SET $PIECE(YFELD,Y,4)="BLACK"         ;FARBE ;tincture 
	. SET $PIECE(YFELD,Y,5)=$$^WWWTEXT(30024,,1)  ;X-achse MONAT ;month 
	. SET $PIECE(YFELD,Y,6)=$$^WWWTEXT(16)
	. SET $PIECE(YFELD,Y,7)=""   ;Y-ACHSE leer = automatic ;void 
	. SET $PIECE(YFELD,Y,8)=$$^WWWTEXT(32081)_" "_$$^WWWTEXT(32218)  ;UMSATZ IN TAUSEND ;volume of trade within thousand 
	. IF VORG(4)'=1 DO
	. . SET $PIECE(YFELD,Y,10)=$$^WWWTEXT(32219)_" "_$$^WWWTEXT(32218)  ;KUNDENUMSATZ IN TAUSEND ;within thousand 
	. . SET $PIECE(YFELD,Y,11)="BLUE"   ;FARBE ;tincture 
	. . SET $PIECE(YFELD,Y,12)=YSUM       ;WERTELISTE   NN,NN,NN,
	. . QUIT:VORG(4)=0
	. . SET $PIECE(YFELD,Y,13)=$$^WWWTEXT(32220)_" "_$$^WWWTEXT(32218)    ;LIEFERANTENUMSATZ IN TAUSEND ;within thousand 
	. . SET $PIECE(YFELD,Y,14)="RED"   ;FARBE ;tincture 
	. . SET $PIECE(YFELD,Y,15)=YSUM1       ;WERTELISTE   NN,NN,NN,
	. ;
	. IF VORG(4)=1 DO
	. . SET $PIECE(YFELD,Y,10)=$$^WWWTEXT(32220)_" "_$$^WWWTEXT(32218)  ;LIEFERANTENUMSATZ IN TAUSEND ;within thousand 
	. . SET $PIECE(YFELD,Y,11)="RED"   ;FARBE ;tincture 
	. . SET $PIECE(YFELD,Y,12)=YSUM1       ;WERTELISTE   NN,NN,NN,
	. ;
	. DO ^WWWGRAPH(YFELD)
	
	QUIT:YOPTION=2
	
	;DRUCKEN TABELLE ;print tabulation 
	DO UPUEB  ;DRUCKEN ÜBERSCHRIFT ;print superscription 
	
	SET NAME=""
	FOR  SET NAME=$ORDER(^WWWSOR(YUSER,NAME)) QUIT:NAME=""  DO
	. SET YVAR=""
	. FOR  SET YVAR=$ORDER(^WWWSOR(YUSER,NAME,YVAR)) QUIT:YVAR=""  DO
	. . SET SUM=0
	. . SET UMSATZ=$GET(^WWWSOR(YUSER,NAME,YVAR))
	. . ;
	. . DO
	. . . WRITE !
	. . . WRITE YCR
	. . . DO NL^WWWTAB
	. . . DO NF^WWWTAB
	. . . IF YAUSW2'=0 DO  ;KEIN LINK BEI GEBIET UND WARENGRUPPE ;no next to zone And 
	. . . . WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&YFORM="_YAUSW2_"&YKEY="_YVAR
	. . . . DO ^WWWCGI
	. . . . WRITE """"
	. . . . WRITE "TITLE="_""""_$$^WWWTEXT(374)_""""  ;DATENSATZ AUSWÄHLEN ;data record pick out 
	. . . . WRITE ">"
	. . . ;
	. . . WRITE YVAR
	. . . IF YAUSW2'=0 WRITE "</A>"
	. . . WRITE YCR
	. . . WRITE "&nbsp;"
	. . . DO ZWL^WWWTAB
	. . . IF YAUSW2'=0 DO
	. . . . WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&YFORM="_YAUSW2_"&YKEY="_YVAR
	. . . . DO ^WWWCGI
	. . . . WRITE """"
	. . . . WRITE "TITLE="_""""_$$^WWWTEXT(374)_""""  ;DATENSATZ WÄHLEN ;data record pick out 
	. . . . WRITE ">"
	. . . ;
	. . . WRITE NAME
	. . . IF YAUSW2'=2 WRITE "</A>"
	. . . WRITE YCR
	. . . WRITE "&nbsp;"
	. . . ;
	. . . ;SCHREIBEN MONATLICHER UMSATZ UND GESAMTSUMME DES MONATS ;write volume of trade And total amount monthly 
	. . . FOR YI=VMON:1:BMON DO
	. . . . DO ZWR^WWWTAB
	. . . . SET ZAHL=$PIECE(UMSATZ,",",YI)   ;MONATZUMSATZ
	. . . . SET UMS(YI)=$GET(UMS(YI))+ZAHL   ;SUMME ;sum 
	. . . . SET SUM=$GET(SUM)+ZAHL
	. . . . IF +ZAHL'=0 WRITE $$^WWWZAHL(ZAHL,10,2,YWHR)  ;ZAHL IN WÄHRUNG GERECHNET ;numeral within money standard 
	. . . . WRITE "&nbsp;"
	. . . ;
	. . . ;SCHREIBEN GESAMTSUMME DES JAHRES ;write total amount 
	. . . DO ZWR^WWWTAB
	. . . SET ZAHL=SUM
	. . . IF +ZAHL'=0 WRITE $$^WWWZAHL(ZAHL,10,2,YWHR)  ;ZAHL IN WÄHRUNG GERECHNET ;numeral within money standard 
	. . . WRITE "&nbsp;"
	. . . DO EF^WWWTAB
	. . . DO EL^WWWTAB
	
	QUIT
	
	
GESAMT ;GESAMT ;total  ;total whole 
	SET SUM=0
	WRITE !
	WRITE YCR
	DO NL^WWWTAB
	DO NF^WWWTAB
	WRITE "&nbsp;"
	DO ZW^WWWTAB
	WRITE "&nbsp;"
	
	FOR YI=VMON:1:BMON DO
	. DO ZWR^WWWTAB
	. SET ZAHL=$GET(UMS(YI))   ;MONATZUMSATZ
	. SET SUM=SUM+ZAHL
	. WRITE $$^WWWZAHL(ZAHL,10,2,YWHR)  ;ZAHL IN WÄHRUNG GERECHNET ;numeral within money standard 
	. WRITE "&nbsp;"
	
	DO ZWR^WWWTAB
	SET ZAHL=SUM
	IF +ZAHL'=0 WRITE $$^WWWZAHL(ZAHL,10,2,YWHR)  ;ZAHL IN WÄHRUNG GERECHNET ;numeral within money standard 
	WRITE "&nbsp;"
	DO EF^WWWTAB
	DO EL^WWWTAB
	QUIT
	
	
UPUEB ;ÜBERSCHRIFT ;superscription 
	WRITE "<CENTER>"
	DO START00^WWWTAB
	DO NL^WWWTAB
	DO NHWO^WWWTAB
	WRITE "<FONT SIZE=3>"
	WRITE "<B>"
	WRITE "<NOBR>"
	WRITE YKOPF," "
	IF VORG(7)=1 WRITE (VORG(1)-1),"- "
	WRITE VORG(1)
	WRITE "</NOBR>"
	WRITE "</B>"
	DO EH^WWWTAB
	DO EL^WWWTAB
	DO STOP^WWWTAB
	
	WRITE "<BR>"
	WRITE "</CENTER>"
	DO START100^WWWTAB  ;STARTEN DER ÜBERSCHRIFT ;launching the superscription 
	WRITE "<THEAD>" 
	DO NL^WWWTAB
	FOR I=1:1 QUIT:$PIECE(UES(1),Y,I,99)=""  DO NHW^WWWTAB WRITE $PIECE(UES(1),Y,I),"&nbsp;" SET SPALTEN=SPALTEN+1 DO EH^WWWTAB
	DO EL^WWWTAB
	WRITE "</THEAD>"
	QUIT
	
]]></Routine>
</Export>