<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="Cache" ts="2001-01-01 00:00:00">
<Routine name="VARJasperRunReport" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[VARJasperRunReport

#include COMSYS
#include COMConst
#include INConst
#include VARConst
#include MEDConst

	quit

	//molde para o relatorio de estoque por produto
RunReportEstoqueConsulta(pProduto,pLocal,pOrderBy,pPrograma)
	; Report utilizado no Form "VARStock"
	;
	;Histórico
	;
	;2010-04-27	Sósthenes	Adicionada a opção de busca por local ou em toda a rede
	new filterProduto, filterLocal, filterUnidade, filterGrupo, filterContaContabil, 
		filterCustoMedio, FiltroProg
	
	set filterProduto		 = ""
	set filterLocal			 = ""
	set filterUnidade		 = ""
	set filterGrupo			 = ""
	set filterContaContabil	 = ""
	set filterCustoMedio	 = ""
	
	set FiltroProg = ""
	
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if (pProduto '= ""){
		set filterProduto 		= pProduto_" - "_$$SQLGetDescricaoProduto^VARSQL(pProduto)
		set filterUnidade 		= $$SQLGetDescCompletaUnit^VARSQL($$SQLGetUnitIdItem^VARSQL(pProduto))
		set filterGrupo 		= $$SQLGetGrupoItem^VARSQL(pProduto)_" - "_$$SQLGetDescGrupoPerItem^VARSQL(pProduto)
		set filterContaContabil = $$SQLGetContaContabil^VARSQL(pProduto)_" - "_$$SQLGetDescContaContabil^VARSQL($$SQLGetContaContabil^VARSQL(pProduto))
		set filterCustoMedio 	= $$GetCost^INItemCost(pProduto)
	}
	
	if (pLocal '= ""){
		set filterLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
	}
	
	if (pPrograma '= ""){
		set FiltroProg = " AND alSOH.dBundleStock.Bundle->Program = '"_pPrograma_"' "
	}
	
	set link=$$Start^VARJasperRun("VAREstoqueConsulta")
	
    if (pLocal '= "") { //Verifica se é necessário filtrar a busca por local 
	    set link=$$Start^VARJasperRun("VAREstoqueConsulta")
		set pFiltro = "AND alSOH.dBundleStock.Storage->Location = '"_pLocal_"'"
		if (pOrderBy '= ""){
			if (pOrderBy = 1){
				set pOrderBy = " $$SQLGetPhysicalStorage^VARSQL(alSOH.dBundleStock.Storage->Code,alSOH.dBundleStock.Storage->Location) "
			}
			if (pOrderBy = 2){
				set pOrderBy = " $$GetProgramName^VARSQL(alSOH.dBundleStock.Bundle->Program) "
			}
		}
		else {
			set pOrderBy = " alSOH.dBundleStock.Bundle->ID "
		}

		set link=$$addUserParameter^VARJasperRun(link,"filterLocal", filterLocal)
		set link=$$addUserParameter^VARJasperRun(link,"Filtro", pFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pOrderBy", pOrderBy)
	} else {
		set link=$$Start^VARJasperRun("VAREstoqueConsultaRede") //Caso o local não seja especificado, será gerado
		}														//o relatório de rede
	set link=$$addUserParameter^VARJasperRun(link,"filterProduto", filterProduto)
	set link=$$addUserParameter^VARJasperRun(link,"filterUnidade", filterUnidade)
	set link=$$addUserParameter^VARJasperRun(link,"filterGrupo", filterGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"filterContaContabil", filterContaContabil)
	set link=$$addUserParameter^VARJasperRun(link,"filterCustoMedio", filterCustoMedio)
	set link=$$addUserParameter^VARJasperRun(link,"Produto", pProduto)
	set link=$$addUserParameter^VARJasperRun(link,"FiltroProg", FiltroProg)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario", NomeUsuario)
	do ViewInForm^VARJasperRun(link,"Estoque por Produto")	
	
	quit

RunReportContabilTransferencia(pLocal,pGrupo,pMes,pAno)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-10-02   Bruno  Created
	;-------------------------------------------------------------------------------
	new Usuario, NomeUsuario, descLocal, descGrupo, srtPeriodo, DataInicial, DataFinal, strWhere,
		sqlEntradaTransf, sqlSaidaTransf
	
	set sqlEntradaTransf = ""
	set sqlSaidaTransf	 = ""	
	set strWhere  		 = ""
	set descLocal 		 = "Todos"
	set descGrupo 		 = "Todos"
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set DataInicial = $zdateh(pMes_"/01/"_pAno)
	set DataFinal  	= $$SQLGetUltimoDiaMes^VARSQL(pMes,pAno)
	set strPeriodo	= $$GetDescMes^VARSQL(pMes)_" de "_pAno
	
	if pLocal '= ""{		
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
	}
	
	if pGrupo '= ""{
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
		set strWhere  = " WHERE GrupoPai = "_$$SQLGetGrupoPai^VARSQL(pGrupo)_" "
	}
	
	;Não precisa mais relatórios diferentes se o usuário filtrou por local
	;if (pLocal = ""){
		set link=$$Start^VARJasperRun("VARContabilTransferencia")
	;} elseif (pLocal '= ""){
	;	set link=$$Start^VARJasperRun("VARContabilTransferenciaLocal")
	;}
	
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",Usuario)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",DataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",DataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
    set link=$$addUserParameter^VARJasperRun(link,"strPeriodo",strPeriodo)
    set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
    set link=$$addUserParameter^VARJasperRun(link,"Local",pLocal)
    set link=$$addUserParameter^VARJasperRun(link,"Mes",pMes)
	set link=$$addUserParameter^VARJasperRun(link,"Ano",pAno)
	do ViewInForm^VARJasperRun(link,"Relatório de Transferência")	
	
	quit	
RunReportEstoqueConsultaProg(pLocal,pOrdenarPor,pDescOrdenar,pFormato,pFiltro,pDescGrupo,pMostrarValores,pFiltroProg,pDescProg,pDescLocal,pDescContaContabil)
	; Report utilizado no Form "VARStockByProgram"
	;
	;Histórico
	;2011-04-15	Thiago  Created
	;2012-04-23	Lucas	Adicionado filtro por Conta Contábil.
	;2012-05-15 Lucas	Adicionado usuário para novo layout de relatórios.
	
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if (pFormato = 1) {
		if (pMostrarValores=$$$YES){
			set link=$$Start^VARJasperRun("VAREstoqueConsultaProgContabil")
		} else {
			set link=$$Start^VARJasperRun("VAREstoqueConsultaProgSemContabil")
		}
	} else {
		if (pMostrarValores=$$$YES){
			set link=$$Start^VARJasperRun("VAREstoqueConsultaProg")
		}
		else {
			set link=$$Start^VARJasperRun("VAREstoqueConsultaSemProg")
		}
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pCodLocal",pDescLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pOrderBy",pOrdenarPor)
	set link=$$addUserParameter^VARJasperRun(link,"pDescOrderBy",pDescOrdenar)
	set link=$$addUserParameter^VARJasperRun(link,"pDescGrupo",pDescGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"pMostrarValores",pMostrarValores)
	set link=$$addUserParameter^VARJasperRun(link,"pDescProg",pDescProg)
	set link=$$addUserParameter^VARJasperRun(link,"pDescContaContabil",pDescContaContabil)
	
	if (pFiltro '= "") {
		set link=$$addUserParameter^VARJasperRun(link,"Filtro",pFiltro)
	} 
	
	if (pFiltroProg '= ""){
		set link=$$addUserParameter^VARJasperRun(link,"FiltroProg",pFiltroProg)
	}
	
	do ViewInForm^VARJasperRun(link,"Estoque por Programa")	
	
	quit
	
	//molde para o relatorio de consulta de estoque por endereço
RunReportEstoqueConsEndereco()
	; Report utilizado no Form "VAREstoqueConsEndereco"
	;
	;2016-03-22 Fellipe A.	Corrigido filtro para pesquisa (HEVA-1921)
	;2010-05-04 Sósthenes	Adicionado nova política de local.
	;2010-10-07 Sósthenes	Modificado o relatório para exibir o nome do paciente caso o local corrente seja famácia judicial.
	
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set pfilterIniciaCom = $piece(^VARTempConsEndereco(YM,YBED,1),Y,1)
	set pfilterQuebra 	 = $piece(^VARTempConsEndereco(YM,YBED,1),Y,2)
	set filterDe 		 = $piece(^VARTempConsEndereco(YM,YBED,1),Y,3)
	set filterAte 		 = $piece(^VARTempConsEndereco(YM,YBED,1),Y,4)
	set filterOrdenarPor = $piece(^VARTempConsEndereco(YM,YBED,1),Y,5)
	set filterTipo		 = $piece(^VARTempConsEndereco(YM,YBED,1),Y,6)
	set filterEndereco   = $piece(^VARTempConsEndereco(YM,YBED,1),Y,7)
	set pFormato		 = $piece(^VARTempConsEndereco(YM,YBED,1),Y,8)
	
	set pFilter  = ""
	set pOrderBy = ""
	
	set pLike = ""
	if (pfilterIniciaCom '= ""){
		set pLike = pfilterIniciaCom_"%"
	}
	
	if (filterTipo = 1){
		set pFilter = pFilter_" AND (Code = '"_filterEndereco_"' OR PhysicalCode = '"_filterEndereco_"') "
	}
	
	;HEVA-1921
	if (filterTipo = 2){
		if (filterDe '= ""){
			set pFilter = pFilter_" AND 'A'||Code  >= 'A"_filterDe_"' "
		}
		if (filterAte '= ""){
			set pFilter = pFilter_" AND 'A'||Code  <= 'A"_filterAte_"' "
		}
	}
	
	/*
	if (filterTipo = 2){
		if (filterDe '= ""){
			if (($find(filterDe,"-") || ($length(filterDe) < 4))) {
				set pFilter = pFilter_" AND EnderecoFinalNumero  >= '"_$$SQLGetNoEnderecoDe^VAREstoqueConsEndereco(filterDe)_"' "
			}
			else {
				set pFilter = pFilter_" AND Code  >= '"_filterDe_"' "
			}
		}
		if (filterAte '= ""){
			if (($find(filterAte,"-") || ($length(filterAte) < 4))) {
				set pFilter = pFilter_" AND EnderecoFinalNumero  <= '"_$$SQLGetNoEnderecoAte^VAREstoqueConsEndereco(filterAte)_"' "
			}
			else {
				set pFilter = pFilter_" AND Code  <= '"_filterAte_"' "
			}
		}
	}
	*/
		
	
	if (filterTipo = 3){
		set pFilter = pFilter_" AND (Code like '"_pLike_"' OR PhysicalCode like '"_pLike_"') "
	}
	
	if (pfilterQuebra '= "") { ;HEVA-1921

	if (filterOrdenarPor = 1){
		set pOrderBy =" ORDER BY Item "
	}
	elseif (filterOrdenarPor = 2) {
		set pOrderBy = " ORDER BY $$SQLGetTextoSemAcento^VARSQL($$SQLGetDescricaoProduto^VARSQL(Item)) "
	}
	else {
		set pOrderBy = " ORDER BY EnderecoFinalNumero, Item "
	}
	
	} else {
		set pOrderBy =" ORDER BY Code, Item " ;HEVA-1921
	}
	
	if (YLOCATION = "18.1") { //Farmácia judical
		set pfilterIniciaCom = $$SQLGetPatientName^VARSQL(pfilterIniciaCom)
	}
	
	if (pfilterQuebra = ""){
		if ((pFormato = 1) || (pFormato = "")) { ;HEVA-1921
			set link=$$Start^VARJasperRun("VAREstoqueConsEndereco")
		} elseif (pFormato = 2){
			set link=$$Start^VARJasperRun("VAREstoqueConsEnderecoSimples")
		}		
	}
	else {
		if ((pFormato = 1) || (pFormato = "")) { ;HEVA-1921
			set link=$$Start^VARJasperRun("VAREstoqueConsEnderecoSemQubra")
		} elseif (pFormato = 2){
			set link=$$Start^VARJasperRun("VAREstoqueConsEnderecoSemQubraSimples")
		}		
	}
	
	set:(filterOrdenarPor = "") filterOrdenarPor = 3
	
	if (pfilterQuebra = "") { ;HEVA-1921
		set pOrdenarPor = $$SQLGetUserParamDescVAR^VARSQL("ORDENACONSENDERECO~"_3)
	} else {
		set pOrdenarPor = $$SQLGetUserParamDescVAR^VARSQL("ORDENACONSENDERECO~"_filterOrdenarPor)
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pEndereco", pfilterIniciaCom)
	set link=$$addUserParameter^VARJasperRun(link,"pLike", pLike)
	set link=$$addUserParameter^VARJasperRun(link,"pLocalcorrente", YLOCATION)
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro", pFilter)
	set link=$$addUserParameter^VARJasperRun(link,"pOrderBy", pOrderBy)
	set link=$$addUserParameter^VARJasperRun(link,"pfilterTipo", filterTipo)
	set link=$$addUserParameter^VARJasperRun(link,"pfilterTipoDesc", $$SQLGetUserParamDescVAR^VARSQL("TIPOCONSENDERECO~"_filterTipo))
	set link=$$addUserParameter^VARJasperRun(link,"pfilterIniciaCom", pfilterIniciaCom)
	set link=$$addUserParameter^VARJasperRun(link,"filterDe", filterDe)
	set link=$$addUserParameter^VARJasperRun(link,"filterAte", filterAte)
	set link=$$addUserParameter^VARJasperRun(link,"filterEndereco", filterEndereco)
	set link=$$addUserParameter^VARJasperRun(link,"pOrdenarPor", pOrdenarPor)
	do ViewInForm^VARJasperRun(link,"Estoque por Endereço")	
	
	quit
	
	
	//molde para o relatorio de posição do estoque
RunReportPosicaoEstoque(pLocal,pUnidade,pOrdenarPor,pDescOrdenar,pFormato,pFiltro,pDescGrupo,pDescContaContabil)
	; Report utilizado no Form "VAREstoquePosicao"
	;
	;15-Mar-2010	Sósthenes	Modificado para geração de relatórios diferenciados.
	;18-May-2010	Sósthenes	Adicionado campo de descrição do local via parameter.
	;12-Jan-2012	Lucas		Adicionado relatório de Conta Contábil.
	;23-Abr-2012	Lucas		Adicionado filtro por Conta Contábil.
		
	new DescLocal, DescUnidade, pWhere, NomeUsuario
	set DescLocal = ""
	set DescUnidade = ""
	set pWhere = ""
	
	if (pFormato = 1) {
		set link=$$Start^VARJasperRun("VARPosicaoEstoqueContabil")
	} 
	
	if (pFormato = 2) {
		set link=$$Start^VARJasperRun("VARPosicaoEstoqueFisico")
	}
	
	if (pFormato = 3) {
		set link=$$Start^VARJasperRun("VARPosicaoEstoqueContaContabil")
	}
	
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if (pLocal'="") {
		set DescLocal = pLocal_" - "_$piece($get(^WWW0121(0,0,pLocal,1)),"~",1)
		set link=$$addUserParameter^VARJasperRun(link,"pCodLocal",pLocal)
		set pWhere = " WHERE alSOH.dBundleStock.Storage->Location = "
	} else {
		set DescUnidade = pUnidade_" - "_$piece($get(^WWW0121(0,0,pUnidade,1)),"~",1)
		set link=$$addUserParameter^VARJasperRun(link,"pCodLocal",pUnidade)
		set pWhere = " WHERE $$SQLGetUnidadedoLocal^VARSQL(alSOH.dBundleStock.Storage->Location) = "
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"pDescLocal",DescLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pDescUnidade",DescUnidade)
	set link=$$addUserParameter^VARJasperRun(link,"pOrderBy",pOrdenarPor)
	set link=$$addUserParameter^VARJasperRun(link,"pDescOrderBy",pDescOrdenar)
	set link=$$addUserParameter^VARJasperRun(link,"pDescGrupo",pDescGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"pDescContaContabil",pDescContaContabil)
	set link=$$addUserParameter^VARJasperRun(link,"pWhere",pWhere)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	
	if (pFiltro '= "") {
		set link=$$addUserParameter^VARJasperRun(link,"Filtro",pFiltro)
	}
	

	;set link=$$Start^VARJasperRun("VARSESEntradaRecebimento")
	;set link=$$addParameter^VARJasperRun(link,YKEY,1)
	;set link=$$addParameter^VARJasperRun(link,YBED,2)
	;set link=$$addParameter^VARJasperRun(link,NomeUsuario,3)
	
	//set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, YKEY, "", "", "", "1", "").getHref()
	
	//set retorno=$$BackLink^VARJasperRun(retorno)
	//set link=$$addUserParameter^VARJasperRun(link,"returnLink",retorno)
	
	;// Petik, 08/Out/2009 - This opens report in current window
	;vvvvv
	;do Run^VARJasperRun(link)
	
	;// Petik, 08/Out/2009 - This opens report in new @NM form "VARTCIViewReportInFrame" and report in an internal frame.
	;vvvv
	do ViewInForm^VARJasperRun(link,"Posição do Estoque")	
	
	quit
	
RunReportMovEstoqueProduto(pYBED)
	;-------------------------------------------------------------------------------
	; This report is used in VARtockHistory screen
	;     
	; Params:	pYBED		
	;
	; History:
	; 28-Oct-2009	Karine		
	;-------------------------------------------------------------------------------
	new link
	IF YBED '="" 
			{
		set User=YBED
		set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			
		set link=$$Start^VARJasperRun("VARMovEstoqueProduto")
		set link=$$addUserParameter^VARJasperRun(link,"pUsuario",User)
		set link=$$addUserParameter^VARJasperRun(link,"descUsuario",NomeUsuario)
	
		do ViewInForm^VARJasperRun(link,"Impressão: Movimentação de Estoque por Produto")		
	} 
	
	quit
	
	
	//molde para o relatorio de estoque zerado
RunReportEstoqueZerado(pLocal,pMov,pfilterOrder,pfilterGrupo)
	; Report utilizado no Form "VAREstoqueZerado"
	;
	;
	;Histórico
	;2012-10-26 Vitor		Adicionada ordenação por Data de Movimentação
	;2012-06-18 Lucas		Adicionada verificação de controle de autorização de produtos
	;2010-12-30	Sósthenes	Adicionado filtro de movimentação de produtos
	;2010-04-26	Sósthenes	Concretizado filtro de busca por local
	
	if pfilterOrder ="" set pfilterOrder = 1
	
	set pFiltro    = ""
	set pFiltroMov = ""
	set pFiltroAut = ""
	
	if (pfilterOrder = 3) {
		set pOrderby   = "ORDER BY Data"
	}else{
		set pOrderby   = "ORDER BY "_pfilterOrder
	}
	set objAutorizacao   = ^VARParametroCliente(0,0,1)
	set checkAutorizacao = $$$VARParametroClienteControlarAutorizacaoProdutos(objAutorizacao)
	
	if (pMov = "1") {
		set pFiltroMov = " AND alSOH.dStockHistory.DateConfirmed is not null "
]]><![CDATA[	} elseif (pMov = "2") {
		set pFiltroMov =" AND alSOH.dStockHistory.DateConfirmed is null "
	}
	
	if (checkAutorizacao '= "") {

		set link=$$Start^VARJasperRun("VAREstoqueZeradoLocal")
		set pFiltro = " AND alSOH.dBundleStock.Storage->Location = '"_pLocal_"' "
		set pFiltroAut = " AND INDRPITEM.ItemNo = INART.ItemNumber "
		if (pfilterGrupo '="") {
			set pFiltroMov = pFiltroMov_" AND (INART.ItemGroup = '"_pfilterGrupo_"' or $$SQLCompareGroupHierarchy^VARSQL(INART.ItemGroup,'"_pfilterGrupo_"')=1) "		
		}
	} else {
		set link=$$Start^VARJasperRun("VAREstoqueZerado")
		set pFiltro = " AND alSOH.dBundleStock.Storage->Location = '"_pLocal_"' "
		if (pfilterGrupo '="") {
			set pFiltroMov = pFiltroMov_" AND (INART.ItemGroup = '"_pfilterGrupo_"' or $$SQLCompareGroupHierarchy^VARSQL(INART.ItemGroup,'"_pfilterGrupo_"')=1) "
		}
	}
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else { 
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario",NomeUsuario)	
	set link=$$addUserParameter^VARJasperRun(link,"Filtro", pFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"FiltroMov", pFiltroMov)	
	set link=$$addUserParameter^VARJasperRun(link,"pFiltroAut", pFiltroAut)	
	set link=$$addUserParameter^VARJasperRun(link,"Local", pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"DescLocal",$$SQLGetLocationName^VARSQL(pLocal))
	set link=$$addUserParameter^VARJasperRun(link,"Mov", pMov)
	set link=$$addUserParameter^VARJasperRun(link,"OrderBy", pOrderby)

	do ViewInForm^VARJasperRun(link,"Produtos com estoque zerado")	
	
	quit
	
	
RunReportEstoqueSemMovto(pLocal,pDiasSemMovto,pOrderBy,pExcluirZerados,pPrograma,pGrupo,pExcluirMovInterna)
	; Report utilizado no Form "VAREstoqueSemMovto"
	;
	;
	;Histórico
	; 22-Mar-2012	Rubens	Alteracao para excluir movimentacao interna
	; 18-Nov-2011	Karine	Adicionado a ordenação
	;2010-04-26	Sósthenes	Concretizado filtro de busca por local
	
	new NomeUsuario, pFiltro, pOrdenacao
	set pFiltro=""
	set pOrdenacao = "ORDER BY "_pOrderBy
	
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if (pLocal = ""){ 
		set link=$$Start^VARJasperRun("VAREstoqueSemMovtoRede")
	}
	else {
		set link=$$Start^VARJasperRun("VAREstoqueSemMovto")
	}
	if (pLocal '= "") {
		set pFiltro = " AND alSOH.dStockHistory.Location->Code = '"_pLocal_"'"
		if (pExcluirZerados '= "") {
			set pFiltro = pFiltro_" AND $$GetEstoqueDisponivel^VARReposicao(INART.ItemNumber,"_pLocal_") > 0 "
		}
	} else {
		if (pExcluirZerados '= "") {
			set pFiltro = " AND $$GetEstoqueDisponivel^VARReposicao(INART.ItemNumber) > 0 "
		}
	}
	if (pPrograma '= "") {
		set pFiltro = pFiltro_" AND alSOH.dStockHistory.Bundle->Program = "_pPrograma_" "
	}
	if (pGrupo '="") {
	 	set pFiltro = pFiltro_" AND INART.ItemGroup = "_pGrupo_" "
 	}
 	if (pExcluirMovInterna'="") {
	 	set pFiltro = pFiltro_" AND $$SQLGetMovTypeNumber^VARSQL(alSOH.dStockHistory.MovementType)!= 5 and $$SQLGetMovTypeNumber^VARSQL(alSOH.dStockHistory.MovementType)!=51 "
 	}
	set link=$$addUserParameter^VARJasperRun(link,"Filtro", pFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"Local", pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"DiasSemMovto",pDiasSemMovto)
	set link=$$addUserParameter^VARJasperRun(link,"Ordenacao",pOrdenacao)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"Programa",pPrograma)
	set link=$$addUserParameter^VARJasperRun(link,"OrderBy",pOrderBy)
	set link=$$addUserParameter^VARJasperRun(link,"Grupo",pGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"pYLOCATION",YLOCATION)

	do ViewInForm^VARJasperRun(link,"Produtos sem movimentação")	
	
	quit
	
	//molde para o relatorio de impressão de etiqueta por endereço
RunReportEstoqueEtq(pEndereco)
	; Report utilizado no Form "VARTCIEstoqueEtq"
	;
	
	set pLike = pEndereco_"%"
	
	set link=$$Start^VARJasperRun("VAREstoqueEtq")
	set link=$$addUserParameter^VARJasperRun(link,"pLike", pLike)

	do ViewInForm^VARJasperRun(link,"Etiqueta por Endereço")	
	
	quit
	
	
	//molde para o relatorio de historico de recebimento
RunReportHistoricoRecebimento(pDataInicial,pDataFinal,pLocal,pFornecedor,pMarca)
	; Report utilizado no Form "VARRecebimentoHistorico" que é utilizado para Recebimento de Incorporação/Produção.
	;
	
	new objRecInc, NomeUsuario
	
	set link=$$Start^VARJasperRun("VARRecebimentoHistorico")
	
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set pMarcaDesc = "Todas"
	if (pMarca = ""){
		set pMarcaDesc = $$GetBrandName^VARSQL(pMarca)
	}
	
	;set link=$$Start^VARJasperRun("VARSESEntradaRecebimento")
	;set link=$$addParameter^VARJasperRun(link,YKEY,1)
	;set link=$$addParameter^VARJasperRun(link,YBED,2)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set DataInicio = $ZDATE(pDataInicial,3)
	set DataFim = $ZDATE(pDataFinal,3)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicio",DataInicio)
	set link=$$addUserParameter^VARJasperRun(link,"DataFim",DataFim)
	set link=$$addUserParameter^VARJasperRun(link,"LocalPai",+pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"LocalPaiDesc",$$SQLGetLocationName^VARTCISQL(pLocal))
	set link=$$addUserParameter^VARJasperRun(link,"Marca",pMarca)
	set link=$$addUserParameter^VARJasperRun(link,"MarcaDesc",$$GetBrandName^VARSQL(pMarca))
	if (pFornecedor '= ""){
	     set link=$$addUserParameter^VARJasperRun(link,"BuscaFornecedor",pFornecedor)
	     set link=$$addUserParameter^VARJasperRun(link,"BuscaFornecedorDesc",$$SQLGetDescFornecedor^VARTCISQL(pFornecedor))
	     
	} else {
		     set link=$$addUserParameter^VARJasperRun(link,"BuscaFornecedor","")
		     set link=$$addUserParameter^VARJasperRun(link,"BuscaFornecedorDesc","")
	}
	
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, YKEY, "", "", "", "1", "").getHref()
	
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addUserParameter^VARJasperRun(link,"returnLink",retorno)
	
	;// Petik, 08/Out/2009 - This opens report in current window
	;vvvvv
	;do Run^VARJasperRun(link)
	
	;// Petik, 08/Out/2009 - This opens report in new @NM form "VARTCIViewReportInFrame" and report in an internal frame.
	;vvvv
	do ViewInForm^VARJasperRun(link,"Histórico de Recebimento")	
	
	
	quit
	
RunReportComprovanteEntrega(pIdIssue)
	;-------------------------------------------------------------------------------
	; This report is used in INIssue screen
	;     
	; Params:	pidIssue		Issue id
	;
	; History:
	; 19-Oct-2009	Karine		
	;-------------------------------------------------------------------------------
	new link
	new OrderBy
	set OrderBy = ""
	
	IF YBED'="" 
			{
			set User=YBED
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			} 
	else { 
		set User="NOUSER"
		}
		
	set link=$$Start^VARJasperRun("VARComprovanteEntrega")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"NoExpedicao",pIdIssue)
	
	if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
		if (classificarGrupo=1) {
			set OrderBy=$$addString(OrderBy,"")
		}
		if (classificarSeqCodDes=1) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(DispLinha.LineNumber)")
		} elseif (classificarSeqCodDes=2) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(DispLinha.Item)")
		} elseif (classificarSeqCodDes=3) {
			set OrderBy=$$addString(OrderBy," ORDER BY DescProduto")
		}
		
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}else{
		set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(DispLinha.LineNumber)")
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}
	
	do ViewInForm^VARJasperRun(link,"Comprovante de Entrega de Material")	
	
	quit
	

	//molde para o relatorio de nota de recebimento
RunReportNotaRecebimento(YKEY)
	; Report utilizado no Form "INReceipt" que é utilizado para Recebimento de Produtos sem Ordem.
	;
	new objRec, OrderBy
	set OrderBy = ""
	
	set objRec = $get(^INREC(YM,YKEY,1))
	set Tipo = $piece(objRec,Y,4)  // 1 - foi processado 
	
	IF YBED'="" 
			{
			set User=YBED
			// Andre, 15/02/2008:
			// Converte caracteres e acentuação presente no nome para código HTML que pode
			// ser usado em uma URL. Utiliza função $ZCONVERT, com tabela HTML:
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			//set NomeUsuario=$piece($get(^WWW013(YM,User,1)),Y,1)
			} 
	else { 
		set User="NOUSER"
		}
		
	if Tipo = 1 { // Processada
 
		set link=$$Start^VARJasperRun("VARRecebimentoDocumento")
		
	}
	;else {    //tipo = ""  Pré-Processada
	;	set link=$$Start^VARJasperRun("VARSESNotaPreRecIncorporacao")
	;}
	;set link=$$Start^VARJasperRun("VARSESEntradaRecebimento")
	set link=$$addParameter^VARJasperRun(link,YKEY,1)
	set link=$$addParameter^VARJasperRun(link,YBED,2)
	//set link=$$addParameter^VARJasperRun(link,NomeUsuario,3)
	// JORGE: passa o valor do YKEY para o relatorio
	set link=$$addUserParameter^VARJasperRun(link,"NumeroRecebimento", YKEY)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario", NomeUsuario) // Sósthenes: Passagem correta do parametro
	
	if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
		if (classificarGrupo=1) {
			set OrderBy=$$addString(OrderBy,"")
		}
		if (classificarSeqCodDes=1) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(InLine.LineNumber)")
		} elseif (classificarSeqCodDes=2) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(Item)")
		} elseif (classificarSeqCodDes=3) {
			set OrderBy=$$addString(OrderBy," ORDER BY Descricao")
		}
		
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}else{
		set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(InLine.LineNumber)")
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}
	
	do ViewInForm^VARJasperRun(link,"Nota de Recebimento")	
	
	quit
	

	//molde para o relatorio de certificado de registro cadastral
RunReportCRC(pcodFornecedor,pdteEmissao,pPGFN,pINSS,pFGTS,pEstadual,pMunicipal,pValidade,pPessoaFisica,pANVISA)
	; Report utilizado no Form "VAREmitirCRCFornecedor" que é utilizado para emitir o certificado de registro cadastral.
	
	new NomeLocal
	if ('pPessoaFisica) {
		set link=$$Start^VARJasperRun("VARCRCFornecedor")
	} else {
		set link=$$Start^VARJasperRun("VARCRCFornecedorPF")
	}
	
	;s NomeLocal = $piece($g(^COMTempList(YM,YUSER,"VARINMOVRelatorioLocais",movLocation,1)), Y, 1)
	
	set link=$$addUserParameter^VARJasperRun(link,"CodFornecedor", pcodFornecedor)
	set link=$$addUserParameter^VARJasperRun(link,"DataEmissao", $$^WWWTR(0,1,pdteEmissao))
	if ($get(pPGFN) '= ""){
		set link=$$addUserParameter^VARJasperRun(link,"PGFN", pPGFN)
	} else {
		set link=$$addUserParameter^VARJasperRun(link,"PGFN", "--")
	}
	if ($get(pINSS) '= "") {
		set link=$$addUserParameter^VARJasperRun(link,"INSS", pINSS)
	} else {
		set link=$$addUserParameter^VARJasperRun(link,"INSS", "--")
	}
	if ($get(pFGTS) '= "") {
		set link=$$addUserParameter^VARJasperRun(link,"FGTS", pFGTS)
	} else {
		set link=$$addUserParameter^VARJasperRun(link,"FGTS", "--")
	}
	if ($get(pEstadual) '= "") {
		set link=$$addUserParameter^VARJasperRun(link,"Estadual", pEstadual)
	} else {
		set link=$$addUserParameter^VARJasperRun(link,"Estadual", "--")	
	}
	set link=$$addUserParameter^VARJasperRun(link,"Municipal", pMunicipal)
	if ($get(pANVISA) '= "") {
		set link=$$addUserParameter^VARJasperRun(link,"ANVISA", pANVISA)
	} else {
		set link=$$addUserParameter^VARJasperRun(link,"ANVISA", "--")	
	}
	set link=$$addUserParameter^VARJasperRun(link,"Validade", pValidade)
	
	//Link do "Voltar"
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, "", "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Certificado de Registro Cadastral")	
	
	quit
	
RunReportTabelaREME()
	new todos
	set todos = 0
	
	if YBED'="" {
		set User=YBED
		set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
	} 
	else { 
		set User="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARREME")
	set link=$$addParameter^VARJasperRun(link,NomeUsuario,1)
	
	set markAB  = ""
	set markCE = ""
	set markAC  = ""
	set markHO  = ""
	set markCJ  = ""
	
	set optionAB  = $piece($get(^VARTempTabelaREME(YUSER)),Y,1)
	set optionCE  = $piece($get(^VARTempTabelaREME(YUSER)),Y,2)
	set optionAC  = $piece($get(^VARTempTabelaREME(YUSER)),Y,3)
	set optionHO  = $piece($get(^VARTempTabelaREME(YUSER)),Y,4)
	set ordenacao = $piece($get(^VARTempTabelaREME(YUSER)),Y,5)
	set idGrupo   = $piece($get(^VARTempTabelaREME(YUSER)),Y,6)
	set optionCJ  = $piece($get(^VARTempTabelaREME(YUSER)),Y,7)
	
	set strWhere = $$MontaWhere^VARREME(optionAB,optionCE,optionAC,optionHO,idGrupo,optionCJ)
 	
 	if ordenacao = 2 {
	 	set orderBy = "Descricao"
 	
 	} else { 
 		set orderBy = "Codigo"
 	}
 	
 	
	if optionAB '= 0 {
		set markAB = "x"
	}
		
	if optionCE '= 0 {
		set markCE = "x"
	}	
	if optionAC '= 0 {
		set markAC = "x"
	}	
	if optionHO '= 0 {
		set markHO = "x"
	}

	if optionCJ '= 0 {
		set markCJ = "x"
	}

	if ((optionAB = 0)&&(optionCE = 0)&&(optionAC = 0)&&(optionHO = 0)) {
		set todos = 1
	}

	set link = $$addParameter^VARJasperRun(link,markAB,6)
	set link = $$addParameter^VARJasperRun(link,markCE,7)
	set link = $$addParameter^VARJasperRun(link,markAC,8)
	set link = $$addParameter^VARJasperRun(link,markHO,9)	
	set link = $$addParameter^VARJasperRun(link,orderBy,10)
	set link = $$addUserParameter^VARJasperRun(link,"todos", todos)
	set link = $$addUserParameter^VARJasperRun(link,"strSQL", strWhere)
	set link = $$addUserParameter^VARJasperRun(link,"ReportParameter11", markCJ)

	
	set pForm = YFORM //Name of the form
	set pYKEY = YKEY //Key to the form
	set retorno = ##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", pForm, pYKEY, "", "", "", "1", "").getHref()
	set retorno = $$BackLink^VARJasperRun(retorno)
	
	set link = $$addParameter^VARJasperRun(link,retorno,20)
		
	do ViewInForm^VARJasperRun(link,"Elenco de Medicamentos")
	
 	quit
 
RunReportNotaRecebimentoFisico(YKEY)
	; Report utilizado no Form "INReceipt" utilizado para Recebimento de Produtos com dados Físicos.
	;
	new objRec, OrderBy
	set OrderBy = ""
	
	set objRec = $get(^INREC(YM,YKEY,1))
	set Tipo = $piece(objRec,Y,4)  // 1 - foi processado 
	
	IF YBED'="" 
			{
			set User=YBED
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			} 
	else { 
		set User="NOUSER"
		}
		
	if Tipo = 1 { // Processada
 
		set link=$$Start^VARJasperRun("VARRecebimentoDocumentoFisico")
		
	}
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"NumeroRecebimento", YKEY)
	
	if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
		if (classificarGrupo=1) {
			set OrderBy=$$addString(OrderBy,"")
		}
		if (classificarSeqCodDes=1) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(InLine.LineNumber)")
		} elseif (classificarSeqCodDes=2) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(InLine.Item)")
		} elseif (classificarSeqCodDes=3) {
			set OrderBy=$$addString(OrderBy," ORDER BY Descricao")
		}
		
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}else{
		set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(InLine.LineNumber)")
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}
	
	do ViewInForm^VARJasperRun(link,"Nota de Recebimento")	
	
	quit
	
RunReportDispPaciente(pYKEY)

	if pYKEY=""{
		quit
	}
	
	new OrderBy,objIssue, NomeUsuario, prescricao, objPrescription, idPaciente, objDispense
	set OrderBy = ""
	set objIssue = $G(^INIssue(YM,pYKEY,1))
	
	
	IF YBED'="" 
			{
			set User=YBED
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			} 
	else { 
		set User="NOUSER"
		}
	
	;Se o tipo da dispensação for igual a 3 - Dispensação]]><![CDATA[ para paciente
	;imprime o relató]]><![CDATA[rio específico de "Dispensação para paciente"
	
	if ($$$INIssueType(objIssue) = 3){
		set link=$$Start^VARJasperRun("VARDispPaciente")
		set link=$$addUserParameter^VARJasperRun(link,"pCodRecibo", pYKEY)
		set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
		
		if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
			if (classificarGrupo=1) {
				set OrderBy=$$addString(OrderBy,"")
			}
			if (classificarSeqCodDes=1) {
				set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INsLine.LineNumber)")
			} elseif (classificarSeqCodDes=2) {
				set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INsLine.Item)")
			} elseif (classificarSeqCodDes=3) {
				set OrderBy=$$addString(OrderBy," ORDER BY DescItem")
			}
		
			set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
			}else{
				set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INsLine.LineNumber)")
				set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
			}
		
		do ViewInForm^VARJasperRun(link,"Dispensação para paciente")
	
	} elseif ( ($$$INIssueType(objIssue) = 1)||($$$INIssueType(objIssue) = 5) ){
		
		set link=$$Start^VARJasperRun("VARMEDDispPaciente")
		set link=$$addUserParameter^VARJasperRun(link,"pCodRecibo", pYKEY)
		set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)

		do ViewInForm^VARJasperRun(link,"Dispensação para paciente")
		
	} else {
		set link=$$Start^VARJasperRun("VARDispensacao")
		set link=$$addUserParameter^VARJasperRun(link,"pCodRecibo", pYKEY)
		set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
		
		if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
			if (classificarGrupo=1) {
				set OrderBy=$$addString(OrderBy,"")
			}
			if (classificarSeqCodDes=1) {
				set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INsLine.LineNumber)")
			} elseif (classificarSeqCodDes=2) {
				set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INsLine.Item)")
			} elseif (classificarSeqCodDes=3) {
				set OrderBy=$$addString(OrderBy," ORDER BY DescItem")
			}
		
			set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
			}else{
				set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INsLine.LineNumber)")
				set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
			}
		
		do ViewInForm^VARJasperRun(link,"Consumo sem requisição")
	}
	
	quit


RunReportDispensacao(pYKEY)

	set link=$$Start^VARJasperRun("VARDispensacao")
	set link=$$addUserParameter^VARJasperRun(link,"pCodRecibo", pYKEY)
	
	//Link do "Voltar"
	set pForm=YFORM //Name of the form
	set pYKEY=YKEY //Key to the form
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", pForm, pYKEY, "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	do ViewInForm^VARJasperRun(link,"Consumo sem requisição")
	
	quit

	
RunReportDoacao(pYKEY)

	set link=$$Start^VARJasperRun("VARINADJDoacao")
	set link=$$addUserParameter^VARJasperRun(link,"pCodDoacao", pYKEY)
	
	//Link do "Voltar"
	set pForm=YFORM //Name of the form
	set pYKEY=YKEY //Key to the form
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", pForm, pYKEY, "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	do ViewInForm^VARJasperRun(link,"Doação")
	
	quit
	
RunReportPedidoCompra(pYKEY)

	if YBED'="" {
		set User=YBED
		set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
	} 
	else { 
		set User="NOUSER"
		set NomeUsuario="NOUSER"
	}
	set OrderBy = ""
	
	set strTipo = 0
	
	set folder = $piece($GET(^VARJasper(YM,YM,1)),Y,1) 
	
	set objCompra = $g(^VARPedidoCompra(0,pYKEY,1))
	
	if $length(objCompra > 0) {
		set strTipo = $$$VARPedidoCompraTipo(objCompra)
	}
	set link=$$Start^VARJasperRun("VARPedidoCompra")
	set link=$$addParameter^VARJasperRun(link,pYKEY,1)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pFlagTipo", strTipo)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir", folder)
	
	if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
		if (classificarGrupo=1) {
			set OrderBy=$$addString(OrderBy,"")
		}
		if (classificarSeqCodDes=1) {
			set OrderBy=$$addString(OrderBy," ORDER BY Seq")
		} elseif (classificarSeqCodDes=2) {
			set OrderBy=$$addString(OrderBy," ORDER BY ItemCod")
		} elseif (classificarSeqCodDes=3) {
			set OrderBy=$$addString(OrderBy," ORDER BY ItemDescricaoAbrev")
		}
		
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}else{
		set OrderBy=$$addString(OrderBy," ORDER BY 23, 31 asc")
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}
	
	//Link do "Voltar"
	//set pForm=YFORM //Name of the form
	//set pYKEY=YKEY //Key to the form
	//set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", pForm, pYKEY, "", "", "", "1", "").getHref()
	//set retorno=$$BackLink^VARJasperRun(retorno)
	//set link=$$addParameter^VARJasperRun(link,retorno,20)	
	do ViewInForm^VARJasperRun(link,"Pedido de compra")
	
	quit

RunReportLicenseGeneral(pDia)
	; Report ultilizado no form LicenseGeneralReport
	;
	
	new DataAtual, Periodo, folder
	
	set DataAtual = $p(+$horolog,",",1)
	
	set Periodo = +$p($g(^INPARA(0,"VARLICENSEPERIOD","PT",pDia,1)),"~",1)
	set ^zzSosthenes(1) = Periodo
	set folder=$piece($GET(^VARJasper(YM,YM,1)),Y,1)
	
	set link=$$Start^VARJasperRun("VARLicenseControlPeriod")
	set link=$$addUserParameter^VARJasperRun(link,"pDate", DataAtual)
	set link=$$addUserParameter^VARJasperRun(link,"pPeriodo", Periodo)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir", folder)
	
	//Link do "Voltar"
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, "", "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Controle geral de licenças")
	
	quit
	
RunReportLicenseInactives(pDia,pPerfil="")
	; Report ultilizado no form LicenseUserReport para usuário inativos. Valor inicial de dias, caso não definido pelo usuário
	; será 30
	
	new DataAtual, Periodo, Filtro
	
	set Filtro=""
	set DataAtual = $p(+$horolog,",",1)
	if pDia '="" {
		set Periodo = +$p($g(^INPARA(0,"VARLICENSEPERIOD","PT",pDia,1)),"~",1)
	} else { 
			set Periodo = "30"
	}
	if (pPerfil '="") {
		set Filtro = "AND WWW013.UserAccess ="_pPerfil_""
	}	
	set link=$$Start^VARJasperRun("VARControleAcessosInativos")
	set link=$$addUserParameter^VARJasperRun(link,"pDate", DataAtual)
	set link=$$addUserParameter^VARJasperRun(link,"pPeriodo", Periodo)
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro", Filtro)
	
	//Link do "Voltar"
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, "", "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Controle de usuários inativos")
	
	quit
	
RunReportLicenseUserList(pPerfil="")
	;Report ultilizado no form LicenseUserReport para listagem de usuários cadastrados no sistema.

	new Filtro, TipoF
	
	set TipoF = "Sem filtro"
	set Filtro = ""
	
	if (pPerfil'="") {
		set Filtro = "AND WWW013.UserAccess ="_pPerfil_""
		set TipoF = "por Perfil"
	}
	set link=$$Start^VARJasperRun("VARControleAcessosListaUsuarios")
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro", Filtro)
	set link=$$addUserParameter^VARJasperRun(link,"pTipoF", TipoF)
	
	//Link do "Voltar"
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, "", "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Controle de usuários registrados")
	
	quit
	
RunReportLicenseProfileMonthlyAccess(pDataI,pDataF,pPerfil)
	
	new Filtro
	
	set Filtro = ""
	
	if (pPerfil'="") {
		set Filtro = "HAVING WWW013.UserAccess IN ("_pPerfil_")"
	}
	set link=$$Start^VARJasperRun("VARControleAcessosMesPerfil")
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro", Filtro)
	set link=$$addUserParameter^VARJasperRun(link,"pDataInicial", pDataI)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFinal", pDataF)
	
	//Link do "Voltar"
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, "", "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Mensal de controle por perfil")

 quit
 
RunReportLicenseLocAccessControl(pDataI,pDataF,pLocal)

 	new Filtro
	
	set Filtro = ""
	
	set i = 1
	
	if (pLocal'="") {
		set countVorg = $length(pLocal,",")
			for i = i:1:countVorg { 
				set $p(^VARTempLicense(YM,YUSER,i,1),Y,1) = $p(pLocal,",",i)
		}	
		set Filtro = "AND Location IN (LocaisTemp.LocationNumber) AND Session = "_YUSER_""
	}
	set link=$$Start^VARJasperRun("VARControleAcessosLocal")
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro", Filtro)
	set link=$$addUserParameter^VARJasperRun(link,"pDataInicial", pDataI)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFinal", pDataF)
	
	//Link do "Voltar"
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, "", "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Controle de acessos por local")

 quit
 
RunReportLocAccessControlDetail(pDataI,pDataF,pLocal)
 
  	new Filtro, folder
  	
	
	set Filtro = ""
	
	set folder=$piece($GET(^VARJasper(YM,YM,1)),Y,1)
	
	set i = 1
	
	if (pLocal'="") {
		set countVorg = $length(pLocal,",")
			for i = i:1:countVorg { 
				set $p(^VARTempLicense(YM,YUSER,i,1),Y,1) = $p(pLocal,",",i)
		}	
		set Filtro = "AND Location IN (LocaisTemp.LocationNumber) AND Session = "_YUSER_""
	}
	set link=$$Start^VARJasperRun("VARControleAcessosPeriodo")
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro", Filtro)
	set link=$$addUserParameter^VARJasperRun(link,"pDataInicial", pDataI)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFinal", pDataF)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir", folder)
	
	//Link do "Voltar"
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, "", "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Controle de acessos por local e usuário")

 quit
 
RunReportLocAccessControlDaily(pLocal="")

	new DataAtual, Filtro
	
	set i = 1
	
	if (pLocal'="") {
		set countVorg = $length(pLocal,",")
			for i = i:1:countVorg { 
				set $p(^VARTempLicense(YM,YUSER,i,1),Y,1) = $p(pLocal,",",i)
		}	
		set Filtro = "AND HomeLocation IN (LocaisTemp.LocationNumber) AND Session = "_YUSER_""
	} else { 
		set Filtro = "AND HomeLocation IN ("_YLOCATION_")"
	}
	
	set DataAtual = +$horolog
	
	set link=$$Start^VARJasperRun("VARControleAcessosDiario")
	set link=$$addUserParameter^VARJasperRun(link,"pDate", DataAtual)
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro", Filtro)
	
	
	//Link do "Voltar"
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, "", "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Controle de acessos por local do dia")
	
	quit
	
RunReportLicenseCurAccess()
	
	new DataAtual, Filtro
	
	set Filtro = ""
	set DataAtual = +$h
	
	set Sessoes = $$LoadCurActiveUsers^VARLicenseUserAccessReport()
	
	if (Sessoes '= "") {
		set Filtro = "HAVING UserNumber IN ("_Sessoes_")"
	}
	set link=$$Start^VARJasperRun("VARControleAcessosCorrentes")
	set link=$$addUserParameter^VARJasperRun(link,"pData", DataAtual)
	set link=$$addUserParameter^VARJasperRun(link,"pSessoes", Filtro)
	
	
	//Link do "Voltar"
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, "", "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Controle de acessos por local do dia")
	
	k ^VARTempActiveUsers
	
 quit

RunReportNotaDevolucao(pYKEY)
    ; Relatório VARNotaDevolucao.jrxml utilizado no form INIssueRev
    ;
    ;Histórico
    ;2010-03-24	Sósthenes	Created
    
    new OrderBy
	set OrderBy = ""
	
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARNotaDevolucao")
	set link=$$addUserParameter^VARJasperRun(link,"pNoDoc", pYKEY)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario", NomeUsuario)
	
	if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
		if (classificarGrupo=1) {
			set OrderBy=$$addString(OrderBy,"")
		}
		if (classificarSeqCodDes=1) {
			set OrderBy=$$addString(OrderBy,"")
		} elseif (classificarSeqCodDes=2) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INRevLine.ItemNo)")
		} elseif (classificarSeqCodDes=3) {
			set OrderBy=$$addString(OrderBy," ORDER BY DescItem")
		}
	}else{
		set OrderBy=$$addString(OrderBy,"")
	}
	set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)

	do ViewInForm^VARJasperRun(link,"Nota de devolução")
	
	quit
	
RunReportCompra(pYKEY)

	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARCompra")
	set link=$$addUserParameter^VARJasperRun(link,"CodCompra",pYKEY)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario", NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pCNPJ", $$$WWW012UniqueCompanyIdentifier(^WWW012(0,0,1)))
		
	//Link do "Voltar"
	set pForm=YFORM //Name of the form
	set pYKEY=YKEY //Key to the form
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", pForm, pYKEY, "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	do ViewInForm^VARJasperRun(link,"Ordem de fornecimento")
	
	quit
	
RunReportHistoricoPrecos(pYKEY)

	set link=$$Start^VARJasperRun("VARHistoricoPrecos")
	set link=$$addUserParameter^VARJasperRun(link,"idItem",pYKEY)
		
	//Link do "Voltar"
	set pForm=YFORM //Name of the form
	
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", pForm, pYKEY, "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	
	set folder		=	$piece($GET(^VARJasper(YM,YM,1)),Y,1)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir",folder)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",YBED)
	
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	do ViewInForm^VARJasperRun(link,"Histórico de Preços")
	
	quit
	
RunReportEstimativaPreco(pYKEY,pFileName="",pViewInForm=1)
	new httprequest
	
	set faxSetorCompras = $$getFaxSetorCompra^VARParametroCliente(YM)
	
	set link=$$Start^VARJasperRun("VARBancoPrecoEstimativa",pFileName)
	set link=$$addUserParameter^VARJasperRun(link,"pNoDoc",pYKEY)
	set link=$$addUserParameter^VARJasperRun(link,"pNoFax",faxSetorCompras)
	
	//Link do "Voltar"
	set pForm=YFORM //Name of the form
	set pYKEY=YKEY //Key to the form
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", pForm, pYKEY, "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	if (pViewInForm) {
        do ViewInForm^VARJasperRun(link,"Estimativa de Preços")
    } else {
        ;do Run^VARJasperRun(link)
        do CreateReport^VARJasperRun(link)
        /*Set httprequest=##class(%Net.HttpReq]]><![CDATA[uest).%New()
        Set httprequest.Server=""
        Do httprequest.Get(link)*/
    }
    
    quit
	
RunReportMapaComparativo(pYKEY)

 	
	set folder=$piece($GET(^VARJasper(YM,YM,1)),Y,1)
	
	IF YBED'="" 
			{
			set User=YBED
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			} 
	else { 
		set User="NOUSER"
		}
	
	set link=$$Start^VARJasperRun("VARMapaComparativo")
	set link=$$addUserParameter^VARJasperRun(link,"noDoc",pYKEY)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir",folder)
	
	do ViewInForm^VARJasperRun(link,"Mapa Comparativo")
	
RunReportTransfAceite(pYKEY)
	new OrderBy
	set OrderBy = ""
	
	new DescLocal
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else { 
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if YLOCATION '="" {
		set DescLocal = YLOCATION_" - "_$piece($get(^WWW0121(0,0,YLOCATION,1)),"~",1)
	}
	
	set link=$$Start^VARJasperRun("VARTransfAceite")
	set link=$$addUserParameter^VARJasperRun(link,"pCodRec", pYKEY)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario", NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pDescLocal", DescLocal)
	
	if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
		if (classificarGrupo=1) {
			set OrderBy=$$addString(OrderBy,"")
		}
		if (classificarSeqCodDes=1) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INRECLine.LineNumber)")
		} elseif (classificarSeqCodDes=2) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INRECLine.Item)")
		} elseif (classificarSeqCodDes=3) {
			set OrderBy=$$addString(OrderBy," ORDER BY INRECLine.ItemDescription")
		}
		
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}else{
		set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INRECLine.LineNumber)")
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}
	
	do ViewInForm^VARJasperRun(link,"Aceite de transferência")
	
	quit
	
RunReportMovLocal(pYKEY)

	IF YBED'="" 
			{
			set User=YBED
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			} 
	else { 
		set User="NOUSER"
		}

	set link=$$Start^VARJasperRun("VARMovEstoqueLocal")
	set link=$$addUserParameter^VARJasperRun(link,"NoMov", pYKEY)
	set link=$$addUserParameter^VARJasperRun(link,"pUsuario", User)
	set link=$$addUserParameter^VARJasperRun(link,"pDescUsuario", NomeUsuario)
	
	do ViewInForm^VARJasperRun(link,"Movimentação Estoque Local")
	
	quit
	
RunReportHistoricoCompra(pYKEY)
    ; -------------------------------------------------------------------------
	; VARHistoricoCompra.jrxml (Materiais > Relatórios Gerenciais > Relatório de AFMs)
	; 
	; History
	; 2010-Sep-09	Marcelo Jardim	Copied from SES (VARSESTempRelAFMGerencial)
	; 2009-Sep-07	Karine	Created
	;----------------------------------------------------------------------
	new login,userName, objFiltros,vCodProduto, vGrupo,vFornecedor, vDataInicial,
	vDataFinal,vDescProduto, vDescGrupo, vDescFornecedor, vDescGrupo, vFormato, NomeOrdenacao
	
  	set usuario = $get(YBED)
  	if (YBED'="") {
		set login=YBED
		set userName=$$SQLGetUserName^VARSQL(login)
	}
	else  { 
		set login="NOUSER"
		set userName=""
	}
	
  	set objFiltros = $get(^VARTempHistoricoCompraFiltro(YM,usuario))
    //Filter for query
 	set vCodProduto   = $piece(objFiltros,Y,1)
	set vGrupo        = $piece(objFiltros,Y,2)
	set vFornecedor   = $piece(objFiltros,Y,3)
	if ($piece(objFiltros,Y,4) '= ""){
		set vDataInicial  = $zdate($piece(objFiltros,Y,4),4)
	}
	else {
		set vDataInicial  = "-"
	}
	if ($piece(objFiltros,Y,5) '= ""){
		set vDataFinal    = $zdate($piece(objFiltros,Y,5),4)
	}
	else {
		set vDataFinal    = "-"
	}
	set vOrdernarPor  = $piece(objFiltros,Y,6)
	set vFormato	  = $piece(objFiltros,Y,8)
	;set vContabil	  = $piece(objFiltros,Y,9)
	;set vUnGestora	  = $piece(objFiltros,Y,10)
	set vSaldo		  = $piece(objFiltros,Y,11)
	;set vPrograma	  = $piece(objFiltros,Y,12)
	
	if vCodProduto '= "" {
		set vDescProduto = $$SQLGetDescricaoProduto^VARSQL(vCodProduto)	
	} 
	else {
		set vDescProduto = " "  ; para não aparecer a palavra null no report
	}	
  	
  	if vGrupo '= "" {
	  	set vDescGrupo = $$SQLGetDescGrupoItem^VARSQL(vGrupo)	
  	} else {
		set vDescGrupo = " "
  	}
  	
  	if vFornecedor '= "" {
	  	set vDescFornecedor = $$SQLGetDescFornecedor^VARSQL(vFornecedor)
	}else {
		set vDescFornecedor = "  "
	}

	if vSaldo '= "" {
		set descSaldo = $$SQLGetUserParamDescVAR^VARSQL("SALDOHISTCOMPRA~"_vSaldo)
	}
	else {
		set descSaldo = "Todos"
	}
	
	if vOrdernarPor '= "" {
		
		if (vOrdernarPor = 1) {
			set vpOrdenarPor = "NumeroAFM"
			set NomeOrdenacao = "Ordem de Compra"
		}
		if (vOrdernarPor = 2) {
			set vpOrdenarPor = "DataEmissao"
			set NomeOrdenacao = "Data de Emissão"
		}
		if (vOrdernarPor = 5) {
			set vpOrdenarPor = "DescFornecedor"
			set NomeOrdenacao = "Fornecedor"
		}
		if (vOrdernarPor = 6) {
			set vpOrdenarPor = "CodProduto"
			set NomeOrdenacao = "Código do Produto"
		}
		if (vOrdernarPor = 7) {
			set vpOrdenarPor = "DescProduto"
			set NomeOrdenacao = "Descrição do Produto"
		}
		if (vOrdernarPor = 8) {
			set vpOrdenarPor = "GrupoProduto"
			set NomeOrdenacao = "Grupo"
		}
		
		;não estão sendo usados no HEVA
		;if (vOrdernarPor = 3) { set vpOrdenarPor = "NumeroEmpenho" } ;Empenho
		;if (vOrdernarPor = 4) { set vpOrdenarPor = "DtEntregaNE" }  ;Data de Entrega da NE	
	}
	else {
		
		set vpOrdenarPor = "NumeroAFM"	
		set NomeOrdenacao = "Ordem de Compra"
		
	}


	if (vFormato = "") || (vFormato = 1) {
		
	set link=$$Start^VARJasperRun("VARHistoricoCompra")
	set link=$$addUserParameter^VARJasperRun(link,"usuario",usuario)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",userName)
	set link=$$addUserParameter^VARJasperRun(link,"CodProduto",vCodProduto)
	set link=$$addUserParameter^VARJasperRun(link,"Grupo",vGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"Fornecedor",vFornecedor)
	set link=$$addUserParameter^VARJasperRun(link,"DtInicial",vDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DtFinal",vDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"descProduto",vDescProduto)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",vDescGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descFornecedor",vDescFornecedor)
	set link=$$addUserParameter^VARJasperRun(link,"descSaldo",descSaldo)
	set link=$$addUserParameter^VARJasperRun(link,"OrdenarPor",NomeOrdenacao)
	
	set link=$$addUserParameter^VARJasperRun(link,"Agrupador",vpOrdenarPor)
	
			
	do ViewInForm^VARJasperRun(link,"Historico de Compra")
	
	} else {
		
	set link=$$Start^VARJasperRun("VARHistoricoCompraSimplificado")
	set link=$$addUserParameter^VARJasperRun(link,"usuario",usuario)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",userName)
	set link=$$addUserParameter^VARJasperRun(link,"CodProduto",vCodProduto)
	set link=$$addUserParameter^VARJasperRun(link,"Grupo",vGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"Fornecedor",vFornecedor)
	set link=$$addUserParameter^VARJasperRun(link,"DtInicial",vDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DtFinal",vDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"descProduto",vDescProduto)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",vDescGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descFornecedor",vDescFornecedor)
	set link=$$addUserParameter^VARJasperRun(link,"descSaldo",descSaldo)
	set link=$$addUserParameter^VARJasperRun(link,"OrdenarPor",NomeOrdenacao)
	
	set link=$$addUserParameter^VARJasperRun(link,"Agrupador",vpOrdenarPor)
	
	do ViewInForm^VARJasperRun(link,"Historico de Compra")

	}

 
	quit
	
RunReportPacientesAtendidos(pidLocal,pDtInicial,pDtFinal,pProduto,pidCentroCusto,pidGrupo)
	new user, nomeUsuario, link, strWhere, fldidLocal, pCentroCusto, pGrupo
	set strWhere = ""
	
	set fldidLocal	 = "Todos"
	set pCentroCusto = "Todos"
	set pGrupo		 = "Todos"
	
  	if (YBED'="") {
		set login=YBED
		set nomeUsuario=$$SQLGetUserName^VARSQL(login)
	} else { 
		set login="NOUSER"
		set nomeUsuario=""
	}
	
	if ($length(pidLocal) '= 0){
		set strWhere = strWhere_" AND INIssue.FromLocn = '"_pidLocal_"' "
		set fldidLocal = pidLocal_" - "_$$SQLGetLocationName^VARSQL(pidLocal)
	}
	
	if ($length(pidCentroCusto) '= 0){
		set strWhere = strWhere_" AND $$getCentroCustoAdmissao^VARSQL(INISsue.IssueNumber) = '"_pidCentroCusto_"' "
		set pCentroCusto = pidCentroCusto_" - "_$$SQLGetLocationName^VARSQL(pidCentroCusto)
	}
	
	if ($length(pidGrupo) '= 0){
		set strWhere = strWhere_" AND $$SQLGetGrupoItem^VARSQL(INIssueLine.Item) = '"_pidGrupo_"' "
		set pGrupo = pidGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pidGrupo)
	}
	
	if (pProduto = ""){
		set link=$$Start^VARJasperRun("VARPacientesAtendidos")
	} else {
		set link=$$Start^VARJasperRun("VARPacientesAtendidosPorProduto")
		set link=$$addUserParameter^VARJasperRun(link,"pProduto", pProduto)
		set link=$$addUserParameter^VARJasperRun(link,"pDescProduto", pProduto_" - "_$$SQLGetDescricaoProduto^VARSQL(pProduto))
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",login)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idLocal", pidLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pCentroCusto", pCentroCusto)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo", pGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere", strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"DtInicial", pDtInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DtFinal", pDtFinal)
	set link=$$addUserParameter^VARJasperRun(link,"fldDtInicial", $zdate(pDtInicial,4,,4))
	set link=$$addUserParameter^VARJasperRun(link,"fldDtFinal", $zdate(pDtFinal,4,,4))
	set link=$$addUserParameter^VARJasperRun(link,"fldidLocal", fldidLocal)
	
	do ViewInForm^VARJasperRun(link,"Relatório de Pacientes Atendidos")
 
	quit

RunReportRelacaoContrato(pCategoria)
	; -------------------------------------------------------------------------
	; History
	; 2008-Oct-22	heber:Created
	; 2010-Sep-13   Copied from SES - Marcelo Jardim
	; 2012-May-17	Completely refactored
	;----------------------------------------------------------------------
	new login, NomeUsuario, link, filtroCategoria
	
  	if (YBED'="") {
		set login=YBED
		set NomeUsuario=$$SQLGetUserName^VARSQL(login)
	}
	else  { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARRelacaoContrato")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	if (pCategoria '= "") {
		set filtroCategoria = " AND Categoria = "_ pCategoria
		set link=$$addUserParameter^VARJasperRun(link,"FiltroCategoria",filtroCategoria)
	} else {
		set link=$$addUserParameter^VARJasperRun(link,"FiltroCategoria","")
	}
	do ViewInForm^VARJasperRun(link,"Relatório de Relação de Contratos")

	quit
	
RunReportEstoqueContabil()
	set strFiltro = $get(VORG(1))
	set filterProduto = $get(VORG(2))
	set strGroupBy = ""
	set pWhere = ""
	
	set usuario = $get(YBED)
  	if (YBED'="") {
		set login=YBED
		set userName=$$SQLGetUserName^VARSQL(login)
	}
	else  { 
		set login="NOUSER"
		set userName=""
	}
	
 	if (filterProduto = 1) { ;INTERNO/SES
 		set pWhere = pWhere_"AND FREE19 is null AND FREE20 is null "
 	}

 	elseif (filterProduto = 2) { ;EXTERNO/MS
 		set pWhere = pWhere_"AND FREE19 is not null OR INART.FREE20 is not null "
 	} 
	
	if (strFiltro = "") {
		set strFiltro = "1"
	} 
	
	if (strFiltro = "1") {
		set strGroupBy = "GROUP BY Location, ItemGroup"
	} 
	
	if (strFiltro = "2") {
		set strGroupBy = "GROUP BY Location, $$SQLGetGrupoPai^VARSQL($$SQLGetGrupoItem^VARSQL(ItemNumber))"
	}
	
	set strFiltro = strFiltro_" AND +alSOH.dBundleStock.QtyOnHand > 0 "
	set strFiltro = strFiltro_" AND alSOH.dBundleStock.Storage->Code <> ""EmTransito"" "
	
	if (strFiltro = "1") {
		set link=$$Start^VARJasperRun("VAREstoqueContabil")
	}
	else {
		set link=$$Start^VARJasperRun("VAREstoqueContabilGrupoPai")
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro", strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pWhere", pWhere)
	set link=$$addUserParameter^VARJasperRun(link,"pGroupBy", strGroupBy)
	set link=$$addUserParameter^VARJasperRun(link,"usuario",usuario)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",userName)
	set link=$$addUserParameter^VARJasperRun(link,"pOrdenacao", $$SQLGetUserParamDescVAR^VARSQL("TIPORESUMOCONTABIL~"_$get(VORG(1))))			
	set link=$$addUserParameter^VARJasperRun(link,"pProduto", $$SQLGetUserParamDescVAR^VARSQL("TIPOPRODUTO~"_$get(VORG(2))))			
   	do ViewInForm^VARJasperRun(link,"Estoque Contábil")	
	
	quit
	
RunReportHistAtendimentoPacient(pDtInicial,pDtFinal,pCodPaciente,pCodLocal,pCodProduto,pGrupoProduto)
	new user, nomeUsuario, link,
	paramDtInicial,paramDtFinal,paramNomePaciente,paramLocal,paramProduto,paramGrupo

	if YBED'="" {
		set user=YBED
		set nomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
	}else{ 
		set user="NOUSER"
		set nomeUsuario="NOUSER"
	}
	set paramDtInicial		= $zdate(pDtInicial,4)
	set paramDtFinal		= $zdate(pDtFinal,4)
	set paramNomePaciente	= $$SQLGetPacienteName^VARTRKSQL(pCodPaciente)
	set paramLocal			= $$SQLGetLocationName^VARTRKSQL(pCodLocal)
	set paramProduto		= $$SQLGetDescricaoProduto^VARTRKSQL(pCodProduto)
	set paramGrupo			= $$SQLGetDescGrupoItem^VARTRKSQL(pGrupoProduto)
	set link=$$Start^VARJasperRun("VARHistAtendimentoPaciente")
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",user)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"DtInicial", pDtInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DtFinal", pDtFinal)
	set link=$$addUserParameter^VARJasperRun(link,"CodPaciente", pCodPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"CodLocal", pCodLocal)
	set link=$$addUserParameter^VARJasperRun(link,"CodProduto", pCodProduto)
	set link=$$addUserParameter^VARJasperRun(link,"GrupoProduto", pGrupoProduto)
	set link=$$addUserParameter^VARJasperRun(link,"paramDtInicial", paramDtInicial)
	set link=$$addUserParameter^VARJasperRun(link,"paramDtFinal", paramDtFinal)
	set link=$$addUserParameter^VARJasperRun(link,"paramNomePaciente", paramNomePaciente)
	set link=$$addUserParameter^VARJasperRun(link,"paramLocal", paramLocal)
	set link=$$addUserParameter^VARJasperRun(link,"paramProduto", paramProduto)
	set link=$$addUserParameter^VARJasperRun(link,"paramGrupo", paramGrupo)
	do ViewInForm^VARJasperRun(link,"Hitórico de Atendimento ao Paciente")
 
	quit
	
	//Reports - Inventary - Copied from SES - 04-oct-2010 - Marcelo Jardim
	
addString(pOldString,pNewString,pSeparator=",")
	; Adds a new string to a String sequence prepending the pSeparator if the pOldString is either not "" or undefined.
	; History:
	; 2008-Mar-06	Soeiro:	created
	; 2010-Oct-04   Marcelo Jardim - Copied from SES
	new result
	
	if (('$DATA(pNewString)) || (pNewString="")) {
		quit ""
	}
 
	if ('$DATA(pSeparator)) {
		set pSeparator=""
	}
	
	if ('$DATA(pOldString) || (pOldString="")) {
		set result=pNewString
	} else {
		set result=pOldString_pSeparator_pNewString
	}
	
	quit result	
	
getNomeUsuario(login,YM=0)
	if ($get(login)'="") {
		quit $piece($get(^WWW013(YM,login,1)),"~",1)
	}
	quit ""	
	
getDescricaoInventario(codInventario)
	new res,obj
	set res=""
	if ($get(codInventario)'="") {
		set obj=$get(^INWEINVP(0,codInventario,1))
		if (obj'="") set res=$$$INWEINVPRemark(obj)
	}
	quit res
	
RunReportDigitacaoRealizada(codInventario,numeroContagem)
	;-------------------------------------------------------------
	; Gera o relatório de INventário: Digitação realizada, para contagem do inventário
	; Atenção: os valores desejados de YKEY e YFORM estão nas variáveis
	; - valorYKEY: YKEY utilizada pra geração do relatório
	; - valorYFORM: YFORM tela que foi utilizada pra geração do relatório
	; 
	; As variáveis YKEY e YFORM contém o usuário ATUAL e o FORM ATUAL que
	; muito provavelmente são apenas da tela de filtro!
	; 
	; Essa rotina está sendo chamada indiretamente através da VARSESINWEINVD
	; 
	; 
	; 1º) classificarGrupo= 0:não, 1:sim
	; 2º) classificarCodDes= 1:Código produto, 2: Descrição produto
	;
	;Histórico:
	;2010-oct-04	Marce]]><![CDATA[lo Jardim Copied from SES
	;2008-]]><![CDATA[Apr-28	Soeiro	Correção da ordenação
	;2008-01-08		Karine	Alteração
	;XXXXXXXXXXX	Karine 	Correção em : Report.VARSESDigitacaoRealizada.cls
	;2008-jan-16	Karine	Created
	
	
	new login, nomeUsuario, link, orderBy, codLocal, descLocal, returnLink
	new numeroInventario, descricaoInventario
	set login=""
	set nomeUsuario=""
	set link=""
	set orderBy=""
	set codLocal=""
	set descLocal=""
	set returnLink=""
	set descricaoInventario=""
	IF YBED'="" {
		set login=YBED
		set nomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	IF YLOCATION'="" {
		set codLocal = YLOCATION
		set descLocal=$piece(^WWW0121(YM,YM,YLOCATION,1),Y,1)
	}
 
	set link=$$Start^VARJasperRun("VARInventarioDigitacaoRealizada")
	set link=$$addUserParameter^VARJasperRun(link,"codLocal",YLOCATION)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"login",login)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
 
	set descricaoInventario=$$getDescricaoInventario(codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"descricaoInventario",descricaoInventario)
	
	set link=$$addUserParameter^VARJasperRun(link,"codInventario",codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"numeroContagem",$get(numeroContagem))
 
 	//Ordenação, primeiro
	set orderBy=""
	if ($get(classificarGrupo)=1) {
		set orderBy=$$addString(orderBy,"$$SQLGetGrupoParaOrdenar^VARSQL($$SQLGetGrupoItem^VARSQL(it.ItemNumber))")
	}
	
	//Ordenação, segunda parte
	if ($get(classificarCodDes)=2) {
		set orderBy=$$addString(orderBy,"$$SQLGetDescricaoProduto^VARSQL(it.ItemNumber)")
	} else {
	
	//Caso 1, ou nada (padrão)
		set orderBy=$$addString(orderBy,"TONUMBER(it.ItemNumber)")
	} 
	
	set link=$$addUserParameter^VARJasperRun(link,"orderBy",orderBy)
	
	do ViewInForm^VARJasperRun(link,"Digitação Realizada")	
	quit
 
RunReportItensNaoDigitados(codInventario,numeroContagem)
	;-------------------------------------------------------------
	; Gera o relatório de Mapa de COntagem, para contagem do inventário
	; Atenção: os valores desejados de YKEY e YFORM estão nas variáveis
	; - valorYKEY: YKEY utilizada pra geração do relatório
	; - valorYFORM: YFORM tela que foi utilizada pra geração do relatório
	; 
	; As variáveis YKEY e YFORM contém o usuário ATUAL e o FORM ATUAL que
	; muito provavelmente são apenas da tela de filtro!
	; 
	; Essa rotina está sendo chamada indiretamente através da VARSESINWEINVD
	; 
	; 
	; 1º) classificarGrupo= 0:não, 1:sim
	; 2º) classificarCodDes= 1:Código produto, 2: Descrição produto
	;
	;Histórico:
	;2010-oct-04	Marcelo Jardim Copied from SES
	;2008-Apr-25	Soeiro	Completely rewritten
	;2008-Apr-25	Soeiro	Bugfix: there were no parameters!
	;XXXXXXXXXXX	Karine 	Corrreção em : Report.VARSESDigitacaoRealizada.cls
	;2008-jan-16	Karine	Created
		
	new login, nomeUsuario, link, orderBy, codLocal, descLocal, returnLink
	new numeroInventario, descricaoInventario
	set login=""
	set nomeUsuario=""
	set link=""
	set orderBy=""
	set codLocal=""
	set descLocal=""
	set returnLink=""
	set descricaoInventario=""
	
	if YBED'="" {
		set login=YBED
		set nomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	if YLOCATION'="" {
		set descLocal=$piece(^WWW0121(YM,YM,YLOCATION,1),Y,1)
	}
 
	set link=$$Start^VARJasperRun("VARInventarioItensNaoDigitados")
	set link=$$addUserParameter^VARJasperRun(link,"codLocal",YLOCATION)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"login",login)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set descricaoInventario=$$getDescricaoInventario(codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"descricaoInventario",descricaoInventario)
	set link=$$addUserParameter^VARJasperRun(link,"codInventario",codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"numeroContagem",$get(numeroContagem))
 
	//Ordenação, primeiro
	set orderBy=""
	if ($get(classificarGrupo)=1) {
		set orderBy=$$addString(orderBy,"$$SQLGetGrupoParaOrdenar^VARSQL($$SQLGetGrupoItem^VARSQL(it.ItemNumber))")
	}
	
	//Ordenação, segunda parte
	if ($get(classificarCodDes)=2) {
		set orderBy=$$addString(orderBy,"$$SQLGetDescricaoProduto^VARSQL(it.ItemNumber)")
	} else {
	
	//Caso 1, ou nada (padrão)
		set orderBy=$$addString(orderBy,"TONUMBER(it.ItemNumber)")
	} 
	
 	set link=$$addUserParameter^VARJasperRun(link,"orderBy",orderBy)
	
	do ViewInForm^VARJasperRun(link,"Itens Não Digitados")
	quit
	
RunReportMapaDeContagem(codInventario,numeroContagem)
	;-------------------------------------------------------------
	; Gera o relatório de Mapa de COntagem, para contagem do inventário
	; Atenção: os valores desejados de YKEY e YFORM estão nas variáveis
	; - valorYKEY: YKEY utilizada pra geração do relatório
	; - valorYFORM: YFORM tela que foi utilizada pra geração do relatório
	; 
	; As variáveis YKEY e YFORM contém o usuário ATUAL e o FORM ATUAL que
	; muito provavelmente são apenas da tela de filtro!
	; 
	; Essa rotina está sendo chamada indiretamente através da VARSESINWEINVD
	; 
	; 
	; 1º) classificarGrupo= 0:não, 1:sim
	; 2º) classificarCodDes= 1:Código produto, 2: Descrição produto
	;
	;Histórico:
	;2010-oct-04	Marcelo Jardim Copied from SES
	;2008-Apr-23	Soeiro	Alteração para uso de filtros de classificação
	;2008-Mar-24	Soeiro	Criação
	
	new login, nomeUsuario, link, orderBy, codLocal, descLocal, returnLink
	new numeroInventario, descricaoInventario
	set login=""
	set nomeUsuario=""
	set link=""
	set orderBy=""
	set codLocal=""
	set descLocal=""
	set returnLink=""
	set descricaoInventario=""
	
	if YBED'="" {
		set login=YBED
		set nomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	if YLOCATION'="" {
		set descLocal=$piece(^WWW0121(YM,YM,YLOCATION,1),Y,1)
	}
 
	set link=$$Start^VARJasperRun("VARInventarioMapaDeContagem")
	set link=$$addUserParameter^VARJasperRun(link,"codLocal",YLOCATION)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"login",login)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set descricaoInventario=$$getDescricaoInventario(codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"descricaoInventario",descricaoInventario)
	set link=$$addUserParameter^VARJasperRun(link,"codInventario",codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"numeroContagem",$get(numeroContagem))
 
	set orderBy=""
	
	//Ordenação dos dados
	
	if ($get(classificarGrupo)=1) { //Ordernação por Grupo
		set orderBy=$$addString(orderBy,"$$SQLGetGrupoParaOrdenar^VARSQL($$SQLGetGrupoItem^VARSQL(it.ItemNumber))")
	}
	
	if ($get(classificarCodDes)=2) {
		set orderBy=$$addString(orderBy,"$$SQLGetDescricaoProduto^VARSQL(it.ItemNumber)")
	} 
	elseif ($get(classificarCodDes)=3) {
		
		set orderBy=$$addString(orderBy,"it.StockLocation")
	//Caso 1, ou nada (padrão)
	}
	elseif ($get(classificarCodDes)=1) {
	
		set orderBy=$$addString(orderBy,"TONUMBER(it.ItemNumber)")
	} 
	
 	set link=$$addUserParameter^VARJasperRun(link,"orderBy",orderBy)
	
	do ViewInForm^VARJasperRun(link,"Mapa de Contagem")
	quit

RunReportDivergenciaContagem(codInventario,numeroContagem)
	;-------------------------------------------------------------
	; Gera o relatório de Inventário: Divergência de contagem, que mostra somente itens 
	; cuja contagem diverge da quantidade em estoque na data da contagem.
	; - valorYKEY: YKEY utilizada pra geração do relatório
	; - valorYFORM: YFORM tela que foi utilizada pra geração do relatório
	; 
	; As variáveis YKEY e YFORM contém o usuário ATUAL e o FORM ATUAL que
	; muito provavelmente são apenas da tela de filtro!
	; 
	; Essa rotina está sendo chamada indiretamente através da VARSESINWEINVD
	; 
	; 
	; 1º) classificarGrupo= 0:não, 1:sim
	; 2º) classificarCodDes= 1:Código produto, 2: Descrição produto
	;
	;Histórico:
	;2010-oct-04	Marcelo Jardim Copied from SES
	;2008-Apr-28	Karine	Created
	
	new login, nomeUsuario, link, orderBy, codLocal, descLocal, returnLink
	new numeroInventario, descricaoInventario
	set login=""
	set nomeUsuario=""
	set link=""
	set orderBy=""
	set codLocal=""
	set descLocal=""
	set returnLink=""
	set descricaoInventario=""
	
	if YBED'="" {
		set login=YBED
		set nomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	if YLOCATION'="" {
		set codLocal = YLOCATION 
		set descLocal=$piece(^WWW0121(YM,YM,YLOCATION,1),Y,1)
	}
 
	set link=$$Start^VARJasperRun("VARInventarioDivergenciaContagem")
	set link=$$addUserParameter^VARJasperRun(link,"codLocal",codLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"login",login)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
 	set descricaoInventario=$$getDescricaoInventario(codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"descricaoInventario",descricaoInventario)
	set link=$$addUserParameter^VARJasperRun(link,"codInventario",codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"numeroContagem",$get(numeroContagem))
  
	//Ordenação, primeiro
	set orderBy=""
	if ($get(classificarGrupo)=1) {
		set orderBy=$$addString(orderBy,"$$SQLGetGrupoParaOrdenar^VARSQL($$SQLGetGrupoItem^VARSQL(it.ItemNumber))")
	}
	
	//Ordenação, segunda parte
	if ($get(classificarCodDes)=2) {
		set orderBy=$$addString(orderBy,"$$SQLGetDescricaoProduto^VARSQL(it.ItemNumber)")
	} else {
	
	//Caso 1, ou nada (padrão)
		set orderBy=$$addString(orderBy,"TONUMBER(it.ItemNumber)")
	} 
	
	set link=$$addUserParameter^VARJasperRun(link,"orderBy",orderBy)
	
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", valorYFORM, valorYKEY, "", "", "", "1", "").getHref()
	
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addUserParameter^VARJasperRun(link,"returnLink",retorno)
	
	do ViewInForm^VARJasperRun(link,"Divergência Contagem")
	quit
	
RunReportInventarioBalanceteDif(codInventario,numeroContagem)
	; Atenção: esse relatório vai ser modificado posteriormente. Precisa de limpeza.
	;
	;Histórico:
	;2010-oct-04	Marcelo Jardim Copied from SES
	;2008-Apr-19	Karine	Criação: copia da chamada do Mapa de Contagem
	
	new login, nomeUsuario, link, orderBy, codLocal, descLocal, returnLink
	new numeroInventario, descricaoInventario
	set login=""
	set nomeUsuario=""
	set link=""
	set orderBy=""
	set codLocal=""
	set descLocal=""
	set returnLink=""
	set descricaoInventario=""
	set objInvent = $GET(^INWEINVP(YM,codInventario,1))
	set localinv = $piece(objInvent,Y,10)
	set matInventariante = $piece(objInvent,Y,1)
	set dtInventario = $piece(objInvent,Y,2)
	
	if YBED'="" {
		set login=YBED
		set nomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	if matInventariante '= "" {
		set nomeInventariante=$$getNomeUsuario(matInventariante)
	}	
	
	if localinv'="" {
		set descLocal=$piece(^WWW0121(YM,YM,localinv,1),Y,1)
	}
	
	if dtInventario '= "" {
		set dtInventariof = $$SQLGetFormatDate^VARTRKSQL(dtInventario)
	}
 
	set link=$$Start^VARJasperRun("VARInventarioBalanceteDif")
	set link=$$addUserParameter^VARJasperRun(link,"codLocal",localinv)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"login",login)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"matInventariante",matInventariante)
	set link=$$addUserParameter^VARJasperRun(link,"nomeInventariante",nomeInventariante)
	set link=$$addUserParameter^VARJasperRun(link,"dtInventario",dtInventariof)
	
	
	//Find out the description (the received values from parameters are not correct!)
	set descricaoInventario=$$getDescricaoInventario(codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"descricaoInventario",descricaoInventario)
	set link=$$addUserParameter^VARJasperRun(link,"codInventario",codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"numeroContagem",$get(numeroContagem))
 
	//Ordenação, primeiro
	set orderBy=""
	if ($get(classificarGrupo)=1) {
		set orderBy=$$addString(orderBy,"$$SQLGetGrupoParaOrdenar^VARSQL($$SQLGetGrupoItem^VARSQL(line.ItemNumber))")
	}
	
	//Ordenação, segunda parte
	if ($get(classificarCodDes)=2) {
		set orderBy=$$addString(orderBy,"$$SQLGetDescricaoProduto^VARSQL(line.ItemNumber)")
	} else {
		//Caso 1, ou nada (padrão)
		set orderBy=$$addString(orderBy,"TONUMBER(line.ItemNumber)")
	} 
	
 	set link=$$addUserParameter^VARJasperRun(link,"orderBy","ORDER BY "_orderBy)
	
	do ViewInForm^VARJasperRun(link,"Diferença Balancete")
	quit
 
RunReportInventarioBalanceteTotal(codInventario, numeroContagem)
	; Mostra o balancete de auste de inventário (Total)
	;
	;Histórico:
	;2008-Apr-22	Soeiro	Criação
	;2010-oct-04	Marcelo Jardim Copied from SES
	
	new login, nomeUsuario, link, orderBy, codLocal, descLocal, returnLink
	new numeroInventario, descricaoInventario
	set login=""
	set nomeUsuario=""
	set link=""
	set orderBy=""
	set codLocal=""
	set descLocal=""
	set returnLink=""
	set descricaoInventario=""
 
	if YBED'="" {
		set login=YBED
		set nomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	if YLOCATION'="" {
		set descLocal=$piece(^WWW0121(YM,YM,YLOCATION,1),Y,1)
	}
 
	set link=$$Start^VARJasperRun("VARInventarioBalanceteTotal")
	set link=$$addUserParameter^VARJasperRun(link,"codLocal",YLOCATION)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"login",login)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set descricaoInventario=$$getDescricaoInventario(codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"descricaoInventario",descricaoInventario)
	set link=$$addUserParameter^VARJasperRun(link,"codInventario",codInventario)
	
	//Ordenação, primeiro
	set orderBy=""
	if ($get(classificarGrupo)=1) {
		set orderBy=$$addString(orderBy,"$$SQLGetGrupoParaOrdenar^VARSQL($$SQLGetGrupoItem^VARSQL(line.ItemNumber))")
	}
	
	//Ordenação, segunda parte
	if ($get(classificarCodDes)=2) {
		set orderBy=$$addString(orderBy,"$$SQLGetDescricaoProduto^VARSQL(line.ItemNumber)")
	} else {
		//Caso 1, ou nada (padrão)
		set orderBy=$$addString(orderBy,"TONUMBER(line.ItemNumber)")
	} 
	
 	set link=$$addUserParameter^VARJasperRun(link,"orderBy","ORDER BY "_orderBy)
	
	do ViewInForm^VARJasperRun(link,"Balancete Total")
	quit
	
RunReportInventarioDemonstrativo(codInventario, numeroContagem)
	; Mostra o balancete de demonstrativo de contagem.
	; As contagens até 6 serão exibidas ou não de acordo com susa existência.
	; 
	; Atenção: os valores desejados de YKEY e YFORM estão nas variáveis
	; - valorYKEY: YKEY utilizada pra geração do relatório
	; - valorYFORM: YFORM tela que foi utilizada pra geração do relatório
	; 
	; As variáveis YKEY e YFORM contém o usuário ATUAL e o FORM ATUAL que
	; muito provavelmente são apenas da tela de filtro!
	; 
	; Essa rotina está sendo chamada indiretamente através da VARSESINWEINVD
	; 
	; 
	; 1º) classificarGrupo= 0:não, 1:sim
	; 2º) classificarCodDes= 1:Código produto, 2: Descrição produto
	; 
	;Histórico:
	;2008-Apr-24	Soeiro	implementação de ordenação via form onde o usuário escolhe os parâmetros
	;2008-Apr-22	Soeiro	Criação
	;2010-oct-04	Marcelo Jardim Copied from SES
	
	new login, nomeUsuario, link, orderBy, codLocal, descLocal, returnLink
	new numeroInventario, descricaoInventario,numeroContagens
	set login=""
	set nomeUsuario=""
	set link=""
	set orderBy=""
	set codLocal=""
	set descLocal=""
	set returnLink=""
	set descricaoInventario=""
 
	if YBED'="" {
		set login=YBED
		set nomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	if YLOCATION'="" {
		set descLocal=$piece(^WWW0121(YM,YM,YLOCATION,1),Y,1)
	}
 
	set link=$$Start^VARJasperRun("VARInventarioDemonstrativoContagem")
	set link=$$addUserParameter^VARJasperRun(link,"codLocal",YLOCATION)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"login",login)
	set link=$$addU]]><![CDATA[serParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set descricaoInventario=$$getDescricaoInventario(codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"descricaoInventario",descricaoInventario)
	set link=$$addUserParameter^VARJasperRun(link,"codInventario",codInventario)
	
	//Find out the total number of counts
	set numeroContagens=$$GetNumberOfHighestCount^INStocktaking(codInventario)
	if (numeroContagens="") {
		set numeroContagens=0
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"numeroContagens",numeroContagens)
 
	//Ordenação, primeiro
	set orderBy=""
	if ($get(classificarGrupo)=1) {
		set orderBy=$$addString(orderBy,"TONUMBER($$SQLGetGrupoItem^VARSQL(line.ItemNumber)")
	}
	
	//Ordenação, segunda parte
	if ($get(classificarCodDes)=2) {
		set orderBy=$$addString(orderBy,"$$SQLGetDescricaoProduto^VARSQL(line.ItemNumber)")
	} else {
	
	//Caso 1, ou nada (padrão)
		set orderBy=$$addString(orderBy,"TONUMBER(line.ItemNumber)")
	} 
	set link=$$addUserParameter^VARJasperRun(link,"orderBy",orderBy)
	
	do ViewInForm^VARJasperRun(link,"Inventário Demonstrativo")
	quit
	
RunReportConciliacao(codInventario,numeroContagem)
	; Atenção: os valores desejados de YKEY e YFORM estão nas variáveis
	; - valorYKEY: YKEY utilizada pra geração do relatório
	; - valorYFORM: YFORM tela que foi utilizada pra geração do relatório
	; 
	; As variáveis YKEY e YFORM contém o usuário ATUAL e o FORM ATUAL que
	; muito provavelmente são apenas da tela de filtro!
	; 
	; Essa rotina está sendo chamada indiretamente através da VARSESINWEINVD
	; 
	; 
	; 1º) classificarGrupo= 0:não, 1:sim
	; 2º) classificarCodDes= 1:Código produto, 2: Descrição produto
	;
	;Histórico:
	;2008-Dec-22	Karine	Informações sobre a conciliação que estava fixa como "0", e agora e pega todas as movimentações
	;						realizadas desde a data do fechamento do inventário até a data do último dia do ano, caso exista.
	;						As informações sobre as movimentação são extraídas da mesma tabela gerada para o balancete - VARSESCacheFichaEstoque.
	;2008-Apr-28	Soeiro	Ordenação 
	;2008-Mar-24	Soeiro	Criação
	;2010-oct-04	Marcelo Jardim Copied from SES
	
	new login, nomeUsuario, link, orderBy, codLocal, descLocal, returnLink
	new numeroInventario, descricaoInventario
		
	set login=""
	set nomeUsuario=""
	set link=""
	set orderBy=""
	set codLocal=""
	set descLocal=""
	set returnLink=""
	set descricaoInventario=""
	set dtAcesso = $zdate($h)
	set currentYear = $piece(dtAcesso,"/",3)
	set lastYear = currentYear - 1
	set lastDay = "12/31/"_lastYear
	set DtFinalAno = $zdateh(lastDay)
	set objInvent = $GET(^INWEINV(YM,codInventario,1,1))
	set DtFinalInventario = $piece(objInvent,Y,98)
	
	if YBED'="" {
		set login=YBED
		set nomeUsuario=$$getNomeUsuario(login)
	} else { 
		
		set login="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	if YLOCATION'="" {
		set descLocal=$piece(^WWW0121(YM,YM,YLOCATION,1),Y,1)
	}
 
	set link=$$Start^VARJasperRun("VARInventarioConciliacao")
	set link=$$addUserParameter^VARJasperRun(link,"codLocal",YLOCATION)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"login",login)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set descricaoInventario=$$getDescricaoInventario(codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"descricaoInventario",descricaoInventario)
	set link=$$addUserParameter^VARJasperRun(link,"codInventario",codInventario)
	set link=$$addUserParameter^VARJasperRun(link,"numeroContagem",$get(numeroContagem))
	set link=$$addUserParameter^VARJasperRun(link,"DtFinalAno",$get(DtFinalAno))
	set link=$$addUserParameter^VARJasperRun(link,"DtFinalInventario",+$get(DtFinalInventario)) 
	
	//Ordenação, primeiro
	set orderBy=""
	if ($get(classificarGrupo)=1) {
		set orderBy=$$addString(orderBy,"$$SQLGetGrupoParaOrdenar^VARSQL(codGrupo)")
	}
	
	//Ordenação, segunda parte
	if ($get(classificarCodDes)=2) {
		set orderBy=$$addString(orderBy,"descProduto")
	} else {
		//Caso 1, ou nada (padrão)
		set orderBy=$$addString(orderBy,"TONUMBER(codProduto)")
	} 
	
 	set link=$$addUserParameter^VARJasperRun(link,"orderBy","ORDER BY "_orderBy)

	do ViewInForm^VARJasperRun(link,"Conciliação Inventário")
	quit
	
	//End - Reports - Inventary - Copied from SES - 04-oct-2010 - Marcelo Jardim

RunReportNotaTransferencia(pNumTransferencia)
	; Mostra detalhes da Nota de Transferência
	;
	;Histórico:
	;2010-Nov-19	GLEDES		Criação
	
	new NomeUsuario, OrderBy
	set OrderBy = ""
	
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARNotaTransferencia")
	set link=$$addUserParameter^VARJasperRun(link,"NumTransferencia",pNumTransferencia)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	
	if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
		if (classificarGrupo=1) {
			set OrderBy=$$addString(OrderBy,"")
		}
		if (classificarSeqCodDes=1) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INTFRPickLine.TransferPickLineNumber)")
		} elseif (classificarSeqCodDes=2) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INTFRPickLine.Item)")
		} elseif (classificarSeqCodDes=3) {
			set OrderBy=$$addString(OrderBy," ORDER BY Descricao")
		}
		
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}else{
		set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INTFRPickLine.TransferPickLineNumber)")
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}
	
	do ViewInForm^VARJasperRun(link,"Nota de Transferência")
	quit
	
RunReportNotaTransferenciaContabil(pNumTransferencia)
	; Mostra detalhes da Nota de Transferência - Formato Contábil
	;
	;Histórico:
	;2012-Mar-16	RGB		Criado
	
	new NomeUsuario, OrderBy
	set OrderBy = ""
	
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARNotaTransferenciaContabil")
	set link=$$addUserParameter^VARJasperRun(link,"NumTransferencia",pNumTransferencia)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	
	if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
		if (classificarGrupo=1) {
			set OrderBy=$$addString(OrderBy,"")
		}
		if (classificarSeqCodDes=1) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INTFRPickLine.TransferPickLineNumber)")
		} elseif (classificarSeqCodDes=2) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INTFRPickLine.Item)")
		} elseif (classificarSeqCodDes=3) {
			set OrderBy=$$addString(OrderBy," ORDER BY Descricao")
		}
		
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}else{
		set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(INTFRPickLine.TransferPickLineNumber)")
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}
	
	do ViewInForm^VARJasperRun(link,"Nota de Transferência Contábil")
	quit

RunReportStockByProgram(pPrograma)
	; Report utilizado no Form "VARStock"
	;
	
	set link=$$Start^VARJasperRun("VAREstoqueConsultaPrograma")
	set link=$$addUserParameter^VARJasperRun(link,"Programa", pPrograma)

	do ViewInForm^VARJasperRun(link,"Estoque por Programa")	
	
	quit
		
	//molde para o relatorio de programa por local	
RunReportINIssueEtiqueta(pReqNum)
	;Report de Etiqueta do formulário INIssue
	
	set link=$$Start^VARJasperRun("VARINIssueEtq")
	set link=$$addUserParameter^VARJasperRun(link,"pReq", pReqNum)
	
	do ViewInForm^VARJasperRun(link,"Etiqueta de Expedição")	
	
	quit		
	
	//molde para o relatorio de programa por local
RunReportStockByProgramLocation(pidLocation)
	; Report utilizado no Form "VARStockByProgramLocation" que lista os programas por local.
	
	new NomeLocal
	
	set link=$$Start^VARJasperRun("VAREstoqueConsultaProgramaPorLocal")
	
	s NomeLocal = $piece($g(^COMTempList(YM,YUSER,"VARLocais",pidLocation,1)), Y, 1)
	
	set link=$$addUserParameter^VARJasperRun(link,"IdLocal", pidLocation)
	set link=$$addUserParameter^VARJasperRun(link,"NomeLocal", NomeLocal)
	
	//Link do "Voltar"
	set pForm=YFORM //Name of the form
	set pYKEY=YKEY //Key to the form
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", pForm, pYKEY, "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Consulta de Estoque por Programa - Local")
	
	quit
	
RunReportStockByProgramProducts(pidProgram)
	; Report utilizado no Form "VARStockByProgramProducts" que lista os estoques de produtos por programa.
	
	set link=$$Start^VARJasperRun("VAREstoqueConsultaDetalhadaPorPrograma")
	
	set link=$$addUserParameter^VARJasperRun(link,"IdPrograma", pidProgram)
	set link=$$addUserParameter^VARJasperRun(link,"NomePrograma", $$GetProgramName^VARSQL(pidProgram))
	
	//Link do "Voltar"
	set pForm=YFORM //Name of the form
	; set pYKEY=pidProgram //Key to the form
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", pForm, pidProgram, "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Consulta Detalhada de Estoque por Programa")
	
	quit
	
	//molde para o relatorio de movimentação de produtos dentro do armazém
RunReportVARINMOVRelatorio(movLocation, dataInicial, dataFinal, codigoProduto, grupoSubgrupo, query)
	; Report utilizado no Form "VARINMOVRelatorio" como relatorio de movimentação de produtos dentro do armazém.
	
	new NomeLocal
	
	set link=$$Start^VARJasperRun("VARINMOVRelatorio")
	
	s NomeLocal = $piece($g(^COMTempList(YM,YUSER,"VARINMOVRelatorioLocais",movLocation,1)), Y, 1)
	
	set link=$$addUserParameter^VARJasperRun(link,"Local", movLocation)
	set link=$$addUserParameter^VARJasperRun(link,"NomeLocal", NomeLocal)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial", dataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal", dataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"CodigoProduto", codigoProduto)
	set link=$$addUserParameter^VARJasperRun(link,"Grupo", grupoSubgrupo)
	set link=$$addUserParameter^VARJasperRun(link,"Query", query)
	
	//Link do "Voltar"
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, "", "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)	
	
	do ViewInForm^VARJasperRun(link,"Movimentação de produtos no armazém")
	
	quit
			
		
		
RunReportListaSeparacaoKit(pIdIssue)
	;-------------------------------------------------------------------------------
	; This report is used in INMOIssue screen
	;     
	; Params:	pidIssue		Issue id
	;
	; History:
	; 17-May-2010	Petik		
	;-------------------------------------------------------------------------------
	new link
	IF YBED'="" 
			{
			set User=YBED
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			} 
	else { 
		set User="NOUSER"
		}
		
	set link=$$Start^VARJasperRun("VARListaDeSeparacaoKit")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"NoExpedicao",pIdIssue)
	
	do ViewInForm^VARJasperRun(link,"Lista de Separação para Montagem de Kits")	
	
	quit				
	
	
RunReportConferenciaKit(pIdKit)
	;-------------------------------------------------------------------------------
	; This report is used in VARINARTT1 screen
	;     
	; Params:	pidKit		Kit id
	;
	; History:
	; 17-May-2010	Petik		
	;-------------------------------------------------------------------------------
	new kit
	
	if (pIdKit=""){
		set pIdKit = $get(^VARTempINARTT1(YM,YBED))
	}
	
	IF YBED'="" 
			{
			set User=YBED
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			} 
	else { 
		set User="NOUSER"
		}
		
	set link=$$Start^VARJasperRun("VARListaDeConferenciaKit")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"CodigoKit",pIdKit)
	
	do ViewInForm^VARJasperRun(link,"Lista de Conferência para Montagem de Kits")	
	
	quit	
	
RunReportSaidaEstoque(pYKEY)

	IF YBED'="" 
			{
			set User=YBED
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			} 
	else { 
		set User="NOUSER"
		}

	set link=$$Start^VARJasperRun("VARSaidaEstoque")
	set link=$$addUserParameter^VARJasperRun(link,"pCodSaida", pYKEY)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
		
	do ViewInForm^VARJasperRun(link,"Saída de estoque")
	
	quit
	
RunReportHistoricoSaidas(pDataInicial,pDataFinal)
	;Relatório do formulário VARHistoricoSaidas
	;
	;Histórico
	;
	;2010-12-17	Sósthenes	Created

	set strFiltro			= ""
	set strLocal			= ""
	set strEntidade			= ""
	set strProduto			= ""
	set strTipo				= ""
	set strDescFiltro		= ""
	set strLocalFiltro		= "Todos"
	set strEntidadeFiltro	= "Todas"
	set strProdutoFiltro	= "Todos"
	set strTipoFiltro		= "Todos"
	set Local  				= $get(VORG(3))
	set Produto		 		= $get(VORG(4))
	set Entidade 			= $get(VORG(5))
	set Tipo	 			= $get(VORG(6))
	set dtInicialF			= $$SQLGetDataFormatada^VARSQL(pDataInicial) //Data inicial formatada
	set dtFinalF			= $$SQLGetDataFormatada^VARSQL(pDataFinal)   //Data final formatada
	
	if (Local) '="" {
		set strLocal = " AND INADJ.SiteLocation =  '"_Local_"'"
		set strLocalFiltro = Local_" "_$$SQLGetLocationName^VARSQL(Local)
	} if (Produto) '="" {
		set strProduto = " AND INLine.Item = "_Produto_""
		set strProdutoFiltro = "("_Produto_") - "_$$SQLGetDescricaoProduto^VARSQL(Produto)
	} if (Entidade) '="" {
		set strEntidade = " AND INADJ.FREE1 = '"_Entidade_"'"
		set strEntidadeFiltro = Entidade_" - "_$$SQLGetGrupoItem^VARSQL(Entidade)
	} if (Tipo) '="" {
		set strTipo = " AND  INADJ.ReasonCode = '"_Tipo_"'"
		set strTipoFiltro = Tipo_" - "_$$SQLGetUserParamDescVAR^VARSQL("OUTRASSAIDAS~"_Tipo)
	}
		
	set strFiltro = strLocal_strEntidade_strProduto_strTipo
	set strDescFiltro = strLocalFiltro_strEntidadeFiltro_strProdutoFiltro_strTipoFiltro
	
	
	if YBED'="" {
		set user=YBED
		set strNomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
	}else{ 
		set user="NOUSER"
		set strNomeUsuario="NOUSER"
	}	
	
	set link=$$Start^VARJasperRun("VARHistoricoSaidas")
	set link=$$addUserParameter^VARJasperRun(link,"pDataI",pDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"pDataF",pDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"pDataIF",dtInicialF)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFF",dtFinalF)
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",strNomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pDescFiltro",strDescFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal",strLocalFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pMotivo",strTipoFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pProduto",strProdutoFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pEntidade",strEntidadeFiltro)
	
	do ViewInForm^VARJasperRun(link,"Historico saídas")
	
	quit			
		
RunReportPreRequisicao(pidPreReq)
	new OrderBy
	set OrderBy = ""
	
	set folder = $piece($GET(^VARJasper(YM,YM,1)),Y,1)_"Compiled/"
	
	if YBED'="" {
		set user=YBED
		set strNomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
	}else{ 
		set user="NOUSER"
		set strNomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARPreRequisicao")
	set link=$$addUserParameter^VARJasperRun(link,"pCodPreReq",pidPreReq)	
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",strNomeUsuario)	
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir",folder)	
	
	if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
		if (classificarGrupo=1) {
			set OrderBy=$$addString(OrderBy,"")
		}
		if (classificarSeqCodDes=1) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(PreLinha.NumLinha)")
		} elseif (classificarSeqCodDes=2) {
			set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(CodProduto)")
		} elseif (classificarSeqCodDes=3) {]]><![CDATA[
			set OrderBy=$$addString(Order]]><![CDATA[By," ORDER BY descProduto")
		}
		
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}else{
		set OrderBy=$$addString(OrderBy," ORDER BY TONUMBER(PreLinha.NumLinha)")
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}
	
	do ViewInForm^VARJasperRun(link,"Pedido de transferência")
	
	quit			
	
	
RunReportDistribuicao(pYBED)
	;-------------------------------------------------------------------------------
	; This report is used in VARRelDistribuicao screen
	;     
	; Params:	pYBED		
	;-------------------------------------------------------------------------------
	new link
	if pYBED = ""{
		quit 
	}
	
	set User=pYBED
	set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
	
  	set objFiltros = $get(^VARTempRelDistribuicao(YM,pYBED,1))
    //Filter for query
	set filtroDataInicial      = $piece(objFiltros,Y,1)
	set filtroDataFinal        = $piece(objFiltros,Y,2)
	
	if (filtroDataInicial > filtroDataFinal){
		$$$Alert("A data inicial não pode ser maior do que a data final.")
		do GoToForm^COMUtilForm("VARRelDistribuicao",1,,,,,) 
	}
	
	set filtroLocalAbastecedor = $piece(objFiltros,Y,3)
	set filtroLocalSolicitante = $piece(objFiltros,Y,4)
	set filtroGrupo            = $piece(objFiltros,Y,5)
	set filtroProduto          = $piece(objFiltros,Y,6)
	set OrdenarPor             = $piece(objFiltros,Y,7)
	set Formato                = $piece(objFiltros,Y,8)
	set Programa               = $$GetNomePrograma^VARSQL($piece(objFiltros,Y,9))
	set pDataInicial		   = $$SQLGetFormatDate7^VARSQL(filtroDataInicial)
	set pDataFinal			   = $$SQLGetFormatDate7^VARSQL(filtroDataFinal)
    
    if (Formato = ""){
		set Formato = 1
	}
	
	if (Programa = ""){
		set Programa = "Todos"
	}

	if (filtroLocalAbastecedor '= ""){
		set pLocalAbastecedor = filtroLocalAbastecedor_" - "_$$SQLGetLocationName^VARSQL(filtroLocalAbastecedor)
	}
	else{
		set pLocalAbastecedor = "Todos"
	}
    
	if (filtroLocalSolicitante '= ""){
		set pLocalSolicitante = filtroLocalSolicitante_" - "_$$SQLGetLocationName^VARSQL(filtroLocalSolicitante)
	}
	else{
		set pLocalSolicitante = "Todos"
	}
	
	if (filtroGrupo '= ""){
		set pGrupo = filtroGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(filtroGrupo)
	}
	else{
		set pGrupo = "Todos"
	}
	
	if (filtroProduto '= ""){
		set pProduto = filtroProduto_" - "_$$SQLGetDescricaoProduto^VARSQL(filtroProduto)
	}
	else{
		set pProduto = "Todos"
	}
	
	if (Formato '= ""){
		if (Formato = 1){
			set strFormato = "Completo"
		}
		if (Formato = 2){
			set strFormato = "Simplificado"
		}
		if (Formato = 3){
			set strFormato = "Financeiro"
		}
	}
	
	;1-Código Produto
	;2-Descrição Produto
	;3-Data e Hora Movto
	set pOrdenarPor = $$SQLGetUserParamDesc^VARSQL("VARRELDISTORDENARPOR~"_OrdenarPor)
	
	if (Formato = 1){
		set link=$$Start^VARJasperRun("VARDistribuicao")
	}
	if (Formato = 2){
		set link=$$Start^VARJasperRun("VARDistribuicaoSimplificado")
	}
	if (Formato = 3){
		set link=$$Start^VARJasperRun("VARDistribuicaoFinanceiro")
	}
	set link=$$addUserParameter^VARJasperRun(link,"pUsuario",User)
	set link=$$addUserParameter^VARJasperRun(link,"descUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pLocalAbastecedor",pLocalAbastecedor)
	set link=$$addUserParameter^VARJasperRun(link,"pLocalSolicitante",pLocalSolicitante)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo",pGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"pProduto",pProduto)
	set link=$$addUserParameter^VARJasperRun(link,"pOrdenarPor",pOrdenarPor)
	set link=$$addUserParameter^VARJasperRun(link,"pFormato",strFormato)
	set link=$$addUserParameter^VARJasperRun(link,"pPrograma",Programa)
	set link=$$addUserParameter^VARJasperRun(link,"pDataInicial",pDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFinal",pDataFinal)

	do ViewInForm^VARJasperRun(link,"Relatório de Distribuição entre Unidades")		
	 
	
	quit
	
RunReportAlertaValidade()
	quit:YBED=""
	
	set strItem 		 		= ""
	set strItemFiltro 	 		= ""
	set strGroup 		 		= ""
	set strGroupFiltro 	 		= ""
	set strLocal 		 		= ""
	set strLocalFiltro 	 		= ""
	set strFormat 		 		= ""
	set strProgram       		= ""
	set pPrograma		 		= ""
	set dtDataAtual		 		= $piece($horolog,",",1)
	set strContaContabil 		= ""
	set strContaContabilFiltro 	= ""	
	
	set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,YBED,1)),Y,1),"O","HTML")
	
  	set objFiltros = $get(^VARTempExpiryAlert(YM,YBED,1))
    //Filter for query
	set flterItem     	  = $piece(objFiltros,Y,1)
	set flterGroup        = $piece(objFiltros,Y,2)
	set flterLocation 	  = $piece(objFiltros,Y,3)
	set flterDaysToExpire = $piece(objFiltros,Y,4)
	set flterDaysExpired  = $piece(objFiltros,Y,5)
	set flterFormat		  = $piece(objFiltros,Y,9)
	set flProgram		  = $piece(objFiltros,Y,6)
	set flContaContabil   = $piece(objFiltros,Y,10)
	set flMostrarValores  = +$piece(objFiltros,Y,11)
	
	if flterDaysExpired = "" {
		set dtDataInicial = dtDataAtual
	
	} else {
		set dtDataInicial = dtDataAtual - flterDaysExpired
	}

	if (flterDaysToExpire = "") {
		if (flterDaysExpired = "") {
			set flterDaysToExpire = 30
		} else {
			set flterDaysToExpire = 0
		}
	}
	
	set dtDataFinal = dtDataAtual + flterDaysToExpire

	set flterFromPeriodExpiry = $piece($get(^VARTempExpiryAlert(YM,YBED,1)),Y,7)
	set flterToPeriodExpiry   = $piece($get(^VARTempExpiryAlert(YM,YBED,1)),Y,8)

	if ((flterFromPeriodExpiry '= "") || (flterToPeriodExpiry '= "")) {
		if (flterFromPeriodExpiry '= "") {
			set dtDataInicial = flterFromPeriodExpiry - 1
		}
		else {
			set dtDataInicial = ""
		}
		set dtDataFinal = flterToPeriodExpiry

		set flterDaysToExpire = ""
		if (flterFromPeriodExpiry '= "") {
			set flterFromPeriodExpiry = $$SQLGetDataFormatada^VARSQL(flterFromPeriodExpiry)
		}
		if (flterToPeriodExpiry '= "") {
			set flterToPeriodExpiry = $$SQLGetDataFormatada^VARSQL(flterToPeriodExpiry)
		}
	}

	set strVencimento = ""
	if (dtDataInicial '= "") {
		set strVencimento = " AND alSOH.dBundleStock.Bundle->UseByDate >= "_dtDataInicial
	}
	if (dtDataFinal '= "") {
		set strVencimento = strVencimento_
			" AND alSOH.dBundleStock.Bundle->UseByDate < "_dtDataFinal
	}
	
	if (flterItem) '="" {
		set strItem = " AND alSOH.dBundleStock.Item =  "_flterItem
		set strItemFiltro = flterItem_" "_$$SQLGetDescricaoProduto^VARSQL(flterItem)
	}
	
	if (flterGroup) '="" {
		set strGroup = " AND $$SQLGetGrupoItem^VARSQL(alSOH.dBundleStock.Item) =  "_flterGroup
		set strGroupFiltro = flterGroup_" "_$$SQLGetDescGrupoItem^VARSQL(flterGroup)
	}
	
	if (flterLocation) '="" {
		set strLocal = " AND alSOH.dBundleStock.Storage->Location = '"_flterLocation_"'"
		set strLocalFiltro = flterLocation_" "_$$SQLGetLocationName^VARSQL(flterLocation)
	}
	
	if (flProgram '= "") {
		set strProgram = " AND alSOH.dBundleStock.Bundle->Program = "_flProgram
		set pPrograma = flProgram_" - "_$$GetProgramName^VARSQL(flProgram)
	}
	
	if (flContaContabil '= ""){
		set strContaContabil = " AND $$SQLGetContaContabil^VARSQL(alSOH.dBundleStock.Item) = '"_flContaContabil_"'"
		set strContaContabilFiltro = $$SQLGetDescContaContabil^VARSQL(flContaContabil)
	}
	
	if (flterFormat = 2){
		set strFormat = "Físico"
	}
	elseif (flterFormat = 1){
		set strFormat = "Contábil"
	}
	
	set strFiltro = strVencimento_strItem_strGroup_strLocal_strProgram_strContaContabil
	
	set strFiltro = strFiltro_" AND +alSOH.dBundleStock.QtyOnHand > 0 "
	set strFiltro = strFiltro_" AND alSOH.dBundleStock.Storage->Code <> ""EmTransito"" "	
	
	if (flterFormat = 2){
		set link=$$Start^VARJasperRun("VARExpiryAlert")
		set link=$$addUserParameter^VARJasperRun(link,"pProduto",strItemFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pGrupo",strGroupFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pLocal",strLocalFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pDataI",dtDataInicial)
		set link=$$addUserParameter^VARJasperRun(link,"pDataF",dtDataFinal)
		set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pVencer",flterDaysToExpire)
		set link=$$addUserParameter^VARJasperRun(link,"pVencido",flterDaysExpired)
		set link=$$addUserParameter^VARJasperRun(link,"pIntervDe",flterFromPeriodExpiry)
		set link=$$addUserParameter^VARJasperRun(link,"pIntervAte",flterToPeriodExpiry)
		set link=$$addUserParameter^VARJasperRun(link,"pDataAtualH",dtDataAtual)
		set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
		set link=$$addUserParameter^VARJasperRun(link,"pFormato",strFormat)
		set link=$$addUserParameter^VARJasperRun(link,"pPrograma",pPrograma)
		set link=$$addUserParameter^VARJasperRun(link,"pContaContabil",strContaContabilFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pMostrarValores",flMostrarValores)
	
		do ViewInForm^VARJasperRun(link,"Relatório de alerta de validade físico")
	}
	elseif (flterFormat = 1){
		set link=$$Start^VARJasperRun("VARExpiryAlertContabil")
		set link=$$addUserParameter^VARJasperRun(link,"pProduto",strItemFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pGrupo",strGroupFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pLocal",strLocalFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pLocalTela",flterLocation)
		set link=$$addUserParameter^VARJasperRun(link,"pDataI",dtDataInicial)
		set link=$$addUserParameter^VARJasperRun(link,"pDataF",dtDataFinal)
		set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pVencer",flterDaysToExpire)
		set link=$$addUserParameter^VARJasperRun(link,"pVencido",flterDaysExpired)
		set link=$$addUserParameter^VARJasperRun(link,"pIntervDe",flterFromPeriodExpiry)
		set link=$$addUserParameter^VARJasperRun(link,"pIntervAte",flterToPeriodExpiry)
		set link=$$addUserParameter^VARJasperRun(link,"pDataAtualH",dtDataAtual)
		set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
		set link=$$addUserParameter^VARJasperRun(link,"pFormato",strFormat)
		set link=$$addUserParameter^VARJasperRun(link,"pPrograma",pPrograma)
		set link=$$addUserParameter^VARJasperRun(link,"pContaContabil",strContaContabilFiltro)
		set link=$$addUserParameter^VARJasperRun(link,"pMostrarValores",flMostrarValores)
		do ViewInForm^VARJasperRun(link,"Relatório de alerta de validade físico")
	}	
	
	quit
	
RunReportEntregaCal(pDtInicial,pDtFinal)

	if YBED'="" {
		set user=YBED
		set nomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
	}else{ 
		set user="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	set pLocal 	   = $piece(^VARTempCompraPrevisaoEntregaCal(YBED), Y, 3)
	set pPrograma  = $get(VORG(4))
	set dtInicialF = $$SQLGetDataFormatada^VARTRKSQL(pDtInicial)
	set dtFinalF   = $$SQLGetDataFormatada^VARTRKSQL(pDtFinal)
	
	set link=$$Start^VARJasperRun("VAREntregaCal")
	set link=$$addUserParameter^VARJasperRun(link,"login",user)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal",pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pDescLocal",pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal))
	set link=$$addUserParameter^VARJasperRun(link,"pDataInicial",pDtInicial)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFinal",pDtFinal)
	set link=$$addUserParameter^VARJasperRun(link,"pDataInicialF",dtInicialF)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFinalF",dtFinalF)
	set link=$$addUserParameter^VARJasperRun(link,"pPrograma",pPrograma)
	set link=$$addUserParameter^VARJasperRun(link,"pDescPrograma",$$GetNomePrograma^VARSQL(pPrograma))
	
	do ViewInForm^VARJasperRun(link,"Calendário de Entrega")
	quit
	
RunReportConsultaPrevisaoEntregas(pDataApartir,pDataAte,pidItem,pidNoOrdemCompra,pidFornec,pidLocal,pfilOrdenamento,
				pfilDirecao,pfilContaContabil,pfilterfilPrazo,pfilterfilAgendamento,pfilterfilEntrega,pfilterchkNaoAgendada,pfilPrograma,pfilUGestora,pdteAInicio,pdteAFim)	
	
	new stridItem, stridNoOrdemCompra, stridFornec, strFiltro
 	
 	set strDescItem 			= ""
 	set strDescNoOrdemCompra 	= ""
 	set strDescForn 			= ""
 	set strDescApartir 			= ""
 	set strDescAte 				= ""
 	set strDescAApartir			= ""
 	set strDescAAte				= ""
 	set strDescLocal 			= ""
 	set strOrdenamento 			= ""
 	set strDescOrdenamento 		= ""
 	set strDirecao				= "" 	
 	set strDescDentroPrazo 		= ""
 	set strDescPrograma 		= ""
 	set strDescUGestora 		= ""
 	set strContaContabil 		= ""
 	set strStEntrega			= ""
 	set strStPrazo				= ""
 	set strAgendamento			= ""
 	set strFiltro 				= ""
 	
	if YBED'="" {
		set user=YBED
		set nomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
	}
	else { 
		set user="NOUSER"
		set nomeUsuario="NOUSER"
	}
 
	if (pidItem) '="" {
		set strFiltro = strFiltro_ " AND CodItem = "_pidItem_""
		set strDescItem = pidItem_" - "_$$SQLGetDescricaoProduto^VARSQL(pidItem)
	} 
	
	if (pidNoOrdemCompra) '="" {
		set strFiltro = strFiltro_ " AND UPPER(NoOrdemCompra) = '"_pidNoOrdemCompra_"'"
		set strDescNoOrdemCompra = pidNoOrdemCompra
	}
	 
	if (pidFornec) '="" {
		set strFiltro = strFiltro_ " AND Fornecedor = "_pidFornec_""
		set strDescForn = pidFornec_" - "_$$SQLGetDescFornecedor^VARSQL(pidFornec)
	} 

	if (pDataApartir) '="" {
		set strFiltro = strFiltro_ " AND DtPrevHorolog >= "_pDataApartir_""
		set strDescApartir = $$SQLGetDataFormatada^VARSQL(pDataApartir)
	} 
	 
	if (pDataAte) '="" {          
		set strFiltro = strFiltro_ " AND DtPrevHorolog <= "_pDataAte_""
		set strDescAte = $$SQLGetDataFormatada^VARSQL(pDataAte)
	}

 	if (pdteAInicio '= "") {
	 	set strFiltro = strFiltro_ " AND DtAgendHorolog >= "_pdteAInicio_""
	 	set strDescAApartir = $$SQLGetDataFormatada^VARSQL(pdteAInicio)
 	}
 	
 	if (pdteAFim '= "") {
	 	set strFiltro = strFiltro_ " AND DtAgendHorolog <= "_pdteAFim_""
	 	set strDescAAte = $$SQLGetDataFormatada^VARSQL(pdteAFim)
 	}

	if (pidLocal '= ""){
    	set strFiltro = strFiltro_ " AND ((nvl(Length(LocaldeEntrega),0) > 0 AND LocaldeEntrega = '"_pidLocal_'")"_
 							 " OR (nvl(Length(LocaldeEntrega),0) = 0 AND Location = '"_pidLocal_'")) "
 		set strDescLocal = pidLocal_" - "_$$SQLGetLocationName^VARSQL(pidLocal)
 	}
  
  	if (filterfilEntrega = 1){
	 	set strFiltro = strFiltro_ " AND (StatusCompra <> ""3"" AND QuantRecebida <> Quantidade) "
	 	set strStEntrega = $$SQLGetUserParamDescVAR^VARSQL("VARSTATUSENTREGA~"_1)
 	}

 	if (filterfilEntrega = 2){
	 	set strFiltro = strFiltro_ " AND (StatusCompra IN (""3"",""2"") AND QuantRecebida = Quantidade) "
	 	set strStEntrega = $$SQLGetUserParamDescVAR^VARSQL("VARSTATUSENTREGA~"_2)
 	}
 
 	if (filterfilPrazo '= ""){
    	set strFiltro = strFiltro_" AND SituacaoPrazo = '"_filterfilPrazo_"' "
 	}
 	
 	if (filterfilAgendamento = 1){
	 	set strFiltro = strFiltro_" AND nvl(length(DtAgendHorolog),0) > 0 "
 	}

 	if (filterfilAgendamento = 2){
	 	set strFiltro = strFiltro_" AND DtAgendHorolog IS NULL "
 	}
       
    if (pfilPrograma '= ""){
	    set strFiltro = strFiltro_ " AND idPrograma = "_pfilPrograma_" "
	    set strDescPrograma = $$GetNomePrograma^VARSQL(pfilPrograma)
    }
    
    if (pfilUGestora '= ""){
	    set strFiltro = strFiltro_ " AND UG = "_pfilUGestora_" "
	    set strDescUGestora = pfilUGestora_" - "_$$SQLGetDescUnidadeGestora^VARSQL(pfilUGestora)
    }
    
    if (pfilContaContabil '= ""){
		set strFiltro = strFiltro_ " AND ContaContabil = "_pfilContaContabil_""   
		set strContaContabil = $$SQLGetDescContaContabil^VARSQL(pfilContaContabil)
    }
    
    // Verifica ordenamento
    if (pfilOrdenamento = ""){
	   	set strOrdenamento = " ORDER BY NoOrdemCompra "
    } 
    else { 
    	if (pfilOrdenamento = 1){
    		if (pfilDirecao = 2){
    			set strOrdenamento = " ORDER BY DtPrevHorolog DESC"
    			set strDescOrdenamento = " Data Prevista"
    			set strDirecao = "Decrescente"
    		} else {
	    		set strOrdenamento = " ORDER BY DtPrevHorolog "
    			set strDescOrdenamento = " Data Prevista"
    			set strDirecao = "Crescente"
    		}
    	}
    	if (pfilOrdenamento = 2){
	    	if (pfilDirecao = 2){
	    		set strOrdenamento = " ORDER BY DtAgendHorolog DESC"
	    		set strDescOrdenamento = "Data Agendada"
	    		set strDirecao = "Decrescente"
	    	} else {
		    	set strOrdenamento = " ORDER BY DtAgendHorolog "
	    		set strDescOrdenamento = "Data Agendada"
	    		set strDirecao = "Crescente"
	    	}
    	}
    }
    
    if (filterfilPrazo '= ""){
    	set strStPrazo = $$SQ]]><![CDATA[LGetUserParamDescVAR^VARSQL("VARPRAZOENTREGA~"_filterfilPrazo)
    }
    
    if (filterfilAgendamento '= ""){
    	set strAgendamento = $$SQLGetUserParamDescVAR^VARSQL("VARAGENDAMENTOENTREGA~"_filterfilAgendamento)
    }
 
	set link=$$Start^VARJasperRun("VARConsultaPrevisaoEntregas")
	set link=$$addUserParameter^VARJasperRun(link,"login",user)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)	
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pOrderBy",strOrdenamento)
	set link=$$addUserParameter^VARJasperRun(link,"pProduto",strDescItem)
	set link=$$addUserParameter^VARJasperRun(link,"pContaContabil",strContaContabil)	
	set link=$$addUserParameter^VARJasperRun(link,"pCompra",strDescNoOrdemCompra)
	set link=$$addUserParameter^VARJasperRun(link,"pFornecedor",strDescForn)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal",strDescLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pPrograma",strDescPrograma)
	set link=$$addUserParameter^VARJasperRun(link,"pUnGestora",strDescUGestora)
	set link=$$addUserParameter^VARJasperRun(link,"pOrdenarPor",strDescOrdenamento)
	set link=$$addUserParameter^VARJasperRun(link,"pDirecao",strDirecao)	
	set link=$$addUserParameter^VARJasperRun(link,"pDataInicio",strDescApartir)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFim",strDescAte)
	set link=$$addUserParameter^VARJasperRun(link,"pDataAInicio",strDescAApartir)
	set link=$$addUserParameter^VARJasperRun(link,"pDataAFim",strDescAAte)
	set link=$$addUserParameter^VARJasperRun(link,"pStatusEntrega",strStEntrega)
	set link=$$addUserParameter^VARJasperRun(link,"pSituacaoPrazo",strStPrazo)
	set link=$$addUserParameter^VARJasperRun(link,"pAgendamento",strAgendamento)	
	
	do ViewInForm^VARJasperRun(link,"Consulta de Previsão de Entregas")
 	quit
 	
RunReportProdutoEtq(pProduto,pLote)

	if YLOCATION'="" {
		set pLocal = YLOCATION
	}

	set link=$$Start^VARJasperRun("VARProdutoEtq")
	set link=$$addUserParameter^VARJasperRun(link,"pProduto", pProduto)
	if (pLote'=""){
		set link=$$addUserParameter^VARJasperRun(link,"pLote", pLote)
	}
	set link=$$addUserParameter^VARJasperRun(link,"pLocal", pLocal)

	do ViewInForm^VARJasperRun(link,"Etiqueta por Produto")
	
	quit
	
	
RunReportProdutoEtqLote(pRecebimento)
	//Karine: chamada no INREC

	set link=$$Start^VARJasperRun("VARProdutoEtqLote")
	set link=$$addUserParameter^VARJasperRun(link,"pRecebimento", pRecebimento)

	do ViewInForm^VARJasperRun(link,"Etiqueta por Produto com Lote e Validade")	
	
	quit
	
RunReportPacienteEtq(pPaciente)

	set link=$$Start^VARJasperRun("VARPacienteEtq")
	set link=$$addUserParameter^VARJasperRun(link,"pPaciente",pPaciente)
	do ViewInForm^VARJasperRun(link,"Etiqueta por Paciente")
	
	quit
	
RunReportPacienteEtqDisp(pPaciente,pSaida)

	set link=$$Start^VARJasperRun("VARPacienteEtqDisp")
	set link=$$addUserParameter^VARJasperRun(link,"pPaciente",pPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"pSaida",pSaida)
	do ViewInForm^VARJasperRun(link,"Etiqueta por Paciente")
	
	quit
	
RunReportDUCEtq(pFiltro,pLocal)
	; Report utilizado no Form "VARDUCEtq"
	
	set link=$$Start^VARJasperRun("VARDUCEtq")
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro", pFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal", pLocal)	

	do ViewInForm^VARJasperRun(link,"Etiqueta por Palete")
	
	quit	
	
RunReportSolicCadastroProd(pProduto,pPrincAtivo,pFornec,pReposicao,pDetalheProd,pObservacoes)
	new pLocal,user,nomeUsuario,telefone,ramal,email
	
	if YLOCATION'="" {
		set pLocal   = YLOCATION
		set telefone = $piece($get(^WWW0121(0,0,pLocal,1)),"~",11)
		set ramal	 = $piece($get(^WWW0121(0,0,pLocal,1)),"~",60)
	}
	
	if YBED'="" {
		set user=YBED
		set nomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
		set email= $piece($get(^WWW013(0,user,1)),"~",9)
	}else{ 
		set user="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARSolicCadastroProd")
	set link=$$addUserParameter^VARJasperRun(link,"pProduto",pProduto)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal",pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pTelefone",telefone)
	set link=$$addUserParameter^VARJasperRun(link,"pRamal",ramal)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario",nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pEmail",email)
	
	set link=$$addUserParameter^VARJasperRun(link,"pPrincAtivo",pPrincAtivo)
	set link=$$addUserParameter^VARJasperRun(link,"pFornec",pFornec)
	set link=$$addUserParameter^VARJasperRun(link,"pReposicao",pReposicao)
	set link=$$addUserParameter^VARJasperRun(link,"pDetalheProd",pDetalheProd)
	set link=$$addUserParameter^VARJasperRun(link,"pObservacoes",pObservacoes)
	
	do ViewInForm^VARJasperRun(link,"Relatório de solicitação de cadastro de produtos")

	quit

RunReportGuiaConferencia(pRecebimento)
	; Report utilizado no Form "INReceipt" utilizado para Guia de Conferência
	;
	
	if YBED'="" {
		set user=YBED
		set NomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
	}else{ 
		set user="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARRecebimentoGuiaConferencia")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pRecebimento",pRecebimento)

	do ViewInForm^VARJasperRun(link,"Guia de Conferência")	
	
	quit

RunReportComunicadoDesvioQualidade(pFornecedor, pOcorrencia)
	
	if YBED'="" {
		set user=YBED
		set nomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
		set email= $piece($get(^WWW013(0,user,1)),"~",9)
	}else{ 
		set user="NOUSER"
		set nomeUsuario="NOUSER"
	}
	
	set link = $$Start^VARJasperRun("VARComunicadoDesvioQualidade")
	set link = $$addUserParameter^VARJasperRun(link, "CodFornecedor",
		pFornecedor)
	set link = $$addUserParameter^VARJasperRun(link, "CodOcorrencia",
		pOcorrencia)
	set link = $$addUserParameter^VARJasperRun(link,"pNomeUsuario",nomeUsuario)

	do ViewInForm^VARJasperRun(link, "Relatório de Comunicado de Desvio "_
		"de Qualidade")
	quit

RunReportEstornoRecebimento(pYKEY)
	; -------------------------------------------------------------------------
	; Report.VAREstornoRecebimento (Estorno de Recebimento)
	; 
	; History
	; 2011-Sep-08	Carlos	Adapted to new core
	; 2008-Feb-01	Karine	Created
	;----------------------------------------------------------------------
	new login,userName
	
	if (YBED'="") {
		set login=YBED
		set userName=$$getNomeUsuario(login)
	} else  { 
		set login="NOUSER"
		set userName=""
	}
	
	set link=$$Start^VARJasperRun("VAREstornoRecebimento")
	
	//Botão Voltar
	set link=$$addUserParameter^VARJasperRun(link,"numeroRecebimento",pYKEY)
	set link=$$addUserParameter^VARJasperRun(link,"login",login)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",userName)
	
	set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, pYKEY, "", "", "", "1", "").getHref()
	set retorno=$$BackLink^VARJasperRun(retorno)
	set link=$$addParameter^VARJasperRun(link,retorno,20)
	
	do ViewInForm^VARJasperRun(link,"Estorno de Recebimento")	
 
	quit
	
RunReportMovPallet(pYKEY)

	IF YBED'="" 
			{
			set User=YBED
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			} 
	else { 
		set User="NOUSER"
		}

	set link=$$Start^VARJasperRun("VARMovEstoquePallet")
	set link=$$addUserParameter^VARJasperRun(link,"NoMov", pYKEY)
	set link=$$addUserParameter^VARJasperRun(link,"pUsuario", User)
	set link=$$addUserParameter^VARJasperRun(link,"pDescUsuario", NomeUsuario)
	
	do ViewInForm^VARJasperRun(link,"Movimentação de Paletes no Local")
	
	quit
	
RunReportFarmacovigilancia(pMes, pAno, pProduto, pFornecedor)
    ; -------------------------------------------------------------------------
	; VARFarmacovigilancia.jrxml (Materiais > Relatórios Gerenciais >
	; Relatório de Farmacovigilância)
	; 
	; History
	; 2011-Oct-03	Pablo	Created
	;----------------------------------------------------------------------
	new vDescEmpresa, vDescProduto, vDescFornecedor, vDescMes, vNomeUsuario

	if ($length($get(YBED)) = 0) quit

    // Filter for query
	set vDescEmpresa = $$$WWWClientParamTitleofLoginForm($get(^WWWClientParam(YM, YM, 1)))
	if ($length(pProduto) > 0) {
		set vDescProduto = pProduto_" - "_
			$$SQLGetDescricaoProduto^VARSQL(pProduto)
	}
	else {
		set vDescProduto = " " ; para não aparecer a palavra null no report
	}
  	if ($length(pFornecedor) > 0) {
	  	set vDescFornecedor = pFornecedor_" - "_
	  		$$SQLGetDescFornecedor^VARSQL(pFornecedor)
	}
	else {
		set vDescFornecedor = "  "
	}
	if ($length(pMes) > 0) {
		set vDescMes = $piece($get(^WWW101(0, "COMMONTHSOFYEAR", SPRACHE,
			pMes, 1)), Y, 1)
	}
	else {
		set vDescMes = ""
	}
  	set vNomeUsuario = $$SQLGetUserName^VARSQL(YBED)

	set link = $$Start^VARJasperRun("VARFarmacovigilancia")
	set link = $$addUserParameter^VARJasperRun(link, "DescEmpresa",
		vDescEmpresa)
	set link = $$addUserParameter^VARJasperRun(link, "DescFornecedor",
		vDescFornecedor)
	set link = $$addUserParameter^VARJasperRun(link, "DescProduto",
		vDescProduto)
	set link = $$addUserParameter^VARJasperRun(link, "Mes", vDescMes)
	set link = $$addUserParameter^VARJasperRun(link, "Ano", pAno)
	set link = $$addUserParameter^VARJasperRun(link, "NomeUsuario",
		vNomeUsuario)
	set link = $$addUserParameter^VARJasperRun(link, "UseCodFornecedor",
		($length(pFornecedor) > 0))
	set link = $$addUserParameter^VARJasperRun(link, "CodFornecedor",
		pFornecedor)
	set link = $$addUserParameter^VARJasperRun(link, "UseCodProduto",
		($length(pProduto) > 0))
	set link = $$addUserParameter^VARJasperRun(link, "CodProduto",
		pProduto)
	set link = $$addUserParameter^VARJasperRun(link, "UseCodMes",
		($length(pMes) > 0))
	set link = $$addUserParameter^VARJasperRun(link, "CodMes",
		pMes)
	set link = $$addUserParameter^VARJasperRun(link, "UseCodAno",
		($length(pAno) > 0))
	set link = $$addUserParameter^VARJasperRun(link, "CodAno",
		pAno)
	do ViewInForm^VARJasperRun(link, "Relatório de Farmacovigilância")
	quit

RunReportRelatorioGeralVisitas(pAno, pMes, pFornecedor, pGrupo,
	pHospitalLider)
    ; -------------------------------------------------------------------------
	; VARRelatorioGeralVisitas.jrxml (Materiais > Relatórios Gerenciais >
	; Relatório Geral de Visitas)
	; 
	; History
	; 2011-Oct-05	Pablo	Created
	;----------------------------------------------------------------------
	new vDescEmpresa, vDescMes, vDescFornecedor, vDescGrupo

	if ($length($get(YBED)) = 0) quit
	
	if YBED'="" {
		set user=YBED
		set nomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
		set email= $piece($get(^WWW013(0,user,1)),"~",9)
	}else{ 
		set user="NOUSER"
		set nomeUsuario="NOUSER"
	}

    // Filter for query
	set vDescEmpresa = $$$WWWClientParamTitleofLoginForm($get(^WWWClientParam(YM, YM, 1)))
	if ($length(pMes) > 0) {
		set vDescMes = $piece($get(^WWW101(0, "COMMONTHSOFYEAR", SPRACHE,
			pMes, 1)), Y, 1)
	}
	else {
		set vDescMes = "" ; para não aparecer a palavra null no report
	}
  	if ($length(pFornecedor) > 0) {
	  	set vDescFornecedor = pFornecedor_" - "_
	  		$$SQLGetDescFornecedor^VARSQL(pFornecedor)
	}
	else {
		set vDescFornecedor = "  "
	}
	if ($length(pGrupo) > 0) {
		set vDescGrupo = pGrupo_" - "_$piece($get(^VARPARA(0,
			"GRUPOPARTICIPANTEFORNECEDOR", SPRACHE, pGrupo, 1)), Y, 1)
	}
	else {
		set vDescGrupo = " "
	}

	set link = $$Start^VARJasperRun("VARRelatorioGeralVisitas")
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario",
		nomeUsuario)
	set link = $$addUserParameter^VARJasperRun(link, "DescEmpresa",
		vDescEmpresa)
	set link = $$addUserParameter^VARJasperRun(link, "Ano", pAno)
	set link = $$addUserParameter^VARJasperRun(link, "Mes", vDescMes)
	set link = $$addUserParameter^VARJasperRun(link, "DescFornecedor",
		vDescFornecedor)
	set link = $$addUserParameter^VARJasperRun(link, "DescGrupo",
		vDescGrupo)
	set link = $$addUserParameter^VARJasperRun(link, "UseCodAno",
		($length(pAno) > 0))
	set link = $$addUserParameter^VARJasperRun(link, "CodAno",
		pAno)
	set link = $$addUserParameter^VARJasperRun(link, "UseCodMes",
		($length(pMes) > 0))
	set link = $$addUserParameter^VARJasperRun(link, "CodMes",
		pMes)
	set link = $$addUserParameter^VARJasperRun(link, "UseCodFornecedor",
		($length(pFornecedor) > 0))
	set link = $$addUserParameter^VARJasperRun(link, "CodFornecedor",
		pFornecedor)
	set link = $$addUserParameter^VARJasperRun(link, "UseGrupo",
		($length(pGrupo) > 0))
	set link = $$addUserParameter^VARJasperRun(link, "Grupo",
		pGrupo)
	set link = $$addUserParameter^VARJasperRun(link, "UseHospitalLider",
		($length(pHospitalLider) > 0))
	set link = $$addUserParameter^VARJasperRun(link, "HospitalLider",
		pHospitalLider)
	do ViewInForm^VARJasperRun(link, "Relatório Geral de Visitas")
	quit

RunReportEmbalagemEtq(pNumeroUnidades, pNumeroUnidadesCdb)
	set link = $$Start^VARJasperRun("VAREmbalagemEtq")
	set link = $$addUserParameter^VARJasperRun(link, "NumeroUnidades",
		pNumeroUnidades)
	set link = $$addUserParameter^VARJasperRun(link, "NumeroUnidadesCdb",
		pNumeroUnidadesCdb)
	do ViewInForm^VARJasperRun(link, "Etiqueta por Embalagem")
	quit

RunReportRequisicao(pYKEY)
	; Report utilizado no Form "INReq" utilizado para imprimir o Relatório de  Requisição
	;
	
	new NomeUsuario
		
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARRequisicao")
	set link=$$addUserParameter^VARJasperRun(link ,"pNumTransferencia", pYKEY)
    set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	do ViewInForm^VARJasperRun(link,"Relatório de Requisição")	
	
	quit

RunReportOrdemUnitarizacao(pCodOrdemUnitarizacao)
	new strCodUsuario, strNomeUsuario

	set strCodUsuario = $get(YBED)
	if ($length(strCodUsuario) > 0) {
		set strNomeUsuario = $$getNomeUsuario^VARSESJasperRunReport(
			strCodUsuario)
	}
	else {
		set strNomeUsuario = ""
	}

	set link = $$Start^VARJasperRun("VAROrdemUnitarizacao")
	set link = $$addUserParameter^VARJasperRun(link, "CodOrdemUnitarizacao",
		pCodOrdemUnitarizacao)
	set link = $$addUserParameter^VARJasperRun(link, "CodUsuario",
		strCodUsuario)
	set link = $$addUserParameter^VARJasperRun(link, "NomeUsuario",
		strNomeUsuario)

	do ViewInForm^VARJasperRun(link, "Relatório de Ordem de Fracionamento")
	quit

RunReportDevolucaoFornecedor(pCodDevolucao)
	new strNomeUsuario

	if ($length($get(YBED)) > 0) {
		set strNomeUsuario = $$getNomeUsuario^VARSESJasperRunReport($get(YBED))
	}
	else {
		set strNomeUsuario = ""
	}

	set link = $$Start^VARJasperRun("VARDevolucaoFornecedor")
	set link = $$addUserParameter^VARJasperRun(link, "CodDevolucao",
		pCodDevolucao)
	set link = $$addUserParameter^VARJasperRun(link, "NomeUsuario",
		strNomeUsuario)

	do ViewInForm^VARJasperRun(link, "Relatório de Carta de Devolução ao "_
		"Fornecedor")
	quit

RunReportListaSeparacaoTFR(pIdTFR)
	;-------------------------------------------------------------------------------
	; This report is used in INTFR screen, replacing "Print PickList" report that doesn,t work
	;     
	; Params:	pidIssue		Issue id
	;
	; History:
	; 16-Jul-2010	Petik		
	;-------------------------------------------------------------------------------
	new link
	set OrderBy = ""
	IF YBED'="" 
			{
			set User=YBED
			set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
			} 
	else { 
		set User="NOUSER"
		}
		
	set link=$$Start^VARJasperRun("VARListaDeSeparacaoTransf")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"NoExpedicao",pIdTFR)
	if ($$GetPreferencia^VARPreferenciasUsuario($$$FldVARPreferenciasUsuarioTelaFiltroRelatorio) = 1){
		if (classificarSeqCodDes=1) {
			;set OrderBy=$$addString(OrderBy," ORDER BY $$SQLGetPhysicalStorage^VARSQL(Separar.SendingStockLocation,TFR.SendingLocation)")
			set OrderBy=$$addString(OrderBy," ORDER BY Separar.TransferPickLineNumber")
		} elseif (classificarSeqCodDes=2) {
			set OrderBy=$$addString(OrderBy," ORDER BY UPPER(Separar.Item)")
		} elseif (classificarSeqCodDes=3) {
			set OrderBy=$$addString(OrderBy," ORDER BY DescProduto")
		}
		
		set link=$$addUserParameter^VARJasperRun(link,"OrderBy", OrderBy)
	}
		
	do ViewInForm^VARJasperRun]]><![CDATA[(link,"Lista de Separação")	
	
	q]]><![CDATA[uit

RunReportAta(pYKEY)
	
	new NomeUsuario
		
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARAta")
	set link=$$addUserParameter^VARJasperRun(link ,"pNumAta", pYKEY)
    set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	do ViewInForm^VARJasperRun(link,"Relatório de Ata de Registro de Preço")	
	
	quit
 
RunReportReqAtendidas(pYBED)
	;-------------------------------------------------------------------------------
	; This report is used in VARRelReqAtendidas screen
	;     
	; Params:	pYBED		
	;-------------------------------------------------------------------------------
	new link
	if pYBED = ""{
		quit 
	}
	
	set User=pYBED
	set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,User,1)),Y,1),"O","HTML")
	
  	set objFiltros = $get(^VARTempRelReqAtendidas(YM,pYBED,1))
  	
	set filtroDataInicial      = $piece(objFiltros,Y,1)
	set filtroDataFinal        = $piece(objFiltros,Y,2)
	set filtroLocalSolicitante = $piece(objFiltros,Y,3)
	set OrdenarPor             = $piece(objFiltros,Y,4)
	set Formato                = $piece(objFiltros,Y,5)

	set pLocalSolicitante = filtroLocalSolicitante_"-"_$$SQLGetLocationName^VARSQL(filtroLocalSolicitante)

	;1-Código Produto
	;2-Descrição Produto
	;3-Data e Hora Movto
	set pOrdenarPor = $$SQLGetUserParamDesc^VARSQL("VARRELREQORDENARPOR~"_OrdenarPor)
	
	if (Formato=1)||(Formato=""){
		set link=$$Start^VARJasperRun("VARReqAtendidasCompleto")
	}elseif (Formato=2){
		set link=$$Start^VARJasperRun("VARReqAtendidasSimples")
	}

	set link=$$addUserParameter^VARJasperRun(link,"pUsuario",User)
	set link=$$addUserParameter^VARJasperRun(link,"descUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pLocalSolicitante",pLocalSolicitante)
	set link=$$addUserParameter^VARJasperRun(link,"pOrdenarPor",pOrdenarPor)

	do ViewInForm^VARJasperRun(link,"Relatório de Requisições Atendidas por Período")		

	quit

RunReportDevolucaoFornecedorLista(pCodDevolucao)
	new strNomeUsuario

	if ($length($get(YBED)) > 0) {
		set strNomeUsuario = $$getNomeUsuario^VARSESJasperRunReport($get(YBED))
	}
	else {
		set strNomeUsuario = ""
	}

	set link = $$Start^VARJasperRun("VARDevolucaoFornecedorLista")
	set link = $$addUserParameter^VARJasperRun(link, "CodDevolucao",
		pCodDevolucao)
	set link = $$addUserParameter^VARJasperRun(link, "NomeUsuario",
		strNomeUsuario)

	do ViewInForm^VARJasperRun(link, "Relatório de Devolução ao "_
		"Fornecedor - Lista de Separação")
	quit

RunReportAtaAlerta()
	; -------------------------------------------------------------------------------------
	; VARAtaAlerta.jrxml (Menu Principal > Compras > Alerta de Término de Vigência de Atas)
	; 
	; History
	; 2012-Jan-27	Lucas	Created
	;--------------------------------------------------------------------------------------
	
	set flterFornecedor   	  = $piece($get(^VARTempAtaAlerta(YM,YBED,1)),Y,1)
	set flterProduto      	  = $piece($get(^VARTempAtaAlerta(YM,YBED,1)),Y,2)
	set flterAta         	  = $piece($get(^VARTempAtaAlerta(YM,YBED,1)),Y,3)	
	set flterDaysToExpire 	  = $piece($get(^VARTempAtaAlerta(YM,YBED,1)),Y,4)
	set flterDaysExpired  	  = $piece($get(^VARTempAtaAlerta(YM,YBED,1)),Y,5)
	set flterFromPeriodExpiry = $piece($get(^VARTempAtaAlerta(YM,YBED,1)),Y,6)
	set flterToPeriodExpiry   = $piece($get(^VARTempAtaAlerta(YM,YBED,1)),Y,7)
	set flterComSaldo		  = $piece($get(^VARTempAtaAlerta(YM,YBED,1)),Y,8)
	set strComSaldo			  = ""
	set strFornecedor         = ""
	set strFornecedorFiltro   = ""
	set strProduto            = ""
	set strprodutoFiltro      = ""
	set strAta                = ""
	set strdteStart           = ""
	set strdteStartFiltro     = ""
	set mstrdteEnd            = ""
	set mstrdteEndFiltro      = ""
	
	if flterDaysExpired = "" {
		set dteStart = $piece($horolog,",",1)
	
	} else {
		set dteStart = $piece($horolog,",",1) - flterDaysExpired
	}
	
	if (flterDaysToExpire = "") {		
		if (flterDaysExpired = "") {
			set flterDaysToExpire = ""
		} else {
			set flterDaysToExpire = 0
		}
	}
	
	set dteEnd = $piece($horolog,",",1) + flterDaysToExpire
	
		if ((flterDaysToExpire = "") && (flterDaysExpired = "")){
		set dteStart = ""
		set dteEnd   = ""	
	}
	
	if ((flterFromPeriodExpiry '= "") || (flterToPeriodExpiry '= "")) {
		if (flterFromPeriodExpiry '= "") {
			set dteStart = flterFromPeriodExpiry - 1
		}
		else {
			set dteStart = ""
		}
		set dteEnd = flterToPeriodExpiry

		set flterDaysToExpire = ""
	}
	
	set NomeUsuario=$ZCONVERT($piece($get(^WWW013(YM,YBED,1)),Y,1),"O","HTML")
	set link=$$Start^VARJasperRun("VARAtaAlerta")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	
	if flterFornecedor '= "" {
		set strFornecedor = " AND UPPER(Linha.Fornecedor) = "_flterFornecedor_""
		set strFornecedorFiltro = $$SQLGetDescFornecedor^VARSQL(flterFornecedor)
	}
		
	if flterProduto '= "" {
		set strprodutoFiltro = $$SQLGetDescricaoProduto^VARSQL(flterProduto)
	}
		
	if (flterAta '= "") {
		set strAta = " AND Ata.CodAta = '"_flterAta_"'"
	}

	if (dteStart '= "") {
		set strdteStart = " AND Ata.DatadeValidade >= "_dteStart_""
		set strdteStartFiltro = $$SQLGetDataFormatada^VARSQL(flterFromPeriodExpiry)
	}
	if (dteEnd '= "") {
		set mstrdteEnd = " AND  Ata.DatadeValidade < "_dteEnd_""
		set mstrdteEndFiltro = $$SQLGetDataFormatada^VARSQL(flterToPeriodExpiry)
	}
	
	if (flterComSaldo = $$$YES){
		set strComSaldo = ""	
	}
	else {
		set strComSaldo = "="	
	}
	
	set strFiltro = strAta_strFornecedor_strProduto_strdteStart_mstrdteEnd
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pFornecedor",strFornecedorFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pProduto",strprodutoFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pAta",flterAta)
	set link=$$addUserParameter^VARJasperRun(link,"pDataDe",strdteStartFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pDataAte",mstrdteEndFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pDiaVencerProximos",flterDaysToExpire)
	set link=$$addUserParameter^VARJasperRun(link,"pDiaVencidoUltimos",flterDaysExpired)
	set link=$$addUserParameter^VARJasperRun(link,"pSemSaldo",strComSaldo)

	do ViewInForm^VARJasperRun(link,"Relatório de alerta de vigência de ata")
	quit
	
RunReportMedicamentosPrescritos(pidMEDPatient,pstrWhere,pAdmissaoAtual,pInicio,pTermino,pMedicamento,pStatus)
	new NomeUsuario,Periodo,MedicamentoFormatado,StatusFormatado,AdmissaoAtualFormatada
		
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if (pInicio'="")&&(pTermino'=""){
		set Periodo = "De: "_$$SQLGetDataFormatada^VARSQL(pInicio)_" Até: "_$$SQLGetDataFormatada^VARSQL(pTermino)
	} elseif (pInicio'="")&&(pTermino=""){
		set Periodo = "A partir de: "_$$SQLGetDataFormatada^VARSQL(pInicio)
	} elseif (pInicio="")&&(pTermino'=""){
		set Periodo = "Até: "_$$SQLGetDataFormatada^VARSQL(pTermino)
	} else {
		set Periodo = ""
	}
	
	set link=$$Start^VARJasperRun("VARDoseMedPrescritos")
	set link=$$addUserParameter^VARJasperRun(link,"idPaciente",pidMEDPatient)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",pstrWhere)
    set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
    
    if ($length(pAdmissaoAtual) '= 0){
	    set AdmissaoAtualFormatada = $$SQLGetYesOrNo^VARSQL(pAdmissaoAtual)
		set link=$$addUserParameter^VARJasperRun(link,"pAdmissaoAtual",AdmissaoAtualFormatada)
	}
		
	if ($length(Periodo) '= 0){
		set link=$$addUserParameter^VARJasperRun(link,"Periodo",Periodo)
	}
		
	if ($length(pMedicamento) '= 0){
		set MedicamentoFormatado = "("_pMedicamento_") "_$$SQLGetDescricaoProduto^VARSQL(pMedicamento)
		set link=$$addUserParameter^VARJasperRun(link,"pMedicamento",MedicamentoFormatado)
	}
		
	if ($length(pStatus) '= 0){
		set StatusFormatado = $piece($get(^VARPARA(0,"VARSTATUSPRESCRISCAO","PT",pStatus,1)),"~",1)
		set link=$$addUserParameter^VARJasperRun(link,"pStatus",StatusFormatado)
	}
    
	do ViewInForm^VARJasperRun(link,"Relatório de Medicamentos Prescritos")	
	
	quit

RunReportHistoricoAtendimento(pidMEDPatient,pstrWhere,pAdmissaoAtual,pInicio,pTermino,pMedicamento,pStatus)
	new NomeUsuario,Periodo,MedicamentoFormatado,StatusFormatado,AdmissaoAtualFormatada,
		NomePaciente, DtNascimento, Internacao, Unidade, Quarto, Leito, DtAdmissao, 
		Alergias, Idade
		
	if YBED'="" {
		set login=YBED
		set NomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if (pInicio'="")&&(pTermino'=""){
		set Periodo = "De: "_$$SQLGetDataFormatada^VARSQL(pInicio)_" Até: "_$$SQLGetDataFormatada^VARSQL(pTermino)
	} elseif (pInicio'="")&&(pTermino=""){
		set Periodo = "A partir de: "_$$SQLGetDataFormatada^VARSQL(pInicio)
	} elseif (pInicio="")&&(pTermino'=""){
		set Periodo = "Até: "_$$SQLGetDataFormatada^VARSQL(pTermino)
	} else {
		set Periodo = ""
	}
	
	set link=$$Start^VARJasperRun("VARDoseHistAtendimento")
	set link=$$addUserParameter^VARJasperRun(link,"idPaciente",pidMEDPatient)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",pstrWhere)
    set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
    
    if ($length(pAdmissaoAtual) '= 0){
	    set AdmissaoAtualFormatada = $$SQLGetYesOrNo^VARSQL(pAdmissaoAtual)
		set link=$$addUserParameter^VARJasperRun(link,"pAdmissaoAtual",AdmissaoAtualFormatada)
	}
		
	if ($length(Periodo) '= 0){
		set link=$$addUserParameter^VARJasperRun(link,"Periodo",Periodo)
	}
		
	if ($length(pMedicamento) '= 0){
		set MedicamentoFormatado = "("_pMedicamento_") "_$$SQLGetDescricaoProduto^VARSQL(pMedicamento)
		set link=$$addUserParameter^VARJasperRun(link,"pMedicamento",MedicamentoFormatado)
	}
		
	if ($length(pStatus) '= 0){
		set StatusFormatado = $$GetStatusDoseAdministracao^VARSQL(pStatus)
		set link=$$addUserParameter^VARJasperRun(link,"pStatus",StatusFormatado)
	}
	
	&sql(
		SELECT
		        MEDPatient.Name as Nome
		        , $$SQLGetFormatDate7^VARSQL(MEDPatient.DOB) as DataNascimento
		        , CAST(((current_date - MEDPatient.DOB)/365) as INT) as Idade
		        , MEDAdmission.Patient as CodPaciente
		        , MEDAdmission.AdmissionID as CodInternacao
		        , $$SQLGetLocationName^VARSQL(MEDAdmission.Location) as Unidade
		        , MEDAdmission.Room as Quarto
		        , MEDAdmission.Bed as Leito
		        , $$SQLGetFormatDate7^VARSQL(MEDAdmission.DateAdmitted) as DataAdmissao
		        , MEDPatient.Allergies as Alergias
		INTO	:NomePaciente
				, :DtNascimento
				, :Idade
				, :CodPaciente
				, :Internacao
				, :Unidade
				, :Quarto
				, :Leito
				, :DtAdmissao
				, :Alergias
		FROM  MEDPatient
		INNER JOIN MEDAdmission
		        ON MEDAdmission.Patient = MEDPatient.PatientID
		        AND MEDAdmission.Company = MEDPatient.Company
		        AND ISNULL(MEDAdmission.DateDischarged,0) = 0
		WHERE
		        MEDPatient.PatientID = :pidMEDPatient
	)
	if (Idade = 1) {
		set Idade = " ("_Idade_" ano)"
	}else{
		set Idade = " ("_Idade_" anos)"
	}

	set link=$$addUserParameter^VARJasperRun(link,"NomePaciente",NomePaciente)
	set link=$$addUserParameter^VARJasperRun(link,"DtNascimento",DtNascimento_Idade)
	set link=$$addUserParameter^VARJasperRun(link,"Internacao",Internacao)
	set link=$$addUserParameter^VARJasperRun(link,"Unidade",Unidade)
	set link=$$addUserParameter^VARJasperRun(link,"Quarto",Quarto)
	set link=$$addUserParameter^VARJasperRun(link,"Leito",Leito)
	set link=$$addUserParameter^VARJasperRun(link,"DtAdmissao",DtAdmissao)
	set link=$$addUserParameter^VARJasperRun(link,"Alergias",Alergias)

	do ViewInForm^VARJasperRun(link,"Relatório de Histórico de Atendimento")	
	
	quit

RunReportFichaDeEstoque(pItem, pLocation, pDteInicial, pDteFinal, pFiltroEnd, pProgram)
	new link
	set strFiltro = ""
	set strProgram = ""
	
	if (pProgram '= ""){
		set strProgram = " AND alSOH.dStockHistory.Bundle->Program = "_pProgram_""
	}
	
	set strFiltro = strProgram
	
	set link=$$Start^VARJasperRun("VARMovEstoqueProdutoSimplificado")
	set link=$$addUserParameter^VARJasperRun(link,"codigoProduto",pItem)
	set link=$$addUserParameter^VARJasperRun(link,"codigoLocal",pLocation)
	set link=$$addUserParameter^VARJasperRun(link,"dataInicial",pDteInicial)
	set link=$$addUserParameter^VARJasperRun(link,"dataFinal",pDteFinal)
	set link=$$addUserParameter^VARJasperRun(link,"dataInicialFormatada",$$SQLGetDataFormatada^VARSQL(pDteInicial))
	set link=$$addUserParameter^VARJasperRun(link,"dataFinalFormatada",$$SQLGetDataFormatada^VARSQL(pDteFinal))
	set link=$$addUserParameter^VARJasperRun(link,"localCorrente",pLocation_" - "_$$SQLGetLocationName^VARSQL(pLocation))
	set link=$$addUserParameter^VARJasperRun(link,"login",YBED)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",$$SQLGetUserName^VARSQL(YBED))
	set link=$$addUserParameter^VARJasperRun(link,"descricaoProduto",pItem_" - "_$$SQLGetDescricaoProduto^VARSQL(pItem))
	set link=$$addUserParameter^VARJasperRun(link,"unidadeMedida",$$SQLGetDescUnidadeMedida^VARSQL(pItem))
	set link=$$addUserParameter^VARJasperRun(link,"descricaoGrupo",$$SQLGetDescGrupoItem^VARSQL($$SQLGetGrupoItem^VARSQL(pItem)))
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)

	do ViewInForm^VARJasperRun(link,"Ficha de Estoque")	

	quit
	
RunReportGuiaRemessaNF(pYKEY)	
	; Form : VARGuiaRemessaNF
 	;
	 ; History:
	 ; 2012-Mar-04 Rubens: created
	 ;
	 ;
 	;$$$StartScript()
 	;w "alert('NoGuia = "_pYKEY_"');"
 	;$$$EndScript()
 
	 new User, NomeUsuario
	 set NoGuia = $get(pYKEY)
 
	 if YBED'="" {
		set User=YBED
		set NomeUsuario=$$getNomeUsuario(User)
	} else { 
		set User="NOUSER"
		set NomeUsuario="NOUSER"
	}
  
	 set link=$$Start^VARJasperRun("VARGuiaNF")
  
	 //Botão Voltar
	 set link=$$addParameter^VARJasperRun(link,NoGuia,1)
	 set link=$$addParameter^VARJasperRun(link,User,2)
	 set link=$$addParameter^VARJasperRun(link,NomeUsuario,3)
	 set retorno=##class(COM.fwk.ui.html.LinkBuilder).buildFormLink("Retornar", "Retornar", "", YFORM, pYKEY, "", "", "", "1", "").getHref()
	 set retorno=$$BackLink^VARJasperRun(retorno)
	 set link=$$addParameter^VARJasperRun(link,retorno,20)
 
	 do ViewInForm^VARJasperRun(link,"Relatório de Guia de Remessa de Notas Fiscais")	
 
	 quit 

RunReportHistoricoAgendamento(pYKEY)
	;-------------------------------------------------------------------------------
	; This report is used in VARCompraEntregaAgendamento screen
	;
	; Histórico:
	; 2012-05-17	Lucas 	 Created
	;-------------------------------------------------------------------------------
	quit:(pYKEY = "")
	new Usuario, NomeUsuario
	set NoOrdemCompra = $piece(pYKEY,",",1)
	set NoEntrega     = $piece(pYKEY,",",2)
	set NoAgendamento = $piece(pYKEY,",",3)
	set Fornecedor    = $$SQLGetDescFornecedor^VARSQL($$SQLGetCodigoFornecedor^VARSQL(NoOrdemCompra))
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else { 
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	set link=$$Start^VARJasperRun("VARCompraEntregaAgendamentoHistorico")
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pNoOrdemCompra",NoOrdemCompra)
	set link=$$addUserParameter^VARJasperRun(link,"pNoEntrega",NoEntrega)
	set link=$$addUserParameter^VARJasperRun(link,"pAgendamento",NoAgendamento)
	set link=$$addUserParameter^VARJasperRun(link,"pFornecedor",Fornecedor)
	do ViewInForm^VARJasperRun(link,"Relatório de Histórico de Alterações – Agendamento de Entrega")	
	
	quit

RunReportPrescricao(pYKEY)
	;-------------------------------------------------------------------------------
	; This report is used in MEDPrescription screen
	;
	; Histórico:
	; 2012-06-18	Lucas 	 Created
	;-------------------------------------------------------------------------------
	quit:(pYKEY = "")
	new Usuario, NomeUsuario
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else { 
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	set link=$$Start^VARJasperRun("VARPrescricaoMedica")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"nPrescricao",pYKEY)
	do ViewInForm^VARJasperRun(link,"Prescrição Médica")	
	
	quit
	
RunReportListaSeparacaoDispP(pYKEY)]]><![CDATA[
	;-------------------------------------------------------------------------------
	; This report is used in MEDPrescription screen
	;
	; Histórico:
	; 2012-06-19	Lucas 	 Created
	;-------------------------------------------------------------------------------
	quit:(pYKEY = "")
	new Usuario, NomeUsuario
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else { 
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	set link=$$Start^VARJasperRun("VARListaDeSeparacaoDispense")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"NoDispensacao",pYKEY)
	do ViewInForm^VARJasperRun(link,"Relatório - Dispensação - Lista de Separação")
	
	quit
	
RunReportHistoricoEst(pDataInicial,pDataFinal,pFormato)
	;Relatório do formulário VARHistoricoEstorno
	;
	;Histórico
	;
	;2010-06-19	Lucas	Created

	set strFiltro			= ""
	set strLocal			= ""
	set strGrupo			= ""
	set strProduto			= ""
	set strOrdem			= ""
	set strFornecedor		= ""
	set strType				= ""
	set strDescFiltro		= ""
	set strLocalFiltro		= ""
	set strGrupoFiltro		= ""
	set strProdutoFiltro	= ""
	set strOrdemFiltro		= ""
	set strFornecedorFiltro = ""
	set strTypeFiltro		= ""
	;set strProgramaFiltro	= ""
	set strFormato			= ""
	set Local  				= $get(VORG(3))
	set Produto		 		= $get(VORG(4))
	set Grupo	 			= $get(VORG(5))
	set Ordem	 			= $get(VORG(6))
	set Fornecedor 			= $get(VORG(7))
	set Type	 			= $get(VORG(8))
	set dtInicialF			= $$SQLGetDataFormatada^VARSQL(pDataInicial) //Data inicial formatada
	set dtFinalF			= $$SQLGetDataFormatada^VARSQL(pDataFinal)   //Data final formatada
	
	if (Local) '="" {
		set strLocal = " AND INR.Location =  '"_Local_"'"
		set strLocalFiltro = Local_" "_$$SQLGetLocationName^VARSQL(Local)_";"
	} if (Grupo) '="" {
		set strGrupo = " AND $$SQLGetGrupoItem^VARSQL(INRLine.Item) = '"_Grupo_"'"
		set strGrupoFiltro = Grupo_" - "_$$SQLGetGrupoItem^VARSQL(Grupo)_";"
	} if (Produto) '="" {
		set strProduto = " AND INRLine.Item = '"_Produto_"'"
		set strProdutoFiltro = "("_Produto_") - "_$$SQLGetDescricaoProduto^VARSQL(Produto)_";"
	} if (Ordem) '="" {
		set strOrdem = " AND  INRLine.Order1 = '"_Ordem_"'"
		set strOrdemFiltro = "O.F.: "_Ordem_";"
	} if (Fornecedor) '="" {
		set strFornecedor = " AND $$SQLGetFornecedorRecebimento^VARSQL(INR.ReceiptSourceNo) = "_Fornecedor_""
		set strFornecedorFiltro = Fornecedor_" - "_$$SQLGetDescFornecedor^VARSQL(Fornecedor)_";"
	} if (Type) '="" {
		set strType = " AND INR.TypeofReceiving = "_Type_""
		set strTypeFiltro = Type_" - "_$$SQLGetDescTipoRec^VARSQL(Type)_";"
	} 

	  if (pFormato = 1){
		set strFormato = "Completo"
	} if (pFormato = 2){
		set strFormato = "Simplificado"
	}
	
	set strFiltro = strLocal_strGrupo_strProduto_strFornecedor_strOrdem_strType
	set strDescFiltro = strLocalFiltro_strGrupoFiltro_strProdutoFiltro_strFornecedorFiltro_strOrdemFiltro_strTypeFiltro
	
	if YBED'="" {
		set user=YBED
		set strNomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
	}else{ 
		set user="NOUSER"
		set strNomeUsuario="NOUSER"
	}
	
	if (pFormato=1){
		set link=$$Start^VARJasperRun("VARHistoricoEstorno")
	} else {
		set link=$$Start^VARJasperRun("VARHistoricoEstornoSimples")
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"pDataI",pDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"pDataF",pDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"pDataIF",dtInicialF)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFF",dtFinalF)
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",strNomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pDescFiltro",strDescFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pFormato",strFormato)
	
	do ViewInForm^VARJasperRun(link,"Histórico de Recebimento")
	
	quit


RunReportLivroRegInventario(vMes,vAno,vLocal,vZerado,vProduto,vGrupo)
	
	if YBED'="" {
		set user=YBED
		set strNomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
	} 
	else {   
		set user="NOUSER"
		set strNomeUsuario="NOUSER"
	}
	
	set strFiltro 	= ""
	set strMes	  	= ""
	set strGrupo  	= ""
	set strProduto 	= ""
	set strZerado 	= ""
	set strLocal	= ""
	set flLocal   	= ""
	set flGrupo   	= ""
	set flProduto 	= ""
	set flZerado  	= ""
	
	if (vLocal'="") {
		set strLocal = vLocal_" - "_$$SQLGetLocationName^VARSQL(vLocal)
	}
	
	if (vZerado="") {
		if (vLocal = "") {
			set strFiltro = strFiltro_" AND $$GetEstoqueOnHandAtDate^VARReposicao(ItemNumber,NULL,NULL,NULL,$$SQLGetUltimoDiaMes^VARSQL('"_vMes_"','"_vAno_"'))>0"
		} 
		else {
			set strFiltro = strFiltro_" AND $$GetEstoqueOnHandAtDate^VARReposicao(ItemNumber,'"_vLocal_"',NULL,NULL,$$SQLGetUltimoDiaMes^VARSQL('"_vMes_"','"_vAno_"'))>0"
		}
		set strZerado = "Não"
	}
	else {
		set strZerado = "Sim"
	}
		
	if (vGrupo '= ""){
		set strFiltro = strFiltro_" AND $$SQLGetGrupoPai^VARSQL(ItemGroup) = '"_vGrupo_"'"
		set strGrupo = vGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(vGrupo)		
	}
	
	if (vProduto '= ""){
		set strFiltro = strFiltro_" AND ItemNumber = '"_vProduto_"'"
		set strProduto = vProduto_" - "_$$SQLGetDescricaoProduto^VARSQL(vProduto)
	}
	
	set strMes = $$GetDescMes^VARSQL(vMes)
	
	set folder = $piece($GET(^VARJasper(YM,YM,1)),Y,1) 
	
	if vLocal = "" {
		set vLocal = "0"
	}
	
	set link=$$Start^VARJasperRun("VARLivroRegInventario")
	set link=$$addUserParameter^VARJasperRun(link,"Filtro",strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pMes",vMes)
	set link=$$addUserParameter^VARJasperRun(link,"pAno",vAno)
	set link=$$addUserParameter^VARJasperRun(link,"pDescMes",strMes)
	set link=$$addUserParameter^VARJasperRun(link,"pDescGrupo",strGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal",vLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pDescProduto",strProduto)
	set link=$$addUserParameter^VARJasperRun(link,"pDescZerado",strZerado)
	set link=$$addUserParameter^VARJasperRun(link,"pDescLocal",strLocal)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",strNomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir", folder)
	
	do ViewInForm^VARJasperRun(link,"Livro de registro de inventário")

	quit

RunReportEntradaNotaFiscalAnalitico(pMes, pAno, pLocal, pGrupo, pProduto, pNotaFiscal, pSerie, pObservacao, pFornecedor)
	new Usuario, NomeUsuario, descLocal, descGrupo, strFiltro, strPeriodo, link
	
	set descLocal		= "Todos"
	set descGrupo		= "Todos"
	set descProduto		= "Todos"
	set descNotaFiscal	= "Todas"
	set descSerie		= "Todas"
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set strPeriodo 	  = "01/"_$$FillChar^VARSQL(pMes,2,0)_"/"_pAno_" 00:00 a "_$zdatetime($$SQLGetUltimoDiaMes^VARSQL(pMes,pAno)_",86399",4,2)
	set strFiltro 	  = $$GetFiltroSQL^VAREntradaNotaFiscal(pMes, pAno, pLocal, pGrupo, pProduto, pNotaFiscal, pSerie, pFornecedor, "D")
	set strObservacao = $$SQLGetYesOrNo^VARSQL(pObservacao)
	
	if (pLocal '= ""){
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
	}
	
	if (pGrupo '= ""){
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
	}
	
	if (pProduto '= ""){
		set descProduto = pProduto_" - "_$$SQLGetDescricaoProduto^VARSQL(pProduto)
	}
	
	if (pNotaFiscal '= ""){
		set descNotaFiscal = pNotaFiscal
	}
	
	if (pSerie '= ""){
		set descSerie = pSerie
	}
	
	set link=$$Start^VARJasperRun("VAREntradaNotaFiscalAnalitico")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pPeriodo",strPeriodo)
	set link=$$addUserParameter^VARJasperRun(link,"pObservacao",strObservacao)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descProduto",descProduto)
	set link=$$addUserParameter^VARJasperRun(link,"descNotaFiscal",descNotaFiscal)
	set link=$$addUserParameter^VARJasperRun(link,"descSerie",descSerie)
	
	do ViewInForm^VARJasperRun(link,"Entrada via Nota Fiscal - Analítico")

	quit

RunReportEntradaNotaFiscalSintetico(pMes, pAno, pLocal, pGrupo, pProduto, pNotaFiscal, pSerie, pObservacao, pFornecedor)
	new Usuario, NomeUsuario, descLocal, descGrupo, strFiltro, strPeriodo, link
	
	set descLocal		= "Todos"
	set descGrupo		= "Todos"
	set descProduto		= "Todos"
	set descNotaFiscal	= "Todas"
	set descSerie		= "Todas"
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set strPeriodo 	  = "01/"_$$FillChar^VARSQL(pMes,2,0)_"/"_pAno_" 00:00 a "_$zdatetime($$SQLGetUltimoDiaMes^VARSQL(pMes,pAno)_",86399",4,2)
	set strFiltro 	  = $$GetFiltroSQLSintetico^VAREntradaNotaFiscal(pMes, pAno, pLocal, pGrupo, pProduto, pNotaFiscal, pSerie, pFornecedor)
	set strObservacao = $$SQLGetYesOrNo^VARSQL(pObservacao)
	
	if (pLocal '= ""){
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
	}
	
	if (pGrupo '= ""){
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
	}
	
	if (pProduto '= ""){
		set descProduto = pProduto_" - "_$$SQLGetDescricaoProduto^VARSQL(pProduto)
	}
	
	if (pNotaFiscal '= ""){
		set descNotaFiscal = pNotaFiscal
	}
	
	if (pSerie '= ""){
		set descSerie = pSerie
	}
	
	Set ^zzVIC = strFiltro
	
	set link=$$Start^VARJasperRun("VAREntradaNotaFiscalSintetico")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pPeriodo",strPeriodo)
	set link=$$addUserParameter^VARJasperRun(link,"pMes",pMes)
	set link=$$addUserParameter^VARJasperRun(link,"pAno",pAno)
	set link=$$addUserParameter^VARJasperRun(link,"pObservacao",strObservacao)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descProduto",descProduto)
	set link=$$addUserParameter^VARJasperRun(link,"descNotaFiscal",descNotaFiscal)
	set link=$$addUserParameter^VARJasperRun(link,"descSerie",descSerie)
	
	do ViewInForm^VARJasperRun(link,"Entrada via Nota Fiscal - Sintético")

	quit
	
RunReportMapaMovMensal(pLocal,pGrupo,pMes,pAno)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-08-07	Thiago  Created
	;-------------------------------------------------------------------------------
	new Usuario, NomeUsuario, descLocal, descGrupo, srtPeriodo
	
	set descLocal 		 = "Todos"
	set descGrupo 		 = "Todos"
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set strPeriodo	= $$GetDescMes^VARSQL(pMes)_" de "_pAno
	
	if pLocal '= ""{		
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
	}
	
	if pGrupo '= ""{
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
	}
	
	set link=$$Start^VARJasperRun("VARMapaMovMensal")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
    set link=$$addUserParameter^VARJasperRun(link,"strPeriodo",strPeriodo)
    set link=$$addUserParameter^VARJasperRun(link,"Local",pLocal)
    set link=$$addUserParameter^VARJasperRun(link,"Mes",pMes)
	set link=$$addUserParameter^VARJasperRun(link,"Ano",pAno)
	set link=$$addUserParameter^VARJasperRun(link,"Grupo",pGrupo)
	
	do ViewInForm^VARJasperRun(link,"Relatório Mapa de Movimentação Mensal")

	quit
	
RunReportConsGrupoEstocagem(pLocal,pGrupo,pMes,pAno,pCurvaABC)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-08-24	Thiago  Created
	;-------------------------------------------------------------------------------
	new Usuario, NomeUsuario, descLocal, descGrupo, srtPeriodo, DataInicial, DataFinal, 
		strWhere, descCurvaABC
	
	set strWhere  		 = ""
	set descLocal 		 = "Todos"
	set descGrupo 		 = "Todos"
	set descCurvaABC	 = "Todos"
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set DataInicial = $zdateh(pMes_"/01/"_pAno)
	set DataFinal  	= $$SQLGetUltimoDiaMes^VARSQL(pMes,pAno)
	set strPeriodo	= $$GetDescMes^VARSQL(pMes)_" de "_pAno
	
	if (pLocal '= ""){		
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
		set strWhere  = strWhere_" AND LocalArmaz = '"_pLocal_"' "
	}
	
	if (pGrupo '= ""){
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
		set strWhere  = strWhere_" AND $$SQLGetGrupoPai^VARSQL($$SQLGetGrupoItem^VARSQL(Produto)) = '"_$$SQLGetGrupoPai^VARSQL(pGrupo)_"' "
	}
	
	if (pCurvaABC '= ""){		
		set descCurvaABC = pCurvaABC
		set strWhere  = strWhere_" AND $$SQLGetClassificacaoABC^VARSQL(Produto) = '"_pCurvaABC_"' "
	}
	
	if (strWhere '= ""){
		set strWhere = " WHERE Movimento IS NOT NULL "_strWhere
	}
	
	set link=$$Start^VARJasperRun("VARConsGrupoEstocagem")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",DataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",DataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descCurvaABC",descCurvaABC)
    set link=$$addUserParameter^VARJasperRun(link,"strPeriodo",strPeriodo)
    set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
    set link=$$addUserParameter^VARJasperRun(link,"Mes",pMes)
	set link=$$addUserParameter^VARJasperRun(link,"Ano",pAno)
	
	do ViewInForm^VARJasperRun(link,"Relatório de Consumo por Grupo de Estocagem")

	quit
	
RunReportEntradaDevolucao(pMes,pAno,pLocal,pGrupo)

	set strGrupo 	 = ""
  	set strFiltro 	 = ""
  	set strDescLocal = ""
  	set dtInicial 	 = $zdateh("01/"_vMes_"/"_vAno, 4)
  	set dtFinal 	 = $$SQLGetUltimoDiaMes^VARSQL(vMes,vAno)

  	if (YBED'="") {
		set login=YBED
		set nomeUsuario=$$SQLGetUserName^VARSQL(login)
	}
	else  { 
		set login="NOUSER"
		set nomeUsuario=""
	}
	
	if pGrupo '= "" {
		set strFiltro = " AND $$SQLGetGrupoPai^VARSQL($$SQLGetGrupoItem^VARSQL(StockHistory.Item)) = '"_pGrupo_"'"
		set strGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
	}
	
	if pLocal '="" {
		set strDescLocal = $$SQLGetLocationName^VARSQL(pLocal)
	}
	
	set link=$$Start^VARJasperRun("VAREntradaDevolucao")
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",login)
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal", pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pDescLocal", strDescLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pMes", pMes)
	set link=$$addUserParameter^VARJasperRun(link,"pAno", pAno)
	set link=$$addUserParameter^VARJasperRun(link,"DtInicial", dtInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DtFinal", dtFinal)
	set link=$$addUserParameter^VARJasperRun(link,"Filtro", strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo", strGrupo)
	
	do ViewInForm^VARJasperRun(link,"Relatório de Entrada de Devolução")
	
	quit
	
RunReportSaidaRequisicao(pMes,pAno,pLocal,pGrupo)

  	set strGrupo 	 = ""
  	set strFiltro 	 = ""
  	set strDescLocal = ""
  	set dtInicial 	 = $zdateh("01/"_vMes_"/"_vAno, 4)
  	set dtFinal 	 = $$SQLGetUltimoDiaMes^VARSQL(vMes,vAno)
  	
  	if (YBED'="") {
		set login=YBED
		set nomeUsuario=$$SQLGetUserName^VARSQL(login)
	}
	else  { 
		set login="NOUSER"
		set nomeUsuario=""
	}
	
	if pGrupo '= "" {
		set strFiltro = " AND $$SQLGetGrupoPai^VARSQL($$SQLGetGrupoItem^VARSQL(StockHistory.Item)) = '"_pGrupo_"'"
		set strGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
	}
	
	if pLocal '="" {
		set strDescLocal = $$SQLGetLocationName^VARSQL(pLocal)
	}
	
	set link=$$Start^VARJasperRun("VARSaidaRequisicao")
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario]]><![CDATA[",login)
	set link=$$addUserParam]]><![CDATA[eter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal", pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pDescLocal", strDescLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pMes", pMes)
	set link=$$addUserParameter^VARJasperRun(link,"pAno", pAno)
	set link=$$addUserParameter^VARJasperRun(link,"DtInicial", dtInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DtFinal", dtFinal)
	set link=$$addUserParameter^VARJasperRun(link,"Filtro", strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo", strGrupo)
	
	do ViewInForm^VARJasperRun(link,"Relatório de Saída de Requisição")
	
	quit
	
RunReportConsCentroCusto(pVisao,pMes,pAno,pLocal,pGrupo,pProduto,pCurvaABC)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-09-21	Thiago  Created
	;-------------------------------------------------------------------------------
	new Usuario, NomeUsuario, descLocal, descGrupo, srtPeriodo, DataInicial, DataFinal, 
		strWhere, descProduto, descCurvaABC
	
	set strWhere  		 = ""
	set filtroProduto	 = ""
	set descLocal 		 = "Todos"
	set descGrupo 		 = "Todos"
	set descProduto		 = "Todos"
	set descCurvaABC	 = "Todos"
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set DataInicial = $zdateh(pMes_"/01/"_pAno)
	set DataFinal  	= $$SQLGetUltimoDiaMes^VARSQL(pMes,pAno)
	set strPeriodo	= $$GetDescMes^VARSQL(pMes)_" de "_pAno
	
	if (pLocal '= ""){
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
		set strWhere  = strWhere_" AND CentroCusto = '"_$$GetCentroCusto^VARSQL(pLocal)_"' "
	}
	
	if (pGrupo '= ""){
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
		set strWhere  = strWhere_" AND $$SQLGetGrupoPai^VARSQL($$SQLGetGrupoItem^VARSQL(Produto)) = '"_$$SQLGetGrupoPai^VARSQL(pGrupo)_"' "
	}
	
	if (pCurvaABC '= ""){
		set descCurvaABC = pCurvaABC
		set strWhere  = strWhere_" AND $$SQLGetClassificacaoABC^VARSQL(Produto) = '"_pCurvaABC_"' "
	}
	
	if (strWhere '= ""){
		set strWhere = " WHERE Movimento IS NOT NULL "_strWhere
	}
	
	if (pProduto '= ""){
		set descProduto	  = pProduto_" - "_$$SQLGetDescricaoProduto^VARSQL(pProduto)
		set filtroProduto = " AND (StockHistory.Item = '"_pProduto_"') "
	}
	
	if (pVisao = 1){
		set link=$$Start^VARJasperRun("VARConsCentroCustoSintetico")
	} elseif (pVisao = 2){
		set link=$$Start^VARJasperRun("VARConsCentroCustoAnalitico")
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",DataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",DataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descProduto",descProduto)
	set link=$$addUserParameter^VARJasperRun(link,"descCurvaABC",descCurvaABC)
	set link=$$addUserParameter^VARJasperRun(link,"filtroProduto",filtroProduto)
    set link=$$addUserParameter^VARJasperRun(link,"strPeriodo",strPeriodo)
    set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"Mes",pMes)
	set link=$$addUserParameter^VARJasperRun(link,"Ano",pAno)
	
	do ViewInForm^VARJasperRun(link,"Relatório de Consumo por Centro de Custo")

	quit

RunReportContabilNotaFiscal(pLocal,pGrupo,pMes,pAno)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-09-28	Lucas  Created
	;-------------------------------------------------------------------------------
	new Usuario, NomeUsuario, descLocal, descGrupo, srtPeriodo, DataInicial, DataFinal, strWhere,
		sqlEntradaTransf, sqlSaidaTransf
	
	set sqlEntradaTransf = ""
	set sqlSaidaTransf	 = ""	
	set strWhere  		 = ""
	set descLocal 		 = "Todos"
	set descGrupo 		 = "Todos"
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set DataInicial = $zdateh(pMes_"/01/"_pAno)
	set DataFinal  	= $$SQLGetUltimoDiaMes^VARSQL(pMes,pAno)
	set strPeriodo	= $$GetDescMes^VARSQL(pMes)_" de "_pAno
	
	if pLocal '= ""{		
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
	}
	
	if pGrupo '= ""{
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
		set strWhere  = " WHERE GrupoPai = "_$$SQLGetGrupoPai^VARSQL(pGrupo)_" "
	}
	
	set link=$$Start^VARJasperRun("VARContabilNotaFiscal")
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",Usuario)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",DataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",DataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
    set link=$$addUserParameter^VARJasperRun(link,"strPeriodo",strPeriodo)
    set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
    set link=$$addUserParameter^VARJasperRun(link,"Local",pLocal)
    set link=$$addUserParameter^VARJasperRun(link,"Mes",pMes)
	set link=$$addUserParameter^VARJasperRun(link,"Ano",pAno)
	
	do ViewInForm^VARJasperRun(link,"Relatório Nota Fiscal")

	quit
	
RunReportContabilInventario(pLocal,pGrupo,pMes,pAno)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-10-01	Lucas  Created
	;-------------------------------------------------------------------------------
	new Usuario, NomeUsuario, descLocal, descGrupo, srtPeriodo, DataInicial, DataFinal, strWhere,
		sqlEntradaTransf, sqlSaidaTransf
	
	set sqlEntradaTransf = ""
	set sqlSaidaTransf	 = ""	
	set strWhere  		 = ""
	set descLocal 		 = ""
	set descGrupo 		 = ""
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set DataInicial = $zdateh(pMes_"/01/"_pAno)
	set DataFinal  	= $$SQLGetUltimoDiaMes^VARSQL(pMes,pAno)
	set strPeriodo	= $$GetDescMes^VARSQL(pMes)_" de "_pAno
	
	if pLocal '= ""{		
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
	}
	
	if pGrupo '= ""{
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
		set strWhere  = " WHERE GrupoPai = "_$$SQLGetGrupoPai^VARSQL(pGrupo)_" "
	}
	
	set link=$$Start^VARJasperRun("VARContabilInventario")
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",Usuario)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",DataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",DataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
    set link=$$addUserParameter^VARJasperRun(link,"strPeriodo",strPeriodo)
    set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
    set link=$$addUserParameter^VARJasperRun(link,"Local",pLocal)
    set link=$$addUserParameter^VARJasperRun(link,"Mes",pMes)
	set link=$$addUserParameter^VARJasperRun(link,"Ano",pAno)
	
	do ViewInForm^VARJasperRun(link,"Relatório Inventário")

	quit
	
	
RunReportContabilResumoMovMensal(pLocal,pGrupo,pMes,pAno)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-10-03	Vitor  Created
	;-------------------------------------------------------------------------------
	new Usuario, NomeUsuario, descLocal, descGrupo, srtPeriodo, DataInicial, DataFinal, strWhere,
		sqlEntradaTransf, sqlSaidaTransf
	
	set sqlEntradaTransf = ""
	set sqlSaidaTransf	 = ""	
	set strWhere  		 = ""
	set descLocal 		 = "Todos"
	set descGrupo 		 = "Todos"
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set DataInicial = $zdateh(pMes_"/01/"_pAno)
	set DataFinal  	= $$SQLGetUltimoDiaMes^VARSQL(pMes,pAno)
	set strPeriodo	= $$GetDescMes^VARSQL(pMes)_" de "_pAno
	
	set valorLivro = $$SQLGetSaldoFinalLivroReg^VARSQL(pMes,pAno)
	
	if pLocal '= ""{		
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
	}
	
	if pGrupo '= ""{
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
		;set strWhere  = " WHERE GrupoPai = "_$$SQLGetGrupoPai^VARSQL(pGrupo)_" "
	}
	
	;Não precisa mais relatórios diferentes se o usuário filtrou por local
	;if (pLocal = ""){
		;Alterado para o novo relatório usando a mesma Store Procedure (SP) do Mapa de Movimentação Mensal
		set link=$$Start^VARJasperRun("VARResumoMovMensalSP")
	;} elseif (pLocal '= ""){
	;	set link=$$Start^VARJasperRun("VARResumoMovMensalLocal")
	;}
		
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",Usuario)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",DataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",DataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
    set link=$$addUserParameter^VARJasperRun(link,"strPeriodo",strPeriodo)
    set link=$$addUserParameter^VARJasperRun(link,"valorLivro",valorLivro)
    set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
    set link=$$addUserParameter^VARJasperRun(link,"Local",pLocal)
    set link=$$addUserParameter^VARJasperRun(link,"Mes",pMes)
	set link=$$addUserParameter^VARJasperRun(link,"Ano",pAno)
	set link=$$addUserParameter^VARJasperRun(link,"Grupo",pGrupo)
	
	
	do ViewInForm^VARJasperRun(link,"Relatório Resumo Movimento Mensal")

	quit
	
RunReportListaSeparacaoDispensacao(pYKEY)
	;-------------------------------------------------------------------------------
	;
	; Histórico:
	; 2012-10-18	Bruno 	 Created
	;-------------------------------------------------------------------------------
	
	do RunReportListaSeparacaoDispensacao^VARJasperRunReportContinuacao(pYKEY)
	
	quit


RunReportHistDispProd(pDataInicial,pDataFinal,pProduto,pPaciente,pLocalDestino, pTotal)
	; Report utilizado no Form "VARHistDispProd"
	
	new filterDataInicial, filterDataFinal, filterProduto, filterPaciente, filterLocalDestino, filterTotal, strWhere
	
	set filterDataInicial	= ""
	set filterDataFinal		= ""
	set filterProd			= ""
	set filterPaciente		= ""
	set filterLocalDestino	= ""
	set filterTotal 		= ""
	
	if YBED'="" 
	{
		set login=YBED
		set pNomeUsuario=$$getNomeUsuario(login)
	} 
	else 
	{ 
		set login="NOUSER"
		set pNomeUsuario="NOUSER"
	}
	
	set filterDataInicial = $zDate(pDataInicial, 4)
	set filterDataFinal = $zDate(pDataFinal, 4)
	set filterProd = pProduto_" - "_$$SQLGetDescricaoProduto^VARSQL(pProduto)
	
	;set teste = $Piece(MEDDispense.DateProcessed,"","")
	
	set strWhere = "WHERE ($piece(Report.VARHistDispProd.DateProcessed,"","") between "_pDataInicial_" AND "_pDataFinal_") "
	set strWhere = strWhere_" AND Report.VARHistDispProd.ItemNumber = '"_pProduto_"' "
	;set strWhere = strWhere_" AND Report.VARHistDispProd.Status = 3 "
	
	if (pPaciente '= "")
	{
		set filterPaciente = pPaciente_" - "_$$SQLGetPatientName^VARSQL(pPaciente)
		set strWhere = strWhere_" AND Report.VARHistDispProd.PatientId = "_pPaciente_" "
	}
	else
	{
		set filterPaciente = ""
	}
	
	if (pLocalDestino '= "")
	{
		set filterLocalDestino = pLocalDestino_" - "_$$SQLGetLocationName^VARSQL(pLocalDestino)	
		set strWhere = strWhere_" AND Report.VARHistDispProd.DestinationLocation = '"_pLocalDestino_"' "
	}
	else
	{
		set filterLocalDestino = ""
	}	
	set filterTotal = pTotal
	
	set link=$$Start^VARJasperRun("VARHistDispProd")
	set link=$$addUserParameter^VARJasperRun(link,"filterDataInicial", filterDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"filterDataFinal", filterDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"filterProd", filterProd)
	set link=$$addUserParameter^VARJasperRun(link,"filterPaciente", filterPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"filterLocalDestino", filterLocalDestino)
	set link=$$addUserParameter^VARJasperRun(link,"filterTotal", filterTotal)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario", pNomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere", strWhere)
	do ViewInForm^VARJasperRun(link,"Histórico de Dispensação por Produto")	
	
	quit
	
RunReportAntimicrobianoSCIH(pProduto,pAno,pMes,pLocal,pPaciente,pTipo)
	new user, nomeUsuario, link, strWhere, fldidLocal, pCentroCusto, competencia
	set strWhere = ""
	
	set competencia  = pAno_pMes
	
  	if (YBED'="") {
		set login=YBED
		set nomeUsuario=$$SQLGetUserName^VARSQL(login)
	} else { 
		set login="NOUSER"
		set nomeUsuario=""
	}
	
	if ($length(pProduto) '= 0){
		set strWhere = strWhere_" AND (Item) = '"_pProduto_"' "
		set pProduto =  pProduto_" - "_$$SQLGetDescricaoProduto^VARSQL(pProduto)
	}
	if ($length(pPaciente) '= 0){
		set strWhere = strWhere_" AND (Paciente) = '"_pPaciente_"' "
	}
	if ($length(pLocal) '= 0){
		set strWhere = strWhere_" AND (Setor) = '"_pLocal_"' "
	}
	
	if (pTipo = "Medicamento"){
		set link=$$Start^VARJasperRun("VARRelatorioAntimicrobianoSCIHItem")
	} else {
		set link=$$Start^VARJasperRun("VARRelatorioAntimicrobianoSCIH")
	}
	set link=$$addUserParameter^VARJasperRun(link,"pProduto", pProduto)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario",nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pSetor", pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pCompetencia", competencia)
	set link=$$addUserParameter^VARJasperRun(link,"pPaciente", pPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"Filtro", strWhere)
	
	do ViewInForm^VARJasperRun(link,"Relatório Antimicrobiano (SCIH)")
	
	quit]]></Routine>
</Export>