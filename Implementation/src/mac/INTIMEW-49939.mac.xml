<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INTIMEW" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INTIMEW
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		AUTRAGSÜBERSICHT WOCHE
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| DT	14.10.2000
	;\------------------------------------------------------------------/
	NEW YDDSATZ,YKEY,ME,FPL,FTG,TAG,DAY,WOCHE,WOCHE1,AUF,POS,POS1,AUF1,YI,TARGET,TEIL,SUCH,SUCH1,TEIL1,SATZ,DAUER,MASCHCOLOR
	
	IF $GET(WOCHE1)="" SET WOCHE1=$GET(%(YQUERY,"YOPTION"))
	SET TAG=+$GET(WOCHE1)   ;WOCHE MONATG ;week 
	IF (TAG>70000) || (TAG<50000) SET TAG=""
	IF $GET(TAG)="" SET TAG=+$HOROLOG  ;HEUTE ;today 
	SET DAY=$$^WWWDAY(TAG)  ;TAG 1=MONTAG 2=DI, 3=MI,...
	SET TAG=TAG-DAY+1  ;MONTAG DER WOCHE ;Monday the week 
	SET WOCHE=$$^WWWWEEK(TAG)  ;WOCHE HEUTE ;week today 
	SET YTARGET=$GET(YTARGET)  ;TARGET FÜR POSITIONSBEARBEITUNG ;to 
	KILL ^WWWSOR(YUSER)
	DO SELECT  ;SUCHEN TEILE ;seek 
	DO WOCHE  ;WOCHEN AUSWAHL ;weekly Selection 
	DO ^WWWFRAME(0)  ;TABLE AN  ;upon 
	DO HEADER  ;ÜBERSCHRIFT ;superscription 
	;SUCHEN OFFENE AUFTRÄGE !BEDINGUNGSÄNDERUNGEN AUCH IN ^INPROAUF ÄNDERN
	SET FPL=""
	FOR  SET FPL=$ORDER(^INPRONEST(YM,FPL)) QUIT:FPL=""  DO  ;FERTIGUNGSPLÄTZE
	. DO FERTIGUNG
	
	IF $DATA(^WWWSOR(YUSER," ")) SET FPL=" " DO FERTIGUNG  ;DATUM OHNE FERTIGUNGSPLATZ ;Date without 
	DO ^WWWFRAME(1)  ;TABLE AUS  ;out of 
	QUIT
	
WOCHE ;WOCHE PLUS MINUS         ;week plus minus 
	WRITE "<b>"
	WRITE $EXTRACT(WOCHE,1,2)_"."
	IF SPRACHE="DE" WRITE "KW"
	IF SPRACHE'="DE" WRITE $EXTRACT(WOCHE,5,6)
	WRITE "</b>"
	WRITE "&nbsp;"
	WRITE "&nbsp;"
	IF SPRACHE="DE" DO
	. NEW YOPTION
	. WRITE YCR,"<A HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INTIMEW&YOPTION="_(TAG-7)_"&YBACK=INTIME,"
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE "<IMG SRC="_""""_YGIF_"wochem.gif"_""""_" BORDER=0 TITLE='Woche zur&uuml;ck'></A>"
	. WRITE YCR,"<A HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INTIMEW&YOPTION="_0_"&YBACK=INTIME,"
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE "<IMG SRC="_""""_YGIF_"heute.gif"_""""_" BORDER=0 TITLE='Heute'></A>"
	. WRITE YCR,"<A HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INTIMEW&YOPTION="_(TAG+7)_"&YBACK=INTIME,"
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE "<IMG SRC="_""""_YGIF_"wochep.gif"_""""_" BORDER=0 TITLE='Woche vor'></A>"
	
	IF SPRACHE'="DE" DO
	. NEW YOPTION
	. WRITE YCR,"<A HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INTIMEW&YOPTION="_(TAG+7)_"&YBACK=INTIME,"
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE "<IMG SRC="_""""_YGIF_"pweek.gif"_""""_" BORDER=0 TITLE='next week'></A>"
	. WRITE YCR,"<A HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INTIMEW&YOPTION="_(TAG-7)_"&YBACK=INTIME,"
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE "<IMG SRC="_""""_YGIF_"mweek.gif"_""""_" BORDER=0 TITLE='week back'></A>"
	
	WRITE YCR
	;WRITE "</CENTER>"
	WRITE "<BR>"
	QUIT
	
HEADER ;KOPF DER WOCHEN ;pate the weekly 
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32129)   ;FERTIGUNGSPLATZ
	WRITE "</TH>"
	WRITE YCR
	FOR TAGE=TAG:1:(TAG+6) DO  ;ZEITRAUM AUSWERTEN (JE VORGABE)
	. SET DAY=$$^WWWDAY(TAGE)
	. WRITE YCR
	. WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT "
	. IF +$HOROLOG'=TAGE WRITE " BGCOLOR="_YDARKGRAY
	. IF +$HOROLOG=TAGE WRITE " BGCOLOR=PALEGOLDENROD"
	. WRITE ">"
	. WRITE "<FONT SIZE=2>"
	. WRITE "<A TITLE="_""""_$PIECE($$^WWWTEXT(30022),",",DAY)_$CHAR(13)_$$^WWWTEXT(32167)_""""
	. WRITE " HREF="_""""_YAKTION_"EP=WWWSAVE&YFORM=INPROAUF&YEND=1&YINPROAUFM1="_$$^WWWDATE(TAGE)_"&YINPROAUFM2=1&YINPROAUFM3=1&YINPROAUFM4=1&YINPROAUFM5=0&YINPROAUFM9=0"
	. DO ^WWWCGI
	. WRITE """"
	. WRITE " TARGET="_YTARGET
	. WRITE ">"
	. WRITE $$^WWWDATE(TAGE)
	. WRITE "&nbsp;"
	. WRITE "</A>"
	. WRITE "</TH>"
	
	WRITE YCR
	WRITE "</TR>"
	QUIT
	
FERTIGUNG   ;FERTIGUNGSAUFTRÄGE
	NEW YOPTION,FIRST,WIDTH,XPOS,YBACK,MITARB
	SET YDDSATZ=$GET(YDDSATZ)+1
	SET FPL(1)=""
	IF FPL'="" SET FPL(1)=$TRANSLATE($GET(^INPRONEST(YM,FPL,1)),";",",")
	;FERTIGUNGSLEITER
	IF +YBEDBER'=1 IF $PIECE(FPL(1),Y,3)'="" IF YBED'=$PIECE(FPL(1),Y,3) QUIT  ;FALSCHER MITARBEITER
	WRITE YCR
	WRITE "<TR>"
	WRITE "<TD NOWRAP ALIGN=LEFT VALIGN=TOP"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YDDSATZ#2=0 WRITE " BGCOLOR=LIGHTGREY"
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF $TRANSLATE(FPL," ")'="" DO
	. NEW YBACK
	. WRITE "<A TITLE="_""""
	. WRITE $PIECE(FPL(1),Y,1)
	. FOR YI=1:1 QUIT:$PIECE($PIECE(FPL(1),Y,2),",",YI)=""  WRITE $CHAR(13)_$PIECE($GET(^WWW013(0,$PIECE($PIECE(FPL(1),Y,2),",",YI),1)),Y,1)
	. WRITE """"
	. WRITE " HREF="_YAKTION_"EP=WWWFORM&YFORM=INPRONEST&YKEY="_FPL_"&YBACK=INTIMEW,&YOPTION="_TAG
	. DO ^WWWCGI
	. WRITE " TARGET="_YTARGET
	. WRITE ">"
	
	WRITE $EXTRACT($PIECE(FPL(1),Y,1),1,15)
	IF $PIECE(FPL(1),Y,1)="" WRITE "???????????"
	WRITE "</FONT>"
	IF $TRANSLATE(FPL," ")'="" WRITE "</A>"
	WRITE "</TD>"
	FOR BEGINN=TAG:1:(TAG+6) DO  ;EINE WOCHE AUSWERTEN ;one week 
	. WRITE YCR
	. WRITE "<TD VALIGN=TOP NOWRAP align=LEFT width=110"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. IF YDDSATZ#2=0 WRITE " BGCOLOR=LIGHTGREY"
	. WRITE ">"
	. WRITE "<FONT SIZE=1>"
	. SET XPOS=0
	. SET AUF="" FOR  SET AUF=$ORDER(^WWWSOR(YUSER,FPL,BEGINN,AUF)) QUIT:AUF=""  DO  ;SUCHEN AUFTRAG ;seek order 
	. . SET AUF1=$GET(^INAUF(YM,AUF,1))  ;AUFTRAGSDATEN
	. . SET POS="" FOR  SET POS=$ORDER(^WWWSOR(YUSER,FPL,BEGINN,AUF,POS)) QUIT:POS=""  DO  ;SUCHEN POSITION ;seek 
	. . . SET TEIL="" FOR  SET TEIL=$ORDER(^WWWSOR(YUSER,FPL,BEGINN,AUF,POS,TEIL)) QUIT:TEIL=""  DO  ;SUCHEN POSITION ;seek 
	. . . . SET SUCH=$GET(^WWWSOR(YUSER,FPL,BEGINN,AUF,POS,TEIL))
	. . . . QUIT:SUCH=""
	. . . . ;
	. . . . SET DAUER=$PIECE(SUCH,Y,2)  ;3
	. . . . SET SUCH=$PIECE(SUCH,Y,1)
	. . . . ;
	. . . . SET XPOS=1
	. . . . ;NEUES TABLE FÜR FARBEN ;something new to 
	. . . . WRITE YCR
	. . . . ;Q:$D(@(SUCH))'=11  ;KEINE HAUPTPOSITION ;no 
	. . . . SET YFELD=@SUCH  ;DATEN AUS ^INAUFPXL
	. . . . ;
	. . . . ;FARBCODE
	. . . . SET MASCHCOLOR=""
	. . . . SET MASCH=$PIECE(YFELD,Y,57)   ;EINGESETZTE MASCHINE ;machine 
	. . . . IF MASCH'="" SET MASCHCOLOR=$PIECE($GET(^INMASCH(YM,MASCH,1)),Y,26)   ;MASCHINEN FARBCODE ;mechanical 
	. . . . IF MASCH'="" SET MASCH=$PIECE($GET(^INMASCH(YM,MASCH,1)),Y,1)   ;MASCHINE ;machine 
	. . . . IF MASCHCOLOR'="" SET MASCHCOLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,MASCHCOLOR,1)),Y,1)  ;FARBCODE UMSETZEN ;transact money 
	. . . . ;IF MASCHCOLOR="" SET MASCHCOLOR="WHITE"  ;NORMALE FARBE
	. . . . ;
	. . . . ;DAUER ERRECHNEN ;permanence 
	. . . . ;SET DAUER=$GET(DAUER)   ;DAUER IN SEKUNDEN ;table-mat permanence within 
	. . . . ;SET ME=$PIECE(YFELD,Y,40)
	. . . . ;IF +DAUER=0 DO
	. . . . ;. IF ME=2!(ME=10)!(ME=11)!(ME="") SET DAUER=$PIECE(YFELD,Y,45)  ;DAUER DER TÄTIGKEIT
	. . . . ;. IF $PIECE(YFELD,Y,166)'="" SET DAUER=$PIECE(YFELD,Y,166)  ;ERRECHNETE DAUER DER Anweisung
	. . . . ;IF TAG<$H DO  ;TATSÄCHLICHE FERTIGUNGSDAUER LT. BDE ANZEIGEN  ;BEREITS IN SELECT GEPRÜFT ;factory data capture display yet within 
	. . . . ;. NEW FNR
	. . . . ;. SET FNR=""  ;FERTIGUNGSNUMMER
	. . . . ;. IF TEIL="." SET FNR=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,165)
	. . . . ;. IF TEIL'="." SET FNR=$PIECE($GET(^INAUFPT(YM,AUF,POS,TEIL,1)),Y,165)
	. . . . ;. QUIT:FNR=""
	. . . . ;. SET DAUER=$$^INPROSTEMP0(FNR)
	. . . . ;
	. . . . ;LINK FÜR BEARBEITUNG MIT FARBCODIERUNG ;to adaptation by means of 
	. . . . ;WRITE YCR
	. . . . SET WIDTH=0
	. . . . IF +DAUER'=0 SET WIDTH=$JUSTIFY((100/(8*60*60))*DAUER,0,0)
	. . . . IF WIDTH<5 SET WIDTH=5
	. . . . IF WIDTH>100 SET WIDTH=100
	. . . . WRITE "<TABLE "
	. . . . WRITE " BORDER=0"
	. . . . WRITE " STYLE="_""""_"border:1px solid black;"_""""
	. . . . WRITE " WIDTH="_WIDTH_"%"
	. . . . IF MASCHCOLOR'="" WRITE " BGCOLOR="_""""_MASCHCOLOR_""""
	. . . . WRITE " cellspacing=0"
	. . . . WRITE ">"
	. . . . WRITE "<TD"
	. . . . WRITE " HEIGHT=10"
	. . . . WRITE " WIDTH="_WIDTH_"%"
	. . . . WRITE ">"
	. . . . ;WRITE "&nbsp;"
	. . . . WRITE "</td></TR>"
	. . . . WRITE "</TABLE>"
	. . . . ;WRITE YCR
	. . . . WRITE "<A"
	. . . . DO
	. . . . . WRITE " TITLE="_""""
	. . . . . WRITE AUF_"-"_POS_" "_$PIECE(AUF1,Y,8)_$CHAR(13)  ;KOMMISSTION
	. . . . . IF MASCH'="" WRITE MASCH_$CHAR(13)   ;MASCHIENNNAME  
	. . . . . WRITE $PIECE(YFELD,Y,4)_" "_$PIECE(YFELD,Y,1)_$CHAR(13)_$$^WWWTEXT(32025)_":"_$PIECE(YFELD,Y,5) ;ARTIKELNUMMER UND BEZEICHNUNG UND WARENHERKUNFT ;And notation And 
	. . . . . IF $PIECE(YFELD,Y,165)'="" WRITE $CHAR(13)_$$^WWWTEXT(32163)_": "_$PIECE(YFELD,Y,165)   ;FERTIGUNG GEDRUCKT
	. . . . . IF $PIECE(YFELD,Y,163)'="" WRITE $CHAR(13)_$$^WWWTEXT(32164)_": "_$$^WWWDATE($PIECE($PIECE(YFELD,Y,163),".",1))_" "_$$^WWWTIME($PIECE($PIECE(YFELD,Y,163),",",2))  ;FERTIGUNG GESTARTET
	. . . . . IF $PIECE(YFELD,Y,164)'="" WRITE $CHAR(13)_$$^WWWTEXT(32165)_": "_$$^WWWDATE($PIECE($PIECE(YFELD,Y,164),".",1))_" "_$$^WWWTIME($PIECE($PIECE(YFELD,Y,164),",",2))  ;FERTIGUNG BEENDET
	. . . . . ;
	. . . . . DO  ;MEHRFACHBELEGUNG BEI MEHREREN MITARBEITERN ;ULM, 08.10.02
	. . . . . . ;NEW MITARB
	. . . . . . SET MITARB=$LENGTH($PIECE($GET(^INPRONEST(YM,FPL,1)),Y,2),";")-1  ;ANZAHL MITARBEITER AUF FERTIGUNGSPLATZ
	. . . . . ;
	. . . . . IF +MITARB>1 DO
	. . . . . . WRITE $CHAR(13)_MITARB_" "_$$^WWWTEXT(159)_" "_$$^WWWTEXT(32591)_" "_$$^WWWTEXT(32129)  ;MITARBEITER PRO FERTIGUNGSPLATZ ;within 
	. . . . . ;
	. . . . . WRITE """"
	. . . . ;
	. . . . WRITE " HREF="_""""_YAKTION_"EP=WWWFORM"
	. . . . SET TEIL(1)=TEIL
	. . . . IF TEIL(1)="." SET TEIL(1)=""  ;S DAUER=$P($G(^INAUFP(YM,AUF,POS,1)),Y,166)  ;HAUPTPOSITION
	. . . . SET YKEYY=AUF_","_POS
	. . . . IF TEIL(1)'="" SET YKEYY=YKEYY_","_TEIL(1)
	. . . . IF $PIECE(YKEYY,",",3)'="" WRITE "&YFORM="_"INAUFPT"_"&YKEY="_YKEYY_"&YBACK=INTIMEW,&YOPTION="_TAG  ;UNTERTEIL
	. . . . IF $PIECE(YKEYY,",",3)="" WRITE "&YFORM="_"INAUFPT1"_"&YKEY="_$PIECE(YKEYY,",",1,2)_"&YBACK=INTIMEW,&YOPTION="_TAG   ;POSITIONSTEIL
	. . . . DO ^WWWCGI
	. . . . WRITE """"
	. . . . IF YTARGET'="" WRITE " TARGET="_YTARGET
	. . . . WRITE ">"
	. . . . WRITE "<FONT SIZE=1>"
	. . . . WRITE $EXTRACT($$^WWWTIME(DAUER),1,5)
	. . . . IF +DAUER=0 WRITE "??:??"
	. . . . WRITE "</FONT>"
	. . . . WRITE "</A>"
	. ;
	. IF XPOS=0 WRITE "&nbsp;"
	. WRITE "</TD>"
	
	WRITE "</TR>"
	QUIT  
	
SELECT ;SUCHEN TEILEPOSITIONEN ;seek 
    ;-------------------------------------------------------------------------------
    ; History:
    ; 02-Sep-2005	JW		SR12966: TERMIN9 is shared 
    ;-------------------------------------------------------------------------------
	NEW YA,SUCH1,BEGINN,AUF,AUF1,POS,POS1,SUCH,YI,ARBTAGE,ARBZEIT,MITARB
	SET ARBZEIT=$PIECE($GET(^INVORG(YM,YM,1)),Y,16)  ;ARBEITSZEIT AUS MANDANTENVORGABE ;working hours out of 
	IF ARBZEIT="" SET ARBZEIT=8  ;STUNDEN ;procrastinate 
	SET ARBZEIT=ARBZEIT*3600  ;IN SEKUNDEN ;within 
	SET ARBTAGE=$PIECE($GET(^INVORG(YM,YM,1)),Y,17)  ;ARBEITSTAGE AUS MANDANTENVORGABE ;out of 
	IF ARBTAGE="" SET ARBTAGE=5
	
	SET AUF=""
	FOR  SET AUF=$ORDER(^INAUF1SEL(YM,AUF)) QUIT:AUF=""  DO  ;OFFENE AUFTRÄGE
	. SET AUF1=$GET(^INAUF(YM,AUF,1))
	. QUIT:$PIECE(AUF1,Y,2)=2  ;LIEFERANTENBESTELLUNG NICHT AUSGEBEN ;Not 
	. SET POS=""
	. FOR  SET POS=$ORDER(^INAUFP(YM,AUF,POS)) QUIT:POS=""  DO
	. . SET POS1=$GET(^INAUFP(YM,AUF,POS,1))  ;AUFTRAGSPOSITION
	. . IF $PIECE(POS1,Y,168)'="" SET $PIECE(POS1,Y,161)=1   ;TERMIN EINGESETZT
	. . QUIT:$PIECE(POS1,Y,161)'=1  ;NOCH NICHT GEPLANT ;yet Not 
	. . ;IF $PIECE(POS1,Y,19)="" SET $PIECE(POS1,Y,19)=$PIECE(AUF1,Y,19)   ;LIEFERTERMIN AUS AUFTRAG
	. . IF +$PIECE(POS1,Y,7)'=4 IF $PIECE(POS1,Y,7)'=3 QUIT  ;BESTELL ODER LAGERWARE ;Or 
	. . IF +$PIECE(POS1,Y,60)=1 QUIT  ;ABGESCHLOSSENE POSITION, WIEDER EINGESTETZT 08.01.03 - ULM
	. . ;IF +$PIECE(POS1,Y,90)=1 QUIT  ;AUSLIEFERUNGSFÄHIG
	. . ;IF +$PIECE(POS1,Y,164)'=0 QUIT  ;FERTIGGESTELLT
	. . IF +$PIECE(POS1,Y,9)=1 QUIT  ;STORNO POSITION
	. . ;
	. . SET SUCH="^INAUFPXL("_""""_YM_""""_","_""""_AUF_""""_","_"-1"_")"
	. . FOR  DO  QUIT:SUCH=""
	. . . SET SUCH=$QUERY(@SUCH)
	. . . IF $TRANSLATE($PIECE(SUCH,",",2),"""")'=AUF SET SUCH="" QUIT  ;21.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. . . ;IF $PIECE(SUCH,",",2)'=AUF SET SUCH="" QUIT  ;21.06.04;FAN;25794; 
	. . . ;IF $PIECE(SUCH,",",3)'=POS SET SUCH="" QUIT
	. . . IF $PIECE($PIECE(SUCH,")",1),",",3)=POS DO
	. . . . IF $DATA(@SUCH)'=1 QUIT
	. . . . SET SUCH1=@SUCH
	. . . . ;IF $DATA(@SUCH)=11 IF +$PIECE(SUCH1,Y,26)'=0 IF +$PIECE(SUCH1,Y,26)'=2 IF +$PIECE(SUCH1,Y,26)'=3 QUIT  ;KEIN FERTIGUNGS-TEIL
	. . . . ;IF $DATA(@SUCH)=11 IF +$PIECE(SUCH1,Y,7)'=0 IF +$PIECE(SUCH1,Y,7)'=3 IF +$PIECE(SUCH1,Y,7)'=4 QUIT  ;WARENHERKUNFT IST NICHT FERTIGUNG
	. . . . SET BEGINN=$PIECE(SUCH1,Y,168)   ;PRODUKTIONSBEGINN
	. . . . ;
	. . . . SET BEGINN=$PIECE(BEGINN,".",1)   ;WENN KALENDERWOCHE FIS; 02.10.2002
	. . . . QUIT:BEGINN=""
	. . . . IF BEGINN<(TAG-21) QUIT  ;SCHON VORBEI (2 WOCHEN RÜCKWIRKEND, FALLS LÄNGERE AUSFÜHRUNGSDAUER BIS IN DIESE WOCHE REICHT)
	. . . . IF BEGINN>(TAG+6) QUIT  ;NOCH NICHT ;yet Not 
	. . . . SET FPL=$PIECE(SUCH1,Y,61)
	. . . . ;
	. . . . ;IF FPL="" IF $DATA(@(SUCH))=1 QUIT  ;KEINE ANZEIGE WENN UNTERUNTERTEIL OHNE FERTIGUNGSPLATZ UND BEGINN
	. . . . IF FPL="" SET FPL=" "  ;HAUPTPUNKT ABER OHNE ZUWEISUNG EINES FERTIGUNGSPLATZES ;yet without 
	. . . . ;I FPL=" " S FPL=$O(^INPRONEST(YM,""))
	. . . . SET SUCH(1)=$PIECE($PIECE(SUCH,")",1),",",4,99)
	. . . . SET SUCH(0)=$LENGTH(SUCH(1),",")  ;ANZAHL DER ,
	. . . . SET SUCH(2)=""
	. . . . FOR YYI=1:1:SUCH(0) SET SUCH(2)=SUCH(2)_$PIECE(SUCH(1),",",YYI)_"."
	. . . . IF SUCH(2)="" SET SUCH(2)="."  ;FÜR DIE HAUPTPOSITION ;to who 
	. . . . ;
	. . . . SET DAUER=$$^INPROSTEMP0($PIECE(SUCH1,Y,165),3)  ;DAUER JE STEMPELTAG ;permanence once 
	. . . . SET FERTIG=0  ;PRÜFEN OB FERTIGGESTELLT;FIS; ;sift whether 
	. . . . IF $PIECE(SUCH1,Y,165)'="" IF $PIECE($GET(^INPROSTEMP1(YM,$PIECE(SUCH1,Y,165),1)),Y,24)=1 SET FERTIG=1
	. . . . IF +$PIECE(POS1,Y,90)=1 SET FERTIG=1
	. . . . ;
	. . . . ;SAVE GEPLANTE FERTIGUNGSZEITEN
	. . . . ;IF +$PIECE(SUCH1,Y,165)=0!(+DAUER=0)!(+$PIECE(SUCH1,Y,168)<$H) DO  QUIT
	. . . . IF (+DAUER=0) || (FERTIG=0) DO  QUIT  ;FIS:21673;29.08.03;STEMPELZEITEN IMMER ANZEIGEN ;constantly display 
	. . . . . ;
	. . . . . DO  ;MEHRFACHBELEGUNG BEI MEHREREN MITARBEITERN ;ULM, 08.10.02
	. . . . . . ;NEW MITARB
	. . . . . . SET MITARB=$LENGTH($PIECE($GET(^INPRONEST(YM,FPL,1)),Y,2),";")-1  ;ANZAHL MITARBEITER AUF FERTIGUNGSPLATZ
	. . . . . . QUIT
	. . . . . NEW ME,ZEIT,DAT
	. . . . . SET ME=$PIECE(SUCH1,Y,40)
	. . . . . IF ME=2!(ME=10)!(ME=11)!(ME="") IF +MITARB>0 SET DAUER=$PIECE(SUCH1,Y,45)*$PIECE(SUCH1,Y,39)/(+MITARB)  ;DAUER DER TÄTIGKEIT * PRUDUKTIONSMENGE (/ ANZ MA/FP; ULM 08.10.2002)
	. . . . . ;IF ME=2!(ME=10)!(ME=11)!(ME="") SET DAUER=$PIECE(SUCH1,Y,45)*$PIECE(SUCH1,Y,39)  ;DAUER DER TÄTIGKEIT * PRUDUKTIONSMENGE
	. . . . . ;
	. . . . . IF $PIECE(SUCH1,Y,166)'="" SET DAUER=$PIECE(SUCH1,Y,166)  ;ERRECHNETE DAUER DER Anweisung ;permanence the 
	. . . . . IF SUCH(2)="." SET DAUER=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,166)  ;HAUPTPOSITION
	. . . . . SET DAT=BEGINN-1
	. . . . . IF +DAUER=0 SET ^WWWSOR(YUSER,FPL,BEGINN,AUF,POS,SUCH(2))=SUCH_Y_DAUER QUIT   ;SAVE
	. . . . . FOR  QUIT:DAUER'>0  DO
	. . . . . . SET DAT=DAT+1  ;1 TAG SPÄTER ;TAG subsequent 
	. . . . . . QUIT:$DATA(^TERMIN9(0,SPRACHE,DAT))
	. . . . . . QUIT:$$^WWWDAY(DAT)>ARBTAGE
	. . . . . . SET ZEIT=DAUER
	. . . . . . IF DAUER>ARBZEIT SET ZEIT=ARBZEIT
	. . . . . . SET DAUER=DAUER-ZEIT
	. . . . . . SET ^WWWSOR(YUSER,FPL,DAT,AUF,POS,SUCH(2))=SUCH_Y_ZEIT   ;SAVE (SUCH IST DER KEY AUS INAUFPXL) ;the KEY out of 
	. . . . ;
	. . . . ;SAVE STEMPELZEITEN LT. BDE ;factory data capture 
	. . . . FOR YI=1:1  QUIT:$PIECE(DAUER,Y,YI,999)=""  DO
	. . . . . NEW DAT,ZEIT
	. . . . . SET DAT=+$PIECE($PIECE(DAUER,Y,YI),"#",1)  ;STEMPELTAG
	. . . . . SET ZEIT=+$PIECE($PIECE(DAUER,Y,YI),"#",2)  ;STEMPELZEIT
	. . . . . IF +DAT'=+BEGINN QUIT:+ZEIT=0  ;KEINE WERTE NUR AM FERTIGUNGSTAG ANZEIGEN ;no only to the display 
	. . . . . IF +DAT=0 SET DAT=BEGINN
	. . . . . SET ^WWWSOR(YUSER,FPL,DAT,AUF,POS,SUCH(2))=SUCH_Y_ZEIT   ;SAVE (SUCH IST DER KEY AUS INAUFPXL) ;the KEY out of 
	
	QUIT
]]></Routine>
</Export>