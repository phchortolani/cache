<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWFORM9" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[WWWFORM9
	
#include COMSYS
#include WWWConst
#include COMConst
	
#define LogR(%1,%2) 	;
#define LogR2(%1,%2) 	;
#define LogRx(%1)		;
#;define LogR(%1,%2) 	$$$JournalOff s ^zzLogR($g(YBED,"UNK"),$i(^zzLogR))= %1_"^WWWFORM9("_%2_") : "_$zh $$$JournalOn
#;define LogR2(%1,%2) 	$$$JournalOff s ^zzLogR($g(YBED,"UNK"),$i(^zzLogR))= %1_"^WWWFORM9("_%2_") : "_$zh $$$JournalOn
#;define LogRx(%1)		$$$JournalOff s ^zzLogR($g(YBED,"UNK"),$i(^zzLogR))=%1 $$$JournalOn
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		EINGABE VORBEREITEN - Input Preparation
	;
	; Called By: FORMVOR^WWWFORMD, PRIM^WWWFORML, FELD^WWWFORML, ^WWWFORMO
	;            ^WWWFORMP, ^WWWFORMW, FORMVOR^WWWFORMW, ^WWWSMA
	;
	; By Ref : 
	;
	;	YKEY	= PRIMÄRSCHLÜSSEL  XX,XX,XX  ;WENN DATEI
	;	YFORM	= FORMULAR
	;	YLFN	= Form  Field Number F#      LFD DATENBANKNUMMER
	;	YBBN	= Class Field Number D#      LFN BEARBEITUNGSNUMMER
	;	YART	= Type
	;				O=OPTIONEN, P=PRIMÄR, D=DATENFELDER, M=MANUELLE,
	;				LP=LISTGENERATORPRIMÄR, LD=LISTFGEN.DATENFELDER, S=SORTIERUNG
	;	YFOART	= FORMART 1=NORMAL 2=LISTE 3=GRID 4=MANUELLE
	;	YSATZ	= DEFINITION VORGABE WWW121,WWW122 (Form); WWW132,WWW133 (List)
	;	YFELD	= DATENSATZ    ;WENN DATEI   ;when data file 
	;	YINHALT	= FELDINHALT   ;WENN MANUELL ;when 
	;	YGRIKEY	= STAMMKEY FUER GRIDSTAMM
	;	YLISTLF	= LISTEN EINZELFELD
	;	YVOR	= VORGABEN DES FORMULARS
	;	YOLDVAL	= VORGABEWERT
	;	YPARA1	= ?
	;
	; Returns : Nothing
	;
	;
	; History :
	; 04-Oct-2012	shobby	SR18129: Better alignment of caption and input controls
	; 29-Aug-2011	PPP		SR17887: Added FONTSIZE for 'Text Behind User Input Field'
	; 06-Jan-2011	GRF		SR17579: Use explicit tag
	; 25-Jun-2009	shobby	SR16679: Allow the 'Text Behind User Input Field' to be translatable
	; 30-May-2008	shobby	SRBR014949: Corrected issue with WWW1211
	; 04-Apr-2008	GM		SRBR014923: Changed $$^WWWTEXT() to $$$Text() for language texts (53) and (54) 
	; 10-Oct-2007	GRF		SR15563: Macro change
	; 01-Jun-2007	shobby	SRBR014501: Put the onBehind calls before the translated references.
    ; 07-May-2007	GRF		SRBR014310: Doco; quits
	; 19-Oct-2006	RPW		SR14914: Clean ups for multiple calls to one routine and
	; 							removed naked references
	; 18-Apr-2006	JW		SR14421: Key should not be converted to display format yet. 
	;  9-Dec-2005	JW		SR13195: Update 2nd D piece of WWWDATEN as well. Don't set
	;  							either if just changing tabs
	; 16-Nov-2005	GRF		SR12505: Doco
	; 28-Oct-2005	JW		SR13074: Exchange Rate type
	; 30-May-2005	RPW		SR12056: Attempt at Performance Increase
	; 04-APR-2005	TYBD	IDs FOR BUTTON ADDED FOR TESTDIRECTOR
	; 05-Aug-1997	DT		(C) BY DITMAR TYBUSSEK
	;-------------------------------------------------------------------------------
	set YPARA1 = $get(YPARA)
	
	new YO,YI,YNAME,YNAME0,YNAME1,YTYPE,YPARA,YTYP,Q,YSORT,YXTYP,YFOART1,YJAVA,YPFLICHT,YCOLOR1
	new YPADDINGTOP ;SR18129
	new strLanguage
	
	$$$LogR("",YFORM_"<"_YART_"<"_YFOART)
	
	set YPARA = YPARA1
	set YFELD = $get(YFELD)
	
	quit:YFORM=""  ;FORMULAR ;form 
	quit:YART=""   ;P=PRIMÄR,D=DATENFELDER,M=MANUELLE,L=LISTGENERATOR  [O=OPTION?]
	;Q:YLFN=""     ;LFD NUMMER
	;Q:YSATZ=""    ;DEFINITION VORGABE WWW121,WWW122,WWW1210
	;-------------------------------------------------------------------------------
	
	;---------------------------------------
	;  D36 : Horizontal Orientation  WWW121/122
	;---------------------------------------
	set YFAUS="LEFT"
	if $piece(YVOR,Y,36)=3  set YFAUS="RIGHT"
	if $piece(YSATZ,Y,36)=3 set YFAUS="RIGHT"
	if $piece(YVOR,Y,36)=2  set YFAUS="CENTER"
	if $piece(YSATZ,Y,36)=2 set YFAUS="CENTER"
	if $piece(YVOR,Y,36)=1  set YFAUS="LEFT"
	if $piece(YSATZ,Y,36)=1 set YFAUS="LEFT"
	if YFOART=3             set YFAUS="LEFT"   ;WENN GRID, DANN LINKS
	
	;---------------------------------------
	;  D37 : Vertical Orientation  WWW121/122
	;---------------------------------------
	set YVAUS="TOP"
	if $piece(YVOR,Y,37)=3  set YVAUS="BOTTOM"
	if $piece(YSATZ,Y,37)=3 set YVAUS="BOTTOM"
	if $piece(YVOR,Y,37)=2  set YVAUS="MIDDLE"
	if $piece(YSATZ,Y,37)=2 set YVAUS="MIDDLE"
	if $piece(YVOR,Y,37)=4  set YVAUS="BASELINE"
	if $piece(YSATZ,Y,37)=4 set YVAUS="BASELINE"
	if $piece(YVOR,Y,37)=1  set YVAUS="TOP"
	if $piece(YSATZ,Y,37)=1 set YVAUS="TOP"
	if YFOART=3             set YVAUS="BOTTOM"  ;GRID=UNTEN
	
	set YPADDINGTOP="0px"						;SR18129
	if YVAUS="TOP" {							;SR18129
		if $$$WWW122FlatControls(YSATZ) {		;SR18129
			set YPADDINGTOP="1px"				;SR18129
		} else {								;SR18129
			set YPADDINGTOP="3px"				;SR18129
		}										;SR18129
	}											;SR18129

	set YXTYP = 0
	set YHID  = 0
	if $get(YBBN)="" set YBBN=YLFN
	;SET YNUMMER   = YLFN
	set YNUMMER   = YBBN
	set YFOART1   = YFOART
	set YTYP	  = ""
	set YINHALT   = ""
	set YNAME0	  = ""
	set YNAME1	  = ""
	set YPARA(7)  = 0
	set YPARA(20) = 0  ; "Display All Relations"
	set YPARA(29) = 1  ;  Display Direction 1 or -1     AUF / AB SORTIERUNG ; based on WWW003 D29 : DisplayRelationsDownwards
	set YJAVA	  = 0
	set YPFLICHT  = ""
	set YSTATUS   = $piece(YSATZ,Y,65)
	
	if (YFOART=1) || (YFOART=3) || (YFOART=4) || (YFOART=5) set YJAVA=1  ;BEARBEITUNGSSTATUS
	for YI=53:1:56,60 set YO(YI)=$piece(YVOR,Y,YI)
	
	kill ^WWWSOR(YUSER,2)
	
	;-------------------------------------------------------------------------------
	; Primary Key             ; PRIMAERSCHLUESSEL
	;	YSATZ			WWW121
	;	YDVOR			WWW002
	;
	;-------------------------------------------------------------------------------
	if YART="P" do
	. set YDATEI=$piece($get(^WWW120(0,YFORM,1)),Y,11)   ; Class associated with form
	. quit:YDATEI=""
	. ;
	. set YFOART1=1
	. ;
	. ; Form Type 3 : Grid
	. ; Close off prior key table if applicable and call WWWFORM3 to build grid header line
	. ;-------------------------------------
	. if YFOART=3 if YLFN=$order(^WWW002(0,YDATEI,""),-1) do  if ($$$WWW120AuthorizationToModifyData(YVOR)=$$$EnumReadOnly) write YCR,"<INPUT NAME=""Y"_YFORM_YART_YLFN_"""" write " ID=""Y"_YFORM_YART_YLFN_"""" write " TYPE=HIDDEN" quit  ;WENN LETZTER KEY IM GRID ;when last KEY  ;SR17253
	. . if YLFN'=1 do
	. . . ;		D16		$$$WWW121FixedInputForHiddenField()
	. . . if YLFN=2 if $piece($get(^WWW121(0,YFORM,1,1)),Y,16)=0 quit  ;TYBD;6.1.2003;WENN KEIN PRIMÄRSCHLÜSSEL DANN KEIN ENDE ;when no no termination 
	. . . write YCR,"</TR></TABLE><BR>"
	. . . set YTABLEANZ=$get(YTABLEANZ)-1
	. . ;
	. . set YFOART1=3 do ^WWWFORM3  ; Form Type 3 : GRID - Display Heading line
	. ;
	. ;-------------------------------------
	. set YDVOR = $get(^WWW002(0,YDATEI,YLFN,1))  ;VORGABEN AUS DATEIDEV ;out of 
	. if $get(YTIMEFORM)=1 do   ;ZEITABHÄNGIGE ERFASSUNG ;logging 
	. . set YSAVEDDATA = 1
	. . if YDVOR'="" quit       ;KEY VORHANDEN ;KEY on hand 
	. . if $piece(YKEY,",",YLFN)="" set $piece(YKEY,",",YLFN) = ""  ;$H+1
	. . if $piece(YKEY,",",YLFN)="" set YSAVEDDATA = ""
	. . set YDVOR = "Effectivity Date~Effectivity Date~1~10~~~"         ; FIXME : Internationalise rather than EN/DE?
	. . if SPRACHE="DE" set YDVOR="Gültig ab Datum~Gültig ab Datum~1~10~~~"  ;bei Zeitabhängiger erfassung ;next to
	. ;
	. quit:YDVOR=""
	. ;
	. ;-------------------------------------
	. set YTYP  = $piece(YDVOR,Y,3)      ; $$$WWW002InputType()                  TYPE AUS DATEI DEV ;letter out of data file 
	. set YXTYP =+$piece(YSATZ,Y,104)    ; $$$WWW121TypeOfAcquisition()          ERFASSUNGSART AUS FORMULARFELD ;out of 
	. if YXTYP=16 set YXTYP = 0          ; Primary key cannot be a "Collection"
	. if $piece(YSATZ,Y,16)'="" do       ; $$$WWW121FixedInputForHiddenField()   default for fixed key
	. . set YHID=1
	. . if YLFN=$piece(YSATZ,Y,16) do
	. . . if $piece(YFKEY,",",YLFN)'="" if $piece(YKEY,",",$piece(YSATZ,Y,16))="" set $piece(YKEY,",",YLFN)=$piece(YFKEY,",",$piece(YSATZ,Y,16))  ;WENN "NEU"  BEI GLEICHE KEYS
	. . . set $piece(YFKEY,",",YLFN)=$piece(YKEY,",",$piece(YSATZ,Y,16))  ;GLEICHE KEYS ;same 
	. . . quit:$piece(YKEY,",",YLFN)'=""
	. . . new YBACK1 
	. . . set YBACK1=$piece($get(YBACK),",",$length($get(YBACK),",")-1)
	. . . if YBACK1'="" set $piece(YKEY,",",YLFN)=$get(^WWW126(YM,YBACK1,YUSER,$piece(YSATZ,Y,16),1)) set $piece(YFKEY,",",YLFN)=$get(^WWW126(YM,YBACK1,YUSER,$piece(YSATZ,Y,16),1)) ;UNGLEICHE KEYS
	. . ;
	. . if YLFN'=$piece(YSATZ,Y,16) do
	. . . quit:+$piece(YSATZ,Y,16)=0
	. . . new YBACK1 
	. . . set YBACK1=$piece($get(YBACK),",",$length($get(YBACK),",")-1)
	. . . if YBACK1'="" set $piece(YKEY,",",YLFN)=$get(^WWW126(YM,YBACK1,YUSER,$piece(YSATZ,Y,16),1)) set $piece(YFKEY,",",YLFN)=$get(^WWW126(YM,YBACK1,YUSER,$piece(YSATZ,Y,16),1)) ;UNGLEICHE KEYS
	. . ;
	. . if +$piece(YSATZ,Y,16)=0 do
	. . . quit:$get(YSAVEDDATA)=1  ;DATEN WAREN GESPEICHERT = KEINE VORBELEGUNG ;no 
	. . . if $piece(YSATZ,Y,15)'="+" set $piece(YFKEY,",",YLFN) = $piece(YSATZ,Y,15)
	. . . if $piece(YSATZ,Y,15)="+"  set $piece(YFKEY,",",YLFN) = $piece(YSATZ,Y,15),$piece(YKEY,",",YLFN)=$piece(YSATZ,Y,15),YINHALT=$piece(YSATZ,Y,15)
	. . . ;SET $PIECE(YFKEY,",",YLFN)=$PIECE(YSATZ,Y,15),$PIECE(YKEY,",",YLFN)=$PIECE(YSATZ,Y,15),YINHALT=$PIECE(YSATZ,Y,15)
	. . . if (YTYP=1)||(YTYP=7)               set YINHALT=$$GetInternal^WWWTR(YTYP,YINHALT)  ;DATUM/UHRZEITVORGABE
	. . . if $extract($piece(YSATZ,Y,15))="@" set YINHALT=$get(@($extract($piece(YSATZ,Y,15),2,99))) set $piece(YFKEY,",",YLFN)=YINHALT set $piece(YKEY,",",YLFN)=YINHALT
	. ;
	. ;-------------------------------------
	. set YLANGE = $piece(YDVOR,Y,4)   ; $$$WWW002InputSize() 
	. if $piece($get(^WWW121D(0,YFORM,YLFN,YM,1)),Y,3)'="" set YLANGE=$piece($get(^WWW121D(0,YFORM,YLFN,YM,1)),Y,3)  ;MANDANTENVORGABE
	. set YNAME0 = $piece(YSATZ,Y,27)  ;VOR TEXT   ;pre- Text 
	. ;SET YNAME1 = $PIECE(YSATZ,Y,28)  ;NACH TEXT  ;within Text ;SR16679
	. set YNAME1 = $$$Text($$$WWW122TextBehindUserInputField(YSATZ))
	. set YNAME  = $piece(YDVOR,Y,2)   ;NORMALTEXT ;notation 
	. set strLanguage=$$^WWWLANGU(YBED) ;BR014949
	. if $data(^WWW0021(0,YDATEI,YLFN,strLanguage,1)) set YNAME=$piece(^WWW0021(0,YDATEI,YLFN,strLanguage,1),Y,1)  ;SPRACHENTEXT AUS KLASSENDEFINITION ;BR014949
	. if $data(^WWW1211(0,YFORM,YLFN,strLanguage,1))  set YNAME=$piece(^WWW1211(0,YFORM,YLFN,strLanguage,1),Y,1)   ;SPRACHENTEXT AUS FORMULARDEFINITION  ;FIS;11.03.05;27434 ;BR014949
	. set YPARA(12)   = $$$WWW003SortTheRelation(YDVOR)
	. set YPARA(1)    = $$$WWW003RelationDatabase(YDVOR)        ;RELATIONEN
	. set YPARA(2)    = $$$WWW003RelationalPrimaryKeys(YDVOR)   ;PARAMETER
	. set YPARA(3)    = $$$WWW003RelationalDisplayItems(YDVOR)  ;DATENFELD ;data item 
	. set YPARA(20)   = $$$WWW003RelationDisplayOptions(YDVOR)
	. set YPARA(33)   = $$$WWW003DisplayIfSortKeyEqual(YDVOR)   ;ZUGRIFF AUF SORTKEY ;upon 
	. set YPARA("CF") = $$$WWW003CalcRelationalDisplayItems(YDVOR)  ;Calculated Display Fields			//SR16663
	. ;
	. ;-------------------------------------
	. ;  Relation Class
	. ;  	D15		$$$WWW121DefaultVariableInput()
	. ;  	D29		$$$WWW121DisplayIfSORTKeys()
	. ;  	D31		-
	. ;  	D32		$$$WWW121RelationClass()
	. ;  	D33		$$$WWW121RelationPrimaryKeys()
	. ;  	D34		$$$WWW121RelationalDisplayItems()
	. ;  	D35		$$$WWW121RelationDisplayOptions()
	. ;  	D62		-                                    $$$WWW122SortTheRelation()
	. ;  	D63		$$$WWW121SequenceOfRelationFields()
	. ;  	D67		$$$WWW121ResultTransferIntoAField()
	. ;  	D79		$$$WWW121RelationalItemToMark()
	. ;-------------------------------------
	. if $piece(YSATZ,Y,32)'="" do
	. . set YPARA(12)   = $piece(YSATZ,Y,62)                    ;REL SORTIEREN ;assortment 
	. . set YPARA(1)    = $$$WWW121RelationClass(YSATZ)         ;RELDATEI AUS FORMULAR DEV ;out of form     ; SR15563
	. . set YPARA(2)    = $piece(YSATZ,Y,33)                    ;KEY F. RELATION
	. . set YPARA(3)    = $piece(YSATZ,Y,34)                    ;FELDER 
	. . set YPARA(33)   = $piece(YSATZ,Y,31)                    ;ZUGRIFF AUF SORTKEY ;upon 
	. . set YPARA("CF") = $$$WWW121CalcRelationalDisplayItems(YSATZ)  ;Calculated Display Fields			//SR16663
	. . if $piece(YSATZ,Y,63)'="" set YPARA(3) = $piece(YSATZ,Y,63)
	. . set YPARA(20)   = $$$WWW121RelationDisplayOptions(YSATZ)
	. ;
	. set YPARA(67) = $$$WWW121ResultTransferIntoAField(YSATZ)
	. set YPARA(79) = $piece(YSATZ,Y,79)                        ;RELATIONSFELD FÜR MARKIERUNG ;to 
	. ;
	. set YPARA(80) = ""                                        ;WELCHE FELDER MARKIEREN ;who 
	. set YSPAL     = $piece(YSATZ,Y,4)                             ;WELCHE SPALTE ;who rift 
	. set YINHALT   = $translate($piece(YKEY,",",YLFN),"""")  ;Default for field - Internal Format
	. if $piece($get(^WWW121D(0,YFORM,YLFN,YM,1)),Y,1)'="" set $piece(YSATZ,Y,15) = $piece(^WWW121D(0,YFORM,YLFN,YM,1),Y,1)  ;MANDANTENVORGABE
	. if $piece($get(^WWW121D(0,YFORM,YLFN,YM,1)),Y,63)'="" do  ;MANDANTENVORGABE RELATION;TYBD:2,09,2003;23892
	. . set YPARA(3) = $translate($piece(^WWW121D(0,YFORM,YLFN,YM,1),Y,63),",",";") 
	. . set $piece(YDVOR,Y,10)=YPARA(3) 
	. ;
	. // TODO JW - Change to use CalculateString^WWWFORMD
	. ;-------------------------------------
	. ;  D15	WWW121	Default Variable Input
	. ;  
	. ;  @string
	. ;  	e.g. @"dataLocn" sets YINHALT to contents of dataLocn
	. ;  	     @dataLocn   sets YINHALT to contents of variable/global contained in dataLocn
	. ;  @$string	
	. ;  @#string
	. ;  	e.g. @#"dataLocn" sets YINHALT to string dataLocn
	. ;  		 @#dataLocn   sets YINHALT to contents of dataLocn
	. ;-------------------------------------
	. if YINHALT="" set YINHALT = $piece(YSATZ,Y,15) if $extract(YINHALT)="@" do
	. . if $extract(YINHALT,2)'="$" if $extract(YINHALT,2)'="#"   set YINHALT = $get(@($extract($piece(YSATZ,Y,15),2,99))) quit
	. . new YINHALT1
	. . if ($extract(YINHALT,2)="$") || ($extract(YINHALT,2)="#") set YINHALT1 = "S YINHALT="_$extract($piece(YSATZ,Y,15),2,99) xecute YINHALT1
	. ;
	. set YGROUP=1
	. if YTYP=0 if $get(YSAVEDDATA)'=1 if +$piece(YSATZ,Y,16)=0   set YINHALT = $piece(YSATZ,Y,15) if $extract(YINHALT)="@" do
	. . if ($extract(YINHALT,2)'="$") && ($extract(YINHALT,2)'="#") do
	. . . set YINHALT = $get(@($extract($piece(YSATZ,Y,15),2,99)))
	. . . set $piece(YFKEY,",",YLFN) = YINHALT
	. . . set $piece(YKEY,",",YLFN)  = YINHALT
	. . ;
	. . if ($extract(YINHALT,2)="$") || ($extract(YINHALT,2)'="#") do
	. . . new YINHALT1
	. . . set YINHALT1 = "S YINHALT="_$extract($piece(YSATZ,Y,15),2,99)
	. . . xecute YINHALT1
	. . . set $piece(YFKEY,",",YLFN) = YINHALT
	. . . set $piece(YKEY,",",YLFN)  = YINHALT
	. ;
	. if $piece(YSATZ,Y,21)'="" if +$piece(YSATZ,Y,21)=0 set @($piece(YSATZ,Y,21)) = YINHALT
	. if YFOART'=7 if ($piece(YSATZ,Y,2)=1) || (YTYP=9) if YINHALT="" set YINHALT = "+"  ;AUTOM LFN
	. ;
	. ;-------------------------------------  *** EXECUTE ***
	. ;  D26 : ExecuteOnLoad (P/D)
	. ;-------------------------------------
	. if $piece(YSATZ,Y,26)'="" xecute $piece(YSATZ,Y,26)  ;EXECUTE BEI ONLOAD (YINHALT) ;EXECUTE next to 
	. if $$EXIST^%R("Y"_YFORM_YART_YLFN_"onLoad.OBJ",$get(YUCI)) xecute "DO ^Y"_YFORM_YART_YLFN_"onLoad"  ;CUSTOMIZED EXECUTE;FIS;24947;10.01.04
	. ;
	. ;-------------------------------------
	. ;
	. if YFORM="WWW127" set YHID=1
	. if $data(^WWW129(0,YFORM,YLFN)) set YJAVA=1
	. if +$get(YHID)=0 if $get(YFELD)'="" do         ;Primärschluessel ohne Änderung ;Without Modify Only 
	. . ;IF YFOART'=3 IF YFELD="" QUIT               ;WENN NICHT GRID DANN NUR, WENN DATENSATZ ANGEZEIGT
	. . if $get(YSAVEDDATA)=1 set YHID=2 quit        ;NEU FÜR ANZEIGE SEITENWECHSEL BEI NICHT GESPEICHERTEN DATEN  ;recent to Show next to Not 
	. . ;IF $TRANSLATE($PIECE(YKEY,",",YLFN),"""")'="" IF $TRANSLATE($PIECE(YKEY,",",YLFN),"""")'="+" SET YHID=2  ;KEIN KOPIEREN
	. ;
	. if YINHALT'="" set $piece(^WWWDATEN(YM,+$horolog,YUSER,YFORM,"P",1),",",YLFN)=YINHALT
	. ;
	. //IF YHID=1 DO  ;TYBD 20.02.2002	SR14421 - Should not convert...
	. //. IF (YTYP=1) || (YTYP=7) SET YINHALT = $$GetLiteral^WWWTR(YTYP,YINHALT)  ;Date/Time ;Convert to External Format
	. ;
	. if YXTYP=15 do
	. . if (YTYP=1) || (YTYP=7) set YINHALT = $$GetLiteral^WWWTR(YTYP,YINHALT)  ;DATUM/UHRZEITVORGABE
	. . set YTYP=0  ;UNSICHTBAR ;viewless 
	. ;
	. if $piece(YSATZ,Y,16)=0 do
	. . if (YTYP=1) || (YTYP=7) set YINHALT = $$GetLiteral^WWWTR(YTYP,YINHALT)        ;DATUM/UHRZEITVORGABE
	. . if (+$piece(YSATZ,Y,104)=0) || ($piece(YSATZ,Y,104)=15) set YTYP = 0  ;UNSICHTBAR ;viewless 
	. ;
	. do Start^WWWFORM7($$$YES)
	. ;
	. ; Form Type 1 : Standard
	. ;-------------------------------------
	. if YFOART=1 do  ;ANZEIGE FE]]><![CDATA[LDER BEI MEHREREN SEITEN ;Show next to sidelong 
	. . new YI  
	. . if ($piece(YDVOR,Y,8)="") || ($piece(YDVOR,Y,8)=YDATEI) do
	. . . if $get(YPARA(3))'="" set $piece(YDVOR,Y,10) = $translate(YPARA(3),",",";")   ;MULTIPLE ANZEIGE NACH PRIMÄRSCHLÜSSEL;TYBD;30,7,2004;26192
	. . . if $piece(YDVOR,Y,10)'="" do
	. . . . set YI(2)=""
	. . . . write "<FONT SIZE=2>"
	. . . . if $piece($get(YVOR1),Y,95)=1 write YCR,"<STRONG><B>"      ; $$$WWW012PrimaryKeyFatRepresent()
	. . . . for YI=1:1 set YI(1)=$piece($piece(YDVOR,Y,10),";",YI) quit:YI(1)=""  do
	. . . . . set YI(3)=$piece($get(YFELD),Y,YI(1))
	. . . . . if YI'=1 if YI(2)'="" if YI(3)'="" set YI(2)=YI(2)_", "  ;TYBD;22.07.2003;ZU VIELE ,
	. . . . . set YI(2)=YI(2)_YI(3)
	. . . . ;
	. . . . write "&nbsp;",YI(2)                                       ; YI(2) = Primary Keys List
	. . . . if $piece($get(YVOR1),Y,95)=1 write YCR,"</STRONG></B>"
	. ;
	. ;VVV BR014501
	. ;IF $PIECE(YSATZ,Y,97)'="" WRITE " " XECUTE $PIECE(YSATZ,Y,97)  ;execute hinter feld ;posterior 
	. ;IF $$EXIST^%R("Y"_YFORM_YART_YLFN_"onBehind.OBJ",$GET(YUCI)) WRITE " " XECUTE "DO ^Y"_YFORM_YART_YLFN_"onBehind"  ;CUSTOMIZED EXECUTE;FIS;24947;10.01.04
	
	
	
	;-------------------------------------------------------------------------------
	; Data Fields
	; 	YSATZ			WWW122
	;   YXTYP		D5		InputType					^WWW100("FELDTYP")
	;   YINHALT		D16		FixedInputForHiddenField
	;   			D120	InputInVariable
	;   			D63		RelationFieldSequence
	;
	;	YDVOR			WWW003
	;   YTYPE		D3		InputType					^WWW100("FELDTYP")
	;   			D8		RelationDatabase
	;   			D9		RelationalPrimaryKeys
	;   			D10		RelationalDisplayItems
	;   			D21		DisplayIfSortKeyEqual
	;-------------------------------------------------------------------------------
	;I YART="D"!(YART="M") I YOPTION'="" I $P(YSATZ,Y,50)'="" I $E($P(YSATZ,Y,50))'="'" I '$F(","_$P(YSATZ,Y,50)_",",","_YOPTION_",")         S YHIDDSE=1  ;FALSCHE OPTION
	;I YART="D"!(YART="M") I YOPTION'="" I $P(YSATZ,Y,50)'="" I $E($P(YSATZ,Y,50))="'"  I $F(","_$E($P(YSATZ,Y,50),2,90)_",",","_YOPTION_",") S YHIDDSE=1  ;FALSCHE NICHT OPTION
	;I YART="D"!(YART="M") I YPARA1'=""  I $P(YSATZ,Y,51)'="" I $E($P(YSATZ,Y,51))'="'" I '$F(","_$P(YSATZ,Y,51)_",",","_YPARA1_",")          S YHIDDSE=1  ;FALSCHE OPTION
	;I YART="D"!(YART="M") I YPARA1'=""  I $P(YSATZ,Y,51)'="" I $E($P(YSATZ,Y,51))="'"  I $F(","_$E($P(YSATZ,Y,51),2,90)_",",","_YPARA1_",")  S YHIDDSE=1  ;FALSCHE NICHT OPTION
	
	if YART="D" do
	. set YDATEI = $piece($get(^WWW120(0,YFORM,1)),Y,11)   quit:YDATEI=""
	. set YDVOR = $get(^WWW003(0,YDATEI,YLFN,1))           quit:YDVOR=""  ;DATEN AUS FELDDEV ;out of 
	. ;
	. set YTYP = $piece(YDVOR,Y,3)   ;ERFASSUNGSART
	. if (YTYP=12) || (YTYP=18) if +YINHALT'=0 if $piece(YDVOR,Y,16)'="" set YINHALT=$justify(YINHALT,0,$piece(YDVOR,Y,16))  ;NACHKOMMASTELLEN	//SR13074
	. if $piece(YSATZ,Y,5)'="" set YTYP=$piece(YSATZ,Y,5)
	. set YXTYP=+$piece(YSATZ,Y,2)         ;ERFASSUNGSART AUS FORMULARFELD ;TYPE OF ACQUISITION FROM FORM FIELD
	. if YXTYP=15 set YTYP=0               ;UNSICHTBAR ;hidden 
	. if $piece(YSATZ,Y,16)'="" do         ;FESTE VORGABE ;default 
	. . set YHID=1                         ;UNSICHTBAR ;hidden 
	. . set YINHALT = $piece(YSATZ,Y,16)
	. . if (YTYP=1) || (YTYP=7) if $extract(YINHALT)'="@" set YINHALT=$$GetInternal^WWWTR(YTYP,YINHALT)  ;DATUM/UHRZEITVORGABE ;DATE/TIME DEFAULT
	. . if $extract(YINHALT)="@" do
	. . . if $extract(YINHALT,2)'="$" if $extract(YINHALT,2)'="#" set YINHALT=$get(@($extract($piece(YSATZ,Y,16),2,99))) quit
	. . . new YINHALT1
	. . . set YINHALT1="S YINHALT="_$extract($piece(YSATZ,Y,16),2,99) 
	. . . xecute YINHALT1
	. ;
	. set YLANGE=$piece(YDVOR,Y,4)               ;FELDLENGE
	. if +$piece(YSATZ,Y,6)'=0 set YLANGE=$piece(YSATZ,Y,6)
	. ;-----
	. set YNAME0 = $piece(YSATZ,Y,27)            ;TEXT VOR ;Text pre- 
	. ;SET YNAME1 = $PIECE(YSATZ,Y,28)            ;TEXT NACH ;Text within 
	. set YNAME1=$$$Text($$$WWW122TextBehindUserInputField(YSATZ)) ;16679
	. set YNAME  = $piece(YDVOR,Y,2)             ;NORMALTEXT
	. set strLanguage = $$^WWWLANGU(YBED)          // SR14914
	. if $data(^WWW0031(0,YDATEI,YLFN,strLanguage,1)) set YNAME = $piece(^WWW0031(0,YDATEI,YLFN,strLanguage,1),Y,1)  ;SPRACHENTEXT AUS KLASSENDEFINITION // SR14914
	. if $data(^WWW1221(0,YFORM,YBBN,strLanguage,1))  set YNAME = $piece(^WWW1221(0,YFORM,YBBN,strLanguage,1),Y,1)   ;SPRACHENTEXT AUS FORMULARDEFINITION  ;FIS;11.03.05;27434 // SR14914
	. ;-----
	. set YPARA(12)=$piece(YDVOR,Y,7)            ;RELATION SORTIEREN ;assortment 
	. if $piece(YDVOR,Y,29)=$$$YES set YPARA(29)=-1   ;RELATION ABSTEIGEND WENN =1  ;when 
	. set YPARA(1)   = $piece(YDVOR,Y,8)         ;RELATIONSDATEI  AUS DATEIDEV ;out of 
	. set YPARA(33)  = $piece(YDVOR,Y,21)        ;ZUGRIFF AUF SORTKEY ;upon 
	. set YPARA(2)   = $piece(YDVOR,Y,9)         ;REL KEY
	. set YPARA(3)   = $piece(YDVOR,Y,10)        ;REL FELD ;field 
	. set YPARA(120) = $piece(YSATZ,Y,120)       ;KEY NICHT ANZEIGEN ;KEY Not display 
	. if $piece(YSATZ,Y,63)'="" set YPARA(3)=$piece(YSATZ,Y,63)
	. set YPARA(20)=$piece(YDVOR,Y,20)           ;ERST SPÄTER ANZEIGEN ;only subsequent display 
	. set YPARA("CF") = $$$WWW003CalcRelationalDisplayItems(YDVOR)  ;Calculated Display Fields			//SR16663
	. ;
	. ;-------------------------------------
	. ;  Relation Class
	. ;  	D29		$$$WWW122DisplayRelationsDownwards()
	. ;  	D31		$$$WWW122DisplayIfSortCodes()
	. ;  	D32		$$$WWW122RelationClass()
	. ;  	D33		$$$WWW122RelationalPrimaryKey()
	. ;  	D34		$$$WWW122RelationalDataField()
	. ;  	D35		$$$WWW122RelationDisplayOptions()
	. ;  	D62		$$$WWW122SortTheRelation()
	. ;  	D63		$$$WWW122RelationFieldSequence()
	. ;  	D67		$$$WWW122RelationSendToField()
	. ;  	D79		$$$WWW122RelationalItemToMark()
	. ;-------------------------------------
	. if $piece(YSATZ,Y,32)'="" do
	. . set YPARA(12) = $piece(YSATZ,Y,62)       ;REL SORTIEREN ;assortment 
	. . set YPARA(1)  = $piece(YSATZ,Y,32)       ;RELDATEI AUS FORMULAR DEV ;out of form 
	. . set YPARA(2)  = $piece(YSATZ,Y,33)       ;KEY F. RELATION
	. . set YPARA(3)  = $piece(YSATZ,Y,34)       ;FELDER 
	. . set YPARA(33) = $piece(YSATZ,Y,31)       ;ZUGRIFF AUF SORTKEY ;upon 
	. . if $piece(YSATZ,Y,63)'="" set YPARA(3)=$piece(YSATZ,Y,63)
	. . set YPARA(20) = $piece(YSATZ,Y,35)        ;ERST SPÄTER ANZEIGEN ;only subsequent display 
	. . if $piece(YSATZ,Y,29)=1 set YPARA(29)=-1  ;RELATION ABSTEIGEND WENN =1  ;when 
	. ;
	. set YPARA(67)=$piece(YSATZ,Y,67)  ;NEUES FELD AUS EVENT BROKER ;something new field out of 
	. set YPARA(79)=$piece(YSATZ,Y,79)  ;RELATIONSFELD FÜR MARKIERUNG ;to 
	. set YPARA(80)="" ;WELCHE FELDER MARKIEREN ;who 
	. ;
	. ;----- Manual Option Class
	. if $data(^WWW1251(0,YFORM,YBBN)) do   ;SEKEKTIONEN SONDER
	. . set YXTYP = +$piece($get(^WWW1251(0,YFORM,YBBN,1,1)),Y,2)
	. . set YPARA(12) = 0               ;SORTIERUNG PARA ;sorting 
	. . set YPARA(1)  = "WWW1251"
	. . set YPARA(2)  = """"_YFORM_""","""_YBBN_""""
	. . set YPARA(3)  = 1
	. ;
	. set YSPAL = $piece(YSATZ,Y,4)   ;SPALTEN VORGABE ;split default 
	. if $piece(YFELD,Y,YLFN)'="" set YINHALT = $piece(YFELD,Y,YLFN)   ;FELDINHALT
	. if YTYP=9 if YINHALT=""     set YINHALT = "+"                        ;AUTOM LFN
	. if YLFN=1 if $order(^WWW003(0,YDATEI,YLFN))="" if $piece($get(^WWW003(0,YDATEI,YLFN,1)),Y,3)=3 set YINHALT = $piece(YFELD,Y,YLFN,9999)  ;TEXT
	. ;-------------------------------------
	. ;  D15	WWW122	Default Variable Input
	. ;  
	. ;  @string, @$string, @#string   See explanation above under WWW121
	. ;-------------------------------------
	. if YBEARB=1 if YINHALT="" do
	. . set YINHALT = $piece(YSATZ,Y,15)
	. . if (YTYP=1) || (YTYP=7) if $extract(YINHALT)'="@" set YINHALT=$$GetInternal^WWWTR(YTYP,YINHALT)  ;DATUM/UHRZEITVORGABE
	. . if $extract(YINHALT)="@" do
	. . . if $extract(YINHALT,2)'="$" if $extract(YINHALT,2)'="#" set YINHALT=$get(@($extract($piece(YSATZ,Y,15),2,99))) quit
	. . . new YINHALT1
	. . . set YINHALT1="S YINHALT="_$extract($piece(YSATZ,Y,15),2,99) 
	. . . xecute YINHALT1
	. . . if (YTYP=1) || (YTYP=7) set YINHALT=$$GetInternal^WWWTR(YTYP,YINHALT)  ;DATUM/UHRZEITVORGABE
	. ;
	. ;-------------------------------------  *** EXECUTE ***
	. ;  D26 : ExecuteOnLoad (D)
	. ;-------------------------------------
	. if $piece(YSATZ,Y,26)'="" xecute $piece(YSATZ,Y,26)  ;EXECUTE BEI ONLOAD (YINHALT) ;EXECUTE next to 
	. if $$EXIST^%R("Y"_YFORM_YART_YLFN_"onLoad.OBJ",$get(YUCI)) xecute "DO ^Y"_YFORM_YART_YLFN_"onLoad"  ;CUSTOMIZED EXECUTE;FIS;24947;10.01.04
	. ;
	. ;
	. if $get(YOLDVAL)="" set YOLDVAL=""  ;WERT NEBEN FELD ;value next to field 
	. ;I YBEARB'=1 I YINHALT="" D
	. ;. SET YOLDVAL=$PIECE(YSATZ,Y,15)
	. ;. IF (YTYP=1) || (YTYP=7) SET YOLDVAL=$$GetInternal^WWWTR(YTYP,YOLDVAL)  ;DATUM/UHRZEITVORGABE
	. ;. IF $EXTRACT(YOLDVAL)="@" IF $EXTRACT(YOLDVAL,2)'="$" SET YOLDVAL=$GET(@($EXTRACT($PIECE(YSATZ,Y,15),2,99)))
	. ;
	. ;IF $$^WWWACCESS($PIECE(YSATZ,Y,22),$PIECE(YSATZ,Y,24))'=1 SET YHIDDSE=1 SET YHID=2  ;KEINE BERECHTIGUNG
	. if $$^WWWACCESS($piece(YDVOR,Y,14),"")'=1 set YHID=2  ;KEINE BERECHTIGUNG (DATEI) ;no 
	. ;
	. if YKEY="" if YINHALT="" if $piece(YDVOR,Y,17)=$$$YES set YINHALT = $piece($get(^WWWDLF(0,YDATEI,YLFN,YBED,1)),Y,1)  ;VORGABE ;handicap  ;default 
	. ;
	. ;-----
	. if $$$WWW120AuthorizationToModifyData(YSATZ)=$$$EnumReadOnly          set YHID=2   ;FELDBERECHITIGUNG
	. if YBEARB'=1 if YBEARB'=6   if $piece(YSATZ,Y,23)=$$$EnumCreateOnly   set YHID=2   ;FELDBERECHITIGUNG 
	. if (YBEARB=1) || (YBEARB=6) if $piece(YSATZ,Y,23)=$$$EnumModifyOnly   set YHID=2   ;FELDBERECHITIGUNG 
	. if $$$WWW120AuthorizationToModifyData(YVOR)=$$$EnumReadOnly           set YHID=2   ;FELDBERECHTIGUNNG
	. ;
	. if ($piece(YSATZ,Y,42)'="") || ($piece(YSATZ,Y,44)'="") if $$^WWWACCESS($piece(YSATZ,Y,42),$piece(YSATZ,Y,44))=1 do    ;KEINE FELDBERECHTIGUNG ;no 
	. . if $piece(YSATZ,Y,43)=$$$EnumReadOnly                               set YHID=2   ;FELDBERECHTIGUNNG
	. . if YBEARB'=1 if YBEARB'=6   if $piece(YSATZ,Y,43)=$$$EnumCreateOnly set YHID=2   ;FELDBERECHITIGUNG
	. . if (YBEARB=1) || (YBEARB=6) if $piece(YSATZ,Y,43)=$$$EnumModifyOnly set YHID=2   ;FELDBERECHITIGUNG  
	. . if +$piece(YSATZ,Y,43)<2                                            set YHID=0   ;FREIGABE
	. ;-----
	. ;
	. do IsInactive(YSATZ,YFELD,.YHID)	//SR13309 - moved into function
	. ;
	. ;----- JavaScript Class
	. if $data(^WWW1291(0,YFORM,YBBN)) set YJAVA=1   ;JAVASCRIPT VORHANDEN ;on hand 
	. ;
	. ;----- Embedded Objects
	. for YI=53:1:56 if +$piece(YSATZ,Y,YI)'=0 set YO(YI)=$piece(YSATZ,Y,YI)  ;VORGABEN FÜR OBJEKTANZEIGE ;to 
	. ;
	. ;----- Mandatory / Unique Key    ; FIXME : D22 $$$WWW003UniqueKey() is deprecated <GRF>
	. if ($piece(YSATZ,Y,13)=$$$YES) || ($piece(YDVOR,Y,22)=$$$YES) if YPFLICHT'=0 set YPFLICHT=1 if $piece(YSATZ,Y,10)="" set $piece(YSATZ,Y,10) = $piece(YVOR,Y,63)
	. ;
	. ;----- Input In Variable
	. if YINHALT'="" set $piece(YFELD,Y,YLFN)=YINHALT
	. if $piece(YSATZ,Y,21)'="" if +$piece(YSATZ,Y,21)=0 set @($piece(YSATZ,Y,21))=YINHALT
	. ;
	. if (YOPEN'=2) do
	. . set $piece(^WWWDATEN(YM,+$horolog,YUSER,YFORM,"D",1),Y,YLFN)=YINHALT
	. . set $piece(^WWWDATEN(YM,+$horolog,YUSER,YFORM,"D",2),Y,YLFN)=YINHALT
	. ;
	. do Start^WWWFORM7(YHIDDSE=0)
	
	
	;-------------------------------------------------------------------------------
	;Manual Fields
	;-------------------------------------------------------------------------------
	if YART="M" do
	. new YYKEY
	. set YYKEY=$get(YKEY)
	. new YKEY
	. set YKEY=YYKEY
	. if YKEY="" set YKEY=$translate($get(%(YQUERY,"YKEY")),"|"," ")  ;WENN VARIABLE BENÖTIGT ;when 
	. quit:YSATZ=""
	. set YTYP=$piece(YSATZ,Y,5)
	. if YTYP="" set YTYP=6
	. set YXTYP=+$piece(YSATZ,Y,2)
	. if YXTYP=15 set YTYP=0         ;UNSICHTBAR ;viewless 
	. if $piece(YSATZ,Y,16)'="" do   ;FESTE VORGABE ;default 
	. . set YHID=1                   ;UNSICHTBAR ;viewless 
	. . set YINHALT=$piece(YSATZ,Y,16)
	. . if (YTYP=1) || (YTYP=7) set YINHALT=$$GetInternal^WWWTR(YTYP,YINHALT)  ;DATUM/UHRZEITVORGABE
	. . if $extract(YINHALT)="@" do
	. . . if $extract(YINHALT,2)'="$" if $extract(YINHALT,2)'="#" set YINHALT=$get(@($extract($piece(YSATZ,Y,16),2,99))) quit
	. . . new YINHALT1
	. . . set YINHALT1="S YINHALT="_$extract($piece(YSATZ,Y,16),2,99) 
	. . . xecute YINHALT1
	. ;
	. set YLANGE=$piece(YSATZ,Y,6)
	. ;
	. set YNAME=$piece(YSATZ,Y,12)
	. if $data(^WWW1221(0,YFORM,YBBN,SPRACHE,1)) set YNAME=$piece(^WWW1221(0,YFORM,YBBN,SPRACHE,1),Y,1) // SR14914
	. ;
	. ;-------------------------------------
	. ;  Relation Class
	. ;  	D29		$$$WWW122DisplayRelationsDownwards()
	. ;  	D31		$$$WWW122DisplayIfSortCodes()
	. ;  	D32		$$$WWW122RelationClass()
	. ;  	D33		$$$WWW122RelationalPrimaryKey()
	. ;  	D34		$$$WWW122RelationalDataField()
	. ;  	D35		$$$WWW122RelationDisplayOptions()
	. ;  	D62		$$$WWW122SortTheRelation()
	. ;  	D63		$$$WWW122RelationFieldSequence()
	. ;  v	D67		$$$WWW122RelationSendToField()
	. ;  	D79		$$$WWW122RelationalItemToMark()
	. ;-------------------------------------
	. set YPARA(12)=$piece(YSATZ,Y,62)
	. set YPARA(1)=$piece(YSATZ,Y,32)
	. set YPARA(2)=$piece(YSATZ,Y,33)
	. set YPARA(3)=$piece(YSATZ,Y,34)
	. set YPARA("CF") = $$$WWW122CalcRelationalDataField(YSATZ)  ;Calculated Display Fields			//SR16663
	. set YPARA(33)=$piece(YSATZ,Y,31)                   ;ZUGRIFF AUF SORTKEY ;upon 
	. if $piece(YSATZ,Y,63)'="" set YPARA(3)=$piece(YSATZ,Y,63)
	. set YPARA(20)=$piece(YSATZ,Y,35)                   ;später ;subsequent 
	. set YPARA(79)=$piece(YSATZ,Y,79)                   ;RELATIONSFELD FÜR MARKIERUNG ;to 
	. if $piece(YSATZ,Y,29)=1 set YPARA(29)=-1           ;RELATION ABSTEIGEND WENN =1  ;when 
	. ;
	. set YPARA(80)="" ;WELCHE FELDER MARKIEREN ;who 
	. ;
	. ;-------------------------------------
	. ; EMBEDED OBJECT
	. ;-------------------------------------
	. if $find(YNAME,".") do
	. . if $piece(YNAME,".",1)'="" if $piece(YNAME,".",2)'="" if $piece(YNAME,".",3)="" do
	. . . new YLFN,YLFNX,YDATEI1,YDATEI
	. . . set YDATEI=$piece($get(^WWW120(0,YFORM,1)),Y,11)
	. . . quit:YDATEI=""
	. . . set YLFNX=$order(^WWW003s(0,3,$$^WWWUMLAU(YDATEI,1),$$^WWWUMLAU($piece(YNAME,".",1),1),YDATEI,""))
	. . . if YLFNX'="" do
	. . . . set LFNX(1)=$get(^WWW003(0,YDATEI,YLFNX,1))
	. . . . set YDATEI1=$piece(LFNX(1),Y,26)
	. . . . quit:YDATEI1=""
	. . . . set YLFN=$order(^WWW003s(0,3,$$^WWWUMLAU(YDATEI1,1),$$^WWWUMLAU($piece(YNAME,".",2),1),YDATEI1,""))
	. . . . if YLFN'="" do
	. . . . . set YLFN(1)=$get(^WWW003(0,YDATEI1,YLFN,1))
	. . . . . quit:YLFN(1)=""
	. . . . . set YNAME=$piece(YLFN(1),Y,2)          ;TEXT EMBEDED OBJECT
	. . . . . set strLanguage=$$^WWWLANGU(YBED)      //SR14914
	. . . . . if $data(^WWW0031(0,YDATEI,YLFN,strLanguage,1)) set YNAME=$piece(^WWW0031(0,YDATEI,YLFN,strLanguage,1),Y,1) //SR14914
	. . . . . set YLANGE=$piece(YLFN(1),Y,4)         ;LENGTH EMBEDED OBJECT
	. . . . . set YTYP=$piece(YLFN(1),Y,3)           ;DATATYPE EMBEDED OBJECT
	. . . . . quit:YPARA(1)'=""                      ;SELECTED THRU FORMDEF
	. . . . . set YPARA(12) = $piece(YLFN(1),Y,7)    ;RELATION SORTIEREN ;assortment 
	. . . . . set YPARA(1)  = $piece(YLFN(1),Y,8)    ;RELATIONSDATEI  AUS DATEIDEV ;out of 
	. . . . . set YPARA(33) = $piece(YLFN(1),Y,21)   ;ZUGRIFF AUF SORTKEY ;upon 
	. . . . . set YPARA(2)  = $piece(YLFN(1),Y,9)    ;REL KEY
	. . . . . set YPARA(3)  = $piece(YLFN(1),Y,10)   ;REL FELD ;field 
	. . . . . set YPARA("CF") = $$$WWW003CalcRelationalDisplayItems(YLFN(1))  ;Calculated Display Fields			//SR16663
	. . . . . set YPARA(20) = $piece(YLFN(1),Y,20)   ;ERST SPÄTER ANZEIGEN ;only subsequent display 
	. ;
	. if $data(^WWW1251(0,YFORM,YBBN)) do   ;SEKEKTIONEN
	. . set YXTYP=+$piece($get(^WWW1251(0,YFORM,YBBN,1,1)),Y,2)
	. . ;SET YPARA(12)=0  ;SORTIERUNG PARA ;table-mat sorting 
	. . set YPARA(1)="WWW1251"
	. . set YPARA(2)=""""_YFORM_""","""_YBBN_""""
	. . set YPARA(3)=1
	. ;
	. set YPARA(67) = $piece(YSATZ,Y,67)  ;NEUES FELD AUS EVENT BROKER ;$$$WWW122RelationSendToField()
	. set YNAME0    = $piece(YSATZ,Y,27)
	. ;SET YNAME1    = $PIECE(YSATZ,Y,28) ;16679
	. set YNAME1=$$$Text($$$WWW122TextBehindUserInputField(YSATZ)) ;16679
	. set YSPAL     = $piece(YSATZ,Y,4)
	. if $piece(YSATZ,Y,15)'="" do
	. . set YINHALT=$piece(YSATZ,Y,15)
	. . if (YTYP=1) || (YTYP=7) if $extract(YINHALT)'="@" set YINHALT=$$GetInternal^WWWTR(YTYP,YINHALT)  ;DATUM/UHRZEITVORGABE
	. . if $extract(YINHALT)="@" do
	. . . if $extract(YINHALT,2)'="$" if $extr]]><![CDATA[act(YINHALT,2)'="#" set YINHALT=$]]><![CDATA[get(@($extract($piece(YSATZ,Y,15),2,99))) quit
	. . . new YINHALT1
	. . . set YINHALT1="S YINHALT="_$extract($piece(YSATZ,Y,15),2,99) 
	. . . xecute YINHALT1
	. . . if (YTYP=1) || (YTYP=7) set YINHALT=$$GetInternal^WWWTR(YTYP,YINHALT)  ;DATUM/UHRZEITVORGABE
	. ;
	. if $data(YMFELD) if YMFELD'="" set YINHALT=$piece(YMFELD,Y,YLFN)
	. ;
	. ;-------------------------------------  *** EXECUTE ***
	. ;  ExecuteOnLoad (M)
	. ;-------------------------------------
	. ;
	. if $piece(YSATZ,Y,26)'="" xecute $piece(YSATZ,Y,26)  ;EXECUTE BEI ONLOAD (YINHALT) ;EXECUTE next to 
	. if $$EXIST^%R("Y"_YFORM_YART_YLFN_"onLoad.OBJ",$get(YUCI)) xecute "DO ^Y"_YFORM_YART_YLFN_"onLoad"  ;CUSTOMIZED EXECUTE;FIS;24947;10.01.04
	. ;
	. ;IF $$^WWWACCESS($PIECE(YSATZ,Y,22),$PIECE(YSATZ,Y,24))'=1 S YHID=2    ;KEINE FELDBERECHTIGUNG MODUL
	. if ($$$WWW120AuthorizationToModifyData(YSATZ)=$$$EnumReadOnly)  set YHID=2
	. if ($$$WWW120AuthorizationToModifyData(YVOR) =$$$EnumReadOnly)  set YHID=2
	. if ($piece(YSATZ,Y,42)'="") || ($piece(YSATZ,Y,44)'="") if $$^WWWACCESS($piece(YSATZ,Y,42),$piece(YSATZ,Y,44))=1 do    ;FELDBERECHTIGUNG MODUL ;module 
	. . if $piece(YSATZ,Y,43)=5  set YHID=2   ;FELDBERECHTIGUNNG
	. . if +$piece(YSATZ,Y,43)=0 set YHID=0   ;FREIGABE
	. ;
	. do IsInactive(YSATZ,YFELD,.YHID)	//SR13309 - moved into function
	. ;
	. ;-------------------------------------  *** EXECUTE ***
	. ;  Execute : Set from Form Object when FormObj'=""
	. ;  D21		Input In Variable
	. ;  Must have object opened as XXXObj for form XXX (?)
	. ;  then property name is in D21
	. ;  FormObj possibly set in WWWXML
	. ;-------------------------------------
	. ;
	. if $piece(YSATZ,Y,21)'="" if +$piece(YSATZ,Y,21)=0 if $find($piece(YSATZ,Y,21),".") do
	. . new OBJ
	. . if $get(FormObj)'="" do
	. . . set OBJ="S YINHALT="_YFORM_"Obj."_$piece(YSATZ,Y,21)
	. . . xecute OBJ
	. ;
	. if $piece(YSATZ,Y,21)'="" if +$piece(YSATZ,Y,21)=0 if '$find($piece(YSATZ,Y,21),".") set @($piece(YSATZ,Y,21))=YINHALT
	. if $piece(YSATZ,Y,13)=1 if YPFLICHT'=0 set YPFLICHT=1 set $piece(YSATZ,Y,10)=$piece(YVOR,Y,63)
	. do  ;IF $PIECE(YVOR,Y,82)=1 DO
	. . set $piece(^WWWDATEN(YM,+$horolog,YUSER,YFORM,"M",1),Y,YLFN)=YINHALT  ;AUF BROWSER ;upon 
	. . set $piece(^WWWDATEN(YM,+$horolog,YUSER,YFORM,"M",2),Y,YLFN)=YINHALT  ;VORGABE   ;default 
	. ;
	. do Start^WWWFORM7(YHIDDSE=0)
	
	
	;-------------------------------------------------------------------------------
	; LISTENFELDER
	;-------------------------------------------------------------------------------
	if $extract(YART)="L" do
	. quit:YSATZ=""
	. set YDVOR=YSATZ
	. quit:YDVOR=""
	. ;
	. set YTYP=$piece(YDVOR,Y,3)
	. if YTYP=3 set YTYP=6
	. set YLANGE=$piece(YDVOR,Y,4)
	. ;-----
	. set YNAME=$piece(YDVOR,Y,2)
	. if $piece(YLISTLF,Y,3)=1 set YNAME = $$$Text($listbuild("53",$piece(YDVOR,Y,2)))  ; "From %1"  ;VON EINGABE  ;BR014923
	. if $piece(YLISTLF,Y,3)=3 set YNAME = $piece(YDVOR,Y,2) set YXTYP=6
	. ;-----
	. set YPARA(12) = $piece(YDVOR,Y,7)   ;SORTIERUNG PARA ;sorting 
	. set YPARA(1)  = $piece(YDVOR,Y,8)   ;DATEI RELATION ;data file 
	. set YPARA(2)  = $piece(YDVOR,Y,9)
	. set YPARA(3)  = $piece(YDVOR,Y,10)
	. set YPARA("CF") = $$$WWW003CalcRelationalDisplayItems(YDVOR)  ;Calculated Display Fields			//SR16663
	. set YPARA(20) = $piece(YDVOR,Y,20)  ;SPÄTER ANZEIGEN ;subsequent display 
	. if $piece(YLISTLF,Y,22)'="" do
	. . set YPARA(12) = $piece(YLISTLF,Y,30)
	. . set YPARA(1)  = $piece(YLISTLF,Y,22)
	. . set YPARA(2)  = $piece(YLISTLF,Y,23)
	. . set YPARA(3)  = $piece(YLISTLF,Y,24)
	. . if (YXTYP'=6) && (YXTYP'=20) set YXTYP=4
	. ;
	. set YPARA(67)=""
	. set YSPAL=1
	. set YINHALT=$piece(YLISTLF,Y,13)
	. do ^WWWFORM7      ; FIXME : Start^WWWFORM7($$$NO)
	. if $piece(YLISTLF,Y,3)'=1 write YCR,"</TD><TD>&nbsp;</TD><TD>&nbsp;" quit       ;KEIN VON-BIS
	. do THUMP
	. set YNAME     = $$$Text($listbuild("54",$piece(YDVOR,Y,2)))  ; "To %1"   ;BIS ABFRABE FELD ;until field  ;BR014923
	. set YPARA(12)   = 0                   ;SORTIERUNG PARA ;sorting 
	. set YPARA(1)    = $piece(YDVOR,Y,8)
	. set YPARA(2)    = $piece(YDVOR,Y,9)
	. set YPARA(3)    = $piece(YDVOR,Y,10)
	. set YPARA("CF") = $$$WWW003CalcRelationalDisplayItems(YDVOR)  ;Calculated Display Fields			//SR16663
	. set YPARA(20)   = $piece(YDVOR,Y,20)  ;SPÄTER ANZEIGEN ;subsequent display 
	. if $piece(YLISTLF,Y,22)'="" do
	. . set YPARA(12) = $piece(YLISTLF,Y,30)
	. . set YPARA(1)  = $piece(YLISTLF,Y,22)
	. . set YPARA(2)  = $piece(YLISTLF,Y,23)
	. . set YPARA(3)  = $piece(YLISTLF,Y,24)
	. . if (YXTYP'=6) && (YXTYP'=20) set YXTYP = 4
	. ;
	. set YPARA(67) = ""
	. set YSPAL     = 2
	. set YINHALT   = $piece(YLISTLF,Y,14)
	. set YART      = YART_"1"
	. do ^WWWFORM7      ; FIXME : Start^WWWFORM7($$$NO)
	
	;-------------------------------------------------------------------------------
	;OPTIONSFELDER
	;-------------------------------------------------------------------------------
	if YART="O" {
		set YTYP      = 6
		set YXTYP     = +$piece($get(^WWW1210(0,YFORM,1,1)),Y,2)
		set YLANGE    = 10
		set YNAME     = $$^WWWTEXT(202)_"  :"         ; "Options"
		set YPARA(12) = 0                             ;SORTIERUNG PARA ;sorting 
		set YPARA(1)  = "WWW1210"
		set YPARA(2)  = """"_YFORM_""""
		set YPARA(3)  = 1
		set YPARA(67) = ""
		set YSPAL     = 1
		set YINHALT   = 1
		do ^WWWFORM7      ; FIXME : Start^WWWFORM7($$$NO)
	}
	;-------------------------------------------------------------------------------
	quit:YHIDDSE=1     ;SEITE ;side 
	quit:$get(YTYP)=0  ;UNSICHTBAR ;viewless 
	;-------------------------------------------------------------------------------
	
	if YNAME1'="" do
	. new YI
	. write "<FONT SIZE="_$piece(YVOR,Y,7)_">"	;SR17887
	. for YI=1:1 set YI(1)=$piece(YNAME1,"|",YI) quit:YI(1)=""  do
	. . if YI'=1 write "<BR>"
	. . write $$^WWWUML(YI(1))_"&nbsp;"
	. write "</FONT>"	;SR17887
	
	// SR?????: Reorder these so that extra buttons go after the standard buttons
	do THUMP      ;BILDER NACH DER EINGABEE ;imagery within the 
	do BUTTON     ;BUTTONS NACH DER EINGABE ;within the 
	
	if +$get(YSCREENM)=1 if (YFOART=1) || (YFOART=4) || (YFOART=5) do ^WWWSCRM   ;SCREEN MOVEMENT
	if +$get(YSCREENM)=3 if (YFOART=1) || (YFOART=4) || (YFOART=5) do ^WWWSCRMD  ;CUSTOMIZING SCREEN MOVEMENT;FIS;10.03.04;25301
	
	;-------------------------------------------------------------------------------
	;    BEENDEN FORMATIERUNG DES FELDES ;formatting 
	;-------------------------------------------------------------------------------
	kill ^WWWSOR(YUSER,2)
	if (YART="P") || (YART="D") || (YART="M") if +$piece(YSATZ,Y,10)=0 do
	. quit:+$piece(YVOR,Y,8)=0
	. if $find($piece(YVOR,Y,8),1) write "</STRONG></B>"
	. if $find($piece(YVOR,Y,8),2) write "</U>"
	. if $find($piece(YVOR,Y,8),3) write "</I>"
	. if $find($piece(YVOR,Y,8),4) write "</STRIKE>"
	. if $find($piece(YVOR,Y,8),5) write "</BLINK>"
	. if $find($piece(YVOR,Y,8),6) write "</MARQUEE>"
	
	if (YART="P") || (YART="D") || (YART="M") if (+$piece(YSATZ,Y,8)'=0) || (+$piece(YSATZ,Y,9)'=0) || (+$piece(YSATZ,Y,10)'=0) || (+$piece(YSATZ,Y,11)'=0) do
	. write "</FONT>"
	. if $find($piece(YSATZ,Y,10),1) write "</STRONG></B>"
	. if $find($piece(YSATZ,Y,10),2) write "</U>"
	. if $find($piece(YSATZ,Y,10),3) write "</I>"
	. if $find($piece(YSATZ,Y,10),4) write "</STRIKE>"
	. if $find($piece(YSATZ,Y,10),5) write "</BLINK>"
	. if $find($piece(YSATZ,Y,10),6) write "</MARQUEE>"
	
	if YART="P" if $piece($get(YVOR1),Y,95)=1 write YCR,"</STRONG></B>"
	write YCR,"</TD>",YCR
	
	quit
	
	
IsInactive(YSATZ,YFELD,&YHID)
	;-------------------------------------------------------------------------------
	; Looks at "Field Is Inactive, If Data Field" and "Has The Following Entry" 
	; fields to decide whether inactive.
	; 
	; strTestValue can have the following formats
	; 	 A       or   A;B;C		Inactive if the field contains the value or one of
	; 							the semicolon delimited values (string compare)
	; 		
	; 	'A       or '=A         Inactive if the field does not contain any of
	; 	'A;B;C   or '=A;B;C		the nominated values (string compare)
	; 							
	; 	<nnn		'<nnn		Inactive if the field evaluates to being
	; 	>nnn		'>nnn		(not) less/greater than the numerical value
	; 	
	; Called By : Enabled^COMGridEdit31G, ^WWWFORM9, ReadOnly^WWWFORMD
	; 
	; Params: 
	; 	YSATZ
	; 	YFELD
	; 	YHID
	;
	; Returns: YHID - by Ref
	;
	; History:
	; 10-Aug-2010	PPP		SR17296: reverted code to original
	; 05-Aug-2010	GRF		SR17296: use macros; add & to parameter; doco
	; 16-Sep-2005	JW		SR13309: Created (moved code into function)
	; 						Fixed 3 lines of code that should've looked at first TWO chars.
	;-------------------------------------------------------------------------------
	new idTestField,strContents,strPrefix,strRest,strSearchVal,strTestValue
	
	/*
	set idTestField = $$$WWW122FieldIsInactiveIfDataFiel(YSATZ)     ; D86
	
	if (idTestField'="") {
		set strTestValue = $$$WWW122HasTheFollowingEntry(YSATZ)     ; D87
		set strContents  = $piece(YFELD,Y,idTestField)
		set strSearchVal = $$$COMMA_strContents_$$$COMMA
		
		set strPrefix = $extract(strTestValue,1,2)
		set strRest   = $extract(strTestValue,3,99)
		
		if strPrefix = "'=" {
			if '$find($$$COMMA_$translate(strRest,$$$SEMICOLON,$$$COMMA)_$$$COMMA,strSearchVal) set YHID = 2
			
		} elseif strPrefix = "'<" {
			if strContents '< strRest set YHID = 2
			
		} elseif strPrefix = "'>" {
			if strContents '> strRest set YHID = 2
			
		} else {
			set strPrefix = $extract(strTestValue)
			set strRest   = $extract(strTestValue,2,99)
			
			if strPrefix = "'" {
				if '$find($$$COMMA_$translate(strRest,$$$SEMICOLON,$$$COMMA)_$$$COMMA,strSearchVal) set YHID = 2
				
			} elseif strPrefix = "<" {
				if strContents < strRest set YHID = 2
				
			} elseif strPrefix = ">" {
				if strContents > strRest set YHID = 2
				
			} else {
				if $find($$$COMMA_$translate(strRest,$$$SEMICOLON,$$$COMMA)_$$$COMMA,strSearchVal) set YHID = 2
				
			}
			
		}
	}
	quit
	*/

	if $piece(YSATZ,Y,86)'="" do
	. if $extract($piece(YSATZ,Y,87))="'"      if '$find(","_$translate($extract($piece(YSATZ,Y,87),2,99),";",",")_",",","_$piece(YFELD,Y,$piece(YSATZ,Y,86))_",") set YHID=2 quit
	. if $extract($piece(YSATZ,Y,87),1,2)="'=" if '$find(","_$translate($extract($piece(YSATZ,Y,87),3,99),";",",")_",",","_$piece(YFELD,Y,$piece(YSATZ,Y,86))_",") set YHID=2 quit		//SR13309
	. if $extract($piece(YSATZ,Y,87))="<"      if $piece(YFELD,Y,$piece(YSATZ,Y,86))<$extract($piece(YSATZ,Y,87),2,99)  set YHID=2 quit
	. if $extract($piece(YSATZ,Y,87))=">"      if $piece(YFELD,Y,$piece(YSATZ,Y,86))>$extract($piece(YSATZ,Y,87),2,99)  set YHID=2 quit
	. if $extract($piece(YSATZ,Y,87),1,2)="'<" if $piece(YFELD,Y,$piece(YSATZ,Y,86))'<$extract($piece(YSATZ,Y,87),3,99) set YHID=2 quit		//SR13309
	. if $extract($piece(YSATZ,Y,87),1,2)="'>" if $piece(YFELD,Y,$piece(YSATZ,Y,86))'>$extract($piece(YSATZ,Y,87),3,99) set YHID=2 quit		//SR13309
	. if $find(","_$translate($piece(YSATZ,Y,87),";",",")_",",","_$piece(YFELD,Y,$piece(YSATZ,Y,86))_",")               set YHID=2
	
	quit
	
	
THUMP
    ;-------------------------------------------------------------------------------
    ; Display images and other objects
    ;
    ; History:
    ; 05-Nov-2012	shobby	SR18187:	Allow configuration to hide buttons on disabled fields.
    ; 01-Aug-2012	shobby	SR18076: IsImageType includes many more image types.
    ; 06-Jun-2007	shobby	SRBR014409: Subroutined code to create the date button in to CreateDateButton
    ; 07-May-2007	GRF		SRBR014310: Missing line restored; doco; quits
    ; 02-Apr-2007	JW		SR15384: Removed extra JS for currency fields
    ; 17-Jan-2007	Steve S	SR15355: Give Calender buttons an id
    ; 24-Oct-2006	Steve S	SR14915: Encapsulate code which draws memo buttons
    ; 17-Oct-2006	Steve S	SR15124: Disable date buttons if field is readonly.
    ; 12-Oct-2006	RPW		SR14914: use the new COMEditor form.
    ; 02-Jun-2006	SC		SRBR014011: Increased size of Calendar Dialog box to 
    ; 						allow for larger text buttons.
    ; 11-May-2006	JW		SR14508: Remove date img if YHID=2
    ; 12-Dec-2005	JW		SR13195: Rewrote memo field. Don't call BEARB.
    ; 31-Oct-2005	JW		SR12918: Improved file identification
    ;-------------------------------------------------------------------------------
 	
 	;+++++++++++++++++++++++++++++++++++++++  ???
	; YSATZ - WWW122
	; YVOR  - WWW120
 	;+++++++++++++++++++++++++++++++++++++++
	
	new objCompany,strExtension
	new idEditor,objEditor,idSkin,idToolbar,intMaxCharacter,blnUseStandard,strAction,objData,strURL
	
	set objCompany = $get(^WWW012(0,YM,1))
	
	set strExtension=""
	if $find(YINHALT,".") {
		set strExtension = $$$LOWER($piece(YINHALT,".",$length(YINHALT,".")))
	}
	
	;IF YTYP'=1 QUIT:$GET(YHID)=2  ;HIDDEN READ ONLY WENN NICHT DATUM
	
	if $get(YOLDVAL)'="" do  ;ALTEN WERT ODER VORGABE ANZEIGEN ;worthy Or default display 
	. write YCR
	. ;WRITE "<A HREF=""JavaScript:document."_YHTMFORM_".Y"_YFORM_YART_YLFN_".value='"_YOLDVAL_"'; document.WWW.focus();"">"   
	. write "<A onClick='return doLink(this)' HREF=""JavaScript:document."_YHTMFORM_".Y"_YFORM_YART_YLFN_".value='"_YOLDVAL_"';document."_YHTMFORM_".Y"_YFORM_YART_YLFN_".focus(); document.WWW.focus();"">"   ;TYBD; WEGEN FOCUS IM FELD;14,12,2003
	. write YCR,"<IMG SRC="""_YGIF_"dflt.gif"" ALIGN=ABSBOTTOM TITLE="""_$$^WWWTEXT(136)_" ("_YOLDVAL_")"" border=0>"
	. write "</A>"
	
	;------------------------------------------------------------------------
	new YWIDTH1,YHEIHT1,YBORDER,YI,YINHALT1,idChild
	
	if $piece(YSATZ,Y,94)'=1 if YTYP'=1 if YTYP'=17 if YTYP'=3 quit:YINHALT=""
	if $length(YINHALT)>5 for  quit:$length(YINHALT)<5  quit:$extract($reverse(YINHALT))'=" "  set YINHALT=$reverse($extract($reverse(YINHALT),2,99))  ;LEERSTELLEN FILTERN 
	if YTYP'=3 quit:$find(YINHALT,"|")
	;IF YTYP'=3 IF YTYP'=1 QUIT:$FIND(YINHALT," ")
	if YTYP'=3 if YTYP'=1 if $extract(YINHALT)'="+" quit:$find(YINHALT," ")    ;BEC;11.03.05;27475;WEGEN CALLTO BEFEHL MIT " "
	set YWIDTH1=100
	set YHEIHT1=100
	set YBORDER=1
	for YI=53:1:56 if '$data(YO(YI)) set YO(YI)=""
	if YO(53)=1 quit  ;KEIN OBJEKT ;no thing 
	if (+YO(54)'=0) || (+YO(55)'=0) {
		set YWIDTH1=YO(54)
		set YHEIHT1=YO(55)
	}
	
	if +YO(56)'=0 set YBORDER=0
	
	;------------------------------------------------------------------------
	if YART="D" if +$$$WWW122AbsPositionFromAbove(YSATZ)'=0 do   ;ABSOLUTE POSITIONIERUNG Anfang ;outset 
	. write YCR,"<div"
	. write " id=""objY"_YFORM_YART_YLFN_""""
	. write YCR," style=""border:none; background-color=#FFFFFF; position:absolute;"
	. write " top:"_+$$$WWW122AbsPositionFromAbove(YSATZ)_"px;"
	. if $$$WWW120PositioningOfButtonLine(YVOR)'=2 write " left:"_+$$$WWW122AbsPositionFromLeft(YSATZ)_"px;"
	. if $$$WWW120PositioningOfButtonLine(YVOR)=2  write " left:"_($$$WWW122AbsPositionFromLeft(YSATZ)+120)_"px;"
	. write " width:"_YWIDTH1_"px;"">"
	
	;---------------------------------------
	; OTHER OBJECTS
	;---------------------------------------
	if YTYP'=3 if YO(60)="" do  ;BILD UND VIDEO ;portrait And video 
	. new YINHALT0,URL
	. set YINHALT0=$translate(YINHALT,",",";")
	. for YI=1:1 quit:$piece(YINHALT0,";",YI)=""  set YINHALT1=$piece(YINHALT0,";",YI) do
	. . //IF $FIND(YINHALT1,".GIF")!($FIND(YINHALT1,".gif"))!($FIND(YINHALT1,".JPG"))!($FIND(YINHALT1,".jpg")) DO  QUIT
	. . if '$find(YINHALT1,".") quit
	. . ;SR18076 new strExtension
	. . ;SR18076 set strExtension = $$$LOWER($piece(YINHALT1,".",$length(YINHALT1,".")))	//SR12918
	. . ;SR18076 if (strExtension="gif")||(strExtension="jpg") do  quit
	. . if $$IsImageType($piece(YINHALT1,".",$length(YINHALT1,"."))) do  quit
	. . . if '$find(YINHALT1,"/") if '$find(YINHALT1,"\") do   ;SPEICHERORT
	. . . . if $piece(YSATZ,Y,57)'="" if YART="D"!(YART="M") do  quit
	. . . . . new PATH
	. . . . . set PATH=$$$WWW122ListOfObjects(YSATZ)
	. . . . . if PATH="YGIF" set YINHALT1=YGIF_YINHALT quit
	. . . . . if PATH="YGIF1" set YINHALT1=YGIF1_YINHALT quit
	. . . . . if $find(PATH,"##") do
	. . . . . . set PATH=$piece(PATH,"##",1)_$piece($translate($piece(objCompany,Y,1),"-,+#/\()[]")," ",1)_$piece(PATH,"##",2)
	. . . . . ;
	. . . . . set YINHALT1=PATH_YINHALT1
	. . . . ; 
	. . . . set:$extract(YFORM,1,3)'="WWW" YINHALT1=YGIF1_YINHALT1
	. . . . set:$extract(YFORM,1,3)="WWW" YINHALT1=YGIF_YINHALT1
	. . . ;
	. . . if $find(YINHALT1,"\") do   ;WENN GLEICHES VERZEICHNIS ABER MIT \ ;when same tabulation yet by means of 
	. . . . set YINHALT1=$tr]]><![CDATA[anslate(YINHALT1,"\","/")
	. . . . if $find($$$LOWER(YINHALT1),$$$LOWER(YGIF)) set YINHALT1=YGIF_$piece($$$LOWER(YINHALT1),$$$LOWER(YGIF),2,999) quit
	. . . . if $find($$$LOWER(YINHALT1),$$$LOWER(YGIF1)) set YINHALT1=YGIF1_$piece($$$LOWER(YINHALT1),$$$LOWER(YGIF1),2,999) quit
	. . . ;
	. . . set URL = $translate(YINHALT1,"|")	// SR12918
	. . . ;
	. . . if +$piece(YSATZ,Y,58)=0 write "&nbsp;"
	. . . ;IF YWIDTH1'=999 W YCR,"<iframe WIDTH="_YWIDTH1_" HEIGHT="_YHEIHT1_" SRC="""_$TR(YINHALT1,"|")_""" BORDER="_YBORDER_" title="""_$P(YINHALT1,".",1)_"""></iframe>"
	. . . if +YWIDTH1'=0 if YWIDTH1'=999 write YCR,"<IMG SRC="""_URL_""" BORDER="_YBORDER_" WIDTH="_YWIDTH1_" VALIGN=TOP ALIGN=TEXTTOP TITLE="""_$piece(YINHALT1,".",1)_""">"
	. . . if +YWIDTH1=0 if YHEIHT1'=0 if YWIDTH1'=999 write YCR,"<IMG SRC="""_URL_""" BORDER="_YBORDER_" HEIGHT="_YHEIHT1_" VALIGN=TOP ALIGN=TEXTTOP TITLE="""_$piece(YINHALT1,".",1)_""">"
	. . . if YWIDTH1=999 write YCR,"<BR><A HREF=""#start""><IMG SRC="""_URL_""" BORDER="_YBORDER_" VALIGN=TOP ALIGN=TEXTTOP TITLE="""_$piece(YINHALT1,".",1)_""" USEMAP=""#WWW_MAP"" ISMAP><MAP NAME=""WWW_MAP"">" write "</MAP></A>"
	. . . do  ;MIT VERGRÖßERUNG DES BILDES ;by means of enlargement 
	. . . . //NEW URL
	. . . . write YCR
	. . . . //SET YURL=$$$WWW012VirtualWWWDirectory(objCompany)
	. . . . set OPT="HEIGHT=300,WIDTH=300,SCROLLBARS=YES,RESIZEABLE=YES"
	. . . . //SET URL=""_YURL_$TRANSLATE(YINHALT1,"|")
	. . . . write "<INPUT TYPE=BUTTON NAME='B"_$get(YKEY)_"' onClick='var menue=window.open("""_URL_""",""DOK"","""_OPT_""");menue.focus();' VALUE='"
	. . . . write "'>"
	. . ; 
	. . if (strExtension="avi") do  quit		//SR12918
	. . . if '$find(YINHALT1,"/") if '$find(YINHALT1,"\") do   ;SPEICHERORT
	. . . . if $piece(YSATZ,Y,57)'="" if (YART="D") || (YART="M") do  quit
	. . . . . new PATH
	. . . . . set PATH=$piece(YSATZ,Y,57)
	. . . . . if PATH="YGIF"  set YINHALT1=YGIF_YINHALT  quit
	. . . . . if PATH="YGIF1" set YINHALT1=YGIF1_YINHALT quit
	. . . . . if $find(PATH,"##") do
	. . . . . . set PATH=$piece(PATH,"##",1)_$piece($translate($piece(objCompany,Y,1),"-,+#/\()[]")," ",1)_$piece(PATH,"##",2)
	. . . . . ;
	. . . . . set YINHALT1=PATH_YINHALT1
	. . . . ; 
	. . . . set:$extract(YFORM,1,3)'="WWW" YINHALT1=YGIF1_YINHALT1
	. . . . set:$extract(YFORM,1,3)="WWW" YINHALT1=YGIF_YINHALT1
	. . . ;
	. . . if $find(YINHALT1,"\") do   ;WENN GLEICHES VERZEICHNIS ABER MIT \ ;when same tabulation yet by means of 
	. . . . set YINHALT1=$translate(YINHALT1,"\","/")
	. . . . if $find($$$LOWER(YINHALT1),$$$LOWER(YGIF))  set YINHALT1=YGIF_$piece($$$LOWER(YINHALT1),$$$LOWER(YGIF),2,999)   quit
	. . . . if $find($$$LOWER(YINHALT1),$$$LOWER(YGIF1)) set YINHALT1=YGIF1_$piece($$$LOWER(YINHALT1),$$$LOWER(YGIF1),2,999) quit
	. . . ;
	. . . write YCR ;W "&nbsp;"
	. . . write "<CENTER><IMG DYNSRC="""_YINHALT1_""" BORDER="_YBORDER_" START=mouseover></CENTER>"
	
	;---------------------------------------
	; Show Pictures      ; BILDER ;GIF ANZEIGE
	;---------------------------------------
	if YTYP'=3 if YO(60)'="" do 
	. ;SR18076 if (strExtension="gif")||(strExtension="jpg") do  quit		//SR12918
	. if $$IsImageType(strExtension) do  quit
	. . if '$find(YINHALT,"/") do 
	. . . if $piece(YSATZ,Y,57)'="" if (YART="D") || (YART="M") do  quit
	. . . . new PATH
	. . . . set PATH=$piece(YSATZ,Y,57)
	. . . . if PATH="YGIF"  set YINHALT1=YGIF_YINHALT  quit
	. . . . if PATH="YGIF1" set YINHALT1=YGIF1_YINHALT quit
	. . . . if $find(PATH,"##") do
	. . . . . set PATH=$piece(PATH,"##",1)_$piece($translate($piece(objCompany,Y,1),"-,+#/\()[]")," ",1)_$piece(PATH,"##",2)
	. . . . ;
	. . . . set YINHALT1=PATH_YINHALT1
	. . . ; 
	. . . set:$extract(YFORM,1,3)'="WWW" YINHALT=YGIF1_YINHALT
	. . . set:$extract(YFORM,1,3)="WWW" YINHALT=YGIF_YINHALT
	. . ;    
	. . if $find(YINHALT,"\") do   ;WENN GLEICHES VERZEICHNIS ABER MIT \ ;when same tabulation yet by means of 
	. . . set YINHALT=$translate(YINHALT,"\","/")
	. . . if $find($$$LOWER(YINHALT),$$$LOWER(YGIF))  set YINHALT=YGIF_$piece($$$LOWER(YINHALT),$$$LOWER(YGIF),2,999)   quit
	. . . if $find($$$LOWER(YINHALT),$$$LOWER(YGIF1)) set YINHALT=YGIF1_$piece($$$LOWER(YINHALT),$$$LOWER(YGIF1),2,999) quit
	. . ;
	. . if +$piece(YSATZ,Y,58)=0 write "&nbsp;"
	. . write YCR
	. . set OPT="HEIGHT=300,WIDTH=300,SCROLLBARS=YES,RESIZEABLE=YES"
	. . write "<INPUT TYPE=BUTTON NAME='B"_YKEY_"' onClick='var menue=window.open("""_YINHALT_""",""DOK"","""_OPT_""");menue.focus();' VALUE='"
	. . write "'>"
	
	if YART="D" if +$piece(YSATZ,Y,58)'=0 write YCR,"</div>"  ;ENDE POSITION ;termination 
	
	;---------------------------------------
	; Show PDF   ;PDF ANZEIGE
	;---------------------------------------
	if YTYP'=3 do
	. if strExtension'="pdf" quit				//SR12918
	. do
	. . if '$find(YINHALT,"/") do 
	. . . if $piece(YSATZ,Y,57)'="" if (YART="D") || (YART="M") do  quit
	. . . . new PATH
	. . . . set PATH=$piece(YSATZ,Y,57)
	. . . . if PATH="YGIF"  set YINHALT1=YGIF_YINHALT  quit
	. . . . if PATH="YGIF1" set YINHALT1=YGIF1_YINHALT quit
	. . . . if $find(PATH,"##") do
	. . . . . set PATH=$piece(PATH,"##",1)_$piece($translate($piece(objCompany,Y,1),"-,+#/\()[]")," ",1)_$piece(PATH,"##",2)
	. . . . ;
	. . . . set YINHALT1=PATH_YINHALT1
	. . . ;
	. . . set:$extract(YFORM,1,3)'="WWW" YINHALT=YGIF1_YINHALT
	. . . set:$extract(YFORM,1,3)="WWW" YINHALT=YGIF_YINHALT
	. . ;   
	. . if $find(YINHALT,"\") do   ;WENN GLEICHES VERZEICHNIS ABER MIT \ ;when same tabulation yet by means of 
	. . . set YINHALT=$translate(YINHALT,"\","/")
	. . . if $find($$$LOWER(YINHALT),$$$LOWER(YGIF))  set YINHALT=YGIF_$piece($$$LOWER(YINHALT),$$$LOWER(YGIF),2,999)   quit
	. . . if $find($$$LOWER(YINHALT),$$$LOWER(YGIF1)) set YINHALT=YGIF1_$piece($$$LOWER(YINHALT),$$$LOWER(YGIF1),2,999) quit
	. . ;
	. . if +$piece(YSATZ,Y,58)=0 write "&nbsp;"
	. . write YCR
	. . write "<A HREF=""" ;_"http://"
	. . write YINHALT
	. . write """ TARGET=WWWWW>"
	. . write YCR,"<IMG SRC="""_YGIF_"pdf.gif"" ALIGN=ABSBOTTOM TITLE=""Acrobat Reader"" border=0>"
	. . write "</A>"
	
	
	;---------------------------------------
	; Show DOC   ;DOC ANZEIGE
	;---------------------------------------
	if YTYP'=3 do
	. if strExtension'="doc" quit				//SR12918
	. do
	. . if '$find(YINHALT,"/") do 
	. . . if $piece(YSATZ,Y,57)'="" if (YART="D") || (YART="M") do  quit
	. . . . new PATH
	. . . . set PATH=$piece(YSATZ,Y,57)
	. . . . if PATH="YGIF"  set YINHALT1=YGIF_YINHALT  quit
	. . . . if PATH="YGIF1" set YINHALT1=YGIF1_YINHALT quit
	. . . . if $find(PATH,"##") do
	. . . . . set PATH=$piece(PATH,"##",1)_$piece($translate($piece(objCompany,Y,1),"-,+#/\()[]")," ",1)_$piece(PATH,"##",2)
	. . . . ;
	. . . . set YINHALT1=PATH_YINHALT1
	. . . ;
	. . . set:$extract(YFORM,1,3)'="WWW" YINHALT=YGIF1_YINHALT
	. . . set:$extract(YFORM,1,3)="WWW" YINHALT=YGIF_YINHALT
	. . ;
	. . ; Restore missing line based on other blocks    SRBR014310
	. . if $find(YINHALT,"\") do   ;WENN GLEICHES VERZEICHNIS ABER MIT \ ;when same tabulation yet by means of 
	. . . set YINHALT=$translate(YINHALT,"\","/")
	. . . if $find($$$LOWER(YINHALT),$$$LOWER(YGIF))  set YINHALT=YGIF_$piece($$$LOWER(YINHALT),$$$LOWER(YGIF),2,999)   quit
	. . . if $find($$$LOWER(YINHALT),$$$LOWER(YGIF1)) set YINHALT=YGIF1_$piece($$$LOWER(YINHALT),$$$LOWER(YGIF1),2,999) quit
	. . ;
	. . ;IF +$PIECE(YSATZ,Y,58)=0 WRITE "&nbsp;"
	. . write YCR
	. . //SET YURL=$PIECE(objCompany,Y,44)		//SR12918
	. . //SET URL=""_YURL_YINHALT
	. . write "<A HREF=""" ;_"http://"
	. . //WRITE URL
	. . write YINHALT
	. . write """ TARGET=WWWWW>"
	. . write YCR,"<IMG SRC="""_YGIF_"data.gif"" ALIGN=ABSBOTTOM TITLE=""Word"" border=0 id=""BUTTON_DOC"">"
	. . write "</A>"
	
	;---------------------------------------
	;MAILTO
	; FIXME : <GRF> check logic of tests - AND and OR mixed as separate tests
	;         Combine to clarify intended use.
	;         e.g. (w && x && y) || (z)  [as currently]   or   (w) && (x) && (y || z)
	;---------------------------------------
	if YTYP'=3 if ($extract(YINHALT)'="@") && ($find(YINHALT,"@")) && ('$find(YINHALT," ")) || ($get(YXTYP)=12) do  quit  ;E-MAIL
	. write YCR ;W "&nbsp;"
	. write "<A HREF=""mailto:"
	. write YINHALT
	. write """>"
	. write YCR,"<IMG SRC="""_YGIF_"mail.gif"" ALIGN=ABSBOTTOM TITLE=""E-Mail"" border=0 id=""BUTTON_MAIL"">"
	. write "</A>"
	
	;---------------------------------------
	; Telephone Call     ;TELEFON CALL
	;---------------------------------------
	;IF $EXTRACT(YINHALT)="+" IF +$EXTRACT(YINHALT,2,99)'=0 IF $LENGTH(+YINHALT)>6 IF $PIECE(objCompany,Y,92)=1 DO ;MIT TELEFONANWAHL =1 ;TYBD;6,12,2004
	if $extract(YINHALT)="+" if +$extract($translate(YINHALT," "),2,99)'=0 if $length(+$translate(YINHALT," "))>6 if $piece(objCompany,Y,92)=1 do ;MIT TELEFONANWAHL =1 ;bec;11,03,2005;27475 
	. new FILE
	. ;WRITE "&nbsp;"
	. write YCR,"<A HREF=""CALLTO://"_$translate(YINHALT,"()-.#*_  &/!?")_""">"
	. write YCR,"<IMG SRC="""_YGIF_"verbind.gif"" ALIGN=TEXTTOP TITLE=""Telefon"" border=0 id=""BUTTON_PHONE"">"
	. write "</A>"
	
	;---------------------------------------
	;WWW VERZEICHNIS ;WWW tabulation 
	;---------------------------------------
	;IF YTYP'=3 IF $GET(YXTYP)=13!($EXTRACT(YINHALT,1,4)="www.")!($EXTRACT(YINHALT,1,4)="WWW.") IF '$FIND(YINHALT,"@") IF '$FIND(YINHALT," ") IF $LENGTH(YINHALT,".")>2 DO  QUIT  ;WWW.XXX.COM
	if YTYP'=3 if ($get(YXTYP)=13) || ($extract(YINHALT,1,4)="www.") || ($extract(YINHALT,1,4)="WWW.") || ($extract(YINHALT,1,7)="http://") if '$find(YINHALT,"@") if '$find(YINHALT," ") if $length(YINHALT,".")>2 do  quit  ;WWW.XXX.COM  ;AUCH OHNE WWW;FIS;21.06.04
	. write YCR ;W "&nbsp;"
	. write "<A HREF="""
	. if $extract(YINHALT,1,7)'="http://" write "http://"
	. write YINHALT
	. write """ TARGET=WWWWW>"
	. write YCR,"<IMG SRC="""_YGIF_"www.gif"" ALIGN=ABSBOTTOM TITLE=""WWW"" border=0 id=""BUTTON_WWW"">"
	
	;---------------------------------------
	;ROUTENPLANER
	;---------------------------------------
	new strName
	
	if $length(YINHALT)=5 if +YINHALT'=0 set strName=$$$UPPER(YNAME) if $extract(strName,1,3)="PLZ"!($extract(strName,1,3)="ZIP") do  quit  ;PLZ ;ZIP 
	. write YCR
	. new URL
	. set URL = $$$WWW012URLForAutoRoute(objCompany)
	. quit:URL=""  ;KEIN EINTRAG IN MAP UND GUIDE;TYBD;14,5,2004
	. //SET YBTR=$ORDER(^WWW0121(0,YM,""))
	. //QUIT:YBTR=""
	. //SET YBTR1=$GET(^WWW0121(0,YM,YBTR,1))
	. ;WRITE "<A HREF=""http://"_$PIECE(objCompany,Y,96)_YINHALT      ;bec;03.06.04;25849;http abfangen
	. write "<A HREF="""
	. if $$$UPPER($extract(URL,0,7))'="HTTP://" write "http://"
	. write URL_YINHALT
	. ;WRITE "<A HREF=""http://map.ptv.de/emr/mapping.asp?ID=AV&LNG=D&UC=&CF=0&SC=D&RAD=400&SIZX=400&SIZY=400&RECT=1303039&BUTTON=CLICK&NX=1303439&NY=6479243&SX=1303039&SY=6479243&MAP=S&SP="_YINHALT_"&SO=&SS="_$GET(STRASSE)
	. write """ TARGET=routenplaner>"
	. write YCR,"<IMG SRC="""_YGIF_"route.gif"" ALIGN=ABSBOTTOM TITLE=""Auto-Route"" border=0>"
	. write "</A>"
	
	if (YTYP=1)||(YTYP=17) do  quit  ;KALENDER ALS MODAL WINDOW ANZEIGEN ;calendar when display
	. if (YHID'=2)||('$$$WWW122HideButton(YSATZ)) do  ;SR18187
	. . do CreateDateButton() // SRBR014409
	
	;---------------------------------------
	;FREMDWÄHRUNG         ;FIS;25933;21.06.2004
	;---------------------------------------
	; SR:12256
	if YTYP=8 if $find($piece(YFELD,Y,YLFN),"@") if ($get(^CacheTemp(YUSER,YFORM,"Toggles","Currency"))'="Base")&&('$data(^CacheTemp(YUSER,YFORM,"Disable Coins"))) do  quit ; SR11349
	. ;IF YTYP=8 IF $FIND($PIECE(YFELD,Y,YLFN),"@") if '$data(^CacheTemp(YUSER,YFORM,"Toggles","Currency")) DO  QUIT ; SR11349
	. ;
	. quit:YHID=2
	. quit:YHID=1  ;NICHT WENN NUR HIDDEN ;Not when only 
	. ;W "&nbsp;"
	. write YCR
	. write YCR,"<A class=link"			//SR13195
	. set URL=YAKTION_"EP=WWWFORM&amp;YFORM=WWWWHRX&amp;YUSER="_YUSER_"&amp;YBED="_YBED_"&amp;YTRAKT="_YTRAKT_"&amp;YUCI="_$get(YUCI)_"&amp;YM="_YM_"&amp;YLFDAT=Y"_YFORM_YART_YLFN_"&amp;YLFFORM="_YFORM_"&amp;YHTMFORM1="_YHTMFORM_"&amp;YKEY="_YKEY
	. write YCR," onclick=""var result = window.showModalDialog('"_URL_"&YSEC='+ new Date().getSeconds(),'Calendar','DialogWidth: 600px; DialogHeight: 180px; resizable: no; status: no');"
	. write YCR,"if (result != null) {"
	. write YCR," retval = EventValue('"_YUCI_"','"_YUSER_"','"_YFORM_"','FIX','Y"_YFORM_YART_YLFN_"',result,'2','NOVALUE');"
	. ;
	. // SR15384 - No longer necessary with new WWWEVENT
	. //write YCR," if (retval!='') {"
	. //write YCR,"  document."_YHTMFORM_".Y"_YFORM_YART_YLFN_".value=retval;" ;used to be value
	. //write YCR," }"
	. ;
	. write YCR," window.setTimeout('document."_YHTMFORM_".Y"_YFORM_YART_YLFN_".focus()',10);"
	. write YCR," }"
	. write YCR,""">"
	. write YCR,"<IMG SRC="""_YGIF_"konditionen.gif"" ALIGN=ABSBOTTOM TITLE="""_$$^WWWTEXT(33910)_""" border=0 id=""BUTTON_CURR"">"
	. write "</A>"
	
	;---------------------------------------
	;TEXT		//SR13195 - rewrote
	;---------------------------------------
	if YTYP=3 {
		write $$MemoLink(YDATEI,YSATZ,YART,YKEY)
		
	} elseif (strExtension'="") && (strExtension'=+strExtension) && ##class(%File).Exists($$$WWW012PhysicalWWWDirectory(objCompany)_YINHALT) {			//SR12918
		write "&nbsp;"
		write "<EMBED SRC="""_YGIF_YINHALT_""" BORDER="_YBORDER_">"
	} 
	quit
	
IsImageType(pstrExtension)
	; 01-Aug-2012	shobby	SR18076: Include various additional types of image extensions.
	set pstrExtension=$$$LOWER(pstrExtension)
 	quit $listfind($listbuild("gif","jpg","png","bmp","dib","jpeg","jfif","tif","tiff"),pstrExtension)
	
CreateDateButtonNew()
	;-------------------------------------------------------------------------------
	; Create the button that pops up the date window.
	;
	; Params: 
	;
	; ByRefs:
	;
	; Returns: strLink
	;
	; History:
	; 05-Jul-2007	RPW		SRBR014409: Change str to lst for %List types
	; 25-Jun-2007	shobby	SRBR014409: Adjusted the image id
	; 11-Jun-2007	shobby	SRBR014409: Streamlined.  Put some common code in to
	; 						CreateOnClick to be shared with other types of buttons
	; 						when they are created.
	; 06-Jun-2007	shobby	SRBR014409: Created.  Subroutined out of THUMP.  Change
	; 						in functionality.  The button is now drawn as disabled
	; 						when related field is readonly rather than not being
	; 						drawn.  Made non-IE browser call conditional on related
	; 						field being not readOnly.
	;-------------------------------------------------------------------------------
	new lstJS1,lstJS2
	quit
	if (YHID'=1) {
		set URL=YAKTION_"EP=WWWFORM&amp;YFORM=WWWCAL2&amp;YUSER="_YUSER_"&amp;YBED="_YBED_"&amp;YUCI="_$get(YUCI)_"&amp;YM="_YM_"&amp;YLFDAT=Y"_YFORM_YART_YLFN
		if (($get(YUSERAGENT)="MSIE")||($get(YUSERAGENT)="")) {  ;FIS:31.12.04;26951;MOZILLA OHNE MODAL-WINDOW
			set lstJS1=$listbuild("var result = window.showModalDialog('"_URL_"','Calendar','DialogWidth: 320px; DialogHeight: 330px; resizable: no; status: no; scrollbar: no;');")
			set lstJS2=$listbuild("document."_YHTMFORM_".Y"_YFORM_YART_YLFN_".focus();")
			if YART="D" if $piece(YSATZ,Y,66)=1 set lstJS2=lstJS2_$listbuild("SAVENOW();")  ;FIS;02.08.04;26195;SPEICHERN BEI DATUMAUSWAHL
			write $$CreateOnClick^WWWBUTTON("Y"_YFORM_YART_YLFN,"date.gif",$$^WWWTEXT(124),"CalendarButton"_YART_YLFN,lstJS1,lstJS2,"class")  ;BR014409
		} elseif ($get(YUSERAGENT)'="MSIE")&&($get(YUSERAGENT)'="") {
			set lstJS1=$listbuild("var result = newModalDialog('"_URL_"','',330,290,0);")
		}
	}
	quit
 
 
CreateDateButton()
	;-------------------------------------------------------------------------------
	; Create the button that pops up the date window.
	;
	; Params: 
	;
	; ByRefs:
	;
	; Returns: strLink
	;
	; History:
	; 25-Jun-2007	shobby	SRBR014409:	Call out to a simplified version
	; 06-Jun-2007	shobby	SRBR014409: Created.  Subroutined out of THUMP.  Change
	; 						in functionality.  The button is now drawn as disabled
	; 						when related field is readonly rather than not being
	; 						drawn.  Made non-IE browser call conditional on related
	; 						field being not readOnly.
	;-------------------------------------------------------------------------------
	do CreateDateButtonNew()
	quit
 
 
MemoLink(pidClass,pobjWWW122,pYART="D",YKEY,pblnGrid=$$$NO)
	;-------------------------------------------------------------------------------
	; Get the memo field HTML link stuff
	;
	; Called By : INPUT^COMGridEdit31F, THUMP^WWWFORM9
	; 
	; Params: pidClass		: Class to save to
	; 		  pobjWWW122	: Current field form record
	; 		  pYART			: Field type (YART)
]]><![CDATA[	; 		  pstrKey		: Current record ]]><![CDATA[key
	; 		  pblnGrid		: Whether we are in a grid form
	;
	; ByRefs:
	;
	; Returns: strLink
	;
	; History:
	; 31-Oct-2013	shobby	SESDF-683: Removed MemoFieldWithFormatButton
	; 13-Mar-2008	shobby	SRBR014911: Allowing saving and loading of the popup screen dimensions
	; 06-Sep-2007	shobby	SRBR014712: Corrected an issue where the FCK editor
	; 						wouldn't show when being called from an edit grid.
	; 16-Aug-2007	shobby	SRBR014637: Don't show FCK editor if field is readonly.
	; 06-Jun-2007	shobby	SRBR014409: If the field is readonly display the view
	; 						window instead of the edit window
	; 05-Jun-2007	shobby	SRBR014409: Include an id for the memolink button.
	; 04-Jun-2007	RPW		SR15369: Do not find the object twice.
	; 26-Feb-2007	PO		SR15448: No longer using YAKTION to locate COM.Editor.cls
	; 11-Jan-2007	JW/RW/SH SR15369: Memo is type 3 not type 6.
	; 21-Dec-2006	JW		SR14235: Added reference to child window
	; 01-Nov-2006	JW		SR14914: Added pstrKey,pblnGrid. Don't get editor here.
	; 24-Oct-2006	Steve S	SR14915: Encapsulated from THUMP
	;-------------------------------------------------------------------------------
	new objCompany,idChild,strDimensions,strLink
	new idEditor,objEditor,idSkin,idToolbar,intMaxChar,blnUseStandard
	new strAction,objData,strURL,blnEditor,blnReadOnly
	
	quit:(YHID=1) ""
	
	set blnReadOnly = (YHID=2)
	set objCompany  = $get(^WWW012(0,YM,1))
	set blnEditor   = ($$$WWW012HTMLEditor(objCompany)'="")
	set strLink     = ""
	
	if blnEditor || (pidClass'="") {
		if 'blnEditor||blnReadOnly quit ""
		set pstrImage = "text.gif"
		set icone=""
		if $$MenuType^WWW013()=14{
			set icone = $$traducaoIcone^WWWFORMCOMMON(pstrImage)
		}
		if icone'=""{
			if $get(objCompany)="" set objCompany = $get(^WWW012(0,YM,1))
			set idColor = $$$WWW012FontColor(objCompany)
			set FONTCOLOR = ""
			if idColor'="" set FONTCOLOR = $$$SysEnum("FARBE",idColor)
			if FONTCOLOR="" set FONTCOLOR = "black"
			set strLink="&nbsp;<i id=""Y"_YFORM_pYART_YLFN_"MEMOLINK"" class='"_icone_" link' title=""Text"" style='color:"_FONTCOLOR_";top:-3px;position:relative;' "
		}else{			
			set strLink = "<IMG SRC="""_YGIF_"text.gif"" TITLE=""Text"" border=0 "
			set strLink = strLink_"id=""Y"_YFORM_pYART_YLFN_"MEMOLINK"" "
			set strLink = strLink_$select(pblnGrid:" class=IMGcell ", 1:" class=link ALIGN=ABSBOTTOM ")
		}		
 		// Standard @Net memo
		if 'blnEditor||blnReadOnly {
			set strLink=strLink_" onClick="""
			set strLink=strLink_"#"			
			set strLink=strLink_""""
		
		// HTML editor
		} else {
			// Rewrote this entire section to cleanly handle the new editor.		
			set strLink = strLink_" onclick="""
			
		; For some reason the related cell in the fields tab of COMhelp doesn't have an ID.
		;	If we are in an edit grid the id is not valid.  This doesn't matter
		;	too much because if the cell is disabled we won't see the button anyway.
			set strLink   = strLink_"if((document.getElementById('Y"_YFORM_pYART_YLFN_"')!=null)&&(document.getElementById('Y"_YFORM_pYART_YLFN_"').readOnly)) {"
			set strLink   = strLink_$$ShowPopup()
			set strLink   = strLink_"} else {"
			set strAction = "COM.Editor.cls?"     // Construct the new URI.
			set strURL    = strAction_"&YM="_YM_"&YUSER="_YUSER_"&YFORM="_YFORM_"&YART="_pYART_"&YLFN="_YLFN_"&GRID="_pblnGrid
			set strURL    = strURL_"&GRIDFIELD="_$get(YFIELDNAME)_"&Y="_Y_"&SPRACHE="_SPRACHE_"&YUSERAGENT="_YUSERAGENT
			set strURL    = strURL_"&CAMPORETORNO=Y"_YFORM_pYART_YLFN
			set strLink = strLink_"var arrDimensions = EventValue('"_YUCI_"','"_YUSER_"','"_YFORM_"','FIX','GetWindowSize^COMFCKeditor','"_YBED_"','6',''); "
			set strLink = strLink_"var strDialogHeight=arrDimensions.split('~')[0];"
			set strLink = strLink_"var strDialogWidth=arrDimensions.split('~')[1];"
			;if ($get(YUSERAGENT)="CHROME") {
				set strLink = strLink_"var left = (screen.width/2)-(strDialogWidth/2);"
  			set strLink = strLink_"var top = (screen.height/2)-(strDialogHeight/2);"
				set strLink = strLink_"window.open('"_strURL_"','editor','toolbar=0,scrollbars=0,resizable=1,"
				set strLink = strLink_"width='+strDialogWidth+',height='+strDialogHeight+',left='+left+',top='+top);"
				set strLink = strLink_"return;"
			;}else{
			;	set strLink = strLink_"var arrResult=window.showModalDialog('"_strURL_"','editor','DialogWidth: '+strDialogWidth+'; DialogHeight: '+strDialogHeight+'; resizable: yes; status: no');" // SR14914
			;	set strLink = strLink_"if (arrResult != undefined) {"
			;	set strLink = strLink_"  var strDialogHeight=arrResult.split('~')[0];"
			;	set strLink = strLink_"  var strDialogWidth=arrResult.split('~')[1];"
			;	set strLink = strLink_"  var result=arrResult.split('~')[2];"
			;	set strLink = strLink_"  if (strDialogHeight != '' ) { "
			;	set strLink = strLink_"	  var update = EventValue('"_YUCI_"','"_YUSER_"','"_YFORM_"','FIX','SetWindowSize^COMFCKeditor',strDialogHeight,'6',strDialogWidth); "
			;	set strLink = strLink_"  }"
			;	set strLink = strLink_"}"
			;}
			// If in dev - translate the picture directory to YGIF
			if $$$DEVMODE {
				set strLink = strLink_" if (result != null ) { "
				set strLink = strLink_"		var convertDir = EventValue('"_YUCI_"','"_YUSER_"','"_YFORM_"','FIX','ConvertDir^COMEditor',result,'6'); "
				set strLink = strLink_"		if (convertDir!='') result = convertDir; "
				set strLink = strLink_" } "
			}
			if pblnGrid {
				set strLink = strLink_" modalReturn('"_YFIELDNAME_"',result,3,'');"
			
			} else {
				set strLink = strLink_"if (result != null ) { "
				set strLink = strLink_" with (document.getElementById('Y"_YFORM_pYART_YLFN_"')) {"
				set strLink = strLink_"  value=result; "
				set strLink = strLink_"  focus(); "
				set strLink = strLink_" }"
				set strLink = strLink_"}"
			}
			set strLink = strLink_"}"
			set strLink = strLink_""""
		}
		set strLink = strLink_">"
	}
	quit strLink
	
	
ShowPopup()
	;-------------------------------------------------------------------------------
	; Create the link to show the popup from a text box.
	;
	; Params: pidClass		: Class the field is contained in.
	;
	; ByRefs:
	;
	; Returns: strLink
	;
	; History:
	; 16-Aug-2007	shobby	SRBR014637: Created
	;-------------------------------------------------------------------------------
	new idChild,strLink,strDimensions,URL
	
	set strLink = ""
	set idChild = $$GetChildUser^WWWUSER(YUSER)
	set URL = YAKTION_"EP=WWWFORM&amp;YFORM=WWWDOCUMENT&amp;YUSER="_idChild_"&amp;YBED="_YBED
	set URL = URL_"&amp;YUCI="_$get(YUCI)_"&amp;YM="_YM_"&amp;YDATA="_pidClass_"|"_YKEY_"|"_YLFN_"&amp;YHTMFORM1="_YHTMFORM
	set strDimensions = "HEIGHT=520,WIDTH=470,SCROLLBARS=YES,TOOLBAR=NO,RESIZABLE=YES"
	set strLink       = strLink_"subWindow('"_URL_"','text','"_strDimensions_"');"
	quit strLink
	
	
BUTTON
	;-------------------------------------------------------------------------------
	; BUTTON HINTER FELD ;posterior field 
	;
	; Params: 
	;
	; ByRefs:
	;
	; Returns:
	;
	; History:
	; 25-Jun-2007	shobby	SRBR014409:	Removed previous change.
	; 12-Jun-2007	shobby	SRBR014409: Still display buttons for readonly fields.
	; 						They will be displayed as disabled.
	;-------------------------------------------------------------------------------
	new YA,YBUTT,YI,YPARA,YTARGET
	
	quit:$get(YHID)=2  ;HIDDEN READ ONLY
	if YART'="P" if YART'="M" if YART'="D" quit
	
	set YPARA = YPARA1
	set YBUTT = $$$WWW122ButtonBehindInputField(YSATZ)
	if YBUTT'="" {
		do ^WWWFORMB
		write YCR
	}
	quit]]></Routine>
</Export>