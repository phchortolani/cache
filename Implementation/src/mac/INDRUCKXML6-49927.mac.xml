<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDRUCKXML6" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INDRUCKXML6
#include COMSYS
#include INConst
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		DRUCKEN POSITIONEN XML
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 19-Jan-2007	GRF		SR12027: Doco; quits
	; 06-Jan-2006	PO		SR14152: For customer invoice, only invoice if not sourced
	; 03-Aug-2005	JW		SR12988: Don't include special surcharge as an additional charge
	; 25-Jul-2005	JW		SR12992: Do not re-compute MWPO
	; 19.06.2002	DT
	;-------------------------------------------------------------------------------
	NEW POS,MWST,LAND,YA,YSPE,YI,TEIL,TIEFE,YEKK,A,UAN,UAUS,BLANKS,DATUM,GESAMTPZ,POSSUM,POSGRUP,YGGEWICHT,NULLDRUCK,MWPOX
	
	SET YTAB=$EXTRACT("                                                                           ",1,+$PIECE(YBELEG1,Y,39))  ;IN SPALTE ;within rift 
	SET YSPE="",$PIECE(YSPE," ",80)=""
	;YBELEG1
	SET GESAMT=0  ;GESAMTBETRAG
	KILL MWPO  ;STEUERSUMMEN
	SET SUMME=0
	SET YINKLMWST=$GET(YINKLMWST)  ;WENN 1 DANN IMMER IMKL MWST ;when constantly Tax 
	SET POSSUM=0  ;ZWISCHENSUMME POSITIONSGRUPPEN ;subtotal 
	IF +$PIECE(YBELEG1,Y,73)=0 SET $PIECE(YBELEG1,Y,73)=50  ;POSITIONSTEXTPARAMETER
	
	;AUFTRAG ODER TEILZAHLUNGSRECHNUNGEN ;order Or 
	IF $GET(YPROFORMA)="" IF YBELEG'=1 IF YBELEG'=10 IF $ORDER(YAUFTRAG(""))="" DO  ;KEINE POSITIONEN ANGEGEBEN=ALLE ;no 
	. SET POS=""
	. FOR  SET POS=$ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. . SET YFELD=$GET(^INAUFP(YM,YAUFTRAG,POS,1))
	. . ;IF YBELEG=5!(YBELEG=6)!(YBELEG=7) IF $PIECE(YFELD,Y,5)'<0 IF $PIECE($GET(^INVORG(YM,YM,1)),Y,150)=1 IF +$PIECE(YFELD,Y,90)'=1 QUIT   ;NUR AUSLIEFERUNGSFÄHIGE DRUCKEN;TYBD;27.07.2003;UL;TON
	. . IF (YBELEG=5)!(YBELEG=6)!(YBELEG=7) IF $PIECE(YFELD,Y,5)'<0 IF ($PIECE($GET(^INVORG(YM,YM,1)),Y,150)=1)!($PIECE($GET(^INVORG(YM,YM,1)),Y,150)=2) IF +$PIECE(YFELD,Y,90)'=1 QUIT   ;NUR AUSLIEFERUNGSFÄHIGE DRUCKEN;TYBD;27.07.2003;UL;TONY
	. . IF YBELEG=7 IF $PIECE(YFELD,Y,5)'<0 IF $PIECE($GET(^INVORG(YM,YM,1)),Y,150)=2 IF $PIECE(YFELD,Y,92)="" QUIT   ;NUR GELIEFERTE DRUCKEN;FIS;28.06.04;25791
	. . IF $PIECE(YFELD,Y,60)=1 QUIT  ;ABGESCHLOSSEN
	. . IF YBELEG'=12 IF +$PIECE(YFELD,Y,205)'=0 QUIT  ;SPERR POSITION NICHT DRUCKEN      AUßER ANZAHLUNGEN ;Not print outside of 
	. . IF YBELEG<13  IF $PIECE(YFELD,Y,9)=1     QUIT  ;storno
	. . IF (YBELEG=7)!(YBELEG=17) IF +YCOPY=0    QUIT:$PIECE(YFELD,Y,97)'=""  ;WENN GESAMTDRUCK, DANN NUR DIE NOCH NICHT GEDRUCKTEN POSITIONEN
	. . SET YAUFTRAG(POS)=""
	
	;ANGEBOT ;proposition 
	IF (YBELEG=1)!(YBELEG=10)!($GET(YPROFORMA)=1) IF $ORDER(YAUFTRAG(""))="" DO  ;KEINE POSITIONEN ANGEGEBEN=ALLE ;no 
	. SET POS="" FOR  SET POS=$ORDER(^INANGP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. . SET YAUFTRAG(POS)=""
	
	IF YBELEG=12 IF $GET(YPZDATUM)'="" IF $DATA(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1))  SET $PIECE(YBELEG1,Y,187)=$PIECE($GET(^(1)),Y,13)   ;ANZAHLUNGSRECHTUNG POS DRUCKEN ODER NICHT ;print Or Not 
	
	;REST ;residue 
	DO XML^INDRUCK(,,,"<LINEITEM>")
	;XML=ALLE POSITIONEN ANZEIGEN;08.08.03;FIS;24113;ALLE POSITIONEN ANZEIGEN
	IF (YBELEG=6)!(YBELEG=9)!(YBELEG=7) SET POS="" FOR  SET POS=$ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. IF $DATA(YAUFTRAG(POS)) QUIT  ;WIRD SOWIESO GEDRUCKT
	. IF $PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,243)'="" QUIT     ;SPLIT ITEM
	. IF $PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,92)'=""  QUIT     ;ALREADY PRINTED
	. SET YAUFTRAG(POS)="X"
	
	SET POS=""
	FOR  SET POS=$ORDER(YAUFTRAG(POS)) QUIT:POS=""  DO  IF +$PIECE(POS1,Y,11)=0 SET GESAMT=GESAMT+POSTOTAL  ;WENN KEINE ALTERNATIV POSITION ;when no 
	. SET NULLDRUCK=0
	. IF YAUFTRAG(POS)="X" SET NULLDRUCK=1  ;NUR POS. ANZEIGEN, KEINE BEARBEITUNG ! (KEINE MENGE)
	. SET POS1=""
	. IF YBELEG'=1 IF YBELEG'=10 IF $GET(YPROFORMA)="" SET POS1=$GET(^INAUFP(YM,YAUFTRAG,POS,1))  ;AUFTRAG ;mandate  ;order 
	. IF YBELEG=1||(YBELEG=10)||($GET(YPROFORMA)=1) SET POS1=$GET(^INANGP(YM,YAUFTRAG,POS,1))  ;ANGEBOT ODER ANFRAGE ;proposition Or 
	. SET YEKK=$GET(^INAUFPK(YM,YAUFTRAG,POS,1))  ;EK KONDITION ;Planned Cost 
	. IF $data(^INANGPK(YM,YAUFTRAG,POS,1)) SET YEKK=$get(^INANGPK(YM,YAUFTRAG,POS,1))  ;EK KONDITION ANGEBOT ;Planned Cost proposition 
	. SET POSTOTAL=0
	. ;
	. quit:((($$$INAUFPSource(POS1) = "") || ($$$INAUFPInvoiceNumber(POS1) '= "")) && (YBELEG = 7) && ($get(YCOPY)'=1)) ; SR14152
	. ;
	. ;PRUEFEN GESAMTDRUCK BEI RECHNUNG/GUTSCHRIFT/PROFORMARECHNUNG ;next to 
	. IF NULLDRUCK'=1 DO
	. . IF YBELEG=7||(YBELEG=17)||($GET(YPROFORMA)=1) IF +$GET(YCOPY)'=1 DO
	. . . IF $$$INAUFPTransferredIntoAccounting(POS1)'="" SET NULLDRUCK=1 QUIT   ;SCHON ÜBERTRAGEN ;yet transport 
	. . . IF $$$INAUFPQuantity(POS1)'<0 IF $PIECE($GET(^INVORG(YM,YM,1)),Y,150)=1 IF +$PIECE(POS1,Y,90)'=1 SET NULLDRUCK=1  ;NICHT AUSLIEFERFÄHIG;FIS;10.02.04;25072
	. . . IF $$$INAUFPQuantity(POS1)'<0 IF $PIECE($GET(^INVORG(YM,YM,1)),Y,150)=2 IF $PIECE(POS1,Y,92)=""  SET NULLDRUCK=1  ;NUR GELIEFERTE DRUCKEN;FIS;28.06.04;25791
	. . ;
	. . IF YBELEG<11 IF $$$INAUFPCancellation(POS1)=1 SET NULLDRUCK=1 QUIT  ;storno
	. . IF YBELEG<11 IF $$$INAUFPLineItemBarrier(POS1)=1 SET NULLDRUCK=1 QUIT  ;SPERR
	. . ;IF YBELEG'=1 IF YBELEG'=10 IF $PIECE(POS1,Y,60)=1 SET NULLDRUCK=1 QUIT  ;ABGESCHLOSSEN
	. . IF YBELEG'=1 IF YBELEG'=10 IF $$$INAUFPPosCompleted(POS1)=1 IF $GET(YCOPY)'=1 SET NULLDRUCK=1 QUIT  ;BEC;18.05.04;25743;ABGESCHLOSSEN
	. ;
	. IF NULLDRUCK=1 SET YAUFTRAG(POS)="X"  ;FIS;09.07.04
	. IF YBELEG'=6 IF YBELEG'=9 IF YBELEG'=7 QUIT:NULLDRUCK=1  ;NUR AUF LIEFERSCHEIN,RECHNUNG UND PICKLISTE NULLMENGEN ANZEIGEN
	. ;
	. IF +$GET(YCOPY)'=1 IF NULLDRUCK'=1 DO SORT  ;SPEICHER DATEN,WENN NICHT WIEDERHOLUNGSDRUCK
	. ;
	. IF (YBELEG=3)!(YBELEG=10)!(YBELEG=13) DO  ;NUR BEI BESTELLUNGEN U. ANFRAGEN  !AUSFÜHRUNG NUR NACH "D SORT"
	. . IF $PIECE(YEKK,Y,30)="" DO  ;KEIN STEUERSATZ AUSGEWÄHLT;FIS;07.02.05
	. . . IF $PIECE(POS1,Y,4)'="" SET $PIECE(YEKK,Y,30)=$PIECE($GET(^INART(YM,$PIECE(POS1,Y,4),1)),Y,36)
	. . . IF $LENGTH($PIECE(YEKK,Y,30))=1 IF $DATA(^WWW101(0,"MWST",SPRACHE,"1"_$PIECE(YEKK,Y,30))) SET $PIECE(YEKK,Y,30)="1"_$PIECE(YEKK,Y,30)  ;UST -> VST
	. . . QUIT
	. . IF +$PIECE(YEKK,Y,16)'=0 DO
	. . . SET $PIECE(POS1,Y,5)=$PIECE(YEKK,Y,16)  ;MENGE MIT UMRECHNUNGSFAKTOR ;quantity by means of 
	. . . IF $PIECE(YEKK,Y,18)'="" SET $PIECE(POS1,Y,40)=$PIECE(YEKK,Y,18)  ;MENGENEINHEIT MIT UMRECHNUNGSFAKTOR ;by means of 
	. . . QUIT
	. . IF YWHR'=YWHR1 DO  ;FIS;26316;24.08.04;ANPASSEN UMRECHNUNGSFAKTOREN DER POSITIONEN
	. . . NEW YWHRF1
	. . . SET YWHRF1=""
	. . . IF YWHR=$PIECE(YAUFTRAG1,Y,51) SET YWHRF1=YWHRF  ;ORDER EXCHANGE RATE ;instalment 
	. . . IF YWHRF1="" SET YWHRF1=$PIECE(YEKK,Y,78)  ;LINE ITEM EXCHANGE RATE ;ITEM instalment 
	. . . IF YWHRF1="" SET YWHRF1=$PIECE($GET(^WWWWAE(0,YWHR,1)),Y,5)  ;DFLT. EXCHANGE RATE ;instalment 
	. . . SET YWHRF=YWHRF1  ;NEW EXCHANGE RATE ;instalment 
	. . . IF +$PIECE(YEKK,Y,68)'=0 DO
	. . . . NEW YFELD,MENGE,YVOR,YFORM,YOK,NKOMMA
	. . . . SET YFELD=YEKK
	. . . . SET NKOMMA=$PIECE(YEKK,Y,25)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . . . IF +NKOMMA=0!(NKOMMA>9) SET NKOMMA=2
	. . . . SET $PIECE(YFELD,Y,47)=$JUSTIFY($PIECE(YFELD,Y,68)*YWHRF,0,NKOMMA)  ;UNIT PRICE
	. . . . SET MENGE=$PIECE(POS1,Y,5)
	. . . . IF +$PIECE(YFELD,Y,16)'=0 SET MENGE=$PIECE(YFELD,Y,16)  ;AB ODER RECHNUNGSEINGANGSMENGE ;Confirm. Or 
	. . . . IF +MENGE=0 SET MENGE=$PIECE(POS1,Y,5)
	. . . . IF +MENGE'=0 SET $PIECE(YFELD,Y,12)=$JUSTIFY($PIECE(YFELD,Y,47)*MENGE/$$^INQTYUNIT(,YAUFTRAG,POS),0,NKOMMA)
	. . . . IF +MENGE=0 SET $PIECE(YFELD,Y,12)=$JUSTIFY($PIECE(YFELD,Y,47),0,NKOMMA)
	. . . . SET $PIECE(YFELD,Y,13)=$$^INNETTO(YFELD)   ;RECHEN NETTO AUS BRUTTO FELD ;out of gr. field 
	. . . . SET $PIECE(YFELD,Y,78)=YWHRF
	. . . . IF YBELEG=3!(YBELEG=13) SET $PIECE(YFELD,Y,79)=+$HOROLOG
	. . . . SET YEKK=YFELD
	. . . . IF YBELEG=3!(YBELEG=13) IF $DATA(^INAUFPK(YM,YAUFTRAG,POS)) SET YOK=$$^WWWSPEI("INAUFPK",YAUFTRAG_","_POS,YFELD,1)
	. . . . IF YBELEG=10 IF $DATA(^INANGPK(YM,YAUFTRAG,POS)) SET YOK=$$^WWWSPEI("INANGPK",YAUFTRAG_","_POS,YFELD,1)
	. ;
	. DO ^INDRUCKXML6P  ;POSITIONEN 
	. IF (YBELEG=3)!(YBELEG=13) IF NULLDRUCK'=1 IF $DATA(^INAUFPREL(YM,YAUFTRAG,POS)) DO ^INDRUCKXML6R  ;POSITIONEN RELIES
	. ;
	. IF YBELEG'=3 IF YBELEG'=13 SET POSTOTAL=$PIECE(POS1,Y,123)   ;WENN KEINE BESTELLUNG DANN TOTAL=VKTOTAL ;when no sales order 
	. ;
	. QUIT:$PIECE(YBELEG1,Y,187)=1  ;KEINE TEILE WENN POSITIONEN NICHT GEDRUCKT WERDEN ;no when Not will 
	. QUIT:NULLDRUCK=1  ;KEINE TEILE ;no 
	. ;
	. SET TIEFE=$PIECE(YBELEG1,Y,38)   ;WEITERE ARTIKELTIEFE
	. IF YBELEG'=1 IF YBELEG'=10 IF TIEFE>1 DO  ; ARTIKELTIEFE  (NICHT BEI ANGEBOTEN) ;next to 
	. . QUIT:$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,""))=""   ;KEINE TEILE ;no 
	. . SET A=YSPE
	. . SET SPACE=2
	. . SET YA(2)=$PIECE(YBELEG1,Y,41)+SPACE   ;SPALTE ;rift 
	. . IF YA(2)="" SET YA(2)=0
	. . SET YA(3)=$PIECE(YBELEG1,Y,37)  ;BESTEHEND AUS ;out of 
	. . DO XML^INDRUCK(,,,"<"_YA(3)_"1>")   ;EINSETZEN ;stow 
	. . ;
	. . SET TEIL(1)=""
	. . FOR  SET TEIL(1)=$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1))) QUIT:TEIL(1)=""  DO
	. . . QUIT:TIEFE<2  ;TEIL IST ZU TIEF ;part within profound 
	. . . ;
	. . . SET POS1=$GET(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1)))
	. . . DO TEILE^INDRUCKXML6P(1)
	. . . ;
	. . . SET A=YSPE
	. . . QUIT:TIEFE<3 
	. . . QUIT:$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),""))=""   ;KEINE TEILE ;no 
	. . . SET SPACE=4
	. . . SET YA(2)=$PIECE(YBELEG1,Y,41)+SPACE   ;SPALTE ;rift 
	. . . IF YA(2)="" SET YA(2)=0
	. . . SET YA(3)=$PIECE(YBELEG1,Y,37)  ;BESTEHEND AUS ;out of 
	. . . DO XML^INDRUCK(,,,"<"_YA(3)_"2>")   ;EINSETZEN ;stow 
	. . . SET TEIL(2)=""
	. . . FOR  SET TEIL(2)=$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2))) QUIT:TEIL(2)=""  DO
	. . . . QUIT:TIEFE<3  ;TEIL IST ZU TIEF ;part within profound 
	. . . . ;
	. . . . SET POS1=$GET(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2)))
	. . . . DO TEILE^INDRUCKXML6P(2)
	. . . . ;
	. . . . SET A=YSPE
	. . . . QUIT:TIEFE<4 
	. . . . QUIT:$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2),""))=""   ;KEINE TEILE ;no 
	. . . . SET SPACE=6
	. . . . SET YA(2)=$PIECE(YBELEG1,Y,41)+SPACE   ;SPALTE ;rift 
	. . . . IF YA(2)="" SET YA(2)=0
	. . . . SET YA(3)=$PIECE(YBELEG1,Y,37)  ;BESTEHEND AUS ;out of 
	. . . . DO XML^INDRUCK(,,,"<"_YA(3)_"3>")   ;EINSETZEN ;stow 
	. . . . SET TEIL(3)=""
	. . . . FOR  SET TEIL(3)=$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2),TEIL(3))) QUIT:TEIL(3)=""  DO
	. . . . . QUIT:TIEFE<4  ;TEIL IST ZU TIEF ;part within profound 
	. . . . . ;
	. . . . . SET POS1=$GET(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2),TEIL(3)))
	. . . . . DO TEILE^INDRUCKXML6P(3)
	. . . . . ;
	. . . . . SET A=YSPE
	. . . . . QUIT:TIEFE<5 
	. . . . . QUIT:$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2),TEIL(3),""))=""   ;KEINE TEILE ;no 
	. . . . . SET SPACE=8
	. . . . . SET YA(2)=$PIECE(YBELEG1,Y,41)+SPACE   ;SPALTE ;rift 
	. . . . . IF YA(2)="" SET YA(2)=0
	. . . . . SET YA(3)=$PIECE(YBELEG1,Y,37)  ;BESTEHEND AUS ;out of 
	. . . . . DO XML^INDRUCK(,,,"<"_YA(3)_"4>")   ;EINSETZEN ;stow 
	. . . . . SET TEIL(4)=""
	. . . . . FOR  SET TEIL(4)=$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2),TEIL(3),TEIL(4))) QUIT:TEIL(4)=""  DO
	. . . . . . QUIT:TIEFE<5  ;TEIL IST ZU TIEF ;part within profound 
	. . . . . . ;
	. . . . . . SET POS1=$GET(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2),TEIL(3),TEIL(4)))
	. . . . . . DO TEILE^INDRUCKXML6P(4)
	. . . . . . ;
	. . . . . . SET A=YSPE
	. . . . . . QUIT:TIEFE<6 
	. . . . . . QUIT:$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2),TEIL(3),TEIL(4),""))=""   ;KEINE TEILE ;no 
	. . . . . . SET SPACE=10
	. . . . . . SET YA(2)=$PIECE(YBELEG1,Y,41)+SPACE   ;SPALTE ;rift 
	. . . . . . IF YA(2)="" SET YA(2)=0
	. . . . . . SET YA(3)=$PIECE(YBELEG1,Y,37)  ;BESTEHEND AUS ;out of 
	. . . . . . DO XML^INDRUCK(,,,"<"_YA(3)_"5>")   ;EINSETZEN ;stow 
	. . . . . . SET TEIL(5)=""
	. . . . . . FOR  SET TEIL(5)=$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2),TEIL(3),TEIL(4),TEIL(5))) QUIT:TEIL(5)=""  DO
	. . . . . . . QUIT:TIEFE<6  ;TEIL IST ZU TIEF ;part within profound 
	. . . . . . . ;
	. . . . . . . SET POS1=$GET(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2),TEIL(3),TEIL(4),TEIL(5)))
	. . . . . . . DO TEILE^INDRUCKMXL6P(5)
	. . . . . . . ;
	. . . . . . . SET A=YSPE
	. . . . . . . QUIT:TIEFE<7 
	. . . . . . . QUIT:$ORDER(^INAUFPXL(YM,YAUFTRAG,POS,TEIL(1),TEIL(2),TEIL(3),TEIL(4),TEIL(5),""))=""   ;KEINE TEILE ;no 
	. . . . . . . SET SPACE=12
	. . . . . . . SET YA(2)=$PIECE(YBELEG1,Y,41)+SPACE   ;SPALTE ;rift 
	. . . . . . . IF YA(2)="" SET YA(2)=0
	. . . . . . . SET YA(3)=$PIECE(YBELEG1,Y,37)  ;BESTEHEND AUS ;out of 
	. . . . . . . DO XML^INDRUCK(,,,"<"_YA(3)_"6>")   ;EINSETZEN ;stow 
	. . . . . . . DO XML^INDRUCK(,,,"</"_YA(3)_"6>")   ;EINSETZEN ;stow 
	. . . . . . . ;HIER WEITER ;here is ulterior 
	. . . . . . . QUIT
	. . . . . . DO XML^INDRUCK(,,,"</"_YA(3)_"5>")   ;EINSETZEN ;stow 
	. . . . . . QUIT
	. . . . . DO XML^INDRUCK(,,,"</"_YA(3)_"4>")   ;EINSETZEN ;stow 
	. . . . . QUIT
	. . . . DO XML^INDRUCK(,,,"</"_YA(3)_"3>")   ;EINSETZEN ;stow 
	. . . . QUIT
	. . . DO XML^INDRUCK(,,,"</"_YA(3)_"2>")   ;EINSETZEN ;stow 
	. . . QUIT
	. . DO XML^INDRUCK(,,,"</"_YA(3)_"1>")   ;EINSETZEN ;stow 
	
	DO XML^INDRUCK(,,,"</LINEITEM>")
	SET NETTOWW=0 ;TYBD WEGEN UNDEF MWPO 4,08,2003
	IF $GET(MWPO)'="" SET NETTOWW=+$GET(MWPO(MWPO))  ;NETTO-WARENWERT (OHNE ZUSATZKOSTEN)
	DO XML^INDRUCK(,,,"NETTO-WARENBETRAG",$$^WWWZAHL(NETTOWW,12,2,YWHR,,$GET(YWHRF)))
	;GEWICHT TOTAL ;wt. whole 
	IF $PIECE(YBELEG1,Y,50)=1 DO XML^INDRUCK(,,,"TOTAL-WEIGHT",+$GET(YGGEWICHT))
	IF YBELEG'=1 IF YBELEG'=2 IF YBELEG'=7 IF YBELEG'=17 IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=13 QUIT   ; NUR BEI ANGEBOT/ AB/ RECHUNG/ TEIZAHLUNGSRECHNUNG ;only next to 
	;IF +YCOPY=0 IF YBELEG=7 IF $PIECE(YAUFTRAG1,Y,101)'="" QUIT  ;SCHON EINMAL GEDRUCKT WENN GESAMT BEI 2.TEILRECHNUNG KEINE BERECHNUNG;AUSGESCHALTET TYBD;19,08,2003
	
	// SR12992: Do not re-compute MWPO
	set MWPO = $get(MWPO,1)
	/*
	DO  ;MWST KENNZIFFERN FÜR VP,FRACH,KM,PORTO
	. SET MWPO=1
	. IF $PIECE(YADRES,Y,17)'="" IF $PIECE(YADRES,Y,17)'=$GET(YCOUNTRY) SET MWPO=0  ;KEIN DEUTSCHLAND ;no Germany 
	. ;IF $PIECE(YADRES,Y,50)'="" IF '$FIND($PIECE(YADRES,Y,50),"DE") SET MWPO=0  ;STEUERID AUSLAND
	. IF $PIECE(YADRES,Y,50)'="" IF '$FIND($PIECE(YADRES,Y,50),$GET(YCOUNTRY)) SET MWPO=0  ;STEUERID AUSLAND  ;FIS;28.06.04 ;foreign country 
	. IF $PIECE(YADRES,Y,54)'="" IF $PIECE(YADRES,Y,54)'=1 SET MWPO=0  ;KEINE STEUER ;no tax 
	. IF $PIECE(YADRES,Y,54)=2 IF $PIECE(YADRES,Y,50)="" SET MWPO=1  ;EG OHNE UST-ID = STEUER BERECHNEN ! (PRIVATPERSON);FIS;25.03.04 ;without tax calculate 
	*/
	SET MWPOX=MWPO
	
	;VERPACKUNG ;wrapping 
	SET YVERPACK=0
	DO  ;ERMITTELN STEUERSATZ;FIS;30.06.04;26024
	. NEW KEY
	. SET MWPO=""
	. SET KEY(1)=""
	. FOR  SET KEY(1)=$ORDER(^INVERPACK(YM,KEY(1)))  QUIT:KEY(1)=""  DO  QUIT:MWPO'=""
	. . SET KEY(2)=""
	. . FOR  SET KEY(2)=$ORDER(^INVERPACK(YM,KEY(1),KEY(2)))  QUIT:KEY(2)=""  DO  QUIT:MWPO'=""
	. . . SET KEY(3)=""
	. . . FOR  SET KEY(3)=$ORDER(^INVERPACK(YM,KEY(1),KEY(2),KEY(3)))  QUIT:KEY(3)=""  DO  QUIT:MWPO'=""
	. . . . SET MWPO=$PIECE($GET(^INVERPACK(YM,KEY(1),KEY(2),KEY(3),1)),Y,3)
	. ;
	. IF (MWPO="")!(MWPOX=0) SET MWPO=MWPOX
	
	IF +$$$INAUFPackageAmount(YAUFTRAG1)'=0 SET YVERPACK=$$$INAUFPackageAmount(YAUFTRAG1)
	IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=13 IF YVERPACK'=0 DO
	. IF YCOPY'=1 QUIT:$PIECE(YAUFTRAG1,Y,242)=1  ;BEREITS BERECHNET ;yet 
	. IF YCOPY'=1 SET $PIECE(^INAUF(YM,YAUFTRAG,1),Y,242)=1  ;AUF BERECHNET SETZEN ;upon typeset 
	. ;
	. SET YA(3)=$$$INAUFPackageAmount(YAUFTRAG1)
	. QUIT:+YA(3)=0
	. SET YA(99)=1
	. ;IF YBELEG=17 SET YA(99)=-1   ;GUTSCHRIFT - AUSGESCHALTET ! (IMMER BETRAG 1:1 ÜBERNEHMEN !) ;table-mat Sum assume 
	. SET MWPO(MWPO)=$GET(MWPO(MWPO))+(YA(3)*YA(99))  ;MWST ;Tax 
	. SET YEXTRA=$GET(YEXTRA)+(YA(3)*YA(99))  ;EXTRAKOSTEN;FIS;26191;02.08.04
	. SET YA(3)=$$^WWWTEXT(32184)  ;VERPACKUNG ;wrapping 
	. SET YA(2)=$$^WWWZAHL($$$INAUFPackageAmount(YAUFTRAG1)*YA(99),12,2,YWHR)  ;VERPACKUNG BETRAG ;wrapping Sum 
	. ;D XML^INDRUCK(,,,YA(3),YA(2))
	. DO XML^INDRUCK(,,,"VERPACKUNG",YA(2))
	
	;FRACHTKOSTEN
	SET YFRACHT=0
	DO  ;ERMITTELN STEUERSATZ;FIS;30.06.04;26024
	. NEW KEY
	. SET MWPO=""
	. SET KEY(1)=""
	. FOR  SET KEY(1)=$ORDER(^INTRANSPORT(YM,KEY(1)))  QUIT:KEY(1)=""  DO  QUIT:MWPO'=""
	. . SET KEY(2)=""
	. . FOR  SET KEY(2)=$ORDER(^INTRANSPORT(YM,KEY(1),KEY(2)))  QUIT:KEY(2)=""  DO  QUIT:MWPO'=""
	. . . SET KEY(3)=""
	. . . FOR  SET KEY(3)=$ORDER(^INTRANSPORT(YM,KEY(1),KEY(2),KEY(3)))  QUIT:KEY(3)=""  DO  QUIT:MWPO'=""
	. . . . SET MWPO=$PIECE($GET(^INTRANSPORT(YM,KEY(1),KEY(2),KEY(3),1)),Y,3)
	. ;
	. IF (MWPO="")!(MWPOX=0) SET MWPO=MWPOX
	
	IF +$$$INAUFFreightAmount(YAUFTRAG1)'=0 SET YFRACHT=$$$INAUFFreightAmount(YAUFTRAG1)
	IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=13  IF YFRACHT'=0 DO
	. IF YCOPY'=1 IF YBELEG=7!(YBELEG=17) QUIT:$PIECE(YAUFTRAG1,Y,243)=1  ;BEREITS BERECHNET ;yet 
	. IF YCOPY'=1 IF YBELEG=7!(YBELEG=17) SET $PIECE(^INAUF(YM,YAUFTRAG,1),Y,243)=1  ;AUF BERECHNET SETZEN ;upon typeset 
	. SET YA(3)=$$$INAUFFreightAmount(YAUFTRAG1)
	. QUIT:+YA(3)=0
	. SET YA(99)=1
	. ;IF YBELEG=17 SET YA(99)=-1   ;GUTSCHRIFT - AUSGESCHALTET ! (IMMER BETRAG 1:1 ÜBERNEHMEN !) ;table-mat Sum assume 
	. SET MWPO(MWPO)=$GET(MWPO(MWPO))+(YA(3)*YA(99))  ;MWST ;Tax 
	. SET YEXTRA=$GET(YEXTRA)+(YA(3)*YA(99))  ;EXTRAKOSTEN;FIS;26191;02.08.04
	. SET YA(3)=$$^WWWTEXT(32186)  ;FRACHT ;loading 
	. SET YA(2)=$$^WWWZAHL($$$INAUFFreightAmount(YAUFTRAG1)*YA(99),12,2,YWHR)  ;VERSICHERUNG BETRAG ;insurance Sum 
	. ;D XML^INDRUCK(,,,YA(3),YA(2))
	. DO XML^INDRUCK(,,,"FRACHT",YA(2))
	
	;VERSICHERUNG ;insurance 
	SET YVERSICH=0
	DO  ;ERMITTELN STEUERSATZ;FIS;30.06.04;26024
	. NEW KEY
	. SET MWPO=""
	. SET KEY(1)=""
	. FOR  SET KEY(1)=$ORDER(^INVERSICH(YM,KEY(1)))  QUIT:KEY(1)=""  DO  QUIT:MWPO'=""
	. . SET KEY(2)=""
	. . FOR  SET KEY(2)=$ORDER(^INVERSICH(YM,KEY(1),KEY(2)))  QUIT:KEY(2)=""  DO  QUIT:MWPO'=""
	. . . SET KEY(3)=""
	. . . FOR  SET KEY(3)=$ORDER(^INVERSICH(YM,KEY(1),KEY(2),KEY(3)))  QUIT:KEY(3)=""  DO  QUIT:MWPO'=""
	. . . . SET MWPO=$PIECE($GET(^INVERSICH(YM,KEY(1),KEY(2),KEY(3),1)),Y,3)
	. ;
	. IF (MWPO="")!(MWPOX=0) SET MWPO=MWPOX
	
	IF +$PIECE(YAUFTRAG1,Y,184)'=0 SET YVERSICH=$PIECE(YAUFTRAG1,Y,184)
	IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=13 IF YVERSICH'=0  DO
	. IF YCOPY'=1 QUIT:$PIECE(YAUFTRAG1,Y,244)=1  ;BEREITS BERECHNET ;yet 
	. IF YCOPY'=1 SET $PIECE(^INAUF(YM,YAUFTRAG,1),Y,244)=1  ;AUF BERECHNET SETZEN ;upon typeset 
	. SET YA(3)=$PIECE(YAUFTRAG1,Y,184)
	. QUIT:+YA(3)=0
	. SET YA(99)=1
	. ;IF YBELEG=17 SET YA(99)=-1  ;GUTSCHRIFT - AUSGESCHALTET ! (IMMER BETRAG 1:1 ÜBERNEHMEN !) ;table-mat Sum assume 
	. SET MWPO(MWPO)=$GET(MWPO(MWPO))+(YA(3)*YA(99))  ;MWST ;Tax 
	. SET YEXTRA=$GET(YEXTRA)+(YA(3)*YA(99))  ;EXTRAKOSTEN;FIS;26191;02.08.04
	. SET YA(3)=$$^WWWTEXT(32185)  ;VERSICHERUNG ;insurance 
	. SET YA(2)=$$^WWWZAHL($PIECE(YAUFTRAG1,Y,184)*YA(99),12,2,YWHR)  ;VERSICHERUNG BETRAG ;insurance Sum 
	. ;D XML^INDRUCK(,,,YA(3),YA(2))
	. DO XML^INDRUCK(,,,"VERSICHERUNG",YA(2))
	
	;ENTFERNUNGSPAUSCHALE
	SET YKMGELD=0
	DO  ;ERMITTELN STEUERSATZ;FIS;30.06.04;26024 (STEUER KM-GELD WIE BEI TRANSPORTKOSTEN)
	. NEW KEY
	. SET MWPO=""
	. SET KEY(1)=""
	. FOR  SET KEY(1)=$ORDER(^INTRANSPORT(YM,KEY(1)))  QUIT:KEY(1)=""  DO  QUIT:MWPO'=""
	. . SET KEY(2)=""
	. . FOR  SET KEY(2)=$ORDER(^INTRANSPORT(YM,KEY(1),KEY(2)))  QUIT:KEY(2)=""  DO  QUIT:MWPO'=""
	. . . SET KEY(3)=""
	. . . FOR  SET KEY(3)=$ORDER(^INTRANSPORT(YM,KEY(1),KEY(2),KEY(3)))  QUIT:KEY(3)=""  DO  QUIT:MWPO'=""
	. . . . SET MWPO=$PIECE($GET(^INTRANSPORT(YM,KEY(1),KEY(2),KEY(3),1)),Y,3)
	. ;
	. IF (MWPO="")!(MWPOX=0) SET MWPO=MWPOX
	
	IF +$PIECE(YAUFTRAG1,Y,185)'=0 SET YKMGELD=$PIECE(YAUFTRAG1,Y,185)
	IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=13 IF YKMGELD'=0  DO
	. IF YCOPY'=1 QUIT:$PIECE(YAUFTRAG1,Y,245)=1  ;BEREITS BERECHNET ;yet 
	. IF YCOPY'=1 SET $PIECE(^INAUF(YM,YAUFTRAG,1),Y,245)=1  ;AUF BERECHNET SETZEN ;upon typeset 
	. SET YA(3)=$PIECE(YAUFTRAG1,Y,185)
	. QUIT:+YA(3)=0
	. SET YA(99)=1
	. ;IF YBELEG=17 SET YA(99)=-1   ;GUTSCHRIFT - AUSGESCHALTET ! (IMMER BETRAG 1:1 ÜBERNEHMEN !) ;table-mat Sum assume 
	. SET YA(3)=$$^WWWTEXT(32187)  ;KM PAUSCHALE
	. SET YA(2)=$PIECE(YAUFTRAG1,Y,187)*$PIECE($GET(^INVORG(YM,YM,1)),Y,28)*YA(99)  ;KM PAUSCHALE
	. IF +YKMGELD'=0 SET YA(2)=YKMGELD   ;TYBD;15,09,2003
	. SET MWPO(MWPO)=$GET(MWPO(MWPO))+YA(2)  ;MWST ;Tax 
	. SET YEXTRA=$GET(YEXTRA)+YA(2)  ;EXTRAKOSTEN;FIS;26191;02.08.04
	. ;DO XML^INDRUCK(,,,YA(3),YA(2))
	. DO XML^INDRUCK(,,,"KM-GELD",$$^WWWZAHL(YA(2),12,2,YWHR))
	. SET YA(3)=""
	. IF +$PIECE(YAUFTRAG1,Y,187)'=0 SET YA(3)=$PIECE(YAUFTRAG1,Y,187)_$$^WWWFELDNAME("INAUF","D",187)_" * "_$$^WWWZAHL($PIECE($GET(^INVORG(YM,YM,1)),Y,28),0,2)  ;EINZELPREIS
	. DO XML^INDRUCK(,,,"KM-GELD-INFO",YA(3))
	
	;SPEZIALZUSCHLAG
	SET YZUSCHLAG=0
	DO  ;ERMITTELN STEUERSATZ;FIS;30.06.04;26024
	. NEW KEY
	. SET MWPO=""
	. SET KEY(1)=""
	. FOR  SET KEY(1)=$ORDER(^INZUSCHLAG(YM,KEY(1)))  QUIT:KEY(1)=""  DO  QUIT:MWPO'=""
	. . SET KEY(2)=""
	. . FOR  SET KEY(2)=$ORDER(^INZUSCHLAG(YM,KEY(1),KEY(2)))  QUIT:KEY(2)=""  DO  QUIT:MWPO'=""
	. . . SET KEY(3)=""
	. . . FOR  SET KEY(3)=$ORDER(^INZUSCHLAG(YM,KEY(1),KEY(2),KEY(3)))  QUIT:KEY(3)=""  DO  QUIT:MWPO'=""
	. . . . SET MWPO=$PIECE($GET(^INZUSCHLAG(YM,KEY(1),KEY(2),KEY(3),1)),Y,3)
	. ;
	. IF (MWPO="")!(MWPOX=0) SET MWPO=MWPOX
	
	// SR12988: Do not add surcharge here.
	; IF +$PIECE(YAUFTRAG1,Y,211)'=0 SET YZUSCHLAG=$PIECE(YAUFTRAG1,Y,211)
	
	; IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=13 IF YZUSCHLAG'=0  DO
	IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=13 IF +$PIECE(YAUFTRAG1,Y,211)'=0  DO  // JW
	. IF YCOPY'=1 QUIT:$PIECE(YAUFTRAG1,Y,246)=1  ;BEREITS BERECHNET ;yet 
	. IF YCOPY'=1 SET $PIECE(^INAUF(YM,YAUFTRAG,1),Y,246)=1  ;AUF BERECHNET SETZEN ;upon typeset 
	. SET YA(3)=$PIECE(YAUFTRAG1,Y,211)
	. QUIT:+YA(3)=0
	. SET YA(99)=1
	. ;IF YBELEG=17 SET YA(99)=-1   ;GUTSCHRIFT - AUSGESCHALTET ! (IMMER BETRAG 1:1 ÜBERNEHMEN !) ;table-mat Sum assume 
	. 
	. // SR12988: Do not add surcharge here.
	. ; SET MWPO(MWPO)=$GET(MWPO(MWPO))+(YA(3)*YA(99))  ;MWST ;Tax 
	. ; SET YEXTRA=$GET(YEXTRA)+(YA(3)*YA(99))  ;EXTRAKOSTEN;FIS;26191;02.08.04
	. 
	. SET YA(3)=$$$INAUFSpecialSurcharge(YAUFTRAG1)  ;SPEZIALZUSCHLAG BEZEICHNUNG ;notation 
	. SET YA(2)=$$^WWWZAHL($PIECE(YAUFTRAG1,Y,211)*YA(99),12,2,YWHR)  ;BETRAG ;Sum 
	. 
	. ;DO XML^INDRUCK(,,,YA(3),YA(2))
	. DO XML^INDRUCK(,,,"SPEZZUSCHLAG",YA(2))
	. DO XML^INDRUCK(,,,"SPEZZUSCHLAG-INFO",YA(3))        ;BEC;25846;13.09.04;
	
	SET MWPO=MWPOX
	;ZU/ABSCHLAG
	SET YZUABSCHLAG=0
	IF +$PIECE(YAUFTRAG1,Y,251)'=0 SET YZUABSCHLAG=$PIECE(YAUFTRAG1,Y,251)
	IF +$PIECE(YAUFTRAG1,Y,252)'=0 SET YZUABSCHLAG=YZUABSCHLAG+((MWPO(MWPO)/100)*$PIECE(YAUFTRAG1,Y,252))
	IF YBELEG=3!(YBELEG=13) IF YZUABSCHLAG'=0  DO
	. SET YA(3)=$$^WWWTEXT(32959)  ;Zu/Abschlag Betrag ;Surcharge/Allowance Amount 
	. SET YA(2)=$$^WWWZAHL(YZUABSCHLAG,12,2,YWHR)  ;ZUSCHLAGE
	. ;D XML^INDRUCK(,,,YA(3),YA(2))
	. DO XML^INDRUCK(,,,"ZU/ABSCHLAG",YA(2))
	
	;----------------------------------AN ODER TEILZAHLUNGSRECHUNG---------
	IF YBELEG=12 DO
	. QUIT:$GET(YPZDATUM)=""
	. IF $DATA(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1))  SET YA(1)=1      ;DRUCK 0/1 ;printing 
	. IF '$DATA(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1)) SET YA(1)=0      ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . ;VON INDRUCK.INT KOMMT-----YFELDPZ=$GET(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1))
	. . SET SUMME=0
	. . SET MWSU=""
	. . FOR  SET MWSU=$ORDER(MWPO(MWSU))  QUIT:MWSU=""  SET SUMME=SUMME+MWPO(MWSU)  ;SUMME NEU RECHNEN;FIS;24473;28.10.03
	. . ;IF $PIECE(YFELDPZ,Y,8)=1 SET SUMME=SUMME+YVERPACK+YKMGELD+YFRACHT+YVERSICH+YZUSCHLAG  ;KEINE ZUSATZKOSTEN;FIS;24473;11.11.03
	. . SET A=YSPE
	. . IF +$PIECE(YBELEG1,Y,40)'=0 DO
	. . . SET YA(2)=$PIECE(YBELEG1,Y,41)   ;SPALTE ZALHLUNG ;rift 
	. . . IF YA(2)="" SET YA(2)=1
	. . . SET YA(3)=$$^WWWTEXT(32553,,1)_":"      ;FÄLLIG:
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . ;
	. . SET YA(2)=$PIECE(YBELEG1,Y,55)   ;SPALTE ZALHLUNG WIE BEZEICHNUNG ;rift such as notation 
	. . IF YA(2)="" SET YA(2)=22
	. . IF $PIECE(YFELDPZ,Y,1)=1  IF +$PIECE(YFELDPZ,Y,2)'=0 SET YA(3)=$$^WWWTEXT(32330)      ;ANZAHLUNG ;down payment 
	. . IF $PIECE(YFELDPZ,Y,1)'=1 IF +$PIECE(YFELDPZ,Y,2)'=0 SET YA(3)=$$^WWWTEXT(32469)      ;TEILZAHLUNG ;progress payment 
	. . IF $PIECE(YFELDPZ,Y,1)=1  IF +$PIECE(YFELDPZ,Y,2)=0 IF +$PIECE(YFELDPZ,Y,3)'=0 SET YA(3)=$$^WWWZAHL($PIECE(YFELDPZ,Y,3),0,2)_" % "_$$^WWWTEXT(32330)      ; % ANZALHLUNG
	. . IF $PIECE(YFELDPZ,Y,1)'=1 IF +$PIECE(YFELDPZ,Y,2)=0 IF +$PIECE(YFELDPZ,Y,3)'=0 SET YA(3)=$$^WWWZAHL($PIECE(YFELDPZ,Y,3),0,2)_" % "_$$^WWWTEXT(32469)     ; % TEILZALHLUNG
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ZALHLUNG WIE GESAMTBETRAG ;rift such as 
	. . IF YA(2)="" SET YA(2)=63
	. . IF +$PIECE(YFELDPZ,Y,2)'=0 SET YA(3)=$$^WWWZAHL($PIECE(YFELDPZ,Y,2),12,2,YWHR)         ;ZALHLUNG--BETRAG     
	. . IF +$PIECE(YFELDPZ,Y,2)=0 IF +$PIECE(YFELDPZ,Y,3)'=0 SET YA(3)=$$^WWWZAHL(SUMME*$PIECE(YFELDPZ,Y,3)/100,12,2,YWHR)
	. . IF $GET(YPZDATUM)'="" IF $GET(YAUFTRAG)'="" IF $DATA(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1)) IF $GET(YCOPY)'=1 DO
	. . . IF +$PIECE(YFELDPZ,Y,2)'=0                           SET $PIECE(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1),Y,11)=$PIECE(YFELDPZ,Y,2)
	. . . IF +$PIECE(YFELDPZ,Y,2)=0 IF +$PIECE(YFELDPZ,Y,3)'=0 SET $PIECE(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1),Y,11)=SUMME*$PIECE(YFELDPZ,Y,3)/100
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO XML^INDRUCK(,,,"PAYMENT",A)
	
	QUIT
	
SORT   ;
	NEW YFORM,YVORG
	QUIT:$GET(YTEST)'=""  ;NUR TEST ;only Test 
	DO @YBELEG            ;VERTEILEN AUF BELEGART ;distribute upon 
	IF YBELEG'=1 IF YBELEG'=10 IF $GET(YPROFORMA)'=1 SET YA=$$^WWWSPEI("INAUFP",YAUFTRAG_","_POS,POS1,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	IF (YBELEG=1)!(YBELEG=10)                        SET YA=$$^WWWSPEI("INANGP",YAUFTRAG_","_POS,POS1,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	QUIT
	
1 ;ANGEBOT ;proposition 
	IF $PIECE(POS1,Y,79)="" SET $PIECE(POS1,Y,79)=YDATE  ;GEDRUCKT AM ;to the 
	IF $PIECE(POS1,Y,80)="" SET $PIECE(POS1,Y,80)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,81)="" SET $PIECE(POS1,Y,81)=YBED  ;GEDRUCKT VON
	QUIT
	
2 ;AB ;Confirm. 
	DO  ;BELEGNUMMER EINTRAGEN
	. QUIT:$PIECE(YAUFTRAG1,Y,78)=""
	. SET $PIECE(POS1,Y,78)=$PIECE(YAUFTRAG1,Y,78)   ;NUMMER AUS AUFTRAG ;numeral out of order 
	
	IF $PIECE(POS1,Y,78)="" SET $PIECE(POS11,Y,78)=YAUFTRAG  ;SPEICHERN ;Save 
	IF $PIECE(POS1,Y,79)="" SET $PIECE(POS1,Y,79)=YDATE  ;GEDRUCKT AM ;to the 
	IF $PIECE(POS1,Y,80)="" SET $PIECE(POS1,Y,80)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,81)="" SET $PIECE(POS1,Y,81)=YBED  ;GEDRUCKT VON
	QUIT
	
3 ;BESTELLUNG ;sales order 
	IF $PIECE(POS1,Y,83)="" SET $PIECE(POS1,Y,83)=+$HOROLOG  ;GEDRUCKT AM ;to the 
	IF $PIECE(POS1,Y,84)="" SET $PIECE(POS1,Y,84)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,85)="" SET $PIECE(POS1,Y,85)=YBED  ;GEDRUCKT VON
	QUIT
	
4 ;
	QUIT
	
5 ;
	QUIT
	
6 ;LIEFERSCHEIN ;packing slip 
	DO  ;BELEGNUMMER ERRECHNEN
	. QUIT:$PIECE(YAUFTRAG1,Y,91)=""
	. SET $PIECE(POS1,Y,91)=$PIECE(YAUFTRAG1,Y,91)   ;NUMMER  AUS AUFTR ;numeral out of 
	
	IF $PIECE(POS1,Y,91)="" SET $PIECE(POS1,Y,91)=YAUFTRAG  ;SPEICHERN ;Save 
	IF $PIECE(POS1,Y,92)="" SET $PIECE(POS1,Y,92)=YDATE     ;GEDRUCKT AM ;to the 
	IF $DATA(^INVORG(YM,YM,1)) IF $PIECE($GET(^INVORG(YM,YM,1)),Y,40)=1 SET $PIECE(POS1,Y,76)=YDATE  ;AUSLIEFERUNGSDATUM
	IF YCOPY=1 SET YDATUM=$PIECE(POS1,Y,92)                               ;WENN WIEDERHOLUNG ;when repetition 
	IF $PIECE(POS1,Y,93)="" SET $PIECE(POS1,Y,93)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,94)="" SET $PIECE(POS1,Y,94)=YBED                    ;GEDRUCKT VON
	QUIT
 
7 ;RECHNUNG ;tab 
	DO  ;BELEGNUMMER ERRECHNEN
	. QUIT:$PIECE(YAUFTRAG1,Y,96)=""
	. SET $PIECE(POS1,Y,96)=$PIECE(YAUFTRAG1,Y,96)   ; NUMMER AUS AUFTRAG ;numeral out of order 
	. QUIT
	IF $PIECE(POS1,Y,96)="" SET $PIECE(POS1,Y,96)=YAUFTRAG  ;SPEICHERN ;Save 
	IF $PIECE(POS1,Y,97)="" SET $PIECE(POS1,Y,97)=YDATE  ;GEDRUCKT AM ;to the 
	IF YCOPY=1 SET YDATE=$PIECE(POS1,Y,97) ;WENN WIEDERHOLUNG ;when repetition 
	IF $PIECE(POS1,Y,98)="" SET $PIECE(POS1,Y,98)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,99)="" SET $PIECE(POS1,Y,99)=YBED  ;GEDRUCKT VON
	DO  ;SETZEN UMSATZ ZEITRAUM;27153;FIS;17.01.05
	. NEW YKEY,YFELD
	. SET YKEY=YAUFTRAG_","_POS
	. SET YFELD=POS1
	. DO ^INAUFPVALDATE
	. SET POS1=YFELD
	. QUIT
	QUIT
	
8 ;
	QUIT
	
9 ;BEREITSTELLUNG
	IF $PIECE(POS1,Y,87)="" SET $PIECE(POS1,Y,87)=+$HOROLOG  ;GEDRUCKT AM ;to the 
	IF YCOPY=1 SET YDATE=$PIECE(POS1,Y,87) ;WENN WIEDERHOLUNG ;when repetition 
	IF $PIECE(POS1,Y,88)="" SET $PIECE(POS1,Y,88)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,89)="" SET $PIECE(POS1,Y,89)=YBED  ;GEDRUCKT VON
	QUIT
	
10 ;
	IF $PIECE(POS1,Y,83)="" SET $PIECE(POS1,Y,83)=+$HOROLOG  ;GEDRUCKT AM ;to the 
	IF $PIECE(POS1,Y,84)="" SET $PIECE(POS1,Y,84)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,85)="" SET $PIECE(POS1,Y,85)=YBED  ;GEDRUCKT VON
	QUIT
	
11 ;
	QUIT
	
12 ;
	QUIT
	
13 ; 
	IF $PIECE(POS1,Y,402)="" SET $PIECE(POS1,Y,402)=+$HOROLOG  ;GEDRUCKT AM ;to the
	SET $PIECE(POS1,Y,9)=1  ;STORNO
	QUIT
	QUIT
	
14 ;
	QUIT
	
15 ;
	QUIT
	
16 ;
	QUIT
	
17 ;
	DO 7
	QUIT
	
18 ;
	
19 ;
	QUIT       
]]></Routine>
</Export>