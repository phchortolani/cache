<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWANL" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWANL ;WWWANL;DT;ANZEIGEN MAILINGS;17.09.1999:GEAENDERT=57970,74575 ; 26 Oct 99 12:48 PM
 
#include COMSYS
 
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		ANZEIGEN MAILINGS
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| 30-May-2005		RobertW		SR12056: Attempt at Performance Increase
	;| DT	17.09.1999:GEAENDERT=57970,74575 
	;|
	;\------------------------------------------------------------------/
	;
	NEW YI,II
	SET YPARA1=$GET(%(YQUERY,"YPARA1"))
	QUIT:YPARA1=""
	SET YACC=$PIECE(YPARA1,",",1)  ;adresse cc
	QUIT:YACC=""
	SET DATE=$PIECE(YPARA1,",",2)   ;datum
	QUIT:DATE=""
	SET SUBJ=$PIECE(YPARA1,",",3)   ;betreff
	QUIT:DATE=""
	SET FROM=$PIECE(YPARA1,",",4)   ;von wem ;from 
	QUIT:FROM=""
	KILL TEXT,TEXT1
	SET TEXT=""
	MERGE TEXT1=^WWWANA(0,YACC,DATE,SUBJ,FROM)   ;text holen ;text send for 
	SET BOUNDARY=""
	SET PRINTABLE=""
	;durchsuchen nach grenzen ;scour within abut 
	FOR ITEM="BOUNDARY=","CONTENT-TRANSFER-ENCODING: QUOTED-PRINTABLE" DO
	. ;FOR I=1:1 QUIT:'$DATA(TEXT1(I,1))  IF $FIND($$^WWWUPER($GET(TEXT1(I,1))),ITEM) DO  QUIT
	. FOR I=1:1 QUIT:'$DATA(TEXT1(I,1))  IF $FIND($zconvert($GET(TEXT1(I,1)),"U"),ITEM) DO  QUIT
	. . IF ITEM="BOUNDARY=" SET BOUNDARY=$TRANSLATE($PIECE(TEXT1(I,1),"boundary=",2),"""")
	. . IF ITEM="CONTENT-TRANSFER-ENCODING: QUOTED-PRINTABLE" SET PRINTABLE=I QUIT
	. . QUIT
	. QUIT
	IF BOUNDARY="" SET BOUNDARY="---=_NextPart"
	;suchen Printable (anzeigebar) ;seek 
	IF PRINTABLE="" DO
	. FOR PRINTABLE=2:1 QUIT:'$DATA(TEXT1(PRINTABLE,1))  QUIT:TEXT1(PRINTABLE,1)=""
	. QUIT
	SET PRINTABLE=PRINTABLE+1
	FOR YI=PRINTABLE:1 QUIT:'$DATA(TEXT1(YI,1))  QUIT:$FIND(TEXT1(YI,1),BOUNDARY)  SET TEXT=TEXT_$TRANSLATE($GET(TEXT1(YI,1)),"<>';-"_"""","()")_YCR
	WRITE YCR,"<TABLE CELLSPACING=0 BORDER=0>"
	WRITE "<TR><TD>"
	WRITE YCR,"<TABLE CELLSPACING=0 BORDER=0>"
	WRITE YCR
	WRITE "<TR>"
	WRITE "<TD>"
	WRITE "<FONT SIZE=2>"
	WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&amp;YFORM=WWWANM"
	DO
	. SET YBACK1=YBACK
	. NEW YPARA,YBACK
	. WRITE "&amp;YPARA1="_YACC_","_DATE_","_SUBJ_","_FROM
	. SET YBACK="WWWANN,"
	. DO ^WWWCGI
	. QUIT
	WRITE """"_">"
	WRITE YCR,"<IMG SRC="_""""_YGIF_"mail.gif"_""""_" "_YHEIGHT_" "_YWIDTH_" TITLE="_""""_"mail"_""""_" border=0>"
	WRITE "</A>"
	WRITE YCR,"</TD>"
	WRITE "<TD NOWRAP>"
	WRITE "<A onClick='return doLink(this)' HREF=""JavaScript:if (confirm('"_"("_FROM_", "_SUBJ_") "_$$^WWWTEXT(321)_"')) window.location='"
	WRITE YAKTION_"EP=WWWMANU&YEXEC=*D|KILL^WWWANN"
	WRITE "&YPARA1="_YACC_","_DATE_","_SUBJ_","_FROM
	DO ^WWWCGI
	WRITE "';"_""""_">"
	WRITE YCR,"<IMG SRC="_""""_YGIF_"del.gif"_""""_" "_YHEIGHT_" "_YWIDTH_" TITLE="_""""_$$^WWWTEXT(41)_""""_" border=0>"
	WRITE "</A>"
	WRITE YCR,"</TD>"
	WRITE "</TABLE>"
	;anzeige des mails
	WRITE "<PRE>"
	WRITE "<B><STRONG>"
	WRITE $$^WWWTEXT(68),": ",FROM
	WRITE YCR
	WRITE $$^WWWTEXT(292),": " WRITE SUBJ
	WRITE YCR
	WRITE $$^WWWTEXT(124),": ",DATE
	WRITE "</B></STRONG>"
	WRITE "<BR>"
	WRITE "<BR>"
	WRITE YCR
	FOR YI=PRINTABLE:1 QUIT:'$DATA(TEXT1(YI,1))  QUIT:$FIND(TEXT1(YI,1),BOUNDARY)  SET YINHALT=$GET(TEXT1(YI,1)) DO
	. DO THUMP
	. WRITE $$^WWWUML(YINHALT),"<BR>"
	. QUIT
	WRITE YCR,"</TD></TR>"
	WRITE "</PRE>"
	WRITE YCR,"</TABLE>"
	QUIT
	
THUMP ;BILDANZEIGEN
	QUIT:YINHALT=""
	IF $FIND(YINHALT," ") QUIT
	IF $FIND(YINHALT,".GIF")!($FIND(YINHALT,".gif"))!($FIND(YINHALT,".jpg"))!($FIND(YINHALT,".JPG")) DO  QUIT
	. WRITE YCR,"<IMG SRC="_""""_$TRANSLATE(YINHALT,"|")_""""_" TITLE="_""""_$PIECE(YINHALT,".",1)_""""_">"
	. SET YINHALT=""
	. QUIT
	IF $FIND(YINHALT,".AVI")!($FIND(YINHALT,".avi")) DO  QUIT
	. WRITE "<CENTER><IMG DYNSRC="_""""_YINHALT_""""_" START=mouseover"_"></CENTER>"
	. SET YINHALT=""
	. QUIT
	IF $EXTRACT(YINHALT,$LENGTH(YINHALT)-3)="." DO  QUIT
	. WRITE "<EMBED SRC="_""""_YINHALT_""""_">"
	. SET YINHALT=""
	. QUIT
	QUIT
	
SETVAL ;MAILPARAMETER VORBELEGEN
	NEW YI,II
	QUIT:YPARA1=""
	SET YACC=$PIECE(YPARA1,",",1)
	QUIT:YACC=""
	SET DATE=$PIECE(YPARA1,",",2)
	QUIT:DATE=""
	SET SUBJ=$PIECE(YPARA1,",",3)
	QUIT:DATE=""
	SET FROM=$PIECE(YPARA1,",",4)
	QUIT:FROM=""
	;IF $$^WWWUPER($EXTRACT(SUBJ,1,3))'="RE:" SET SUBJ="Re: "_SUBJ
	IF $zconvert($EXTRACT(SUBJ,1,3),"U")'="RE:" SET SUBJ="Re: "_SUBJ
	SET %(YQUERY,"YPARA1")=""
	SET YPARA1=""
	KILL TEXT,TEXT1
	SET TEXT=""
	MERGE TEXT1=^WWWANA(0,YACC,DATE,SUBJ,FROM)
	SET BOUNDARY=""
	SET PRINTABLE=""
	FOR ITEM="BOUNDARY=","CONTENT-TRANSFER-ENCODING: QUOTED-PRINTABLE" DO
	. ;FOR I=1:1 QUIT:'$DATA(TEXT1(I,1))  IF $FIND($$^WWWUPER(TEXT1(I,1)),ITEM) DO  QUIT
	. FOR I=1:1 QUIT:'$DATA(TEXT1(I,1))  IF $FIND($zconvert(TEXT1(I,1),"U"),ITEM) DO  QUIT
	. . IF ITEM="BOUNDARY=" SET BOUNDARY=$TRANSLATE($PIECE(TEXT(I,1),"boundary=",2),"""")
	. . IF ITEM="CONTENT-TRANSFER-ENCODING: QUOTED-PRINTABLE" SET PRINTABLE=I QUIT
	. . QUIT
	. QUIT
	IF BOUNDARY="" SET BOUNDARY="---=_NextPart"
	IF PRINTABLE="" DO
	. FOR PRINTABLE=2:1 QUIT:'$DATA(TEXT1(PRINTABLE,1))  QUIT:TEXT1(PRINTABLE,1)=""
	. QUIT
	SET PRINTABLE=PRINTABLE+1
	FOR YI=PRINTABLE:1 QUIT:'$DATA(TEXT1(YI,1))  QUIT:$FIND(TEXT1(YI,1),BOUNDARY)  SET TEXT=TEXT_$TRANSLATE($GET(TEXT1(YI,1)),"<>';-"_"""","()")_YCR
	WRITE YCR
	;WRITE YCR,"<SCRIPT LANGUAGE=JavaScript>",YCR
	;WRITE "<!--",YCR
	$$$StartScript()
	WRITE YCR
	WRITE "document."_YHTMFORM_".Y"_YFORM_"P1.value='"_FROM_"';"
	WRITE YCR
	WRITE "document."_YHTMFORM_".Y"_YFORM_"D3.value='"_SUBJ_"';"
	WRITE YCR
	WRITE "TEXT = "_""""_""""_" ;"
	FOR YI=PRINTABLE:1 QUIT:'$DATA(TEXT1(YI,1))  DO
	. QUIT:$FIND(TEXT1(YI,1),BOUNDARY)  
	. WRITE YCR
	. WRITE "TEXT = TEXT + "_""""_$TRANSLATE($GET(TEXT1(YI,1)),"""","")_"\n"_""""_";"
	. WRITE YCR
	. QUIT
	WRITE YCR
	WRITE "document."_YHTMFORM_".Y"_YFORM_"D1.value=TEXT;"
	;WRITE "//-->",YCR
	;WRITE YCR,"</SCRIPT>",YCR
	$$$EndScript()
	QUIT
]]></Routine>
</Export>