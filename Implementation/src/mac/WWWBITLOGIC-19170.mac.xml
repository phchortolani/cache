<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWBITLOGIC" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWBITLOGIC(YDATEI1,YLFN1,YBIT1,YOPERATOR,YNEW,YTEMP) ;WWWBITLOGIC;DT;SUMME DER BITS;18.6.2003  ; Compiled March 3, 2005 16:30:04
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		SUMME DER BITS
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	18.6.2003  
	;|
	;\------------------------------------------------------------------/
	;
	;
	;
	;YDATEI= KLASSE, DIE SUMMIERT WIRD
	;YLFN1 = DES BIT MAP FELDES
	;YBIT1 = BIT DER AUSWERTUNG ( GGF PARAMETER / TEXT / ODER 1 ) ;bit the parameter Text Or 
	;      = 1-30 DANN WERTEAUSWAHL
	;YOPERATOR="&" UND "!"=ODER "|"=ODER "~"=NICHT
	;
	;YLFN="" DANN GESAMTEN RECORDS
	;YBIT="" DANN ALLE BITS
	;
	;YNEW = 1 = NEW SET, DELETS OLD SET
	;       2 = LAST LOGIC, DELETE AFTER EXECUTION
	;
	;YTEMP = "" = KEIN TEMP
	;        1  = IN TEMP EINSPIELEN ;within 
	;        2  = TEMP VERWENDEN      ;apply 
	;
	;SAMPLE:
	;W $$^WWWBITLOGIC(,,,,1)   ;KILL ALL
	;W $$^WWWBITLOGIC("INOPSTAMM",403,5,"!",1)   ;FIRST ALL IN STUDIO 5
	;W $$^WWWBITLOGIC("INOPSTAMM",408,1,"&")      ;2ND   ALL ALSO AND WITH STATUS 1 OK
	;W $$^WWWBITLOGIC("INOPSTAMM",405,1,"&",2)    ;LAST WITH KILL
	;
	;W $$^WWWBITLOGIC(,,,,1,1)   ;KILL TEMP
	;W $$^WWWBITLOGIC("INOPSTAMM",405,1,"!",,1)    ;EINTRAG IN ZWISCHENDATEI
	;W $$^WWWBITLOGIC(",,"&",,2)    ;EINTRAG AUS ZWISCHENDATEI VERGLEICHEN MIT DER BITDATEI
	;GGF NICHT LÃ–SCHEN UM DATEN MIT BITFIND AUFZULISTEN. ;Not Delete to by means of 
	NEW RETRUN,COUNT,FILE,FILE1,FILE2,RESULT,YBIT,YBITM,YLAST,COUNT1
	;
	IF $GET(YUSER)="" SET YUSER="0"
	;
	;DELETE
	IF $GET(YNEW)=1 IF $GET(YTEMP)=1 KILL ^WWWSOR(YUSER,"BIT","TEMP")
	IF $GET(YNEW)=1 IF $GET(YTEMP)'=1 KILL ^WWWSOR(YUSER,"BIT")
	IF $GET(YNEW)'=1 DO
	. FOR YBIT=1:1:40 KILL ^WWWSOR(YUSER,"BIT",YBIT)
	. QUIT
	;
	;
	;SET VARIABLE ;table-mat 
	SET YOPERATOR=$GET(YOPERATOR)
	IF YOPERATOR="!" SET YOPERATOR="|"  ;ODER ;Or 
	IF YOPERATOR="" SET YOPERATOR="|"   ;ODER ;Or 
	SET RETURN=""
	SET YDATEI1=$GET(YDATEI1)
	IF YDATEI1="" QUIT RETURN
	SET YLFN1=+$GET(YLFN1)
	SET YBIT1=$GET(YBIT1)
	IF YBIT1="" SET YBIT1=1 
	IF $PIECE($GET(^WWW001B(0,YDATEI1,YLFN1,1)),Y,3)=1 SET YBIT1="SUM"  ;SUMME ;sum 
	;
	;
	;EXECUTE
	IF YBIT1'="SUM" DO COUNT
	IF YBIT1="SUM" DO COUNTSUM
	;
	IF $GET(YNEW)=2 KILL ^WWWSOR(YUSER,"BIT")
	QUIT RETURN
	;
	;
	;
	
COUNT  ;GESAMTE FILE
	;
	SET FILE="^"_YDATEI1_"b("_""""_$$^WWWYM(YDATEI1,0)_""""_","_0_","_1_","_"COUNT"_")" 
	SET FILE1="^"_YDATEI1_"b("_""""_$$^WWWYM(YDATEI1,0)_""""_","_YLFN1_","_""""_YBIT1_""""_","_"COUNT"_")"
	SET FILE2="^WWWSOR(YUSER,"_""""_"BIT"_""""_",0,"_"COUNT"_")"  ;NORMALER LOOCKUP 
	IF $GET(YTEMP)=2 SET FILE1=FILE2  ;VERGLEICH TEMP MIT 0 ;preventive composition by means of 
	IF $GET(YTEMP)'="" SET FILE2="^WWWSOR(YUSER,"_""""_"BIT"_""""_","_""""_"TEMP"_""""_","_"COUNT"_")"  ;TEMPLOOKUP
	SET COUNT="" FOR  SET COUNT=$ORDER(@FILE) QUIT:COUNT=""  DO
	. SET FILE(1)=$GET(@FILE1)
	. SET FILE(2)=$GET(@FILE2)   ;AUSGESEICHERTEN DATEN
	. ;
	. DO
	. . IF YOPERATOR="|" SET RESULT=$BITLOGIC(FILE(1)|FILE(2))
	. . IF YOPERATOR="&" SET RESULT=$BITLOGIC(FILE(1)&FILE(2))
	. . ;IF YOPERATOR="~" SET RESULT=$BITLOGIC(~FILE(1))
	. . IF YOPERATOR="~" SET RESULT=$BITLOGIC(FILE(2)&~FILE(1))  ;FIS;22.04.04
	. . IF $GET(YTEMP)'=1 SET ^WWWSOR(YUSER,"BIT",0,COUNT)=RESULT   ;NORMALER SAVE
	. . IF $GET(YTEMP)=1 SET ^WWWSOR(YUSER,"BIT","TEMP",COUNT)=RESULT  ;TEMP SAVE
	. . SET RETURN=RETURN+$BITCOUNT(RESULT,1)
	. . QUIT
	. QUIT
	QUIT
	;
	
COUNTSUM  ;GESAMTE FILE
	;
	;
	IF $GET(YTEMP)'=2 SET FILE="^WWWSOR(YUSER,"_""""_"BIT"_""""_",0,"_"COUNT"_")"  ;NORMALER LOOCKUP 
	IF $GET(YTEMP)=2 SET FILE="^WWWSOR(YUSER,"_""""_"BIT"_""""_","_""""_"TEMP"_""""_","_"COUNT"_")"  ;TEMPLOOKUP
	;
	SET COUNT="" FOR  SET COUNT=$ORDER(@FILE) QUIT:COUNT=""  DO
	. SET FILE(1)=$GET(@FILE)
	. ; 
	. FOR YBIT=1:1:40 DO
	. . SET FILE1="^"_YDATEI1_"b("_""""_$$^WWWYM(YDATEI1,0)_""""_","_YLFN1_","_YBIT_","_"COUNT"_")"
	. . SET FILE(2)=$GET(@FILE1)
	. . IF FILE(2)'="" DO
	. . . IF YOPERATOR="|" SET RESULT=$BITLOGIC(FILE(1)|FILE(2))
	. . . IF YOPERATOR="&" SET RESULT=$BITLOGIC(FILE(1)&FILE(2))
	. . . ;IF YOPERATOR="~" SET RESULT=$BITLOGIC(~FILE(1))
	. . . IF YOPERATOR="~" SET RESULT=$BITLOGIC(FILE(2)&~FILE(1))  ;FIS;22.04.04
	. . . SET ^WWWSOR(YUSER,"BIT",YBIT,COUNT)=RESULT
	. . . QUIT
	. . QUIT
	. QUIT
	SET YBITM=""
	SET YLAST=1
	FOR BIT=1:1:40 SET YBITM=$GET(YBITM)_YLAST_"," SET YLAST=YLAST*2  ;BITM="1,2,4,8,16,32,64,128,,,,,,"
	FOR YBIT=1:1:40 DO
	. SET FILE="^WWWSOR(YUSER,"_""""_"BIT"_""""_","_YBIT_","_"COUNT"_")"
	. SET COUNT="" FOR  SET COUNT=$ORDER(@FILE) QUIT:COUNT=""  DO
	. . SET FILE(1)=$GET(@FILE)
	. . SET RETURN=RETURN+($BITCOUNT(FILE(1),1)*$PIECE(YBITM,",",YBIT))  ;MAL DIE WERTIGKEIT ;sometimes who 
	. . QUIT
	. QUIT
	SET RETURN=RETURN/100  ;BETRAG ;Sum 
	IF RETURN>9999999999 SET RETURN=""  ;FIS;25.04.06;25940
	QUIT
]]></Routine>
</Export>