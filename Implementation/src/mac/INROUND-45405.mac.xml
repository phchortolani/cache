<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INROUND" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INROUND(PRICE,ITEMGROUP,STANDARD)	;INROUND;BEC;RUNDEN VON ARTIKEL;24.07.03
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		RUNDEN VON ARTIKEL
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| BEC	24.07.03
	;|
	;\------------------------------------------------------------------/
	;
	;PRICE=PRICE DER GERUNDET WERDEN SOLL ;the will 
	;ITEMGROUP=WARENGRUPPE FÜR DIE GERUNDET WERDEN SOLL ;to who will 
	;DIE RUNDUNGSREGELN STEHEN IN INARTRUNDUNG ;who within 
	;S PRICE=$$^INROUND(PRICE,GROUP)
	;BEC;31.07.03;23849;RUNDUNGSMERKER HINZUGEFÜGT
	IF $GET(Y)="" DO ^WWWVAR		;WEGEN TERMINAL ;quibble 
	NEW ENDVON,OK,SUCH,YFELD,NEU,ENDVON1
	SET PRICE=$GET(PRICE)
	SET ITEMGROUP=$GET(ITEMGROUP)
	IF ITEMGROUP="" SET ITEMGROUP=$PIECE($GET(^INVORG(YM,YM,1)),Y,13)  ;AUS ALLGM. ABLAUFVORGABEN ;out of 
	IF ITEMGROUP="" SET ITEMGROUP=1
	SET STANDARD=$GET(STANDARD)                  ;24863;BEC;06.01.03;ROUND WITH STANDARD ITEMGROUP, IF NO ROUNDING RULES ARE FOR THAT ITEMGROUP 
	IF STANDARD=1 IF ITEMGROUP'="" IF '$DATA(^INARTRUNDUNGs(YM,1,ITEMGROUP)) DO
	. SET ITEMGROUP=$PIECE($GET(^INVORG(YM,YM,1)),Y,13)
	. QUIT
	;     							;WENN KEINE GEFUNDEN, DANN 1
	IF +PRICE'=0 IF ITEMGROUP'="" DO
	. SET OK=""
	. SET ENDVON="" FOR  SET ENDVON=$ORDER(^INARTRUNDUNGs(YM,1,ITEMGROUP,ENDVON),-1) QUIT:ENDVON=""  DO   ;ENDUNG VON ;termination 
	. . QUIT:OK=1
	. . SET ENDVON1=$JUSTIFY(ENDVON,0,2)
	. . SET PRICE=$JUSTIFY(PRICE,0,2)
	. . SET PRUEF=PRICE
	. . IF $PIECE(PRICE,".",2)'<$PIECE(ENDVON1,".",2) DO
	. . . SET SUCH=$ORDER(^INARTRUNDUNGs(YM,1,ITEMGROUP,ENDVON,ITEMGROUP,""))
	. . . QUIT:SUCH=""
	. . . SET YFELD=$GET(^INARTRUNDUNG(YM,ITEMGROUP,SUCH,1))
	. . . QUIT:YFELD="" 
	. . . ;QUIT:$PIECE(PRICE,".",2)>$PIECE($JUSTIFY($PIECE(YFELD,Y,2),2,2),".",2)     ;BEC;06.01.03;24863;NUR BEI NICHT VOLLEN RUNDUNGEN
	. . . IF +$PIECE(YFELD,Y,1)'=0 QUIT:$PIECE(PRICE,".",2)>$PIECE($JUSTIFY($PIECE(YFELD,Y,2),2,2),".",2)   			;ENDUNG BIS ;termination until 
	. . . NEW ENDUNG
	. . . SET ENDUNG=$JUSTIFY($PIECE(YFELD,Y,3),0,2)		;NEUE ENDUNG ;termination 
	. . . IF ENDUNG'="" IF +$PIECE(YFELD,Y,5)=0 DO
	. . . . IF $LENGTH(ENDUNG)=4 IF $EXTRACT(ENDUNG)=0 SET ENDUNG=$EXTRACT($REVERSE($PIECE(PRICE,".",1)))_$EXTRACT(ENDUNG,2,$LENGTH(ENDUNG))	;DAMIT ES AUCH MIT 0.23 GEHT ;therewith it too by means of 
	. . . . SET NEU=$REVERSE(PRICE)
	. . . . SET NEU=$EXTRACT(NEU,$LENGTH(ENDUNG)+1,9999)
	. . . . SET NEU=$REVERSE(NEU)_ENDUNG
	. . . . SET NEU=NEU+$PIECE(YFELD,Y,4)					;AUF/ABSCHLAG
	. . . . SET PRICE=NEU
	. . . . SET PRICE=$JUSTIFY(PRICE,0,2)
	. . . . SET OK=1
	. . . . QUIT
	. . . IF +$PIECE(YFELD,Y,5)'=0 IF $PIECE(YFELD,Y,3)="" DO            					;RUNDUNGSMERKER 	
	. . . . SET PRICE=$JUSTIFY(PRICE,0,0) 													;AUF VOLLE WÄHRUNGSEINHEIT RUNDEN ;upon 
	. . . . IF $PIECE(YFELD,Y,5)=2	IF PRICE>10 SET PRICE=$JUSTIFY(PRICE/10,0,0)*10 QUIT  	;AUF VOLLE 10 WÄHRUNGSEINHEIT RUNDEN ;upon 
	. . . . IF $PIECE(YFELD,Y,5)=4	IF PRICE>100 SET PRICE=$JUSTIFY(PRICE/100,0,0)*100 QUIT   					;AUF VOLLE 100 WÄHRUNGSEINHEIT RUNDEN ;upon 
	. . . . IF $PIECE(YFELD,Y,5)=5 IF PRICE>1000 SET PRICE=$JUSTIFY(PRICE/1000,0,0)*1000 QUIT   				;AUF VOLLE 1000 WÄHRUNGSEINHEIT RUNDEN  ;upon 
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT PRICE
]]></Routine>
</Export>