<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWURL" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWURL
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		URLAUBSLISTE
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 04-Jun-2010	GRF		SR17146: call "DD.MM.YYYY" wrapper for WWWDATE1 (DMY) &
	;							for WWWDATE (IntToDMY)
	; 04-Apr-2007	GRF		SR15492: Doco; naked references; quits; close <FONT>
	; 01-Jun-2005	RobertW	SR12056: Attempt at Performance Increase
	; 02.11.1999	DT
	;-------------------------------------------------------------------------------
	NEW KUEND,WW,MONAT,MIT,MITARB,ACCESS,RUECK,TAG,UTAG,RUTAG,SUMUTAG,ACC,YBEDCAL
	
	DO    ; BERECHTIGUNG FÜR URLAUB EINTRAGEN ;to holiday 
	. SET ACC=0
	. IF +$$^WWWBEDBER(YBED)=1 SET ACC=1  QUIT         ;BEDIENER IST ADMINISTRATOR
	. SET YA=$GET(^WWW004(0,"Time_Manager","10.",1))   ;ERFASSUNG URLAUB ;logging holiday 
	. IF $$^WWWACCESS($PIECE(YA,Y,3),$PIECE(YA,Y,4),YBED)=1 SET ACC=1   ;ZUGANG
	
	; FIXME : (1) MONAT is $horolog date here - commented code refers to DD/MM/YYYY or MM/DD/YYYY form
	IF '$DATA(VORG) DO
	. SET MONAT   = $PIECE(^WWWUSER(0,YUSER,1),Y,11)
	. IF MONAT="" SET MONAT = +$HOROLOG
	. SET VORG(1) = $$^WWWYEAR(MONAT)_"-"_$EXTRACT($$^WWWMONTH(MONAT)+100,2,3)   ; as YYYY-MM
	. SET VORG(2) = $PIECE(^WWWUSER(0,YUSER,1),Y,23)    ;ABTEILUNG ;speciality 
	. SET VORG(4) = $PIECE(^WWWUSER(0,YUSER,1),Y,24)    ;EX-MITARBEITER
	. ;W $$^WWWDATE(MONAT)
	. ;IF SPRACHE="DE"  SET VORG(1)=$EXTRACT(MONAT,7,10)_"-"_$EXTRACT(MONAT,4,5)
	. ;IF SPRACHE'="DE" SET VORG(1)=$EXTRACT(MONAT,7,10)_"-"_$EXTRACT(MONAT,1,2)
	
	; FIXME : (2) MONAT is literal date here - but is overwritten in (3) before used
	IF $DATA(VORG) DO
	. IF VORG(1)="" IF VORG(3)'="" DO  ;FIS, 01.05.2001
	. . SET VORG(3)=$TRANSLATE(VORG(3),"_/:,;","-----")
	. . IF '$FIND(VORG(3),"-") QUIT
	. . SET VORG(1)=VORG(3)
	. . IF ($PIECE(VORG(1),"-",2)>12) || ($PIECE(VORG(1),"-",2)<1) SET VORG(1)="" QUIT
	. . IF $LENGTH($PIECE(VORG(1),"-",1))=2 SET $PIECE(VORG(1),"-",1)=$EXTRACT($$^WWWYEAR(+$HOROLOG),1,2)_$PIECE(VORG(1),"-",1)
	. ;
	.;IF VORG(1)="" SET MONAT=$$^WWWDATE($HOROLOG) DO  ; SR17146 comment only
	. IF VORG(1)="" DO
	. . SET VORG(1)=$$^WWWYEAR(+$HOROLOG)_"-"_$EXTRACT($$^WWWMONTH(+$HOROLOG)+100,2,3)
	
	; FIXME : (3) MONAT is $horolog date here
	SET MONAT = $$DMY^WWWDATE1("15."_$PIECE(VORG(1),"-",2)_"."_$PIECE(VORG(1),"-",1))  ; SR17146
	SET $PIECE(^WWWUSER(0,YUSER,1),Y,11)=MONAT
	
	IF $DATA(VORG(2)) SET $PIECE(^WWWUSER(0,YUSER,1),Y,23)=VORG(2)     ;VORGABE ABTEILUNG ;default speciality 
	IF $DATA(VORG(4)) SET $PIECE(^WWWUSER(0,YUSER,1),Y,24)=VORG(4)     ;VORGABE EX-MITARBEITER ;default 
	;FOR WW=$EXTRACT($$^WWWDATE($HOROLOG),7,10):1:($EXTRACT($$^WWWDATE($HOROLOG),7,10)+1) DO   ; SR17146
	set intCurrentYear = $extract($$IntToDMY^WWWDATE($HOROLOG),7,10)
	FOR WW=intCurrentYear:1:(intCurrentYear+1) DO
	. FOR M=1:1:12 DO
	. . SET TEXT=$PIECE($$^WWWTEXT(30023),",",M)
	. . SET ^WWW101(0,"MONATE",SPRACHE,WW_"-"_$EXTRACT(M+100,2,3),1)=TEXT_" "_WW
	
	SET MITARB  = $GET(%(YQUERY,"MITARB"))
	SET YOPTION = $GET(%(YQUERY,"YOPTION"))
	IF YOPTION'="" SET VORG(1)=YOPTION
	SET YOPTION=""
	SET RUECK=$GET(%(YQUERY,"RUECK"))  ;RÜCKSPRUNG FORMULAR ;form 
	IF RUECK="" SET RUECK="WWWURL"
	SET ACCESS=$$^WWWACCESS($PIECE($GET(^WWW001(0,"WWWURL",1)),Y,2),$PIECE($GET(^WWW001(0,"WWWURL",1)),Y,5))   ;BERECHTIGUNGEN ZU LINK ;within 
	;SET ACCESS=0  ;TEST ;table-mat Test 
	IF ACCESS'=1 SET MITARB=YBED  ;NUR EIGENE TERMINE ;only 
	WRITE "</PRE>"
	
	DO
	. NEW YFORM
	. WRITE "<A HREF="
	. WRITE YAKTION_"EP=WWWFORM&amp;YFORM="_RUECK
	. DO ^WWWCGI
	. WRITE ">"
	. WRITE YCR,"<IMG SRC="_""""_YGIF_"hback.gif"_""""_" BORDER=0 TITLE="_""""_$$^WWWTEXT(99)_""""_">"  ;ZURÜCK ;retro-  ;back 
	. WRITE "</A>"
	. WRITE YCR
	
	WRITE "<FONT FACE=ARIAL>"
	SET MONA=$PIECE($GET(^WWW101(0,"MONATE",SPRACHE,$PIECE(VORG(1),"-",1)_"-"_$EXTRACT(($PIECE(VORG(1),"-",2)+100),2,3),1)),Y,1)    ;MONATSVORGABE
	SET MON=$PIECE(VORG(1),"-",2)
	SET JAH=$PIECE(VORG(1),"-",1)
	IF MONA="" SET MONA=MON_" - "_JAH   ;TEXT FÜR SEITE ;Text to side 
	SET A="312831303130313130313031"
	SET MENDE=$EXTRACT(A,2*MON-1,2*MON) IF JAH#4=0&(+MON=2) SET MENDE=29
	IF MITARB="" DO  ;WENN MONATSANZEIGE ;when 
	. DO
	. . WRITE "<A HREF="
	. . WRITE YAKTION_"EP=WWWMANU&amp;YEXEC=D|VOR^WWWURL&amp;YFORM=WWWURL"
	. . DO ^WWWCGI
	. . WRITE ">"
	. . WRITE YCR,"<IMG SRC="_""""_YGIF_"rev.gif"_""""_" BORDER=0 ></A>"
	. . WRITE YCR
	. . WRITE "<A HREF="
	. . WRITE YAKTION_"EP=WWWMANU&amp;YEXEC=D|NACH^WWWURL&amp;YFORM=WWWURL"
	. . DO ^WWWCGI
	. . WRITE ">"
	. . WRITE YCR,"<IMG SRC="_""""_YGIF_"for.gif"_""""_" BORDER=0 ></A>"
	
	IF MITARB'="" DO  ;WENN MONATSANZEIGE ;when 
	. DO
	. . WRITE "<A HREF="
	. . WRITE YAKTION_"EP=WWWMANU&amp;YEXEC=D|VORJ^WWWURL&amp;YFORM=WWWURL&amp;MITARB="_MITARB
	. . DO ^WWWCGI
	. . WRITE ">"
	. . WRITE YCR,"<IMG SRC="_""""_YGIF_"rev.gif"_""""_" BORDER=0 ></A>"
	. . WRITE YCR
	. . WRITE "<A HREF="
	. . WRITE YAKTION_"EP=WWWMANU&amp;YEXEC=D|NACHJ^WWWURL&amp;YFORM=WWWURL&amp;MITARB="_MITARB
	. . DO ^WWWCGI
	. . WRITE ">"
	. . WRITE YCR,"<IMG SRC="_""""_YGIF_"for.gif"_""""_" BORDER=0 ></A>"
	
	WRITE "<CENTER>"
	WRITE "<H3>"
	IF MITARB=""  WRITE $$^WWWTEXT(3171)_" "_MONA                                   ;TEXT = URLAUBSLISTE
	IF MITARB'="" WRITE $$^WWWTEXT(3171)_" "_$PIECE($GET(^WWW013(0,MITARB,1)),Y,1)  ;ALLE MONATE EINES MITARBEITERS
	WRITE "</H3>"
	
	;SUCHEN GRUPPE ;seek group 
	IF ACCESS=1 IF MITARB="" SET GRUPPE="" FOR  SET GRUPPE=$ORDER(^WWW013s(0,2,GRUPPE)) QUIT:GRUPPE=""  DO
	. QUIT:$TRANSLATE(GRUPPE," ")=""   ;KEINE GRUPPE = LEER ;no group void 
	. IF VORG(2)'="" QUIT:$$^WWWUMLAU(GRUPPE,1)'=$$^WWWUMLAU(VORG(2),1)
	. DO TABLE
	. WRITE YCR,"<BR>"
	
	;URLAUB DES MITARBEITERS ;holiday 
	IF MITARB'="" DO
	. DO TABLE1
	. WRITE YCR,"<BR>"
	
	QUIT
	
TABLE ;AUFLISTUNG NACH GRUPPE NUR DEN MONAT ;within group only month 
	SET MITGR=GRUPPE
	IF GRUPPE=" " SET MITGR=""
	SET YBEDCAL=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,54)  ;KALENDER BETRIEB ;calendar location 
	
	WRITE YCR,"<STYLE type='text/css'>"
	WRITE YCR," <!--"
	SET YI(1)="" FOR  SET YI(1)=$ORDER(^WWW101(0,"ABWESEND",SPRACHE,YI(1))) QUIT:YI(1)=""  IF $PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,YI(1),1)),Y,2)'="" WRITE YCR," a:hover."_YI(1)_" {background-color:"_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,YI(1),1)),Y,2),1)),Y,1)_";}"  ;FARBCODE AUS PARAMETER
	WRITE YCR," //-->"
	WRITE YCR,"</STYLE>",YCR
	
	DO START100^WWWTAB 
	WRITE "<TR>"
	WRITE "<TH BGCOLOR="_YDARKGRAY_" ALIGN=LEFT WIDTH=150>"
	WRITE "<FONT SIZE=1>"
	WRITE $$^WWWTEXT(3172)_": "_GRUPPE  ;ABTEILUNG GRUPPE ;speciality group 
	WRITE "<BR>"_$$^WWWTEXT(3173)  ;NAME
	WRITE "</FONT></TH>"                        ; SR15492
	
	FOR I=1:1:MENDE DO    ;ALLE TAGE DES MONATS ALS ÜBERSCHRIFT ;monthly when superscription 
	. WRITE YCR
	. WRITE "<TH"
	. SET COLOR=YDARKGRAY
	. SET YDATE = $$DMY^WWWDATE1($EXTRACT(100+I,2,3)_"."_$EXTRACT(100+MON,2,3)_"."_JAH)  ; SR17146
	. IF YDATE'=0 DO
	. . IF YBEDCAL=""  IF $DATA(^TERMIN9(0,SPRACHE,YDATE,1)) SET COLOR="LIGHTPINK" QUIT
	. . IF YBEDCAL=""  IF $$^WWWDAY(YDATE)>5                 SET COLOR="MISTYROSE"
	. . IF YBEDCAL'="" IF $$^WWWCALDAY(YDATE,YBEDCAL)=2      SET COLOR="LIGHTPINK" QUIT  ;KALENDER;FIS;21655 ;calendar 
	. . IF YBEDCAL'="" IF $$^WWWCALDAY(YDATE,YBEDCAL)'=0     SET COLOR="MISTYROSE"       ;KALENDER;FIS;21655 ;calendar 
	. ;
	. WRITE " BGCOLOR="_COLOR_" ALIGN=LEFT>"
	. WRITE "<FONT SIZE=1>"
	. WRITE $EXTRACT(100+I,2,3)
	. WRITE "<BR>"
	. SET A1=$$^WWWTEXT(30022) WRITE $EXTRACT($PIECE(A1,",",$$^WWWDAY(YDATE)),1,2)
	. WRITE "</FONT></TH>"                        ; SR15492
	
	WRITE "</TR>"
	
	;	D1		$$$WWW013Name()
	;	D35		$$$WWW013TerminationOn()
	;	D8		$$$WWW013EmployeeGroup()
	;	D54		$$$WWW013SocialSecRequested()
	;	D120	$$$WWW013CalendarDefault()
	;	
	;SUCHEN ALLE MITARBEITER DER GRUPPE NACH NAMEN ;seek the group within 
	SET NAM=""
	FOR  SET NAM=$ORDER(^WWW013s(0,1,NAM)) QUIT:NAM=""  SET MIT="" FOR  SET MIT=$ORDER(^WWW013s(0,1,NAM,MIT)) QUIT:MIT=""  DO
	. SET MITAR=$PIECE($GET(^WWW013(0,MIT,1)),Y,1)
	. SET KUEND=$PIECE($GET(^WWW013(0,MIT,1)),Y,35)
	. IF KUEND'="" IF +$GET(VORG(4))=0 IF +$HOROLOG>KUEND QUIT                 ;GEKUENDIGTE NICHT ANZEIGEN ;Don't display Terminated
	. QUIT:MITGR'=$$^WWWUMLAU($PIECE($GET(^WWW013(0,MIT,1)),Y,8),1)            ;NICHT IN GRUPPE ;Not within group 
	. SET YBEDCAL=$PIECE($GET(^WWW013(0,MIT,1)),Y,120)                         ;KALENDER DES MITARBEITERS;FIS;21655 ;calendar 
	. IF YBEDCAL="" SET YBEDCAL=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,54)  ;KALENDER BETRIEB ;calendar location 
	. ;
	. WRITE YCR,"<TR>"
	. WRITE "<TD NOWRAP ALIGN=LEFT WIDTH=150 BGCOLOR="_YGRAY_">"
	. WRITE "<FONT SIZE=1>"
	. WRITE "<A HREF="                                                         ;ÄNDERN MITARBEITERDATEN ;alter 
	. WRITE YAKTION_"EP=WWWMANU&amp;YEXEC=D|^WWWURL&amp;MITARB="_MIT_"&amp;YFORM=WWWURL"
	. SET YKEY=MIT
	. DO ^WWWCGI
	. WRITE ">"
	. IF KUEND'="" IF +$HOROLOG>KUEND WRITE "<FONT COLOR=RED>"
	. WRITE MITAR
	. IF KUEND'="" IF +$HOROLOG>KUEND WRITE "</FONT>"
	. WRITE "&nbsp;"
	. WRITE "</A>"
	. WRITE "</FONT></TD>"                        ; SR15492
	. ;
	. FOR TAG=1:1:MENDE DO   ;ALLE URLAUBSTAGE ODER ABWESENHEITEN
	. . WRITE YCR
	. . WRITE "<TD ALIGN=CENTER WIDTH=26 NOWRAP"
	. . SET SSN=0
	. . SET YDATE = $$DMY^WWWDATE1($EXTRACT(100+TAG,2,3)_"."_$EXTRACT(100+MON,2,3)_"."_JAH)  ; SR17146
	. . SET COLOR="WHITE"
	. . IF YDATE'="" DO
	. . . IF YBEDCAL=""  IF $DATA(^TERMIN9(0,SPRACHE,YDATE,1)) SET COLOR="LIGHTPINK" SET SSN=1 QUIT
	. . . IF YBEDCAL=""  IF $$^WWWDAY(YDATE)>5                 SET COLOR="MISTYROSE" SET SSN=1
	. . . IF YBEDCAL'="" IF $$^WWWCALDAY(YDATE,YBEDCAL)=2      SET COLOR="LIGHTPINK" SET SSN=1 QUIT  ;KALENDER;FIS;21655 ;calendar 
	. . . IF YBEDCAL'="" IF $$^WWWCALDAY(YDATE,YBEDCAL)'=0     SET COLOR="MISTYROSE" SET SSN=1       ;KALENDER;FIS;21655 ;calendar 
	. . ;
	. . SET JN=0
	. . IF YDATE'="" SET JN=+$PIECE($GET(^TERMIN(YM,MIT,YDATE,0,1)),Y,1)
	. . IF SSN'=1 IF $PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,JN,1)),Y,2)'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,JN,1)),Y,2),1)),Y,1)  ;FARBCODE AUS PARAMETER ;out of parameter 
	. . WRITE " BGCOLOR="_COLOR
	. . WRITE ">"
	. . WRITE "<FONT SIZE=1>"
	. . ;
	. . IF (COLOR="MISTYROSE")  || (COLOR="LIGHTPINK") WRITE "-"             ; SR15492 || / &&
	. . IF (COLOR'="MISTYROSE") && (COLOR'="LIGHTPINK") FOR YA=2,1,3 DO
	. . . IF YA'=2 QUIT:+JN'=0  ;!(SSN=1)
	. . . IF ACC=1 DO
	. . . . WRITE "<A"
	. . . . IF +JN=0 WRITE " CLASS="_""""_YA_""""
	. . . . WRITE " HREF="_""""
	. . . . IF $PIECE($GET(^INVORG(YM,YM,1)),Y,100)'=1 WRITE YAKTION_"EP=WWWMANU&amp;YEXEC=D|ONOFF^WWWURL&amp;YFORM=WWWURL"
	. . . . IF $PIECE($GET(^INVORG(YM,YM,1)),Y,100)=1 DO
	. . . . . WRITE "JavaScript:if (confirm('"
	. . . . . IF +JN=0 IF YA=2 WRITE $$^WWWTEXT(33053,,1)    ;URLAUB EINTRAGEN ;holiday 
	. . . . . IF +JN=0 IF YA=1 WRITE $$^WWWTEXT(33056,,1)    ;ABWESENHEIT EINTRAGEN ;absence 
	. . . . . IF +JN=0 IF YA=3 WRITE $$^WWWTEXT(33055,,1)    ;KRANKHEIT EINTRAGEN ;sickness 
	. . . . . IF +JN'=0        WRITE $$^WWWTEXT(33054,,1)    ;TERMIN LÖSCHEN ;Delete 
	. . . . . WRITE " ? ("_MITAR_": "_$$^WWWDATE(YDATE)_")"  ;(MITARBEITER: DATUM)
	. . . . . WRITE "')) window.location='"_YAKTION_"EP=WWWMANU&amp;YEXEC=D|ONOFF^WWWURL&amp;YFORM=WWWURL"
	. . . . ;
	. . . . SET YKEY=VORG(1)_","_MIT_","_YDATE_","_VORG(2)
	. . . . IF +JN=0 SET YKEY=YKEY_","_YA
	. . . . SET YBACK="WWWURL,"
	. . . . DO ^WWWCGI
	. . . . IF $PIECE($GET(^INVORG(YM,YM,1)),Y,100)=1 WRITE "'"
	. . . . WRITE """"
	. . . . IF +JN=0 WRITE " TITLE="_""""_$PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,YA,1)),Y,1)_""""
	. . . . WRITE ">"
	. . . ;
	. . . ;U=URLAUB,A=ABWESEND,K=KRANK,N=NICHTVERVÜGBAR...
	. . . ;IF SSN=1 WRITE "-&nbsp;"
	. . . ;IF SSN'=1 WRITE:+JN=1 " A " WRITE:+JN=2 " U " WRITE:+JN=3 " K " WRITE:+JN=4 " N " WRITE:+JN=0 "&nbsp;&nbsp;"
	. . . ;WRITE:+JN=1 " A " WRITE:+JN=2 " U " WRITE:+JN=3 " K " WRITE:+JN=4 " N "
	. . . IF +JN'=0  IF +JN'=4         WRITE "&nbsp;"_$EXTRACT($PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,JN,1)),Y,1),1)_"&nbsp;"              ;FAN  03.09.02
	. . . ;IF +JN'=0 IF +JN=4          WRITE "&nbsp;"_$$^WWWLOW($EXTRACT($PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,2,1)),Y,1)))_"&nbsp;"      ;ULM 26.11.2002 - HALBE URLAUBSTAGE
	. . . IF +JN'=0  IF +JN=4          WRITE "&nbsp;"_$zconvert($EXTRACT($PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,2,1)),Y,1)),"L")_"&nbsp;"  ;ULM 26.11.2002 - HALBE URLAUBSTAGE
	. . . IF +JN=0   IF SSN'=1!(YA'=2) WRITE "&nbsp;&nbsp;"
	. . . IF +JN=0    IF SSN=1&(YA=2)  WRITE "-&nbsp;"
	. . . IF ACC=1 WRITE "</A>"
	. . ;
	. . WRITE "</FONT></TD>"                        ; SR15492
	. WRITE "</TR>"
	
	WRITE "</TABLE>"
	WRITE "</CENTER>"
	QUIT
	
TABLE1 ;AUFLISTUNG DES MITARBEITERS GANZES JAHR ;year 
	NEW UTAG,MIT1,RUTAG
	SET UTAG=0
	SET RUTAG=0
	SET YBEDCAL=""
	IF MITARB'="" SET YBEDCAL=$PIECE($GET(^WWW013(0,MITARB,1)),Y,120)  ;KALENDER DES MITARBEITERS;FIS;21655 ;calendar 
	IF YBEDCAL="" SET YBEDCAL=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,54)  ;KALENDER BETRIEB ;calendar location 
	DO START100^WWWTAB 
	WRITE "<TR>"
	
	WRITE "<TH BGCOLOR="_YDARKGRAY_" ALIGN=RIGHT WIDTH=100>"
	WRITE "<FONT SIZE=1>"
	WRITE $$^WWWTEXT(16)  ;monat
	WRITE "</TH>"
	FOR I=1:1:31 DO    ;ALLE TAGE 
	. WRITE "<TH"
	. WRITE " ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	. WRITE "<FONT SIZE=1>"
	. WRITE $EXTRACT(100+I,2,3)
	. WRITE "</FONT></TH>"                        ; SR15492
	
	WRITE "</TR>"
	
	;Monate
	FOR MON=1:1:12 DO
	.;SET MONA  = JAH_"-"_$EXTRACT(100+MON,2,3)   ;TEXT FÜR SEITE
	. SET MONA  = $PIECE($GET(^WWW101(0,"MONAT",SPRACHE,MON,1)),Y,1)   ;FAN;23397;18.08.2003; 
	. SET MONA  = MONA_" "_JAH   ;MONATSTEXT   ; "MMM YYYY"
	. SET A     = "312831303130313130313031"
	. SET MENDE = $EXTRACT(A,2*MON-1,2*MON) IF JAH#4=0&(+MON=2) SET MENDE=29
	. SET MIT1  = $GET(^WWW013(0,MITARB,1))
	. SET MITAR = $PIECE(MIT1,Y,1)
	. WRITE YCR,"<TR>"
	. WRITE "<TD NOWRAP ALIGN=RIGHT WIDTH=100 BGCOLOR="_YGRAY_">"
	. WRITE "<FONT SIZE=1>"
	. IF ACCESS=1 DO
	. . WRITE "<A HREF="    ;ÄNDERN MITARBEITERDATEN ;alter 
	. . WRITE YAKTION_"EP=WWWMANU&amp;YEXEC=D|^WWWURL&amp;MITARB=&amp;YFORM=WWWURL"
	. . SET YOPTION=JAH_"-"_$EXTRACT(100+MON,2,3)
	. . SET YBACK="WWWURL,"
	. . DO ^WWWCGI
	. . WRITE ">"
	. WRITE MONA
	. WRITE "&nbsp;"
	. IF ACCESS=1 WRITE "</A>"
	. WRITE "</FONT></TD>"                        ; SR15492
	. ;
	. FOR TAG=1:1:MENDE DO   ;ALLE URLAUBSTAGE ODER ABWESENHEITEN
	. . WRITE YCR
	. . WRITE "<TD ALIGN=LEFT WIDTH=26"
	. . SET SSN=0
	. . SET YDATE = $$DMY^WWWDATE1($EXTRACT(100+TAG,2,3)_"."_$EXTRACT(100+MON,2,3)_"."_JAH)  ; SR17146
	. . SET COLOR="WHITE"
	. . IF YDATE'="" DO
	. . . IF $DATA(^TERMIN9(0,SPRACHE,YDATE,1))                 SET COLOR="LIGHTPINK" SET SSN=1 QUIT
	. . . IF $GET(YBEDCAL)'="" IF $$^WWWCALDAY(YDATE,YBEDCAL)=2 SET COLOR="LIGHTPINK" SET SSN=1  ;KALENDER;FIS;21655 ;calendar 
	. . ;
	. . IF $GET(YBEDCAL)=""  IF $$^WWWDAY(YDATE)>5             SET COLOR="MISTYROSE" SET SSN=1
	. . IF $GET(YBEDCAL)'="" IF $$^WWWCALDAY(YDATE,YBEDCAL)'=0 SET COLOR="MISTYROSE" SET SSN=1  ;KALENDER;FIS;21655 ;calendar 
	. . SET JN=0
	. . IF YDATE'="" SET JN=+$PIECE($GET(^TERMIN(YM,MITARB,YDATE,0,1)),Y,1)
	. . IF SSN'=1 IF $PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,JN,1)),Y,2)'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,JN,1)),Y,2),1)),Y,1)  ;FARBCODE AUS PARAMETER ;out of parameter 
	. . WRITE " BGCOLOR="_COLOR
	. . WRITE ">"
	. . WRITE "<FONT SIZE=1>"
	. . ;WRITE "<A HREF="   ;NUR ANZEIGE, DA AUFRUF AUCH DURCH MITARBETER MÖGLICH SEIN SOLL
	. . ;;WRITE YAKTION_"EP=WWWFORM&YFORM=WWWURL1
	. . ;WRITE YAKTION_"EP=WWWMANU&YEXEC=D|ONOFF^WWWURL&YFORM=WWWURL&MITARB="_MITARB
	. . ;SET YKEY=VORG(1)_","_MITARB_","_YDATE_","_VORG(2)
	. . ;SET YBACK="WWWURL,"
	. . ;DO ^WWWCGI
	. . ;WRITE ">"
	. . WRITE "&nbsp;"
	. . ;U=URLAUB,A=ABWESEND,K=KRANK,N=NICHTVERVÜGBAR...
	. . ;IF SSN'=1 WRITE:+JN=1 "A" WRITE:+JN=2 "U" WRITE:+JN=3 "K" WRITE:+JN=4 "N"
	. . IF +JN'=0  IF +JN'=4 WRITE "&nbsp;"_$EXTRACT($PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,JN,1)),Y,1),1)_"&nbsp;"              ;FAN  03.09.02
	. . ;IF +JN'=0 IF +JN=4  WRITE "&nbsp;"_$$^WWWLOW($EXTRACT($PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,2,1)),Y,1)))_"&nbsp;"      ;ULM 26.11.2002 - HALBE URLAUBSTAGE
	. . IF +JN'=0  IF +JN=4  WRITE "&nbsp;"_$zconvert($EXTRACT($PIECE($GET(^WWW101(0,"ABWESEND",SPRACHE,2,1)),Y,1)),"L")_"&nbsp;"  ;ULM 26.11.2002 - HALBE URLAUBSTAGE
	. . IF SSN=1   IF +JN=0  WRITE "-&nbsp;"
	. . IF SSN=0   IF +JN=0  WRITE "&nbsp;&nbsp;"
	. . WRITE "&nbsp;"
	. . ;WRITE "</A>"
	. . WRITE "</FONT></TD>"                        ; SR15492
	. ;
	. WRITE "</TR>"
	
	WRITE "</TABLE>",YCR
	WRITE "<BR><BR>"
	DO WWW013URL
	DO URLTAG
	WRITE "</CENTER>"
	QUIT
	
WWW013URL     ;MITARBEITER URLAUB DATEI   FAN    23.09.02   ;holiday data file buff 
	NEW LFDJAH,ERSTJAH,TAG
	
	IF $PIECE(MIT1,Y,70)=""  KILL ^WWW013URL(0,MITARB) QUIT   ;URLAUBS TAG
	IF $PIECE(MIT1,Y,102)="" KILL ^WWW013URL(0,MITARB) QUIT   ;Urlaubstage 1. Abrechnungsjahr  
	SET ERSTJAH=$PIECE(MIT1,Y,103)
	IF ERSTJAH=""  IF $PIECE(MIT1,Y,34)'="" SET ERSTJAH=$$^WWWYEAR($PIECE(MIT1,Y,34))
	IF ERSTJAH'="" IF $PIECE(MIT1,Y,34)'="" IF ERSTJAH<$$^WWWYEAR($PIECE(MIT1,Y,34)) SET ERSTJAH=$$^WWWYEAR($PIECE(MIT1,Y,34))
	IF +ERSTJAH=0 SET ERSTJAH=$$^WWWYEAR($HOROLOG)  ;TYBD;2..5.2003
	IF ERSTJAH="" KILL ^WWW013URL(0,MITARB) QUIT
	SET YVAR=ERSTJAH
	FOR  SET YVAR=$ORDER(^WWW013URL(0,MITARB,YVAR),-1) QUIT:YVAR=""  DO
	. KILL ^WWW013URL(0,MITARB,YVAR)
	
	DO
	. QUIT:$PIECE(MIT1,Y,102)="" 
	. SET ^WWW013URL(0,MITARB,ERSTJAH,1)=+$PIECE(MIT1,Y,102)
	
	IF $DATA(^WWW013URL(0,MITARB,ERSTJAH,1)) DO  
	. FOR LFDJAH=ERSTJAH:1:JAH DO
	. . NEW SATZ
	. . SET $PIECE(SATZ,Y,1)=$PIECE(MIT1,Y,70)
	. . IF $DATA(^WWW013URL(0,MITARB,LFDJAH,1)) DO
	. . . SET $PIECE(SATZ,Y,1) =  $PIECE($GET(^WWW013URL(0,MITARB,LFDJAH,1)),Y,1)
	. . . SET $PIECE(SATZ,Y,6) = +$PIECE($GET(^WWW013URL(0,MITARB,LFDJAH,1)),Y,6)  ; SR15492 Naked Ref
	. . SET $PIECE(SATZ,Y,3)=0
	. . IF $DATA(^WWW013URL(0,MITARB,(LFDJAH-1),1)) DO
	. . . SET $PIECE(SATZ,Y,3) = $PIECE($GET(^WWW013URL(0,MITARB,(LFDJAH-1),1)),Y,5)-$PIECE(SATZ,Y,6)    ;REST LETZT JAHR ;residue year   ; SR15492 Naked Ref
	. . SET $PIECE(SATZ,Y,4)=0
	. . NEW TAGVON,TAGBIS
	. . SET TAGVON = $$DMY^WWWDATE1("01.01."_LFDJAH)   ; SR17146
	. . SET TAGBIS = $$DMY^WWWDATE1("31.12."_LFDJAH)   ; SR17146
	. . FOR TAG=TAGVON:1:TAGBIS DO
	. . . IF ($PIECE($GET(^TERMIN(YM,MITARB,TAG,0,1)),Y,1)'=2) || ($PIECE($GET(^TERMIN(YM,MITARB,TAG,0,1)),Y,1)'=4) DO
	. . . . IF $$^WWWCALDAY(TAG,$PIECE(MIT1,Y,120),1)'=0 QUIT  ;25452;30.03.04;FIS;KEIN ARBEITSTAG
	. . . . IF $PIECE($GET(^TERMIN(YM,MITARB,TAG,0,1)),Y,1)=2 SET $PIECE(SATZ,Y,4)=$PIECE(SATZ,Y,4)+1  ;GANZE URLAUBSTAGE
	. . . . IF $PIECE($GET(^TERMIN(YM,MITARB,TAG,0,1)),Y,1)=4 SET $PIECE(SATZ,Y,4)=($PIECE(SATZ,Y,4)+0.5)  ;HALBE URLAUBSTAGE ;pint 
	. . ;
	. . SET $PIECE(SATZ,Y,5)=$PIECE(SATZ,Y,1)+$PIECE(SATZ,Y,3)-$PIECE(SATZ,Y,4)
	. . SET ^WWW013URL(0,MITARB,LFDJAH,1)=SATZ
	
	QUIT
	
START      ;VON FORMULAR "MITARBEIT URLAUBS DATEI" ^WWW013URL 
	NEW JAH,MIT1,MITARB
	QUIT:$PIECE(YKEY,",",1)=""
	
	SET MITARB=$PIECE(YKEY,",",1)
	SET JAH=$$^WWWYEAR(+$HOROLOG)
	SET MIT1=$GET(^WWW013(0,MITARB,1))
	DO WWW013URL
	QUIT
	
URLTAG ; URLAUBTAG RECHNEN    FAN 12.09.02 ;have faith in buff 
	QUIT:'$DATA(^WWW013URL(0,MITARB,JAH,1))
	
	SET YFELD=$GET(^WWW013URL(0,MITARB,JAH,1))   ; SR15492 Naked Ref
	DO START0^WWWTAB 
	
	DO NL^WWWTAB
	DO NF^WWWTAB
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(33138)_" : "           ;"Urlaubsanspruch lfd. Jahr "
	WRITE "&nbsp;"
	WRITE "</FONT>"
	DO ZWR^WWWTAB
	WRITE "<FONT SIZE=2>"
	WRITE +$PIECE(YFELD,Y,1)
	WRITE " "_$$^WWWTEXT(32283)_"&nbsp;"
	WRITE "</FONT>"
	DO EF^WWWTAB
	DO EL^WWWTAB
	
	DO NL^WWWTAB
	DO NF^WWWTAB
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(33139)_" : "           ;"Resturlaub Vorjahr "
	WRITE "&nbsp;"
	WRITE "</FONT>"
	DO ZWR^WWWTAB
	WRITE "<FONT SIZE=2>"
	WRITE +$PIECE(YFELD,Y,3)
	WRITE " "_$$^WWWTEXT(32283)_"&nbsp;"
	WRITE "</FONT>"
	DO EF^WWWTAB
	DO EL^WWWTAB
	
	DO NL^WWWTAB
	DO NF^WWWTAB
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(33140)_" : "           ;"genommen im lfd. Jahr"
	WRITE "&nbsp;"
	WRITE "</FONT>"
	DO ZWR^WWWTAB
	WRITE "<FONT SIZE=2>"
	WRITE +$PIECE(YFELD,Y,4)
	WRITE " "_$$^WWWTEXT(32283)_"&nbsp;"
	WRITE "</FONT>"
	DO EF^WWWTAB
	DO EL^WWWTAB
	
	DO NL^WWWTAB
	DO NF^WWWTAB
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(33141)_" : "           ;"Resturlaub lfd. Jahr "
	WRITE "&nbsp;"
	WRITE "</FONT>"
	DO ZWR^WWWTAB
	WRITE "<FONT SIZE=2>"
	WRITE +$PIECE(YFELD,Y,5)
	WRITE " "_$$^WWWTEXT(32283)_"&nbsp;"
	WRITE "</FONT>"
	DO EF^WWWTAB
	DO EL^WWWTAB
	
	DO STOP^WWWTAB  
	QUIT
	
ONOFF ;EIN UND AUSSCHALTEN URLAUBSTAG ;uni- And eliminate 
	SET YKEY=$GET(%(YQUERY,"YKEY"))
	IF YKEY'="" DO
	. SET VORG(1)=$PIECE(YKEY,",",1)
	. SET MIT=$PIECE(YKEY,",",2)
	. SET TAG=$PIECE(YKEY,",",3)
	. SET VORG(2)=$PIECE(YKEY,",",4)
	. QUIT:MIT=""
	. QUIT:TAG=""
	. SET JN=$PIECE($GET(^TERMIN(YM,MIT,TAG,0,1)),Y,1)
	. IF +$PIECE(YKEY,",",5)'=0 SET $PIECE(^TERMIN(YM,MIT,TAG,0,1),Y,1)=$PIECE(YKEY,",",5) QUIT  ;KRANK/URLAUB/ABWESEND
	. IF +JN=0                  SET $PIECE(^TERMIN(YM,MIT,TAG,0,1),Y,1)=2                  QUIT  ;URLAUB ="  ;DFLT
	. SET $PIECE(^TERMIN(YM,MIT,TAG,0,1),Y,1)=0
	
	DO WWWURL  ;ANZEIGEN ;give notice  ;display 
	QUIT
	
VOR      ;VOR EIN MONATE ;pre- uni- 
	KILL VORG
	SET MONAT=$PIECE(^WWWUSER(0,YUSER,1),Y,11)
	SET $PIECE(^WWWUSER(0,YUSER,1),Y,11)=MONAT-$$^WWWMONTHDAYS(MONAT)
	DO WWWURL
	QUIT
	
NACH ;NACH EIN MONATE ;within uni- 
	KILL VORG
	SET MONAT=$PIECE(^WWWUSER(0,YUSER,1),Y,11)
	SET $PIECE(^WWWUSER(0,YUSER,1),Y,11)=MONAT+$$^WWWMONTHDAYS(MONAT)
	DO WWWURL
	QUIT
	
VORJ      ;VOR EIN MONATE ;pre- uni- 
	KILL VORG
	SET MONAT=$PIECE(^WWWUSER(0,YUSER,1),Y,11)
	SET $PIECE(^WWWUSER(0,YUSER,1),Y,11)=MONAT-365
	DO WWWURL
	QUIT
	
NACHJ ;NACH EIN MONATE ;within uni- 
	KILL VORG
	SET MONAT=$PIECE(^WWWUSER(0,YUSER,1),Y,11)
	SET $PIECE(^WWWUSER(0,YUSER,1),Y,11)=MONAT+365
	DO WWWURL
	QUIT
	
D103   ;Urlaub rechnen ab Jahr   ;holiday have faith in From Year 
	QUIT:$GET(YINHALT)=""
	IF $GET(YINHALT)<1900 SET %TXT(1)="§"_$$^WWWTEXT(32292,,1)    ;BITTE PRÜFEN ;please check 
	QUIT
	
]]></Routine>
</Export>