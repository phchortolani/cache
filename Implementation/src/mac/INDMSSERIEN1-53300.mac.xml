<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDMSSERIEN1" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INDMSSERIEN1(BRIEF) ;INDMSSERIEN1;FAN;DRUCKEN SERIENBRIEFE ;13.06.2003
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		DRUCKEN SERIENBRIEFE 
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FAN	13.06.2003
	;|
	;\------------------------------------------------------------------/
	;
	NEW ADR,ADR1,FONT,SIZE,VORG,ANZ
	QUIT:$GET(BRIEF)=""   ;WELCHEN BRIEF ;letter 
	SET BRIEF1=$GET(^INBRIEF(YM,BRIEF,1))
	QUIT:BRIEF1=""
	SET YLAYOUT=$PIECE(BRIEF1,Y,25)           ;---------PARAMETER  ;FAN;17.02.04;24294
	IF YLAYOUT="" SET YLAYOUT1="NORM"_Y_7_Y_53_Y_83_Y_1_Y_1_Y_1_Y_1_Y_1  ;WENN NICHT ANGELEGT ODER FALSCH ;when Not Or wrong 
	IF YLAYOUT'="" SET YLAYOUT1=$GET(^INDMSLAYOUT(YM,YLAYOUT,1))  
	IF $GET(YLAYOUT1)="" SET YLAYOUT1="NORM"_Y_7_Y_53_Y_83_Y_1_Y_1_Y_1_Y_1_Y_1  ;WENN NICHT ANGELEGT ODER FALSCH ;when Not Or wrong 
	IF $PIECE(YLAYOUT1,Y,6)="" SET $PIECE(YLAYOUT1,Y,6)=1
	IF $PIECE(YLAYOUT1,Y,7)="" SET $PIECE(YLAYOUT1,Y,7)=1
	IF $PIECE(YLAYOUT1,Y,8)="" SET $PIECE(YLAYOUT1,Y,8)=1
	IF $PIECE(YLAYOUT1,Y,9)="" SET $PIECE(YLAYOUT1,Y,9)=1
	IF +$PIECE(YLAYOUT1,Y,6)<0!(+$PIECE(YLAYOUT1,Y,6)>20) SET $PIECE(YLAYOUT1,Y,6)=1   ;Anzahl Zeilen von Adresse bis Betreff   ;Number from address To Subject 
	IF +$PIECE(YLAYOUT1,Y,7)<0!(+$PIECE(YLAYOUT1,Y,7)>20) SET $PIECE(YLAYOUT1,Y,7)=1   ;Anzahl Zeilen von BETREFF bis ANREDE  ;Number from To salutation 
	IF +$PIECE(YLAYOUT1,Y,8)<0!(+$PIECE(YLAYOUT1,Y,8)>20) SET $PIECE(YLAYOUT1,Y,8)=1   ;Anzahl Zeilen von ANREDE bis BERIEF ;Number from salutation To 
	IF +$PIECE(YLAYOUT1,Y,9)<0!(+$PIECE(YLAYOUT1,Y,9)>20) SET $PIECE(YLAYOUT1,Y,9)=1   ;Anzahl Zeilen von berief bis unterschrift ;Number from To 
	;SET VORG(1)=BRIEF   ;FORMBRIEFNR ;table-mat 
	;SET VORG(2)=1       ;VERSANDART  1 DRUCKEN  ;table-mat print 
	;SET VORG(3)=""      ;BRIEFGANZINHALT
	;SET VORG(4)=""      ;NICHT VORSCHAU
	;SET VORG(5)=""      ;ONHE ANLAGE
	SET VORG(6)=$PIECE(BRIEF1,Y,21)   ;UNTERSCHRIFT MITARBEITER ;signature 
	SET VORG(7)=$PIECE(BRIEF1,Y,20)   ;UNTERSCHRIFT JA/NEIN ;signature 
	;DO ^WWWSTART()
	DO ^WWWBACK
	IF YFORM'="INBRIEF" DO
	. WRITE YCR
	. WRITE "<style media="_""""_"print"_""""_">"
	. WRITE YCR
	. WRITE " .noprint { display:none; }"
	. WRITE YCR
	. WRITE "</style>"
	. WRITE YCR
	. WRITE "<div class="_""""_"noprint"_""""_">"
	. WRITE YCR
	. WRITE "<br>"
	. SET ANZ=+$GET(^WWWSOR("A"_YUSER,"YI(9)"))
	. WRITE ANZ
	. IF ANZ>1 WRITE " "_$$^WWWTEXT(33802)   ; XXX DATENSÄTZE WERDEN GELISTET ;will 
	. IF ANZ<2 WRITE " "_$$^WWWTEXT(33810)   ; 1 DATENSATZ WIRD GELISTET ;data record 
	. WRITE YCR,"<br><br>"
	. WRITE YCR
	. WRITE "<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=DO|^INDMSADRLPRINT&YFORM="_YFORM
	. DO ^WWWCGI
	. WRITE """"_" TITLE="""_$$^WWWTEXT(33803)_""" TARGET=TEILEFRAME2>"   ; ADRESSEN   ; DRUCKAUFBEREITUNG GELISTETE ADRESSEN
	. WRITE $$^WWWTEXT(33803)
	. WRITE "</A>"
	. WRITE YCR
	. WRITE "<br><br>"
	. DO ^INDMSADRLPRINT   ; ANZEIGE DER LISTE ;Show the list 
	. WRITE "<br>"
	. WRITE YCR
	. WRITE "</DIV>"
	. WRITE YCR,"<br>"
	. DO BELEG
	. QUIT
	IF YFORM="INBRIEF" DO      ;17.02.2004;FAN; ;buff 
	. KILL ^WWWSOR(YUSER)
	. SET ^WWWSOR(YUSER,"9999")="Firma"_Y_"Musterkunden OHG"_Y_"Musterweg 15"_Y_" "_Y_"12345 Musterstadt"_Y_"Musterland"
	. SET VORG(6)=$PIECE(BRIEF1,Y,21)
	. SET VORG(7)=$PIECE(BRIEF1,Y,20)
	. DO START1000^WWWTAB   ;OHNE RAHMEN ;without framework 
	. DO BELEG
	. KILL ^WWWSOR(YUSER)
	. QUIT
	SET YNOFOOT=1   ;==> KEINE FUSSNOTE
	DO ^WWWSTOP
	QUIT
	
BELEG ;DRUCKEN BELEGE ;print 
	SET ADR="99" FOR  SET ADR=$ORDER(^WWWSOR(YUSER,ADR)) QUIT:ADR=""  DO
	. SET ADR1=$GET(^WWWSOR(YUSER,ADR))
	. DO KOPF($PIECE(BRIEF1,Y,10))   ;BRIEFKOPF ;letterhead 
	. DO ANSCHR
	. DO BETREFF
	. DO ANREDE
	. DO BRIEF
	. DO UNTER($GET(VORG(6)))
	. DO FF^WWWW()
	. QUIT
	QUIT
	
KOPF(GIF)  ;DRUCKT DEN BRIEFKOPF ;letterhead 
	NEW YFAUS
	SET YFAUS="RIGHT"
	IF $PIECE(BRIEF1,Y,26)'="" DO      ;BEC;25632;10.05.04;VARABLE GIF GRÖSSE UND POSITION
	. IF $PIECE(BRIEF1,Y,26)=1 SET YFAUS="LEFT"
	. IF $PIECE(BRIEF1,Y,26)=2 SET YFAUS="CENTER"
	. IF $PIECE(BRIEF1,Y,26)=3 SET YFAUS="RIGHT"
	. QUIT
	WRITE "<BODY bgcolor="_YWHITE_" topmargin=1 leftmargin=1>"_YCR
	SET FONT=$PIECE(BRIEF1,Y,11)
	SET SIZE=$PIECE(BRIEF1,Y,12)
	IF SIZE="" SET SIZE=3
	IF FONT'="" SET FONT=$PIECE($GET(^WWW100(0,"SCHRIFTART",SPRACHE,FONT,1)),Y,1)
	IF FONT="" SET FONT="Times New Roman"
	;WRITE "<font size="_""""_SIZE_""""_" face="_""""_FONT_""""_">"_YCR
	QUIT:GIF=""
	;IF GIF'="" SET VORG(15)=1  ;WENN GIF ALS HEADER DANN KEINE LEERZEILEN
	;WRITE YCR_"<DIV ALIGN=RIGHT>"_"<IMG SRC="_YGIF1_GIF_">"_"</DIV>"_YCR  ;BEC;25632;10.05.04;VARABLE GIF GRÖSSE UND POSITION
	WRITE YCR_"<DIV ALIGN="_YFAUS_">"_YCR
	WRITE "<IMG SRC="_YGIF1_GIF
	IF $PIECE(BRIEF1,Y,27)'="" WRITE "  height="_+$PIECE(BRIEF1,Y,27)      ;HEIGTH IN PX ;within 
	WRITE ">"
	WRITE "</DIV>"_YCR
	QUIT
	
ANSCHR  ;ANSCHRIFT
	NEW I
	WRITE "<font size="_""""_3_""""_" face="_""""_"Arial"_""""_">"_YCR
	DO
	. NEW YII
	. FOR YII=1:1:(+$PIECE(YLAYOUT1,Y,2)+1) DO           ;Anzahl Zeilen BIS ADRESSE ;FAN;17.02.04;24294
	. . WRITE "<BR>",YCR
	. . QUIT
	. QUIT
	WRITE "</FONT>",YCR
	WRITE "<font size="_""""_SIZE_""""_" face="_""""_FONT_""""_">"_YCR
	FOR I=1:1:$LENGTH(ADR1,Y) DO     ;FAN;17.02.04;24294 ;buff 
	. QUIT:I=99   ;ANREDE ;salutation 
	. QUIT:$PIECE(ADR1,Y,I)=""
	. WRITE $EXTRACT($PIECE(ADR1,Y,I),1,36)
	. IF $LENGTH($PIECE(ADR1,Y,I))>37 WRITE "."
	. WRITE "<BR>"
	. WRITE YCR
	. QUIT
	WRITE "</font>",YCR
	QUIT
	
BETREFF   ;BETREFF DES BRIEFES
	NEW YI,YDATE
	DO
	. NEW YII
	. FOR YII=1:1:(+$PIECE(YLAYOUT1,Y,6)) DO           ;Anzahl Zeilen VON ADRESSE BIS BEREFF ;FAN;17.02.04;24294
	. . WRITE "<BR>",YCR
	. . QUIT
	. QUIT
	WRITE "<TABLE BORDER=0 CELLSPACING=0  WIDTH=90%>",YCR
	WRITE "<TR>"
	WRITE "<TD ALIGN=RIGHT WIDTH=100%>"
	DO
	. IF $PIECE($GET(^INUSER(YM,YBED,1)),Y,35)'="" SET YDATE=$PIECE($GET(^INUSER(YM,YBED,1)),Y,35) QUIT   ;WEM;24999;27.01.2004;VARIABLES DATUM FÜR BRIEFKOPF
	. SET YDATE=+$HOROLOG
	. QUIT
	WRITE "<font size="_""""_SIZE_""""_" face="_""""_FONT_""""_">"_YCR
	WRITE $$^WWWDATE(YDATE)   ;DATUM ;Date  ;Date Date 
	WRITE "</FONT>",YCR
	WRITE "</TD>"
	WRITE "</TR>",YCR
	WRITE "<TR>"
	WRITE "<TD ALIGN=LEFT>",YCR
	WRITE "<B>"
	WRITE "<font size="_""""_SIZE_""""_" face="_""""_FONT_""""_">"_YCR
	WRITE YCR
	FOR YI=1:1 QUIT:$PIECE($PIECE(BRIEF1,Y,2),"|",YI,900)=""  DO
	. WRITE $PIECE($PIECE(BRIEF1,Y,2),"|",YI)
	. WRITE "<BR>"
	. WRITE YCR
	. QUIT
	WRITE "</font>",YCR
	WRITE "</B>",YCR
	WRITE YCR
	WRITE "</TD>"
	WRITE "<TD ALIGN=LEFT WIDTH=15%>",YCR
	WRITE "</TD>"
	WRITE "</TR>"
	WRITE YCR
	WRITE "</TABLE>"
	QUIT
	
ANREDE   ;BRIEFTEXT
	NEW ANREDE
	DO
	. NEW YII
	. FOR YII=1:1:(+$PIECE(YLAYOUT1,Y,7)) DO           ;Anzahl Zeilen VON BETREFF BIS ANREDE ;FAN;17.02.04;24294
	. . WRITE "<BR>",YCR
	. . QUIT
	. QUIT
	SET ANREDE=$PIECE(ADR1,Y,99)
	IF $TRANSLATE(ANREDE," |")="" SET ANREDE=$$^WWWTEXT(33035)  ;SEHR GEHRTE DAMEN UND HERREN ;very much And 
	WRITE "<font size="_""""_SIZE_""""_" face="_""""_FONT_""""_">"_YCR
	WRITE ANREDE
	WRITE "</font>",YCR
	DO
	. NEW YII
	. FOR YII=1:1:(+$PIECE(YLAYOUT1,Y,8)+1) DO           ;Anzahl Zeilen BIS ADRESSE ;FAN;17.02.04;24294
	. . WRITE "<BR>",YCR
	. . QUIT
	. QUIT
	QUIT
	
BRIEF   ;BRIEFNUMMER
	NEW YI,TEXT,BRIEFTEXT
	SET BRIEFTEXT=$PIECE(BRIEF1,Y,5)
	WRITE YCR
	WRITE "<TABLE CELLSPACING=0 BORDER=0 WIDTH=100%>"
	WRITE "<TR>",YCR
	WRITE "<TD ALIGN=LEFT WIDTH=100%>"
	WRITE "<font size="_""""_SIZE_""""_" face="_""""_FONT_""""_">"_YCR
	FOR YI=1:1 QUIT:$PIECE(BRIEFTEXT,"|",YI,900)=""  DO
	. SET TEXT=$PIECE(BRIEFTEXT,"|",YI)
	. WRITE TEXT
	. WRITE "<BR>"
	. WRITE YCR
	. QUIT
	WRITE "</font>",YCR
	WRITE YCR
	WRITE "</TD>"
	WRITE "</TR>"
	WRITE YCR
	WRITE "</TABLE>",YCR
	QUIT
	
UNTER(MIT)   ;UNTERSCHRIFT ;signature 
	IF VORG(7)'=1 WRITE "</BODY>" QUIT
	IF MIT="" SET MIT=YBED
	DO
	. NEW YII
	. FOR YII=1:1:(+$PIECE(YLAYOUT1,Y,9)+1) DO           ;Anzahl Zeilen VON TEXT BIS UNTERSCHRIFT ;FAN;17.02.04;24294
	. . WRITE "<BR>",YCR
	. . QUIT
	. QUIT
	WRITE "<font size="_""""_SIZE_""""_" face="_""""_FONT_""""_">"_YCR
	WRITE YCR
	IF $PIECE($GET(^WWW013(0,MIT,1)),Y,58)'="" WRITE $PIECE($GET(^WWW013(0,MIT,1)),Y,58)_" "
	IF '$FIND($PIECE($GET(^WWW013(0,MIT,1)),Y,1),",") DO
	. WRITE $PIECE($GET(^WWW013(0,MIT,1)),Y,1)
	. QUIT
	IF $FIND($PIECE($GET(^WWW013(0,MIT,1)),Y,1),",") DO
	. WRITE $PIECE($PIECE($GET(^WWW013(0,MIT,1)),Y,1),",",2,99)
	. WRITE " "
	. WRITE $PIECE($PIECE($GET(^WWW013(0,MIT,1)),Y,1),",",1)
	. QUIT
	WRITE YCR,YCR
	WRITE "</font>",YCR  
	WRITE "</BODY>"     
	QUIT
]]></Routine>
</Export>