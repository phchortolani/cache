<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDRUCKEDI6" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INDRUCKEDI6 ;INDRUCKEDI6;DT;DRUCKEN POSITIONEN EDI;19.06.2002  ; Compiled February 9, 2005 11:21:11
#include INConst
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		DRUCKEN POSITIONEN EDI
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| 06-Jan-2006		PO			SR14152: For customer invoice, only invoice if not sourced
	;|  3-Aug-2005		JW			SR12988: Don't include special surcharge as an additional charge
	;| DT	19.06.2002  
	;\------------------------------------------------------------------/
	NEW POS,MWST,LAND,YA,YSPE,YI,TEIL,TIEFE,YEKK,A,UAN,UAUS,BLANKS,DATUM,GESAMTPZ,POSSUM,POSGRUP
	
	SET YTAB=$EXTRACT("                                                                           ",1,+$PIECE(YBELEG1,Y,39))  ;IN SPALTE ;within rift 
	SET YSPE="",$PIECE(YSPE," ",80)=""
	;YBELEG1
	SET GESAMT=0  ;GESAMTBETRAG
	KILL MWPO  ;STEUERSUMMEN
	SET SUMME=0
	SET YINKLMWST=$GET(YINKLMWST)  ;WENN 1 DANN IMMER IMKL MWST ;when constantly Tax 
	SET POSSUM=0  ;ZWISCHENSUMME POSITIONSGRUPPEN ;subtotal 
	IF +$PIECE(YBELEG1,Y,73)=0 SET $PIECE(YBELEG1,Y,73)=50  ;POSITIONSTEXTPARAMETER
	;AUFTRAG ODER TEILZAHLUNGSRECHNUNGEN ;order Or 
	IF $GET(YPROFORMA)="" IF YBELEG'=1 IF YBELEG'=10 IF $ORDER(YAUFTRAG(""))="" DO  ;KEINE POSITIONEN ANGEGEBEN=ALLE ;no 
	. SET POS="" FOR  SET POS=$ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. . SET YFELD=$GET(^INAUFP(YM,YAUFTRAG,POS,1))
	. . IF $PIECE(YFELD,Y,60)=1 QUIT  ;ABGESCHLOSSEN
	. . IF YBELEG'=12 IF +$PIECE(YFELD,Y,205)'=0 QUIT  ;SPERR POSITION NICHT DRUCKEN      AUßER ANZAHLUNGEN ;Not print outside of 
	. . IF YBELEG<13 IF $PIECE(YFELD,Y,9)=1 QUIT  ;storno
	. . IF YBELEG=7!(YBELEG=17) IF +YCOPY=0 QUIT:$PIECE(YFELD,Y,97)'=""  ;WENN GESAMTDRUCK, DANN NUR DIE NOCH NICHT GEDRUCKTEN POSITIONEN
	. . SET YAUFTRAG(POS)=""
	. . QUIT
	. QUIT
	;ANGEBOT ;proposition 
	IF YBELEG=1!(YBELEG=10)!($GET(YPROFORMA)=1) IF $ORDER(YAUFTRAG(""))="" DO  ;KEINE POSITIONEN ANGEGEBEN=ALLE ;no 
	. SET POS="" FOR  SET POS=$ORDER(^INANGP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. . SET YAUFTRAG(POS)=""
	. . QUIT
	. QUIT
	IF YBELEG=12 IF $GET(YPZDATUM)'="" IF $DATA(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1))  SET $PIECE(YBELEG1,Y,187)=$PIECE($GET(^(1)),Y,13)   ;ANZAHLUNGSRECHTUNG POS DRUCKEN ODER NICHT ;print Or Not 
	;REST ;residue 
	SET POS="" FOR  SET POS=$ORDER(YAUFTRAG(POS)) QUIT:POS=""  DO  IF +$PIECE(POS1,Y,11)=0 SET GESAMT=GESAMT+POSTOTAL  ;WENN KEINE ALTERNATIV POSITION ;when no 
	. SET POS1=""
	. IF YBELEG'=1 IF YBELEG'=10 IF $GET(YPROFORMA)="" SET POS1=$GET(^INAUFP(YM,YAUFTRAG,POS,1))  ;AUFTRAG ;mandate  ;order 
	. IF YBELEG=1!(YBELEG=10)!($GET(YPROFORMA)=1) SET POS1=$GET(^INANGP(YM,YAUFTRAG,POS,1))  ;ANGEBOT ODER ANFRAGE ;proposition Or 
	. SET YEKK=$GET(^INAUFPK(YM,YAUFTRAG,POS,1))  ;EK KONDITION ;Planned Cost 
	. IF $data(^INANGPK(YM,YAUFTRAG,POS,1)) SET YEKK=$get(^INAUFPK(YM,YAUFTRAG,POS,1))  ;EK KONDITION ANGEBOT ;Planned Cost proposition 
	. SET POSTOTAL=0
	. ;
	. quit:((($$$INAUFPSource(POS1) = "") || ($$$INAUFPInvoiceNumber(POS1) '= "")) && (YBELEG = 7)) ; SR14152
	. ;
	. ;PRUEFEN GESAMTDRUCK BEI RECHNUNG/GUTSCHRIFT/PROFORMARECHNUNG ;next to 
	. IF YBELEG=7!(YBELEG=17)!($GET(YPROFORMA)=1) IF +$GET(YCOPY)'=1 IF $PIECE(POS1,Y,101)'=""  QUIT   ;SCHON ÜBERTRAGEN ;yet transport 
	. IF YBELEG<11 IF $PIECE(POS1,Y,9)=1 QUIT  ;storno
	. IF YBELEG<11 IF $PIECE(POS1,Y,205)=1 QUIT  ;SPERR
	. IF YBELEG'=1 IF YBELEG'=10 IF $PIECE(POS1,Y,60)=1 QUIT  ;ABGESCHLOSSEN
	. ;
	. IF +$GET(YCOPY)'=1 DO SORT  ;SPEICHER DATEN,WENN NICHT WIEDERHOLUNGSDRUCK
	. ;
	. IF YBELEG=3!(YBELEG=10)!(YBELEG=13) DO  ;NUR BEI BESTELLUNGEN U. ANFRAGEN  !AUSFÜHRUNG NUR NACH "D SORT"
	. . IF $piece(YEKK,Y,30)="" DO  ;KEIN STEUERSATZ AUSGEWÄHLT;FIS;07.02.04
	. . . IF $piece(POS1,Y,4)'="" SET $piece(YEKK,Y,30)=$PIECE($GET(^INART(YM,$piece(POS1,Y,4),1)),Y,36)
	. . . IF $LENGTH($PIECE(YEKK,Y,30))=1 IF $DATA(^WWW101(0,"MWST",SPRACHE,"1"_$PIECE(YEKK,Y,30))) SET $PIECE(YEKK,Y,30)="1"_$PIECE(YEKK,Y,30)  ;UST -> VST
	. . . QUIT
	. . IF +$piece(YEKK,Y,16)'=0 DO
	. . . SET $piece(POS1,Y,5)=$piece(YEKK,Y,16)  ;MENGE MIT UMRECHNUNGSFAKTOR ;quantity by means of 
	. . . IF $PIECE(YEKK,Y,18)'="" SET $piece(POS1,Y,40)=$piece(YEKK,Y,18)  ;MENGENEINHEIT MIT UMRECHNUNGSFAKTOR ;by means of 
	. . . QUIT
	. . QUIT
	. ;
	. ;DO POSUEB^INDRUCKEDI6G  ;ÜBERSCHRIFT POSITIONSGRUPPEN
	. DO ^INDRUCKEDI6P  ;POSITIONEN
	. IF YBELEG=3!(YBELEG=13) IF $DATA(^INAUFPREL(YM,YAUFTRAG,POS)) DO ^INDRUCKEDI6R  ;POSITIONEN RELIES
	. ;DO POSZWS^INDRUCKEDI6G  ;ZWISCHENSUMME POSITIONSGRUPPEN
	. ;
	. IF YBELEG'=3 SET POSTOTAL=$PIECE(POS1,Y,123)   ;WENN KEINE BESTELLUNG DANN TOTAL=VKTOTAL ;when no sales order 
	. ;
	. QUIT:$PIECE(YBELEG1,Y,187)=1  ;KEINE TEILE WENN POSITIONEN NICHT GEDRUCKT WERDEN ;no when Not will 
	. QUIT
	SET NETTOWW=+$G(MWPO(MWPO))  ;NETTO-WARENWERT (OHNE ZUSATZKOSTEN)
	IF YBELEG'=1 IF YBELEG'=2 IF YBELEG'=7 IF YBELEG'=17 IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=13 QUIT   ; NUR BEI ANGEBOT/ AB/ RECHUNG/ TEIZAHLUNGSRECHNUNG ;only next to 
	;IF +YCOPY=0 IF YBELEG=7 IF $PIECE(YAUFTRAG1,Y,101)'="" QUIT  ;SCHON EINMAL GEDRUCKT WENN GESAMT BEI 2.TEILRECHNUNG KEINE BERECHNUNG;AUSGESCHALTET TYBD;19,08,2003
	DO  ;MWST KENNZIFFERN FÜR VP,FRACH,KM,PORTO
	. SET MWPO=1
	. IF $PIECE(YADRES,Y,17)'="" IF $PIECE(YADRES,Y,17)'=$GET(YCOUNTRY) SET MWPO=0  ;KEIN DEUTSCHLAND ;no Germany 
	. ;IF $PIECE(YADRES,Y,50)'="" IF '$FIND($PIECE(YADRES,Y,50),"DE") SET MWPO=0  ;STEUERID AUSLAND
	. IF $PIECE(YADRES,Y,50)'="" IF '$FIND($PIECE(YADRES,Y,50),$GET(YCOUNTRY)) SET MWPO=0  ;STEUERID AUSLAND  ;FIS;28.06.04 ;foreign country 
	. IF $PIECE(YADRES,Y,54)'="" IF $PIECE(YADRES,Y,54)'=1 SET MWPO=0  ;KEINE STEUER ;no tax 
	. IF $PIECE(YADRES,Y,54)=2 IF $PIECE(YADRES,Y,50)="" SET MWPO=1  ;EG OHNE UST-ID = STEUER BERECHNEN ! (PRIVATPERSON);FIS;25.03.04 ;without tax calculate 
	. QUIT
	;VERPACKUNG ;wrapping 
	SET YVERPACK=0
	IF +$$$INAUFPackageAmount(YAUFTRAG1)'=0 SET YVERPACK=$$$INAUFPackageAmount(YAUFTRAG1)
	IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=13 IF YVERPACK'=0 DO
	. IF YCOPY'=1 QUIT:$PIECE(YAUFTRAG1,Y,242)=1  ;BEREITS BERECHNET ;yet 
	. IF YCOPY'=1 SET $PIECE(^INAUF(YM,YAUFTRAG,1),Y,242)=1  ;AUF BERECHNET SETZEN ;upon typeset 
	. ;
	. SET YA(3)=$$$INAUFPackageAmount(YAUFTRAG1)
	. QUIT:+YA(3)=0
	. SET YA(99)=1
	. ;IF YBELEG=17 SET YA(99)=-1   ;GUTSCHRIFT - AUSGESCHALTET ! (IMMER BETRAG 1:1 ÜBERNEHMEN !) ;table-mat Sum assume 
	. SET MWPO(MWPO)=$GET(MWPO(MWPO))+(YA(3)*YA(99))  ;MWST ;Tax 
	. SET YA(3)=$$^WWWTEXT(32184)  ;VERPACKUNG ;wrapping 
	. SET YA(2)=$$^WWWZAHL($$$INAUFPackageAmount(YAUFTRAG1)*YA(99),12,2,YWHR)  ;VERPACKUNG BETRAG ;wrapping Sum 
	. ;D XML^INDRUCK(,,,YA(3),YA(2))
	. S YA(3)=YA(3)_" "_YA(2)
	. DO EDI^INDRUCK("FTX+ZZZ+"_YA(3)) 
	. QUIT
	;FRACHTKOSTEN
	SET YFRACHT=0
	IF +$$$INAUFFreightAmount(YAUFTRAG1)'=0 SET YFRACHT=$$$INAUFFreightAmount(YAUFTRAG1)
	IF YBELEG'=12 IF YBELEG'=3  IF YFRACHT'=0 IF YBELEG'=3 DO
	. IF YCOPY'=1 IF YBELEG=7!(YBELEG=17) QUIT:$PIECE(YAUFTRAG1,Y,243)=1  ;BEREITS BERECHNET ;yet 
	. IF YCOPY'=1 IF YBELEG=7!(YBELEG=17) SET $PIECE(^INAUF(YM,YAUFTRAG,1),Y,243)=1  ;AUF BERECHNET SETZEN ;upon typeset 
	. SET YA(3)=$$$INAUFFreightAmount(YAUFTRAG1)
	. QUIT:+YA(3)=0
	. SET YA(99)=1
	. ;IF YBELEG=17 SET YA(99)=-1   ;GUTSCHRIFT - AUSGESCHALTET ! (IMMER BETRAG 1:1 ÜBERNEHMEN !) ;table-mat Sum assume 
	. SET MWPO(MWPO)=$GET(MWPO(MWPO))+(YA(3)*YA(99))  ;MWST ;Tax 
	. SET YA(3)=$$^WWWTEXT(32186)  ;FRACHT ;loading 
	. SET YA(2)=$$^WWWZAHL($$$INAUFFreightAmount(YAUFTRAG1)*YA(99),12,2,YWHR)  ;VERSICHERUNG BETRAG ;insurance Sum 
	. ;D XML^INDRUCK(,,,YA(3),YA(2))
	. S YA(3)=YA(3)_" "_YA(2)
	. DO EDI^INDRUCK("FTX+ZZZ+"_YA(3)) 
	. QUIT
	;VERSICHERUNG ;insurance 
	SET YVERSICH=0
	IF +$PIECE(YAUFTRAG1,Y,184)'=0 SET YVERSICH=$PIECE(YAUFTRAG1,Y,184)
	IF YBELEG'=12 IF YBELEG'=3 IF YVERSICH'=0 IF YBELEG'=3  DO
	. IF YCOPY'=1 QUIT:$PIECE(YAUFTRAG1,Y,244)=1  ;BEREITS BERECHNET ;yet 
	. IF YCOPY'=1 SET $PIECE(^INAUF(YM,YAUFTRAG,1),Y,244)=1  ;AUF BERECHNET SETZEN ;upon typeset 
	. SET YA(3)=$PIECE(YAUFTRAG1,Y,184)
	. QUIT:+YA(3)=0
	. SET YA(99)=1
	. ;IF YBELEG=17 SET YA(99)=-1  ;GUTSCHRIFT - AUSGESCHALTET ! (IMMER BETRAG 1:1 ÜBERNEHMEN !) ;table-mat Sum assume 
	. SET MWPO(MWPO)=$GET(MWPO(MWPO))+(YA(3)*YA(99))  ;MWST ;Tax 
	. SET YA(3)=$$^WWWTEXT(32185)  ;VERSICHERUNG ;insurance 
	. SET YA(2)=$$^WWWZAHL($PIECE(YAUFTRAG1,Y,184)*YA(99),12,2,YWHR)  ;VERSICHERUNG BETRAG ;insurance Sum 
	. ;D XML^INDRUCK(,,,YA(3),YA(2))
	. S YA(3)=YA(3)_" "_YA(2)
	. DO EDI^INDRUCK("FTX+ZZZ+"_YA(3)) 
	. QUIT
	;ENTFERNUNGSPAUSCHALE
	SET YKMGELD=0
	IF +$PIECE(YAUFTRAG1,Y,185)'=0 SET YKMGELD=$PIECE(YAUFTRAG1,Y,185)
	IF YBELEG'=12 IF YBELEG'=3 IF YKMGELD'=0 IF YBELEG'=3  DO
	. IF YCOPY'=1 QUIT:$PIECE(YAUFTRAG1,Y,245)=1  ;BEREITS BERECHNET ;yet 
	. IF YCOPY'=1 SET $PIECE(^INAUF(YM,YAUFTRAG,1),Y,245)=1  ;AUF BERECHNET SETZEN ;upon typeset 
	. SET YA(3)=$PIECE(YAUFTRAG1,Y,185)
	. QUIT:+YA(3)=0
	. SET YA(99)=1
	. ;IF YBELEG=17 SET YA(99)=-1   ;GUTSCHRIFT - AUSGESCHALTET ! (IMMER BETRAG 1:1 ÜBERNEHMEN !) ;table-mat Sum assume 
	. SET YA(3)=$$^WWWTEXT(32187)  ;KM PAUSCHALE
	. SET YA(2)=$$^WWWZAHL($PIECE(YAUFTRAG1,Y,187)*$PIECE($GET(^INVORG(YM,YM,1)),Y,28)*YA(99),12,2,YWHR)  ;KM PAUSCHALE
	. ;DO XML^INDRUCK(,,,YA(3),YA(2))
	. S YA(3)=YA(3)_" "_YA(2)
	. DO EDI^INDRUCK("FTX+ZZZ+"_YA(3)) 
	. QUIT
	;SPEZIALZUSCHLAG
	SET YZUSCHLAG=0
	// SR12988: Do not add surcharge here.
	; IF +$PIECE(YAUFTRAG1,Y,211)'=0 SET YZUSCHLAG=$PIECE(YAUFTRAG1,Y,211)
	
	; IF YBELEG'=12 IF YBELEG'=3 IF YZUSCHLAG'=0 IF YBELEG'=3  DO
	IF YBELEG'=12 IF YBELEG'=3 IF +$PIECE(YAUFTRAG1,Y,211)'=0 IF YBELEG'=3  DO  	// JW
	. IF YCOPY'=1 QUIT:$PIECE(YAUFTRAG1,Y,246)=1  ;BEREITS BERECHNET ;yet 
	. IF YCOPY'=1 SET $PIECE(^INAUF(YM,YAUFTRAG,1),Y,246)=1  ;AUF BERECHNET SETZEN ;upon typeset 
	. SET YA(3)=$PIECE(YAUFTRAG1,Y,211)
	. QUIT:+YA(3)=0
	. SET YA(99)=1
	. ;IF YBELEG=17 SET YA(99)=-1   ;GUTSCHRIFT - AUSGESCHALTET ! (IMMER BETRAG 1:1 ÜBERNEHMEN !) ;table-mat Sum assume 
	. 
	. // SR12988: Do not add surcharge here.
	. ; SET MWPO(MWPO)=$GET(MWPO(MWPO))+(YA(3)*YA(99))  ;MWST ;Tax 
	. 
	. SET YA(3)=$PIECE(YAUFTRAG1,Y,210)  ;SPEZIALZUSCHLAG BEZEICHNUNG ;notation 
	. SET YA(2)=$$^WWWZAHL($PIECE(YAUFTRAG1,Y,211)*YA(99),12,2,YWHR)  ;BETRAG ;Sum 
	. 
	. ;DO XML^INDRUCK(,,,YA(3),YA(2))
	. S YA(3)=YA(3)_" "_YA(2)
	. DO EDI^INDRUCK("FTX+ZZZ+"_YA(3)) 
	. QUIT
	;ZU/ABSCHLAG
	SET YZUABSCHLAG=0
	IF +$PIECE(YAUFTRAG1,Y,251)'=0 SET YZUABSCHLAG=$PIECE(YAUFTRAG1,Y,251)
	IF +$PIECE(YAUFTRAG1,Y,252)'=0 SET YZUABSCHLAG=YZUABSCHLAG+((MWPO(MWPO)/100)*$PIECE(YAUFTRAG1,Y,252))
	IF YBELEG=3!(YBELEG=13) IF YZUABSCHLAG'=0  DO
	. SET YA(3)=$$^WWWTEXT(32959)  ;Zu/Abschlag Betrag ;Surcharge/Allowance Amount 
	. SET YA(2)=$$^WWWZAHL(YZUABSCHLAG,12,2,YWHR)  ;ZUSCHLAGE
	. ;D XML^INDRUCK(,,,YA(3),YA(2))
	. SET YA(3)=YA(3)_" "_YA(2)
	. DO EDI^INDRUCK("FTX+ZZZ+"_YA(3)) 
	. QUIT
	;----------------------------------AN ODER TEILZAHLUNGSRECHUNG---------
	IF YBELEG=12 DO
	. QUIT:$GET(YPZDATUM)=""
	. IF $DATA(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1)) SET YA(1)=1      ;DRUCK 0/1 ;printing 
	. IF '$DATA(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1)) SET YA(1)=0     ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . ;VON INDRUCK.INT KOMMT-----YFELDPZ=$GET(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1))
	. . SET SUMME=0
	. . SET MWSU="" FOR  SET MWSU=$ORDER(MWPO(MWSU))  QUIT:MWSU=""  SET SUMME=SUMME+MWPO(MWSU)  ;SUMME NEU RECHNEN;FIS;24473;28.10.03
	. . ;IF $PIECE(YFELDPZ,Y,8)=1 SET SUMME=SUMME+YVERPACK+YKMGELD+YFRACHT+YVERSICH+YZUSCHLAG  ;KEINE ZUSATZKOSTEN;FIS;24473;11.11.03
	. . SET A=YSPE
	. . IF +$PIECE(YBELEG1,Y,40)'=0 DO
	. . . SET YA(2)=$PIECE(YBELEG1,Y,41)   ;SPALTE ZALHLUNG ;rift 
	. . . IF YA(2)="" SET YA(2)=1
	. . . SET YA(3)=$$^WWWTEXT(32553,,1)_":"      ;FÄLLIG:
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . QUIT
	. . SET YA(2)=$PIECE(YBELEG1,Y,55)   ;SPALTE ZALHLUNG WIE BEZEICHNUNG ;rift such as notation 
	. . IF YA(2)="" SET YA(2)=22
	. . IF $PIECE(YFELDPZ,Y,1)=1 IF +$PIECE(YFELDPZ,Y,2)'=0 SET YA(3)=$$^WWWTEXT(32330)      ;ANZAHLUNG ;down payment 
	. . IF $PIECE(YFELDPZ,Y,1)'=1 IF +$PIECE(YFELDPZ,Y,2)'=0 SET YA(3)=$$^WWWTEXT(32469)      ;TEILZAHLUNG ;progress payment 
	. . IF $PIECE(YFELDPZ,Y,1)=1 IF +$PIECE(YFELDPZ,Y,2)=0 IF +$PIECE(YFELDPZ,Y,3)'=0 SET YA(3)=$$^WWWZAHL($PIECE(YFELDPZ,Y,3),0,2)_" % "_$$^WWWTEXT(32330)      ; % ANZALHLUNG
	. . IF $PIECE(YFELDPZ,Y,1)'=1 IF +$PIECE(YFELDPZ,Y,2)=0 IF +$PIECE(YFELDPZ,Y,3)'=0 SET YA(3)=$$^WWWZAHL($PIECE(YFELDPZ,Y,3),0,2)_" % "_$$^WWWTEXT(32469)     ; % TEILZALHLUNG
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ZALHLUNG WIE GESAMTBETRAG ;rift such as 
	. . IF YA(2)="" SET YA(2)=63
	. . IF +$PIECE(YFELDPZ,Y,2)'=0 SET YA(3)=$$^WWWZAHL($PIECE(YFELDPZ,Y,2),12,2,YWHR)         ;ZALHLUNG--BETRAG     
	. . IF +$PIECE(YFELDPZ,Y,2)=0 IF +$PIECE(YFELDPZ,Y,3)'=0 SET YA(3)=$$^WWWZAHL(SUMME*$PIECE(YFELDPZ,Y,3)/100,12,2,YWHR)
	. . IF $GET(YPZDATUM)'="" IF $GET(YAUFTRAG)'="" IF $DATA(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1)) IF $G(YCOPY)'=1 DO
	. . . IF +$PIECE(YFELDPZ,Y,2)'=0 SET $PIECE(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1),Y,11)=$PIECE(YFELDPZ,Y,2)
	. . . IF +$PIECE(YFELDPZ,Y,2)=0 IF +$PIECE(YFELDPZ,Y,3)'=0 SET $PIECE(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1),Y,11)=SUMME*$PIECE(YFELDPZ,Y,3)/100
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . ;D XML^INDRUCK(,,,"PAYMENT",A)
	. . S YA(3)="PAYMENT "_A
	. . DO EDI^INDRUCK("FTX+ZZZ+"_YA(3)) 
	. . QUIT
	. QUIT
	;RECHNENSVEREINBARUNG
	;IF YBELEG=1!(YBELEG=2)!(YBELEG=12) DO  ;WENN ANGEBOT ;when proposition 
	. IF $PIECE(YBELEG1,Y,84)'=1 SET YA(1)=0
	. IF $PIECE(YBELEG1,Y,84)=1 IF YBELEG=1 IF $DATA(^INANGPZ(YM,YAUFTRAG)) SET YA(1)=1  ;DRUCK 0/1 ;printing 
	. IF $PIECE(YBELEG1,Y,84)=1 IF YBELEG=1 IF '$DATA(^INANGPZ(YM,YAUFTRAG)) SET YA(1)=0  ;DRUCK 0/1 ;printing 
	. IF $PIECE(YBELEG1,Y,84)=1 IF YBELEG=2!(YBELEG=12) IF $DATA(^INAUFPZ(YM,YAUFTRAG)) SET YA(1)=1  ;DRUCK 0/1 ;printing 
	. IF $PIECE(YBELEG1,Y,84)=1 IF YBELEG=2!(YBELEG=12) IF '$DATA(^INAUFPZ(YM,YAUFTRAG)) SET YA(1)=0  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,85)   ;SPALTE ;rift 
	. IF YA(2)="" SET YA(2)=22
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . ;
	. . SET A=YSPE
	. . SET YA(3)=$$^WWWTEXT(32333)_":"          ;Zahlungsvereinbarung: 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. . SET A=YSPE
	. . SET YA(2)=YA(2)
	. . SET YA(3)=$$^WWWTEXT(32331)              ;Zahlungsdatum /termin ;Payment date 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . SET YA(2)=YA(2)+15
	. . SET YA(3)=$$^WWWTEXT(32332)              ;Zahlungsbetrag o. Anteil ;Payment Amount whack 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. . IF YBELEG=1 SET DATUM="" FOR  SET DATUM=$ORDER(^INANGPZ(YM,YAUFTRAG,DATUM)) QUIT:DATUM=""  DO
	. . . SET YFELD=$GET(^INANGPZ(YM,YAUFTRAG,DATUM,1))
	. . . SET A=YSPE
	. . . SET YA(2)=YA(2)-15
	. . . SET YA(3)=$$^WWWDATE(DATUM)
	. . . IF $PIECE(YFELD,Y,4)'="" DO  ;SONDERZAHLUNGSTEXT STATT DATUM ;Date 
	. . . . SET YA(2)=YA(2)+15-$LENGTH($PIECE(YFELD,Y,4))
	. . . . SET YA(3)=$PIECE(YFELD,Y,4)
	. . . . QUIT
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)
	. . . IF $PIECE(YFELD,Y,4)'="" SET YA(2)=YA(2)-15+$LENGTH($PIECE(YFELD,Y,4))
	. . . SET YA(2)=YA(2)+15
	. . . IF +$PIECE(YFELD,Y,2)'=0 DO 
	. . . . SET YA(3)=$$^WWWZAHL($PIECE(YFELD,Y,2),10,2,YWHR)
	. . . . IF $PIECE(YFELD,Y,2)<100 IF $LENGTH($PIECE($PIECE(YFELD,Y,2),".",2))>2 IF +$EXTRACT($PIECE($PIECE(YFELD,Y,2),".",2),3,9)'=0 SET YA(3)=$$^WWWZAHL($PIECE(YFELD,Y,2),9,3,YWHR)
	. . . . QUIT
	. . . IF +$PIECE(YFELD,Y,2)=0 IF +$PIECE(YFELD,Y,3)'=0 SET YA(3)=$$^WWWZAHL($PIECE(YFELD,Y,3),14,2)_"&nbsp;%"
	. . . DO
	. . . . NEW EURO
	. . . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . . . QUIT
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)
	. . . DO SPE^INDRUCK
	. . . QUIT
	. . IF YBELEG=2!(YBELEG=12) SET DATUM="" FOR  SET DATUM=$ORDER(^INAUFPZ(YM,YAUFTRAG,DATUM)) QUIT:DATUM=""  DO
	. . . SET YFELD=$GET(^INAUFPZ(YM,YAUFTRAG,DATUM,1))
	. . . SET A=YSPE
	. . . SET YA(2)=YA(2)-15
	. . . SET YA(3)=$$^WWWDATE(DATUM)
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)
	. . . SET YA(2)=YA(2)+15
	. . . IF +$PIECE(YFELD,Y,2)'=0 DO 
	. . . . SET YA(3)=$$^WWWZAHL($PIECE(YFELD,Y,2),10,2,YWHR)
	. . . . IF $PIECE(YFELD,Y,2)<100 IF $LENGTH($PIECE($PIECE(YFELD,Y,2),".",2))>2 IF +$EXTRACT($PIECE($PIECE(YFELD,Y,2),".",2),3,9)'=0 SET YA(3)=$$^WWWZAHL($PIECE(YFELD,Y,2),9,3,YWHR)
	. . . . QUIT
	. . . IF +$PIECE(YFELD,Y,2)=0 IF +$PIECE(YFELD,Y,3)'=0 SET YA(3)=$$^WWWZAHL($PIECE(YFELD,Y,3),14,2)_"&nbsp;%"
	. . . DO
	. . . . NEW EURO
	. . . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . . . QUIT
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)
	. . . DO SPE^INDRUCK
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
	
SORT   ;
	NEW YFORM,YVORG
	QUIT:$GET(YTEST)'=""  ;NUR TEST ;only Test 
	DO @YBELEG  ;VERTEILEN AUF BELEGART ;distribute upon 
	IF YBELEG'=1 IF YBELEG'=10 IF $GET(YPROFORMA)'=1 SET YA=$$^WWWSPEI("INAUFP",YAUFTRAG_","_POS,POS1,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	IF YBELEG=1!(YBELEG=10) SET YA=$$^WWWSPEI("INANGP",YAUFTRAG_","_POS,POS1,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	QUIT
	
1 ;ANGEBOT ;proposition 
	IF $PIECE(POS1,Y,79)="" SET $PIECE(POS1,Y,79)=YDATE  ;GEDRUCKT AM ;to the 
	IF $PIECE(POS1,Y,80)="" SET $PIECE(POS1,Y,80)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,81)="" SET $PIECE(POS1,Y,81)=YBED  ;GEDRUCKT VON
	QUIT
	
2 ;AB ;Confirm. 
	DO  ;BELEGNUMMER EINTRAGEN
	. QUIT:$PIECE(YAUFTRAG1,Y,78)=""
	. SET $PIECE(POS1,Y,78)=$PIECE(YAUFTRAG1,Y,78)   ;NUMMER AUS AUFTRAG ;numeral out of order 
	. QUIT
	IF $PIECE(POS1,Y,78)="" SET $PIECE(POS11,Y,78)=YAUFTRAG  ;SPEICHERN ;Save 
	IF $PIECE(POS1,Y,79)="" SET $PIECE(POS1,Y,79)=YDATE  ;GEDRUCKT AM ;to the 
	IF $PIECE(POS1,Y,80)="" SET $PIECE(POS1,Y,80)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,81)="" SET $PIECE(POS1,Y,81)=YBED  ;GEDRUCKT VON
	QUIT
	
3 ;BESTELLUNG ;sales order 
	IF $PIECE(POS1,Y,83)="" SET $PIECE(POS1,Y,83)=+$HOROLOG  ;GEDRUCKT AM ;to the 
	IF $PIECE(POS1,Y,84)="" SET $PIECE(POS1,Y,84)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,85)="" SET $PIECE(POS1,Y,85)=YBED  ;GEDRUCKT VON
	QUIT
	
4 ;
	QUIT
	
5 ;
	QUIT
	
6 ;LIEFERSCHEIN ;packing slip 
	DO  ;BELEGNUMMER ERRECHNEN
	. QUIT:$PIECE(YAUFTRAG1,Y,91)=""
	. SET $PIECE(POS1,Y,91)=$PIECE(YAUFTRAG1,Y,91)   ;NUMMER  AUS AUFTR ;numeral out of 
	. QUIT
	IF $PIECE(POS1,Y,91)="" SET $PIECE(POS1,Y,91)=YAUFTRAG  ;SPEICHERN ;Save 
	IF $PIECE(POS1,Y,92)="" SET $PIECE(POS1,Y,92)=YDATE  ;GEDRUCKT AM ;to the 
	IF $DATA(^INVORG(YM,YM,1)) IF $PIECE($GET(^INVORG(YM,YM,1)),Y,40)=1 SET $PIECE(POS1,Y,76)=YDATE  ;AUSLIEFERUNGSDATUM
	IF YCOPY=1 SET YDATUM=$PIECE(POS1,Y,92) ;WENN WIEDERHOLUNG ;when repetition 
	IF $PIECE(POS1,Y,93)="" SET $PIECE(POS1,Y,93)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,94)="" SET $PIECE(POS1,Y,94)=YBED  ;GEDRUCKT VON
	QUIT
	
7 ;RECHNUNG ;tab 
	DO  ;BELEGNUMMER ERRECHNEN
	. QUIT:$PIECE(YAUFTRAG1,Y,96)=""
	. SET $PIECE(POS1,Y,96)=$PIECE(YAUFTRAG1,Y,96)   ; NUMMER AUS AUFTRAG ;numeral out of order 
	. QUIT
	IF $PIECE(POS1,Y,96)="" SET $PIECE(POS1,Y,96)=YAUFTRAG  ;SPEICHERN ;Save 
	IF $PIECE(POS1,Y,97)="" SET $PIECE(POS1,Y,97)=YDATE  ;GEDRUCKT AM ;to the 
	IF YCOPY=1 SET YDATE=$PIECE(POS1,Y,97) ;WENN WIEDERHOLUNG ;when repetition 
	IF $PIECE(POS1,Y,98)="" SET $PIECE(POS1,Y,98)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,99)="" SET $PIECE(POS1,Y,99)=YBED  ;GEDRUCKT VON
	DO  ;SETZEN UMSATZ ZEITRAUM;27153;FIS;17.01.05
	. NEW YKEY,YFELD
	. SET YKEY=YAUFTRAG_","_POS
	. SET YFELD=POS1
	. DO ^INAUFPVALDATE
	. SET POS1=YFELD
	. QUIT
	QUIT
	
8 ;
	QUIT
	
9 ;BEREITSTELLUNG
	IF $PIECE(POS1,Y,87)="" SET $PIECE(POS1,Y,87)=+$HOROLOG  ;GEDRUCKT AM ;to the 
	IF YCOPY=1 SET YDATE=$PIECE(POS1,Y,87) ;WENN WIEDERHOLUNG ;when repetition 
	IF $PIECE(POS1,Y,88)="" SET $PIECE(POS1,Y,88)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,89)="" SET $PIECE(POS1,Y,89)=YBED  ;GEDRUCKT VON
	QUIT
	
10 ;
	IF $PIECE(POS1,Y,83)="" SET $PIECE(POS1,Y,83)=+$HOROLOG  ;GEDRUCKT AM ;to the 
	IF $PIECE(POS1,Y,84)="" SET $PIECE(POS1,Y,84)=$PIECE($HOROLOG,",",2)  ;GEDRUCKT UM ;to 
	IF $PIECE(POS1,Y,85)="" SET $PIECE(POS1,Y,85)=YBED  ;GEDRUCKT VON
	QUIT
	
11 ;
	QUIT
	
12 ;
	QUIT
	
13 ; 
	SET $PIECE(POS1,Y,9)=1
	IF $PIECE(POS1,Y,402)="" SET $PIECE(POS1,Y,402)=+$HOROLOG  ;GEDRUCKT AM ;to the  
	QUIT
	
14 ;
	QUIT
	
15 ;
	QUIT
	
16 ;
	QUIT
	
17 ;
	DO 7
	QUIT
	
18 ;
	
19 ;
	QUIT       
]]></Routine>
</Export>