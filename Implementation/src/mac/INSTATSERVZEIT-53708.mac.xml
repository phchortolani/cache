<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INSTATSERVZEIT" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INSTATSERVZEIT(SERVICE) ;INSTATSERVZEIT;PROJEKTDAURZEIT RECHNEN;FAN;25124
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		PROJEKTDAURZEIT RECHNEN
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| 	FAN
	;|
	;\------------------------------------------------------------------/
	;
	N ZW,NR,YFELD,VON,BIS,START,STOP,ART,BEZ,DAUER1,DAUER,BED,DET,DAT2,ENDMIT,STOPMIT
	K ^WWWSOR(YUSER,"99")
	SET ZW=0
	SET DAUER(2)=0
	SET NR=SERVICE
	IF NR="" Q ZW
	IF '$D(^INCALL(YM,NR,1)) Q ZW
	SET YFELD=$G(^INCALL(YM,NR,1))
	SET VON=$P(YFELD,Y,1)    ;VON DATUM ;Date 
	IF VON="" DO  SET VORG(1)=+$H-30 
	SET BIS=+$H  ;BIS DATUM   ;until Date 
	SET BED="" FOR  SET BED=$ORDER(^INPRODAUERs(YM,1,$$^WWWUMLAU(NR,1),BED)) QUIT:BED=""  DO
	. SET DAT=VON-1 FOR  SET DAT=$ORDER(^INPRODAUERs(YM,1,$$^WWWUMLAU(NR,1),BED,DAT)) QUIT:DAT=""  QUIT:DAT>BIS  DO  ;ZEITRAUM
	. . SET START="" FOR  SET START=$ORDER(^INPRODAUERs(YM,1,$$^WWWUMLAU(NR,1),BED,DAT,START)) QUIT:START=""  DO    ;START-UHRZEIT
	. . . SET STOP=START 
	. . . SET DAT2=DAT DO:$ORDER(^INPRODAUER(YM,BED,DAT2,STOP))=""  FOR  SET STOP=$ORDER(^INPRODAUER(YM,BED,DAT2,STOP)) QUIT:DAT2>BIS  DO  QUIT:STOP'=""  ;STOP (START NÄCHSTER DATENSATZ)
	. . . . SET STOPMIT=24*60*60-1 IF +$PIECE($GET(^WWW013(0,BED,1)),Y,96)'=0 SET STOPMIT=$PIECE(^(1),Y,96)
	. . . . IF STOP=""!(STOP=START) SET STOP=STOPMIT
	. . . . IF STOP="" SET DAT2=DAT2+1 QUIT
	. . . . ;
	. . . . SET ART=$PIECE($GET(^INPRODAUER(YM,BED,DAT,START,1)),Y,2)  ;PROJEKTART
	. . . . IF ART="" SET ART=" "
	. . . . SET BEZ=$PIECE($GET(^INPRODAUER(YM,BED,DAT,START,1)),Y,1)  ;PROJEKTBEZEICHNUNG
	. . . . IF BEZ="" SET BEZ=" "
	. . . . ;
	. . . . SET DAUER1=$PIECE($GET(^INPRODAUER(YM,BED,DAT,START,1)),Y,3)  ;MANUELLE DAUER ;permanence 
	. . . . IF +DAUER1'=0 SET STOP=START+DAUER1  ;MANUELL
	. . . . ;
	. . . . SET ^WWWSOR(YUSER,"99",ART,BEZ,DAT,START,DAT2,STOP,BED)=""  ;DATENSATZ SPEICHERN ;data record Save 
	. . . . ;W "^WWWSOR("_YUSER,"99"_","_ART_","_BEZ_","_$$^WWWDATE(DAT)_","_$$^WWWTIME(START)_","_$$^WWWDATE(DAT2)_","_$$^WWWTIME(STOP)_","_BED_")"_"<BR>"
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	SET SORT=1
	SET DAUER(1)=""
	SET DAUER(2)=""
	SET ANZM=0
	;DATENSÄTZE DURCHLAUFEN
	SET ART="" FOR  SET ART=$ORDER(^WWWSOR(YUSER,"99",ART),SORT) QUIT:ART=""  DO
	. SET BEZ="" FOR  SET BEZ=$ORDER(^WWWSOR(YUSER,"99",ART,BEZ),SORT) QUIT:BEZ=""  DO
	. . SET DAT="" FOR  SET DAT=$ORDER(^WWWSOR(YUSER,"99",ART,BEZ,DAT),SORT) QUIT:DAT=""  DO
	. . . SET START="" FOR  SET START=$ORDER(^WWWSOR(YUSER,"99",ART,BEZ,DAT,START),SORT) QUIT:START=""  DO
	. . . . SET DAT2="" FOR  SET DAT2=$ORDER(^WWWSOR(YUSER,"99",ART,BEZ,DAT,START,DAT2),SORT) QUIT:DAT2=""  DO
	. . . . . SET STOP="" FOR  SET STOP=$ORDER(^WWWSOR(YUSER,"99",ART,BEZ,DAT,START,DAT2,STOP),SORT) QUIT:STOP=""  DO
	. . . . . . SET BED="" FOR  SET BED=$ORDER(^WWWSOR(YUSER,"99",ART,BEZ,DAT,START,DAT2,STOP,BED),SORT) QUIT:BED=""  DO
	. . . . . . . SET END=STOP
	. . . . . . . SET ENDMIT=86399
	. . . . . . . IF +$PIECE($GET(^WWW013(0,BED,1)),Y,96)'=0 SET ENDMIT=$PIECE(^(1),Y,96)    ;ENDEZEIT AUS MITARBEITERZEIT
	. . . . . . . IF DAT=+$H IF END=ENDMIT SET END=$P($H,",",2)    ;datum ist heute;86399 IST 23:59:59;    ;23811;FAN;04.11.2003;END DEUER IST JEZT. 
	. . . . . . . IF DAT2>DAT SET END=0  ;PROJEKT ENDET SPÄT. 0.00 UHR! ;scheme 0.00 
	. . . . . . . ;I $E(YBED,1,3)="TYB" I +END=0 SET END=$RANDOM(7200)+(3600*20) SET ^INPRODAUER(YM,BED,DAT,END,1)="Arbeitspause"_Y_1  ;TEST
	. . . . . . . SET DAUER(1)=(END-START)  ;DAUER IN SEKUNDEN ;permanence within 
	. . . . . . . IF DAT2>DAT IF END=0 SET DAUER(1)=DAUER(1)+86400  ;PLUS 1 TAG WENN 0.00 UHR ZWANGSBEENDET ;plus TAG when 0.00 timepiece 
	. . . . . . . SET DAUER(2)=DAUER(2)+DAUER(1)
	. . . . . . . QUIT
	. . . . . . QUIT
	. . . . . QUIT
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT DAUER(2)
]]></Routine>
</Export>