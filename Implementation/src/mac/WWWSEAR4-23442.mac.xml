<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWSEAR4" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWSEAR4
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		SELEKTIEREN DER WERTE
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	;
	; 07-Jul-2005	shobby	SR12892: WWW1263 is no longer shared.
	; 15.08.1997	DT
	;-------------------------------------------------------------------------------
	;	YDATEI = DATEINAME ;file name 
	;	YFKEY  = FESTE PRIMÄRSCHLÜSSEL
	;	YAUSW  = VARIABLE PRIMÄRSCHLÜSSEL (AB KEY)
	;	YRICHT = 1 UP ; 2 DOWN
	;	YSORT  = SORTIERSCHLUESSEL
	;	YANZ   = ANZAHL DER GESUCHTEN WERTE ;Number the 
	;	YKOMP  = 1 = KOMPLETTER KEY; 2 LETZTER KEY FEHLT(GRID-SUCHE)
	;	YFIND  = ZU FINDENDER DATENSATZ ;within data record 
	;	YSAUSW = FESTE SORTKEY VORGABEN
	SET YDATEI = $PIECE(YSUCH1,Y,2)
	SET YSAUSW = $GET(YSAUSW)
	IF YDATEI="" SET YDATEI=$PIECE($GET(^WWW120(0,YFORM,1)),Y,11)
	SET YFOART = $PIECE($GET(^WWW120(0,YFORM,1)),Y,2)
	SET YKOMP  = 1 IF YFOART=3 SET YKOMP=2  ;GRID
	SET YFIND  = ""
	IF +YANZAHL'=0 IF $GET(YFORM)'="" IF $GET(YBED)'="" SET $PIECE(^WWW1263(YM,YFORM,YBED,1),Y,1)=YANZAHL
	IF +YANZAHL=0  IF $GET(YFORM)'="" IF $GET(YBED)'="" IF $PIECE($GET(^WWW1263(YM,YFORM,YBED,1)),Y,1)'="" SET YANZAHL=$PIECE(^WWW1263(YM,YFORM,YBED,1),Y,1)
	IF +YANZAHL<1 SET YANZAHL=$PIECE(YSUCH1,Y,10)
	IF +YANZAHL<1 SET YANZAHL=100
	IF $GET(%(YQUERY,"YFUNCT"))=1 SET YAUSWAHL=""
	IF YAUSWAHL'="" DO  ;DATUM?
	. IF +YSORT=0 DO    ;IN KEY? ;within 
	. . NEW YLKY,YLKY1
	. . FOR YLKY1=1:1 SET YLKY=$GET(^WWW002(0,YDATEI,YLKY1,1)) QUIT:YLKY=""  DO
	. . . QUIT:$PIECE(YLKY,Y,3)'=1  ;KEIN DATUM ;no Date 
	. . . SET YLKY(1)=+$PIECE(YAUSWAHL,",",YLKY1)
	. . . IF YLKY(1)'=0  SET $PIECE(YAUSWAHL,",",YLKY1)=$$^WWWDATE1(YLKY(1))
	. . . IF YLKY(1)="." SET $PIECE(YAUSWAHL,",",YLKY1)=+$HOROLOG
	. ;
	. IF +YSORT'=0 DO  ;IN SORTKEY ;within 
	. . NEW YLKY,YLKY1
	. . FOR YLKY1=1:1 SET YLKY=$GET(^WWW002(0,YDATEI,YLKY1,1)) QUIT:YLKY=""  DO
	. . . QUIT:$PIECE(YLKY,Y,6)'=YSORT  ;FALSCHER SORT
	. . . QUIT:$PIECE(YLKY,Y,3)'=1      ;KEIN DATUM ;no Date 
	. . . SET YLKY(1)=YAUSWAHL
	. . . IF YLKY(1)'=0  SET YAUSWAHL=$$^WWWDATE1(YLKY(1))
	. . . IF YLKY(1)="." SET YAUSWAHL=+$HOROLOG
	
	IF +YSORT=0 IF $EXTRACT(YAUSWAHL)'="*" IF $EXTRACT(YAUSWAHL)'="." IF $EXTRACT(YAUSWAHL)'="|" SET YAUSWAHL="."_YAUSWAHL
	IF +YSORT'=0 IF $LENGTH(YAUSWAHL)=1 IF $EXTRACT(YAUSWAHL)'="*" IF $EXTRACT(YAUSWAHL)'="." IF $EXTRACT(YAUSWAHL)'="|" SET YAUSWAHL="|"_YAUSWAHL
	;;IF +YSORT'=0 IF $LENGTH(YAUSWAHL)>0 IF $EXTRACT(YAUSWAHL)'="." IF $EXTRACT(YAUSWAHL)'="|" IF $EXTRACT(YAUSWAHL)'="*" SET YAUSWAHL="."_YAUSWAHL
	;;IF YFKEY'="" IF $LENGTH(YAUSWAHL)<2 IF $EXTRACT(YAUSWAHL)'="|" IF $EXTRACT(YAUSWAHL)'="*" SET YAUSWAHL="|"_YAUSWAHL
	;;IF $EXTRACT(YAUSWAHL)="." SET YAUSWAHL="|"_$EXTRACT(YAUSWAHL,2,99)
	IF $EXTRACT(YAUSWAHL)'="*" IF $EXTRACT(YAUSWAHL)'="." IF $EXTRACT(YAUSWAHL)'="|" SET YAUSWAHL="|"_YAUSWAHL
	IF $EXTRACT(YAUSWAHL,1,2)="|." SET YAUSWAHL=$EXTRACT(YAUSWAHL,2,99)
	;SET YAUSWAHL=$TRANSLATE(YAUSWAHL," ")  ;KEINE BLANK  ;FIS;12.05.03;23541;SUCHANZEIGE FÜR EINTRÄGE MIT BLANK:
	IF $EXTRACT(YAUSWAHL)="." FOR  QUIT:$EXTRACT(YAUSWAHL,2)'=" "  SET YAUSWAHL="."_$EXTRACT(YAUSWAHL,3,99)  ;KEINE BLANK VORNE ;no shiny 
	IF $EXTRACT(YAUSWAHL)="*" FOR  QUIT:$EXTRACT(YAUSWAHL,2)'=" "  SET YAUSWAHL="*"_$EXTRACT(YAUSWAHL,3,99)  ;KEINE BLANK VORNE ;no shiny 
	IF $EXTRACT(YAUSWAHL)="|" FOR  QUIT:$EXTRACT(YAUSWAHL,2)'=" "  SET YAUSWAHL="|"_$EXTRACT(YAUSWAHL,3,99)  ;KEINE BLANK VORNE ;no shiny 
	FOR  QUIT:$EXTRACT($REVERSE(YAUSWAHL))'=" "  SET YAUSWAHL=$REVERSE($EXTRACT($REVERSE(YAUSWAHL),2,99))    ;KEINE BLANK HINTEN
	DO ^WWWSOR(YDATEI,YFKEY,YAUSWAHL,YORIENT,YSORT,YANZAHL,YKOMP,YFIND,,YSAUSW)
	QUIT
	
	;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK
	
	IF +YSORT=0 IF $EXTRACT(YAUSWAHL)'="*" IF $EXTRACT(YAUSWAHL)'="." IF $EXTRACT(YAUSWAHL)'="|" SET YAUSWAHL="."_YAUSWAHL
	IF +YSORT'=0 IF $LENGTH(YAUSWAHL)=1 IF $EXTRACT(YAUSWAHL)'="*" IF $EXTRACT(YAUSWAHL)'="." IF $EXTRACT(YAUSWAHL)'="|" SET YAUSWAHL="|"_YAUSWAHL
	;;IF +YSORT'=0 IF $LENGTH(YAUSWAHL)>0 IF $EXTRACT(YAUSWAHL)'="." IF $EXTRACT(YAUSWAHL)'="|" IF $EXTRACT(YAUSWAHL)'="*" SET YAUSWAHL="."_YAUSWAHL
	;;IF YFKEY'="" IF $LENGTH(YAUSWAHL)<2 IF $EXTRACT(YAUSWAHL)'="|" IF $EXTRACT(YAUSWAHL)'="*" SET YAUSWAHL="|"_YAUSWAHL
	;;IF $EXTRACT(YAUSWAHL)="." SET YAUSWAHL="|"_$EXTRACT(YAUSWAHL,2,99)
	IF $EXTRACT(YAUSWAHL)'="*" IF $EXTRACT(YAUSWAHL)'="." IF $EXTRACT(YAUSWAHL)'="|" SET YAUSWAHL="|"_YAUSWAHL
	IF $EXTRACT(YAUSWAHL,1,2)="|." SET YAUSWAHL=$EXTRACT(YAUSWAHL,2,99)
	;SET YAUSWAHL=$TRANSLATE(YAUSWAHL," ")  ;KEINE BLANK  ;FIS;12.05.03;23541;SUCHANZEIGE FÜR EINTRÄGE MIT BLANK:
	IF $EXTRACT(YAUSWAHL)="." FOR  QUIT:$EXTRACT(YAUSWAHL,2)'=" "  SET YAUSWAHL="."_$EXTRACT(YAUSWAHL,3,99)  ;KEINE BLANK VORNE ;no shiny 
	IF $EXTRACT(YAUSWAHL)="*" FOR  QUIT:$EXTRACT(YAUSWAHL,2)'=" "  SET YAUSWAHL="*"_$EXTRACT(YAUSWAHL,3,99)  ;KEINE BLANK VORNE ;no shiny 
	IF $EXTRACT(YAUSWAHL)="|" FOR  QUIT:$EXTRACT(YAUSWAHL,2)'=" "  SET YAUSWAHL="|"_$EXTRACT(YAUSWAHL,3,99)  ;KEINE BLANK VORNE ;no shiny 
	FOR  QUIT:$EXTRACT($REVERSE(YAUSWAHL))'=" "  SET YAUSWAHL=$REVERSE($EXTRACT($REVERSE(YAUSWAHL),2,99))  ;KEINE BLANK HINTEN ;no shiny behind 
	DO ^WWWSOR(YDATEI,YFKEY,YAUSWAHL,YORIENT,YSORT,YANZAHL,YKOMP,YFIND,,YSAUSW)
	QUIT
	;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
]]></Routine>
</Export>