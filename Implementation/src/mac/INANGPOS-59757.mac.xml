<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INANGPOS" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INANGPOS(YANGEBOT,YARTIKEL,YMENGE,YSONDERVK,YKUNDETEXT) ;INAUFPOS;DT;ANLEGEN ANGEBOTSPOSITION;04.01.2001  ; Compiled January 8, 2005 14:05:27
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		ANLEGEN ANGEBOTSPOSITION
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	04.01.2001  
	;|
	;\------------------------------------------------------------------/
	;
	;YANGEBOT=ANGEBOTSNUMMER
	;YARTIKEL=ARTIKELNUMMER
	;YMENGE=MENGE
	;YSONDERVK=SONDER-VERKAUFSPREIS
	;YKUNDETEXT=alternativer Kundentext FÜR ZUSTAZARTIKEL   ;FAN;13.04.04;25518
	;RÜCKGABEWERT ="" KEINE POSITION ODER POSITIONSNUMMER (BEI BESTELLUNG)
	NEW POS,YFORM,ARTIKEL1,SATZ,YOK,LIEFER,YFELD,YPOS,ART,SATZ1,YA,YOK,KUNDE
	SET YOK=""
	SET YKUNDETEXT=$G(YKUNDETEXT)          ;alternativer Kundentext FÜR ZUSATZARTIKEL   ;FAN;13.04.04;25518
	SET YMENGE=$GET(YMENGE)
	SET YANGEBOT=$GET(YANGEBOT)  ;ANGEBOT  ;proposition 
	SET YFORM="INANGP"  ;POSITIONEN
	FOR YPOS=1:1 QUIT:'$DATA(^INANGP(YM,YANGEBOT,YPOS))  ;NEUE ANGEBOTSPOSITION
	SET ART=$GET(YARTIKEL)  ;ARTIKELNUMMER 
	QUIT:ART="" YOK
	QUIT:'$DATA(^INART(YM,ART,1)) YOK  ;ARTIKEL NICHT VORHANDEN ;item Not on hand 
	SET SATZ1=$GET(^INART(YM,ART,1))  ;ARTIKELDATEN
	IF YKUNDETEXT'="" SET $P(SATZ1,Y,10)=YKUNDETEXT         ;alternativer Kundentext FÜR ZUSATZARTIKEL   ;FAN;13.04.04;25518
	SET SATZ=""
	SET KUNDE=""
	IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=0 SET KUNDE=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,1)
	FOR YA=1,2,3,10,14,15,16,17,26,30,31,32,33,36,37,38,40,41,42,43,44,45,47,48,49,50,53,54,55,57,58,59,62,66,68,70,73,74,75,126,130,131,132,134,136,158,166,171,172,178,179,180,181,182,183,184,185,191,192,210,211,356 SET $PIECE(SATZ,Y,YA)=$PIECE(SATZ1,Y,YA)   ;DATEN AUS ARTIKEL ÜBERTRAGEN;bEC;27.01.03;fELDER 210,211 ;ERGÄNTZT 356;BEC;25600;12.05.04
	FOR YA=178,179,180,181 IF $PIECE(SATZ1,Y,YA)=1 SET $PIECE(^INANG(YM,YANGEBOT,1),Y,YA)=1  ;NEU BERECHNEN ;recent calculate 
	IF $PIECE(SATZ1,Y,46)'="" SET $PIECE(SATZ,Y,40)=$PIECE(SATZ1,Y,46)  ;ANDERE VERKAUFSEINHEIT ALS EINHEIT ;when unity 
	SET $PIECE(SATZ,Y,47)=$PIECE(SATZ,Y,47)*YMENGE/$$^INQTYUNIT(ART)  ;+$P(SATZ,Y,71)  ;HERSTELLKOSTEN+RUESTPREIS
	SET $PIECE(SATZ,Y,74)=$PIECE(SATZ,Y,74)*$$^INPROLOS(ART,YMENGE)   ;WERKZEUGKOSTEN 
	SET $PIECE(SATZ,Y,75)=$PIECE(SATZ,Y,75)*$$^INPROLOS(ART,YMENGE)   ;SONSTIGEKOSTEN
	SET $PIECE(SATZ,Y,5)=+$GET(YMENGE)
	SET $PIECE(SATZ,Y,4)=ART
	SET $PIECE(SATZ,Y,21)=$GET(YTRAKT)_"/"_YUSER   ;TRANSAKTIONSNUMMER UND USER ;And 
	SET $PIECE(SATZ,Y,22)=$HOROLOG   ;ERFASST
	SET $PIECE(SATZ,Y,23)=YBED   ;ERFASST
	SET $PIECE(SATZ,Y,24)=""  ;ÄNDERUNG  ;alteration 
	SET $PIECE(SATZ,Y,25)=""   ;MITARB
	SET $PIECE(SATZ,Y,116)=$PIECE(SATZ1,Y,86)  ;AUFSCHLAG ;overcharge 
	;SET $PIECE(SATZ,Y,118)=$PIECE(SATZ1,Y,88)  ;VK
	SET $PIECE(SATZ,Y,120)=$PIECE(SATZ1,Y,90)  ;PREISKZ
	IF $GET(KUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,221)'="" SET $PIECE(SATZ,Y,120)=$PIECE(^(1),Y,221)   ;PREISKZ DES KUNDEN;FIS;24405;04.11.03
	SET $PIECE(SATZ,Y,118)=$$^INSALESPRICE($P(SATZ,Y,4),,$P($G(^INANG(YM,YANGEBOT,1)),Y,6),$PIECE(SATZ,Y,120),$P($G(^INANG(YM,YANGEBOT,1)),Y,1))  ;VK;FIS;03.06.03;23477;PREISE NEU AUS INSALESPRICE
	SET $PIECE(SATZ,Y,124)=$PIECE(SATZ1,Y,92)  ;PROV
	IF $GET(YSONDERVK)'="" SET $PIECE(SATZ,Y,118)=+YSONDERVK  ;SONDERVERKAUFSPREIS
	IF $PIECE(SATZ,Y,26)=2 DO   ;DIENSTLEISTUNG
	. SET $PIECE(SATZ,Y,7)=4  ;WENN LEISTUNG DANN DIENSTLEISTUNG UND LEISTUNGSFÄHIG ;when performance And efficient 
	. QUIT
	IF $PIECE(SATZ,Y,26)=4 DO  ;KLEINTEILE
	. SET $PIECE(SATZ,Y,7)=2  ;KLEINTEILE AUS LAGER ;out of stock location 
	. QUIT
	SET $PIECE(SATZ,Y,119)=$JUSTIFY($PIECE(SATZ,Y,118)*YMENGE/$$^INQTYUNIT(ART),0,2)  ;VK*MENGE
	SET YM1=""
	SET YM2=""
	SET KEY=YANGEBOT_","_YPOS
	SET YOK=$$^WWWSPEI("INANGP",KEY,SATZ,1)   ;SPEICHERN DATENSATZ ;Save data record 
	SET $PIECE(SATZ,Y,123)=$$^INANGPNETTO(YANGEBOT,YPOS)
	IF +$$^INANGKOST(YANGEBOT,YPOS)'=0 SET $PIECE(^INANGP(YM,YANGEBOT,YPOS,1),Y,47)=$$^INANGKOST(YANGEBOT,YPOS)  ;NEURECHNEN POSITIONS-EK
	MERGE ^INANGPSP(YM,$TRANSLATE(YANGEBOT,""""),YPOS)=^INARTSP(YM,ART)  ;ARTIKELSPRACHE IN POSITIONEN  ;within 
	QUIT YPOS  ;NEUE POSITIONSNUMMER
]]></Routine>
</Export>