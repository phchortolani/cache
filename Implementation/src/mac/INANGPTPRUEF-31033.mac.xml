<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INANGPTPRUEF" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INANGPTPRUEF(YKEY) ;INANGPTPRUEF;DT;PRUEFEN DER AUFTRÄGE AUF TEILE MIT 0 BETRÄGEN; ;the upon by means of   ; Compiled February 9, 2005 10:52:04
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		PRUEFEN DER AUFTRÄGE AUF TEILE MIT 0 BETRÄGEN
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	PRUEFEN DER AUFTRÄGE AUF TEILE MIT 0 BETRÄGEN
	;|
	;\------------------------------------------------------------------/
	;
	NEW ME,YAUF,YPOS,ANZM,ANZINF,ANZPOS,YTEIL,YDDSATZ,BESTAND,LIEF,AUFTRAG,YPOS1,FERTENDE,KEY,SUM,MENGE,BACK,HAUPTBDE
	SET KEY=$GET(YKEY)
	SET YAUF=$PIECE($GET(KEY),",",1)
	SET YPOS=$PIECE($GET(KEY),",",2)
	SET BACK="INANG"
	IF YPOS'="" SET BACK=BACK_",INANGP"
	SET YTARGET=$GET(YTARGET)
	;SET YTARGET=$PIECE(YTARGET,"/",1)
	IF YTARGET="" SET YTARGET="FRAME2"
	SET $PIECE(YVOR,Y,24)=1
	;AUFBAU DER LISTE ;the list 
	WRITE "<CENTER>"
	WRITE "<B>"
	WRITE " ("_$$^WWWTEXT(32178)_": "  ;ANGEBOT ;proposition 
	WRITE YAUF
	IF YPOS'="" WRITE "-"
	WRITE YPOS
	WRITE ")"
	WRITE "</B>"
	WRITE "</CENTER>"
	DO ^WWWFRAME(2)  ;TABLE AN ;upon 
	DO KOPF
	SET ANZM=0  ;ANZAHL TEILE ;Number 
	SET ANZINF=""  ;(1=HAUPT/2=UNTERTEIL)
	SET ANZPOS=0  ;ANZAHL HAUPTPOSITIONEN ;Number 
	SET HAUPTBDE=0  ;0=JEDE FERTIGUNGSNUMMER WIRD GESTEMPELT
	;                1=NUR HAUPTTEIL WIRD GESTEMPELT  -> WERT VON UNTERTEILEN WIRD NICHT BERECHNET ;worthy Not 
	DO
	. ;SUCHEN HAUPTTEILE DES AUFTRAGS ;seek 
	. IF YAUF'="" DO:YPOS'=""  IF YPOS="" FOR  SET YPOS=$ORDER(^INANGP(YM,YAUF,YPOS)) QUIT:YPOS=""  DO
	. . IF ANZM'=0 DO KOPF  ;ZEILE
	. . SET SUM(1)=0  ;GESAMTZEIT SOLL
	. . SET SUM(2)=0  ;GESAMTZEIT IST
	. . ;SET SUM(3)=0  ;GESAMTGEWICHT ;table-mat gross load weight 
	. . SET SUM(4)=0  ;GESAMTWERT ;total value  ;total value whole 
	. . SET SUM(5)=0  ;EINZELWERTSUMME MATERIAL
	. . SET SUM(6)=0  ;EINZELWERTSUMME LEISTUNGEN
	. . SET SUM(7)=0  ;EINZELWERTSUMME ZUSATZKOSTEN ;additional costs 
	. . SET MENGE=""
	. . SET ANZPOS=ANZPOS+1
	. . SET YTEIL="" DO  ;HAUPTPOSITION
	. . . SET YPOS1=$GET(^INANGP(YM,YAUF,YPOS,1))
	. . . QUIT:$PIECE(YPOS1,Y,7)'=3
	. . . SET ANZINF=2
	. . . SET MENGE=$PIECE(YPOS1,Y,5)
	. . . SET YAART=$PIECE(YPOS1,Y,26)
	. . . SET ME=$PIECE(YPOS1,Y,40)
	. . . IF YAART'=2 IF ME=2!(ME=10)!(ME=11) SET YAART=2
	. . . DO ANZ  ;POSITION
	. . . QUIT
	. . ;
	. . ;SUCHEN TEILE UND UNTERTEILE ;seek And 
	. . SET SUCH="^INANGPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS_")"
	. . FOR  DO  QUIT:SUCH=""
	. . . SET SUCH=$QUERY(@SUCH)
	. . . IF $TRANSLATE($PIECE(SUCH,",",2),"""")'=YAUF SET SUCH="" QUIT  ;07.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. . . ;IF $PIECE(SUCH,",",2)'=YAUF SET SUCH="" QUIT  ;07.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. . . IF $PIECE(SUCH,",",3)=YPOS DO
	. . . . SET YTEIL=$PIECE(SUCH,",",4,99)
	. . . . SET YTEIL=$TRANSLATE(YTEIL,",)","..")
	. . . . SET YPOS1=@SUCH
	. . . . SET ANZINF=1
	. . . . IF $DATA(@SUCH)=11 SET ANZINF=2
	. . . . SET YAART=$PIECE(YPOS1,Y,26)  ;AUFTRAGSART(2=LEISTUNG)
	. . . . SET ME=$PIECE(YPOS1,Y,40)
	. . . . IF YAART'=2 IF ME=2!(ME=10)!(ME=11) SET YAART=2
	. . . . DO ANZ  ;TEILE
	. . . . QUIT
	. . . QUIT
	. . IF ANZM'=0 DO FUSS
	. . QUIT
	. QUIT
	IF ANZM=0 DO ZEILE
	DO ^WWWFRAME(1)   ;TABLE AUS ;out of 
	WRITE YCR
	WRITE "<BR>"
	QUIT
	
ANZ ;ANZEIGEN DER POSITIONEN ;display the 
	IF +$PIECE(YPOS1,Y,47)'=0!(+$PIECE(YPOS1,Y,74)'=0) QUIT
	NEW YBACK,YKEY,START,START1,STARTSUM,START0,ENDE,ENDE1,ENDE0,ENDESUM,COLOR,LINKTXT,YLINK,YFORM,BDEDAUER
	;ZEITEN NEU RECHNEN UND KALKULATION  ! ÄNDERUNGEN GGF. AUCH IN INNACHKALK ! ;recent have faith in And cost estimating too within 
	;==================================
	SET BDEDAUER=0
	;FERTIGUNGSSTATUS
	;=================
	;SUCHEN FERTIGUNGSSTART ;seek 
	SET START0=""
	SET START1=""
	SET STARTSUM=0
	;SUCHEN FERTIGUNGSENDE ;seek 
	SET ENDE0=""
	SET ENDE1=""
	SET ENDESUM=0
	;---------------------
	;STATUS UND FARBCODE FÜR LEISTUNGEN ERMITTELN ;Status And to LEISTUNGEN find 
	SET COLOR=""
	SET LINKTXT=YAUF_","_YPOS_","_YTEIL
	;LINK SETZEN ;typeset 
	;DO
	. NEW YKEY
	. SET YLINK="<A"
	. SET YLINK=YLINK_" TITLE="_YAUF_","_YPOS_","_YTEIL
	. SET YLINK=YLINK_" HREF="_""""_YAKTION_"EP=WWWFORM"
	. IF YTEIL="" SET YLINK=YLINK_"&YFORM="_"INANGPT1"_"&YKEY="_YAUF_","_YPOS_"&YBACK="_BACK_"," QUIT  ;HAUPTTEIL
	. IF YTEIL'="" IF YAART=2 SET YLINK=YLINK_"&YFORM="_"INANGPT"_"&YKEY="_YAUF_","_YPOS_","_YTEIL_"&YBACK="_BACK_"," QUIT
	. IF YTEIL'="" IF YAART'=2 SET YLINK=YLINK_"&YFORM="_"INANGPT0"_"&YKEY="_YAUF_","_YPOS_","_YTEIL_"&YBACK="_BACK_"," QUIT
	. QUIT
	DO
	. NEW YKEY
	. SET YLINK="<A"
	. SET YLINK=YLINK_" TITLE="_YAUF_","_YPOS_","_YTEIL
	. SET YLINK=YLINK_" HREF="_""""_YAKTION_"EP=WWWFORM"
	. SET YLINK=YLINK_"&YFORM="_"INANGPTT1"_"&YKEY="_YAUF_","_YPOS_"&YBACK="_BACK_"," QUIT  ;HAUPTTEIL
	. QUIT
	;DATEN SCHREIBEN ;write 
	;============================================
	SET ANZM=ANZM+1
	WRITE "<TR>"
	WRITE YCR
	SET YDDSATZ=YDDSATZ+1
	;--------------------------------------------
	;ARTIKEL NUMMER ;item numeral 
	WRITE "<TD NOWRAP ALIGN=RIGHT VALIGN=TOP"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE 
	WRITE ">"
	WRITE "<FONT SIZE=1>"
	IF ANZINF=2 WRITE "<B>"
	WRITE YCR
	WRITE YLINK
	DO ^WWWCGI
	WRITE """"
	IF YTARGET'="" WRITE " TARGET="_YTARGET
	WRITE ">"
	WRITE $PIECE(YPOS1,Y,4)
	WRITE "</A>"
	WRITE "&nbsp;"
	IF ANZINF=2 WRITE "</B>"
	WRITE "</TD>"
	WRITE YCR
	;-----------------------------------------------
	;BEZEICHNUNG ;notation 
	WRITE "<TD NOWRAP VALIGN=TOP"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=1>"
	IF ANZINF=2 WRITE "<B>"
	WRITE YCR
	WRITE YLINK
	DO ^WWWCGI
	WRITE """"
	IF YTARGET'="" WRITE " TARGET="_YTARGET
	WRITE ">"
	WRITE $EXTRACT($PIECE(YPOS1,Y,1),1,30)
	WRITE "</A>"
	WRITE "&nbsp;"
	IF ANZINF=2 WRITE "</B>"
	WRITE "</TD>"
	WRITE YCR
	;-------------------------------------------
	;MENGE ;quantum 
	WRITE "<TD NOWRAP VALIGN=TOP ALIGN=RIGHT"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=1>"
	WRITE YCR
	IF +$PIECE(YPOS1,Y,39)'=0 IF YAART'=2 WRITE $$^WWWZAHL($PIECE(YPOS1,Y,39),0,$LENGTH($PIECE($PIECE(YPOS1,Y,39),".",2)))
	IF $PIECE(YPOS1,Y,40)'="" IF $DATA(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(YPOS1,Y,40),1)) WRITE "&nbsp;"_$EXTRACT($P($GET(^(1)),Y,1),1,13)
	WRITE "&nbsp;"
	WRITE YCR
	WRITE "</TD>"
	WRITE YCR
	;-------------------------------------------
	;GEWICHT ;wt. 
	WRITE "<TD NOWRAP VALIGN=TOP ALIGN=RIGHT"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=1>"
	WRITE YCR
	IF YAART'=2 DO
	. IF +$PIECE(YPOS1,Y,39)=0!(+$PIECE(YPOS1,Y,5)=0) QUIT  ;KEIN GEWICIHT ODER MENGE ;no Or quantum 
	. WRITE $TRANSLATE($JUSTIFY($PIECE(YPOS1,Y,43)/$PIECE(YPOS1,Y,5)*$PIECE(YPOS1,Y,39),0,2),".",",")
	. QUIT
	;IF YTEIL="" SET SUM(3)=$PIECE(YPOS1,Y,43)/$PIECE(YPOS1,Y,5)*$PIECE(YPOS1,Y,39)
	WRITE "&nbsp;"
	WRITE YCR
	WRITE "</TD>"
	WRITE YCR
	;-------------------------------------------
	;WERT ;worthy 
	WRITE "<TD NOWRAP VALIGN=TOP ALIGN=RIGHT"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=1>"
	WRITE YCR
	;PRÜFEN OB WERTANZEIGE ;sift whether 
	IF YTEIL="" IF $PIECE($GET(^INVORG(YM,YM,1)),Y,65)=1 DO  ;NUR HAUPTPOSITION STEMPELN ;only postmark 
	. IF START1'="" SET HAUPTBDE=1  ;FERTIGUNG GESTARTET
	. QUIT
	SET BDEZEIT=0
	IF ANZINF=1 IF YAART=2 IF HAUPTBDE=1 SET BDEZEIT=1  ;LEISTUNGEN IN HAUPTPOSITION BERÜCKSICHTIGT ;LEISTUNGEN within 
	IF +$PIECE(YPOS1,Y,39)=0 SET $PIECE(YPOS1,Y,39)=$PIECE(YPOS1,Y,5)
	IF +$PIECE(YPOS1,Y,39)=0 SET $PIECE(YPOS1,Y,39)=1
	SET YLOS=""
	SET LOSMENGE=0
	IF $PIECE(YPOS1,Y,4)'="" SET YLOS=$PIECE($GET(^INART(YM,$PIECE(YPOS1,Y,4),1)),Y,72)  ;LOSGRÖSSE
	IF +YLOS=0 SET YLOS=999999999
	SET LOSMENGE=$PIECE(YPOS1,Y,39)\YLOS
	IF +LOSMENGE=0 SET LOSMENGE=1
	IF YAART=2 DO  ;LEISTUNG ;performance 
	. ;
	. IF ANZINF=1 DO  ;UNTERTEIL
	. . IF BDEZEIT=0 DO  ;BDE NICHT VORHANDEN  ;factory data capture Not on hand 
	. . . WRITE $$^WWWZAHL($PIECE(YPOS1,Y,47)*$PIECE(YPOS1,Y,39),,2,YWHR)
	. . . SET SUM(4)=SUM(4)+($PIECE(YPOS1,Y,47)*$PIECE(YPOS1,Y,39))
	. . . SET SUM(6)=SUM(6)+($PIECE(YPOS1,Y,47)*$PIECE(YPOS1,Y,39))  ;LEISTUNGSANTEIL (OHNE BDE)
	. . . QUIT
	. . IF BDEZEIT=1 DO  ;BDE VORHANDEN  ;factory data capture on hand 
	. . . ;W "X"
	. . . ;KEINE VERÄNDERUNG ;no mutation 
	. . . QUIT
	. . QUIT
	. ;
	. IF ANZINF=2 DO  ;HAUPTTEIL
	. . IF BDEZEIT=0 DO  ;BDE NICHT VORHANDEN  ;factory data capture Not on hand 
	. . . WRITE $$^WWWZAHL((($PIECE(YPOS1,Y,74)+$PIECE(YPOS1,Y,75))*LOSMENGE),,2,YWHR)
	. . . SET SUM(4)=SUM(4)+(($PIECE(YPOS1,Y,74)+$PIECE(YPOS1,Y,75))*LOSMENGE)
	. . . SET SUM(7)=SUM(7)+(($PIECE(YPOS1,Y,74)+$PIECE(YPOS1,Y,75))*LOSMENGE)  ;ZUSATZKOSTENANTEIL
	. . . QUIT
	. . QUIT
	. QUIT
	IF YAART'=2 DO  ;KEINE LEISTUNG ;no performance 
	. ;
	. IF ANZINF=1 DO  ;UNTERTEIL
	. . IF BDEZEIT=0 DO  ;BDE NICHT VORHANDEN  ;factory data capture Not on hand 
	. . . IF +$PIECE(YPOS1,Y,5)'=0 WRITE $$^WWWZAHL($PIECE(YPOS1,Y,47)/$PIECE(YPOS1,Y,5)*$PIECE(YPOS1,Y,39),,2,YWHR)
	. . . IF +$PIECE(YPOS1,Y,5)'=0 SET SUM(4)=SUM(4)+($PIECE(YPOS1,Y,47)/$PIECE(YPOS1,Y,5)*$PIECE(YPOS1,Y,39))
	. . . IF +$PIECE(YPOS1,Y,5)'=0 SET SUM(5)=SUM(5)+($PIECE(YPOS1,Y,47)/$PIECE(YPOS1,Y,5)*$PIECE(YPOS1,Y,39))  ;MATERIALANTEIL
	. . . QUIT
	. ;
	. IF ANZINF=2 DO  ;HAUPTTEIL
	. . IF BDEZEIT=0 DO  ;BDE NICHT VORHANDEN  ;factory data capture Not on hand 
	. . . WRITE $$^WWWZAHL(($PIECE(YPOS1,Y,74)+$PIECE(YPOS1,Y,75))*LOSMENGE,,2,YWHR)
	. . . SET SUM(4)=SUM(4)+(($PIECE(YPOS1,Y,74)+$PIECE(YPOS1,Y,75))*LOSMENGE)
	. . . SET SUM(7)=SUM(7)+(($PIECE(YPOS1,Y,74)+$PIECE(YPOS1,Y,75))*LOSMENGE) ;ZUSATZKOSTENANTEIL
	. . . QUIT
	. QUIT
	WRITE "&nbsp;"
	WRITE YCR
	WRITE "</TD>"
	WRITE YCR
	WRITE "</TR>"
	QUIT
	
KOPF ;
	;KOPF ZEILE ;pate 
	WRITE YCR
	WRITE "<TH VALIGN=TOP NOWRAP align=CENTER"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=1>"
	WRITE $$^WWWTEXT(32024)  ;ARTIKEL ;item 
	WRITE "</TH>"
	WRITE YCR
	WRITE "<TH VALIGN=TOP NOWRAP align=CENTER WIDTH=15%"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=1>"
	WRITE $$^WWWTEXT(32026)  ;BEZEICHNUNG ;notation 
	WRITE "</TH>"
	WRITE YCR
	WRITE "<TH VALIGN=TOP NOWRAP align=CENTER"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=1>"
	WRITE $$^WWWTEXT(31407)  ;MENGE ;quantum 
	WRITE "</TH>"
	WRITE YCR
	WRITE "<TH VALIGN=TOP NOWRAP align=CENTER"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=1>"
	WRITE $$^WWWTEXT(32324)  ;GEWICHT ;wt. 
	WRITE "</TH>"
	WRITE YCR
	WRITE "<TH VALIGN=TOP NOWRAP align=CENTER"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=1>"
	WRITE $$^WWWTEXT(32325)  ;WERT ;worthy 
	WRITE "</TH>"
	WRITE YCR
	WRITE "</TR>"
	SET YDDSATZ=0
	QUIT
	
FUSS ;
	;SUMMEN ;purr 
	QUIT
	
ZEILE ;
	QUIT
]]></Routine>
</Export>