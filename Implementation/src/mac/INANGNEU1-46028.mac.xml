<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INANGNEU1" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INANGNEU1
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		VERTEILEN KUNDENSUCHE FÜR ANGEBOTE 
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 03-Feb-2009	GRF		Doco; quits; naked references
	; 27.10.2000	DT
	;-------------------------------------------------------------------------------
	NEW YI,ANGGOE,ACCVK,ACCAL,ACCKD,ACCEI,ACCLE,ACCRE
	
	;----------------------------------BERECHTIGUNGEN----------------------------------fan 07.05.03
	;SET ACCVK=$$^WWWACCESS("",$PIECE($GET(^INVORG(YM,YM,1)),Y,22))      ;BERECHTIGUNGEN VON VK-PREISE
	SET ACCAL=$$^WWWACCESS("",$PIECE($GET(^WWW124(0,"INANGBANZ",SPRACHE,3,1)),Y,23))      ;BERECHTIGUNGEN VON ALLE AUFTRAG ;mandate 
	SET ACCKD=$$^WWWACCESS("",$PIECE($GET(^WWW124(0,"INANGFBANZ",SPRACHE,4,1)),Y,23))     ;BERECHTIGUNGEN VON KUNDE AUFTRAG ;lore mandate 
	IF ACCKD=1 SET ACCKD=$$^WWWACCESS("",$PIECE($GET(^INVORG(YM,YM,1)),Y,35))             ;BERECHTIGUNGEN VON KUNDE AUFTRAG ;lore mandate 
	SET ACCEI=$$^WWWACCESS("",$PIECE($GET(^WWW124(0,"INANGBANZ",SPRACHE,8,1)),Y,23))      ;BERECHTIGUNGEN VON EIGEN AUFTRAG ;personal mandate 
	SET ACCLE=$$^WWWACCESS("",$PIECE($GET(^WWW124(0,"INANGBANZ",SPRACHE,6,1)),Y,23))      ;BERECHTIGUNGEN VON LIEF AUFTRAG ;mandate 
	SET ACCRE=$$^WWWACCESS("",$PIECE($GET(^WWW124(0,"INANGBANZ",SPRACHE,7,1)),Y,23))      ;BERECHTIGUNGEN VON RE AUFTRAG ;mandate 
	;-------------------
	FOR YI=1:1:11 SET VORG(YI)=$GET(VORG(YI))
	SET ANGGOE=0
	IF $GET(YFORM)="INANGGOENEU" SET ANGGOE=1  ;ANGEBOTSERFASSUNG GÖBEL
	IF VORG(2)'="" IF $DATA(^INKUNDE(YM,VORG(2))) SET VORG(1)=VORG(2)  ;KUNDENNUMMER ALS AUSWAHL ;when Selection 
	IF VORG(3)'="" SET VORG(1)=VORG(3)  ;VOLLTEXTSUCHE KUNDEN
	SET VORG(1)="#"_$GET(VORG(1))  ;NORMALE SUCHE ;search 
	;IF $G(VORG(4))'="" SET VORG(1)="-"_VORG(4)  ;SUCHE NACH ANGEBOTNUMMER ;ALT , WENN ALLE ANGEBOTE ANGEZEIGT WERDEN ;TYBD 13.07.2002
	;IF VORG(5)'="" IF $DATA(^INANG(YM,VORG(5))) SET VORG(1)="-"_VORG(5)  ;SUCHE NACH ANGEBOTSNUMMER
	IF VORG(11)'="" SET VORG(5)=VORG(11)
	IF VORG(5)'="" IF $DATA(^INANG(YM,VORG(5),1)) SET ANG1=$GET(^INANG(YM,VORG(5),1)) DO       ; naked ref
	. IF $PIECE(ANG1,Y,14)=YBED SET VORG(1)="-"_VORG(5)    ;FAN;27.01.2004 ;buff 
	. IF +$PIECE(ANG1,Y,169)'=0 IF ACCRE=1 SET VORG(1)="-"_VORG(5)  ;REKLAMATIONEN
	. IF +$PIECE(ANG1,Y,169)=0 DO
	. . IF $PIECE(ANG1,Y,2)="" SET $PIECE(ANG1,Y,2)=0
	. . IF $PIECE(ANG1,Y,2)=0 IF ACCKD=1 SET VORG(1)="-"_VORG(5)      ;KUNDE ANGTRAG ;lore 
	. . IF $PIECE(ANG1,Y,2)=1 IF ACCEI=1 SET VORG(1)="-"_VORG(5)      ;EIGENE ANGTRAG
	. . IF $PIECE(ANG1,Y,2)=2 IF ACCLE=1 SET VORG(1)="-"_VORG(5)      ;LIEFERRANTEN-BESTELLUNGEN
	
	IF VORG(2)'="" IF VORG(5)'="" IF $DATA(^INKUNDE(YM,VORG(2))) IF '$DATA(^INANG(YM,VORG(5))) DO  ;NEUANLAGE KUNDENANGEBOT MIT SPEZ. ANGEBOTSNUMMER ;by means of 
	. SET VORG(1)="*"_VORG(2)_"#"_VORG(5)
	
	SET ARTIKEL=""  ;AUS ARTIKELANLAGE ;out of 
	IF VORG(6)=1 DO  QUIT  ;EIGENAUFTRAG                      ; *** EARLY EXIT ***
	. DO NEU^INANGNEU1("EIGEN")
	
	IF (VORG(7)'="") || (VORG(8)'="") DO   ;LIEFERANTEN
	. IF VORG(7)'="" IF $DATA(^INLIEF(YM,VORG(7))) DO  QUIT
	. . SET VORG(1)="."_VORG(7)  ;LIEFERANTENNUMMER ALS SUCHFUNKTION ;when 
	. . IF VORG(11)'="" IF '$DATA(^INANG(YM,VORG(11))) SET VORG(1)="*"_VORG(1)_"#"_VORG(11)  ;NEUANLAGE LF-ANFRAGE MIT SPEZ. AUFTRAGSNUMMER ;by means of 
	. ;
	. IF VORG(8)'="" SET VORG(1)="."_VORG(8)  ;VOLLTEXTSUCHE NACH LIEFERANTEN ;within 
	
	IF VORG(9)'=""!(VORG(10)'="") DO   ;WERBEADRESSEN
	. IF VORG(9)'="" IF $DATA(^INWERBADR(YM,VORG(9))) SET VORG(1)=":"_VORG(9)  ;WERBEADRESSNUMMER ALS SUCHFUNKTION ;when 
	. IF VORG(10)'="" SET VORG(1)=":"_VORG(10)  ;VOLLTEXTSUCHE NACH WERBEADRESSEN ;within 
	
	;ULM;25.09.2002 ANLEGEN ANGEBOT AUS GOEBELANFRAGENUMMER ;put onto proposition out of 
	IF ANGGOE=1 IF VORG(11)'="" DO ^INKUNDEANFRANG(VORG(11)) QUIT
	IF $EXTRACT(VORG(1))="-" DO  QUIT   ;AUSWAHL DER ANGEBOTES SPRUNG AUF ANGEBOTSBEARBEITUNG ;Selection the rift upon 
	. SET %("VAR","YKEY")=$EXTRACT(VORG(1),2,99)
	. SET %("VAR","YBACK")="INANGNEU,"
	. IF ANGGOE=1 SET %("VAR","YBACK")="INANGGOENEU,"  ;ALTERNATIVE ERFASSUNG GÖBEL ;option logging 
	. SET %("VAR","YFORM")="INANG"
	. DO ^WWWFORM
	
	SET %("VAR","YBACK")="INANGNEU,"
	IF ANGGOE=1 SET %("VAR","YBACK")="INANGGOENEU,"  ;ALTERNATIVE ERFASSUNG GÖBEL ;option logging 
	SET %("VAR","YAUSWAHL")=VORG(1)
	SET %("VAR","YFORM")="INANGNEU"
	IF ANGGOE=1 SET %("VAR","YFORM")="INANGGOENEU"  ;ALTERNATIVE ERFASSUNG GÖBEL ;option logging 
	DO ^WWWFORM
	QUIT
	
	
NEU(KDNR,ANSPR,ANGNR,ANFRAGE,CALL,AUFTYPE)       ;NEUES ANGEBOT ANLEGEN   ;ÜBERTRAGEN AUS SERVICENUMMER;FAN;09.03.04;25171
	SET ANGGOE=0
	IF $GET(%(YQUERY,"YBACK"))="INANGGOENEU," SET ANGGOE=1  ;ALTERNATIVE ANGEBOTSERFASSUNG GÖBEL ;option 
	SET VORG(1)=$GET(KDNR)   ;KUNDENNUMMER
	QUIT:VORG(1)=""
	
	SET ANSPR=$GET(ANSPR)   ;ANSPRECHPARTNER
	SET ANGNR=$GET(ANGNR)   ;ANGEBOTSNUMMER AUSWAHL ;Selection 
	SET ANFRAGE=$GET(ANFRAGE)   ;AUS ANFRAGE GENERIERT ;out of 
	SET CALL=$GET(CALL)
	IF $PIECE(KDNR,",",5)'="" DO        ;25963;ÜBERTRAGEN AUS SERVICENUMMER;FAN;24.06.04
	. SET VORG(1) = $PIECE(KDNR,",",1)
	. SET ANSPR   = $PIECE(KDNR,",",2)
	. SET CALL    = $PIECE(KDNR,",",5)
	
	SET YKEY=""
	IF ANGNR'="" IF '$DATA(^INANG(YM,ANGNR)) SET YKEY=ANGNR SET ^INANG(YM,ANGNR,1)=""  ;LOCK ANGEBOTSNUMMER
	IF YKEY="" SET YKEY=$$^WWWNEXT("INANG")
	;PRUEFEN OB NEUER DATENSATZ ;whether data record 
	SET YKEYALT=YKEY-1      ; ALTER DATENSATZ ;governor data record 
	;)
	IF $PIECE($GET(^INANG(YM,YKEYALT,1)),Y,200)=($GET(YTRAKT)-2) IF $PIECE($GET(^INANG(YM,YKEYALT,1)),Y,4)=+$HOROLOG DO  QUIT
	. SET %("VAR","YKEY")=YKEYALT   ;SCHLÜSSEL AUFTRAGSNUMMER ;wrench 
	. SET YKEY=YKEYALT
	. SET %("VAR","YBACK")="INANGNEU,"  ;ZURÜCK ;retro- 
	. SET %("VAR","YFORM")="INANG"
	. IF ANGGOE=1 SET %("VAR","YBACK")="INANGGOENEU,"  ;ZURÜCK ;retro- 
	. IF ANGGOE=1 SET %("VAR","YFORM")="INANGGOE"
	. DO ^WWWFORM  ;ALTER AUFTRAG ;governor mandate 
	
	
	SET %("VAR","YKEY")=YKEY   ;SCHLÜSSEL ANGEBOTSNUMMER ;wrench 
	SET %("VAR","YBACK")="INANGNEU,"  ;ZURÜCK ;retro- 
	IF ANGGOE=1 SET %("VAR","YBACK")="INANGGOENEU,"  ;ZURÜCK ;retro- 
	
	SET YFELD=""  ;VARIABEL
	SET $PIECE(YFELD,Y,14)=YBED   ;ZUSTÄNDIGER MITARBEITER
	IF ANSPR'="" DO 
	. NEW NAME,ANREDE,ANSPR1
	. SET ANSPR1=$GET(^INPARTN(YM,VORG(1),ANSPR,1))
	. SET NAME=$PIECE(ANSPR1,Y,2)
	. ;IF $P(ANSPR1,Y,3)'="" SET NAME=$P(ANSPR1,Y,3)_" "_NAME  ;DEAKTIVIERT, DA ZU LANGER TEXT ; FIS,14.05.02
	. SET ANREDE=$PIECE(ANSPR1,Y,1)
	. IF +ANREDE'=0 SET NAME=$PIECE($GET(^INPARA(YM,"ANREDE",SPRACHE,ANREDE,1)),Y,1)_" "_NAME
	. SET $PIECE(YFELD,Y,10)=NAME  ;ANSPRECHPARTNER = AUFTRAGSERTEILUNG DURCH ;trans- 
	. SET $PIECE(YFELD,Y,305)=NAME                   ;BEC;25523;14.04.04;Ansprechpartner im Auftrag
	. SET $PIECE(YFELD,Y,306)=$PIECE(ANSPR1,Y,6)     ;BEC;25523;14.04.04;Tel  
	. SET $PIECE(YFELD,Y,307)=$PIECE(ANSPR1,Y,7)     ;BEC;25523;14.04.04;FAX
	. SET $PIECE(YFELD,Y,308)=$PIECE(ANSPR1,Y,8)     ;BEC;25523;14.04.04;EMAIL  
	
	
	SET YSATZ=$GET(^INKUNDE(YM,VORG(1),1))   ;KUNDENNUMMER
	IF YSATZ'="" DO  QUIT  ;ANGEBOT VON KUNDEN ;proposition 
	. DO DFLT  ;VORGABE;TYBD;21,7,2004;26119
	. SET $PIECE(YFELD,Y,1)=VORG(1)   ;KUNDE ;lore 
	. SET $PIECE(YFELD,Y,2)=0   ;kundenANGEBOT
	. SET $PIECE(YFELD,Y,4)=+$HOROLOG   ;ANGEBOTSDATUM
	. SET $PIECE(YFELD,Y,41)=+$HOROLOG   ;ERFASSUNGSDATUM
	. SET $PIECE(YFELD,Y,42)=YBED   ;MITARBEITER
	. SET $PIECE(YFELD,Y,5)=+$PIECE($HOROLOG,",",2)   ;ANGEBOTSUHRZEIT
	. SET $PIECE(YFELD,Y,6)=YLOCATION   ;BETRIEB
	. SET $PIECE(YFELD,Y,313)=YLOCATION   ;ERFASSUNGSBETRIEB;06.07.04;FIS;25803
	. SET $PIECE(YFELD,Y,13)=$PIECE(YSATZ,Y,8)   ;TEXT
	. SET $PIECE(YFELD,Y,15)=$PIECE(YSATZ,Y,15)   ;BELEG DRUCK AN ;proof printing upon 
	. SET $PIECE(YFELD,Y,144)=ANFRAGE   ;ANFRAGENUMMER
	. IF $GET(CALL)'="" SET $PIECE(YFELD,Y,304)=$GET(CALL)  ;;ÜBERTRAGEN AUS SERVICENUMMER;FAN;09.03.04;25171
	. ;
	. ;---------------------------------------------------------------RECHNUNGSEMPFANG----FAN 15.10.2001
	. MERGE ^INANGA(YM,YKEY)=^INKUNDEA(YM,VORG(1))  ;ANSCHRIFTEN
	. IF $PIECE(YSATZ,Y,38)'="" MERGE ^INANGA(YM,YKEY,7,1)=^INKUNDEA(YM,$PIECE(YSATZ,Y,38),7,1)  ;ANSCHRIFTEN
	. ;---------------------------------------------------------------
	. ;
	. SET $PIECE(YFELD,Y,312)=$PIECE(YSATZ,Y,234)     ;BEC;25693;21.06.04;lIEFERSCHEIN MIT RECHNUNG
	. ;
	. SET $PIECE(YFELD,Y,51)=$PIECE(YSATZ,Y,51)   ;WÄHRUNG KUNDE ;money standard lore 
	. ;IF $PIECE(YFELD,Y,51)'="" IF $PIECE(YFELD,Y,51)'=YWHR SET $PIECE(YFELD,Y,314)=$PIECE($GET(^WWWWAE(0,$PIECE(YFELD,Y,51),1)),Y,5)   ;EXCHANGE RATE;FIS;26316;24.08.04
	. SET $PIECE(YFELD,Y,70)=$PIECE(YSATZ,Y,70)   ;NACHLASS %
	. SET $PIECE(YFELD,Y,71)=$PIECE(YSATZ,Y,71)   ;NACHLASS GESAMT ;total 
	. SET $PIECE(YFELD,Y,56)=$PIECE(YSATZ,Y,56)   ;kondition
	. SET $PIECE(YFELD,Y,57)=$PIECE(YSATZ,Y,57)   ;SONDER kondition;TYBD;7,5,2005
	. SET $PIECE(YFELD,Y,74)=$PIECE(YSATZ,Y,74)   ;SKONTO
	. SET $PIECE(YFELD,Y,75)=$PIECE(YSATZ,Y,75)   ;SKONTO TAGE
	. SET $PIECE(YFELD,Y,76)=$PIECE(YSATZ,Y,76)   ;NETTO TAGE
	. SET $PIECE(YFELD,Y,200)=YTRAKT  ;SAVED BEI TRANSAKTION ;next to 
	. SET $PIECE(YFELD,Y,202)=(+$HOROLOG+(+($PIECE($GET(^INVORG(YM,YM,1)),Y,25))))   ;ANGEBOT GÜLTIG BIS ;proposition valuable until 
	. ;
	. IF $PIECE($GET(^INVORG(YM,YM,1)),Y,4)=1 DO   ;NUR WENN KREDITLIMIT ;only when 
	. . IF $PIECE(YSATZ,Y,36)="" DO  QUIT  ;OHNEN KREDITGRUPPE
	. . . IF +$PIECE(YSATZ,Y,33)=0 SET $PIECE(YFELD,Y,38)=+$PIECE($GET(^INVORG(YM,YM,1)),Y,89) QUIT  ;KEIN KREDIT/ODER UNBESCHRÄNKT ;no absolute 
	. . . QUIT:$GET(VORG(1))=""
	. . . SET DEBIT=$PIECE($GET(^INKUNDE(YM,$GET(VORG(1)),1)),Y,48)
	. . . IF DEBIT'="" IF $FIND($$^INSALDO(DEBIT),"S")!($FIND($$^INSALDO(DEBIT),"D")) IF $PIECE(YSATZ,Y,33)<($$^INSALDO(DEBIT)+$$^INKUNDAUF(VORG(1),3)) SET $PIECE(YFELD,Y,38)=1   ;SPERRE WEGEN LIMIT;TYBD;14.04.2003 ;suspension quibble 
	. . ;
	. . IF $PIECE(YSATZ,Y,36)'="" DO  ;MIT KREDITGRUPPE ;by means of 
	. . . NEW KRED,KUN,SUM
	. . . SET SUM=0
	. . . SET $PIECE(YSATZ,Y,33)=$PIECE($GET(^INKUNDE(YM,$PIECE(YSATZ,Y,36),1)),Y,33)  ;KREDITLIMIT HAUPTKUNDE
	. . . IF +$PIECE(YSATZ,Y,33)=0 SET $PIECE(YFELD,Y,38)=+$PIECE($GET(^INVORG(YM,YM,1)),Y,89) QUIT  ;KEIN KREDIT/ODER UNBESCHRÄNKT ;no absolute 
	. . . SET DEBIT=$PIECE($GET(^INKUNDE(YM,$PIECE(YSATZ,Y,36),1)),Y,48)
	. . . IF DEBIT'="" IF $FIND($$^INSALDO(DEBIT),"S")!($FIND($$^INSALDO(DEBIT),"D")) SET SUM=SUM+$PIECE($$^INSALDO(DEBIT)," ",1)
	. . . IF DEBIT'="" IF $FIND($$^INSALDO(DEBIT),"H")!($FIND($$^INSALDO(DEBIT),"K")) SET SUM=SUM-$PIECE($$^INSALDO(DEBIT)," ",1)
	. . . SET KRED=""
	. . . FOR  SET KRED=$ORDER(^INKUNDEs(YM,8,$$^WWWUMLAU($PIECE(YSATZ,Y,36),1),KRED)) QUIT:KRED=""  DO
	. . . . SET KUN=""
	. . . . FOR  SET KUN=$ORDER(^INKUNDEs(YM,8,$$^WWWUMLAU($PIECE(YSATZ,Y,36),1),KRED,KUN)) QUIT:KUN=""  DO
	. . . . . SET DEBIT=$PIECE($GET(^INKUNDE(YM,KUN,1)),Y,48)
	. . . . . QUIT:DEBIT=""
	. . . . . IF $FIND($$^INSALDO(DEBIT),"S")!($FIND($$^INSALDO(DEBIT),"D")) SET SUM=SUM+$PIECE($$^INSALDO(DEBIT)," ",1)
	. . . . . IF $FIND($$^INSALDO(DEBIT),"H")!($FIND($$^INSALDO(DEBIT),"K")) SET SUM=SUM-$PIECE($$^INSALDO(DEBIT)," ",1)
	. . . ;
	. . . IF $PIECE(YSATZ,Y,33)<(SUM+$$^INKUNDAUF(VORG(1),3)) SET $PIECE(YFELD,Y,38)=1   ;SPERRE WEGEN LIMIT;TYBD;14.04.2003 ;suspension quibble 
	. ;
	. IF $PIECE(YSATZ,Y,32)=1 SET $PIECE(YFELD,Y,38)=1  ;KUNDE GESPERRT ;customer DISABLED 
	. IF $PIECE(YSATZ,Y,246)'="" SET $PIECE(YFELD,Y,38)=1,$PIECE(YFELD,Y,238)=$PIECE(YSATZ,Y,246)  ;KUNDENAUFTRÄGE SPERREN; BLOCK CUSTOMER ORDERS;FIS;03.01.05;26981 
	. ;IF $PIECE($GET(^INVORG(YM,YM,1)),Y,66)=1 SET $PIECE(YFELD,Y,38)=1  ;AUTOMATISCHE SPERRE BEI NEUANLAGE -> NUR LF-BESTELLUNGEN
	. ;
	. SET YA=$$^WWWSPEI("INANG",YKEY,YFELD,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	. SET ^INANG1(YM,YKEY,1)=$PIECE(YSATZ,Y,8)_Y_0_Y_Y_+$HOROLOG  ;OFFENER ANGEBOT ;proposition 
	. SET %("VAR","YFORM")="INANG"
	. IF ANGGOE=1 SET %("VAR","YFORM")="INANGGOE"  ;ALTERNATIVE ERFASSUNG GÖBEL ;option logging 
	. SET %("VAR","YKEY")=YKEY
	. DO  ;KONTAKT SPEICHERN ;contact Save 
	. . NEW LFN
	. . SET LFN=$$^WWWNEXT1("INKUNDED",VORG(1),2)
	. . IF LFN'="" DO
	. . . NEW KONTAKT
	. . . SET KONTAKT=$PIECE($GET(^INVORG(YM,YM,1)),Y,76)
	. . . ;IF KONTAKT'="" SET ^INKUNDED(YM,VORG(1),LFN,1)=Y_YBED_Y_KONTAKT_Y_$PIECE(YFELD,Y,10)_Y_$$^WWWTEXT(32047)_" "_YKEY_Y_Y_Y_Y_Y_+$H_Y_$PIECE($H,",",2)_Y_Y_Y_Y_Y_Y_Y_Y
	. . . IF KONTAKT'="" DO   ;WEM;25658;11.05.2004;SPEICHERN ÜBER WWWSPEI
	. . . . NEW YVOR,YFORM,YOK,DS
	. . . . SET DS=""
	. . . . SET $PIECE(DS,Y,2)=YBED
	. . . . SET $PIECE(DS,Y,3)=KONTAKT
	. . . . SET $PIECE(DS,Y,4)=$PIECE(YFELD,Y,10)
	. . . . ;SET $PIECE(DS,Y,5)=$$^WWWTEXT(32047)_" "_YKEY
	. . . . SET $PIECE(DS,Y,5)=$$^WWWTEXT(32178)_" "_YKEY         ;BEC;30.06.04;ANGEBOT GEÄNDERT ;proposition 
	. . . . SET $PIECE(DS,Y,10)=+$HOROLOG
	. . . . SET $PIECE(DS,Y,11)=$PIECE($HOROLOG,",",2)
	. . . . ;SET YOK=$$^WWWSPEI("INKUNDED",VORG(1)_","_LFN,DS,1)   ;WEM;11.05.2004;AUSKOMMENTIERT, DA ES NICHT FUNKTIONIERT HAT
	. . . . SET ^INKUNDED(YM,VORG(1),LFN,1)=DS
	. . . . DO ^WWWSSORT("INKUNDED",VORG(1)_","_LFN)
	. ;
	. DO ^WWWFORM ;NEUES ANGEBOT ;something new proposition 
	
	
	IF VORG(1)="EIGEN" DO  QUIT  ;EIGENAUFTRAG OHNE KUNDEN ;without 
	. DO DFLT  ;VORGABE;TYBD;21,7,2004;26119
	. SET $PIECE(YFELD,Y,1)=""   ;KUNDE ;lore 
	. SET $PIECE(YFELD,Y,2)=1   ;EIGENAUFTRAG
	. SET $PIECE(YFELD,Y,4)=+$HOROLOG   ;AUFTRAGSDATUM
	. SET $PIECE(YFELD,Y,41)=+$HOROLOG   ;ERFASSUNGSDATUM
	. SET $PIECE(YFELD,Y,42)=YBED   ;MITARBEITER
	. SET $PIECE(YFELD,Y,5)=+$PIECE($HOROLOG,",",2)   ;AUFTRAGSUHRZEIT
	. SET $PIECE(YFELD,Y,6)=YLOCATION   ;BETRIEB
	. SET $PIECE(YFELD,Y,313)=YLOCATION   ;ERFASSUNGSBETRIEB;06.07.04;FIS;25803
	. SET $PIECE(YFELD,Y,13)=$$^WWWTEXT(32037)   ;TEXT
	. SET $PIECE(YFELD,Y,200)=YTRAKT  ;SAVED BEI TRANSAKTION ;next to 
	. SET YA=$$^WWWSPEI("INANG",YKEY,YFELD,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	. SET ^INANG1(YM,YKEY,1)=$$^WWWTEXT(32037)_Y_1_Y_Y_+$HOROLOG  ;OFFENER AUFTRAG "Eigenauftrag"
	. SET %("VAR","YFORM")="INANG"
	. ;IF ANGGOE=1 SET %("VAR","YFORM")="INANGGOE"  ;ALTERNATIVE ERFASSUNG GÖBEL
	. SET %("VAR","YKEY")=YKEY
	. DO ^WWWFORM ;NEUER AUFTRAG ;mandate 
	
	
	SET YSATZ=$GET(^INLIEF(YM,VORG(1),1))   ;LIEFERANTENUMMER
	IF YSATZ'="" DO  QUIT                   ;ANFRAGE AN LIEFERANT ;upon supplier 
	. DO DFLT                               ;VORGABE;TYBD;21,7,2004;26119
	. SET $PIECE(YFELD,Y,12)  = VORG(1)                    ;LIEFERANT ;supplier 
	. SET $PIECE(YFELD,Y,2)   = 2                          ;LIEFERANTENANFRAGE
	. SET $PIECE(YFELD,Y,4)   = +$HOROLOG                  ;ANFRAGEDATUM
	. SET $PIECE(YFELD,Y,41)  = +$HOROLOG                  ;ERFASSUNGSDATUM
	. SET $PIECE(YFELD,Y,42)  = YBED                       ;MITARBEITER
	. SET $PIECE(YFELD,Y,5)   = +$PIECE($HOROLOG,",",2)    ;ANFRAGEUHRZEIT
	. SET $PIECE(YFELD,Y,6)   = YLOCATION                  ;BETRIEB
	. SET $PIECE(YFELD,Y,313) = YLOCATION                  ;ERFASSUNGSBETRIEB;06.07.04;FIS;25803
	. SET $PIECE(YFELD,Y,200) = YTRAKT                     ;SAVED BEI TRANSAKTION ;next to 
	. SET $PIECE(YFELD,Y,13)  = $PIECE(YSATZ,Y,8)          ;TEXT
	. SET $PIECE(YFELD,Y,15)  = $PIECE(YSATZ,Y,15)         ;BELEG DRUCK AN ;proof printing upon 
	. SET $PIECE(YFELD,Y,51)  = $PIECE(YSATZ,Y,51)         ;FOREIGN CURRANCY;FIS;26316;24.08.04
	. ;IF $PIECE(YFELD,Y,51)'="" IF $PIECE(YFELD,Y,51)'=YWHR SET $PIECE(YFELD,Y,314)=$PIECE($GET(^WWWWAE(0,$PIECE(YFELD,Y,51),1)),Y,5)   ;EXCHANGE RATE;FIS;26316;24.08.04
	. ;
	. ;MERGE ^INANGA(YM,YKEY,1)=^INLIEFA(YM,VORG(1),1)  ;ANSCHRIFTEN nicht vorhanden
	. ;
	. SET YA=$$^WWWSPEI("INANG",YKEY,YFELD,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	. SET ^INANG1(YM,YKEY,1)=$PIECE(YSATZ,Y,8)_Y_2_Y_Y_+$HOROLOG  ;OFFENER AUFTRAG ;mandate 
	. SET %("VAR","YKEY")=YKEY
	. SET %("VAR","YFORM")="INANG"
	. ;IF ANGGOE=1 SET %("VAR","YFORM")="INANGGOE"  ;ALTERNATIVE ERFASSUNG GÖBEL
	. DO ^WWWFORM  ;NEUE ANFRAGE
	
	
	SET YSATZ=$GET(^INWERBADR(YM,VORG(1),1))   ;WERBENUMMER
	IF YSATZ'="" DO  QUIT  ;ANGEBOT AN WERBEADRESSE ;proposition upon 
	. DO DFLT  ;VORGABE;TYBD;21,7,2004;26119
	. SET $PIECE(YFELD,Y,1)=VORG(1)   ;WERBENUMMER
	. SET $PIECE(YFELD,Y,2)=0   ;ANGEBOT ;proposition 
	. SET $PIECE(YFELD,Y,4)=+$HOROLOG   ;ANGEBOTSDATUM
	. SET $PIECE(YFELD,Y,5)=+$PIECE($HOROLOG,",",2)   ;ANGEBOTSUHRZEIT
	. SET $PIECE(YFELD,Y,6)=YLOCATION   ;BETRIEB
	. SET $PIECE(YFELD,Y,313)=YLOCATION   ;ERFASSUNGSBETRIEB;06.07.04;FIS;25803
	. SET $PIECE(YFELD,Y,13)=$PIECE(YSATZ,Y,8)   ;TEXT
	. SET $PIECE(YFELD,Y,15)=$PIECE(YSATZ,Y,15)   ;BELEG DRUCK AN ;proof printing upon 
	. SET $PIECE(YFELD,Y,56)=$PIECE(YSATZ,Y,56)   ;kondition
	. ;
	. SET $PIECE(YFELD,Y,200)=YTRAKT  ;SAVED BEI TRANSAKTION ;next to 
	. SET $PIECE(YFELD,Y,202)=(+$HOROLOG+(+($PIECE($GET(^INVORG(YM,YM,1)),Y,25))))   ;ANGEBOT GÜLTIG BIS ;proposition valuable until 
	. ;
	. SET YA=$$^WWWSPEI("INANG",YKEY,YFELD,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	. SET ^INANG1(YM,YKEY,1)=$PIECE(YSATZ,Y,8)_Y_0_Y_Y_+$HOROLOG  ;OFFENES ANGEBOT ;proposition 
	. SET %("VAR","YFORM")="INANG"
	. IF ANGGOE=1 SET %("VAR","YFORM")="INANGGOE"  ;ALTERNATIVE ERFASSUNG GÖBEL ;option logging 
	. SET %("VAR","YKEY")=YKEY
	. DO  ;KONTAKT SPEICHERN ;contact Save 
	. . NEW LFN
	. . SET LFN=$$^WWWNEXT1("INWERBADR1",VORG(1),2)
	. . IF LFN'="" DO   ;WEM;25658;10.05.2004;PRÜFUNG DES PARAMETERS KONTAKTE ERSTELLEN
	. . . NEW KONTAKT
	. . . SET KONTAKT=$PIECE($GET(^INVORG(YM,YM,1)),Y,76)
	. . . ;IF KONTAKT'="" SET ^INWERBADR1(YM,VORG(1),LFN,1)=Y_YBED_Y_KONTAKT_Y_$PIECE(YFELD,Y,10)_Y_$$^WWWTEXT(32047)_" "_YKEY_Y_Y_Y_Y_Y_+$H_Y_$PIECE($H,",",2)_Y_Y_Y_Y_Y_Y_Y_Y
	. . . IF KONTAKT'="" DO   ;WEM;25658;11.05.2004;SPEICHERN ÜBER WWWSPEI
	. . . . NEW YVOR,YFORM,YOK,DS
	. . . . SET DS=""
	. . . . SET $PIECE(DS,Y,2)=YBED
	. . . . SET $PIECE(DS,Y,3)=KONTAKT
	. . . . SET $PIECE(DS,Y,4)=$PIECE(YFELD,Y,10)
	. . . . SET $PIECE(DS,Y,5)=$$^WWWTEXT(32047)_" "_YKEY
	. . . . SET $PIECE(DS,Y,10)=+$HOROLOG
	. . . . SET $PIECE(DS,Y,11)=$PIECE($HOROLOG,",",2)
	. . . . ;SET YOK=$$^WWWSPEI("INWERBADR1",VORG(1)_","_LFN,DS,1)   ;WEM;11.05.2004;AUSKOMMENTIERT, DA ES NICHT FUNKTIONIERT HAT
	. . . . SET ^INWERBADR1(YM,VORG(1),LFN,1)=DS
	. . . . DO ^WWWSSORT("INWERBADR1",VORG(1)_","_LFN)
	. . ;
	. . ;IF LFN'="" DO
	. . ;. SET ^INWERBADR1(YM,VORG(1),LFN,1)=Y_YBED_Y_12_Y_$PIECE(YFELD,Y,10)_Y_$$^WWWTEXT(32178)_" "_YKEY_Y_Y_Y_Y_Y_+$HOROLOG_Y_$PIECE($HOROLOG,",",2)_Y_Y_Y_Y_Y_Y_Y_Y
	. ;
	. DO ^WWWFORM  ;NEUES ANGEBOT ;something new proposition 
	
	QUIT
	
DFLT ; VORGABEN AUS CUSTOMIZING  ;TYBD;21,7,2004;26119;
	NEW YBBN,YFORM,YLFN,YSATZ,YSATZ1
	
	SET YFORM="INANG"
	DO
	. SET YBBN=""
	. FOR  SET YBBN=$ORDER(^WWW122D(0,YFORM,YBBN)) QUIT:YBBN=""  DO
	. . SET YSATZ=$GET(^WWW122(0,YFORM,YBBN,1))  ;FELDDEFINITION
	. . SET YLFN=$PIECE(YSATZ,Y,1)  ;DATENBANKFELD
	. . QUIT:YLFN=""
	. . IF $DATA(^WWW122D(0,YFORM,YBBN,YM,1)) DO
	. . . NEW YSATZ1
	. . . SET YSATZ1=$GET(^WWW122D(0,YFORM,YBBN,YM,1))         ; naked ref
	. . . IF $PIECE(YSATZ1,Y,1)'="" SET $PIECE(YFELD,Y,YLFN)=$PIECE(YSATZ1,Y,1)  ;SONDERVORGABE ;FIS;16.04.04;25550;SPEICHERN VORBELEGUNG FÜR PRÜFEN SAVE OHNE DATENFELDER
	
	QUIT
]]></Routine>
</Export>