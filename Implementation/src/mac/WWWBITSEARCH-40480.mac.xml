<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWBITSEARCH" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWBITSEARCH(YINHALT,YDATEI,YLFDAT) ;WWWBITSEARCH;FIS;FULLTEXT BITSEARCH;22.11.2004  ; Compiled March 16, 2005 15:56:17
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		FULLTEXT BITSEARCH
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| 30-May-2005		RobertW		SR12056: Attempt at Performance Increase
	;| FIS	22.11.2004  
	;|
	;\------------------------------------------------------------------/
	;
	;
	NEW YRESULT
	;
	IF $GET(YFORM)="" QUIT ""   ;CURRENT FORM
	IF $GET(YDATEI)="" QUIT ""  ;SEARCH IN CLASS
	SET YINHALT=$GET(YINHALT)   ;SEARCH TEXT
	SET YLFDAT=$GET(YLFDAT)     ;SEARCH BIT IN FIELD
	IF YLFDAT="" SET YLFDAT="Y"_YDATEI_"D"_9999  ;FULLTEXT SEARCH
	;
	SET YINHALT=$$PREPARE(YINHALT)  ;KORRIGIEREN SUCHBEGRIFF
	SET YINHALT=$$EXPAND(YINHALT)  ;ERWEITERTE SUCHBEGRIFFE SUCHEN"Y"_YDATEI_"D"_9999
	SET YRESULT=$$SEARCH(YINHALT,YDATEI,YLFDAT)  ;ERWEITERTE SUCHBEGRIFFE SUCHEN
	QUIT YRESULT
	;
	;
	
PREPARE(YSEARCHTEXT)  ;VORBEREITEN SUCHBEGRIFF FÜR BITMAP SUCHE
	;
	SET YSEARCHTEXT=$zconvert($GET(YSEARCHTEXT),"U")
	QUIT:$TRANSLATE(YSEARCHTEXT," ")="" ""
	SET YSEARCHTEXT=$$^WWWTRANSLATE($$^WWWTRANSLATE(YSEARCHTEXT,"   ","  "),"  "," ")  ;MAX 1 LEERZEICHEN ;space character
	IF $EXTRACT(YSEARCHTEXT,$LENGTH(YSEARCHTEXT))=" " FOR  QUIT:$EXTRACT(YSEARCHTEXT,$LENGTH(YSEARCHTEXT))'=" "  SET YSEARCHTEXT=$EXTRACT(YSEARCHTEXT,1,$LENGTH(YSEARCHTEXT)-1)
	;
	; STANDARD SUCHE = UND-SUCHE
	IF $EXTRACT(YSEARCHTEXT)="+" SET YSEARCHTEXT=$EXTRACT(YSEARCHTEXT,2,999)
	IF $EXTRACT(YSEARCHTEXT)="!" SET YSEARCHTEXT=$EXTRACT(YSEARCHTEXT,2,999)
	IF $FIND(YSEARCHTEXT," ") SET YSEARCHTEXT=$$^WWWTRANSLATE(YSEARCHTEXT," ","+")
	IF $FIND(YSEARCHTEXT,"+++") SET YSEARCHTEXT=$$^WWWTRANSLATE(YSEARCHTEXT,"+++","+")
	IF $FIND(YSEARCHTEXT,"++") SET YSEARCHTEXT=$$^WWWTRANSLATE(YSEARCHTEXT,"++","+")
	IF $FIND(YSEARCHTEXT,"+!") SET YSEARCHTEXT=$$^WWWTRANSLATE(YSEARCHTEXT,"+!"," ")  ;ODER-SUCHE
	;
	; EINGABE: "PHOTO+KODAK" / "PHOTO + KODAK" -> PHOTO +KODAK
	IF $FIND(YSEARCHTEXT,"+ ") SET YSEARCHTEXT=$$^WWWTRANSLATE(YSEARCHTEXT,"+ ","+")
	IF $FIND(YSEARCHTEXT,"+") IF '$FIND(YSEARCHTEXT," +") SET YSEARCHTEXT=$$^WWWTRANSLATE(YSEARCHTEXT,"+"," +")
	;
	; EINGABE: "GLÜHBIRNE OSRAM" -> GLÜHBIRNE +OSRAM
	SET YSEARCHTEXT=$TRANSLATE(YSEARCHTEXT,"'","""")
	IF $EXTRACT(YSEARCHTEXT)="""" IF $EXTRACT($REVERSE(YSEARCHTEXT))="""" DO
	. SET YSEARCHTEXT=$TRANSLATE(YSEARCHTEXT,"+"_"""")
	. SET YSEARCHTEXT=$$^WWWTRANSLATE(YSEARCHTEXT," "," +")
	. QUIT
	IF $EXTRACT(YSEARCHTEXT)="´" IF $EXTRACT($REVERSE(YSEARCHTEXT))="´" DO
	. SET YSEARCHTEXT=$TRANSLATE(YSEARCHTEXT,"+"_"´")
	. SET YSEARCHTEXT=$$^WWWTRANSLATE(YSEARCHTEXT," "," +")
	. QUIT
	;
	QUIT YSEARCHTEXT
	;
	
EXPAND(YSEARCHTEXT)  ;SUCHEN WEITERE SUCHBEGRIFFE ZU DIESEM SUCHBEGRIFF
	;
	SET YSEARCHTEXT=$GET(YSEARCHTEXT)
	QUIT:$TRANSLATE(YSEARCHTEXT," ")="" ""
	;
	; EINGABE: KULI -> KULI KUGELSCHREIBER ...  (ARTVERWANDTE WÖRTER)
	; EINGABE: FOTO -> FOTO PHOTO               (TEILSTRING ERSETZTEN)
	DO
	. SET YSEARCHTEXT2=""
	. FOR YI=1:1  QUIT:$PIECE(YSEARCHTEXT," ",YI,9999)=""  SET YSEARCHTEXT1=$PIECE(YSEARCHTEXT," ",YI) DO
	. . QUIT:$TRANSLATE(YSEARCHTEXT1," ")=""
	. . IF $EXTRACT(YSEARCHTEXT1)="+" SET YSEARCHTEXT2=YSEARCHTEXT2_" "_YSEARCHTEXT1 QUIT  ;KEINE ERWEITERTE SUCHE BEI 'UND' PRÜFUNG
	. . SET YSEARCHTEXT2=YSEARCHTEXT2_" "_$$^WWWBITSEARCH1(YSEARCHTEXT1)
	. . QUIT
	. SET YSEARCHTEXT=$EXTRACT(YSEARCHTEXT2,2,$LENGTH(YSEARCHTEXT2))  ;OHNR LEERZEICHEN
	. QUIT
	;
	QUIT YSEARCHTEXT
	;
	
SEARCH(YSEARCHTEXT,YDATEI,YLFDAT,YSORT,YFILTER)	  ;SUCHE STARTEN
	;
	NEW ANZAHL,ANZAB
	;
	IF $GET(YFORM)="" QUIT 0   ;CURRENT FORM
	IF $GET(YDATEI)="" QUIT 0  ;SEARCH IN CLASS
	IF $GET(YLFDAT)="" QUIT 0   ;SEARCH IN FIELD
	;
	;STARTEN BITMAP VOLLTEXTSUCHE
	SET ANZAHL=1000
	SET ANZAB=1
	MERGE ^WWWDATEN(YM,+$HOROLOG,YUSER_"TEMP",YFORM,"V")=^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V")  ;ZWISCHENSPEICHERN DATEM
	KILL ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V")
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V",YLFDAT,1)=$GET(YSEARCHTEXT)  ;DATEN ZUR PRUEFUNG
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YANZAB",1)=ANZAB
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YANZAHL",1)=ANZAHL
	IF $GET(YFILTER)'="" DO
	. NEW YI
	. FOR YI=1:1  QUIT:$PIECE(YFILTER,"#",YI,999)=""  DO
	. . IF $PIECE(YFILTER,"#",YI)'="" SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V",$PIECE($PIECE(YFILTER,"#",YI),"~",1),1)=$PIECE($PIECE(YFILTER,"#",YI),"~",2)
	. . QUIT
	. QUIT
	KILL ^WWWSOR(YUSER,"SEL")
	KILL ^WWWSOR(YUSER,"KEY")
	;
	DO BITSEARCH^WWWSEARBIT2(YDATEI,,,$GET(YSORT))
	;
	NEW YRESULT
	SET YRESULT=$PIECE($GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YRESULT",1)),Y,1)
	;
	KILL ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V")
	MERGE ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V")=^WWWDATEN(YM,+$HOROLOG,YUSER_"TEMP",YFORM,"V")  ;ZURÜCKHOLEN ZWISCHENSPEICHERUNG
	KILL ^WWWDATEN(YM,+$HOROLOG,YUSER_"TEMP",YFORM,"V")
	QUIT +YRESULT
]]></Routine>
</Export>