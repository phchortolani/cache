<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDRUCK41" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INDRUCK41 ;INDRUCK41;DT;DRUCKEN TEXT VOR POS;24.02.2000  ; Compiled January 18, 2005 10:22:08
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		DRUCKEN TEXT VOR POS
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	24.02.2000  
	;|
	;\------------------------------------------------------------------/
	;
	IF YSEITE'=1 IF $PIECE(YBELEG1,Y,11)'=1 QUIT   ;ANSCHRIFT AUCH AUF FOLGESEITEN? ;too upon 
	IF +$PIECE(YBELEG1,Y,20)'=0 SET LFN=$PIECE(YBELEG1,Y,20)  ;AB ZEILE ;Confirm. 
	IF LFN="" SET LFN=20
	IF YBELEG=9 SET LFN=LFN-5  ;BEREITSTELLUNGSSCHEIN
	SET YTAB=$EXTRACT("                                                                           ",1,+$PIECE(YBELEG1,Y,19))  ;IN SPALTE ;within rift 
	SET A=YTAB
	IF $PIECE(YBELEG1,Y,28)'="" DO  ;TEXT VOR POS ;Text pre- 
	. SET YA(3)=$PIECE(YBELEG1,Y,28)
	. NEW TEXT,TEXT1
	. QUIT:$TRANSLATE(YA(3),"| ")=""
	. SET TEXT=YA(3)
	. FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . SET A=YTAB
	. . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" "   
	. . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>60 DO SPE^INDRUCK SET A=YTAB
	. . . QUIT
	. . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. . QUIT
	. QUIT
	;SET A=YTAB ;table-mat 
	;IF $PIECE(YBELEG1,Y,29)=1 DO  ;LIEFERHINWEIS
	;.SET YA(3)=$PIECE(YAUFTRAG1,Y,21)
	;.NEW TEXT,TEXT1
	;.QUIT:$TRANSLATE(YA(3),"| ")=""
	;.SET TEXT=YA(3)
	;.FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$PIECE(TEXT,"|",YA(88),999)=""  DO
	;..SET A=YTAB
	;..FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" "   
	;...IF $LENGTH(A_$E($PIECE(TEXT1," ",YA(33)),1,26))>60 DO SPE^INDRUCK SET A=YTAB
	;...QUIT
	;..IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	;..IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	;..QUIT
	;.QUIT
	SET A=YTAB
	IF $PIECE(YBELEG1,Y,30)=1 DO  ;INFORMATION
	. SET YA(3)=$PIECE(YAUFTRAG1,Y,20)
	. NEW TEXT,TEXT1
	. QUIT:$TRANSLATE(YA(3),"| ")=""
	. ;SET A=YTAB ;table-mat 
	. ;D SPE^INDRUCK   ;ZEILE EINFÜGEN
	. SET TEXT=YA(3)
	. FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . SET A=YTAB
	. . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" "   
	. . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>60 DO SPE^INDRUCK SET A=YTAB
	. . . QUIT
	. . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. . QUIT
	. SET A=YTAB
	. DO SPE^INDRUCK   ;ZEILE EINFÜGEN ;interpolate 
	. QUIT
	 SET A=YTAB
	 IF $PIECE(YBELEG1,Y,207)=1 IF YBELEG=9 DO  ;BEARBEITUNGHINWEIS;BEC;11.11.04;26687
	. SET YA(3)=$PIECE(YAUFTRAG1,Y,22)
	. NEW TEXT,TEXT1
	. QUIT:$TRANSLATE(YA(3),"| ")=""
	. ;SET A=YTAB ;table-mat 
	. ;D SPE^INDRUCK   ;ZEILE EINFÜGEN
	. SET TEXT=YA(3)
	. FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . SET A=YTAB
	. . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" "   
	. . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>60 DO SPE^INDRUCK SET A=YTAB
	. . . QUIT
	. . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. . QUIT
	. SET A=YTAB
	. DO SPE^INDRUCK   ;ZEILE EINFÜGEN ;interpolate 
	. QUIT
	;LIEFERANSCHRIFT AUF BESTELLUNG ;upon sales order 
	IF YBELEG=3!(YBELEG=10)!(YBELEG=13) DO
	. NEW YI,YII,ADR
	. QUIT:$PIECE(YAUFTRAG1,Y,215)'=1  ;KEINE LA ;no 
	. ;QUIT:$DATA(^INAUFPLA(YM,YAUFTRAG))  ;LIEFERANSCHRIFT JE POSITION
	. SET ADR=$GET(^INAUFA(YM,YAUFTRAG,6,1))  ;AUFTRAG ;mandate  ;order 
	. IF YBELEG=10 SET ADR=$GET(^INANGA(YM,YAUFTRAG,6,1))  ;ANGEBOT ;proposition 
	. IF ADR="" DO
	. . IF $PIECE(YAUFTRAG1,Y,1)'="" IF $DATA(^INKUNDE(YM,$PIECE(YAUFTRAG1,Y,1))) DO
	. . . SET ADR2=$GET(^INKUNDE(YM,$PIECE(YAUFTRAG1,Y,1),1))
	. . . FOR YN=3,4,6,7,10,12,14,16,17 SET $PIECE(ADR,Y,YN)=$PIECE(ADR2,Y,YN)
	. . . QUIT
	. . QUIT
	. QUIT:$TRANSLATE(ADR,Y)=""
	. SET YA(3)=$$^INADRES(ADR,0,1)
	. ;SET YA(3)=""
	. ;IF $PIECE(ADR,Y,3)'="" SET YA(3)=$PIECE($GET(^INPARA(YM,"ANREDE",SPRACHE,$PIECE(ADR,Y,3),1)),Y,1)  ;ANREDE
	. ;IF YA(3)'="" SET YA(3)=YA(3)_"|"
	. ;IF $TRANSLATE($PIECE(ADR,Y,4)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,4)_"|"  ;NAME1
	. ;IF $TRANSLATE($PIECE(ADR,Y,6)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,6)_"|"  ;NAME2
	. ;IF $TRANSLATE($PIECE(ADR,Y,7)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,7)_"|"  ;NAME3
	. ;IF $TRANSLATE($PIECE(ADR,Y,92)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,92)_"|"  ;BELEGEMPFÄNGER
	. ;IF $TRANSLATE($PIECE(ADR,Y,10)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,10)_"|"  ;STRASSE
	. ;;IF $TRANSLATE(YA(3),"| ")'="" SET YA(3)=YA(3)_"|"
	. ;IF $PIECE($GET(^INVORG(YM,YM,1)),Y,50)'=1 IF $TRANSLATE($PIECE(ADR,Y,12)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,12)_" "  ;PLZ VOR ORT
	. ;IF $TRANSLATE($PIECE(ADR,Y,16)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,16)  ;ORT
	. ;IF $PIECE($GET(^INVORG(YM,YM,1)),Y,50)=1 IF $TRANSLATE($PIECE(ADR,Y,12)," ")'="" SET YA(3)=YA(3)_" "_$PIECE(ADR,Y,12)  ;PLZ NACH ORT
	. IF $TRANSLATE($PIECE(ADR,Y,17)," ")'="" DO  ;LAND (NUR WENN NICHT WIE LIEFERANT) ;rural when Not such as 
	. . NEW AUSLAND
	. . SET AUSLAND=0
	. . IF $PIECE(YADRES,Y,17)="" QUIT
	. . IF $PIECE(YADRES,Y,17)'=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,17) SET AUSLAND=1  ;AUSLAND ;foreign country 
	. . IF $PIECE(YADRES,Y,17)'=$PIECE(ADR,Y,17) SET AUSLAND=1  ;AUSLAND ;foreign country 
	. . QUIT:AUSLAND=0
	. . SET YA(3)=YA(3)_$PIECE($GET(^WWW100(0,"LAND",SPRACHE,$PIECE(ADR,Y,17),1)),Y,1)_"|"
	. . QUIT
	. SET YA(3)=YA(3)_"|"
	. IF $TRANSLATE(YA(3),"| ")="" QUIT
	. SET TEXT=$PIECE(YBELEG1,Y,87)  ;LIEFERANSCHRIFT
	. IF TEXT'="" SET TEXT="<B>"_TEXT_"</B>"_"|"
	. SET TEXT=TEXT_YA(3)
	. SET A=YTAB
	. DO SPE^INDRUCK   ;ZEILE EINFÜGEN ;interpolate 
	. FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . SET A=YTAB
	. . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" "   
	. . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>60 DO SPE^INDRUCK SET A=YTAB
	. . . QUIT
	. . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. . QUIT
	. SET A=YTAB
	. DO SPE^INDRUCK   ;ZEILE EINFÜGEN ;interpolate 
	. QUIT
	QUIT
]]></Routine>
</Export>