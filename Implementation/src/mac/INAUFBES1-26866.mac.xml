<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFBES1" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFBES1
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		DRUCKEN/WIEDERHOLEN EINZELNE BESTELLUNG
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 20-Jul-2009	GRF		Doco; quits
	; 28.07.2000	DT
	;-------------------------------------------------------------------------------
	NEW POS,YAUFTRAG,WH
	
	IF $PIECE($GET(YKEY),",",1)="" QUIT  ;DO ^WWWFORM QUIT   ;KEINEN AUFTRAG ENTHALTEN
	IF $PIECE($GET(YKEY),",",2)="" QUIT  ;DO ^WWWFORM QUIT   ;KEINE POSITION ENTHALTEN
	SET YAUFTRAG=$PIECE($GET(YKEY),",",1)
	;SET WH=""
	;SET POS=""
	;FOR  SET POS=$ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO  QUIT:WH="X"
	;.IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)=0 SET WH="X"
	
	;IF WH="X" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT  ;NICHT ALLE WH ERFASST
	SET POS=$PIECE($GET(YKEY),",",2)
	IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)'=1 QUIT  ; DO ^WWWFORM QUIT  ;keine Bestellung
	IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,205)'=0 WRITE $$^WWWTEXT(32047)_" "_$$^WWWTEXT(216)_" "_YAUFTRAG_"-"_POS_" "_$$^WWWTEXT(32285)_" "_$$^WWWTEXT(10004)_"!" QUIT  ;AUFTRAG GESPERRT        ;order DISABLED 
	IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,205)=0 SET YAUFTRAG(POS)=""  ;DIESE POSITION BESTELLEN ;this book 
	;LIEFERANT ;purveyor  ;supplier 
	SET YLIEFER=""
	IF $PIECE($GET(^INAUF(YM,YAUFTRAG,1)),Y,2)=3 DO  ;fester lieferant ;provider 
	. SET YLIEFER=$PIECE($GET(^INAUF(YM,YAUFTRAG,1)),Y,12)  ;FESTER LIEFERANT aus auftragskopf  ;supplier out of 
	
	IF YLIEFER=""  DO
	. SET YLIEFER=$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,12)  ;aus auftragsposition ;out of 
	
	IF YLIEFER="" SET YLIEFER=" "
	SET YCOPY=0
	SET ^WWW126(YM,"INAUF",YBED,1,1)=YAUFTRAG
	SET YBELEG=3   ;BESTELLEN ;book 
	DO ^INDRUCK  ;DRUCK ;printing 
	DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPATNER     FAN;13.03.2003;23059 ;printing copy within buff 
	QUIT
	
MAIL ;SEND VIA MAIL  / EINSPRUNG VON DRUCKFORMULAR
	NEW POS,YAUFTRAG,WH
	SET YSEND=1  ;MAIL
	SET YAUFTRAG=$PIECE($GET(YKEY),",",1)
	SET YLIEFER=$PIECE($GET(YKEY),",",2)
	SET YKEY=""
	;PRUEFEN WH
	SET WH=""
	SET POS=""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO  QUIT:WH="X"
	. IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)=0 SET WH="X"
	
	IF WH="X" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT  ;NICHT ALLE WH ERFASST ;Not 
	;LIEFERANT ;supplier 
	IF YLIEFER="" SET YLIEFER=" "
	SET POS=""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)'=1        QUIT  ;keine Bestellung ;None Sales Order 
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,12)'=YLIEFER QUIT  ;keine Bestellung bei diesem Lieferant ;None Sales Order next to Supplier 
	. IF POS'="" SET YAUFTRAG(POS)=""  ;DIESE POSITION BESTELLEN ;this book 
	
	IF $ORDER(YAUFTRAG(""))="" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT
	SET YCOPY=1  ;WIEDERHOLUNG ;repetition 
	SET ^WWW126(YM,"INAUF",YBED,1,1)=YAUFTRAG
	SET YBELEG=3   ;BESTELLEN ;book 
	DO ^INDRUCK  ;DRUCK ;printing 
	DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPATNER     FAN;13.03.2003;23059 ;printing copy within buff 
	QUIT
	
XML ;SEND VIA XML  / EINSPRUNG VON DRUCKFORMULAR
	NEW POS,YAUFTRAG,WH
	SET YSEND    = 3  ;MAIL
	SET YAUFTRAG = $PIECE($GET(YKEY),",",1)
	SET YLIEFER  = $PIECE($GET(YKEY),",",2)
	SET YKEY =""
	SET WH   =""
	SET POS  =""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO  QUIT:WH="X"
	. IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)=0 SET WH="X"
	
	IF WH="X" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT  ;NICHT ALLE WH ERFASST ;Not 
	;LIEFERANT ;supplier 
	IF YLIEFER="" SET YLIEFER=" "
	SET POS=""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)'=1        QUIT  ;keine Bestellung ;None Sales Order 
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,12)'=YLIEFER QUIT  ;keine Bestellung bei diesem Lieferant ;None Sales Order next to Supplier 
	. IF POS'="" SET YAUFTRAG(POS)=""  ;DIESE POSITION BESTELLEN ;this book 
	
	IF $ORDER(YAUFTRAG(""))="" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT
	SET YCOPY=0  ;WIEDERHOLUNG ;repetition 
	SET ^WWW126(YM,"INAUF",YBED,1,1)=YAUFTRAG
	SET YBELEG=3   ;BESTELLEN ;book 
	DO ^INDRUCK  ;DRUCK ;printing 
	DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPATNER     FAN;13.03.2003;23059 ;printing copy within buff 
	QUIT
	
EDI ;SEND VIA EDI  / EINSPRUNG VON DRUCKFORMULAR
	NEW POS,YAUFTRAG,WH
	SET YSEND    = 4  ;EDI
	SET YAUFTRAG = $PIECE($GET(YKEY),",",1)
	SET YLIEFER  = $PIECE($GET(YKEY),",",2)
	SET YKEY = ""
	SET WH   = ""
	SET POS  = ""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO  QUIT:WH="X"
	. IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)=0 SET WH="X"
	
	IF WH="X" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT  ;NICHT ALLE WH ERFASST ;Not 
	;LIEFERANT ;supplier 
	IF YLIEFER="" SET YLIEFER=" "
	SET POS=""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)'=1        QUIT  ;keine Bestellung ;None Sales Order 
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,12)'=YLIEFER QUIT  ;keine Bestellung bei diesem Lieferant ;None Sales Order next to Supplier 
	. IF POS'="" SET YAUFTRAG(POS)=""  ;DIESE POSITION BESTELLEN ;this book 
	
	IF $ORDER(YAUFTRAG(""))="" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT
	SET YCOPY=0  ;WIEDERHOLUNG ;repetition 
	SET ^WWW126(YM,"INAUF",YBED,1,1)=YAUFTRAG
	SET YBELEG=3   ;BESTELLEN ;book 
	DO ^INDRUCK  ;DRUCK ;printing 
	DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPATNER     FAN;13.03.2003;23059 ;printing copy within buff 
	QUIT
	
EDIP ;SEND VIA EDIPRO  / EINSPRUNG VON DRUCKFORMULAR
	NEW POS,YAUFTRAG,WH
	SET YSEND    = 6  ;EDI
	SET YAUFTRAG = $PIECE($GET(YKEY),",",1)
	SET YLIEFER  = $PIECE($GET(YKEY),",",2)
	SET YKEY = ""
	SET WH   = ""
	SET POS  = ""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO  QUIT:WH="X"
	. IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)=0 SET WH="X"
	
	IF WH="X" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT  ;NICHT ALLE WH ERFASST ;Not 
	;LIEFERANT ;supplier 
	IF YLIEFER="" SET YLIEFER=" "
	SET POS = ""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)'=1        QUIT  ;keine Bestellung ;None Sales Order 
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,12)'=YLIEFER QUIT  ;keine Bestellung bei diesem Lieferant ;None Sales Order next to Supplier 
	. IF POS'="" SET YAUFTRAG(POS)=""  ;DIESE POSITION BESTELLEN ;this book 
	
	IF $ORDER(YAUFTRAG(""))="" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT
	SET YCOPY=0  ;WIEDERHOLUNG ;repetition 
	SET ^WWW126(YM,"INAUF",YBED,1,1)=YAUFTRAG
	SET YBELEG=3   ;BESTELLEN ;book 
	DO ^INDRUCK  ;DRUCK ;printing 
	DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPATNER     FAN;13.03.2003;23059 ;printing copy within buff 
	QUIT
	
FTP ;SEND VIA FTP  / EINSPRUNG VON DRUCKFORMULAR
	NEW POS,YAUFTRAG,WH
	SET YSEND    = 5  ;FTP
	SET YAUFTRAG = $PIECE($GET(YKEY),",",1)
	SET YLIEFER  = $PIECE($GET(YKEY),",",2)
	SET YKEY = ""
	SET WH   = ""
	SET POS  = ""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO  QUIT:WH="X"
	. IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)=0 SET WH="X"
	
	IF WH="X" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT  ;NICHT ALLE WH ERFASST ;Not 
	;LIEFERANT ;supplier 
	IF YLIEFER="" SET YLIEFER=" "
	SET POS = ""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)'=1        QUIT  ;keine Bestellung ;None Sales Order 
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,12)'=YLIEFER QUIT  ;keine Bestellung bei diesem Lieferant ;None Sales Order next to Supplier 
	. IF POS'="" SET YAUFTRAG(POS)=""  ;DIESE POSITION BESTELLEN ;this book 
	
	IF $ORDER(YAUFTRAG(""))="" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT
	SET YCOPY=0  ;WIEDERHOLUNG ;repetition 
	SET ^WWW126(YM,"INAUF",YBED,1,1)=YAUFTRAG
	SET YBELEG=3   ;BESTELLEN ;book 
	DO ^INDRUCK  ;DRUCK ;printing 
	DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPATNER     FAN;13.03.2003;23059 ;printing copy within buff 
	QUIT
	
FAX ;SEND VIA FAX  / EINSPRUNG VON DRUCKFORMULAR
	NEW POS,YAUFTRAG,WH
	
	SET YSEND    = 2  ;FAX
	SET YAUFTRAG = $PIECE($GET(YKEY),",",1)
	SET YLIEFER  = $PIECE($GET(YKEY),",",2)
	SET YKEY = ""
	SET WH   = ""
	SET POS  = ""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO  QUIT:WH="X"
	. IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)=0 SET WH="X"
	
	IF WH="X" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT  ;NICHT ALLE WH ERFASST ;Not 
	;LIEFERANT ;supplier 
	IF YLIEFER="" SET YLIEFER=" "
	SET POS=""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)'=1        QUIT  ;keine Bestellung ;None Sales Order 
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,12)'=YLIEFER QUIT  ;keine Bestellung bei diesem Lieferant ;None Sales Order next to Supplier 
	. IF POS'="" SET YAUFTRAG(POS)=""  ;DIESE POSITION BESTELLEN ;this book 
	
	IF $ORDER(YAUFTRAG(""))="" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT
	SET YCOPY=0  ;WIEDERHOLUNG ;repetition 
	SET ^WWW126(YM,"INAUF",YBED,1,1)=YAUFTRAG
	SET YBELEG=3   ;BESTELLEN ;book 
	DO ^INDRUCK  ;DRUCK ;printing 
	DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPATNER     FAN;13.03.2003;23059 ;printing copy within buff 
	QUIT
	
PDF ;SEND VIA PDF  / EINSPRUNG VON DRUCKFORMULAR  ;BEC;28.04.03;FÃœR PDFERSTELLUNG
	NEW POS,YAUFTRAG,WH
	
	SET YSEND    = 7  ;PDF
	SET YAUFTRAG = $PIECE($GET(YKEY),",",1)
	SET YLIEFER  = $PIECE($GET(YKEY),",",2)
	SET YKEY = ""
	SET WH   = ""
	SET POS  = ""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO  QUIT:WH="X"
	. IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)=0 SET WH="X"
	
	IF WH="X" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT  ;NICHT ALLE WH ERFASST ;Not 
	;LIEFERANT ;supplier 
	IF YLIEFER="" SET YLIEFER=" "
	SET POS=""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)'=1        QUIT  ;keine Bestellung ;None Sales Order 
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,12)'=YLIEFER QUIT  ;keine Bestellung bei diesem Lieferant ;None Sales Order next to Supplier 
	. IF POS'="" SET YAUFTRAG(POS)=""  ;DIESE POSITION BESTELLEN ;this book 
	
	IF $ORDER(YAUFTRAG(""))="" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT
	SET YCOPY = 0     ;WIEDERHOLUNG ;repetition 
	SET ^WWW126(YM,"INAUF",YBED,1,1) = YAUFTRAG
	SET YBELEG = 3    ;BESTELLEN ;book 
	DO ^INDRUCK       ;DRUCK ;printing 
	DO ^INDRUCKZHD    ;DRUCK KOPIE ZU ANSPRECHENPATNER     FAN;13.03.2003;23059 ;printing copy within buff 
	QUIT
	
STDIF ;SEND VIA STANDARDSCHNITTSTELLE  ;FIS;23.02.04;25177
	NEW POS,YAUFTRAG,WH
	
	SET YSEND    = 9  ;STANDARD INTERFACE
	SET YAUFTRAG = $PIECE($GET(YKEY),",",1)
	SET YLIEFER  = $PIECE($GET(YKEY),",",2)
	SET YKEY = ""
	SET WH   = ""
	SET POS  = ""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO  QUIT:WH="X"
	. IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)=0 SET WH="X"
	
	IF WH="X" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT  ;NICHT ALLE WH ERFASST ;Not 
	;LIEFERANT ;supplier 
	IF YLIEFER="" SET YLIEFER=" "
	SET POS=""
	FOR  SET POS = $ORDER(^INAUFP(YM,YAUFTRAG,POS)) QUIT:POS=""  DO
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,7)'=1        QUIT  ;keine Bestellung ;None Sales Order 
	. IF POS'="" IF +$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,12)'=YLIEFER QUIT  ;keine Bestellung bei diesem Lieferant ;None Sales Order next to Supplier 
	. IF POS'="" SET YAUFTRAG(POS)=""  ;DIESE POSITION BESTELLEN ;this book 
	
	IF $ORDER(YAUFTRAG(""))="" DO ^WWWINFO($$^WWWTEXT(32076)) QUIT
	SET YCOPY = 0    ;WIEDERHOLUNG ;repetition 
	SET ^WWW126(YM,"INAUF",YBED,1,1) = YAUFTRAG
	SET YBELEG = 3   ;BESTELLEN ;book 
	DO ^INDRUCK      ;DRUCK ;printing 
	DO ^INDRUCKZHD   ;DRUCK KOPIE ZU ANSPRECHENPATNER     FAN;13.03.2003;23059 ;printing copy within buff 
	QUIT
	
]]></Routine>
</Export>