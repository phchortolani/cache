<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWAMTAG" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWAMTAG() ;WWWAMTAG;FIS;INSERT RETURNVALUE INTO HTML FORM;19.11.2002
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		INSERT RETURNVALUE INTO HTML FORM
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FIS	19.11.2002
	;|
	;\------------------------------------------------------------------/
	;
	;
	NEW RETURNVALUE,YAMDEFTAG,YAMX
	;
	SET RETURNVALUE=""
	SET YAMDEFTAG=$GET(^WWWAMDEFTAG(0,YAMTAGN,1))
	IF YAMDEFTAG'="" DO
	. ;
	. ;FIX RETURNVALUE ;skillful 
	. IF $PIECE(YAMDEFTAG,Y,4)'="" DO
	. .IF $EXTRACT($PIECE(YAMDEFTAG,Y,4))="@" IF $EXTRACT($PIECE(YAMDEFTAG,Y,4),2)'="" SET RETURNVALUE=$GET(@($EXTRACT($PIECE(YAMDEFTAG,Y,4),2,99))) QUIT  ;VARIABLE VALUE
	. .SET RETURNVALUE=$PIECE(YAMDEFTAG,Y,4)
	. .QUIT
	. ;
	. ;METHOD ON LOAD
	. IF $PIECE(YAMDEFTAG,Y,10)'="" DO
	. .NEW YAMEXEC,YAMVALUE
	. .SET YAMEXEC=$PIECE($GET(^WWWAMDEFTAG(0,YAMTAGN,1)),Y,8)  ;EXECUTION BY EVENTBROKER/HYPEREVENT
	. .;
	. .IF YAMEXEC'=1 DO  ;APPLICATION SIDE
	. ..IF $EXTRACT($PIECE(YAMDEFTAG,Y,10))="^" DO @$PIECE(YAMDEFTAG,Y,10) QUIT  ;METHOD
	. ..IF $EXTRACT($PIECE(YAMDEFTAG,Y,10))="@" IF $EXTRACT($PIECE(YAMDEFTAG,Y,10),2)'="" SET RETURNVALUE=$GET(@($EXTRACT($PIECE(YAMDEFTAG,Y,10),2,99))) QUIT  ;VARIABLE
	. ..IF $FIND($PIECE(YAMDEFTAG,Y,10),"@") DO
	. ...SET $PIECE(YAMDEFTAG,Y,10)=$$EXTRACTPARAM($PIECE(YAMDEFTAG,Y,10))
	. ...;N YAMPARA,I
	. ...;S YAMPARA=$P($P($PIECE(YAMDEFTAG,Y,10),"(",2),")",1)
	. ...;F I=1:1  Q:$P(YAMPARA,",",I,99)=""  I $E($P(YAMPARA,",",I))="@" SET $P(YAMPARA,",",I)=@($EXTRACT($P(YAMPARA,",",I),2,99))
	. ...;S $PIECE(YAMDEFTAG,Y,10)=$P($PIECE(YAMDEFTAG,Y,10),"(",1)_YAMPARA_$P($PIECE(YAMDEFTAG,Y,10),")",2)
	. ...QUIT
	. ..SET YAMX="SET RETURNVALUE="_$TRANSLATE($PIECE(YAMDEFTAG,Y,10),"´","'") XECUTE YAMX QUIT  ;FUNCTION
	. ..QUIT
	. .;
	. .IF YAMEXEC=1 DO  ;SERVER SIDE
	. ..SET YAMVALUE=$PIECE($GET(^WWWAMDEFTAG(0,YAMTAGN,1)),Y,7)  ;ALTERNATIVE VALUE FOR EVENT ;option VALUE 
	. ..IF $EXTRACT(YAMVALUE)="@" IF $EXTRACT(YAMVALUE,2)'="" SET YAMVALUE="'"_$GET(@($EXTRACT(YAMVALUE,2,99)))_"'"
	. ..IF $TRANSLATE(YAMVALUE,"'")="" SET YAMVALUE="this.value"
	. ...IF $FIND($PIECE(YAMDEFTAG,Y,10),"@") DO
	. ....SET $PIECE(YAMDEFTAG,Y,10)=$$EXTRACTPARAM($PIECE(YAMDEFTAG,Y,10))
	. ....;N YAMPARA,I
	. ....;S YAMPARA=$P($P($PIECE(YAMDEFTAG,Y,10),"(",2),")",1)
	. ....;F I=1:1  Q:$P(YAMPARA,",",I,99)=""  I $E($P(YAMPARA,",",I))="@" SET $P(YAMPARA,",",I)=@($EXTRACT($P(YAMPARA,",",I),2,99))
	. ....;S $PIECE(YAMDEFTAG,Y,10)=$P($PIECE(YAMDEFTAG,Y,10),"(",1)_YAMPARA_$P($PIECE(YAMDEFTAG,Y,10),")",2)
	. ....QUIT
	. ..SET $PIECE(YAMDEFTAG,Y,10)=$TRANSLATE($PIECE(YAMDEFTAG,Y,10),"()'"_"""","[]´´")   ;$$^NPOSX("abc",1,this.value) = $$^NPOSX[´abc´,1,this.value]
	. ..;function EventValue(Namespace,User,Form,Fixkey,Field,Value,Funct,LocalVar)
	. ..SET RETURNVALUE=RETURNVALUE_" retval = EventValue('"_YUCI_"','"_YAMUSER_"','"_YAMPAGE_"','"_"FIX"_"','"_YAMTAGN_"',"_YAMVALUE_",'"_$PIECE(YAMDEFTAG,Y,10)_"','"_"NOVALUE"_"');"
	. ..QUIT
	. .QUIT
	. ;
	. ;EVENTS
	. ;------------------------------------------------------------------------------------------
	. IF $DATA(^WWWAMDEFTAGE(0,YAMTAGN)) DO
	. .NEW YAMEVENT,YAMEVENTH,YAMFUNCT,YAMEXEC,YAMX,YAMRETVAL,YAMVALUE,YAMTRUE,YAMFALSE
	. .SET YAMEVENT="" FOR  SET YAMEVENT=$ORDER(^WWWAMDEFTAGE(0,YAMTAGN,YAMEVENT)) QUIT:YAMEVENT=""  DO
	. ..SET YAMFUNCT=$PIECE($GET(^WWWAMDEFTAGE(0,YAMTAGN,YAMEVENT,1)),Y,1)  ;FUNCTION BY EVENT
	. ..SET YAMEXEC=$PIECE($GET(^WWWAMDEFTAGE(0,YAMTAGN,YAMEVENT,1)),Y,2)  ;EXECUTION BY EVENTBROKER/HYPEREVENT
	. ..SET YAMTRUE=$PIECE($GET(^WWWAMDEFTAGE(0,YAMTAGN,YAMEVENT,1)),Y,5)  ;OPEN NEW WINDOW IF TRUE
	. ..SET YAMFALSE=$PIECE($GET(^WWWAMDEFTAGE(0,YAMTAGN,YAMEVENT,1)),Y,6)  ;OPEN NEW WINDOW IF FALSE
	. ..QUIT:YAMFUNCT=""
	. ..SET YAMEVENTH=$PIECE($GET(^WWW100(0,"EVENT",SPRACHE,YAMEVENT,1)),Y,1)  ;EVENTHANDLER
	. ..QUIT:YAMEVENTH=""
	. ..SET YAMRETVAL=""
	. ..;
	. ..IF +YAMEXEC'=1 DO  ;APPLICATION SIDE EXECUTION
	. ...IF $EXTRACT(YAMFUNCT)="^" DO @YAMFUNCT QUIT  ;METHOD
	. ...IF $EXTRACT(YAMFUNCT)="@" IF $EXTRACT(YAMFUNCT,2)'="" SET RETURNVALUE=@($EXTRACT(YAMFUNCT,2,99)) QUIT  ;FUNCTION
	. ...IF $FIND(YAMFUNCT,"@") DO
	. ....SET YAMFUNCT=$$EXTRACTPARAM(YAMFUNCT)
	. ....;N YAMPARA,I
	. ....;S YAMPARA=$P($P(YAMFUNCT,"(",2),")",1)
	. ....;F I=1:1  Q:$P(YAMPARA,",",I,99)=""  I $E($P(YAMPARA,",",I))="@" SET $P(YAMPARA,",",I)=@($EXTRACT($P(YAMPARA,",",I),2,99))
	. ....;S YAMFUNCT=$P(YAMFUNCT,"(",1)_YAMPARA_$P(YAMFUNCT,")",2)
	. ....QUIT
	. ...SET YAMX="SET YAMRETVAL=YAMRETVAL_"_$TRANSLATE(YAMFUNCT,"´","""") XECUTE YAMX QUIT  ;FUNCTION
	. ...QUIT
	. ...;
	. ..IF +YAMEXEC=1 DO  ;SERVER SIDE EXECUTION
	. ...SET YAMVALUE=$PIECE($GET(^WWWAMDEFTAGE(0,YAMTAGN,YAMEVENT,1)),Y,3)  ;ADDITIONAL VALUE FOR EVENT
	. ...IF $EXTRACT(YAMVALUE)="@" IF $EXTRACT(YAMVALUE,2)'="" SET YAMVALUE="'"_$GET(@($EXTRACT(YAMVALUE,2,99)))_"'"
	. ...IF $TRANSLATE(YAMVALUE,"'")="" SET YAMVALUE="this.value"
	. ...IF $FIND(YAMFUNCT,"@") DO
	. ....SET YAMFUNCT=$$EXTRACTPARAM(YAMFUNCT)
	. ....;N YAMPARA,I
	. ....;S YAMPARA=$P($P(YAMFUNCT,"(",2),")",1)
	. ....;F I=1:1  Q:$P(YAMPARA,",",I,99)=""  I $E($P(YAMPARA,",",I))="@" SET $P(YAMPARA,",",I)=@($EXTRACT($P(YAMPARA,",",I),2,99))
	. ....;S YAMFUNCT=$P(YAMFUNCT,"(",1)_YAMPARA_$P(YAMFUNCT,")",2)
	. ....QUIT
	. ...SET YAMFUNCT=$TRANSLATE(YAMFUNCT,"()'"_"""","[]´´")   ;$$^FUNCTION("abc",1,this.value) = $$^FUNCTION[´abc´,1,this.value]
	. ...;function EventValue(Namespace,User,Form,Fixkey,Field,Value,Funct,LocalVar)
	. ...SET YAMRETVAL=YAMRETVAL_"retval = EventValue('"_YUCI_"','"_YAMUSER_"','"_YAMPAGE_"','"_"FIX"_"','"_YAMTAGN_"',"_YAMVALUE_",'"_YAMFUNCT_"','"_"NOVALUE"_"');"
	. ...;
	. ...;NEW WINDOW IF TRUE
	. ...IF YAMTRUE'="" DO
	. ....SET YAMRETVAL=YAMRETVAL_" if (retval == 'TRUE') {"
	. ....SET YAMRETVAL=YAMRETVAL_$$^WWWAMWINDOW(YAMTRUE)
	. ....SET YAMRETVAL=YAMRETVAL_" }"
	. ....QUIT
	. ...;NEW WINDOW IF FALSE
	. ...IF YAMFALSE'="" DO
	. ....SET YAMRETVAL=YAMRETVAL_" if (retval == 'FALSE') {"
	. ....SET YAMRETVAL=YAMRETVAL_$$^WWWAMWINDOW(YAMFALSE)
	. ....SET YAMRETVAL=YAMRETVAL_" }"
	. ....QUIT
	. ...QUIT
	. ..;
	. ..IF YAMRETVAL'="" SET RETURNVALUE=RETURNVALUE_" "_YAMEVENTH_"="_""""_$TRANSLATE(YAMRETVAL,"""","'")_""""
	. ..QUIT
	. .QUIT
	. ;---------------------------------------------------------------------------------------------------
	. ;
	. ;HTML-CODE BEFORE/AFTER RETURNVALUE
	. IF RETURNVALUE="" QUIT:$PIECE(YAMDEFTAG,Y,11)=1
	. IF $PIECE(YAMDEFTAG,Y,12)'="" DO
	. .IF $EXTRACT($PIECE(YAMDEFTAG,Y,12))="@" IF $EXTRACT($PIECE(YAMDEFTAG,Y,12),2)'="" SET RETURNVALUE=$GET(@($PIECE($EXTRACT($PIECE(YAMDEFTAG,Y,12),2,99),"|",1)))_RETURNVALUE QUIT
	. .SET RETURNVALUE=$TRANSLATE($PIECE(YAMDEFTAG,Y,12),"|",YCR)_RETURNVALUE  ;HTML BEFORE
	. .QUIT
	. IF $PIECE(YAMDEFTAG,Y,13)'="" DO
	. .IF $EXTRACT($PIECE(YAMDEFTAG,Y,13))="@" IF $EXTRACT($PIECE(YAMDEFTAG,Y,13),2)'="" SET RETURNVALUE=RETURNVALUE_@($PIECE($EXTRACT($PIECE(YAMDEFTAG,Y,13),2,99),"|",1)) QUIT
	. .SET RETURNVALUE=RETURNVALUE_$TRANSLATE($PIECE(YAMDEFTAG,Y,13),"|",YCR)  ;HTML AFTER ;HTML rump 
	. .QUIT
	. QUIT
	QUIT RETURNVALUE
	;
	
EXTRACTPARAM(FUNC)  ;ROBERT / CHRIS PARASKIV,24.01.03
	NEW POS,YI
	SET FUNC=$REVERSE(FUNC)
	SET POS=$FIND(FUNC,"(")
	SET NFUNC=$REVERSE($EXTRACT(FUNC,2,POS-2))
	SET FUNC=$EXTRACT($REVERSE(FUNC),1,$LENGTH(FUNC)-POS+2)
	;
	FOR YI=1:1 { 
	  QUIT:$PIECE(NFUNC,",",YI,99)=""
	  SET PIECE=$EXTRACT($piece(NFUNC,",",YI))
	  IF PIECE="@" {
	SET $PIECE(NFUNC,",",YI)="'"_$GET(@($piece($piece(NFUNC,",",YI),"@",2)))_"'"
	  }
	}
	SET FUNC=FUNC_NFUNC_")"
	QUIT FUNC
]]></Routine>
</Export>