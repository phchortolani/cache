<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDRUCK6P" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INDRUCK6P
#include COMSYS
#include INConst
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		DRUCKEN POSITION     Print Line
	; 
	; Called by : ^INDRUCK6
	; 
	; Inputs : 
	;	YBELEG
	;	YBELEG1
	;	YLIEFER
	;	POS1
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 04-Apr-2008	GM		SRBR014923: Changed $$^WWWTEXT() to $$$Text() for language text (53) 
	; 19-Jan-2007	GRF		SR12027: strSupDesc re-combined with idSupNumber to give
	; 						original result.
	; 05-Oct-2006	RPW		SR14746: Fixed missed direct global writes.
	; 04-Sep-2006	GRF		SR12027: D1=>D8; idSupNumber; Naked References; quits;
	; 						Remove unneeded $data; INVORG macros
	; 13-Sep-2005	JW		SR13434: Remember tax code for line
	; 29-Jul-2005	JW		SR12992: Use COMTAX
	; 30-May-2005	RobertW	SR12056: Attempt at Performance Increase
	; 19.02.2002	DT
	;-------------------------------------------------------------------------------
	;SAP-SD;TYBD;26697;3,2,2005;HIER WENN EINZELBUCHUNG
	IF $FIND(YBELEG,7) IF $PIECE(YAUFTRAG1,Y,96)'="" IF $GET(YKUNDE)'="" DO        ; 04-Sep-2006 split for clarity
	. IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,259)'=1 IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,68)=1 DO
	. . DO SAP()
	
	NEW objINVORG,RABATTSPACE
	
	SET POSSUM1     = 0   ;POSITIONSSUMME /LINE ITEM SUM
	SET RABATTSPACE = 0   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	SET BLANKS      = 0   ;ZUSATZBLANKS WEGEN HTML TAG ;quibble HTML TAG 
	IF POS'=$ORDER(YAUFTRAG("")) IF $PIECE(POS1,Y,105)=1 SET YPAGEBR=1  ;MANUELLER SEITENWECHSEL
	
	SET YLIEFER = $GET(YLIEFER)
	SET POS1    = $GET(POS1)
	
	//PRINT?	QUANTITY					UNIT					ADVERTISING					SEARCH ITEM					SIZE/WEIGHT				STOCK LOC					ITEM							PRICE					TOTAL PRICE
	IF +$PIECE(YBELEG1,Y,42)=0 IF +$PIECE(YBELEG1,Y,44)=0 IF +$PIECE(YBELEG1,Y,46)=0 IF +$PIECE(YBELEG1,Y,48)=0 IF +$PIECE(YBELEG1,Y,50)=0 IF +$PIECE(YBELEG1,Y,52)=0 IF +$PIECE(YBELEG1,Y,54)=0 IF +$PIECE(YBELEG1,Y,56)=0 IF +$PIECE(YBELEG1,Y,58)=0 QUIT  ;KEINE POSITIONEN AUSGEGEN ;no 
	
	set objINVORG = $get(^INVORG(YM,YM,1))     ; 04-Sep-2006
 
	
	/*vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	;ALTERNATIVE ANGEBOTSPOSITION WENN $P(POS1,Y,11)=1
	;IF (YBELEG=1)!(YBELEG=10) IF +$PIECE(POS1,Y,11)'=0 DO  ;WENN ANGEBOT
	. QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. SET A=YSPE
	. SET YA(1)=$PIECE(YBELEG1,Y,48)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. SET YA(3)=$PIECE($GET(^WWW101(0,"OPTIONAL",SPRACHE,$PIECE(POS1,Y,11),1)),Y,1)
	. IF YA(3)="" IF YBELEG=1 SET YA(3)=$$^WWWTEXT(32180)   ;ALTERNATIV BIETEN WIR AN ;afford we upon 
	. IF YA(3)="" IF YBELEG=10 SET YA(3)=$$^WWWTEXT(32202)   ;BIETEN SIE UNS ALTERNATIV AN ;afford they we upon 
	. SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. DO SPE^INDRUCK
	;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END */
	
	; SR12992: ------------------ Determine Tax ----------------------
	set MWST = $$INDRUCKTAX^INTAX(YBELEG,POS1,$get(YEKK),$get(YFELDPZ),$get(YKUNDE),$get(YLIEFER),.MWPO)
	SET MWPO(MWPO)=$GET(MWPO(MWPO))
	set MWPO(MWPO,POS) = ""			// SR13434: Remember that this line has code MWPO
	/*
	DO  ;POS /LINE ITEM
	. ;------------------ ERMITTELN STEUERSATZ ---------------------- ;FIS;KORREKTUREN WEGEN STEUERSATZ/STEUERKENNZEICHEN;30.06.04
	. SET MWST=""
	. SET MWPO=$PIECE(POS1,Y,36)  ;POSTIONS MWST-SATZ
	. IF YBELEG=3!(YBELEG=10)!(YBELEG=13) SET MWPO=$PIECE(YEKK,Y,30)  ;VORSTEUER-SATZ EINKAUF
	. IF YBELEG=12 IF $PIECE($GET(YFELDPZ),Y,21)'="" SET MWPO=$PIECE(YFELDPZ,Y,21)  ;FIS;11.11.03;22349;STEUERSATZ TEILZAHLUNGSRECHNUNG
	. IF MWPO="" IF YBELEG'=3 IF YBELEG'=10 IF YBELEG'=13 SET MWPO=1  ;DFLT. 1 - 16% MWST ;Tax 
	. IF MWPO="" IF YBELEG=3!(YBELEG=10)!(YBELEG=13) SET MWPO=11  ;DFLT. 11 - 16% VST
	. DO  ;MWST NACH PLZ USA ;Tax within ZIP 
	. . NEW PLZ
	. . SET PLZ=$PIECE(YADRES,Y,12)
	. . QUIT:PLZ=""
	. . IF $PIECE(^INPLZ(0,PLZ,1),Y,11)'="" SET MWPO=+$PIECE(^INPLZ(0,PLZ,1),Y,11)  ;STEUERSATZ-PARAMETER = STEUERSATZ % ;tax rate  ; 04-Sep-2006
	. ;
	. IF $$EXIST^%R("COMTAX.OBJ",$GET(YUCI)) DO  ;MWST NACH USA CITY TAX ;Tax within 
	. . NEW YTAXLOCATION,YTAX
	. . SET YTAXLOCATION=""
	. . ;IF $GET(YKUNDE)'="" SET YTAXLOCATION=$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,52)
	. . IF $GET(YKUNDE)'="" SET YTAXLOCATION=$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,54)    ;BEC;26384;14.09.04
	. . IF YTAXLOCATION="" IF $GET(YLOCATION)'="" SET YTAXLOCATION=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,52)
	. . ;IF $$IsTaxable^COMTAX($PIECE(POS1,Y,4),YTAXLOCATION)=0 QUIT    ;BEC;07.07.03;23656;WENN MWSTFUNKTION VORHANDEN IST
	. . IF $$IsTaxable^COMTAX($PIECE(POS1,Y,36),YTAXLOCATION)=0 QUIT    ;BEC;14.07.04;26384
	. . SET MWPO=$$CombinedTaxRate^COMTAX(1,YTAXLOCATION,+$HOROLOG,$get(YKUNDE)="")  ;COMTAX(TaxCode,TaxLocation,TransactionDate)RETURNS THE COMBINED TAX RATE
	. ;
	. SET MWST=MWPO
	. IF $PIECE(YADRES,Y,17)'="" IF $PIECE(YADRES,Y,17)'=$GET(YCOUNTRY) SET MWPO=0  ;KEIN DEUTSCHLAND ;no Germany 
	. IF $PIECE(YADRES,Y,50)'="" IF '$FIND($PIECE(YADRES,Y,50),$GET(YCOUNTRY)) SET MWPO=0  ;STEUERID AUSLAND ;foreign country 
	. IF $PIECE(YADRES,Y,54)'="" IF $PIECE(YADRES,Y,54)'=1 SET MWPO=0  ;KEINE STEUER ;no tax 
	. IF $PIECE(YADRES,Y,55)'="" IF $PIECE(YADRES,Y,55)'<$HOROLOG SET MWPO=0  ;KEINE STEUER BIS ZUM ;no tax until 
	. IF $PIECE(YADRES,Y,54)=2 IF $PIECE(YADRES,Y,50)="" SET MWPO=MWST  ;EG OHNE UST-ID = STEUER BERECHNEN ! (PRIVATPERSON);FIS;25.03.04 ;without tax calculate 
	. ;IF $PIECE(POS1,Y,351)'="" IF +$PIECE(POS1,Y,36)'=0 SET MWPO=$PIECE(POS1,Y,36)  ;EG OHNE UST-ID = STEUER BERECHNEN ! (PRIVATPERSON);FIS;25.03.04
	. ;
	. IF $PIECE(YADRES,Y,54)=1 DO  ;WENN INLAND DANN AKTUELLE STEUER;TYBD;6,10,2004;26471
	. . SET MWPO=MWST
	. . IF $PIECE(YADRES,Y,55)'="" IF $PIECE(YADRES,Y,55)'<$HOROLOG SET MWPO=0  ;KEINE STEUER BIS ZUM ;no tax until 
	. ;
	. ;IF +MWPO'=0 DO   ;PRUEFEN %SATZ
	. IF +MWPO'=0 IF $DATA(^WWW101(0,"MWST",SPRACHE,MWPO)) DO   ;PRUEFEN %SATZ;FIS;USA KENNZEICHEN NICHT ÃœBERSCHREIBEN;05.05.04
	. . NEW MWST
	. . SET MWST(9)=0  ;ENDE ;termination 
	. . SET MWST(0)=+$PIECE($PIECE($GET(^WWW101(0,"MWST",SPRACHE,MWPO,1)),Y,1)," ",1)
	. . SET MWST(1)="" FOR  SET MWST(1)=$ORDER(^WWW101(0,"MWST",SPRACHE,MWST(1))) QUIT:MWST(1)=""  QUIT:MWST(1)=MWPO  DO  QUIT:MWST(9)=1
	. . . SET MWST(2)=+$PIECE($PIECE($GET(^WWW101(0,"MWST",SPRACHE,MWST(1),1)),Y,1)," ",1)
	. . . IF YBELEG'=3 IF YBELEG'=10 IF YBELEG'=13 IF +MWST(0)=+MWST(2) SET MWPO=MWST(1) SET MWST(9)=1   ;NEUES MWSTKENNZEICHEN ;something new 
	. ;
	. SET MWPO(MWPO)=$GET(MWPO(MWPO))
	. SET MWST=+$PIECE($PIECE($GET(^WWW101(0,"MWST",SPRACHE,MWPO,1)),Y,1)," ",1)
	. IF +MWPO'=0 IF '$DATA(^WWW101(0,"MWST",SPRACHE,MWPO,1)) SET MWST=MWPO  ;TYBD;12.6.2003;#23656; UST NACH PLZ EINSETZTEN USA
	. ;
	. SET $PIECE(POS1,Y,36)=MWPO
	. ;IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=10 SET $PIECE(^INAUFP(YM,YAUFTRAG,POS,1),Y,36)=MWPO  ;SPEICHERN GENUTZTE MWST;FIS;22.03.04;25372;AUSGESCHALTET;19,10,2004;TYBD;26471
	. ;IF YBELEG=12 IF $GET(YPZDATUM)'="" SET $PIECE(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1),Y,21)=MWPO  ;SPEICHERN GENUTZTE MWST;FIS;22.03.04;25372;AUSGESCHALTET;19,10,2004;TYBD;26471
	. IF YBELEG=3!(YBELEG=10)!(YBELEG=13) IF $DATA(^INAUFPK(YM,YAUFTRAG,POS)) SET $PIECE(^INAUFPK(YM,YAUFTRAG,POS,1),Y,30)=MWPO  ;SPEICHERN GENUTZTE MWST;FIS;22.03.04;25372
	*/
	
	DO
	. SET A=YSPE
	. ;POSITIONSANZEIGE
	. SET YA(1)=$PIECE(YBELEG1,Y,40)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,41)  ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=0
	. IF YA(1)=1 DO                   ;ANZEIGEN ;give notice  ;display 
	. . SET YA(3)=$JUSTIFY(POS,2,0)   ;JUSTIERT
	. . IF +$PIECE(POS1,Y,240)'=0 SET YA(3)=$JUSTIFY($PIECE(POS1,Y,240),2,0)   ;WENN KUNDENPOSITION ANGEGEBEN  ;when 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. ;
	. ;MENGE   ;quantity 
	. SET YA(1)=$PIECE(YBELEG1,Y,42)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,43)+BLANKS   ;SPALTE ;column 
	. IF +YA(2)=+BLANKS SET YA(2)=6
	. IF YA(1)=1 DO                   ;ANZEIGEN ;give notice  ;display 
	. . IF +$PIECE(POS1,Y,5)=0 QUIT   ;KEINE AUSGABE BEI MENGE 0 ;no expenses next to quantity 
	. . SET YA(3)=$PIECE(POS1,Y,5)
	. . ;
	. . IF $FIND($PIECE(POS1,Y,5),".") SET YA(3)=$$^WWWZAHL($PIECE(POS1,Y,5),5,$LENGTH($PIECE($PIECE(POS1,Y,5),".",2)))
	. . IF '$FIND($PIECE(POS1,Y,5),",") IF '$FIND($PIECE(POS1,Y,5),".") SET YA(3)=$$^WWWZAHL($PIECE(POS1,Y,5),5,0)
	. . IF +$PIECE(POS1,Y,11)=2 SET YA(3)="     "  ;WENN NACH AUFWAND ;when within luxury 
	. . IF $PIECE(YBELEG1,Y,44)=1 DO               ;ANZEIGEN MENGENEINHEIT ;display 
	. . . QUIT:$PIECE(POS1,Y,40)=""
	. . . SET YA(3)=YA(3)_" "_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(POS1,Y,40),1)),Y,1)
	. . ;
	. . SET UAN="",UAUS=""
	. . IF $PIECE(YBELEG1,Y,142)=1 SET UAN="<B>",UAUS="</B>" SET BLANKS=BLANKS+7
	. . IF $PIECE(YBELEG1,Y,142)=2 SET UAN="<U>",UAUS="</U>" SET BLANKS=BLANKS+7
	. . SET A=$EXTRACT(A,1,YA(2))_UAN_YA(3)_UAUS_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. ;
	. ;Artikelnr
	. SET YA(1)=$PIECE(YBELEG1,Y,54)          ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,55)+BLANKS   ;SPALTE ;column 
	. IF +YA(2)=+BLANKS SET YA(2)=22
	. IF YA(1)=1 DO                           ;ANZEIGEN ;give notice  ;display 
	. . ;SET YA(3)=$$^WWWTEXT(32110)          ;ART-NR.:
	. . SET YA(3)=$PIECE(YBELEG1,Y,192)       ;"ARTIKEL-NR.:" TEXT
	. . IF YA(3)'="" SET YA(3)=YA(3)_" "
	. . SET YA(3)=YA(3)_$PIECE(POS1,Y,4)      ;XXXXX
	. . ;IF YKUNDE'="" IF $PIECE(POS1,Y,4)'="" DO    ;AUSSCHALTEN;27206; Kundenartikelnummer auf Beleg;fan
	. . . NEW ABDATUM
	. . . SET ABDATUM=$ORDER(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),$HOROLOG+1),-1)   ;TYBD;12.04.2003;ABDATUM
	. . . QUIT:ABDATUM<10000
	. . . IF $PIECE($GET(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),ABDATUM,1)),Y,4)'="" DO  ;SONDERARTIKELNUMMER DES KUNDEN
	. . . . ;SET YA(3)=$$^WWWTEXT(32110)_" "_$PIECE(POS1,Y,4)_" "_$PIECE($PIECE($GET(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),ABDATUM,1)),Y,4)," ",1)
	. . . . SET YA(3)=$PIECE(POS1,Y,4)_" "_$PIECE($GET(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),ABDATUM,1)),Y,4)   ;27206; Kundenartikelnummer auf Beleg;fan;25.01.05
	. . ;
	. . SET UAN="",UAUS=""
	. . IF $PIECE(YBELEG1,Y,154)=1 SET UAN="<B>",UAUS="</B>" SET BLANKS=BLANKS+7
	. . IF $PIECE(YBELEG1,Y,154)=2 SET UAN="<U>",UAUS="</U>" SET BLANKS=BLANKS+7
	. . SET A=$EXTRACT(A,1,YA(2))_UAN_YA(3)_UAUS_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. ;
	. SET YPROZM=+$$$INVORGOrderingPriceMinus(objINVORG)     ; D21    ; 04-Sep-2006
	. ;einzel preis ;price 
	. SET YA(1)=$PIECE(YBELEG1,Y,56)          ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,57)+BLANKS   ;SPALTE ;column 
	. IF +YA(2)=+BLANKS SET YA(2)=50
	. IF YA(1)=1 DO                           ;ANZEIGEN ;give notice  ;display 
	. . NEW PREIS,NKOMMA
	. . SET PREIS=+$PIECE(POS1,Y,118)
	. . IF $PIECE($PIECE(POS1,Y,118),"@",3)'="" SET YWHRF=$PIECE($PIECE(POS1,Y,118),"@",3)  ;TYBD;3,1,2005
	. . SET NKOMMA=""
	. . IF (YBELEG=3) || (YBELEG=10) || (YBELEG=13) DO   ;BESTELLUNG = EK ;sales order Planned Cost 
	. . . SET PREIS=$PIECE(YEKK,Y,47)  ;SELBSTKOSTEN ;total production costs  ;total production costs whole 
	. . . SET NKOMMA=$PIECE(YEKK,Y,25)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . . IF (+NKOMMA=0) || (NKOMMA>9) SET NKOMMA=2
	. . . ;SET PREIS=$PIECE(YEKK,Y,13)/$PIECE(POS1,Y,5)  ;SELBSTKOSTEN
	. . . IF YWHRF'="" IF YWHR'=YWHR1 IF +$PIECE(YEKK,Y,68)'=0 SET PREIS=$JUSTIFY($PIECE(YEKK,Y,68)*YWHRF,0,NKOMMA)  ;X-RATE FREMDWÃ„HRUNG;FIS;26316;24.08.04
	. . . IF YPROZM'=0 IF PREIS'=0 SET PREIS=$JUSTIFY(PREIS-(PREIS/100*YPROZM),0,NKOMMA)   ;WENN % ABZIEHEN BEI BESTELLUNG ;when subtract next to sales order 
	. . ;
	. . QUIT:+PREIS=0
	. . IF YINKLMWST=1 IF YBELEG'=3 IF YBELEG'=13 SET PREIS=PREIS+$JUSTIFY(PREIS/100*MWST,0,2)  ;WENN INKL MWST!! ;when 
	. . ;IF YBELEG=3 SET NKOMMA=$PIECE($GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,25)
	. . IF NKOMMA="" IF $$$INVORGSaleCost(objINVORG)=$$$YES IF $PIECE(POS1,Y,4)'="" DO   ; D202  ;NUN LT ARTIKEL;TYBD;23,2,2005    ; 04-Sep-2006
	. . . NEW LIEF
	. . . SET LIEF=$ORDER(^INARTK(YM,$PIECE(POS1,Y,4),""))
	. . . IF LIEF'="" IF +$PIECE($GET(^INARTK(YM,$PIECE(POS1,Y,4),LIEF,1)),Y,25)>2 SET NKOMMA=$PIECE(^INARTK(YM,$PIECE(POS1,Y,4),LIEF,1),Y,25)     ; 04-Sep-2006
	. . ;
	. . IF NKOMMA="" SET YA(3)=$$^WWWZAHL(PREIS,10,2,YWHR,,YWHRF)
	. . IF NKOMMA="" IF PREIS<100 IF $LENGTH($PIECE(PREIS,".",2))>2 IF +$EXTRACT($PIECE(PREIS,".",2),3,9)'=0 SET YA(3)=$$^WWWZAHL(PREIS,9,$$^WWWDECIMALLEN("INAUFP",118),YWHR,,YWHRF)
	. . IF NKOMMA'="" SET YA(3)=$$^WWWZAHL(PREIS,10,NKOMMA,YWHR,,YWHRF)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . ;MENGENEINHEIT WENN KEINE MENGE UND KEIN GESAMTPREIS ;when no quantity And no 
	. . IF (+$PIECE(POS1,Y,11)'=0) || ((+$PIECE(POS1,Y,5)=0) && (+$PIECE(POS1,Y,119)=0)) DO
	. . . IF $PIECE(POS1,Y,40)'="" SET YA(3)=YA(3)_"/"_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(POS1,Y,40),1)),Y,1)
	. . . IF (YBELEG=1) || (YBELEG=10) IF +$PIECE(POS1,Y,11)'=0 DO   ;WENN ANGEBOT;NUR ALTERNATIVPOSITION = KEIN GESAMTPREIS ;when proposition only no 
	. . . . IF $DATA(^WWW101(0,"OPTIONAL",SPRACHE,$PIECE(POS1,Y,11),1)) SET YA(3)=YA(3)_" "_$PIECE(^WWW101(0,"OPTIONAL",SPRACHE,$PIECE(POS1,Y,11),1),Y,1) QUIT     ; 04-Sep-2006
	. . . . IF YBELEG=1  SET YA(3)=YA(3)_" "_$$^WWWTEXT(32180) QUIT  ;ALTERNATIV BIETEN WIR AN ;afford we upon 
	. . . . IF YBELEG=10 SET YA(3)=YA(3)_" "_$$^WWWTEXT(32202)       ;BIETEN SIE UNS ALTERNATIV AN ;afford they we upon 
	. . ;
	. . IF +$PIECE(POS1,Y,138)>1 DO  ;BEC;27122;28.02.05;PREISEINHEIT
	. . .SET YA(3)=YA(3)_"/"_$PIECE(POS1,Y,138)
	. . ;
	. . ;EINZELPREIS DRUCKEN ;print 
	. . IF $PIECE(YAUFTRAG1,Y,104)=1 QUIT  ;OHNE POSITIONSPREISE DRUCKEN ;without print 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. ;
	. ;GESpreis
	. SET YA(1)=$PIECE(YBELEG1,Y,58)   ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,59)+BLANKS   ;SPALTE ;column 
	. IF +YA(2)=+BLANKS SET YA(2)=63
	. SET YA(3)=""
	. ;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	. ;;IF YBELEG=1!(YBELEG=10) IF +$PIECE(POS1,Y,11)'=0 DO   ;WENN ANGEBOT;NUR ALTERNATIVPOSITION = KEIN GESAMTPREIS  -> BEREITS IN EINZELPREIS AUFBEREITET
	. ;. SET YA(2)=YA(2)+3 
	. ;. SET YA(3)=$PIECE($GET(^WWW101(0,"OPTIONAL",SPRACHE,$PIECE(POS1,Y,11),1)),Y,1)
	. ;. IF YA(3)="" IF YBELEG=1 SET YA(3)=$$^WWWTEXT(32180)   ;ALTERNATIV BIETEN WIR AN ;afford we upon 
	. ;. IF YA(3)="" IF YBELEG=10 SET YA(3)=$$^WWWTEXT(32202)   ;BIETEN SIE UNS ALTERNATIV AN ;afford they we upon 
	. ;. SET YA(3)=" "_YA(3)
	. ;. SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. ;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	. ;
	. NEW PREIS,NKOMMA
	. SET PREIS=0
	. SET PREIS=+$PIECE(POS1,Y,119)
	. IF $PIECE($PIECE(POS1,Y,119),"@",3)'="" SET YWHRF=$PIECE($PIECE(POS1,Y,119),"@",3)  ;TYBD;3,1,2005
	. SET NKOMMA=""
	. IF YINKLMWST=1 IF YBELEG'=3 IF YBELEG'=13 SET PREIS=$JUSTIFY(($PIECE(POS1,Y,118)+($PIECE(POS1,Y,118)/100*MWST))*($PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4))),0,2)  ;WENN INKL MWST!! ;when 
	. IF (YBELEG=3) || (YBELEG=10) || (YBELEG=13) DO   ;BEI BESTELLUNG ;next to sales order 
	. . SET PREIS=$PIECE(YEKK,Y,47)  ;SELBSTKOSTEN ;total production costs  ;total production costs whole 
	. . ;SET PREIS=$PIECE(YEKK,Y,13)/$PIECE(POS1,Y,5)   ;SELBSTKOSTEN EINZEL
	. . QUIT:+PREIS=0
	. . SET NKOMMA=$PIECE(YEKK,Y,25)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . IF (+NKOMMA=0) || (NKOMMA>9) SET NKOMMA=2
	. . IF YPROZM'=0 IF PREIS'=0 SET PREIS=$JUSTIFY(PREIS-(PREIS/100*YPROZM),0,NKOMMA)   ;ABZIEHEN ;subtract 
	. . SET PREIS=PREIS*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4))  ;GESAMTEK
	. . IF YWHRF'="" IF YWHR'=YWHR1 IF +$PIECE(YEKK,Y,68)'=0 SET PREIS=$JUSTIFY(($PIECE(YEKK,Y,68)*YWHRF)*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4)),0,NKOMMA)  ;X-RATE FREMDWÃ„HRUNG;FIS;26316;24.08.04
	. . SET POSTOTAL=PREIS  ;GESAMTPOSTIONSPREIS EINKAUFSPREIS
	. ;
	. IF YINKLMWST=1 IF YBELEG'=3 IF YBELEG'=13 IF YBELEG'=10 SET PREIS=$JUSTIFY(($PIECE(POS1,Y,118)+($PIECE(POS1,Y,118)/100*MWST))*($PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4))),0,2)  ;WENN INKL MWST!! ;when 
	. IF YA(1)=1 DO
	. . QUIT:+PREIS=0  ;KEIN PREIS ;no prize 
	. . QUIT:+$$$INAUFPAlternateOfferLineItem(POS1)'=0  ;NICHT BEI OPTIONAL ;Not next to 
	. . IF NKOMMA=""  SET YA(3)=$$^WWWZAHL(PREIS,12,2,YWHR,,YWHRF)
	. . IF NKOMMA'="" SET YA(3)=$$^WWWZAHL(PREIS,12,NKOMMA,YWHR,,YWHRF)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . IF $PIECE(YAUFTRAG1,Y,104)=1 QUIT  ;OHNE POSITIONSPREISE DRUCKEN ;without print 
	. . DO
	. . . NEW EURO
	. . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . ;
	. . IF +$PIECE(YBELEG1,Y,213)'=1 SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow   ;TYBD;16,2,2005
	. ;
	. IF +$PIECE(POS1,Y,11)=0 DO  ;NICHT BEI OPTIONAL ;Not next to 
	. . SET MWPO(MWPO)=MWPO(MWPO)+PREIS
	. . ;SET SUMME=SUMME+PREIS  ;FIS;29.10.03;24473;SUMME FÃœR TEILZAHLUNG WIRD NEU GERECHNET IN INDRUCK6
	. . SET POSSUM=POSSUM+PREIS
	. . SET POSSUM1=POSSUM1+PREIS
	. . SET POSSUM2(MWPO)=$GET(POSSUM2(MWPO))+PREIS  ;FIS;27046;09.03.05;zwischensumme je mwst satz
	. ;
	. IF $PIECE(YBELEG1,Y,187)'=1 DO           ;NUR WENN POSITIONEN GEDRUCKT WERDEN ;only when will 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . DO SPE^INDRUCK
	. ;
	. ;lagerplatz drucken;TYBD;16,09,2003
	. IF $PIECE(YBELEG1,Y,52)=1 DO  ;LAGERPLATZ DRUCKEN ;stock location print 
	. . NEW BET,LAP,WE,LP,LP1,MENGE
	. . SET LP=""
	. . IF $DATA(^INWEAUF(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . SET LP1=$GET(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ ;data record 
	. . . . . . SET LP(BET,LAP)=$GET(LP(BET,LAP))+$PIECE(LP1,Y,4)
	. . 
	. . IF $DATA(^INWEAUFALT(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . QUIT:$DATA(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1))       ;DATENSATZ VORHANDEN ;data record on hand 
	. . . . . . SET LP1=$GET(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ ;data record 
	. . . . . . SET LP(BET,LAP)=$GET(LP(BET,LAP))+$PIECE(LP1,Y,4)
	. . ;
	. . ;LAGERPLATZ ;campsite  ;stock location 
	. . IF $PIECE(YBELEG1,Y,52)=1 IF $ORDER(LP(""))'="" DO
	. . . QUIT:$PIECE(YBELEG1,Y,187)=1                 ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1        ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . . SET YA(2)=$PIECE(YBELEG1,Y,53)               ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=22
	. . . SET YA(3)=$$^WWWTEXT(32054)_": "             ;LAGERPLATZ   ;stock location 
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(LP(BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(LP(BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET MENGE=$GET(LP(BET,LAP))
	. . . . . QUIT:+MENGE=0
	. . . . . SET A=YSPE
	. . . . . SET MENGE=$$^WWWZAHL(MENGE,0,$LENGTH($PIECE(MENGE,".",2)))
	. . . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_" "_BET_" "_LAP_" ("_MENGE_")"  ;
	. . . . . DO SPE^INDRUCK
	. ;
	. ;SERIENNUMMER/LOT-NUMMER  ;FIS, 05.06.2001
	. IF ($PIECE(YBELEG1,Y,176)=1) || ($PIECE(YBELEG1,Y,178)=1) DO  ;SERIENNUMMER/LOTNUMMER DRUCKEN ;print 
	. . NEW BET,LAP,WE,SN,SN1,LOT,LOT1
	. . SET SN1=""
	. . SET SN1(1)=$TRANSLATE($PIECE(POS1,Y,56),",",";")  ;HOLEN ALTE WERTE FÃœR VERGLEICH;FIS;25127
	. . SET LOT1=""
	. . SET LOT1(1)=$TRANSLATE($PIECE(POS1,Y,198),",",";")  ;HOLEN ALTE WERTE FÃœR VERGLEICH;FIS;25127
	. . IF $DATA(^INWEAUFS(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUFS(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUFS(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUFS(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . SET SN=""
	. . . . . . FOR  SET SN=$ORDER(^INWEAUFS(YM,YAUFTRAG,POS,BET,LAP,WE,SN)) QUIT:SN=""  DO
	. . . . . . . SET LOT=$PIECE($GET(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1)),Y,19)           ;LOTNUMMER
	. . . . . . . IF LOT="" SET LOT=$PIECE($GET(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1)),Y,2)  ;CHARGENNUMMER
	. . . . . . . IF LOT'="" DO
	. . . . . . . . IF LOT1="" IF '$FIND(";"_LOT1_";",";"_LOT_";") SET LOT1=LOT QUIT
	. . . . . . . . IF '$FIND(";"_LOT1_";",";"_LOT_";") SET LOT1=LOT1_";"_LOT
	. . . . . . . . QUIT
	. . . . . . . IF SN1="" IF '$FIND(";"_SN1_";",";"_SN_";") SET SN1=SN QUIT
	. . . . . . . IF '$FIND(";"_SN1_";",";"_SN_";") SET SN1=SN1_";"_SN
	. . ;
	. . IF $DATA(^INWEAUFALTS(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUFALTS(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUFALTS(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUFALTS(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . SET SN=""
	. . . . . . FOR  SET SN=$ORDER(^INWEAUFALTS(YM,YAUFTRAG,POS,BET,LAP,WE,SN)) QUIT:SN=""  DO
	. . . . . . . SET LOT=$PIECE($GET(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE,1)),Y,19)  ;LOTNUMMER
	. . . . . . . IF LOT="" SET LOT=$PIECE($GET(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE,1)),Y,2)  ;CHARGENNUMMER
	. . . . . . . IF LOT'="" DO
	. . . . . . . . IF LOT1="" IF '$FIND(";"_LOT1_";",";"_LOT_";") SET LOT1=LOT QUIT
	. . . . . . . . IF '$FIND(";"_LOT1_";",";"_LOT_";") SET LOT1=LOT1_";"_LOT
	. . . . . . . ;
	. . . . . . . IF SN1="" IF '$FIND(";"_SN1_";",";"_SN_";") SET SN1=SN QUIT
	. . . . . . . IF '$FIND(";"_SN1_";",";"_SN_";") SET SN1=SN1_";"_SN
	. . . ;
	. . IF SN1'="" IF SN1(1)'="" DO  ;VERGLEICH GGF. Ã„NDERUNG DER SN;FIS;25127 ;preventive composition alteration the 
	. . . SET $PIECE(POS1,Y,56)=SN1
	. . . ;SET $PIECE(^INAUFP(YM,YAUFTRAG,POS,1),Y,56)=$PIECE(POS1,Y,56)  // SR14746
	. . . DO
	. . . . NEW SATZ
	. . . . SET SATZ=$GET(^INAUFP(YM,YAUFTRAG,POS,1))
	. . . . SET $PIECE(SATZ,Y,56)=$PIECE(POS1,Y,56)  // SR14746
	. . . . SET strStatus=$$$Save("INAUFP",YAUFTRAG_","_POS,SATZ,$$$YES)     // SR14746
	. . ;
	. . ;IF LOT1'="" IF LOT1(1)'="" DO            ;VERGLEICH GGF. Ã„NDERUNG DER LOT-NR.;FIS;25127
	. . IF $GET(LOT1)'="" IF LOT1(1)'="" DO       ;BEC;09.06.04;25893; 
	. . . SET $PIECE(POS1,Y,198)=LOT1
	. . . NEW SATZ // SR14746
	. . . SET SATZ=$GET(^INAUFP(YM,YAUFTRAG,POS,1)) // SR14746
	. . . SET $PIECE(SATZ,Y,198)=$PIECE(POS1,Y,198) // SR14746
	. . . //SET $PIECE(^INAUFP(YM,YAUFTRAG,POS,1),Y,198)=$PIECE(POS1,Y,198)
	. . . SET strStatus=$$$Save("INAUFP",YAUFTRAG_","_POS,SATZ,$$$YES)     // SR14746
	. . ;
	. . ;SERIENNUMMER
	. . IF $PIECE(YBELEG1,Y,176)=1 IF SN1'="" DO
	. . . QUIT:$PIECE(YBELEG1,Y,187)=1                 ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1        ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . . SET A=YSPE
	. . . SET YA(1)=$PIECE(YBELEG1,Y,172)              ;DRUCK 0/1  BARCODE ;printing 
	. . . SET YA(2)=$PIECE(YBELEG1,Y,177)              ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=22
	. . . SET YA(3)=$$^WWWTEXT(32116)_": "             ;SERIENNUMMER
	. . . ;IF YA(1)'=1 IF ($LENGTH(YA(3))+$LENGTH(SN1)+YA(2))'>80 DO  QUIT  ;ALLE SN IN EINER ZEILE ;AUSGESCHALTET;FIS;24983;23.01.04
	. . . . SET A=YSPE
	. . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$TRANSLATE(SN1,";",",")_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3))+$LENGTH(SN1),132)   ;EINSETZEN  SERIENNUMMER: XXXX,XXXX,...
	. . . . DO SPE^INDRUCK
	. . . ;
	. . . SET A=YSPE
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)  ;SERIENNUMMER
	. . . DO SPE^INDRUCK
	. . . FOR YII=1:1  QUIT:$PIECE(SN1,";",YII,999)=""  DO  ;EIGENE ZEILE UND BARCODE PRO SN
	. . . . QUIT:$PIECE(SN1,";",YII)=""
	. . . . SET A=YSPE
	. . . . SET A=$EXTRACT(A,1,YA(2))_$PIECE(SN1,";",YII)_$EXTRACT(A,YA(2)+1+$LENGTH($PIECE(SN1,";",YII)),132)   ;EINSETZEN  SERIENNUMMER/BARCODE
	. . . . IF YA(1)=1 DO  ;BARCODE
	. . . . . DO ^WWWBAR($PIECE(SN1,";",YII),"",11,1)  ;KEIN PRINT
	. . . . . SET YA(4)="<IMG SRC="_""""_YGIF_"gif"_$PIECE(SN1,";",YII)_".gif"_""""_">"
	. . . . . SET A=$EXTRACT(A,1,YA(2)+$LENGTH($PIECE(SN1,";",YII))+2)_YA(4)_$EXTRACT(A,YA(2)+$LENGTH($PIECE(SN1,";",YII)+2+$LENGTH(YA(4)))+80,132)
	. . . . ;
	. . . . DO SPE^INDRUCK
	. . ;
	. . ;LOTNUMMER
	. . IF $PIECE(YBELEG1,Y,178)=1 IF $TRANSLATE(LOT1,";,")'="" DO
	. . . QUIT:$PIECE(YBELEG1,Y,187)=1                 ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1        ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . . SET A=YSPE
	. . . SET YA(1)=$PIECE(YBELEG1,Y,172)              ;DRUCK 0/1  BARCODE ;printing 
	. . . SET YA(2)=$PIECE(YBELEG1,Y,179)              ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=22
	. . . SET YA(3)=$$^WWWTEXT(32535)_": "             ;LOT-NUMMER
	. . . SET A=YSPE
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$PIECE(LOT1,";",1)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3))+$LENGTH($PIECE(LOT1,";",1)),132)   ;EINSETZEN  (NUR 1.) LOTNUMMER: XXXX
	. . . ;SET A=$EXTRACT(A,1,YA(2))_YA(3)_$TRANSLATE($EXTRACT(LOT1,1,20),";",",")_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3))+$LENGTH($EXTRACT(LOT1,1,20)),132)   ;EINSETZEN  LOTNUMMER: XXXX,XXXX,...
	. . . DO SPE^INDRUCK
	. ;
	. SET A=YSPE
	. ;KUNDE ARTIKEL NR.   ;27206;FAN;8.02.05
	. SET YA(1)=$PIECE(YBELEG1,Y,54)                  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,49)                  ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO                                   ;ANZEIGEN ;give notice  ;display 
	. . ;SET YA(3)=$$^WWWTEXT(32110)                  ;ART-NR.:
	. . ;SET YA(3)=$PIECE(YBELEG1,Y,192)              ;"ARTIKEL-NR.:" TEXT
	. . ;IF YA(3)'="" SET YA(3)=YA(3)_" "
	. . ;SET YA(3)=YA(3)_$PIECE(POS1,Y,4)             ;XXXXX
	. . SET YA(3)=""
	. . IF YKUNDE'="" IF $PIECE(POS1,Y,4)'="" DO
	. . . NEW ABDATUM
	. . . SET ABDATUM=$ORDER(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),$HOROLOG+1),-1)   ;TYBD;12.04.2003;ABDATUM
	. . . QUIT:ABDATUM<10000
	. . . IF $PIECE($GET(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),ABDATUM,1)),Y,4)'="" DO  ;SONDERARTIKELNUMMER DES KUNDEN
	. . . . ;SET YA(3)=$$^WWWTEXT(32110)_" "_$PIECE(POS1,Y,4)_" "_$PIECE($PIECE($GET(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),ABDATUM,1)),Y,4)," ",1)
	. . . . SET YA(3)=$PIECE($GET(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),ABDATUM,1)),Y,4)   ;27206; Kundenartikelnummer auf Beleg;fan;25.01.05
	. . ;
	. . QUIT:YA(3)=""
	. . SET UAN="",UAUS=""
	. . IF $PIECE(YBELEG1,Y,154)=1 SET UAN="<B>",UAUS="</B>" SET BLANKS=BLANKS+7
	. . IF $PIECE(YBELEG1,Y,154)=2 SET UAN="<U>",UAUS="</U>" SET BLANKS=BLANKS+7
	. . SET A=$EXTRACT(A,1,YA(2))_UAN_YA(3)_UAUS_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. ;
	. SET A=YSPE
	. ;TEXT , ARTIKELBESCHREIBUNG
	. SET YA(1)=$PIECE(YBELEG1,Y,48)  ;DRUCK 0/1  SUCHTEXT ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO  ;ANZEIGEN  ;NICHT ANZEIGEN  ;display Not display 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET YA(3)=$PIECE(POS1,Y,1)
	. . ;
	. . ;TYBD;23717;4,08,2003
	. . IF $TRANSLATE($PIECE($get(^INANGPSP(YM,YAUFTRAG,POS,SPRACHE,1)),Y,2)," ")'="" SET YA(3)=$PIECE(^INANGPSP(YM,YAUFTRAG,POS,SPRACHE,1),Y,2)     ; 04-Sep-2006
	. . IF $TRANSLATE($PIECE($get(^INAUFPSP(YM,YAUFTRAG,POS,SPRACHE,1)),Y,2)," ")'="" SET YA(3)=$PIECE(^INAUFPSP(YM,YAUFTRAG,POS,SPRACHE,1),Y,2)     ; 04-Sep-2006
	. . ;
	. . SET UAN="",UAUS=""
	. . IF $PIECE(YBELEG1,Y,148)=1 SET UAN="<B>",UAUS="</B>" 
	. . IF $PIECE(YBELEG1,Y,148)=2 SET UAN="<U>",UAUS="</U>"
	. . SET YA(3)=UAN_YA(3)_UAUS
	. . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . SET TEXT=YA(3)
	. . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . DO SPE^INDRUCK 
	. . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . ;
	. . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. . ;
	. . ;QUIT:$TRANSLATE(YA(3),"| ")=""
	. . ;FOR YA(88)=1:1 QUIT:$PIECE(YA(3),"|",YA(88),999)=""  DO  ;ZEILE FÃœR ZEILE
	. . ;. SET YA(33)=$PIECE(YA(3),"|",YA(88))
	. . ;. SET A=$EXTRACT(A,1,YA(2))_YA(33)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(33)),132)   ;EINSETZEN
	. . ;. DO SPE^INDRUCK
	. ;
	. ;STEUERÃ„NDERUNGSGRUND;FIS;20.04.04;25528
	. IF YBELEG'=3 IF YBELEG'=10 IF YBELEG'=13 DO   ;NICHT BEI BESTELLUNG ODER ANFRAGE ;Not next to sales order Or 
	. . IF $PIECE(POS1,Y,351)'="" DO
	. . . SET A=YSPE
	. . . SET YA(1)=$PIECE(YBELEG1,Y,198)  ;DRUCK 0/1 ;printing 
	. . . SET YA(2)=$PIECE(YBELEG1,Y,199)   ;SPALTE ;column 
	. . . IF +YA(2)=0 SET YA(2)=14
	. . . IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . . . IF $PIECE(POS1,Y,351)'="" IF $DATA(^INPARA(YM,"STEUERAENDGRUND",SPRACHE,$PIECE(POS1,Y,351))) DO        ; 04-Sep-2006 split for clarity
	. . . . . SET $PIECE(POS1,Y,351)=$PIECE($GET(^INPARA(YM,"STEUERAENDGRUND",SPRACHE,$PIECE(POS1,Y,351),1)),Y,1)  ;FIS;26276;12.08.04;GGF. ALS PARAMETER
	. . . . ;IF $PIECE(YADRES,Y,54)'="" IF +$PIECE(objINVORG,Y,196)=1 DO  ;STEUERÃ„NDERUNGSGRUND DYN. VERGEBEN;FIS;26276;18.10.04
	. . . . ;. IF $DATA(^INSTEUERGRUND(YM,$PIECE(YADRES,Y,54),YBELEG,SPRACHE)) SET $PIECE(POS1,Y,351)=$PIECE($GET(^INSTEUERGRUND(YM,$PIECE(YADRES,Y,54),YBELEG,SPRACHE,1)),Y,1)
	. . . . ;
	. . . . QUIT:$PIECE(POS1,Y,351)=""
	. . . . SET YA(3)=$PIECE(YBELEG1,Y,200)
	. . . . ;IF YA(3)'="" SET YA(3)=YA(3)_": "
	. . . . IF YA(3)'="" SET YA(3)=YA(3)_" "
	. . . . IF (YA(2)+$LENGTH($PIECE(POS1,Y,351)))>$PIECE(YBELEG1,Y,73) DO  QUIT
	. . . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . . DO SPE^INDRUCK
	. . . . . SET A=YSPE
	. . . . . SET YA(3)=$PIECE(POS1,Y,351)  ;STEUERÃ„NDERUNGSGRUND
	. . . . . IF $LENGTH($PIECE(POS1,Y,351))>$PIECE(YBELEG1,Y,73) DO  QUIT  ;WENN TEXT ZU LANG;FIS;25.11.04
	. . . . . . FOR YA(33)=1:1 QUIT:$PIECE(YA(3)," ",YA(33),999)=""  DO  SET A=A_$PIECE(YA(3)," ",YA(33))_" "
	. . . . . . . IF $LENGTH(A_$EXTRACT($PIECE(YA(3)," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK 
	. . . . . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . . ;
	. . . . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . . . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. . . . . ;
	. . . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . . DO SPE^INDRUCK
	. . . . ;
	. . . . SET YA(3)=YA(3)_$PIECE(POS1,Y,351)  ;STEUERÃ„NDERUNGSGRUND
	. . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . DO SPE^INDRUCK
	. ;
	. SET A=YSPE
	. ;LIEFERANTENTEXTE AUF BESTELLUNG ;upon sales order 
	. IF (YBELEG=3)!(YBELEG=10)!(YBELEG=13) DO
	. . new idSupNumber,strSupDesc                  ; 04-Sep-2006/19-Jan-2007
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . QUIT:$GET(YLIEFER)=""
	. . QUIT:$PIECE($GET(POS1),Y,4)=""
	. .;SET YA(3)=$PIECE(]]><![CDATA[$GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,1)                     ; 04-Sep-2006 D1=>D8, idSupNumber vvv
	. .;IF YBELEG=10 SET YA(3)=$PIECE($GET(^INANGPK(YM,YAUFTRAG,POS,1)),Y,1)
	. .;IF YA(3)="" QUIT
	. . SET idSupNumber = $PIECE($GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,8)
	. . set strSupDesc  = $piece($GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,1)             ; 19-Jan-2007
	. . IF YBELEG=10 do
	. . . SET idSupNumber = $PIECE($GET(^INANGPK(YM,YAUFTRAG,POS,1)),Y,8)
	. . . SET strSupDesc  = $PIECE($GET(^INANGPK(YM,YAUFTRAG,POS,1)),Y,1)           ; 19-Jan-2007
	. . set:strSupDesc'="" idSupNumber = idSupNumber_"|"_strSupDesc                 ; 19-Jan-2007
	. . ;   TODO : Consider changing subsequent code so don't have to join the variables together only to split apart <GRF>
	. . IF idSupNumber="" QUIT                                                      ; 04-Sep-2006 D1=>D8, idSupNumber ^^^
	. . SET YA(1)=$PIECE(YBELEG1,Y,80)   ;DRUCK 0/1  AUSFÃœHRUNG ;printing execution 
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . DO               ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . .;QUIT:$TRANSLATE(YA(3),"| ")=""      ; 04-Sep-2006  idSupNumber vvv
	. . .;SET TEXT=YA(3)
	. . . QUIT:$TRANSLATE(idSupNumber,"| ")=""
	. . . SET TEXT=idSupNumber                ; 04-Sep-2006  idSupNumber ^^^
	. . . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . . DO SPE^INDRUCK 
	. . . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . . ;
	. . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. SET A=YSPE
	. ;AUSFUEHRUNG
	. SET YA(1)=$PIECE(YBELEG1,Y,80)  ;DRUCK 0/1  AUSFÃœHRUNG ;printing execution 
	. SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . ;IF YBELEG'=3 QUIT:$TRANSLATE($PIECE(POS1,Y,10),"| ")'=""  ;KUNDENTEXT VORHANDEN WENN BELEG AN KUNDEN
	. . SET YA(3)=$PIECE(POS1,Y,14)
	. . IF $PIECE(POS1,Y,171)'="" DO
	. . . IF '$FIND($TRANSLATE($PIECE(POS1,Y,14)," -"),"DIN"_$PIECE(POS1,Y,171)) DO
	. . . . IF $EXTRACT(YA(3),$LENGTH(YA(3)))="|" SET YA(3)=$EXTRACT(YA(3),1,$LENGTH(YA(3))-1)
	. . . . IF $EXTRACT(YA(3),$LENGTH(YA(3)))=" " SET YA(3)=$EXTRACT(YA(3),1,$LENGTH(YA(3))-1)
	. . . . SET YA(3)=YA(3)_" DIN-"_$PIECE(POS1,Y,171)
	. . ;
	. . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . SET TEXT=YA(3)
	. . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . DO SPE^INDRUCK 
	. . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . ;
	. . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. ;GEWICHT  ;FIS;24772;05.12.04;Ã„NDERN AUCH IN DEN ANDEREN DRUCK ROUTINEN, EDI, EMAIL,..
	. SET YA(1)=$PIECE(YBELEG1,Y,50)  ;DRUCK 0/1  GEWICHT ;printing wt. 
	. SET YA(2)=$PIECE(YBELEG1,Y,51)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . SET YA(3)=$JUSTIFY($PIECE(POS1,Y,43),0,$LENGTH($PIECE($PIECE(POS1,Y,43),".",2)))
	. . IF +YA(3)'=0 DO
	. . . SET A=YSPE
	. . . SET YA(3)=$$^WWWFELDNAME("INART","D",43)_": "_YA(3)  ;FIS;08.01.04
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . DO SPE^INDRUCK
	. ;
	. ;SET A=YSPE ;table-mat 
	. ;WEITERE DATENFELDER (MULTI-SELECT)
	. DO                  ;IF YBELEG=7!(YBELEG=12) DO  ;BEI RECHNUNGEN ;next to 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . NEW DAFELD,YI,FTYP,REL,PARA,RELF,YV
	. . SET DAFELD=$TRANSLATE($PIECE(YBELEG1,Y,180),";",",")
	. . QUIT:DAFELD=""
	. . FOR YI=1:1  QUIT:$PIECE(DAFELD,",",YI,999)=""  DO
	. . . QUIT:$PIECE(DAFELD,",",YI)=""
	. . . SET A=YSPE
	. . . SET YA(3)=$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,$PIECE(DAFELD,",",YI))
	. . . QUIT:YA(3)=""
	. . . IF $PIECE(DAFELD,",",YI)=12 IF YA(3)'="" IF $PIECE($GET(^INLIEF(YM,YA(3),1)),Y,8)'="" SET YA(3)=$PIECE(^INLIEF(YM,YA(3),1),Y,8)  ;TYBD;15,2,2005;26934     ; 04-Sep-2006
	. . . SET FTYP=$PIECE($GET(^WWW003(0,"INAUFP",$PIECE(DAFELD,",",YI),1)),Y,3)  ;FELDTYP
	. . . IF FTYP=1 SET YA(3)=$$^WWWDATE(YA(3))           ;DATUM ;Date 
	. . . IF FTYP=2 SET YA(3)=$PIECE($GET(^WWW100(0,"JA/NEIN",SPRACHE,YA(3),1)),Y,1)  ;JA/NEIN
	. . . IF FTYP=7 SET YA(3)=$$^WWWTIME(YA(3))           ;UHRZEIT
	. . . IF FTYP=8 SET YA(3)=$$^WWWZAHL(YA(3),0,2,YWHR)  ;WÃ„HRUNG ;money standard 
	. . . IF FTYP=14 SET YA(3)=$$^WWWDATE(+YA(3))_" "_$$^WWWTIME($PIECE(YA(3),",",2))  ;ZEITSTEMPEL
	. . . SET REL=$PIECE($GET(^WWW003(0,"INAUFP",$PIECE(DAFELD,",",YI),1)),Y,8)
	. . . ;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	. . . ;;IF +$PIECE(YBELEG1,Y,208)=2 IF YA(3)'="" IF REL'="" IF '$FIND(YA(3),"|") IF '$FIND(YA(3),"<") IF $LENGTH(YA(3))'>50 DO  ;GENERELL RELATION UMSETZEN;fis;09.03.05
	. . . . SET PARA=$PIECE($GET(^WWW003(0,"INAUFP",$PIECE(DAFELD,",",YI),1)),Y,9)    ;KEY FÃœR RELATIONSDATEI (Z.B. SPRACHE) ;KEY to 
	. . . . SET RELF=$PIECE($GET(^WWW003(0,"INAUFP",$PIECE(DAFELD,",",YI),1)),Y,10)   ;ANZUZEIGENDES FELD AUS RELATIONSDATEI ;field out of 
	. . . . IF +RELF=0 SET RELF=1
	. . . . SET REL="^"_REL_"("_""""_$$^WWWYM(REL)_""""_","  ;ZUSAMMENBAU DER GLOBALREFERENZ ;the 
	. . . . IF PARA'="" IF $EXTRACT(PARA)'="""" IF '$FIND(PARA,",")  QUIT:'$DATA(@(PARA))  QUIT:$GET(@(PARA))=""  ;PRÃœFEN EXIST VARAIBLE ALS VORDATEI ;sift when 
	. . . . IF PARA'="" IF $FIND(PARA,",") FOR YV=1:1  QUIT:$PIECE(PARA,",",YV,99)=""  IF $EXTRACT($PIECE(PARA,",",YV))'="""" SET:$GET(@($PIECE(PARA,",",YV)))="" PARA=""  QUIT:PARA=""  ;PRÃœFEN WENN MEHERERE VARIABLEN ;sift when 
	. . . . IF PARA'="" SET REL=REL_PARA_","
	. . . . IF '$FIND(YA(3),";") DO  QUIT
	. . . . . SET REL=REL_""""_$TRANSLATE(YA(3),"""")_""""
	. . . . . SET REL=REL_",1)"                     ; Z.B. REL= "^WWW101(0,"EINHEIT","DE",1,1)"  $P(@REL,Y,1)="STÃœCK"
	. . . . . QUIT:'$DATA(@REL)                     ; wichtig bei prÃ¼fen von INPARA'S falls einer vom user gelÃ¶scht wurde ;Important next to sift from provided that From deleted were 
	. . . . . SET YA(3)=$PIECE(@REL,Y,RELF)
	. . . . ;
	. . . . IF $FIND(YA(3),";") DO  ;MULTISELECT
	. . . . . NEW YB
	. . . . . SET YB(3)=""
	. . . . . FOR YB(1)=1:1  QUIT:$PIECE(YA(3),";",YB(1),999)=""  DO
	. . . . . . QUIT:$PIECE(YA(3),";",YB(1))=""
	. . . . . . SET REL(YB(1))=REL_""""_$TRANSLATE($PIECE(YA(3),";",YB(1)),"""","'")_""""
	. . . . . . SET REL(YB(1))=REL(YB(1))_",1)"                     ; Z.B. REL= "^WWW101(0,"EINHEIT","DE",1,1)"  $P(@REL,Y,1)="STÃœCK"
	. . . . . . QUIT:'$DATA(@REL(YB(1)))                     ; wichtig bei prÃ¼fen von INPARA'S falls einer vom user gelÃ¶scht wurde ;Important next to sift from provided that From deleted were 
	. . . . . SET YB(3)=YB(3)_$PIECE(@REL(YB(1)),Y,RELF)
	. . . . . IF $PIECE(YA(3),";",YB(1)+1)'="" SET YB(3)=YB(3)_","
	. . . . . QUIT
	. . . . . SET YA(3)=YB(3)                 ; FIXME : This line is effectively deleted <GRF> (NFA - block disabled)
	. . . ;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	. . . ;
	. . . ;SET YA(1)=$PIECE(YBELEG1,Y,80)   ;DRUCK 0/1  AUSFÃœHRUNG
	. . . ;IF $PIECE(DAFELD,",",YI,999)=2 IF YBELEG=9 IF YA(3)'="" DO   ;BEC;14.12.04;26789;MULTIPLE U/M
	. . . IF $PIECE(DAFELD,",",YI)=2 IF YBELEG=9 IF YA(3)'="" DO   ;BEC;14.12.04;26789;MULTIPLE U/M
	. . . . NEW UPC1
	. . . . IF $DATA(^INWEAUF(YM,YAUFTRAG,POS)) DO
	. . . . . NEW LP,DATE1,LOC
	. . . . . SET LOC=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,""))
	. . . . . QUIT:LOC="" 
	. . . . . SET LP=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,LOC,""))
	. . . . . QUIT:LP=""
	. . . . . SET DATE1=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,LOC,LP,""))
	. . . . . QUIT:DATE1=""
	. . . . . SET YA(3)=$PIECE($GET(^INWEAUF(YM,YAUFTRAG,POS,LOC,LP,DATE1,1)),Y,59)
	. . . . ;
	. . . . SET UPC1=$$^INARTUPC(YA(3),$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,5),$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,4),,1)
	. . . . SET YA(3)=$PIECE(UPC1,Y,1)
	. . . . IF $PIECE(UPC1,Y,3)'="" SET YA(3)=YA(3)_" "_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(UPC1,Y,3),1)),Y,1)
	. . . . SET YA(3)=$PIECE(UPC1,Y,4)_" x "_YA(3)
	. . . ;
	. . . IF +$PIECE(YBELEG1,Y,208)>0 SET YA(3)=$$^WWWFELDNAME("INAUFP","D",$PIECE(DAFELD,",",YI))_": "_YA(3)     ;BEC;26932;09.12.04
	. . . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=14
	. . . DO  ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . . . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . . . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . . . SET TEXT=YA(3)
	. . . . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . . . DO SPE^INDRUCK 
	. . . . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . . . ;
	. . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. ;LIEFERTERMIN IN POSITION ;time of delivery within 
	. IF $PIECE(POS1,Y,19)'="" IF $PIECE(POS1,Y,19)'=$PIECE(YAUFTRAG1,Y,19) DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . ;
	. . SET A=YSPE
	. . SET YA(1)=$PIECE(YBELEG1,Y,80)  ;DRUCK 0/1  AUSFÃœHRUNG ;printing execution 
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . DO
	. . . IF YBELEG'=3 IF YBELEG'=10 IF YBELEG'=13 IF YBELEG'=2 QUIT
	. . . ;
	. . . SET YA(3)=$$^WWWTEXT(32168)_":"   ;"Liefertermin:"
	. . . IF YBELEG=3!(YBELEG=10)!(YBELEG=13) DO   ;LIEFERANT ;purveyor  ;supplier 
	. . . . IF $PIECE(YAUFTRAG1,Y,197)'="" SET YA(3)=YA(3)_" "_$PIECE($GET(^WWW101(0,"LIEFERKENNZEICHEN",SPRACHE,$PIECE(YAUFTRAG1,Y,197),1)),Y,1)
	. . . . IF $PIECE(YAUFTRAG1,Y,197)'=4 IF $PIECE(YBELEG1,Y,36)'=1 SET YA(3)=YA(3)_" "_$$^WWWDATE($PIECE(POS1,Y,19))
	. . . . IF $PIECE(YAUFTRAG1,Y,197)=4!($PIECE(YBELEG1,Y,36)=1) SET YA(3)=YA(3)_" "_$$^WWWWEEK($PIECE(POS1,Y,19),1)
	. . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . DO SPE^INDRUCK
	. . . ;
	. . . IF YBELEG'=3 IF YBELEG'=10 IF YBELEG'=13 DO   ;KUNDE ;lore  ;customer 
	. . . . IF $PIECE(YAUFTRAG1,Y,198)'="" SET YA(3)=YA(3)_" "_$PIECE($GET(^WWW101(0,"LIEFERKENNZEICHEN",SPRACHE,$PIECE(YAUFTRAG1,Y,197),1)),Y,1)
	. . . . IF $PIECE(YAUFTRAG1,Y,198)'=4 IF $PIECE(YBELEG1,Y,36)'=1 SET YA(3)=YA(3)_" "_$$^WWWDATE($PIECE(POS1,Y,19))
	. . . . IF $PIECE(YAUFTRAG1,Y,198)=4!($PIECE(YBELEG1,Y,36)=1) SET YA(3)=YA(3)_" "_$$^WWWWEEK($PIECE(POS1,Y,19),1)
	. . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . DO SPE^INDRUCK
	. ;
	. ;FRACHTKONDITION IN POSITION ;within 
	. IF $PIECE($GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,15)'="" DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . IF YBELEG'=3 IF YBELEG'=10  IF YBELEG'=13 QUIT
	. . SET A=YSPE
	. . SET YA(1)=$PIECE(YBELEG1,Y,80)  ;DRUCK 0/1  AUSFÃœHRUNG ;printing execution 
	. . QUIT:YA(1)'=1
	. . SET YA(1)=$PIECE(YBELEG1,Y,86)  ;DRUCK 0/1  LIEFERVORSCHRIFT ;printing shipping instruction 
	. . QUIT:YA(1)'=1
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . SET YA(3)=$$^WWWTEXT(32183)   ;"Frachtkondition:"
	. . SET YA(3)=YA(3)_" "_$PIECE($GET(^INPARA(YM,"FRACHT",SPRACHE,$PIECE($GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,15),1)),Y,1)
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. ;
	. ;GEFAHRSTOFFKLASSE   ;BEC;25.04.2003;23156;GEFAHRSTOFFKLASSE EINGESETZT
	. IF $PIECE(POS1,Y,4)'="" DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1     ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG'=6  QUIT
	. . QUIT:$PIECE(POS1,Y,309)=1        ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET A=YSPE
	. . SET YA(1)=$PIECE(YBELEG1,Y,195)  ;DRUCK 0/1   ;printing 
	. . QUIT:YA(1)'=1
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . NEW ART
	. . SET ART=""
	. . IF $PIECE(POS1,Y,4)'="" SET ART=$GET(^INART(YM,$PIECE(POS1,Y,4),1))
	. . QUIT:$PIECE(ART,Y,315)=""
	. . SET YA(3)="<B>"_$$^WWWFELDNAME("INART","D",315)_": "_$PIECE(ART,Y,315)  ;"GEFAHRGUTKLASSE:" _ GEFAHRSTOFF
	. . IF $PIECE(ART,Y,315)'="" IF $DATA(^INPARA(YM,"GEFAHRENKLASSE",SPRACHE,$PIECE(ART,Y,315),1)) DO     ; split for clarity
	. . . SET YA(3)=YA(3)_" "_$PIECE(^INPARA(YM,"GEFAHRENKLASSE",SPRACHE,$PIECE(ART,Y,315),1),Y,1)  ;WENN PARAMETER ;when parameter      ; 04-Sep-2006
	. . SET YA(3)=YA(3)_"</B>"
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. ;
	. ;URSPRUNGSLAND   ;FIS;27.09.2004;26280
	. IF $PIECE(POS1,Y,4)'="" DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET A=YSPE
	. . SET YA(1)=$PIECE(YBELEG1,Y,204)  ;DRUCK 0/1   ;printing 
	. . QUIT:YA(1)'=1
	. . SET YA(2)=$PIECE(YBELEG1,Y,205)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . NEW ORIGIN,BET,LAP,WE,WE1,YII,ISOALPHA2
	. . SET ORIGIN=""
	. . IF $DATA(^INWEAUF(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . SET WE1=$GET(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ ;data record 
	. . . . . . IF $PIECE(WE1,Y,112)'="" IF '$FIND(";"_ORIGIN_";",";"_$PIECE(WE1,Y,112)_";") SET ORIGIN=ORIGIN_";"_$PIECE(WE1,Y,112)_";"
	. . ;
	. . IF $DATA(^INWEAUFALT(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . QUIT:$DATA(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ VORHANDEN ;data record on hand 
	. . . . . . SET WE1=$GET(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ ;data record 
	. . . . . . IF $PIECE(WE1,Y,112)'="" IF '$FIND(";"_ORIGIN_";",";"_$PIECE(WE1,Y,112)_";") SET ORIGIN=ORIGIN_";"_$PIECE(WE1,Y,112)_";"
	. . ;
	. . QUIT:ORIGIN=""
	. . SET YA(3)=""
	. . ;FOR YII=1:1  QUIT:$PIECE(ORIGIN,";",YII,99)=""  IF $PIECE(ORIGIN,";",YII)'=""  SET:YA(3)'="" YA(3)=YA(3)_", " SET YA(3)=YA(3)_$PIECE(ORIGIN,";",YII)
	. . FOR YII=1:1  QUIT:$PIECE(ORIGIN,";",YII,99)=""  IF $PIECE(ORIGIN,";",YII)'=""  DO
	. . . SET:YA(3)'="" YA(3)=YA(3)_", "
	. . . SET YA(3)=YA(3)_$PIECE(ORIGIN,";",YII)
	. . . SET ISOALPHA2=$PIECE($GET(^WWW101(0,"ISO-ALPHA-2",SPRACHE,$PIECE(ORIGIN,";",YII),1)),Y,1)
	. . . IF ISOALPHA2'="" SET YA(3)=YA(3)_"("_ISOALPHA2_")"
	. . ;
	. . SET YA(3)=$$^WWWFELDNAME("INWEAUF","D",112)_": "_YA(3)  ;URSPRUNGSLAND:"
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. ;
	. SET A=YSPE
	. ;LIEFERANSCHRIFT AUF BESTELLUNG ;upon sales order 
	. IF (YBELEG=3)!(YBELEG=10)!(YBELEG=13) DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . NEW ADR,ADR2,YN
	. . SET ADR=""
	. . QUIT:$GET(YLIEFER)=""
	. . QUIT:$PIECE($GET(POS1),Y,241)'=1  ;KEINE LA ;no 
	. . IF '$DATA(^INAUFPLA(YM,YAUFTRAG,POS)) IF $PIECE(YAUFTRAG1,Y,215)=1 DO  QUIT  ;BEREITS ALS KOPF ;yet when pate 
	. . . SET $PIECE(^INAUFP(YM,YAUFTRAG,POS,1),Y,241)=0  ;UMSETZTEN AUF NICHT DRUCKEN ;upon Not print 
	. . ;
	. . SET ADR=$GET(^INAUFA(YM,YAUFTRAG,6,1))               ;AUFTRAG ;order 
	. . IF $DATA(^INAUFPLA(YM,YAUFTRAG,POS,1)) SET ADR=^INAUFPLA(YM,YAUFTRAG,POS,1)     ; 04-Sep-2006
	. . IF YBELEG=10 SET ADR=$GET(^INANGA(YM,YAUFTRAG,6,1))  ;ANGEBOT ;quote
	. . IF ADR="" DO
	. . . IF $PIECE(YAUFTRAG1,Y,1)'="" IF $DATA(^INKUNDE(YM,$PIECE(YAUFTRAG1,Y,1))) DO
	. . . . SET ADR2=$GET(^INKUNDE(YM,$PIECE(YAUFTRAG1,Y,1),1))
	. . . . FOR YN=3,4,6,7,10,12,14,16,17 SET $PIECE(ADR,Y,YN)=$PIECE(ADR2,Y,YN)
	. . ;
	. . QUIT:$TRANSLATE(ADR,Y)=""
	. . SET YA(3)=$$^INADRES(ADR,0,1)
	. . ;SET YA(3)=""
	. . ;IF $PIECE(ADR,Y,3)'="" SET YA(3)=$PIECE($GET(^INPARA(YM,"ANREDE",SPRACHE,$PIECE(ADR,Y,3),1)),Y,1)  ;ANREDE
	. . ;IF YA(3)'="" SET YA(3)=YA(3)_"|"
	. . ;IF $TRANSLATE($PIECE(ADR,Y,4)," ")'=""  SET YA(3)=YA(3)_$PIECE(ADR,Y,4)_"|"   ;NAME1
	. . ;IF $TRANSLATE($PIECE(ADR,Y,6)," ")'=""  SET YA(3)=YA(3)_$PIECE(ADR,Y,6)_"|"   ;NAME2
	. . ;IF $TRANSLATE($PIECE(ADR,Y,7)," ")'=""  SET YA(3)=YA(3)_$PIECE(ADR,Y,7)_"|"   ;NAME3
	. . ;IF $TRANSLATE($PIECE(ADR,Y,92)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,92)_"|"  ;BELEGEMPFÃ„NGER
	. . ;IF $TRANSLATE($PIECE(ADR,Y,10)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,10)_"|"  ;STRASSE
	. . ;;IF $TRANSLATE(YA(3),"| ")'="" SET YA(3)=YA(3)_"|"
	. . ;IF $PIECE(objINVORG,Y,50)'=1 IF $TRANSLATE($PIECE(ADR,Y,12)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,12)_" "  ;PLZ VOR ORT
	. . ;IF $TRANSLATE($PIECE(ADR,Y,16)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,16)  ;ORT
	. . ;IF $PIECE(objINVORG,Y,50)=1 IF $TRANSLATE($PIECE(ADR,Y,12)," ")'="" SET YA(3)=YA(3)_" "_$PIECE(ADR,Y,12)  ;PLZ NACH ORT
	. . IF $TRANSLATE($PIECE(ADR,Y,17)," ")'="" DO  ;LAND (NUR WENN NICHT WIE LIEFERANT) ;rural when Not such as 
	. . . NEW AUSLAND
	. . . SET AUSLAND=0
	. . . IF $PIECE(YADRES,Y,17)="" QUIT
	. . . IF $PIECE(YADRES,Y,17)'=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,17) SET AUSLAND=1  ;AUSLAND ;foreign country 
	. . . IF $PIECE(YADRES,Y,17)'=$PIECE(ADR,Y,17) SET AUSLAND=1  ;AUSLAND ;foreign country 
	. . . QUIT:AUSLAND=0
	. . . SET YA(3)=YA(3)_$PIECE($GET(^WWW100(0,"LAND",SPRACHE,$PIECE(ADR,Y,17),1)),Y,1)_"|"
	. . ;
	. . SET YA(3)=YA(3)_"|"
	. . IF $TRANSLATE(YA(3),"| ")="" QUIT
	. . SET YA(1)=1  ;$PIECE(YBELEG1,Y,86)   ;DRUCK 0/1  AUSFÃœHRUNG
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . . NEW TEXT,TEXT1
	. . . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . . SET TEXT=$PIECE(YBELEG1,Y,87)  ;LIEFERANSCHRIFT
	. . . IF TEXT'="" SET TEXT="<B>"_TEXT_"</B>"_"|"
	. . . SET TEXT="|"_TEXT_YA(3)_"| "  ;ABSTAND ;offset 
	. . . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" "   
	. . . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO SPE^INDRUCK SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . QUIT
	. . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. SET A=YSPE
	. ;LIEFERVORSCHRIFT AUF BESTELLUNG ;shipping instruction upon sales order 
	. IF (YBELEG=3)!(YBELEG=10)!(YBELEG=10) DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . NEW LIVO
	. . SET LIVO=""
	. . QUIT:$GET(YLIEFER)=""
	. . QUIT:$PIECE($GET(POS1),Y,4)=""
	. . SET LIVO=$PIECE($GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,71)
	. . IF YBELEG=10 SET LIVO=$PIECE($GET(^INANGPK(YM,YAUFTRAG,POS,1)),Y,71)
	. . QUIT:LIVO=""
	. . SET YA(3)=$PIECE($GET(^INVERPVOR(YM,LIVO,1)),Y,2)
	. . IF YA(3)="" SET YA(3)=LIVO       ;MANUELLER TEXT
	. . SET YA(1)=$PIECE(YBELEG1,Y,86)   ;DRUCK 0/1  AUSFÃœHRUNG ;printing execution 
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . IF YA(1)=1 DO                    ;ANZEIGEN ;give notice  ;display 
	. . . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . . SET TEXT=YA(3)
	. . . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . . DO SPE^INDRUCK 
	. . . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . . ;
	. . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. ;LIEFERANTEN EINGANGSRECHNUNG   ;FIS;10.02.2005;26934
	. IF YBELEG'=3 IF YBELEG'=10 DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . SET A=YSPE
	. . SET YA(1)=$PIECE(YBELEG1,Y,211)  ;DRUCK 0/1   ;printing 
	. . QUIT:YA(1)'=1
	. . SET YA(2)=$PIECE(YBELEG1,Y,212)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=$PIECE(YBELEG1,Y,49)
	. . IF YA(2)="" SET YA(2)=14
	. . NEW RECH,LIEF,RDATUM
	. . SET RECH=""
	. . SET RDATUM=""
	. . IF $DATA(^INERECH1(YM,YAUFTRAG,POS)) DO
	. . . SET LIEF(1)=""
	. . . FOR  SET LIEF(1)=$ORDER(^INERECH1(YM,YAUFTRAG,POS,LIEF(1))) QUIT:LIEF(1)=""  DO
	. . . . SET RECH(1)=""
	. . . . FOR  SET RECH(1)=$ORDER(^INERECH1(YM,YAUFTRAG,POS,LIEF(1),RECH(1))) QUIT:RECH(1)=""  DO
	. . . . . IF '$FIND(";"_RECH_";",";"_RECH(1)_";") SET RECH=RECH_RECH(1)_";"
	. . . . . IF RDATUM="" IF $PIECE($GET(^INERECH1(YM,YAUFTRAG,POS,LIEF(1),RECH(1),1)),Y,1)'="" DO     ; split for clarity
	. . . . . . SET RDATUM="/ "_$$^WWWDATE($PIECE(^INERECH1(YM,YAUFTRAG,POS,LIEF(1),RECH(1),1),Y,1))     ; 04-Sep-2006
	. . ;
	. . QUIT:RECH=""
	. . SET YA(3)=""
	. . FOR YII=1:1  QUIT:$PIECE(RECH,";",YII,99)=""  IF $PIECE(RECH,";",YII)'=""  DO
	. . . SET:YA(3)'="" YA(3)=YA(3)_", "
	. . . SET YA(3)=YA(3)_$PIECE(RECH,";",YII)
	. . . QUIT
	. . SET YA(3)=$$^WWWFELDNAME("INDRPARA","D",211)_": "_YA(3)_" "_RDATUM  ;LIEFERANTEN EINGANGSRECHNUNG:"
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. ;
	. ;IF YBELEG=3!(YBELEG=10) DO  QUIT  ;BESTELLUNGS RABATTE
	. IF YBELEG=3!(YBELEG=10)!(YBELEG=10) DO    ;BEC;11.05.04;25676;KUNDENTEXT IN ANFRAGEBELEGEN
	. . NEW YI
	. . FOR YI=2:1:4 DO
	. . . QUIT:$PIECE(YEKK,Y,YI)=""  ;KEIN RABATT ;no deduction 
	. . . SET A=YSPE
	. . . ;RABATTE
	. . . SET RABZW=POSTOTAL
	. . . SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. . . SET YA(2)=$PIECE(YBELEG1,Y,61)   ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=14
	. . . IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . . . QUIT:+RABZW=0
	. . . . SET YA(3)=$PIECE(YEKK,Y,YI)
	. . . . QUIT:+YA(3)=0
	. . . . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . . . IF $PIECE(YEKK,Y,50+YI)="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(31412)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT ;deduction 
	. . . . IF $PIECE(YEKK,Y,50+YI)'="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$PIECE(YEKK,Y,49+YI)   ;_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT
	. . . . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . . . SET RABZW=RABZW-RABATT
	. . . . . SET POSTOTAL=POSTOTAL-RABATT
	. . . . . SET POSSUM=POSSUM-RABATT
	. . . . . SET POSSUM1=POSSUM1-RABATT
	. . . . . SET POSSUM2(MWPO)=$GET(POSSUM2(MWPO))-RABATT  ;FIS;27046;09.03.05;zwischensumme je mwst satz
	. . . . ;
	. . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ;column 
	. . . . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . . . DO
	. . . . . NEW EURO
	. . . . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . . . ;
	. . . . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . . . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . DO SPE^INDRUCK
	. . ;
	. . FOR YI=5 DO              ; FIXME : single value <GRF>
	. . . QUIT:+$PIECE(YEKK,Y,YI)=0  ;KEIN RABATT ;no deduction 
	. . . SET $PIECE(YEKK,Y,YI)=+$PIECE(YEKK,Y,YI)*-1  ;ZU/ABSCHLAG %
	. . . SET A=YSPE
	. . . ;RABATTE
	. . . SET RABZW=POSTOTAL
	. . . SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. . . SET YA(2)=$PIECE(YBELEG1,Y,61)   ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=14
	. . . IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . . . QUIT:+RABZW=0
	. . . . SET YA(3)=$PIECE(YEKK,Y,YI)
	. . . . QUIT:+YA(3)=0
	. . . . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . . . IF RABATT<0 SET YA(3)="+"_$JUSTIFY(YA(3)*-1,5,2)_"% "_$$^WWWTEXT(32957)_"   "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;ZUSCHL
	. . . . IF RABATT>0 SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(32958)_"   "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;ABSCHL
	. . . . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . . . SET RABZW=RABZW-RABATT
	. . . . . SET POSTOTAL=POSTOTAL-RABATT
	. . . . . SET POSSUM=POSSUM-RABATT
	. . . . . SET POSSUM1=POSSUM1-RABATT
	. . . . ;
	. . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ;column 
	. . . . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . . . DO
	. . . . . NEW EURO
	. . . . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . . . ;
	. . . . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . . . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . DO SPE^INDRUCK
	. . ;
	. . FOR YI=6 DO              ; FIXME : single value <GRF>
	. . . QUIT:+$PIECE(YEKK,Y,YI)=0  ;KEIN RABATT ;no deduction 
	. . . SET $PIECE(YEKK,Y,YI)=+$PIECE(YEKK,Y,YI)*-1  ;ZU/ABSCHLAG %
	. . . SET A=YSPE
	. . . ;RABATTE
	. . . SET RABZW=POSTOTAL
	. . . SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. . . SET YA(2)=$PIECE(YBELEG1,Y,61)   ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=14
	. . . IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . . . QUIT:+RABZW=0
	. . . . SET YA(3)=$PIECE(YEKK,Y,YI)
	. . . . QUIT:+YA(3)=0
	. . . . SET RABATT=$JUSTIFY(YA(3),0,2)
	. . . . IF RABATT<0 SET YA(3)="+"_" "_$$^WWWTEXT(32957)  ;ZUSCHLAG ;surcharge 
	. . . . IF RABATT>0 SET YA(3)="-"_" "_$$^WWWTEXT(32958)  ;ABSCHLAG
	. . . . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . . . SET RABZW=RABZW-RABATT
	. . . . . SET POSTOTAL=POSTOTAL-RABATT
	. . . . . SET POSSUM=POSSUM-RABATT
	. . . . . SET POSSUM1=POSSUM1-RABATT
	. . . . . SET POSSUM2(MWPO)=$GET(POSSUM2(MWPO))-RABATT  ;FIS;27046;09.03.05;zwischensumme je mwst satz
	. . . . ;
	. . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ;column 
	. . . . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . . . DO
	. . . . . NEW EURO
	. . . . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . . . ;
	. . . . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . . . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . . DO SPE^INDRUCK
	. ;
	. SET A=YSPE
	. ;KUNDENTEXT
	. SET YA(1)=$PIECE(YBELEG1,Y,81)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET YA(3)=$PIECE(POS1,Y,10)
	. . IF $TRANSLATE($PIECE($get(^INANGPSP(YM,YAUFTRAG,POS,SPRACHE,1)),Y,1)," ")'="" SET YA(3)=$PIECE(^INANGPSP(YM,YAUFTRAG,POS,SPRACHE,1),Y,1)     ; 04-Sep-2006
	. . IF $TRANSLATE($PIECE($get(^INAUFPSP(YM,YAUFTRAG,POS,SPRACHE,1)),Y,1)," ")'="" SET YA(3)=$PIECE(^INAUFPSP(YM,YAUFTRAG,POS,SPRACHE,1),Y,1)     ; 04-Sep-2006
	. . ;
	. . IF $TRANSLATE(YA(3),"| ")="" IF $PIECE(YBELEG1,Y,82)=1 SET YA(3)=$PIECE(POS1,Y,14)  ;WENN KEIN EINTRAG ABER GEKLICKT DANN KUNDENTEXT=AUSFÃœHRUNG ;when no yet 
	. . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . SET TEXT=YA(3)
	. . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . DO SPE^INDRUCK 
	. . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . ;
	. . . IF $GET(YUN)>0 SET A=A_"</U>"
]]><![CDATA[	. . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. IF YBELEG=3!(YBELEG=10)!(YBELEG=10) QUIT      ;BEC;11.05.04;25676;KUNDENTEXT IN ANFRAGEBELEGEN
	. ;
	. SET A=YSPE
	. ;RABATT1
	. SET RABZW=$PIECE(POS1,Y,119)
	. ;IF YINKLMWST=1 I YBELEG'=3 SET RABZW=$JUSTIFY(($PIECE(POS1,Y,118)/100*MWPO)*$PIECE(POS1,Y,5),0,2)  ;WENN INKL MWST!!
	. IF YINKLMWST=1 IF YBELEG'=3 IF YBELEG'=13 SET RABZW=$JUSTIFY(($PIECE(POS1,Y,118)+($PIECE(POS1,Y,118)/100*MWST))*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4)),0,2)  ;WENN INKL MWST!!  ;FIS, 12.11.01
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,61)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:+RABZW=0
	. . SET YA(3)=$PIECE(POS1,Y,121)
	. . QUIT:+YA(3)=0
	. . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(31412)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT ;deduction 
	. . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . SET RABZW=RABZW-RABATT
	. . . SET POSSUM=POSSUM-RABATT
	. . . SET POSSUM1=POSSUM1-RABATT
	. . . SET POSSUM2(MWPO)=$GET(POSSUM2(MWPO))-RABATT  ;FIS;27046;09.03.05;zwischensumme je mwst satz
	. . . SET RABATTEXIST=1
	. . ;
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ;column 
	. . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . DO
	. . . NEW EURO
	. . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . ;
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. . IF $GET(YKUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,259)'=1 DO SAP^INDRUCK("-"_$PIECE(POS1,Y,121)_"% "_$$^WWWTEXT(31412),RABATT*-1)  ;TYBD;4,2,2005
	. . SET RABATTSPACE=1   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. ;
	. SET A=YSPE
	. ;RABATT2
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,61)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:+RABZW=0
	. . IF +$PIECE(YAUFTRAG1,Y,70)'=0 IF $PIECE(POS1,Y,122)'=$PIECE(YAUFTRAG1,Y,70) SET $PIECE(POS1,Y,122)=$PIECE(YAUFTRAG1,Y,70)
	. . SET YA(3)=$PIECE(POS1,Y,122)   ;RABATT ;deduction 
	. . QUIT:+YA(3)=0
	. . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . IF $PIECE(POS1,Y,125)="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(31412)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT ;deduction 
	. . ;IF $PIECE(POS1,Y,125)'="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$PIECE(POS1,Y,125)  ;_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT
	. . ;IF $PIECE(POS1,Y,125)'="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$E($PIECE(POS1,Y,125),0,15)_" "_$$^WWWTEXT(68)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;27466;BEC;14.03.05;TEXT + BETRAG   ;BR014923 
	. . IF $PIECE(POS1,Y,125)'="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$E($PIECE(POS1,Y,125),0,15)_" "_$$$Text($listbuild("53",$$^WWWZAHL(RABZW,7,2,YWHR)))  ;27466;BEC;14.03.05;TEXT + BETRAG  ;BR014923  ; From %1
	. . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . SET RABZW=RABZW-RABATT
	. . . SET POSSUM=POSSUM-RABATT
	. . . SET POSSUM1=POSSUM1-RABATT
	. . . SET POSSUM2(MWPO)=$GET(POSSUM2(MWPO))-RABATT  ;FIS;27046;09.03.05;zwischensumme je mwst satz
	. . . SET RABATTEXIST=1
	. . ;
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ;column 
	. . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . DO
	. . . NEW EURO
	. . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . ;
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. . IF $GET(YKUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,259)'=1 DO SAP^INDRUCK("-"_$PIECE(POS1,Y,122)_"% "_$$^WWWTEXT(31412),RABATT*-1)  ;TYBD;4,2,2005
	. . SET RABATTSPACE=1   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. ;
	. SET A=YSPE
	. ;RABATT3  MENGENRABATT ;volume discount 
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,61)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:+RABZW=0
	. . SET YA(3)=$PIECE(POS1,Y,128)   ;RABATT ;deduction 
	. . QUIT:+YA(3)=0
	. . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . IF $PIECE(POS1,Y,129)="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(31412)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT ;deduction 
	. . IF $PIECE(POS1,Y,129)'="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$PIECE(POS1,Y,129)  ;_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT
	. . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . SET RABZW=RABZW-RABATT
	. . . SET POSSUM=POSSUM-RABATT
	. . . SET POSSUM1=POSSUM1-RABATT
	. . . SET POSSUM2(MWPO)=$GET(POSSUM2(MWPO))-RABATT  ;FIS;27046;09.03.05;zwischensumme je mwst satz
	. . . SET RABATTEXIST=1
	. . ;
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ;column 
	. . SET YA(3)=$$^WWWZAHL((RABATT*-1),12,2,YWHR)  ;RABATT ;deduction 
	. . DO
	. . . NEW EURO
	. . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . ;
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. . IF $GET(YKUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,259)'=1 DO SAP^INDRUCK("-"_$PIECE(POS1,Y,128)_"% "_$$^WWWTEXT(31412),RABATT*-1)  ;TYBD;4,2,2005
	. . SET RABATTSPACE=1   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. ;
	. SET A=YSPE
	. ;RABATT4  ZUSATZRABATT ;volume discount ;TYBD;GEM ZUSATZ;27377;19.2.2005
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,61)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:+RABZW=0
	. . SET YA(3)=$PIECE(POS1,Y,212)   ;RABATT ;deduction 
	. . QUIT:+YA(3)=0
	. . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . IF $PIECE(POS1,Y,213)="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(31412)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT ;deduction 
	. . IF $PIECE(POS1,Y,213)'="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$PIECE(POS1,Y,213)  ;_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT
	. . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . SET RABZW=RABZW-RABATT
	. . . SET POSSUM=POSSUM-RABATT
	. . . SET POSSUM1=POSSUM1-RABATT
	. . . SET POSSUM2(MWPO)=$GET(POSSUM2(MWPO))-RABATT  ;FIS;27046;09.03.05;zwischensumme je mwst satz
	. . . SET RABATTEXIST=1
	. . ;
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ;column 
	. . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . DO
	. . . NEW EURO
	. . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . ;
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. . IF $GET(YKUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,259)'=1 DO SAP^INDRUCK("-"_$PIECE(POS1,Y,212)_"% "_$$^WWWTEXT(31412),RABATT*-1)  ;TYBD;4,2,2005
	. . SET RABATTSPACE=1   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. ;
	. SET A=YSPE
	. ;ZU/ABSCHLAG%  ;TYBD;GEM ZUSATZ;27377;19.2.2005
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,61)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:+RABZW=0
	. . SET YA(3)=$PIECE(POS1,Y,214)*-1   ;RABATT ;deduction 
	. . QUIT:+YA(3)=0
	. . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . IF RABATT<0 SET YA(3)="+"_$JUSTIFY(YA(3)*-1,5,2)_"% "_$$^WWWTEXT(32957)_"   "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;ZUSCHL
	. . IF RABATT>0 SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(32958)_"   "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;ABSCHL
	. . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . SET RABZW=RABZW-RABATT
	. . . SET POSSUM=POSSUM-RABATT
	. . . SET POSSUM1=POSSUM1-RABATT
	. . . SET POSSUM2(MWPO)=$GET(POSSUM2(MWPO))-RABATT  ;FIS;27046;09.03.05;zwischensumme je mwst satz
	. . . SET RABATTEXIST=1
	. . ;
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ;column 
	. . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . DO
	. . . NEW EURO
	. . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . ;
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. . IF $GET(YKUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,259)'=1 DO SAP^INDRUCK(""_$PIECE(POS1,Y,214)_"% ",RABATT*-1)  ;TYBD;4,2,2005
	. . SET RABATTSPACE=1   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. ;
	. SET A=YSPE
	. ;SPEZIALZUSCHLAG
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,61)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:+$PIECE(POS1,Y,211)=0  ;KEIN ZUSCHLAG ;no surcharge 
	. . IF $PIECE(POS1,Y,210)="" SET YA(3)=$$^WWWTEXT(32351)_" "  ;ZUSTZKOSTEN
	. . IF $PIECE(POS1,Y,210)'="" SET YA(3)=$PIECE(POS1,Y,210)  ;ZUSCHLAGSBEZEICHNUNG
	. . IF $PIECE(POS1,Y,211)>0 SET YA(3)="+ "_YA(3)
	. . IF $PIECE(POS1,Y,211)<0 SET YA(3)="- "_YA(3)
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ;column 
	. . SET YA(3)=$PIECE(POS1,Y,211)  ;ZUSCHLAG ;surcharge 
	. . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)+YA(3)  ;MWST ;Tax 
	. . . SET RABZW=RABZW+YA(3)
	. . . SET POSSUM=POSSUM+YA(3)
	. . . SET POSSUM1=POSSUM1+YA(3)
	. . . SET POSSUM2(MWPO)=$GET(POSSUM2(MWPO))+YA(3)  ;FIS;27046;09.03.05;zwischensumme je mwst satz
	. . . SET RABATTEXIST=1
	. . ;
	. . SET YA(3)=$$^WWWZAHL(YA(3),12,2,YWHR)  ;ZUSCHLAG ;surcharge 
	. . DO
	. . . NEW EURO
	. . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . ;
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO SPE^INDRUCK
	. . IF $GET(YKUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,259)'=1 DO SAP^INDRUCK($$^WWWTEXT(32351),$PIECE(POS1,Y,211))  ;TYBD;4,2,2005
	. . SET RABATTSPACE=1   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. ;
	. SET A=YSPE
	. ;ZUSATZKOSTEN ;WEITERE ZUSATZKOSTEN JE POSITION;07.03.2005;FIS;27445
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO
	. . NEW ZUS,ZUS1,FIRST
	. . SET ZUS="" FOR  SET ZUS=$ORDER(^INAUFPIMPACT(YM,YAUFTRAG,POS,ZUS)) QUIT:ZUS=""  DO
	. . . SET ZUS1=$GET(^INAUFPIMPACT(YM,YAUFTRAG,POS,ZUS,1))
	. . . IF YBELEG=7!(YBELEG=17) IF $GET(YCOPY)'=1 QUIT:$PIECE(ZUS1,Y,7)'=""  ;BEREITS BERECHNET
	. . . IF YBELEG=7!(YBELEG=17) IF $GET(YCOPY)=1 QUIT:$PIECE(ZUS1,Y,7)=""  ;NOCH OFFEN
	. . . IF $$$INVORGCalcAdditionalCostsInLine(objINVORG)=$$$YES DO  ; D215  ;NEU RECHNEN        ; 04-Sep-2006
	. . . . NEW YKEY,YFELD
	. . . . SET YKEY=YAUFTRAG_","_POS_","_ZUS
	. . . . SET YFELD=ZUS1
	. . . . DO ^INAUFPIMPACT
	. . . . SET ZUS1=YFELD
	. . . ;
	. . . QUIT:+$PIECE(ZUS1,Y,6)=0  ;KEINE KOSTEN
	. . . SET FIRST=$GET(FIRST)+1
	. . . ;IF FIRST=1 IF RABATTSPACE=1 SET A=" " DO SPE^INDRUCK  ;LEERZEILE NACH ARTIKELRABATT
	. . . IF FIRST=1 SET A=" " DO SPE^INDRUCK  ;LEERZEILE NACH ARTIKELRABATT
	. . . SET A=YSPE
	. . . SET YA(3)=""
	. . . SET YA(2)=$PIECE(YBELEG1,Y,61)   ;SPALTE ;column 
	. . . IF YA(2)="" SET YA(2)=14
	. . . IF $PIECE(ZUS1,Y,3)="" SET $PIECE(ZUS1,Y,3)=$$^WWWTEXT(32351)  ;ZUSATZKOSTEN
	. . . SET YA(3)=$PIECE(ZUS1,Y,3)  ;ZUSATZKOSTEN
	. . . IF $PIECE(ZUS1,Y,6)>0 SET YA(3)="+ "_YA(3)
	. . . IF $PIECE(ZUS1,Y,6)<0 SET YA(3)="- "_YA(3)
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . SET MWPO=1  ;DFLT. 16%
	. . . SET MWPO(MWPO)=$GET(MWPO(MWPO))+$PIECE(ZUS1,Y,6)  ;MWST ;Tax
	. . . ;SET YPOSEXTRA(" ")=$GET(YPOSEXTRA(" "))+$PIECE(ZUS1,Y,6)  ;MWST ;Tax
	. . . IF $PIECE(ZUS1,Y,9)="" SET $PIECE(ZUS1,Y,9)=" "
	. . . SET YPOSEXTRA($PIECE(ZUS1,Y,9))=$GET(YPOSEXTRA($PIECE(ZUS1,Y,9)))+$PIECE(ZUS1,Y,6)  ;MWST ;Tax
	. . . SET RABZW=RABZW+$PIECE(ZUS1,Y,6)
	. . . SET POSSUM=POSSUM+$PIECE(ZUS1,Y,6)
	. . . SET POSSUM1=POSSUM1+$PIECE(ZUS1,Y,6)
	. . . SET POSSUM2(MWPO)=$GET(POSSUM2(MWPO))+$PIECE(ZUS1,Y,6)  ;FIS;27046;09.03.05;zwischensumme je mwst satz
	. . . SET RABATTEXIST=1
	. . . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . . SET YA(2)=$PIECE(YBELEG1,Y,59)   ;SPALTE ;column 
	. . . DO
	. . . . NEW EURO
	. . . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . . ;
	. . . SET YA(3)=$$^WWWZAHL($PIECE(ZUS1,Y,6),12,2,YWHR)  ;ZUSCHLAG
	. . . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN
	. . . DO SPE^INDRUCK
	. . . IF $GET(YKUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,259)'=1 DO SAP^INDRUCK($PIECE(ZUS1,Y,3),$PIECE(ZUS1,Y,6))  ;TYBD;4,2,2005
	. . . SET RABATTSPACE=1   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. ;
	. SET A=YSPE
	. ;---------------------------------
	. ;
	. IF $PIECE(POS1,Y,309)=1 QUIT:YBELEG=6  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. ;
	. ;ERSATZTEXT ANSTELLE POSITIONEN DRUCKEN ;print 
	. IF YBELEG'=12 IF $PIECE(YBELEG1,Y,187)=1 IF $PIECE(YBELEG1,Y,188)'="" DO
	. . SET A=YSPE
	. . SET YA(3)=$PIECE(YBELEG1,Y,188)
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . IF $ORDER(YAUFTRAG(POS),-1)="" DO  ;NUR BEI 1.POSITION ;only next to 
	. . . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . . DO SPE^INDRUCK
	. . SET RABATTSPACE=0   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. . . SET TEXT=YA(3)
	. . . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . . DO SPE^INDRUCK 
	. . . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . . ;
	. . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. . ;
	. ;ERSATZTEXT ANSTELLE POSITIONEN DRUCKEN ;print 
	. IF YBELEG=12 IF $PIECE(YFELDPZ,Y,13)=1 IF $PIECE(YFELDPZ,Y,18)'="" DO
	. . SET A=YSPE
	. . SET YA(3)=$PIECE(YFELDPZ,Y,18)
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . IF $ORDER(YAUFTRAG(POS),-1)="" DO  ;NUR BEI 1.POSITION ;only next to 
	. . . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . . DO SPE^INDRUCK
	. . . SET RABATTSPACE=0   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. . . SET TEXT=YA(3)
	. . . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . . DO SPE^INDRUCK 
	. . . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . . ;
	. . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. ;ERSATZTEXT ANSTELLE POSITIONEN DRUCKEN ;print 
	. IF YBELEG=12 IF $PIECE(YFELDPZ,Y,13)=1 IF $PIECE(YFELDPZ,Y,18)="" IF $PIECE(YBELEG1,Y,188)'="" DO
	. . SET A=YSPE
	. . SET YA(3)=$PIECE(YBELEG1,Y,188)
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . IF $ORDER(YAUFTRAG(POS),-1)="" DO  ;NUR BEI 1.POSITION ;only next to 
	. . . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . . DO SPE^INDRUCK
	. . . SET RABATTSPACE=0   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. . . SET TEXT=YA(3)
	. . . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . . DO SPE^INDRUCK 
	. . . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . . ;
	. . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. ;SONDERTEXTE JE POSITION JE BELEG ;once once proof 
	. IF $DATA(^INAUFPC(YM,YAUFTRAG,POS,YBELEG,1)) DO                ; 04-Sep-2006 reduce to if test
	. . SET YA(3)=$PIECE(^INAUFPC(YM,YAUFTRAG,POS,YBELEG,1),Y,1)     ; 04-Sep-2006
	. . SET A=YSPE
	. . ;
	. . SET YA(1)=$PIECE(YBELEG1,Y,80)   ;DRUCK 0/1  AUSFÃœHRUNG ;printing execution 
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . DO                               ;ANZEIGEN ;display 
	. . . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . . SET TEXT=YA(3)
	. . . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . . DO SPE^INDRUCK 
	. . . . . . SET RABATTSPACE=0   ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. . . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . . ;
	. . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. IF +$PIECE(YBELEG1,Y,213)=1 DO  ;MIT ZWISCHENSUMME DER POSITIONEN
	. . ;QUIT:+$JUSTIFY($GET(POSSUM1),0,2)=+$JUSTIFY($PIECE(POS1,Y,118)*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4)),0,2)
	. . ;SUMME POSITION / LINE ITEM SUM
	. . SET A=YSPE
	. . SET YA(2)=$PIECE(YBELEG1,Y,214)  ;+BLANKS   ;SPALTE ;column 
	. . IF +YA(2)=+BLANKS SET YA(2)=63
	. . IF $PIECE(YBELEG1,Y,187)'=1 DO   ;NUR WENN POS GEDRUCKT
	. . . SET NKOMMA=""
	. . . SET NKOMMA=$PIECE($GET(YEKK),Y,25)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . . IF +NKOMMA=0!(NKOMMA>9) SET NKOMMA=2
	. . . IF YBELEG=6 QUIT:$PIECE(POS1,Y,309)=1 
	. . . ;QUIT:+$GET(POSSUM1)=0  ;KEIN PREIS ;no prize 
	. . . QUIT:+$PIECE(POS1,Y,11)'=0  ;NICHT BEI OPTIONAL ;Not next to 
	. . . IF $GET(NKOMMA)=""  SET YA(3)=$$^WWWZAHL(POSSUM1,12,2,YWHR,,$GET(YWHRF))
	. . . IF $GET(NKOMMA)'="" SET YA(3)=$$^WWWZAHL(POSSUM1,12,NKOMMA,YWHR,,$GET(YWHRF))  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . . IF $PIECE(YAUFTRAG1,Y,104)=1 QUIT  ;OHNE POSITIONSPREISE DRUCKEN ;without print 
	. . . SET UAN="",UAUS=""
	. . . IF $PIECE(YBELEG1,Y,215)=1 SET UAN="<B>",UAUS="</B>" SET BLANKS=BLANKS+7
	. . . IF $PIECE(YBELEG1,Y,215)=2 SET UAN="<U>",UAUS="</U>" SET BLANKS=BLANKS+7
	. . . DO
	. . . . NEW EURO
	. . . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . . . QUIT
	. . . SET A=$EXTRACT(A,1,YA(2))_UAN_YA(3)_UAUS_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . . DO SPE^INDRUCK
	. ;
	. IF RABATTSPACE=1 DO    ;WENN RABATT DANN EIN LEERZEILE;TYBD;21,7,2004
	. . SET A=" " DO SPE^INDRUCK  ;TYBD;LEERZEILE NACH RABATT ;blank line within deduction 
	
	;SAP-SD;TYBD;26697;3,2,2005;HIER WENN GESAMTPOSITION
	IF $GET(YKUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,259)=1 IF $FIND(YBELEG,7) IF $PIECE(YAUFTRAG1,Y,96)'="" IF $GET(YKUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,68)=1 DO
	. DO SAP($GET(POSSUM1))
	
	QUIT
	
TEILE(DEEP)   ;DRUCKEN DER TEILE ;VAIABLE POS1=TEILEDATENSATZ ;print the 
	NEW SPACE
	
	SET SPACE=DEEP*3  ;EINRUECKUNG
	DO
	. ;SET A=YSPE ;table-mat 
	. ;;BESTEHEND AUS ;out of 
	. ;SET YA(1)=$PIECE(YBELEG1,Y,40)  ;DRUCK 0/1
	. ;SET YA(2)=$PIECE(YBELEG1,Y,41)+SPACE   ;SPALTE
	. ;IF YA(2)="" SET YA(2)=0
	. ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. ;. SET YA(3)=$P(YBELEG1,Y,37)  ;BESTEHEND AUS
	. ;. SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN
	. ;. DO SPE^INDRUCK
	. ;
	. ;MENGE   ;quantity 
	. SET A=YSPE
	. SET YA(1)=$PIECE(YBELEG1,Y,42)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,43)+$GET(BLANK)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=6
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . IF ($PIECE(POS1,Y,40)=2)!($PIECE(POS1,Y,40)=10)!($PIECE(POS1,Y,40)=11) IF +$PIECE(POS1,Y,45)'=0 SET $PIECE(POS1,Y,5)=$PIECE(POS1,Y,45)  ;DAUER ;permanence 
	. . IF +$PIECE(POS1,Y,5)=0 QUIT
	. . ;SET YA(3)=$TRANSLATE($PIECE(POS1,Y,5),".",",")
	. . IF $PIECE(POS1,Y,40)=2 SET $PIECE(POS1,Y,5)=$PIECE(POS1,Y,5)\60\60
	. . IF $PIECE(POS1,Y,40)=10 SET $PIECE(POS1,Y,5)=$PIECE(POS1,Y,5)\60
	. . IF $PIECE(POS1,Y,40)=11 SET $PIECE(POS1,Y,5)=$PIECE(POS1,Y,5)\100
	. . IF $FIND($PIECE(POS1,Y,5),".") SET YA(3)=$$^WWWZAHL($PIECE(POS1,Y,5),5,$LENGTH($PIECE($PIECE(POS1,Y,5),".",2)))
	. . IF '$FIND($PIECE(POS1,Y,5),",") IF '$FIND($PIECE(POS1,Y,5),".") SET YA(3)=$$^WWWZAHL($PIECE(POS1,Y,5),5,0)
	. . DO  ;MENGENEINHEIT
	. . . QUIT:$PIECE(POS1,Y,40)=""
	. . . SET YA(3)=YA(3)_" "_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(POS1,Y,40),1)),Y,1)
	. . ;
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. ;
	. ;Artikelnr
	. SET YA(1)=$PIECE(YBELEG1,Y,54)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,55)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=22
	. ;IF YA(1)=1 DO  ;ANZEIGEN ;display                                     ; DISABLED BLOCK MARKED
	. ;. SET YA(3)=$$^WWWTEXT(32110)_$PIECE(POS1,Y,4)  ;ART-NR.:XXXXX
	. ;. SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. ;
	. SET YA(99)=A
	. ;DO SPE^INDRUCK
	. ;SET A=YSPE ;table-mat 
	. ;TEXT
	. SET YA(1)=$PIECE(YBELEG1,Y,48)   ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. DO               ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . SET YA(3)=$TRANSLATE($PIECE(POS1,Y,1),"|"," ")
	. . NEW TEXT,TEXT1,YUN,strTag,strUTag
	. . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . SET TEXT=YA(3)
	. . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . DO SPE^INDRUCK 
	. . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . ;
	. . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. SET A=YSPE
	. ;AUSFUEHRUNG
	. SET YA(1)=$PIECE(YBELEG1,Y,48)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,49)   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . QUIT:$TRANSLATE($PIECE(POS1,Y,10),"| ")'=""  ;KUNDENTEXT VORHANDEN ;on hand 
	. . SET YA(3)=$TRANSLATE($PIECE(POS1,Y,14),"|"," ")
	. . NEW TEXT,TEXT1,strTag,strUTag
	. . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . SET TEXT=YA(3)
	. . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . DO SPE^INDRUCK 
	. . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . ;
	. . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. SET A=YSPE
	. ;KUNDENTEXT
	. SET YA(1)=$PIECE(YBELEG1,Y,48)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,49)+SPACE   ;SPALTE ;column 
	. IF YA(2)="" SET YA(2)=14
	. ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . SET YA(3)=$TRANSLATE($PIECE(POS1,Y,10),"|"," ")
	. . NEW TEXT,TEXT1,strTag,strUTag
	. . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . SET TEXT=YA(3)
	. . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . ;FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" " SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"<U>") YUN=$GET(YUN)+1 SET:$FIND($$^WWWUPER($PIECE(TEXT1," ",YA(33))),"</U>") YUN=$GET(YUN)-1
	. . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET strTag=$PIECE(TEXT1," ",YA(33)) SET A=A_strTag_" " set strUTag=$zconvert(strTag,"U") SET:$FIND(strUTag,"<U>") YUN=$GET(YUN)+1 SET:$FIND(strUTag,"</U>") YUN=$GET(YUN)-1
	. . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO
	. . . . . IF $GET(YUN)>0 SET A=A_"</U>"
	. . . . . DO SPE^INDRUCK 
	. . . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . IF $GET(YUN)>0 SET A=A_"<U>"
	. . . ;
	. . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	
	QUIT
	
SAP(YSUM) ;ÃœBERTRAGEN / TRANSFER DATA
	; ByRef : POS1
	
	DO
	. NEW RNUM,SNUM,SATZ,UM,POSX
	. SET POSX=POS1
	. NEW POS1
	. SET POS1=POSX
	. SET SATZ=""
	. SET RNUM=$PIECE(YAUFTRAG1,Y,96)
	. SET SNUM=$ORDER(^INSAPSD(YM,YKUNDE,YDATE,RNUM,""),-1)+1
	. IF SNUM=1 SET SNUM=3   ;WEGEN DES HEADERS= POSITIONEN AB ZEILE 3
	. IF SNUM=2 SET SNUM=3   ;WEGEN DES HEADERS= POSITIONEN AB ZEILE 3
	. SET SATZ="20"_"40"  ;RECHNUNG
	. IF $PIECE(POS1,Y,5)<0 IF $PIECE(POS1,Y,118)<0 SET $PIECE(POS1,Y,118)=$PIECE(POS1,Y,118)*-1 SET $PIECE(POS1,Y,5)=$PIECE(POS1,Y,5)*-1  ;TYBD;MINUS*MINUS
	. IF $PIECE(POS1,Y,118)<0 SET SATZ="20"_"50" SET $PIECE(POS1,Y,118)=$PIECE(POS1,Y,118)*-1 ;GUTSCHRIFT
	. IF $PIECE(POS1,Y,5)<0 SET SATZ="20"_"50" SET $PIECE(POS1,Y,5)=$PIECE(POS1,Y,5)*-1 ;GUTSCHRIFT
	. SET SATZ=SATZ_$EXTRACT($PIECE(POS1,Y,384)_"      ",1,6)   ;SACHKONTO
	. SET SATZ=SATZ_$$^WWWZAHL($PIECE(POS1,Y,118),12,2)_$EXTRACT(YWHR_"   ",1,3)  ;PREIS
	. SET SATZ=SATZ_$$^WWWZAHL($PIECE(POS1,Y,5),9,0)  ;MENGE
	. IF +$GET(YSUM)'=0 SET SATZ=SATZ_$$^WWWZAHL(YSUM,12,2)_$EXTRACT(YWHR_"   ",1,3)
	. IF +$GET(YSUM)=0 SET SATZ=SATZ_$$^WWWZAHL($PIECE(POS1,Y,118)*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4)),12,2)_$EXTRACT(YWHR_"   ",1,3)
	. SET UM=$PIECE(POS1,Y,40)
	. IF UM'="" SET UM=$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,UM,1)),Y,1)
	. SET SATZ=SATZ_$EXTRACT(UM_"  ",1,2)  ;MENGENEINHEIT
	. SET SATZ=SATZ_"  "  ;FREI
	. SET SATZ=SATZ_$EXTRACT($PIECE(POS1,Y,385)_"        ",1,7)   ;KOSTENSTELLE
	. DO
	. . IF $PIECE(POS1,Y,256)'="" SET SATZ=SATZ_$EXTRACT($PIECE(POS1,Y,256)_"        ",1,12) Q  ;AUFTRAGSNUMMER KUNDE
	. . SET SATZ=SATZ_$EXTRACT($PIECE($GET(POS1),Y,284)_"        ",1,12)   ;AUFTRAGSNUMMER KUNDE
	. .;SET SATZ=SATZ_$EXTRACT($PIECE($GET(YAUFTRAG1),Y,302)_"        ",1,12)   ;AUFTRAGSNUMMER KUNDE
	. ;
	. SET SATZ=SATZ_$EXTRACT($PIECE(POS1,Y,4)_"       ",1,6)
	. SET SATZ=SATZ_$EXTRACT($PIECE(POS1,Y,1)_"                                                  ",1,42)
	. SET SATZ=SATZ_$EXTRACT(RNUM_"       ",1,7)
	. SET SATZ=SATZ_$$^WWWDATE(YDATE)
	. SET ^INSAPSD(YM,YKUNDE,YDATE,RNUM,SNUM,1)=SATZ
	
	QUIT 
]]></Routine>
</Export>