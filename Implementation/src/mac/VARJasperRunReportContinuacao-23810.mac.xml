<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="VARJasperRunReportContinuacao" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[VARJasperRunReportContinuacao

#include COMSYS
#include COMConst
#include INConst
#include VARConst
#include MEDConst
	
	quit
	
RunReportAnaliseConsumoPorProduto(pProduto,pLocal,pMes,pAno)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-11-05	Vitor  Created
	;-------------------------------------------------------------------------------
	new NomeUsuario,Usuario,descProduto,grupo,descGrupo,unidade,descUnidade, custoMedio,
	CMMRede,CMMLocal, descMes
	
	set strWhere      = ""
	set descLocal     = ""
	set descGrupo 	  = ""
	
	; Busca todos os campos necessários para montar o cabeçalho
	set descProduto = $$SQLGetDescricaoProduto^VARSQL(pProduto)
	set strWhere = " WHERE  Linha.Produto = '"_pProduto_"' " ; Filtro do Produto Obrigatório
	set grupo = $piece($get(^INART(YM,pProduto,1)),Y,30)
	set descGrupo = $$SQLGetDescGrupoItem^VARSQL(grupo)
	set unidade = $piece($get(^INART(YM,pProduto,1)),Y,40)
	set descUnidade = $piece($get(^WWW101(YM,"EINHEIT","PT",unidade,1)),"~",1)
	set custoMedio = $$FormatCurrency^COMTable($piece($get(^INART(YM,pProduto,1)),Y,140))
	set CMMRede = $$GetCMM^VARReposicao(pProduto)
	
	if pLocal '= "" {
		set CMMLocal = $$GetCMM^VARReposicao(pProduto,pLocal)
	}
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$SQLGetUserName^VARSQL(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if pMes '= "" {
		set descMes = $piece($get(^WWW101(0,"COMMONTHSOFYEAR","PT",pMes,1)),Y,1)
		set strWhere = strWhere_ " AND Linha.Mes = '"_pMes_"' "
	}
	
	if pAno '= "" {
		set strWhere = strWhere_ " AND Linha.Ano = '"_pAno_"' "
	}
	
	if pLocal '= "" {
		set descLocal = $$SQLGetLocationName^VARSQL(pLocal)
		set strWhere = strWhere_ " AND CadastroEmpresa.Location = '"_pLocal_"' "	
	}
	
	/*
	if pGrupo '= ""{
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
		set strWhere  = " WHERE GrupoPai = "_$$SQLGetGrupoPai^VARSQL(pGrupo)_" "
	}  */
	
	if ((pProduto '= "") && (pMes = "") && (pLocal = "") &&  (pAno = "")) {
		set link=$$Start^VARJasperRun("VARAnaliseConsumoRedeHistorico")
	}
	elseif ((pProduto '= "") && (pMes '= "") && (pLocal = "") && (pAno '= "")) {		
 		set link=$$Start^VARJasperRun("VARAnaliseConsumoRedeMes")
 	}
 	elseif ((pProduto '= "") && (pMes = "") && (pLocal '= "") &&  (pAno = "")) {
 		set link=$$Start^VARJasperRun("VARAnaliseConsumoLocalHistorico")
 	} 
 	elseif ((pProduto '= "") && (pMes '= "") && (pLocal '= "") && (pAno '= "")) {
		set link=$$Start^VARJasperRun("VARAnaliseConsumoLocalMes")
 	}
	
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",Usuario)
	set link=$$addUserParameter^VARJasperRun(link,"pMes",pMes)
	set link=$$addUserParameter^VARJasperRun(link,"pAno",pAno)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"pProduto",pProduto)
	set link=$$addUserParameter^VARJasperRun(link,"descProduto",descProduto)
	set link=$$addUserParameter^VARJasperRun(link,"grupo",grupo)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"unidade",unidade)
	set link=$$addUserParameter^VARJasperRun(link,"descUnidade",descUnidade)
	set link=$$addUserParameter^VARJasperRun(link,"custoMedio",custoMedio)
	set link=$$addUserParameter^VARJasperRun(link,"CMMRede",CMMRede)
	set link=$$addUserParameter^VARJasperRun(link,"Local",pLocal)
	
	if pLocal '= "" {
		set link=$$addUserParameter^VARJasperRun(link,"CMMLocal",CMMLocal)
	}
	if pMes '= "" {
		set descMes = $piece($get(^WWW101(0,"COMMONTHSOFYEAR","PT",pMes,1)),Y,1)
		set link=$$addUserParameter^VARJasperRun(link,"descMes",descMes)
	}
	
	do ViewInForm^VARJasperRun(link,"Relatório Analise de Consumo por Produto")
	
	quit
	
RunReportHistoricoConsumoLocal(pDataInicial,pDataFinal,pLocal,pGrupo)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-11-09	Vitor  Created
	;-------------------------------------------------------------------------------
	new NomeUsuario,Usuario
		
	set strWhere      = ""
	set descLocal     = ""
	set descGrupo 	  = ""
		
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario= $$SQLGetUserName^VARSQL(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if pLocal '= ""{		
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
		set strWhere =  "WHERE Linha.LocalEstoque = '"_pLocal_"' "
	}
	
	if pGrupo '= ""{
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
		set strWhere = strWhere_" AND Inart.ItemGroup = '"_pGrupo_"' "
	}
	if pDataInicial '= "" {
		set strWhere = strWhere_" AND Linha.Data >= '"_pDataInicial_"' "
		set pDataInicial  = $zdate(pDataInicial,4,,4)
	}
	if pDataFinal '= "" {
		set strWhere = strWhere_" AND Linha.Data <= '"_pDataFinal_"' "
		set pDataFinal    = $zdate(pDataFinal,4,,4)
	}else{
		set pDataFinal = $zdate($horolog,4)
	}

	set link=$$Start^VARJasperRun("VARHistoricoConsumoLocal")
	
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",Usuario)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",pDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",pDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal",pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo",pGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	
	do ViewInForm^VARJasperRun(link,"Relatório Histórico de Consumo Por Local")

	quit
	
RunReportHistoricoConsumoCentroCusto(pDataInicial,pDataFinal,pGrupo,pProduto,pCentroDeCusto)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-11-12	Vitor  Created
	;-------------------------------------------------------------------------------
	new NomeUsuario,Usuario,DescCC
		
	set strWhere      = ""
	set descGrupo 	  = ""
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario= $$SQLGetUserName^VARSQL(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if pDataInicial '= "" {
		set strWhere = " WHERE Data >= '"_pDataInicial_"' "
		set pDataInicial  = $zdate(pDataInicial,4,,4)
	}
	
	if pDataFinal '= "" {
		set strWhere = strWhere_" AND Data <= '"_pDataFinal_"' "
		set pDataFinal    = $zdate(pDataFinal,4,,4)
	}else{
		set pDataFinal = $zdate($horolog,4,,4)
	}
	
	if pGrupo '= ""{
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)							
		set strWhere = strWhere_" AND $$SQLGetGrupoItem^VARSQL(Produto) = '"_pGrupo_"'"
	}
	
	if pProduto '= "" {
		set descProduto = $$SQLGetDescricaoProduto^VARSQL(pProduto)
		set strWhere = strWhere_" AND Produto = '"_pProduto_"' "
	}
		
	if pCentroDeCusto '= "" {
		;set DescCC = $piece($get(^WWW0121(0,0,pCentroDeCusto,1)),"~",62)
		set DescNomeCC = $$SQLGetCentroCustoDesc^VARSQL(pCentroDeCusto)
		set strWhere = strWhere_" AND CentrodeCusto = '"_pCentroDeCusto_"' "
	}
	
	set link=$$Start^VARJasperRun("VARHistoricoConsumoCentroCusto")
		
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",Usuario)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",pDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",pDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo",pGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"CentroDeCusto",pCentroDeCusto)
	set link=$$addUserParameter^VARJasperRun(link,"Produto",pProduto)
	if pProduto '= "" {
		set link=$$addUserParameter^VARJasperRun(link,"descProduto",descProduto)	
	}
	set link=$$addUserParameter^VARJasperRun(link,"DescCC",pCentroDeCusto)
	set link=$$addUserParameter^VARJasperRun(link,"DescNomeCC",DescNomeCC)
	do ViewInForm^VARJasperRun(link,"Relatório Histórico de Consumo por Centro de Custo")
	
	quit
	
RunReportHistoricoConsumoContaContabil(pDataInicial,pDataFinal,pGrupo,pProduto,pContaContabil)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-11-12	Vitor  Created
	;-------------------------------------------------------------------------------
	new NomeUsuario,Usuario,DescCC
		
	set strWhere      = ""
	set descGrupo 	  = ""
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario= $$SQLGetUserName^VARSQL(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	if pDataInicial '= "" {
		set strWhere = " WHERE Data >= '"_pDataInicial_"' "
		set pDataInicial  = $zdate(pDataInicial,4,,4)
	}
	
	if pDataFinal '= "" {
		set strWhere = strWhere_" AND Data <= '"_pDataFinal_"' "
		set pDataFinal    = $zdate(pDataFinal,4,,4)
	}else{
		set pDataFinal = $zdate($horolog,4,,4)
	}
	
	if pGrupo '= ""{
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)							
		set strWhere = strWhere_" AND $$SQLGetGrupoItem^VARSQL(Produto) = '"_pGrupo_"'"
	}
	
	if pProduto '= "" {
		set descProduto = $$SQLGetDescricaoProduto^VARSQL(pProduto)
		set strWhere = strWhere_" AND Produto = '"_pProduto_"' "
	}
		
	if pContaContabil '= "" {
		set strWhere = strWhere_"and $$SQLGetContaContabil^VARSQL(Produto) = '"_pContaContabil_"'"
		set descContaContabil   = $$SQLGetDescContaContabil^VARSQL(pContaContabil)
	}
	
	set link=$$Start^VARJasperRun("VARHistoricoConsumoContaContabil")
		
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",Usuario)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",pDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",pDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo",pGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"ContaContabil",pContaContabil)
	set link=$$addUserParameter^VARJasperRun(link,"descContabil",descContaContabil)

	set link=$$addUserParameter^VARJasperRun(link,"Produto",pProduto)
	if pProduto '= "" {
		set link=$$addUserParameter^VARJasperRun(link,"descProduto",descProduto)	
	}
	do ViewInForm^VARJasperRun(link,"Relatório Histórico de Consumo por Conta Contábil")
	
	quit	
RunReportHistoricoConsumoPaciente(pDataInicial,pDataFinal,pGrupo,pProduto,pPaciente)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2012-11-12	Vitor  Created
	;-------------------------------------------------------------------------------
	new NomeUsuario,Usuario, descPaciente, idadePaciente, dataNascPaciente, descProduto
	
	set strWhere      = ""
	set descGrupo 	  = ""
	set mes 	      = ""
	
	set descProduto = $$SQLGetDescricaoProduto^VARSQL(pProduto)

	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario= $$SQLGetUserName^VARSQL(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	
	if pPaciente '= "" {
		set descPaciente = $$SQLGetPatientName^VARSQL(pPaciente)
		set dataNascPaciente = $zdate($$SQLGetPatientDataNascimento^VARSQL(pPaciente),4,,4)
		set idadePaciente = $$SQLGetPatientAge^VARSQL($$SQLGetPatientDataNascimento^VARSQL(pPaciente))
		set strWhere = " WHERE Linha.SetorOuPaciente = '"_pPaciente_"' "
	}
	
	
	if pGrupo '= ""{
		set descGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
		set strWhere = strWhere_" AND Inart.ItemGroup = '"_pGrupo_"' "
	}
	
	if pDataInicial '= "" {
		set strWhere = strWhere_" AND Linha.Data >= '"_pDataInicial_"' "
		set pDataInicial = $zdate(pDataInicial,4,,4) 
	}
	
	if pDataFinal '= "" {
		set strWhere = strWhere_" AND Linha.Data <= '"_pDataFinal_"' "	
		set pDataFinal = $zdate(pDataFinal,4,,4)
	}else{
		set pDataFinal = $zdate($horolog,4,,4)
	}
	
	
	if pProduto '= "" {
		set strWhere = strWhere_" AND Inart.ItemNumber = '"_pProduto_"' "
	}
	; Filtro do tipo de transação
	set strWhere = strWhere_ " AND Linha.TipoMovmto <> 22 "
		
	set folder = $piece($GET(^VARJasper(YM,YM,1)),Y,1)
	 
	set link=$$Start^VARJasperRun("VARHistoricoConsumoPaciente")
		
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",Usuario)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",pDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",pDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo",pGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"Paciente",pPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"DescPaciente",descPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"Produto",pProduto)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir", folder)
	set link=$$addUserParameter^VARJasperRun(link,"dataNascPaciente",dataNascPaciente )
	set link=$$addUserParameter^VARJasperRun(link,"idadePaciente", idadePaciente)
	set link=$$addUserParameter^VARJasperRun(link,"descProduto", descProduto)
	
	do ViewInForm^VARJasperRun(link,"Relatório Histórico de Consumo por Paciente")
	
	quit
		
RunReportEtqFarmacotecnica(dispensacao,item,paciente,Line)

	new pFiltro
	set pFiltro = ""

	set pFiltro = pFiltro_" AND MEDDispense.Dispensation = '"_dispensacao_"' "
	set pFiltro = pFiltro_" AND MEDDispenseLine.ItemName = '"_item_"' "
	set pFiltro = pFiltro_" AND MEDPrescription.PatientID = '"_paciente_"' "
	set pFiltro = pFiltro_" AND MEDDispenseLine.Line = '"_Line_"' "
	
	set link=$$Start^VARJasperRun("VARFarmacotecnicaEtq")
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",pFiltro)
	do ViewInForm^VARJasperRun(link,"Relatório - Etiqueta - Farmacotécnica")
	
	quit
	
RunReportConsumoProdutosTrimestre(pMes,pAno,pLocal,pCentroDeCusto,pGrupo)
	new descLocal,descGrupo,descCC,strWhere,pMesPassado,pMesRetrasado
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario= $$SQLGetUserName^VARSQL(Usuario)
	} else {
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set descLocal = $$SQLGetLocationName^VARSQL(pLocal)
	set descGrupo = $$SQLGetDescGrupoItem^VARSQL(pGrupo)
	set descCC 	  = $$SQLGetCentroCustoDesc^VARSQL(pCentroDeCusto)
	
	set anoPassado = ""
	
	if pMes = 2 {
		set pMesRetrasado = 12
		set anoPassado = pAno - 1
		set pMesPassado = pMes - 1
	} elseif pMes = 1 {
		set pMesPassado = 12
		set pMesRetrasado = 11
		set anoPassado = pAno - 1
	}else {
		set pMesPassado 	= pMes - 1
		set pMesRetrasado 	= pMes - 2
	}
	
	set strWhere = " WHERE (Mes = '"_pMes_"' OR Mes = '"_pMesPassado_"' OR Mes = '"_pMesRetrasado_"')  "
	set strWhere = strWhere_" AND (Ano = '"_pAno_"' "
	if anoPassado '= "" {
		set strWhere = strWhere_" OR Ano = '"_anoPassado_"' )"
	}else {
		set strWhere = strWhere_") "
	}
	if pLocal '= "" {
		set strWhere = strWhere_" AND LocalDeEstocagem = '"_pLocal_"' "
	}
	if pCentroDeCusto '= "" {
		set strWhere = strWhere_" AND CentroDeCusto = '"_pCentroDeCusto_"' "	
	}
	if pGrupo '= "" {
		set strWhere = strWhere_" AND $$SQLGetGrupoPai^VARSQL(Grupo) =  '"_pGrupo_"' "
	} 
	
	// Filtro por Usuário
	
	set strWhere = strWhere_ " AND Usuario = '"_YBED_"' "
	
	set link=$$Start^VARJasperRun("VARConsumoProdutosTrimestre")

	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario",Usuario)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"mes",pMes)
	set link=$$addUserParameter^VARJasperRun(link,"ano",pAno)
	set link=$$addUserParameter^VARJasperRun(link,"local",pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descCC",descCC)
	set link=$$addUserParameter^VARJasperRun(link,"centroDeCusto",pCentroDeCusto)
	set link=$$addUserParameter^VARJasperRun(li]]><![CDATA[nk,"grupo",pGrupo)
	
	do ViewInForm^VARJasperRun(link,"Relatório Consumo dos Produtos por Trimestre")

RunReportListaTrabalhoFarmacotecnica()

	new Usuario, NomeUsuario, pOrdenarPor
	
	set pOrdenarPor = $$SQLGetUserParamDescVAR^VARSQL("VARLISTAFARMACOTECNICA~"_$get(VORG(5)))
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$SQLGetUserName^VARSQL(Usuario)
	} else { 
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	set link=$$Start^VARJasperRun("VARListaTrabalhoFarmacotecnica")
	set link=$$addUserParameter^VARJasperRun(link,"nomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pOrdenarPor",pOrdenarPor)
	do ViewInForm^VARJasperRun(link,"Relatório - Lista de Trabalho - Farmacotécnica")
	
	quit
	
RunReportProducaoFracionamento(dtaInicial,dtaFinal,colaborador,produto,formato)

	new usuario, nomeUsuario, filtro1, filtro2, descColaborador, descCompletaProduto, descFormato
	
	set filtro1 = ""
	set filtro2 = ""
	
	if YBED '= "" {
		set usuario      = YBED
		set nomeUsuario  = $$SQLGetUserName^VARSQL(usuario)
	} else {
		set usuario      = "NOUSER"
		set nomeUsuario  = "NOUSER"
	}
	
	if ( (formato = 1) || (formato = "") ) {
		set link = $$Start^VARJasperRun("VARProducaoFracionamentoSimplificado")
	} else {
		set link = $$Start^VARJasperRun("VARProducaoFracionamentoCompleto")
	}
	
	set filtro1 = filtro1_" AND (+Etapa.Data) BETWEEN '"_dtaInicial_"' AND '"_dtaFinal_"' "
	set filtro2 = filtro2_"	AND (+Producao.IssueFirmedDate) BETWEEN '"_dtaInicial_"' AND '"_dtaFinal_"' "
	
	if (colaborador '= "") {
		set filtro1     	= filtro1_" AND Etapa.Responsavel = '"_colaborador_"' "
		set filtro2			= filtro2_" AND Producao.IssueFirmedBy = '"_colaborador_"' "
		set descColaborador	= $$SQLGetUserName^VARSQL(colaborador)
		set link 			= $$addUserParameter^VARJasperRun(link,"descColaborador",descColaborador)
	}
		
	if (produto '= "") {
		set filtro1     		= filtro1_" AND Ordem.Produto = '"_produto_"' "
		set filtro2     		= filtro2_" AND Producao.ItemCode = '"_produto_"' "
		set descCompletaProduto = produto_" - "_$$SQLGetDescricaoProduto^VARSQL(produto)
		set link				= $$addUserParameter^VARJasperRun(link,"descCompletaProduto",descCompletaProduto)
	}
	
	if ( (formato = "") || (formato = 1) ) {
		set descFormato = $piece($get(^VARPARA(YM,"FORMATORELPRODUCAO","PT",1,1)),Y,1)
	} else {
		set descFormato = $piece($get(^VARPARA(YM,"FORMATORELPRODUCAO","PT",2,1)),Y,1)
	}
	
	set dtaInicial = $zdate(dtaInicial,4)
	set dtaFinal   = $zdate(dtaFinal,4)	
	
	set link       = $$addUserParameter^VARJasperRun(link,"dtaInicial",dtaInicial)
	set link       = $$addUserParameter^VARJasperRun(link,"dtaFinal",dtaFinal)
	set link       = $$addUserParameter^VARJasperRun(link,"usuario",usuario)
	set link       = $$addUserParameter^VARJasperRun(link,"nomeUsuario",nomeUsuario)
	set link       = $$addUserParameter^VARJasperRun(link,"filtro1",filtro1)
	set link       = $$addUserParameter^VARJasperRun(link,"filtro2",filtro2)
	set link       = $$addUserParameter^VARJasperRun(link,"colaborador",colaborador)
	set link       = $$addUserParameter^VARJasperRun(link,"produto",produto)
	set link       = $$addUserParameter^VARJasperRun(link,"descFormato",descFormato)
	
	do ViewInForm^VARJasperRun(link,"Relatório - Produção no Fracionamento")
	
	quit
	
	
	
RunReportListaSeparacaoDispensacao(pYKEY)
	;-------------------------------------------------------------------------------
	;
	; Histórico:
	; 2012-10-18	Bruno 	 Created
	;-------------------------------------------------------------------------------
	quit:(pYKEY = "")
	new Usuario, NomeUsuario
	
	if YBED'="" {
		set Usuario=YBED
		set NomeUsuario=$$getNomeUsuario^VARJasperRunReport(Usuario)
	} else { 
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	set blnPickList = ""
	if (pYKEY '= ""){
		set blnPickList = $order(^MEDDispensePickLine(0,pYKEY,""))
	}
	if (blnPickList = ""){
		set ^VARTempMEDDispenseSeparacao(YM,YBED) = $$$NO
	}
	
	set objDispense     = $get(^MEDDispense(YM,pYKEY,1))
	set objPrescription = $get(^MEDPrescription(YM,$$$MEDDispensePrescription(objDispense),1))
	
	set folder = $piece($GET(^VARJasper(YM,YM,1)),Y,1) 
	
	set pLocalAbastecedor = $$$MEDDispenseSupplyingLocation(objDispense)_" - "_$$SQLGetLocationName^VARSQL($$$MEDDispenseSupplyingLocation(objDispense))
	set pLocalDestino	  = $$$MEDDispenseDestinationLocation(objDispense)_" - "_$$SQLGetLocationName^VARSQL($$$MEDDispenseDestinationLocation(objDispense))
	set pPaciente		  = ""
	set dtNascimento	  = ""
	set quarto			  = ""
	set leito			  = ""
	set pPrescricao 	  = $$$MEDDispensePrescription(objDispense)
	
	if (objPrescription '= ""){
		set pPaciente		  = $$$MEDPrescriptionPatientID(objPrescription)_" - "_$$SQLGetPatientName^VARSQL($$$MEDPrescriptionPatientID(objPrescription))
		set dtNascimento	  = $$SQLGetFormatDate7^VARSQL($$SQLGetPatientDataNascimento^VARSQL($$$MEDPrescriptionPatientID(objPrescription)))
		set quarto			  = $$SQLGetPatientRoom^VARSQL($$$MEDPrescriptionPatientID(objPrescription))
		set leito			  = $$SQLGetPatientBed^VARSQL($$$MEDPrescriptionPatientID(objPrescription))	
	}
	
	set link=$$Start^VARJasperRun("VARListaDeSeparacaoDispensa")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"NoDispensacao",pYKEY)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir", folder)
	set link=$$addUserParameter^VARJasperRun(link,"pLocalAbastecedor", pLocalAbastecedor)
	set link=$$addUserParameter^VARJasperRun(link,"pLocalDestino", pLocalDestino)
	set link=$$addUserParameter^VARJasperRun(link,"pPaciente", pPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"dtNascimento", dtNascimento)
	set link=$$addUserParameter^VARJasperRun(link,"quarto", quarto)
	set link=$$addUserParameter^VARJasperRun(link,"leito", leito)
	set link=$$addUserParameter^VARJasperRun(link,"pPrescricao", pPrescricao)
	do ViewInForm^VARJasperRun(link,"Relatório - Dispensação - Lista de Separação")
	
	quit
	
RunReportHistoricoRec(pDataInicial,pDataFinal,pFormato)
	;Relatório do formulário VARHistoricoRecebimento
	;
	;Histórico
	;
	;2010-10-07	Sósthenes	Created
	;2010-12-14	Sósthenes	Adicionado filtro de Tipo
	;2012-26-02 Vitor		Função movida da rotina VARJasperRunReport

	set strFiltro			= ""
	set strMarca			= ""
	set strMarcaCompleta	= ""
	set strDescMarca		= ""
	set strLocal			= ""
	set strGrupo			= ""
	set strProduto			= ""
	set strOrdem			= ""
	set strFornecedor		= ""
	set strType				= ""
	set strDescFiltro		= ""
	set strLocalFiltro		= ""
	set strGrupoFiltro		= ""
	set strProdutoFiltro	= ""
	set strOrdemFiltro		= ""
	set strFornecedorFiltro = ""
	set strTypeFiltro		= ""
	set strProgramaFiltro	= ""
	set strFormato			= ""
	set Local  				= $get(VORG(3))
	set Produto		 		= $get(VORG(4))
	set Grupo	 			= $get(VORG(5))
	set Ordem	 			= $get(VORG(6))
	set Fornecedor 			= $get(VORG(7))
	set Type	 			= $get(VORG(8))
	set Programa 			= $get(VORG(10))
	set Marca				= $get(VORG(11))
	set dtInicialF			= $$SQLGetFormatDate7^VARSQL(pDataInicial) //Data inicial formatada
	set dtFinalF			= $$SQLGetFormatDate7^VARSQL(pDataFinal)   //Data final formatada
	
	if (Local) '="" {
		set strLocal = " AND INR.Location =  '"_Local_"'"
		set strLocalFiltro = Local_" - "_$$SQLGetLocationName^VARSQL(Local)
	} if (Grupo) '="" {
		set strGrupo = " AND $$SQLGetFiltroGrupo^VARSQL('"_Grupo_"',INRLine.Item) = 1 " 
		set strGrupoFiltro = Grupo_" - "_$$SQLGetDescGrupoItem^VARSQL(Grupo)
	} if (Produto) '="" {
		set strProduto = " AND INRLine.Item = '"_Produto_"' "
		set strProdutoFiltro = Produto_" - "_$$SQLGetDescricaoProduto^VARSQL(Produto)
	} if (Ordem) '="" {
		set strOrdem = " AND  INRLine.Order1 = '"_Ordem_"' "
		set strOrdemFiltro = Ordem
	} if (Fornecedor) '="" {
		set strFornecedor = " AND INR.Supplier = '"_Fornecedor_"' "
		set strFornecedorFiltro = Fornecedor_" - "_$$SQLGetDescFornecedor^VARSQL(Fornecedor)
	} if (Type) '="" {
		set strType = " AND INR.TypeofReceiving = '"_Type_"' "
		set strTypeFiltro = $$SQLGetDescTipoVarRec^VARSQL(Type)
	} if (Programa) '= "" {
		set strProgramaFiltro = " AND INRLine.Program1 = '"_Programa_"' "
		set strDescPrograma   = $$GetNomePrograma^VARSQL(Programa)
	} if (Marca '= "") {
		set strMarca     = " AND INRLine.Brand = '"_Marca_"' "
		set strDescMarca = $piece($get(^INBrand(YM,Marca,1)),Y,1)
		set strMarcaCompleta = Marca_" - "_strDescMarca
	}

	  if (pFormato = 1){
		set strFormato = "Completo"
	} if (pFormato = 2){
		set strFormato = "Simplificado"
	}
	
	set strFiltro = strLocal_strGrupo_strProduto_strFornecedor_strOrdem_strType_strMarca_strProgramaFiltro
	set strDescFiltro = strLocalFiltro_strGrupoFiltro_strProdutoFiltro_strFornecedorFiltro_strOrdemFiltro_strTypeFiltro
	
	if YBED'="" {
		set user=YBED
		set strNomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
	}else{ 
		set user="NOUSER"
		set strNomeUsuario="NOUSER"
	}
	
	if (pFormato=1){
		set link=$$Start^VARJasperRun("VARHistoricoRecebimento")
	} else {
		set link=$$Start^VARJasperRun("VARHistoricoRecebimentoSimples")
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"pDataI",pDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"pDataF",pDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"pDataIF",dtInicialF)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFF",dtFinalF)
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",strNomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pDescFiltro",strDescFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pDescMarca",strDescMarca)
	set link=$$addUserParameter^VARJasperRun(link,"pFormato",strFormato)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal",strLocalFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pTipo",strTypeFiltro)
	if (Programa '= "") {
		set link=$$addUserParameter^VARJasperRun(link,"pPrograma",strDescPrograma)
	}
	set link=$$addUserParameter^VARJasperRun(link,"pProduto",strProdutoFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo",strGrupoFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pFornecedor",strFornecedorFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pDocumento",strOrdemFiltro)
	
	do ViewInForm^VARJasperRun(link,"Histórico de Recebimento")
	
	quit

RunReportEstornoTransf(pYKEY)
	quit:(pYKEY = "")
	
	new Usuario, NomeUsuario
	new idTfr, intRevSeq, objReversal, pDtTransf, pLocalAbastecedor, pLocalSolic, pDtEstorno, pStatus, pRespEstorno
	
	set idTfr     = $$$KEY1(pidKey)
	set intRevSeq = $$$KEY2(pidKey)
	
	set objReversal = $get(^INTFRRev(YM,idTfr,intRevSeq,1))
	
	if (objReversal = "") {
		set pDtTransf			= ""
		set pLocalAbastecedor	= ""
		set pLocalSolic			= ""
		set pDtEstorno			= ""
		set pStatus				= ""
		set pRespEstorno		= ""
	}
	else {
		set pDtTransf			= $$SQLGetDataFormatada^VARSQL($$$INTFRRevTransferDate(objReversal))
		set pLocalAbastecedor	= $$$INTFRRevSendingLocation(objReversal)_" - "_$$SQLGetLocationName^VARSQL($$$INTFRRevSendingLocation(objReversal))
		set pLocalSolic			= $$$INTFRRevReceivingLocation(objReversal)_" - "_$$SQLGetLocationName^VARSQL($$$INTFRRevReceivingLocation(objReversal))
		set pDtEstorno			= $$SQLGetFormatDate^VARSQL($$$INTFRRevReversed(objReversal))
		set pStatus				= $$SQLGetAppParamDesc^VARSQL("INSTATUS~"_$$$INTFRRevStatus(objReversal))
		set pRespEstorno		= $$$INTFRRevProcessedBy(objReversal)
	}
	
	if (YBED '= "") {
		set Usuario=YBED
		set NomeUsuario=$$SQLGetUserName^VARSQL(Usuario)
	} else { 
		set Usuario="NOUSER"
		set NomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VAREstornoTransf")
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pEstorno",idTfr)
	set link=$$addUserParameter^VARJasperRun(link,"pNoEstorno",intRevSeq)
	set link=$$addUserParameter^VARJasperRun(link,"pDtTransf",pDtTransf)
	set link=$$addUserParameter^VARJasperRun(link,"pLocalAbastecedor",pLocalAbastecedor)
	set link=$$addUserParameter^VARJasperRun(link,"pLocalSolic",pLocalSolic)
	set link=$$addUserParameter^VARJasperRun(link,"pDtEstorno",pDtEstorno)
	set link=$$addUserParameter^VARJasperRun(link,"pRespEstorno",pRespEstorno)
	set link=$$addUserParameter^VARJasperRun(link,"pStatus",pStatus)
	
	do ViewInForm^VARJasperRun(link,"Relatório de Estorno de Transferência")	
	
	quit
	
RunReportHistoricoDevolucoes(pvDataInicial,pvDataFinal,pvHoraInicial,pvHoraFinal,pvLocalAbastecedor,pvLocalRequisitante,pvOrdenaPor,pvPaciente,pvProduto,pvMotivo,pvGrupo,pvAtb,pvAgruparMotivo)
	;Relatório do formulário VARHistoricoDevoluces
	;
	;Histórico
	;
	;2010-06-28	Lucas	Created
	
	set flDataInicial	 		= ""
	set flDataFinal		 		= ""
	set flHoraInicial 			= ""
	set flHoraFinal 			= ""
	set flLocalAbastecedor 		= ""
	set flLocalRequisitante 	= ""
	set flPaciente				= ""
	set flProduto				= ""
	set flMotivo				= ""
	set flGrupo					= ""
	set flAtb					= ""
	set flAgruparMotivo			= ""
	set pDescLocalAbastecedor 	= ""
	set pDescLocalRequisitante 	= ""
	set pDescPaciente			= ""
	set pDescProduto			= ""
	set pDescMotivo				= ""
	set pDescGrupo				= ""
	set flOrdenaPor 			= ""
	set dtInicialF				= $$SQLGetFormatDate7^VARSQL(pvDataInicial) //Data inicial formatada
	set dtFinalF				= $$SQLGetFormatDate7^VARSQL(pvDataFinal)   //Data final formatada
	
	if (pvHoraInicial '= ""){
		set hrInicialF = $piece($$SQLGetFormatedTime^VARSQL(pvHoraInicial),":",1)_"h"_$piece($$SQLGetFormatedTime^VARSQL(pvHoraInicial),":",2)_"min"
	}
	else {
		set hrInicialF = "-"
	}
	
	if (pvHoraFinal '= ""){
		set hrFinalF = $piece($$SQLGetFormatedTime^VARSQL(pvHoraFinal),":",1)_"h"_$piece($$SQLGetFormatedTime^VARSQL(pvHoraFinal),":",2)_"min"
	}
	else {
		set hrFinalF = "-"
	}
	
	if (pvLocalAbastecedor '= ""){
		set pDescLocalAbastecedor = $$SQLGetLocationName^VARSQL(pvLocalAbastecedor)
	}
	if (pvLocalRequisitante '= ""){
		set pDescLocalRequisitante = $$SQLGetLocationName^VARSQL(pvLocalRequisitante)
	}
	
	set flDataInicial		= " AND DATEDIFF(dd, Rev.Posted, '"_pvDataInicial_"') <= 0 "
	set flDataFinal 		= " AND DATEDIFF(dd, Rev.Posted, '"_pvDataFinal_"') >= 0 "
	set flLocalAbastecedor 	= " AND Rev.FromLocn = '"_pvLocalAbastecedor_"' "
	
   	if (pvHoraInicial '= ""){
	   	set flHoraInicial = " AND DATEDIFF(hh, $piece(Rev.Posted,"","",2), '"_pvHoraInicial_"') <= 0  "
   	}
   	
   	if (pvHoraFinal '= ""){
	   	set flHoraFinal = " AND DATEDIFF(hh, $piece(Rev.Posted,"","",2), '"_pvHoraFinal_"') >= 0 "
   	}

   	if (pvLocalRequisitante '= ""){
   		set flLocalRequisitante = " AND Rev.ToLocn = '"_pvLocalRequisitante_"' "
   	}
   	
   	if (pvPaciente '= "") {
	   	set flPaciente 	  = " AND Issue.PatientID = '"_pvPaciente_"' "
	   	set pDescPaciente = $$GetPatientName^VARSQL(pvPaciente)
   	}
   	
   	if (pvProduto '= "") {
	   	set flProduto  = " AND Line.ItemNo = '"_pvProduto_"' "
	   	set pDescProduto  = $$SQLGetDescricaoProduto^VARSQL(pvProduto)
   	}
   	
   	if (pvMotivo '= "") {
	   	set flMotivo    = " AND Line.Reason = '"_pvMotivo_"' "
	   	set pDescMotivo = $piece($get(^VARPARA(0,"DEVOLUCAODISPENSACAO","PT",pvMotivo,1)),Y,1)
   	}
   	
   	if (pvGrupo '= "") {
	   	set flGrupo    = " AND $$SQLGetGrupoItem^VARSQL(Line.ItemNo) = '"_pvGrupo_"' "
	   	set pDescGrupo = $$SQLGetDescGrupoItem^VARSQL(pvGrupo)
   	}
   	
   	if (pvAtb = 1) {
	   	set flAtb = " AND $$SQLGetINARTFREE25^VARSQL(Line.ItemNo) = '"_pvAtb_"' "
   	}
   	
   	if (pvAgruparMotivo '= "") {
	   	
	   	if (pvOrdenaPor = 2) {
		   	set flOrdenarPor = " ORDER BY Line.Reason,$$SQLGetDescricaoProduto^VARSQL(Line.ItemNo) "
	   	} else {
		   	set flOrdenarPor = " ORDER BY Line.Reason, Line.ItemNo "
	   	}
	   	
   	} else {  
	   	  	
		if (pvOrdenaPor = 2){
			set flOrdenarPor = " ORDER BY $$SQLGetDescricaoProduto^VARSQL(Line.ItemNo) "
		}
		else {
			set flOrdenarPor = " ORDER BY Line.ItemNo "
		}
   	}
	
	set strFiltro = flDataInicial_flDataFinal_flHoraInicial_flHoraFinal_flLocalAbastecedor_flLocalRequisitante_flPaciente_flProduto_flMotivo_flGrupo_flAtb
	
	if YBED'="" {
		set user=YBED
		set strNomeUsuario=$$getNomeUsuario^VARSESJasperRunReport(user)
	} 
	else {   
		set user="NOUSER"
		set strNomeUsuario="NOUSER"
	}
	
	set link=$$Start^VARJasperRun("VARHistoricoDevolucoes")
	set link=$$addUserParameter^VARJasperRun(link,"pDataI",pvDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"pDataF",pvDataFinal)
	s]]><![CDATA[et link=$$addUserParameter^VARJas]]><![CDATA[perRun(link,"pDataIF",dtInicialF)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFF",dtFinalF)
	set link=$$addUserParameter^VARJasperRun(link,"pHoraIF",hrInicialF)
	set link=$$addUserParameter^VARJasperRun(link,"pHoraFF",hrFinalF)
	set link=$$addUserParameter^VARJasperRun(link,"pLocalAbastecedor",pvLocalAbastecedor)
	set link=$$addUserParameter^VARJasperRun(link,"pDescLocalAbastecedor",pDescLocalAbastecedor)
	set link=$$addUserParameter^VARJasperRun(link,"pLocalRequisitante",pvLocalRequisitante)
	set link=$$addUserParameter^VARJasperRun(link,"pDescLocalRequisitante",pDescLocalRequisitante)
	set link=$$addUserParameter^VARJasperRun(link,"pPaciente",pvPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"pDescPaciente",pDescPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"pProduto",pvProduto)
	set link=$$addUserParameter^VARJasperRun(link,"pDescProduto",pDescProduto)
	set link=$$addUserParameter^VARJasperRun(link,"pMotivo",pvMotivo)
	set link=$$addUserParameter^VARJasperRun(link,"pDescMotivo",pDescMotivo)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo",pvGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"pDescGrupo",pDescGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"pAtb",pvAtb)
	set link=$$addUserParameter^VARJasperRun(link,"pAgruparMotivo",pvAgruparMotivo)
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",strFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",strNomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pOrderBy",flOrdenarPor)
	
	do ViewInForm^VARJasperRun(link,"Histórico de Devoluções")
	
	quit
	
RunReportConsumoTrimestreContabil(pMes,pAno,pLocal,pCentroCusto,pGrupo)
	new strWhere
	 
	if YBED '= "" {
		set usuario      = $get(YBED)
		set nomeUsuario  = $$SQLGetUserName^VARSQL(usuario)
	} else {
		set usuario      = "NOUSER"
		set nomeUsuario  = "NOUSER"
	}
	
	//Mês atual
	set dataInicialAtual = $$SQLGetPrimeiroDiaMes^VARSQL(pMes,pAno)
	set dataFinalAtual	 = $$SQLGetUltimoDiaMes^VARSQL(pMes,pAno)
	
	//Mês passado
	set dataInicialPassada 	= $$AddMonth^COMUtilDate(dataInicialAtual,-1)
	set dataFinalPassada 	= $zdateh($SYSTEM.SQL.DATEADD("dd",-1,dataInicialAtual),3)
	
	//Mês retrasado
	set dataInicialRetrasada = $$AddMonth^COMUtilDate(dataInicialPassada,-1)
	set dataFinalRetrasada	 = $zdateh($SYSTEM.SQL.DATEADD("dd",-1,dataInicialPassada),3)
	
	set formatoAtual     = $$FormatDataMesAno^VARConsumoProdutosTrimestreContabil(dataInicialAtual)
	set formatoPassado   = $$FormatDataMesAno^VARConsumoProdutosTrimestreContabil(dataInicialPassada)
	set formatoRetrasado = $$FormatDataMesAno^VARConsumoProdutosTrimestreContabil(dataInicialRetrasada)
	
	set strWhere = " WHERE Movimento IS NOT NULL "
	
	if (pLocal '= "") {
		set strWhere = strWhere_ " AND LocalEstoque = '"_pLocal_"' "
	}
	if (pCentroCusto '= "") {
		set strWhere = strWhere_ " AND CentroCusto = '"_pCentroCusto_"' "
	}
	if (pGrupo '= "") {
		set strWhere = strWhere_ " AND $$SQLGetGrupoPai^VARSQL($$SQLGetGrupoItem^VARSQL(Produto)) = '"_$$SQLGetGrupoPai^VARSQL(pGrupo)_"' "
	}

	set descLocal 		= $$SQLGetLocationName^VARSQL(pLocal)
	set descGrupo 		= $$SQLGetDescGrupoItem^VARSQL(pGrupo)
	set descCentroCusto	= $$SQLGetCentroCustoDesc^VARSQL(pCentroCusto)
	
	set link=$$Start^VARJasperRun("VARConsumoTrimestreContabil")
	
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal",pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pCentroCusto",pCentroCusto)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo",pGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descCentroCusto",descCentroCusto)
	set link=$$addUserParameter^VARJasperRun(link,"dataInicialAtual",dataInicialAtual)
	set link=$$addUserParameter^VARJasperRun(link,"dataFinalAtual",dataFinalAtual)
	set link=$$addUserParameter^VARJasperRun(link,"dataInicialPassada",dataInicialPassada)
	set link=$$addUserParameter^VARJasperRun(link,"dataFinalPassada",dataFinalPassada)
	set link=$$addUserParameter^VARJasperRun(link,"dataInicialRetrasada",dataInicialRetrasada)
	set link=$$addUserParameter^VARJasperRun(link,"dataFinalRetrasada",dataFinalRetrasada)
	set link=$$addUserParameter^VARJasperRun(link,"formatoAtual",formatoAtual)
	set link=$$addUserParameter^VARJasperRun(link,"formatoPassado",formatoPassado)
	set link=$$addUserParameter^VARJasperRun(link,"formatoRetrasado",formatoRetrasado)
	
	do ViewInForm^VARJasperRun(link,"Relatório de Consumo por Trimestre Contábil")
	
	quit
	
ReportConsumoTrimestreContabilDetalhado(pMes,pAno,pLocal,pCentroCusto,pGrupo)
	new strWhere
	
	$$$VAR 
	set YFORM = "VARConsumoProdutosTrimestreContabilCSP"
	
	if $get(YBED) '= "" {
		set usuario      = $get(YBED)
		set nomeUsuario  = $$SQLGetUserName^VARSQL(usuario)
	} else {
		set usuario      = "NOUSER"
		set nomeUsuario  = "NOUSER"
	}
	
	//Mês atual
	set dataInicialAtual = $$SQLGetPrimeiroDiaMes^VARSQL(pMes,pAno)
	set dataFinalAtual	 = $$SQLGetUltimoDiaMes^VARSQL(pMes,pAno)
	
	//Mês passado
	set dataInicialPassada 	= $$AddMonth^COMUtilDate(dataInicialAtual,-1)
	set dataFinalPassada 	= $zdateh($SYSTEM.SQL.DATEADD("dd",-1,dataInicialAtual),3)
	
	//Mês retrasado
	set dataInicialRetrasada = $$AddMonth^COMUtilDate(dataInicialPassada,-1)
	set dataFinalRetrasada	 = $zdateh($SYSTEM.SQL.DATEADD("dd",-1,dataInicialPassada),3)
	
	set formatoAtual     = $$FormatDataMesAno^VARConsumoProdutosTrimestreContabil(dataInicialAtual)
	set formatoPassado   = $$FormatDataMesAno^VARConsumoProdutosTrimestreContabil(dataInicialPassada)
	set formatoRetrasado = $$FormatDataMesAno^VARConsumoProdutosTrimestreContabil(dataInicialRetrasada)

	set strWhere = " WHERE Movimento IS NOT NULL "
	
	if (pLocal '= "") {
		set strWhere = strWhere_ " AND LocalEstoque = '"_pLocal_"' "
	}
	if (pCentroCusto '= "") {
		set strWhere = strWhere_ " AND CentroCusto = '"_pCentroCusto_"' "
	}
	if (pGrupo '= "") {
		set strWhere = strWhere_ " AND $$SQLGetGrupoPai^VARSQL($$SQLGetGrupoItem^VARSQL(Produto)) = '"_$$SQLGetGrupoPai^VARSQL(pGrupo)_"' "
	}

	set descLocal 		= $$SQLGetLocationName^VARSQL(pLocal)
	set descGrupo 		= $$SQLGetDescGrupoItem^VARSQL(pGrupo)
	set descCentroCusto	= $$SQLGetCentroCustoDesc^VARSQL(pCentroCusto)
	
	set link=$$Start^VARJasperRun("VARConsumoTrimestreContabilDetalhado")
	
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"pLocal",pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"pCentroCusto",pCentroCusto)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo",pGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descGrupo",descGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"descCentroCusto",descCentroCusto)
	set link=$$addUserParameter^VARJasperRun(link,"dataInicialAtual",dataInicialAtual)
	set link=$$addUserParameter^VARJasperRun(link,"dataFinalAtual",dataFinalAtual)
	set link=$$addUserParameter^VARJasperRun(link,"dataInicialPassada",dataInicialPassada)
	set link=$$addUserParameter^VARJasperRun(link,"dataFinalPassada",dataFinalPassada)
	set link=$$addUserParameter^VARJasperRun(link,"dataInicialRetrasada",dataInicialRetrasada)
	set link=$$addUserParameter^VARJasperRun(link,"dataFinalRetrasada",dataFinalRetrasada)
	set link=$$addUserParameter^VARJasperRun(link,"formatoAtual",formatoAtual)
	set link=$$addUserParameter^VARJasperRun(link,"formatoPassado",formatoPassado)
	set link=$$addUserParameter^VARJasperRun(link,"formatoRetrasado",formatoRetrasado)
	
	set objURL = $extract(link, $find(link,"'"), *)
	set ^zLeo($zn,"teste\")=objURL
	$$$StartScript()
		write "window.open('"_objURL_"', '_blank');"
	$$$EndScript()
	
	;do ViewInForm^VARJasperRun(link,"Relatório de Consumo por Trimestre Contábil")
	
	quit	
	
RunReportHistIntMed(pDataInicial,pDataFinal,pPaciente,pProduto,pGrupo,pUnidadeAtendimento,
					pGravidadeInteracao,pImportanciaClinica,pFormato,pFiltro)
					
	if YBED '= "" {
		set usuario      = YBED
		set nomeUsuario  = $$SQLGetUserName^VARSQL(usuario)
	} else {
		set usuario      = "NOUSER"
		set nomeUsuario  = "NOUSER"
	}
	
	if (pFormato = 1){
		set link=$$Start^VARJasperRun("VARHistIntMedPorProduto")
	}
	else {
		set link=$$Start^VARJasperRun("VARHistIntMedPorPaciente")		
	}
	
	if (pPaciente = ""){
		set flPaciente = "Todos"
	}
	else {
		set flPaciente = pPaciente_" - "_$$SQLGetPatientName^VARSQL(pPaciente)
	}
	
	if (pProduto = ""){
		set flProduto = "Todos"
	}
	else {
		set flProduto = "("_pProduto_") "_$$SQLGetDescricaoProduto^VARSQL(pProduto)
	}
	
	if (pGrupo = ""){
		set flGrupo = "Todos"
	}
	else {
		set flGrupo = pGrupo_" - "_$$SQLGetDescGrupoItem^VARSQL(pGrupo)
	}
	
	if (pUnidadeAtendimento = ""){
		set flUnidadeAtendimento = "Todas"
	}
	else {
		set flUnidadeAtendimento = pUnidadeAtendimento_" - "_$$SQLGetLocationName^VARSQL(pUnidadeAtendimento)
	}
	
	if (pGravidadeInteracao = ""){
		set flGravidade = "Todas"
	}
	else {
		set flGravidade = $$SQLGetUserParamDesc^VARSQL("MEDCLIIMP~"_pGravidadeInteracao)
	}
	
	if (pImportanciaClinica = ""){
		set flImportancia = "Todas"
	}
	else {
		set flImportancia = $$SQLGetUserParamDesc^VARSQL("MEDCLIIMP~"_pImportanciaClinica)
	}
	
	set link=$$addUserParameter^VARJasperRun(link,"pDtInicial" 			, $$SQLGetFormatDate7^VARSQL(pDataInicial))
	set link=$$addUserParameter^VARJasperRun(link,"pDtFinal"   			, $$SQLGetFormatDate7^VARSQL(pDataFinal))
	set link=$$addUserParameter^VARJasperRun(link,"pPaciente"  			, flPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"pProduto"   			, flProduto)
	set link=$$addUserParameter^VARJasperRun(link,"pGrupo"     			, flGrupo)
	set link=$$addUserParameter^VARJasperRun(link,"pUnidadeAtendimento" , flUnidadeAtendimento)
	set link=$$addUserParameter^VARJasperRun(link,"pGravidade"			, flGravidade)
	set link=$$addUserParameter^VARJasperRun(link,"pImportancia"		, flImportancia)
	set link=$$addUserParameter^VARJasperRun(link,"pFormato"			, $$SQLGetUserParamDescVAR^VARSQL("VARHISTINTMED~"_pFormato))
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro"				, pFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario"			, nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario"			, usuario)
	
	do ViewInForm^VARJasperRun(link,"Relatório de Consumo por Trimestre Contábil")
	
	quit
	
RunReportMapaMovProduto(pDataInicial,pDataFinal,pProduto,pLocal)
	;-------------------------------------------------------------------------------	
	; Histórico:
	; 2013-18-04	Thiago  Created
	;-------------------------------------------------------------------------------
	new Usuario, NomeUsuario, strWhere, srtPeriodo, descLocal
	
	set strWhere 	= ""
	set srtPeriodo 	= ""
	set descLocal 	= "Todos"
	
	if ($get(YBED) '= "") {
		set Usuario 	= $get(YBED)
		set NomeUsuario = $$SQLGetUserName^VARSQL(Usuario)
	} else {
		set Usuario 	= "NOUSER"
		set NomeUsuario = "NOUSER"
	}
	
	set strPeriodo = "De "_$zdate(pDataInicial,4)_" até "_$zdate(pDataFinal,4)
	
	if (pLocal '= ""){		
		set descLocal = pLocal_" - "_$$SQLGetLocationName^VARSQL(pLocal)
		set strWhere = strWhere_" AND LocalEstoque = '"_pLocal_"' "
	}
	
	set link=$$Start^VARJasperRun("VARMapaMovProduto")
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario",NomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"DataInicial",pDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"DataFinal",pDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"strPeriodo",strPeriodo)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere",strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"Local",pLocal)
	set link=$$addUserParameter^VARJasperRun(link,"descLocal",descLocal)
	set link=$$addUserParameter^VARJasperRun(link,"Produto",pProduto)
	
	do ViewInForm^VARJasperRun(link,"Relatório Mapa de Movimentação Mensal")

	quit
	
RunReportDesempAtendPresc(pDataInicial,pDataFinal,pUnAtendimento,pPrescUrgente,pAtendimento,pFormato,pFiltro)
					
	if YBED '= "" {
		set usuario      = YBED
		set nomeUsuario  = $$SQLGetUserName^VARSQL(usuario)
	} else {
		set usuario      = "NOUSER"
		set nomeUsuario  = "NOUSER"
	}
	
	set flUnAtendimento = "Todas"
	set flPrescUrgente  = ""
	set flAtendimento   = ""
	
	if (pUnAtendimento '= ""){
		set flUnAtendimento = pUnAtendimento_" - "_$$SQLGetLocationName^VARSQL(pUnAtendimento)
	}
	
	if (pPrescUrgente '= ""){
		if (pPrescUrgente = 1){
			set flPrescUrgente = "Sim"
		} else {
			set flPrescUrgente = "Não"
		}
	}
	
	if (pAtendimento '= ""){
		set flAtendimento = $$SQLGetUserParamDescVAR^VARSQL("VARVARDESEMPATEND~"_pAtendimento)
	}

	if (pFormato = 2){
		set link=$$Start^VARJasperRun("VARDesempAtendPrescSimpl")
	} else {
		set link=$$Start^VARJasperRun("VARDesempAtendPrescCompl")		
	}
	
	set folder = $piece($GET(^VARJasper(YM,YM,1)),Y,1)
	
	set link=$$addUserParameter^VARJasperRun(link,"pDtInicial" 			, $$SQLGetFormatDate7^VARSQL(pDataInicial))
	set link=$$addUserParameter^VARJasperRun(link,"pDtFinal"   			, $$SQLGetFormatDate7^VARSQL(pDataFinal))
	set link=$$addUserParameter^VARJasperRun(link,"pUnAtendimento"		, flUnAtendimento)
	set link=$$addUserParameter^VARJasperRun(link,"pUrgencia"  			, flPrescUrgente)
	set link=$$addUserParameter^VARJasperRun(link,"pConformidade"		, flAtendimento)
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro"				, pFiltro)
	set link=$$addUserParameter^VARJasperRun(link,"pFormato"			, $$SQLGetUserParamDescVAR^VARSQL("FORMATOCOMPRES~"_pFormato))
	set link=$$addUserParameter^VARJasperRun(link,"NomeUsuario"			, nomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"idUsuario"			, usuario)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir"			, folder)
	
	do ViewInForm^VARJasperRun(link,"Relatório de Desempenho no Atendimento às Prescrições")
	
	quit


RunReportRotuloManipuladoEtq(pOrdemProducao)

	new pFiltro
	set pFiltro = ""

	set pFiltro = pFiltro_" AND INMO.ProductionOrderNumber = '"_pOrdemProducao_"' "
	
	;Não precisa passar esses filtros abaixo pois já está validando no método PodeImprimirEtqRotulo^VARINMO 
	;set pFiltro = pFiltro_" AND INMO.Type = 2 "
	;set pFiltro = pFiltro_" AND INMO.Status in (5,6) "
	
	set link=$$Start^VARJasperRun("VARRotuloManipuladoEtq")
	set link=$$addUserParameter^VARJasperRun(link,"pFiltro",pFiltro)
	do ViewInForm^VARJasperRun(link,"Relatório - Etiqueta - Rótulo Manipulado")
	
	quit

RunReportEtiquetaMagistral(pOrdemManipulacao)
	new idItem, objOrdem
	
	set objOrdem = $GET(^VARManipulacaoMagistral(YM,pOrdemManipulacao,1))
	set idItem = $$$VARManipulacaoMagistralItem(objOrdem)
	
	set link=$$Start^VARJasperRun("VARManipulacaoMagistral")
	set link=$$addUserParameter^VARJasperRun(link,"idItem",idItem)

	do ViewInForm^VARJasperRun(link,"Relatório - Etiqueta Manipulação Magistral")
	
	quit
	
getNomeUsuario(login,YM=0)
	if ($get(login)'="") {
		quit $piece($get(^WWW013(YM,login,1)),"~",1)
	}
	quit ""		
	
RunReportMedicamentoRejeitado(pDataInicial,pDataFinal,pLocalAbastecedor,pLocalRequisitante,pPaciente,pMotivo,pFormato)

	
	new filterDataInicial, filterDataFinal, filterLocalAbastecedor, filterLocalRequisitante, filterPaciente, filterMotivo, filterFormato
	
	set filterDataInicial		= ""
	set filterDataFinal			= ""
	set filterLocalAbastecedor	= ""
	set filterLocalRequisitante	= ""
	set filterPaciente			= ""
	set filterMotivo 			= ""
	set filterFormato 			= ""
	
	set filterDataInicial = $zDate(pDataInicial, 4)
	set filterDataFinal = $zDate(pDataFinal, 4)

	if YBED'="" {
		set login=YBED
		set pNomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set pNomeUsuario="NOUSER"
	}

	set strWhere1 = ""
	set strWhere1 = strWhere1_" WHERE line.FromDate BETWEEN '"_+pDataInicial_ """ and '"_+pDataFinal_"' "
	set strWhere1 = strWhere1_" AND presc.Company = 0 "
	set strWhere1 = strWhere1_" AND %upper(disp.Company) = 0 " ; HEVA-1746
	set strWhere1 = strWhere1_" AND line.RejectNoted = 1"
	set strWhere1 = strWhere1_" And line.ValidatedStatus = ""refuse.gif"" "
	
	set strWhere2 = ""	
	set strWhere2 = strWhere2_" WHERE $piece(disp.CreatedDate,"","",1) BETWEEN '"_+pDataInicial_ """ ]]><![CDATA[and '"_+pDataFinal_"' "	
	
	set strWhere = ""
	set meuSQL = meuSQL_" SELECT DISTINCT "
	set meuSQL = meuSQL_" $$SQLGetDesCodProduto^VARSQL(line.ItemName) as Medicamento, "
	set meuSQL = meuSQL_" $$SQLGetLocationName^VARSQL(pati.Location) as Unidade, pati.Room as Quarto, pati.Bed as Leito, pati.Name as Paciente, "
	set meuSQL = meuSQL_" line.RejectReason as Motivo, presc.Notes as Observacao, presc.ChangedBy as Usuario "	
	if (pLocalAbastecedor '= ""){
		set filterLocalAbastecedor = $$SQLGetLocationName^VARSQL(pLocalAbastecedor) 
   		set strWhere = strWhere_" AND disp.SupplyingLocation = '"_pLocalAbastecedor_"' " 
   	} 
	
   	if (pLocalRequisitante '= ""){
	   	set filterLocalRequisitante = $$SQLGetLocationName^VARSQL(pLocalRequisitante)
   		set strWhere = strWhere_" AND presc.AdmissionLocation = '"_pLocalRequisitante_"' " 
   	}
	
	if (pPaciente '= ""){
		set filterPaciente = $$SQLGetPatientName^VARSQL(pPaciente)
		set strWhere = strWhere_" AND disp.Patient = '"_pPaciente_"' "

	}
	
	if (pMotivo '= "") {
		if ($Find(pMotivo,",")>0) {
			set strWhere = strWhere_ " AND line.FREE5 IN ("_pMotivo_")"
		} else {
			set strWhere = strWhere_ " AND line.FREE5 = '"_pMotivo_"' "
		}
		set filterMotivo = pMotivo		
	}
	

	if (pFormato = 2){
		set link=$$Start^VARJasperRun("VARMedicamentoRejeitadoSimpl")
	} else {
		set link=$$Start^VARJasperRun("VARMedicamentoRejeitadoCompl")		
	}
		
	set link=$$addUserParameter^VARJasperRun(link,"filterDataInicial", filterDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"filterDataFinal", filterDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"filterLocalAbastecedor", filterLocalAbastecedor)
	set link=$$addUserParameter^VARJasperRun(link,"filterLocalRequisitante", filterLocalRequisitante)
	set link=$$addUserParameter^VARJasperRun(link,"filterPaciente", filterPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"filterMotivo", filterMotivo)
	set link=$$addUserParameter^VARJasperRun(link,"filterFormato", filterFormato)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere", strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere1", strWhere1)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere2", strWhere2)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario", pNomeUsuario)

	do ViewInForm^VARJasperRun(link,"Medicamento Rejeitado na Validação de Prescrição")	
	
	quit
	
RunReportPrescricaoValidada(pDataInicial,pDataFinal,pTipoPrescricao,pUnidadeAssistencial,pUsuario)

	
	new filterDataInicial, filterDataFinal, filterTipoPrescricao, filterUnidadeAssistencial, filterUsuario
	
	set filterDataInicial		  = ""
	set filterDataFinal			  = ""
	set filterTipoPrescricao	  = ""
	set filterUnidadeAssistencial = ""
	set filterUsuario		   	  = ""
	
	set filterDataInicial = $zDate(pDataInicial, 4)
	set filterDataFinal = $zDate(pDataFinal, 4)

	if YBED'="" {
		set login=YBED
		set pNomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set pNomeUsuario="NOUSER"
	}
	
	set strWhere = ""
	set strWhere = " WHERE ValidatedStatus = ""accept.gif"" " 
	if (pTipoPrescricao = 2){
   		set strWhere = strWhere_" AND ValidatedStatus IS NULL" 
   	}
    set strWhere = strWhere_" AND $piece(ValidatedOn ,"","",1) BETWEEN '"_+pDataInicial_ """ and '"_+pDataFinal_"' "
    
    set strWhere2 = "" 
	set strWhere2 = " WHERE ModifiedBy is not null AND disp.Status = 3 "
	if (pTipoPrescricao = 1){
   		set strWhere2 = strWhere2_" AND disp.Status IS NULL " 
   	}
 	set strWhere2 = strWhere2_"AND $piece(ModifiedDate ,"","",1) BETWEEN '"_+pDataInicial_ """ and '"_+pDataFinal_"' "
 	
	if (pUnidadeAssistencial '= ""){
   		set strWhere2 = strWhere2_ " AND presc.AdmissionLocation = '"_pUnidadeAssistencial_"' "
   		set strWhere = strWhere_ " AND presc.AdmissionLocation = '"_pUnidadeAssistencial_"' "
   		set filterUnidadeAssistencial = pUnidadeAssistencial_"-"_$$SQLGetLocationName^VARSQL(pUnidadeAssistencial)
   	}
   	
   	set strWhere3 = ""
   	if (pUsuario '= "") {
	   	set strWhere3 = " Where ValidatedBy = '"_pUsuario_"' "
   	}
	
	
	if (pTipoPrescricao = 1){
   		set link=$$Start^VARJasperRun("VARPrescricaoValidada")
   	}elseif(pTipoPrescricao = 2){
   		set link=$$Start^VARJasperRun("VARPrescricaoBaixa")
   	}else{
   		set link=$$Start^VARJasperRun("VARPrescricaoValidadaBaixa")
   	}
	
	set link=$$addUserParameter^VARJasperRun(link,"filterDataInicial", filterDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"filterDataFinal", filterDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"filterTipoPrescricao", filterTipoPrescricao)
	set link=$$addUserParameter^VARJasperRun(link,"filterUnidadeAssistencial", filterUnidadeAssistencial)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario", pNomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere", strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere2", strWhere2)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere3", strWhere3)

	do ViewInForm^VARJasperRun(link,"Prescrições Validada e Baixadas por Colaborador ")	
	
	quit

RunReportDespesasMedicamento(pDataInicial,pDataFinal,pProduto,pPaciente,pLocal,pClasseTerapeutica,pPertenceElenco,pTotal)
	
	new filterDataInicial, filterDataFinal, filterProduto, filterPaciente, filterLocal, filterClasseTerapeutica, filterPertenceElenco, filterTotal
	
	set filterDataInicial		= ""
	set filterDataFinal			= ""
	set filterProduto       	= ""
	set filterPaciente			= ""
	set filterLocal         	= ""
	set filterClasseTerapeutica = ""
	set filterPertenceElenco 	= ""
	set filterTotal             = ""
	
	set filterDataInicial = $zDate(pDataInicial, 4)
	set filterDataFinal   = $zDate(pDataFinal, 4)
	set filterTotal       = pTotal
	
	if YBED'="" {
		set login=YBED
		set pNomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set pNomeUsuario="NOUSER"
	}
	
	set strWhere = ""
	set strWhere = strWhere_ " WHERE $piece(disp.DateProcessed ,"","",1) BETWEEN '"_+pDataInicial_ """ and '"_+pDataFinal_"' "
	set strWhere = strWhere_ " AND disp.DateProcessed is not null"

     
  	if (pPaciente '= "") {
	    set strWhere = strWhere_ " AND disp.Patient = '"_pPaciente_"' "
	    set filterPaciente = pPaciente_"-"_$$SQLGetPatientName^VARSQL(pPaciente)
   	}
   
  	if (pProduto '= "") {
	   	set strWhere = strWhere_ " AND line.ItemName = '"_pProduto_"' "
	   	set filterProduto = pProduto_"-"_$$SQLGetDesCodProduto^VARSQL(pProduto)
   	}
   
    if (pLocal '= ""){
   		set strWhere = strWhere_ " AND DestinationLocation = '"_pLocal_"' " 
   		set filterLocal = pLocal_"-"_$$SQLGetLocationName^VARSQL(pLocal)
   	} 
   	
   	if (pClasseTerapeutica '= ""){
   		set strWhere = strWhere_ " AND inart.FREE6 = '"_pClasseTerapeutica_"' " 
   		set filterClasseTerapeutica = pClasseTerapeutica_"-"_$$SQLGetDescClasseTerapeutica^VARSQL(pClasseTerapeutica)
   	}
   	
   	if (pPertenceElenco '= ""){
   		set strWhere = strWhere_ " AND inart.FREE5 = '"_pPertenceElenco_"' "
   		if (pPertenceElenco = 1){
   			set filterPertenceElenco = "Sim"
   		}
   		elseif(pPertenceElenco = 0){
	   		set filterPertenceElenco = "Não"
   		}	
   		
   	} 
	

	set link=$$Start^VARJasperRun("VARDespesasMedicamento")
	
	set link=$$addUserParameter^VARJasperRun(link,"filterDataInicial", filterDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"filterDataFinal", filterDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"filterProduto", filterProduto)
	set link=$$addUserParameter^VARJasperRun(link,"filterPaciente", filterPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"filterLocal", filterLocal)
	set link=$$addUserParameter^VARJasperRun(link,"filterClasseTerapeutica", filterClasseTerapeutica)
	set link=$$addUserParameter^VARJasperRun(link,"filterPertenceElenco", filterPertenceElenco)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere", strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario", pNomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"filterTotal", filterTotal)

	do ViewInForm^VARJasperRun(link,"Relatório de Despesas")	
	
	quit
		
RunReportAtendimentoPrescricoes(pAno,pLocal,pElenco)
	
	new filterAno, filterLocal, filterElenco, filterLogin
	
	set filterAno	 = ""
	set filterLocal  = ""
	set filterElenco = ""
	set filterLogin = ""
	
	set filterLogin = YBED
	set filterAno = pAno
		
	if (pLocal '= ""){
   		set filterLocal = pLocal_"-"_$$SQLGetLocationName^VARSQL(pLocal)
	}
	
	if (pElenco = 1){
		set filterElenco = "Sim"
	}
    if (pElenco = 0){
		set filterElenco = "Não"
	}
	
	if YBED'="" {
		set login=YBED
		set pNomeUsuario=$$SQLGetUserName^VARSQL(login)
		
	} else { 
		set login="NOUSER"
		set pNomeUsuario="NOUSER"
	}
	set folder=$piece($GET(^VARJasper(YM,YM,1)),Y,1)
	
	set link=$$Start^VARJasperRun("VARAtendimentoPrescricoes")
	
	set link=$$addUserParameter^VARJasperRun(link,"filterLogin", filterLogin)
	set link=$$addUserParameter^VARJasperRun(link,"filterAno", filterAno)
	set link=$$addUserParameter^VARJasperRun(link,"filterLocal", filterLocal)
	set link=$$addUserParameter^VARJasperRun(link,"filterElenco", filterElenco)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario", pNomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir", folder)

	do ViewInForm^VARJasperRun(link,"Performance de Atendimento às Prescrições")	
	
	quit
	
RunReportPerfilPaciente(pDataInicial,pDataFinal,pTipoRelatorio)
	; Report utilizado no Form "VARPerfilPaciente"
	new strWhere, rTipoRelatorio
	set filterDataInicial	= ""
	set filterDataFinal		= ""
	
	if YBED'="" 
	{
		set login=YBED
		set pNomeUsuario=$$SQLGetUserName^VARSQL(login)
	} 
	else 
	{ 
		set login="NOUSER"
		set pNomeUsuario="NOUSER"
	}
	
	set filterDataInicial = $zDate(pDataInicial, 4)
	set filterDataFinal = $zDate(pDataFinal, 4)
	
	set strWhere = "WHERE ($piece(Report.VARPerfilPaciente.DataCadastro,"","") between "_pDataInicial_" AND "_pDataFinal_") "
	
	if (pTipoRelatorio = 1){
		set rTipoRelatorio = "Agrupado por sexo e intervalo de idade em porcentagem"
	}
	else{
		set rTipoRelatorio = "Agrupado por sexo e intervalo de idade em absoluto"
	}
	
	set folder=$piece($GET(^VARJasper(YM,YM,1)),Y,1)
	
	set link=$$Start^VARJasperRun("VARPerfilPaciente")
	set link=$$addUserParameter^VARJasperRun(link,"filterDataInicial", filterDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"filterDataFinal", filterDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"pDataInicial", pDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"pDataFinal", pDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario", pNomeUsuario)
	set link=$$addUserParameter^VARJasperRun(link,"pTipoRelatorio", pTipoRelatorio)
	set link=$$addUserParameter^VARJasperRun(link,"rTipoRelatorio", rTipoRelatorio)
	set link=$$addUserParameter^VARJasperRun(link,"login", login)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere", strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"CompiledDir", folder)
	do ViewInForm^VARJasperRun(link,"Perfil de Paciente Cadastrado")
	
	quit
	
RunReportProducaoOU(pDataInicial,pDataFinal,pProduto,pPaciente,pUnidadeAtendimento,pFormaFarmaceutica,pTipoVisao,pTipoExibicao)
	
	new filterDataInicial, filterDataFinal, filterProduto, filterPaciente, filterunidadeAtendimento, filterFormaFarmaceutica, filterTipoVisao, PTipoExibicao
	
	set filterDataInicial		 = ""
	set filterDataFinal			 = ""
	set filterProduto	         = ""
	set filterPaciente	         = ""
	set filterUnidadeAtendimento = ""
	set filterFormaFarmaceutica  = ""
	set filterTipoVisao 		 = pTipoVisao
	set filterTipoExibicao 	     = ""

	
	set filterDataInicial = $zDate(pDataInicial, 4)
	set filterDataFinal = $zDate(pDataFinal, 4)
	set strWhere = " "
	set strWhere = " and $piece(disp.CreatedDate ,"","",1) BETWEEN '"_+pDataInicial_ """ and '"_+pDataFinal_"' " 
	set strWhere2 = " " 
	set strWhere2 = "and $piece(disp.CreatedDate ,"","",1) BETWEEN '"_+pDataInicial_ """ and '"_+pDataFinal_"' "
	
	if YBED'="" {
		set login=YBED
		set pNomeUsuario=$$getNomeUsuario(login)
	} else { 
		set login="NOUSER"
		set pNomeUsuario="NOUSER"
	}
	
	if (pProduto '= ""){
		set filterProduto = pProduto
   		set strWhere = strWhere = " AND $$SQLGetDesCodProduto^VARSQL(pick.Item) = '"_pProduto_"' "
   		set strWhere2 = strWhere2 = " AND $$SQLGetDesCodProduto^VARSQL(pick.Item) = '"_pProduto_"' "  
   	}
   	if (pPaciente '= ""){
	   	set filterPaciente = $$GetPatientName^VARSQL(pPaciente)
   		set strWhere = strWhere_ " AND disp.Patient = '"_pPaciente_"' " 
   		set strWhere2 = strWhere2_ " AND disp.Patient = '"_pPaciente_"' "    		
   	}
   	if (pUnidadeAtendimento '= ""){
	   	set filterUnidadeAtendimento = $$SQLGetLocationName^VARSQL(pUnidadeAtendimento)
   		set strWhere = strWhere_ " AND disp.DestinationLocation = '"_pUnidadeAtendimento_"' "
   		set strWhere2 = strWhere2_ " AND disp.DestinationLocation = '"_pUnidadeAtendimento_"' "
   	}
   	if (pFormaFarmaceutica '= ""){
	   	if (pFormaFarmaceutica = 1){set filterFormaFarmaceutica = "1" set filterFormaFarmaceuticastr = "1-Líquido"}
	    if (pFormaFarmaceutica = 2){set filterFormaFarmaceutica = "2" set filterFormaFarmaceuticastr = "1-Pulverizado" }
	    
   		set strWhere = strWhere_ " AND inmo.Manipulation = '"_pFormaFarmaceutica_"' " 
   		set strWhere2 = strWhere2_ " AND inmo.Manipulation = '"_pFormaFarmaceutica_"' " 

   	}
   	if (pFormaFarmaceutica = ""){
	   set filterFormaFarmaceutica = "3"
	    set filterFormaFarmaceuticastr = ""	
   	}
   	
   	if (pTipoExibicao '= ""){
	   	if (pTipoExibicao = 2 ){
		   	set filterTipoExibicao = pTipoExibicao
   			set strWhere = strWhere_ " AND $$SQLGetMedicamentoControlado^VARSQL(pick.Item) is not null " 
   			set strWhere2 = strWhere2_ " AND $$SQLGetMedicamentoControlado^VARSQL(pick.Item) is not null " 

	   	}
	    if (pTipoExibicao = 3 ){
		    set filterTipoExibicao = pTipoExibicao
   			set strWhere = strWhere_ " AND $$SQLGetMedicamentoControlado^VARSQL(pick.Item) is null " 
   			set strWhere2 = strWhere2_ " AND $$SQLGetMedicamentoControlado^VARSQL(pick.Item) is null " 
	   	}
   	}
	
	if (filterTipoVisao = 2){
		set filterTipoVisao = "2 - Simplificado"
		set link=$$Start^VARJasperRun("VARProducaoOUSimplificado")
	}
	else {
		set filterTipoVisao = "1 - Completo"
		set link=$$Start^VARJasperRun("VARproducaoOUCompleto")		
		
	}	
	
	set link=$$addUserParameter^VARJasperRun(link,"filterDataInicial", filterDataInicial)
	set link=$$addUserParameter^VARJasperRun(link,"filterDataFinal", filterDataFinal)
	set link=$$addUserParameter^VARJasperRun(link,"filterProduto", filterProduto)
	set link=$$addUserParameter^VARJasperRun(link,"filterPaciente", filterPaciente)
	set link=$$addUserParameter^VARJasperRun(link,"filterUnidadeAtendimento", filterUnidadeAtendimento)
	set link=$$addUserParameter^VARJasperRun(link,"filterFormaFarmaceutica", filterFormaFarmaceutica)
	set link=$$addUserParameter^VARJasperRun(link,"filterFormaFarmaceuticastr", filterFormaFarmaceuticastr)	
	set link=$$addUserParameter^VARJasperRun(link,"filterTipoVisao", filterTipoVisao)
	set link=$$addUserParameter^VARJasperRun(link,"filterTipoExibicao", filterTipoExibicao)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere", strWhere)
	set link=$$addUserParameter^VARJasperRun(link,"strWhere2", strWhere2)
	set link=$$addUserParameter^VARJasperRun(link,"pNomeUsuario", pNomeUsuario)

	do ViewInForm^VARJasperRun(link,"Produção O.U")	
	
	quit]]></Routine>
</Export>