<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWLIST" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWLIST ;WWWLIST;DT;LISTGENERATORSELEKTION ;15.09.1997:GEAENDERT=57881,72575
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		LISTGENERATORSELEKTION 
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| 30-May-2005		RobertW		SR12056: Attempt at Performance Increase
	;| DT	15.09.1997:GEAENDERT=57881,72575
	;|
	;\------------------------------------------------------------------/
	;
	KILL ^WWWSOR(YUSER,1)
	KILL ^WWWSOR(YUSER,2)
	NEW YLF,YLFN,YA,YI,YDATEI,YMAXKEY,YFKEY,YSA,YRI,YAA,Q
	SET YA(9)=0
	SET YLFN1=0
	SET YLFN=$ORDER(^WWW131(0,YFORM,""))
	IF YLFN'="" DO SELEKTIO IF $PIECE(YLF(YLFN),Y,8)=0 SET YLFN=$ORDER(^WWW131(0,YFORM,YLFN)) IF YLFN'="" DO SELEKTIO IF $PIECE(YLF(YLFN),Y,8)=0 SET YLFN=$ORDER(^WWW131(0,YFORM,YLFN)) IF YLFN'="" DO SELEKTIO IF $PIECE(YLF(YLFN),Y,8)=0 SET YLFN=$ORDER(^WWW131(0,YFORM,YLFN)) IF YLFN'="" DO SELEKTIO
	QUIT
	
SELEKTIO ;START AUFBEREITUNG DATEN ,EINSPRUNG
	;tybd;23568;6.5.2003
	SET YAA="" FOR  SET YAA=$ORDER(YLD1(1,YAA)) QUIT:YAA=""  DO
	. IF +YLD1(1,YAA)=0 IF YLD1(1,YAA)'=0 IF $LENGTH(YLD1(1,YAA))>0 DO  ;IF $GET(YLD(1,YAA))=YLD1(1,YAA) DO
	. . SET YLD1(1,YAA)=YLD1(1,YAA)_$CHAR(255)  ;WACH;18.3.2003 ;open-eyed 
	. . QUIT
	. QUIT
	IF '$DATA(YLFN(YLFN1)) SET YLFN(YLFN1)="0"
	SET YLF(YLFN)=$GET(^WWW131(0,YFORM,YLFN,1))  ;DATEISATZ
	SET YDATEI(YLFN)=$PIECE(YLF(YLFN),Y,1)  ;DATEI, DIE GEDRUCKT WIRD
	SET YRI(YLFN)=$GET(YLR(YLFN))  ;LAUFRICHTUNG AUS VORGABE ;out of default 
	IF YRI(YLFN)=1 SET YRI(YLFN)="-1"
	IF YRI(YLFN)'="-1" SET YRI(YLFN)="1"
	SET YS(YLFN)=$GET(YS(YLFN))    ;SORTKEY AUS VORGABE ;out of default 
	QUIT:YDATEI(YLFN)=""
	;VORGABEN DER DATEIEN ;the 
	SET YDATA(YLFN)=$GET(^WWW001(0,YDATEI(YLFN),1))
	SET YFILE(YLFN)=YDATEI(YLFN)
	IF $PIECE(YDATA(YLFN),Y,22)'="" SET YFILE(YLFN)=$PIECE(YDATA(YLFN),Y,22)  ;ANDERE DATEI ;data file 
	SET YFILES(YLFN)=YDATEI(YLFN)_"s"
	IF $PIECE(YDATA(YLFN),Y,23)'="" SET YFILES(YLFN)=$PIECE(YDATA(YLFN),Y,23)  ;ANDERE SORTDATEI
	SET YSORTNAME(YLFN)=""
	IF +YS(YLFN)>0 DO
	. SET YSORTNAME(YLFN)=$PIECE($GET(^WWW0013(0,YDATEI(YLFN),+YS(YLFN),1)),Y,1)
	. IF YSORTNAME(YLFN)="" DO
	. . IF $PIECE(YDATA(YLFN),Y,8)=4 SET YSORTNAME(YLFN)="Index"_+YS(YLFN)
	. . IF $PIECE(YDATA(YLFN),Y,8)'=4 SET YSORTNAME(YLFN)=+YS(YLFN)
	. . QUIT
	. QUIT
	;KEYS ZUSAMMENBAUEN
	SET YMAXKEY(YLFN)=+$ORDER(^WWW002(0,YDATEI(YLFN),""),-1)  ;MAXIMALE KEY
	IF YMAXKEY(YLFN)=0 SET YMAXKEY(YLFN)=1
	SET YDATEI1(YLFN)=YDATEI(YLFN)  ;PRUEFEN DATEI ;data file 
	SET YA2(YLFN)=""  ;SORTKEYSUCHVORGABE
	SET YS(YLFN)=$GET(YS(YLFN))    ;SORTKEY
	SET YA(YLFN)="^"_YFILE(YLFN)_"("_$$^WWWYM(YDATEI(YLFN),0)  ;LAUFVARIABLE
	SET YA3(YLFN)=YA(YLFN)  ;VERVOLLSTÄNDIGUNGSVARIABLE
	;SORTKEY ZUSAMMENBAUEN
	IF +YS(YLFN)'=0 DO 
	. SET YA2(YLFN)="^"_YFILES(YLFN)_"("_$$^WWWYM(YDATEI(YLFN),1)  ;LAUFVARIABLE NACH SORTIERUNG ;within sorting 
	. SET YA2(YLFN)=YA2(YLFN)_""""_YSORTNAME(YLFN)_""""
	. QUIT
	;FESTE VORGABEN EINSETZEN ;stow 
	SET YAUSWAHL="" IF YRI(YLFN)="-1" SET YAUSWAHL=$CHAR(255)
	SET YFKEY(YLFN)=""
	IF YRI(YLFN)'="-1" DO  ;IF $DATA(YA(YLFN(YLFN1))) DO   ;FIXKEY'S FUER UNTERDATEIEN
	. NEW YQ,YLLF,YFIX,YPR
	. SET YQ=0
	. FOR YLLF=1:1 QUIT:'$DATA(^WWW132(0,YFORM,YLFN,YLLF))  DO  QUIT:YQ=1   ;FIX SCHLUESSEL UND VORGABEN ;skillful And 
	. . SET YFIX=$PIECE($GET(^WWW132(0,YFORM,YLFN,YLLF,1)),Y,2)
	. . IF YFIX="" IF YLLF=1 IF $PIECE($GET(^WWW132(0,YFORM,YLFN,YLLF,1)),Y,1)=1 DO 
	. . . SET YPR=$GET(YLP(YLFN,$EXTRACT(100+1,2,3)))
	. . . IF YPR'="" SET YAUSWAHL=$TRANSLATE(YPR,"""") IF YRI(YLFN)="-1" SET YAUSWAHL=YAUSWAHL_","_$CHAR(255)
	. . . QUIT
	. . IF YFIX="" SET YQ=1 QUIT
	. . IF $TRANSLATE($PIECE(YA(YLFN(YLFN1)),",",YFIX+1),"""")'="" SET YFKEY(YLFN)=YFKEY(YLFN)_""""_$TRANSLATE($PIECE(YA(YLFN(YLFN1)),",",YFIX+1),"""")_""""_","
	. . IF $TRANSLATE($PIECE(YA(YLFN(YLFN1)),",",YFIX+1),"""")="" SET YFKEY(YLFN)=YFKEY(YLFN)_""""_$CHAR(255)_""""_","
	. . QUIT
	. QUIT
	;VORGABEN AUS VORHERIGEN DATEIEN ;out of 
	SET YI=2
	IF YFKEY(YLFN)'="" FOR YI=1:1:YMAXKEY(YLFN) QUIT:$PIECE(YFKEY(YLFN),",",YI)=""  DO
	. IF $EXTRACT(YA(YLFN),$LENGTH(YA(YLFN)))'="(" SET YA(YLFN)=YA(YLFN)_","
	. SET YA(YLFN)=YA(YLFN)_""""_$TRANSLATE($PIECE(YFKEY(YLFN),",",YI),"""")_""""
	. QUIT
	SET YI=YI-1
	;VORAUSWAHL DER EINGABE ;the 
	IF YAUSWAHL'="" FOR YI=YI:1:YMAXKEY(YLFN) QUIT:$PIECE(YAUSWAHL,",",YI)=""  DO
	. IF $EXTRACT(YA(YLFN),$LENGTH(YA(YLFN)))'="(" SET YA(YLFN)=YA(YLFN)_","
	. SET YA(YLFN)=YA(YLFN)_""""_$TRANSLATE($PIECE(YAUSWAHL,",",YI),"""")_""""
	. I YRI(YLFN)=-1 IF +YS(YLFN)'=0 DO  ;BEI SORTKEYS? ;next to 
	. . IF $EXTRACT(YA2(YLFN),$LENGTH(YA2(YLFN)))'="(" SET YA2(YLFN)=YA2(YLFN)_","
	. . SET YA2(YLFN)=YA2(YLFN)_""""_$$^WWWUMLAU($TRANSLATE($PIECE(YAUSWAHL,",",YI),1),"""")_""""
	. . QUIT
	. QUIT
	;UNTERSCHIEDLICHE SPEICHERART
	SET YA1(YLFN)="^"_YFILE(YLFN)_"("_$$^WWWYM(YDATEI(YLFN),1)_YFKEY(YLFN)
	IF $PIECE(YDATA(YLFN),Y,8)>0 DO 
	. SET YA1(YLFN)="^"_YFILE(YLFN)_"("
	. SET YA1(YLFN)=YA1(YLFN)_$PIECE($TRANSLATE($GET(^WWW002(0,YDATEI(YLFN),1,1)),"'",""""),Y,11)
	. QUIT:YFKEY(YLFN)=""
	. IF $EXTRACT(YA1(YLFN),$LENGTH(YA(YLFN)))'="(" SET YA=YA_","
	. SET YA1(YLFN)=YA1(YLFN)_YFKEY(YLFN)
	. QUIT
	IF +$PIECE(YDATA(YLFN),Y,8)=0 DO 
	. IF YFKEY(YLFN)'="" IF $EXTRACT(YA1(YLFN),$LENGTH(YA1(YLFN)))'="," SET YA1(YLFN)=YA1(YLFN)_","
	. QUIT
	;PRUEFVORGABE DES KEY
	SET YA11(YLFN)="^"_YFILES(YLFN)_"("_$$^WWWYM(YDATEI(YLFN),1) DO
	. SET YA11(YLFN)=YA11(YLFN)_""""_YSORTNAME(YLFN)_""""
	. QUIT
	IF $EXTRACT(YA(YLFN),$LENGTH(YA(YLFN)))="(" SET YA(YLFN)=YA(YLFN)_"-1"
	IF $EXTRACT(YA(YLFN),$LENGTH(YA(YLFN)))="," SET YA(YLFN)=YA(YLFN)_"-1"
	SET YA(YLFN)=YA(YLFN)_")"
	SET YA2(YLFN)=YA2(YLFN)_")"
	IF YAUSWAHL=$CHAR(255) SET YAUSWAHL=""
	;ANDERES SYSTEM? MSM
	IF $PIECE(YDATA(YLFN),Y,12)'="" IF $PIECE(YDATA(YLFN),Y,13)'="" DO  ;UCI UND VOL ;UCI And 
	. SET YA(YLFN)="^["_""""_$PIECE(YDATA(YLFN),Y,12)_""""_","_""""_$PIECE(YDATA(YLFN),Y,13)_""""_"]"_$PIECE(YA(YLFN),"^",2,999)
	. SET YA2(YLFN)="^["_""""_$PIECE(YDATA(YLFN),Y,12)_""""_","_""""_$PIECE(YDATA(YLFN),Y,13)_""""_"]"_$PIECE(YA2(YLFN),"^",2,999)
	. QUIT
	;FALSCHER AUFBAU? PRUEFEN
	IF $FIND(YA(YLFN),"(,") SET YA(YLFN)=$PIECE(YA(YLFN),"(,",1)_"("_$PIECE(YA(YLFN),"(,",2,99)
	IF $FIND(YA(YLFN),",)") SET YA(YLFN)=$PIECE(YA(YLFN),",)",1)_")"
	IF $FIND(YA2(YLFN),"(,") SET YA2(YLFN)=$PIECE(YA2(YLFN),"(,",1)_"("_$PIECE(YA2(YLFN),"(,",2,99)
	IF $FIND(YA2(YLFN),",)") SET YA2(YLFN)=$PIECE(YA2(YLFN),",)",1)_")"
	;DURCH DATEI LAUFEN ;trans- data file walk 
	;W YA(1)," ",YA2(1)
	FOR  DO  QUIT:YA(YLFN)=""
	. ;
	. ;OHNE SORT ;without 
	. IF +YS(YLFN)=0 DO  ;NEXT DATENSATZ OHNE SORT ;data record without 
	. . SET YA(9)=YA(9)+1
	. . SET YA2(YLFN)=" "
	. . ;IF YA(9)=1 IF $PIECE(YDATA(YLFN),Y,8)=4 IF $DATA(@(YA(YLFN)))#10=1 IF $FIND($$^WWWUPER($TRANSLATE(YA(YLFN),"""")),$$^WWWUPER($TRANSLATE(YA1(YLFN),""""))) QUIT  ;ERSTER DATENSATZ CACHÉ ;premier data record 
	. . IF YA(9)=1 IF $PIECE(YDATA(YLFN),Y,8)=4 IF $DATA(@(YA(YLFN)))#10=1 IF $FIND($zconvert($TRANSLATE(YA(YLFN),""""),"U"),$zconvert($TRANSLATE(YA1(YLFN),""""),"U")) QUIT  ;ERSTER DATENSATZ CACHÉ ;premier data record 
	. . SET YA(YLFN)=$QUERY(@YA(YLFN),YRI(YLFN))
	. . ;W YCR,"$Q: ",YA(YLFN)," CHECK:",YA1(YLFN),"<BR>"  ;FÜR TESTS
	. . ;IF '$FIND($$^WWWUPER($TRANSLATE(YA(YLFN),"""")),$$^WWWUPER($TRANSLATE(YA1(YLFN),""""))) SET YA(YLFN)=""
	. . IF '$FIND($zconvert($TRANSLATE(YA(YLFN),""""),"U"),$zconvert($TRANSLATE(YA1(YLFN),""""),"U")) SET YA(YLFN)=""
	. . QUIT
	. ;
	. ;MIT SORT ;by means of 
	. IF +YS(YLFN)'=0 DO  ;NEXT DATENSATZ MIT SORT ;data record by means of 
	. . SET YA(9)=YA(9)+1
	. . ;W YCR,YA2(YLFN)," / ",YA11(YLFN),"<BR>"  ;NUR FÜR TESTANZEIGE
	. . SET YA2(YLFN)=$QUERY(@YA2(YLFN),YRI(YLFN))
	. . IF '$FIND($TRANSLATE(YA2(YLFN),""""),$TRANSLATE(YA11(YLFN),"""")) SET YA(YLFN)="" QUIT
	. . IF YA2(YLFN)="" SET YA(YLFN)="" QUIT
	. . SET YMAXSKEY(YLFN)=$LENGTH(YA2(YLFN),",")
	. . SET YPR=$PIECE(YA2(YLFN),")",1)
	. . SET YA(YLFN)=YA3(YLFN)
	. . FOR YI=(YMAXSKEY(YLFN)-YMAXKEY(YLFN)+1):1:YMAXSKEY(YLFN) SET YA(YLFN)=YA(YLFN)_","_$PIECE(YPR,",",YI)
	. . SET YA(YLFN)=YA(YLFN)_")"
	. . IF $FIND(YA(YLFN),"(,") SET YA(YLFN)=$PIECE(YA(YLFN),"(,",1)_"("_$PIECE(YA(YLFN),"(,",2,99)
	. . IF $FIND(YA(YLFN),",)") SET YA(YLFN)=$PIECE(YA(YLFN),",)",1)_")"
	. . IF $PIECE(YDATA(YLFN),Y,8)'=4 SET YA(YLFN)=$QUERY(@YA(YLFN))
	. . ;W YA(YLFN),"<BR>"    ;TEST
	. . ;I '$F($TR(YA(YLFN),""""),$TR(YA1(YLFN),"""")) S YA(YLFN)=""
	. . QUIT
	. ;
	. ;AUFBAU DER PRIMÄRSCHLUESSEL ;the 
	. QUIT:YA(YLFN)=""
	. QUIT:YA2(YLFN)=""
	. IF YFILE(YLFN)=YDATEI(YLFN) QUIT:YDATEI(YLFN)'=$PIECE($PIECE(YA(YLFN),"^",2),"(",1)
	. SET YKEY=$TRANSLATE($PIECE($PIECE(YA(YLFN),",",2,99),",1)",1),"""")
	. IF YKEY="" SET YKEY=$TRANSLATE($PIECE($PIECE(YA(YLFN),"(",2),")",1),"""")
	. QUIT:YKEY=""
	. QUIT:$FIND(YKEY,")")
	. ;
	. ;PRUEFUNG DES DATENSATZES
	. SET YSA=YA(YLFN)
	. SET Q=0
	. DO PRUEF
	. QUIT:Q=1  ;NICHT DRUCKEN ;Not print 
	. ;
	. SET ^WWWSOR(YUSER,1,YA(9),YKEY)=YSA    ;YA(YLFN)
	. SET ^WWWSOR(YUSER,2,YA(9))=YLFN
	. IF $PIECE(YLF(YLFN),Y,8)=1 DO
	. . IF $ORDER(^WWW131(0,YFORM,YLFN))'="" SET YLFN1=$ORDER(^WWW131(0,YFORM,YLFN)) IF YLFN1'="" DO
	. . . SET YLFN(YLFN1)=YLFN
	. . . SET YLFN=YLFN1
	. . . ;
	. . . ;GGF NEUE UNTERDATEI AUFRUFEN
	. . . DO SELEKTIO
	. . . IF $PIECE(YLF(YLFN),Y,8)=0 IF $ORDER(^WWW131(0,YFORM,YLFN))'="" SET YLFN1=$ORDER(^WWW131(0,YFORM,YLFN)) IF YLFN1'="" SET YLFN(YLFN1)=YLFN SET YLFN=YLFN1 DO SELEKTIO SET YLFN=YLFN(YLFN1)
	. . . SET YLFN=YLFN(YLFN1)
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
	
PRUEF ;PRUEFEN OB DER DATENSATZ GEDRUCKT WERDEN SOLL ;whether the data record will 
	;     YKEY=KEY
	;     YA(YLFN)=KEY MIT DATEI ;by means of data file 
	NEW YNUM,YSEL,YPR,A,YPFELD,YFELD,YCOMB,YPR1,YQ
	;PRUEFEN DES SCHLUESSELS
	SET YNUM=""
	FOR  SET YNUM=$ORDER(^WWW132(0,YFORM,YLFN,YNUM)) QUIT:YNUM=""  DO  QUIT:Q=1
	. SET YSEL=$GET(^WWW132(0,YFORM,YLFN,YNUM,1))
	. SET YPFELD=$PIECE(YSEL,Y,1)
	. SET YQ=0
	. IF $PIECE(YSEL,Y,20)'="" DO  IF YQ=1 SET Q=1 QUIT   ;Execute vor Selektion  ;FAN;15.05.2003;23583
	. . N YINHALT
	. . SET YINHALT=$PIECE(YKEY,",",YPFELD)
	. . XECUTE $PIECE(YSEL,Y,20)
	. . ;YINHALT=DATENFELD
	. . ;YFELD=DATENSATZ
	. . ;YQ ODER Q=1 DANN ABBRUCH = KEIN DRUCK ;Or discontinuation no printing 
	. . QUIT
	. IF $PIECE(YSEL,Y,15)'="" DO
	. . ;IF '$FIND($$^WWWUPER($PIECE(YKEY,",",YPFELD)),$$^WWWUPER($PIECE(YSEL,Y,15))) SET Q=1 QUIT
	. . IF '$FIND($zconvert($PIECE(YKEY,",",YPFELD),"U"),$zconvert($PIECE(YSEL,Y,15),"U")) SET Q=1 QUIT
	. . QUIT
	. ;IF $PIECE(YSEL,Y,13)'="" DO
	. . SET YPR=$PIECE(YSEL,Y,13)
	. . ;IF YPR'="" IF $$^WWWUPER(YPR)]]$$^WWWUPER($PIECE(YKEY,",",YPFELD)) SET Q=1 QUIT
	. . IF YPR'="" IF $zconvert(YPR,"U")]]$zconvert($PIECE(YKEY,",",YPFELD),"U") SET Q=1 QUIT
	. . QUIT
	. ;IF $PIECE(YSEL,Y,14)'="" DO
	. . SET YPR=$PIECE(YSEL,Y,14)
	. . ;IF YPR'="" IF $$^WWWUPER($PIECE(YKEY,",",YPFELD))]]$$^WWWUPER(YPR) SET Q=1 QUIT
	. . IF YPR'="" IF $zconvert($PIECE(YKEY,",",YPFELD),"U")]]$zconvert(YPR,"U") SET Q=1 QUIT
	. . QUIT
	. QUIT:$PIECE(YSEL,Y,3)=""
	. IF $PIECE(YSEL,Y,3)=1 DO  QUIT  ;SELEKTION
	. . SET YPR=$GET(YLP(YLFN,$EXTRACT(100+YPFELD,2,3)))
	. . ;I YBED="TYBD" WRITE "<BR>" WRITE "KEY:"_YKEY," PRUEF:",YPR," FELD:",YPFELD
	. . IF YRI(YLFN)'=-1 DO  QUIT:Q=1
	. . . ;IF YPR'="" IF $$^WWWUPER(YPR)]]$$^WWWUPER($PIECE(YKEY,",",YPFELD)) SET Q=1 QUIT
	. . . IF YPR'="" IF $zconvert(YPR,"U")]]$zconvert($PIECE(YKEY,",",YPFELD),"U") SET Q=1 QUIT
	. . . IF YPR'="" IF $PIECE(YKEY,",",YPFELD)="" SET Q=1 QUIT
	. . . SET YPR=$GET(YLP1(YLFN,$EXTRACT(100+YPFELD,2,3)))
	. . . ;IF YPR'="" IF $$^WWWUPER($PIECE(YKEY,",",YPFELD))]]$$^WWWUPER(YPR) SET Q=1 IF YNUM=1 SET YA(YLFN)="" QUIT
	. . . IF YPR'="" IF $zconvert($PIECE(YKEY,",",YPFELD),"U")]]$zconvert(YPR,"U") SET Q=1 IF YNUM=1 SET YA(YLFN)="" QUIT
	. . . QUIT
	. . IF YRI(YLFN)=-1 DO  QUIT:Q=1
	. . . ;IF YPR'="" IF $$^WWWUPER($PIECE(YKEY,",",YPFELD))]]$$^WWWUPER(YPR) SET Q=1 QUIT
	. . . IF YPR'="" IF $zconvert($PIECE(YKEY,",",YPFELD),"U")]]$zconvert(YPR,"U") SET Q=1 QUIT
	. . . IF YPR'="" IF $PIECE(YKEY,",",YPFELD)="" SET Q=1 QUIT
	. . . SET YPR=$GET(YLP1(YLFN,$EXTRACT(100+YPFELD,2,3)))
	. . . ;IF YPR'="" IF $$^WWWUPER(YPR)]]$$^WWWUPER($PIECE(YKEY,",",YPFELD)) SET Q=1 IF YNUM=1 SET YA(YLFN)="" QUIT
	. . . IF YPR'="" IF $zconvert(YPR,"U")]]$zconvert($PIECE(YKEY,",",YPFELD),"U") SET Q=1 IF YNUM=1 SET YA(YLFN)="" QUIT
	. . . QUIT
	. . QUIT
	. IF $PIECE(YSEL,Y,3)=2 DO  QUIT  ;GENAU 1 ;truly 
	. . SET YPR=$GET(YLP(YLFN,$EXTRACT(100+YPFELD,2,3)))
	. . QUIT:YPR=""
	. . ;IF $$^WWWUPER($PIECE(YKEY,",",YPFELD))'=$$^WWWUPER(YPR) SET Q=1 QUIT
	. . IF $zconvert($PIECE(YKEY,",",YPFELD),"U")'=$zconvert(YPR,"U") SET Q=1 QUIT
	. . QUIT
	. IF $PIECE(YSEL,Y,3)=3 DO  QUIT  ;KOMBINATION
	. . SET YPR=$GET(YLP(YLFN,$EXTRACT(100+YPFELD,2,3)))
	. . QUIT:YPR=""
	. . SET Q=0
	. . ;IF '$FIND(","_$TR($$^WWWUPER(YPR),";",",")_",",","_$$^WWWUPER($PIECE(YKEY,",",YPFELD)_",")) SET Q=1 QUIT
	. . IF '$FIND(","_$TR($zconvert(YPR,"U"),";",",")_",",","_$zconvert($PIECE(YKEY,",",YPFELD)_",","U")) SET Q=1 QUIT
	. . QUIT
	. QUIT
	QUIT:Q=1
	;PRUEFEN DES DATENSATZES
	SET YSA=YA(YLFN)
	IF $PIECE(YDATA(YLFN),Y,22)'="" SET YSA="^"_YDATEI(YLFN)_"("_$PIECE(YSA,"(",2,99)   ;DT
	SET YFELD=$$^WWWSETL(YSA)
	;SET YFELD=$$^WWWSETL(YA(YLFN))
	SET YNUM=""
	FOR  SET YNUM=$ORDER(^WWW133(0,YFORM,YLFN,YNUM)) QUIT:YNUM=""  DO  QUIT:Q=1
	. SET YQ=0
	. SET YSEL=$GET(^WWW133(0,YFORM,YLFN,YNUM,1))
	. SET YPFELD=$PIECE(YSEL,Y,1)
	. IF $PIECE(YSEL,Y,20)'="" DO  IF YQ=1 SET Q=1 QUIT      ;Execute vor Selektion  ;FAN;15.05.2003;23583
	. . N YINHALT
	. . SET YINHALT=$PIECE(YFELD,Y,YPFELD)
	. . XECUTE $PIECE(YSEL,Y,20)
	. . QUIT
	. IF $PIECE(YSEL,Y,15)'="" DO
	. . ;IF '$FIND($$^WWWUPER($PIECE(YFELD,Y,YPFELD)),$$^WWWUPER($PIECE(YSEL,Y,15))) SET Q=1 QUIT
	. . IF '$FIND($zconvert($PIECE(YFELD,Y,YPFELD),"U"),$zconvert($PIECE(YSEL,Y,15),"U")) SET Q=1 QUIT
	. . QUIT
	. IF $PIECE(YSEL,Y,13)'="" DO
	. . QUIT:$piece(YSEL,Y,13)="."  ; DATUM ;Date 
	. . SET YPR=$PIECE(YSEL,Y,13)
	. . ;IF YPR'="" IF $$^WWWUPER(YPR)]]$$^WWWUPER($PIECE(YFELD,Y,YPFELD)) SET Q=1 QUIT
	. . IF YPR'="" IF $zconvert(YPR,"U")]]$zconvert($PIECE(YFELD,Y,YPFELD),"U") SET Q=1 QUIT
	. . QUIT
	. IF $PIECE(YSEL,Y,14)'="" DO
	. . QUIT:$piece(YSEL,Y,14)="."  ; DATUM ;Date 
	. . SET YPR=$PIECE(YSEL,Y,14)
	. . ;IF YPR'="" IF $$^WWWUPER($PIECE(YFELD,Y,YPFELD))]]$$^WWWUPER(YPR) SET Q=1 QUIT
	. . IF YPR'="" IF $zconvert($PIECE(YFELD,Y,YPFELD),"U")]]$zconvert(YPR,"U") SET Q=1 QUIT
	. . QUIT
	. . QUIT
	. QUIT:$PIECE(YSEL,Y,3)=""
	. IF $PIECE(YSEL,Y,3)=1 DO  QUIT  ;SELEKTION
	. . SET YPR=$GET(YLD(YLFN,$EXTRACT(100+YPFELD,2,3)))
	. . ;I YBED="TYBD" WRITE "<BR>" WRITE "KEY:"_YKEY," PRUEF:",YPR," FELD:",$$^WWWUPER($PIECE(YFELD,Y,YPFELD))
	. . ;IF YPR'="" IF $$^WWWUPER(YPR)]]$$^WWWUPER($PIECE(YFELD,Y,YPFELD)) SET Q=1 QUIT
	. . IF YPR'="" IF $zconvert(YPR,"U")]]$zconvert($PIECE(YFELD,Y,YPFELD),"U") SET Q=1 QUIT
	. . IF YPR'="" IF $PIECE(YFELD,Y,YPFELD)="" SET Q=1 QUIT
	. . SET YPR=$GET(YLD1(YLFN,$EXTRACT(100+YPFELD,2,3)))
	. . ;IF YPR'="" IF $$^WWWUPER($PIECE(YFELD,Y,YPFELD))]]$$^WWWUPER(YPR) SET Q=1 QUIT
	. . IF YPR'="" IF $zconvert($PIECE(YFELD,Y,YPFELD),"U")]]$zconvert(YPR,"U") SET Q=1 QUIT
	. . QUIT
	. IF $PIECE(YSEL,Y,3)=2 DO  QUIT  ;GENAU 1 ;truly 
	. . SET YPR=$GET(YLD(YLFN,$EXTRACT(100+YPFELD,2,3)))
	. . QUIT:YPR=""
	. . ;IF $$^WWWUPER($PIECE(YFELD,Y,YPFELD))'=$$^WWWUPER(YPR) SET Q=1 QUIT
	. . IF $zconvert($PIECE(YFELD,Y,YPFELD),"U")'=$zconvert(YPR,"U") SET Q=1 QUIT
	. . QUIT
	. IF $PIECE(YSEL,Y,3)=3 DO  QUIT  ;KOMBINATION
	. . SET YPR=$GET(YLD(YLFN,$EXTRACT(100+YPFELD,2,3)))
	. . QUIT:YPR=""
	. . SET YPR=$TRANSLATE(YPR,";",",")
	. . IF $PIECE(YFELD,Y,YPFELD)="" SET Q=1 QUIT
	. . SET Q=1
	. . ;FOR YCOMB=1:1 SET YCOMB(1)=$PIECE(YPR,",",YCOMB) QUIT:YCOMB(1)=""  IF $FIND(","_$TRANSLATE($$^WWWUPER($PIECE(YFELD,Y,YPFELD)),";",",")_",",","_$$^WWWUPER(YCOMB(1))_",") SET Q=0 QUIT
	. . FOR YCOMB=1:1 SET YCOMB(1)=$PIECE(YPR,",",YCOMB) QUIT:YCOMB(1)=""  IF $FIND(","_$TRANSLATE($zconvert($PIECE(YFELD,Y,YPFELD),"U"),";",",")_",",","_$zconvert(YCOMB(1),"U")_",") SET Q=0 QUIT
	. . QUIT
	. QUIT
	QUIT:Q=1
	QUIT
]]></Routine>
</Export>