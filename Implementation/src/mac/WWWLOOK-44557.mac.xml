<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWLOOK" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWLOOK
#include WWWConst
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		SUCHEN DATENSATZ
	;Vorgaben suchen bei open datensatz ;default seek next to 
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 12-Oct-2005	GRF		Doco
	; 20.05.1998	DT
	;-------------------------------------------------------------------------------
	NEW YI,YA,YFELD1,YKEY1
	
	SET YDATEI=$PIECE(YVOR,Y,11)
	SET YKEY1=""
	IF YALLKEY=2 DO  QUIT
	. FOR YI=1:1 QUIT:'$DATA(YKEY(YI))  QUIT:YKEY(YI)=""  DO
	. . NEW YXKEY
	. . SET YTYP=$PIECE($GET(^WWW002(0,YDATEI,YI,1)),Y,3)
	. . SET YXKEY=YKEY(YI)
	. . IF YTYP=1 SET YXKEY=$$^WWWDATE1(YXKEY)
	. . IF YTYP=7 SET YXKEY=$$^WWWTIME1(YXKEY)
	. . QUIT:YXKEY=""
	. . SET YKEY1=YKEY1_YXKEY_","
	. ;
	. DO FIND
	
	IF YFELD'="" DO FIND QUIT
	
FIND ;SUCHEN KEY AUS WILD ;seek KEY out of wild 
	SET YFELD1 = $TRANSLATE(YFELD,"+")
	SET YKEY1  = $TRANSLATE(YKEY1,"+*")
	;DO ^WWWSOR(YDATEI,"","",1,0,0,1,YFELD1,YKEY1)  ;ALT
	DO ^WWWSOR(YDATEI,"","",1,0,100,1,YFELD1,YKEY1)  ;TYBD;NUR 100 STÜCK MAX;8,1,2004
	SET YKEY=""
	SET YA(2)="" SET YA(2)=$ORDER(^WWWSOR(YUSER,"KEY",YA(2)),-1) IF YA(2)'="" DO     ; FIXME : no FOR commands in these 2 lines - get first entry only?
	. SET YKEY="" SET YKEY=$ORDER(^WWWSOR(YUSER,"KEY",YA(2),YKEY)) IF YKEY'=""  DO
	. . SET YA=$GET(^WWWSOR(YUSER,"KEY",YA(2),YKEY))
	. . FOR YI=1:1 QUIT:$PIECE(YKEY,",",YI)=""  SET YKEY(YI)=$PIECE(YKEY,",",YI)
	
	KILL ^WWWSOR(YUSER)
	QUIT
	
	
PRIM ;SUCHEN KEYS OHNE PRIMÄRSCHLÜSSEL ;seek without 
	SET YFELD1=$TRANSLATE(YFELD,"+*")
	NEW YSCH,YFLD,Q,YSCHK
	SET YSCH="^"_YDATEI_"s("_$$^WWWYM(YDATEI,1)_1
	SET Q=0
	SET YFLD=""
	FOR  SET YFLD=$ORDER(^WWW003s(0,2,1,YDATEI,YFLD)) QUIT:YFLD=""  DO  QUIT:Q=1
	. IF $PIECE(YFELD1,Y,YFLD)="" SET Q=1 QUIT
	. SET YSCH=YSCH_","_$PIECE(YFELD1,Y,YFLD)
	
	QUIT:Q=1
	SET YSCH=YSCH_","_""""_""""_")"
	IF $ORDER(@YSCH)'="" SET YKEY(1)=$ORDER(@YSCH),YKEY=YKEY(1)
	QUIT
	
	
KEY ;SUCHEN FESTEN KEY ;seek KEY 
	NEW YI,YA,YFELD1,YKEY1
	
	SET YDATEI=$$$WWW120ClassUsedInForm(YVOR)
	QUIT:YDATEI=""
	
	SET YKEY1=""
	SET YA="^"_YDATEI_"("_$$^WWWYM(YDATEI,1)
	
	FOR YI=1:1 QUIT:'$DATA(YKEY(YI))  QUIT:YKEY(YI)=""  DO
	. NEW YXKEY
	. SET YTYP=$PIECE($GET(^WWW002(0,YDATEI,YI,1)),Y,3)
	. SET YXKEY=YKEY(YI)
	. IF YTYP=1 SET YXKEY=$$^WWWDATE1(YXKEY)
	. IF YTYP=7 SET YXKEY=$$^WWWTIME1(YXKEY)
	. QUIT:YXKEY=""
	. SET YKEY1=YKEY1_YXKEY_","
	. SET YA=YA_""""_YXKEY_""""_","
	
	SET YA=YA_"1)"
	
	SET YFELD1=$$^WWWSETL(YA,1)   ;TYBD;30.04.2003; WENN LEER DANN TEST
	IF YFELD1'="" SET YKEY=YKEY1
	QUIT
	
	
ANZEIGE ;SUCHEN MIT ANZEIGE ;seek by means of Show 
	DO ^WWWFORMX  ;VORGABEN WWW120/012
	DO ^WWWSTART(YFORM)
	DO ^WWWKOPF($$^WWWTEXT(101))   ;ÖFFNEN ;open 
	DO ^WWWUP(0)
	DO ^WWWBODY(2)  ;OHNE FOKUS ;without focus 
	IF $FIND($PIECE(YVOR,Y,8),1) WRITE "<STRONG><B>"
	IF $FIND($PIECE(YVOR,Y,8),2) WRITE "<U>"
	IF $FIND($PIECE(YVOR,Y,8),3) WRITE "<I>"
	IF $FIND($PIECE(YVOR,Y,8),4) WRITE "<STRIKE>"
	NEW SUCH,AUSW
	
	SET YKEY1=""
	FOR YI=1:1 QUIT:'$DATA(YKEY(YI))  QUIT:YKEY(YI)=""  DO
	. NEW YXKEY
	. SET YTYP=$PIECE($GET(^WWW002(0,YDATEI,YI,1)),Y,3)
	. SET YXKEY=YKEY(YI)
	. IF YTYP=1 SET YXKEY=$$^WWWDATE1(YXKEY)
	. IF YTYP=7 SET YXKEY=$$^WWWTIME1(YXKEY)
	. QUIT:YXKEY=""
	. SET YKEY1=YKEY1_YXKEY_","
	. QUIT
	SET YDATEI = $PIECE(YVOR,Y,11)
	SET YFELD1 = $TRANSLATE(YFELD,Y_"+|","#")
	SET YKEY1  = $TRANSLATE(YKEY1,"+*")
	SET AUSW   = "|"_YFELD1_"|"_YKEY1
	SET SUCH   = $ORDER(^WWW123(0,YFORM,""))
	SET YSUCH1 = ""
	IF SUCH'="" SET YSUCH1=$GET(^WWW123(0,YFORM,SUCH,1))
	IF YSUCH1="",$DATA(^WWW123(0,YFORM)) SET YSUCH1=$ORDER(^WWW123(0,YFORM,"")) SET YSUCH1=$PIECE(^WWW123(0,YFORM,YSUCH1,1),Y,2)
	;DO ^WWWKOPF($$^WWWUML($PIECE(YSUCH1,Y,1)))
	DO ^WWWKOPF($$^WWWTEXT($PIECE(YSUCH1,Y,1)))  ;TYBD;8,7,2003
	IF $DATA(YFORM) IF YFORM'="" DO
	. ;
	. WRITE YCR,"<TABLE CELLSPACING=0 BORDER=0><TR><TD NOWRAP>"
	. WRITE "<A HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&amp;YFORM="_YFORM   ;  _"&YOPEN=OLD"
	. DO ^WWWCGI
	. WRITE """"_">"
	. WRITE YCR,"<IMG SRC="_""""_YGIF_"hback.gif"_""""_" style="_""""_"cursor:w-resize"_""""_" "_YHEIGHT_" "_YWIDTH_" TITLE="_""""_$$^WWWTEXT(99)_""""_" border=0></A>"
	. WRITE YCR,"</TD></TR></TABLE>"
	. QUIT
	
	;YSUCH1="FORMULAR;DATEI;SORTKEY;VORGABE;ANZEIGE KEY;ANZEIGEFELD;STD SORT;ANZEIGE ERGEBNIS;ORIENTIERUNG;ANZAHL ANZEIGEN;FIXKEY;FELDER MIT SUMMENBILDUNG;WELCHEN KEY UEBERGEBEN;
	SET $PIECE(YSUCH1,Y,1)=YFORM
	IF $PIECE(YSUCH1,Y,2)="" SET $PIECE(YSUCH1,Y,2)=YDATEI
	SET $PIECE(YSUCH1,Y,4)=AUSW
	SET $PIECE(YSUCH1,Y,11)=YFKEY
	SET $PIECE(YSUCH1,Y,10)=900
	DO ^WWWSUCH1
	IF $FIND($PIECE(YVOR,Y,8),1) WRITE "</STRONG></B>"
	IF $FIND($PIECE(YVOR,Y,8),2) WRITE "</U>"
	IF $FIND($PIECE(YVOR,Y,8),3) WRITE "</I>"
	IF $FIND($PIECE(YVOR,Y,8),4) WRITE "</STRIKE>"
	WRITE "</FONT>"
	WRITE YCR
	DO ^WWWUP(1)
	DO ^WWWSTOP
	QUIT
]]></Routine>
</Export>