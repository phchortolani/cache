<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INBESTANZ1" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INBESTANZ1
	;###############################################################################
	;  
	;  STOCK ON HAND LIST HAS BEEN RE-WRITTEN TO USE BUNDLE-BASED DATA.
	;  TREAT AS OBSOLETE
	;  
	;###############################################################################	
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		AUFRUF ARTIKELBESTANDS-ANZEIGE
	;		Display Stock On Hand details
	;
	; Inputs : 
	;
	;
	; ByRef :
	;	YAUSWAHL
	;	YPARA
	;
	; Returns :
	;
	;
	; History :
	; 02-Sep-2008	GRF		SR15804: Call for bundle-based SOH moved to INARTINFO.
	; 25-Aug-2008	GRF		SR15804: Activate bundle-based Stock on Hand display.
	; 23-Nov-2006	GRF		SR15232: Remove unnecessary DO level in ART; quits.
	; 07-Jun-2005	GRF		Add Comment
	; 11.10.2001	FIS
	;-------------------------------------------------------------------------------
	NEW ARTIKEL
 
	SET YAUSWAHL=$GET(YAUSWAHL)
	
	KILL LAGERANZEIGE
	
	;KILL SNANZEIGE
	SET ARTANZEIGE=1  ;!-> FÜR RÜCKSPRUNG AUS ARTIKELANZEIGE ! DARF NICHT geNEW't WERDEN !! ;to out of Not will 
	IF $GET(YPARA)="SN"   SET SNANZEIGE=1 SET YPARA=""  ;!-> FÜR RÜCKSPRUNG AUS SN-ZUORDNUNG ! DARF NICHT geNEW't WERDEN !! ;FIS;29.12.03;24854
	IF $GET(YPARA)="NOSN" KILL SNANZEIGE  SET YPARA=""
	
	SET ARTIKEL=$PIECE($GET(^INUSER(YM,YBED,1)),Y,2)                          ;AUS VORGABE ;out of default 
	IF $GET(%(YQUERY,"YARTIKEL"))'="" SET ARTIKEL=$GET(%(YQUERY,"YARTIKEL"))  ;SONDER AUFRUF AUS LINK ;out of 
	SET $PIECE(^INUSER(YM,YBED,1),Y,2)=ARTIKEL                                ;AUS VORGABE ;out of default 
	
	IF ARTIKEL="" QUIT
	
	WRITE "<HR>"
	; Check Please! (Item)   or   Check Please! (Phantom Item)
	IF '$DATA(^INART(YM,ARTIKEL))                WRITE "<FONT SIZE=2><B>"_$$^WWWTEXT(32292)_" ("_$$^WWWTEXT(32024)_")"_"</B></FONT>" QUIT
	IF $PIECE($GET(^INART(YM,ARTIKEL,1)),Y,26)=5 WRITE "<FONT SIZE=2><B>"_$$^WWWTEXT(32292)_" ("_$PIECE($GET(^WWW101(0,"ARTIKEL-ART",SPRACHE,5,1)),Y,1)_")"_"</B></FONT>" QUIT  ;PHANTOMARTIKEL
	
	IF YFORM="INBESTANZPDA" DO ^INBESTANZPDA(ARTIKEL) QUIT
	
	DO ^INBESTANZ(ARTIKEL,,YAUSWAHL)                      ; From ^INWE
	QUIT
	
KEY ;MERKEN ARTIKEL FÜR ANZEIGE ;item to Show 
	SET VORG(1)=$GET(VORG(1))  ;AUSWAHL ARTIKEL ;Selection item 
	SET $PIECE(^INUSER(YM,YBED,1),Y,2)=VORG(1)
	DO ^WWWFORM
	QUIT
	
ART ;MERKEN ARTIKEL FÜR ANZEIGE ;item to Show 
	NEW YFORM,YKEY
	
	SET YKEY=$PIECE(^INUSER(YM,YBED,1),Y,2)
	SET YFORM="INART"
	IF $GET(SNANZEIGE)=1 DO  ;FIS;29.12.03;24854;RÜCKSPRUNG SN-ZUORDNUNG
	. SET YKEY=$PIECE(^INUSER(YM,YBED,1),Y,3)_","_$PIECE(^INUSER(YM,YBED,1),Y,4)
	. SET YFORM="INAUFPTSN"
	. SET YBACK="INAUFP,"
	
	SET %("VAR","YFORM")=YFORM
	SET %("VAR","YKEY")=YKEY
	IF $GET(YBACK)'="" SET %("VAR","YBACK")=YBACK
	DO ^WWWFORM
	
	QUIT
	
CALL(YKEY,YSHOW) ;EINSPRUNG AUS ERFASSEN E-RECHNUNGEN;FIS;11.08.04 ;out of Edit 
	NEW ANZ,YI,WEMERKER,AUF,POS
	
	SET YKEY = $GET(YKEY)
	IF YKEY="" IF YFORM="INERECH1" SET YKEY=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"P",1))
	SET AUF = $PIECE(YKEY,",",1)
	SET POS = $PIECE(YKEY,",",2)
	
	IF AUF'="" IF POS'="" DO
	. IF $GET(YSHOW)=1 QUIT:'$DATA(^INWEAUF(YM,AUF,POS))
	. KILL ^WWWSOR(YUSER)
	. SET ^WWWSOR(YUSER,"HEAD")=$$^WWWFELDNAME("INWEAUF","P",5)_Y_$$^WWWFELDNAME("INWEAUF","P",4)_Y_$$^WWWFELDNAME("INWEAUF","D",1)_Y_$$^WWWFELDNAME("INWEAUF","D",14)_Y_$$^WWWFELDNAME("INWEAUF","D",4)_Y_$$^WWWFELDNAME("INWEAUF","D",8)_Y_$$^WWWFELDNAME("INWEAUF","D",10)
	. SET ^WWWSOR(YUSER,"TITLE")=$$^WWWTEXT(32309)_" "_$$^WWWTEXT(32047)_": "_AUF_"-"_POS  ;WARENEINGÄNGE
	. SET ^WWWSOR(YUSER,"LEFT")="2,3,4,7"
	. SET ^WWWSOR(YUSER,"RIGHT")="5,6"
	. SET ANZ=0
	. ;
	. IF $DATA(^INWEAUF(YM,$PIECE(YKEY,",",1),$PIECE(YKEY,",",2))) DO
	. . NEW LAP,BET,WED,WE1
	. . SET BET=""
	. . FOR  SET BET=$ORDER(^INWEAUF(YM,AUF,POS,BET)) QUIT:BET=""  DO
	. . . SET LAP=""
	. . . FOR  SET LAP=$ORDER(^INWEAUF(YM,AUF,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . SET WED=""
	. . . . FOR  SET WED=$ORDER(^INWEAUF(YM,AUF,POS,BET,LAP,WED)) QUIT:WED=""  DO
	. . . . . SET WE1=$GET(^INWEAUF(YM,AUF,POS,BET,LAP,WED,1))
	. . . . . SET WEMERKER=""
	. . . . . IF $PIECE(WE1,Y,10)'="" SET WEMERKER=$PIECE(WE1,Y,10)_"-"_$PIECE($GET(^INWEMERKER(YM,$PIECE(WE1,Y,10),1)),Y,1)
	. . . . . SET ^WWWSOR(YUSER,"DATA",WED_","_BET_","_LAP)=$$^WWWDATE(WED)_Y_LAP_Y_$PIECE(WE1,Y,1)_Y_$PIECE(WE1,Y,14)_Y_$$^WWWZAHL($PIECE(WE1,Y,4),0,$LENGTH($PIECE($PIECE(WE1,Y,4),".",2)))_Y_$$^WWWZAHL($PIECE(WE1,Y,8),0,2,YWHR)_Y_WEMERKER
	. . . . . SET ANZ=ANZ+1
	. ;
	. IF $DATA(^INWEAUFALT(YM,$PIECE(YKEY,",",1),$PIECE(YKEY,",",2))) DO
	. . NEW LAP,BET,WED,WE1
	. . SET BET=""
	. . FOR  SET BET=$ORDER(^INWEAUFALT(YM,AUF,POS,BET)) QUIT:BET=""  DO
	. . . SET LAP=""
	. . . FOR  SET LAP=$ORDER(^INWEAUFALT(YM,AUF,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . SET WED=""
	. . . . FOR  SET WED=$ORDER(^INWEAUFALT(YM,AUF,POS,BET,LAP,WED)) QUIT:WED=""  DO
	. . . . . SET WE1=$GET(^INWEAUFALT(YM,AUF,POS,BET,LAP,WED,1))
	. . . . . SET WEMERKER=""
	. . . . . IF $PIECE(WE1,Y,10)'="" SET WEMERKER=$PIECE(WE1,Y,10)_"-"_$PIECE($GET(^INWEMERKER(YM,$PIECE(WE1,Y,10),1)),Y,1)
	. . . . . SET ^WWWSOR(YUSER,"DATA",WED_","_BET_","_LAP)=$$^WWWDATE(WED)_Y_LAP_Y_$PIECE(WE1,Y,1)_Y_$PIECE(WE1,Y,14)_Y_$$^WWWZAHL($PIECE(WE1,Y,4),0,$LENGTH($PIECE($PIECE(WE1,Y,4),".",2)))_Y_$$^WWWZAHL($PIECE(WE1,Y,8),0,2,YWHR)_Y_WEMERKER
	. . . . . SET ANZ=ANZ+1
	. ;
	. ;IF ANZ<5 FOR YI=ANZ:1:4 SET ^WWWSOR(YUSER,"DATA",$CHAR(255)_YI)="",ANZ=ANZ+1
	. DO ^WWWTABLE(ANZ,,,5)
	. KILL ^WWWSOR(YUSER)
	
	IF ($PIECE(YKEY,",",1)'="") && ($PIECE(YKEY,",",2)'="") {
		SET $PIECE(^INUSER(YM,YBED,1),Y,2)=$PIECE($GET(^INAUFP(YM,$PIECE(YKEY,",",1),$PIECE(YKEY,",",2),1)),Y,4)
	}
	
	DO ^INBESTANZ1
	WRITE YCR,"<BR>"
	QUIT
	
]]></Routine>
</Export>