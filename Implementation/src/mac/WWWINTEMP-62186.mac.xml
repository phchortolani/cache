<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWINTEMP" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWIN ;WWWIN;DT;PROGRAMMSTAND EINLESEN;07.10.1997  ; Compiled January 17, 2005 11:23:50
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		PROGRAMMSTAND EINLESEN
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	07.10.1997  
	;|
	;\------------------------------------------------------------------/
	;
	;MANUELLER START VIA TERMINAL = D INPUT^WWWIN (WENN WWWOUT MANUELL EINGELESEN)
	;                                                               D START^WWWIN (AUTOMATISCHE INPUT AUS FTPROOT)
	NEW VORG1,VORG2,VORG3,VORG4,TEXT
	SET VORG1=1   ;$GET(VORG(1))  ;ÜBERNEHMEN J/N ;assume 
	SET VORG2=1   ;$GET(VORG(2))  ;LÖSCHEN NACH ÜEBERTRAG ;Delete within 
	SET VORG3=$GET(VORG(3))
	SET VORG4=$GET(VORG(4))
	;IF VORG3="" IF VORG4="" DO ^WWWINFO($$^WWWTEXT(32310)) QUIT  ;BEC;23196;MELDUNG, FALLS NICHTS EINGEGEBEN WIRD;KEINE AUSWAHL GETROFFEN ; tybd: DARF NICHT QUIT, DA SONST KEIN START MÖGLICH WENN WWWOUT MANUELL EINGELESEN WURDE GGF LINUX / UNIX SYSTEM
	xecute "ZL WWWIN ZS WWWINTEMP H 2" ; Make a copy of WWWIN and use it
	IF VORG3'=""!(VORG4'="") JOB INPUT0^WWWINTEMP(VORG1,VORG2,VORG3,VORG4,$GET(SPRACHE),$GET(YBED))::1  IF '$TEST DO ^WWWINFO($$^WWWTEXT(144))  ;NICHT MÖGLICH ;Not potential 
	;JOB INPUT0^WWWIN(VORG1,VORG2,VORG3,VORG4,$G(SPRACHE),$G(YBED))::1  IF '$T DO ^WWWINFO($$^WWWTEXT(144)) QUIT  ;FIS;23468;17.04.03 
	;;IF '$FIND(YAKTION,"/csp/") JOB INPUT^WWWIN:(:1):1  ;JOB STARTEN 
	;;IF $FIND(YAKTION,"/csp/") JOB INPUT0^WWWIN(VORG1,VORG2,VORG3,VORG4)::2
	SET TEXT=$$^WWWTEXT(383)  ;HINTERGRUND ;foil 
	IF VORG3="" IF VORG4="" SET TEXT=$$^WWWTEXT(32310) ;KEINE EINGABEN ;no 
	DO ^WWWINFO(TEXT)  ;GESTARTET
	QUIT
	
START ;TERMINAL START  ;EINSPRUNG ;take-off 
	SET VORG(1)=1
	SET VORG(2)=1
	SET VORG(3)="C:\inetpub\ftproot\formdat.txt"
	SET %("VAR","YBED")=$GET(YBED)            ;BEC;TYBD;28.11.03;24721;DAMIT BEDIEHNER NICH VERLOREN GEHT / MELDUNG
	IF '$DATA(YBED) IF '$DATA(SPRACHE) DO ^WWWVAR
	DO INPUT
	QUIT
	
INPUT0(VORG1,VORG2,VORG3,VORG4,SPRACHE,YBED)        ;EINSPRUNG
	DO INPUT
	QUIT
	
INPUT ;EINSPRUNG 
	KILL %,%KEY
	NEW SORT,FORMS,KEEPHELP,CKFILE
	SET %("VAR","YBED")=$GET(YBED)            ;BEC;TYBD;28.11.03;24721;DAMIT BEDIEHNER NICH VERLOREN GEHT / MELDUNG
	DO ^WWWVORG 
	SET $ZTRAP="^WWWERROR"
	;DO LOW^%PRIO
	SET $PIECE(^WWW120(0,"WWWIN",1),Y,110)=$$^WWWTEXT(32028)_": "_$$^WWWDATE($HOROLOG)_", "_$$^WWWTIME($HOROLOG)  ;LETZE AUFBEREITUNG
	KILL ^WWWERROR   ;LÖSCHEN ALTE FEHLERPROTOKOLLE ;Delete 
	hang 1
	DO PROTOCOL("Start Update Process")   ;TYBD;26134;PROTOCOLL DES UPDATE
	hang 1
	DO PROTOCOL("Old Messages deleted")   ;TYBD;26134;PROTOCOLL DES UPDATE
	SET VORG(1)=$GET(VORG1)
	SET VORG(2)=$GET(VORG2)
	SET VORG(3)=$GET(VORG3)      
	SET VORG(4)=$GET(VORG4) 
	IF VORG(4)=1 IF VORG(3)="" DO
	. NEW FILE
	. SET FILE=$TRANSLATE($PIECE($GET(^WWW012(0,YM,1)),Y,45),"/","\")
	. IF $EXTRACT($REVERSE(FILE))'="\" SET FILE=FILE_"\"
	. IF FILE="" SET FILE="C:\inetpub\ftproot\"
	. SET VORG(3)=FILE_"formdat.txt"
	. QUIT
	IF $GET(VORG(3))'="" DO  ;ERST DATEN EINSPIELEN ;only 
	. NEW DATEI
	. SET DATEI=VORG(3)
	. NEW VORG,VORG1,VORG2,VORG3,VORG4
	. KILL ^WWWOUT
	. hang 1
	. DO PROTOCOL("Start Import FORMDAT.TXT")   ;TYBD;26134;PROTOCOLL DES UPDATE
	. SET VORG(1)=DATEI   ;IMPORTDATEI
	. SET VORG(2)="WWWOUT"  ;GLOBAL
	. SET VORG(3)=1  ;LÖSCHEN WWWOUT ;Delete 
	. FOR LFN=4:1:13 SET VORG(LFN)=""  ;TYBD;22.03.2005;10793;DFLT SETTINGS
	. SET VORG(999)=1  ;KEINE ANZEIGE ;no Show 
	. SET YQ=1
	. DO ^WWWIMPO  ;IMPORT VON DATEN ;importation 
	. DO PROTOCOL("Import FORMDAT.TXT Finished")   ;TYBD;26134;PROTOCOLL DES UPDATE
	. QUIT
	SET VORG(1)=$GET(VORG1)        
	SET VORG(2)=$GET(VORG2)        
	SET VORG(3)=$GET(VORG3)        
	IF '$DATA(VORG(1)) SET VORG(1)=1
	IF '$DATA(VORG(2)) SET VORG(2)=1
	;SAVE HELP TEXT FOR RELOAD
	SET KEEPHELP=0
	DO
	. NEW YYM
	. SET YYM=$ORDER(^WWW012(0,""))
	. IF YYM'="" IF $FIND($$^WWWUPER($PIECE($GET(^WWW012(0,YM,1)),Y,1)),"KEEPHELP") SET KEEPHELP=1
	. QUIT
	IF KEEPHELP=1 KILL ^WWWSOR(YUSER,"HELP")
	IF $DATA(^WWWUMLAU(0)) MERGE ^WWWSOR("UPDATE","WWWUMLAU")=^WWWUMLAU  ;SAVE UMLAU TABLE;TYBD;26844;24,11,2004
	hang 1
	DO PROTOCOL("Start Loading Update")   ;TYBD;26134;PROTOCOLL DES UPDATE
	SET FORMS=0  ;KEINE Formulare ;no 
	SET YROUTINE=0  ;KEINE PROGRAMME ;no 
	DO  ;IF VORG(1)=1 DO  ;UPDATE DER DATEN ;the 
	. NEW YXCHANGE  ;TYBD;16.05.2004
	. SET YXCHANGE=0
	. IF $DATA(^WWW012E(0)) IF $ZUTIL(5)'="INTRAPREND" SET YXCHANGE=1
	. SET LFN="" FOR  SET LFN=$ORDER(^WWWOUT(0,LFN)) QUIT:LFN=""  DO
	. . SET EXEX=$GET(^WWWOUT(0,LFN,0,1))
	. . IF EXEX'="" DO
	. . . IF $EXTRACT(EXEX,1,5)="SORT " DO  QUIT
	. . . . SET SORT=$PIECE(EXEX," ",2) IF SORT'="" SET SORT(SORT)=""
	. . . . QUIT
	. . . IF KEEPHELP=1 IF $EXTRACT(EXEX,1,9)="K ^WWW127" DO SAVEHELP  ;SAVE OLD HELP TEXT
	. . . XECUTE EXEX
	. . . QUIT
	. . SET S1=$GET(^WWWOUT(0,LFN,1,1))
	. . SET S2=$GET(^WWWOUT(0,LFN,2,1))
	. . QUIT:$EXTRACT(S1)'="^"
	. . IF $FIND(S1,"^WWW") SET FORMS=1  ;FORMULARE VORHANDEN ;on hand 
	. . IF $FIND(S1,"^ROUTINE(")!($FIND(S1,"^rMAC("))!($FIND(S1,"^rINC(")) DO
	. . . SET YROUTINE=1
	. . . SET FORMS=1
	. . . SET ROUTINE=$TRANSLATE($PIECE($PIECE(S1,"(",2),",",1),"""")
	. . . IF S2'="" IF ROUTINE'="" IF $EXTRACT(ROUTINE,1,5)'="WWWIN" IF $EXTRACT(ROUTINE)'="X" IF $FIND(S2,"@@AUTOSTART@@") SET PGM(ROUTINE)=""   ;AUTOSTART VON ROUTINEN
	. . . QUIT
	. . IF YXCHANGE=1 DO  ;WENN MIT UMSETZTUNG DER ANWENDUNG ;when by means of the 
	. . . SET S2=$$^WWWUML(S2,9)  ;FIS;13.05.04;25673
	. . . SET S1=$$^WWWUML(S1,9)  ;TYBD;16.05.2004 ;25673
	. . . QUIT
	. . SET CKFILE=$PIECE($PIECE(S1,"(",1),"^",2) IF CKFILE'="" DO  QUIT:CKFILE=1 
	. . . IF $PIECE($GET(^WWW001(0,$EXTRACT(CKFILE,1,60),1)),Y,17)=1 IF $DATA(@S1) SET CKFILE=1  ;SCHON VORHANDEN
	. . . QUIT
	. . SET @S1=S2
	. . QUIT
	. IF KEEPHELP=1 DO GETHELP  ;GET BACK OLD HELP TEXT
	. QUIT
	IF $DATA(^WWWSOR("UPDATE","WWWUMLAU")) MERGE ^WWWUMLAU=^WWWSOR("UPDATE","WWWUMLAU") K ^WWWSOR("UPDATE","WWWUMLAU")  ;RESTORE SAVED UMLAU TABLE;TYBD;26844;24,11,2004
	IF VORG(2)=1 DO
	. KILL ^WWWOUT
	. QUIT
	KILL VORG
	SET YQ=0
	hang 1
	DO PROTOCOL("Update Loading Finished")   ;TYBD;26134;PROTOCOLL DES UPDATE
	;DO  ;BUTTON BERICHTIGEN ;regulate 
	. NEW FORM,SPR,BUT
	. SET FORM="" FOR  SET FORM=$ORDER(^WWW124(0,FORM)) QUIT:FORM=""  DO  
	. . SET SPR="" FOR  SET SPR=$ORDER(^WWW124(0,FORM,SPR)) QUIT:SPR=""  DO   
	. . . SET BUT="" FOR  SET BUT=$ORDER(^WWW124(0,FORM,SPR,BUT)) QUIT:BUT=""  DO
	. . . . IF $PIECE($GET(^WWW124(0,FORM,SPR,BUT,1)),Y,4)="" SET $PIECE(^WWW124(0,FORM,SPR,BUT,1),Y,4)="999"
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	;IF $DATA(^INVORG(0)) IF '$DATA(^INPARA(YM,"ANREDE")) MERGE ^INPARA(YM,"ANREDE")=^WWW101(0,"ANREDE")
	;RELOAD
	hang 1
	DO PROTOCOL("Start Recompile Routines")   ;TYBD;26134;PROTOCOLL DES UPDATE
	IF $GET(YROUTINE)=1 DO   ;RELOAD ALLE
	. SET YROUTINE="" FOR  SET YROUTINE=$ORDER(^ROUTINE(YROUTINE)) QUIT:YROUTINE=""  DO
	. . QUIT:YROUTINE="WWWINTEMP"
	. . QUIT:$FIND(YROUTINE,".")  ;KEINE PROGRAMME MIT . WEGEN KLASSENDEFINITION / DO NOT COMPILE CLASSES WITH A DOT. ;no by means of quibble privation 
	. . ;QUIT:YROUTINE="WWWINSTALL"  ;TYBD;23,6,2004;
	. . QUIT:$EXTRACT(YROUTINE)="%"
	. . SET YERR=$$ROUTINE^%R(YROUTINE_".INT",.r,.e,"LCS")
	. . ;;;DO RebuildIndex^%R(.namespace,.num)  ;ERST AB CACHE 5
	. . QUIT
	. ;SET YROUTINE="" FOR  SET YROUTINE=$ORDER(^rMAC(YROUTINE)) QUIT:YROUTINE=""  DO  ;NOCH NICHT FREIGESCHALTET, FIS,14.03.03
	. . QUIT:$EXTRACT(YROUTINE)="%"
	. . QUIT:YROUTINE="WWWINTEMP"
	. . QUIT:$FIND(YROUTINE,".")  ;KEINE PROGRAMME MIT . WEGEN KLASSENDEFINITION / DO NOT COMPILE CLASSES WITH A DOT. ;no by means of quibble privation 
	. . QUIT:YROUTINE="WWWINSTALL"  ;TYBD;23,6,2004;
	. . QUIT:$EXTRACT(YROUTINE)="%"
	. . SET YERR=$$ROUTINE^%R(YROUTINE_".MAC",.r,.e,"LCS")  ;RICHTIG ??? ;rightly 
	. . QUIT
	. ;SET YROUTINE="" FOR  SET YROUTINE=$ORDER(^rINC(YROUTINE)) QUIT:YROUTINE=""  DO
	. . QUIT:$EXTRACT(YROUTINE)="%"
	. . QUIT:YROUTINE="WWWINTEMP"
	. . QUIT:$FIND(YROUTINE,".")  ;KEINE PROGRAMME MIT . WEGEN KLASSENDEFINITION / DO NOT COMPILE CLASSES WITH A DOT. ;no by means of quibble privation 
	. . ;QUIT:YROUTINE="WWWINSTALL"  ;TYBD;23,6,2004;
	. . SET YERR=$$ROUTINE^%R(YROUTINE_".INC",.r,.e,"LCS")  ;RICHTIG ??? ;rightly 
	. . QUIT
	. QUIT
	set num=""
	;;;;DIES SORGT DAFÜR, DASS MAN DEN SOURCE NICHT MEHR SIEHT ;;; do ##class(%Library.RoutineIndex).RebuildIndex(.YUCI,.num)  ;TYBD;29,9,2004;NICHT ANGEZEIGTE ROUTINEN
	;;;;DIES IST EIN UNDEF;TYBD;15,1,2005  ;; do ##class(%Library.RoutineIndex).RebuildIndex(YUCI,.num)  ;TYBD;13,1,2005;NEU ANZEIGEN
	do ##class(%Library.RoutineIndex).RebuildIndex(.YUCI,.num)       ;BEC;17.01.05;27181
	hang 1
	DO PROTOCOL("Routines Recompiled")   ;TYBD;26134;PROTOCOLL DES UPDATE
	;SORTIERSCHLUESSEL
	hang 1
	DO PROTOCOL("Start Recreate Sortkey")   ;TYBD;26134;PROTOCOLL DES UPDATE
	SET YQ=1
	IF FORMS=1 SET VORG(1)="WWW002;WWW003;WWW120;WWW122;WWW124;WWW004;WWW101;WWW100;WWW009;WWW013;WWWDRAGDROP;WWWDRAGDROPD" DO ^WWWSORT  ;SORTIERSCHL. FELDER
	SET SORT="" FOR  SET SORT=$ORDER(SORT(SORT)) QUIT:SORT=""  DO
	. SET VORG(1)=SORT
	. DO ^WWWSORT
	. QUIT
	hang 1
	DO PROTOCOL("Recreate Sortkey Finished")   ;TYBD;26134;PROTOCOLL DES UPDATE
	;IF $G(YROUTINE)=1 D NALL^%RCOMPIL   ; ALLE PROGRAMME: RECOMPLILE
	;AUFBEREITEN MONATSDATEN
	hang 1
	DO PROTOCOL("Start Reorganisation")   ;TYBD;26134;PROTOCOLL DES UPDATE
	;DO START^WWWMON
	DO START1^WWWMON($GET(YM),$GET(SPRACHE))     ;BEC;26420;27.09.04
	hang 1
	DO PROTOCOL("Reorganisation Finished")   ;TYBD;26134;PROTOCOLL DES UPDATE
	hang 1
	DO PROTOCOL("Start Automated Background Jobs")   ;TYBD;26134;PROTOCOLL DES UPDATE
	SET PROGR=""
	IF $DATA(PGM) FOR  SET PROGR=$ORDER(PGM(PROGR)) QUIT:PROGR=""  DO
	. SET YEXEC="DO"_" "_"^"_PROGR
	. DO
	. . NEW PROGR
	. . XECUTE YEXEC
	. . QUIT
	. QUIT
	hang 1
	DO PROTOCOL("Background Jobs Finished")   ;TYBD;26134;PROTOCOLL DES UPDATE
	;END ;ultimate 
	hang 1
	DO PROTOCOL("Update Process Finished")   ;TYBD;26134;PROTOCOLL DES UPDATE
	SET $PIECE(^WWW120(0,"WWWIN",1),Y,110)=$$^WWWTEXT(32471)_": "_$$^WWWDATE($HOROLOG)_", "_$$^WWWTIME($HOROLOG)  ;LETZE AUFBEREITUNG
	IF $DATA(^WWW120(0,"INTAGES",1)) SET $PIECE(^WWW120(0,"INTAGES",1),Y,110)=""   ;ABARBEITEN TAGESDATEI
	IF $GET(YBED)'="" DO MSG^WWW013MSG(YBED,$$^WWWTEXT(33362),$PIECE($GET(^WWW120(0,"WWWIN",1)),Y,1))  ;INFO-MESSAGE: PROCESS FINISHED
	QUIT
	
SAVEHELP ; SAVE OLD HELP TEXT
	NEW FORM,FIELD,LFD,TEXT
	SET FORM=$TRANSLATE($PIECE($PIECE(EXEX,",",2),")",1),"""")
	QUIT:FORM=""
	QUIT:'$D(^WWW127(0,FORM))
	SET FIELD="" FOR  SET FIELD=$O(^WWW127(0,FORM,FIELD)) QUIT:FIELD=""  DO
	. SET LFD="" FOR  SET LFD=$O(^WWW127(0,FORM,FIELD,LFD)) QUIT:LFD=""  DO
	. . SET TEXT=$G(^WWW127(0,FORM,FIELD,LFD,"EN",1))
	. . IF TEXT'="" SET ^WWWSOR(YUSER,"HELP",FORM,FIELD,LFD,"EN")=TEXT
	. . QUIT
	. QUIT
	QUIT
	
GETHELP ; GET BACK OLD HELP TEXT
	NEW FORM,FIELD,LFD,TEXT
	SET FORM="" FOR  SET FORM=$O(^WWWSOR(YUSER,"HELP",FORM)) QUIT:FORM=""  DO
	. SET FIELD="" FOR  SET FIELD=$O(^WWWSOR(YUSER,"HELP",FORM,FIELD)) QUIT:FIELD=""  DO
	. . SET LFD="" FOR  SET LFD=$O(^WWWSOR(YUSER,"HELP",FORM,FIELD,LFD)) QUIT:LFD=""  DO
	. . . SET TEXT=$G(^WWWSOR(YUSER,"HELP",FORM,FIELD,LFD,"EN"))
	. . . IF TEXT'="" SET ^WWW127(0,FORM,FIELD,LFD,"EN",1)=TEXT
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
	
PROTOCOL(TEXT)
	SET ^WWWERROR(0,+$HOROLOG,$PIECE($HOROLOG,",",2),0,1)=$GET(TEXT)_" /  / "_$GET(YBED)
	QUIT
]]></Routine>
</Export>