<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFPTBINF" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFPTBINF(YKEY,SORT,DETAIL)
#include COMSYS
#include INConst
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		BESTANDSKONTROLLE DER TEILE
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 28-Sep-2006	GRF		Doco
	; 30-Aug-2006	GRF		SR12027: INARTK D1=>D8; quits; YCR
	; 06-Mar-2006	RPW		SR14521: Do not allow manual sourcing when the location
	; 						doesn't match the order location
	; 11.03.2001	DT
	;-------------------------------------------------------------------------------
	NEW ANZM,ART,AUFTRAG,BESTAND,BESTELLUNG,BEST1,COLOR,idLocation
	new LAGERBEST,LIEF,SUM,YAUF,YDDSATZ,YPOS,YPOS1,YTEIL
	
	IF +$GET(SORT)=0 SET SORT=1
	SET YAUF=$PIECE($GET(YKEY),",",1)
	SET YPOS=$PIECE($GET(YKEY),",",2)
	
	// SR14521: Disallow sourcing if we can't get from other locations and the location doesn't match the order
	set idLocation=$piece(^INAUF(YM,YAUF,1),Y,6)
	if '$piece(^INVORG(YM,YM,1),"~",67)&&(YLOCATION'=idLocation) do ^WWWBACK write "<BR><B>"_$$$Text($listbuild("IN00409",idLocation,YLOCATION))_"</B><BR><BR>" quit  ;Can not source location %1 order from location %2.
	
	SET DETAIL=+$GET(DETAIL)
	SET YDDSATZ=0  
	SET YTARGET=$GET(YTARGET)
	;SET YTARGET=$PIECE(YTARGET,"/",1)
	IF YTARGET="" SET YTARGET="FRAME2"
	SET $PIECE(YVOR,Y,24)=1
	if '$data(%("%KEY","YLOCKBACK")) DO ^WWWBACK ;SR12082
	
	WRITE YCR
	WRITE "<TABLE BORDER=0 CELLSPACING=0 WIDTH=100%>"
	WRITE "<TR>"
	
	WRITE "<TD WIDTH=20%>"
	WRITE "<A HREF="_""""_YAKTION_"EP=WWWMANU&YFORM=INAUF&YEXEC=D|^INAUFPTBINF('"_YKEY_"',1,'"_DETAIL_"')"  ;LINK SETZEN ;typeset 
	DO ^WWWCGI
	WRITE """"
	WRITE ">"
	WRITE "<img src="_YGIF_"menu.gif border=0 TITLE="_""""_$$^WWWTEXT(65)_" "_$$^WWWTEXT(131)_" "_$$^WWWTEXT(32047)_""""_"></A>"
	WRITE YCR
	WRITE "<A HREF="_""""_YAKTION_"EP=WWWMANU&YFORM=INAUF&YEXEC=D|^INAUFPTBINF('"_YKEY_"',2,'"_DETAIL_"')"  ;LINK SETZEN ;typeset 
	DO ^WWWCGI
	WRITE """"
	WRITE ">"
	WRITE "<img src="_YGIF_"baum.gif border=0 TITLE="_""""_$$^WWWTEXT(65)_" "_$$^WWWTEXT(131)_" "_$$^WWWTEXT(32082)_""""_"></A>"
	WRITE YCR
	
	DO  ;DETAILS AN/AUS
	. NEW DETAIL1
	. SET DETAIL1=1
	. IF DETAIL=1 SET DETAIL1=0
	. WRITE "<A HREF="_""""_YAKTION_"EP=WWWMANU&YFORM=INAUF&YEXEC=D|^INAUFPTBINF('"_YKEY_"','"_SORT_"','"_DETAIL1_"')"  ;LINK SETZEN ;typeset 
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE "<img src="_YGIF_"teile.gif border=0 TITLE="_""""_$$^WWWTEXT(33711)_""""_"></A>"
	. WRITE YCR
	
	/*vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	;WARENHERKUNFT=LAGERBESTAND (WENN VORHANDEN)
	;DO  ;FIS;06.01.04
	. WRITE "<A HREF="_""""_YAKTION_"EP=WWWMANU&YFORM=INAUF&YEXEC=D|LAGER^INAUFPTBINF('"_YKEY_"','"_SORT_"')"  ;LINK SETZEN ;typeset 
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE "<img src="_YGIF_"warenher.gif border=0 TITLE="_""""_$$^WWWTEXT(32498)_""""_"></A>"
	. WRITE YCR
	. WRITE "&nbsp;"
	;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END */
	WRITE "</TD>"
	
	;ÜBERSCHRIFT ;superscription 
	;WRITE "<TD ALIGN=CENTER WIDTH=60%>"
	WRITE "<TD WIDTH=60%>"
	WRITE "<B>"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32600)_" ("_$$^WWWTEXT(32047)_": "_YAUF_")"  ;WARENHERKNFTE FESTLEGEN (AUFTRAG)
	WRITE "</B>"
	WRITE "</TD>"
	
	WRITE "<TD WIDTH=20%>"
	WRITE "&nbsp;"
	WRITE "</TD></TR>"
	
	WRITE "</TABLE>"
	KILL ^WWWSOR(YUSER)
	DO ^WWWFRAME(2)  ;TABLE AN  ;upon 
	DO KOPF
	IF SORT=1 DO SUCH1  ;SORTIERUNG NACH ARTIKELTEILE ;sorting within 
	IF SORT=2 DO SUCH2  ;SORTIERUNG NACH WARENGRUPPE ;sorting within 
	IF ANZM=0 DO ZEILE  ;LEERZEILE ;blank line  ;blank line shiny 
	DO ^WWWFRAME(1)    ;TABLE AUS ;out of 
	KILL ^WWWSOR(YUSER)
	WRITE YCR
	WRITE "<BR>"
	QUIT
	
SUCH1 ;
	SET ANZM=0
	;SUCHEN TEILE DES AUFTRAGS ;seek 
	IF YAUF'="" DO:YPOS'=""  IF YPOS="" FOR  SET YPOS=$ORDER(^INAUFP(YM,YAUF,YPOS)) QUIT:YPOS=""  DO
	. IF $DATA(^INAUFPT(YM,YAUF)) IF ANZM'=0 DO ZEILE
	. 
	. SET YTEIL="" DO  ;HAUPTPOSITION
	. . SET BESTELLUNG=0
	. . SET YPOS1=$GET(^INAUFP(YM,YAUF,YPOS,1))
	. . SET YAART=+$PIECE(YPOS1,Y,26)
	. . ;IF YAART'=0 IF YAART'=1 IF YAART'=4 IF YAART'=3 QUIT
	. . QUIT:YAART=2
	. . QUIT:$PIECE(YPOS1,Y,7)=3  ;EIGENFERTIGUNG (NUR UNTERTEILE ANZEIGEN)
	. . QUIT:$PIECE(YPOS1,Y,7)=4  ;DIENSTLEISTUNG
	. . IF $PIECE(YPOS1,Y,7)=1 SET BESTELLUNG=1  ;BESTELLUNG ;sales order 
	. . DO ANZ  ;POSITION
	. ;
	. SET YTEIL=""
	. FOR  SET YTEIL=$ORDER(^INAUFPT(YM,YAUF,YPOS,YTEIL)) QUIT:YTEIL=""  DO
	. . IF DETAIL=0 IF $EXTRACT($ORDER(^INAUFPT(YM,YAUF,YPOS,YTEIL)),1,$LENGTH(YTEIL))'=YTEIL QUIT  ;NUR FERTIGUNGSTEILE ANZEIGEN;FIS;07.01.04;24889
	. . SET YPOS1=$GET(^INAUFPT(YM,YAUF,YPOS,YTEIL,1))
	. . SET YAART=$PIECE(YPOS1,Y,26)
	. . ;IF YAART'=0 IF YAART'=1 IF YAART'=4 IF YAART'=3  QUIT
	. . QUIT:YAART=2
	. . IF $PIECE(YPOS1,Y,7)=0 SET $PIECE(YPOS1,Y,7)=3  ;FERTIGUNG
	. . DO ANZ  ;TEILE
	
	QUIT
	
SUCH2
	;-------------------------------------------------------------------------------
	; NACH WARENGRUPPEN ;within 
	;
	; Params:
	;
	; ByRefs:
	;
	; Returns:
	;
	; History:
	; 27-Nov-2006	JW		BR014285: Item group change
	;-------------------------------------------------------------------------------
	SET ANZM=0
	KILL ^WWWSOR(YUSER,"SUCH")
	
	;SUCHEN TEILE DES AUFTRAGS ;seek 
	IF YAUF'="" DO:YPOS'=""  IF YPOS="" FOR  SET YPOS=$ORDER(^INAUFP(YM,YAUF,YPOS)) QUIT:YPOS=""  DO
	. SET BESTELLUNG=0
	. SET YTEIL=""
	. FOR  SET YTEIL=$ORDER(^INAUFPT(YM,YAUF,YPOS,YTEIL)) QUIT:YTEIL=""  DO
	. . IF DETAIL=0 IF $EXTRACT($ORDER(^INAUFPT(YM,YAUF,YPOS,YTEIL)),1,$LENGTH(YTEIL))'=YTEIL QUIT  ;NUR FERTIGUNGSTEILE ANZEIGEN;FIS;07.01.04;24889
	. . SET YPOS1=$GET(^INAUFPT(YM,YAUF,YPOS,YTEIL,1))
	. . SET YAART=$PIECE(YPOS1,Y,26)
	. . ;IF YAART'=0 IF YAART'=1 IF YAART'=4 QUIT
	. . QUIT:YAART=2
	. . IF $PIECE(YPOS1,Y,7)=0 SET $PIECE(YPOS1,Y,7)=3  ;FERTIGUNG
	. . IF $PIECE(YPOS1,Y,7)=1 SET BESTELLUNG=1  ;BESTELLUNG ;sales order 
	. . ;
	. . SET WAGR=""  ;WARENGRUPPE
	. . IF $PIECE(YPOS1,Y,4)'="" SET WAGR=$PIECE(^INART(YM,$PIECE(YPOS1,Y,4),1),Y,30)
	. . IF WAGR="" SET WAGR=$PIECE(^INVORG(YM,YM,1),Y,13)
	. . IF WAGR="" SET WAGR=0
	. . IF $PIECE(YPOS1,Y,4)'="" SET ^WWWSOR(YUSER,"SUCH",WAGR,$PIECE(YPOS1,Y,4),YAUF,YPOS,YTEIL)=YPOS1  ;SPEICHERN POSITION ;Save 
	
	;GESPEICHERTE ARTIKEL LISTEN ;item 
	SET WAGR=""
	FOR  SET WAGR=$ORDER(^WWWSOR(YUSER,"SUCH",WAGR)) QUIT:WAGR=""  DO
	. ;
	. ;ÜBERSCHRIFT WARENGRUPPE ;superscription 
	. WRITE "<TR>"
	. SET YDDSATZ=YDDSATZ+1
	. FOR YI=1:1:2 DO
	. . WRITE "<TD NOWRAP VALIGN=TOP"
	. . IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . WRITE ">"
	. . WRITE "<FONT SIZE=2>"
	. . WRITE "&nbsp;"
	. . WRITE "</TD>"
	. . WRITE YCR
	. ;
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE ">"
	. WRITE "<FONT SIZE=2><B>"
	. //IF $DATA(^INPARA(YM,"WARENGRUPPE",SPRACHE,WAGR)) WRITE $PIECE($GET(^INPARA(YM,"WARENGRUPPE",SPRACHE,WAGR,1)),Y,1)
	. write $$GetDescription^INDItemGroup(WAGR)	//BR014285
	. WRITE "&nbsp;"
	. WRITE "</B></FONT>"
	. WRITE "</TD>"
	. WRITE YCR
	. FOR YI=1:1:6 DO
	. . WRITE "<TD NOWRAP VALIGN=TOP"
	. . IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . WRITE ">"
	. . WRITE "<FONT SIZE=2>"
	. . WRITE "&nbsp;"
	. . WRITE "</TD>"
	. . WRITE YCR
	. ;
	. SET ART=""
	. FOR  SET ART=$ORDER(^WWWSOR(YUSER,"SUCH",WAGR,ART)) QUIT:ART=""  DO
	. . SET SUM(ART)=0
	. . SET YAUF=""
	. . FOR  SET YAUF=$ORDER(^WWWSOR(YUSER,"SUCH",WAGR,ART,YAUF)) QUIT:YAUF=""  DO
	. . . SET YPOS=""
	. . . FOR  SET YPOS=$ORDER(^WWWSOR(YUSER,"SUCH",WAGR,ART,YAUF,YPOS)) QUIT:YPOS=""  DO
	. . . . SET YTEIL=""
	. . . . FOR  SET YTEIL=$ORDER(^WWWSOR(YUSER,"SUCH",WAGR,ART,YAUF,YPOS,YTEIL)) QUIT:YTEIL=""  DO
	. . . . . SET YPOS1=$GET(^WWWSOR(YUSER,"SUCH",WAGR,ART,YAUF,YPOS,YTEIL))
	. . . . . SET SUM(ART)=SUM(ART)+$PIECE(YPOS1,Y,39)
	. . . . . DO ANZ
	
	KILL ^WWWSOR(YUSER,"SUCH")
	QUIT
	
ANZ ;ANZEIGEN DER WH AUS POSITIONEN ;display the out of 
	; History:
	; 
	; 21-Oct-2008	HQN		SR16006: Get AvaialableQty instead of OnHandQty
	;+++++++++++++++++++++++++++++++++++++++
	;	YPOS1	either	objINAUFP
	;			or		objINAUFPT
	;+++++++++++++++++++++++++++++++++++++++
	
	NEW YBACK,YKEY,YFORM,WERTE
	
	QUIT:$PIECE(YPOS1,Y,4)=""  ;KEIN ARTIKEL ;no item 
	
	SET ART=$PIECE(YPOS1,Y,4)
	;SET BESTAND=$$^INARTMENGE(ART)  ;GESAMT MENGE
	SET WERTE=$GET(^WWWSOR(YUSER,"WERTE",ART))
	IF WERTE'="" DO
	. SET BESTAND   = $PIECE(WERTE,Y,1)
	. SET LIEF      = $TRANSLATE($PIECE(WERTE,Y,2),"|",Y)
	. SET AUFTRAG   = $PIECE(WERTE,Y,3)
	. SET LAGERBEST = $PIECE(WERTE,Y,4,99)
	
	IF WERTE="" DO
	. ;SET LAGERBEST=$$^INARTMENGE(ART,1,YLOCATION)  ;GESAMT MENGE + LAGERPLÄTZE ;total quantity 
	. SET LAGERBEST=$$GetQty^INARTMENGE(ART,1,YLOCATION,$$$NO,0,$$$NO,$$$YES) ; SR16006 21-Oct-2008
	. SET BESTAND=+$PIECE(LAGERBEST,"#",1)
	. SET LIEF=$$^INARTLIEF(ART,5)  ;LETZTEN LIEFERANEN
	. SET AUFTRAG=$$^INARTAUF(ART)  ;AUFTRAGSMENGE EINES ARTIKELS
	. SET WERTE=BESTAND_Y_$TRANSLATE(LIEF,Y,"|")_Y_AUFTRAG_Y_LAGERBEST
	. SET ^WWWSOR(YUSER,"WERTE",ART)=WERTE
	
	DO
	. NEW YKEY
	. SET YLINK="<A"
	. SET YLINK=YLINK_" TITLE="_""""_YAUF_","_YPOS_","_YTEIL_""""
	. SET YLINK=YLINK_" HREF="_""""_YAKTION_"EP=WWWFORM"
	. IF YTEIL=""  SET YLINK=YLINK_"&YFORM="_"INAUFWH"_"&YKEY="_YAUF_","_YPOS_"&YBACK=INAUF,"            QUIT
	.;IF YTEIL=""  SET YLINK=YLINK_"&YFORM="_"INAUFPT1"_"&YKEY="_YAUF_","_YPOS_"&YBACK=INAUF,"           QUIT
	. IF YTEIL'="" SET YLINK=YLINK_"&YFORM="_"INAUFPT0"_"&YKEY="_YAUF_","_YPOS_","_YTEIL_"&YBACK=INAUF," QUIT
	
	;KEIN BESTAND/KEINE WH/KEINE BESTELLUNG ;no sales order 
	;---------------------------------------
	SET COLOR=""
	DO
	. SET YAART=$PIECE(YPOS1,Y,26)
	. ;IF YAART'=0 IF YAART'=1 IF YAART'=4 QUIT
	. IF $PIECE(YPOS1,Y,7)="" IF BESTAND<$PIECE(YPOS1,Y,39)                             SET COLOR="ORANGE"
	. IF $PIECE(YPOS1,Y,7)="" IF BESTAND<$PIECE(YPOS1,Y,39) IF +$PIECE(AUFTRAG,"/",3)=0 SET COLOR="RED"
	
	SET ANZM=ANZM+1
	WRITE "<TR>"
	SET YDDSATZ=YDDSATZ+1
	
	;MENGE ;quantity 
	;---------------------------------------
	WRITE "<TD NOWRAP ALIGN=RIGHT VALIGN=TOP"
	IF COLOR="" IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF COLOR'="" WRITE " BGCOLOR="_COLOR  
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE YCR
	IF BESTELLUNG'=1 DO
	. WRITE YLINK
	. DO ^WWWCGI
	. WRITE """"
	. IF YTARGET'="" WRITE " TARGET="_YTARGET
	. WRITE ">"
	WRITE $$^WWWZAHL($PIECE(YPOS1,Y,39),0,$LENGTH($PIECE($PIECE(YPOS1,Y,39),".",2)))
	WRITE "&nbsp;"
	;MENGENEINHEIT
	IF +$PIECE(YPOS1,Y,46)=0 SET $PIECE(YPOS1,Y,46)=+$PIECE(YPOS1,Y,40)  ;VERKAUFSEINHEIT=MENGENEINHEIT
	IF +$PIECE(YPOS1,Y,46)=0 SET $PIECE(YPOS1,Y,46)=1  ;STUECK
	IF '$DATA(^WWW101(0,"EINHEIT",SPRACHE,+$PIECE(YPOS1,Y,46),1)) SET $PIECE(YPOS1,Y,46)=1  ;STUECK
	;IF +$PIECE(YPOS1,Y,46)'=0 WRITE $PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,+$PIECE(YPOS1,Y,46),1)),Y,1)  ;EINHEIT ;unity 
	WRITE $PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,+$PIECE(YPOS1,Y,46),1)),Y,1)  ;EINHEIT ;unity 
	IF SORT=2 IF $DATA(SUM(ART)) DO
	. QUIT:SUM(ART)=0
	. WRITE "<BR>"
	. WRITE "("
	. WRITE $$^WWWZAHL(SUM(ART),0,$LENGTH($PIECE(SUM(ART),".",2)))
	. WRITE "&nbsp;"
	. ;MENGENEINHEIT
	. ;IF +$PIECE(YPOS1,Y,46)=0 SET $PIECE(YPOS1,Y,46)=+$PIECE(YPOS1,Y,40)  ;VERKAUFSEINHEIT=MENGENEINHEIT
	. ;IF +$PIECE(YPOS1,Y,46)=0 SET $PIECE(YPOS1,Y,46)=1  ;STUECK
	. IF '$DATA(^WWW101(0,"EINHEIT",SPRACHE,+$PIECE(YPOS1,Y,46),1)) SET $PIECE(YPOS1,Y,46)=1  ;STUECK
	. ;IF +$PIECE(YPOS1,Y,46)'=0 WRITE $PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,+$PIECE(YPOS1,Y,46),1)),Y,1)  ;EINHEIT ;unity 
	. WRITE $PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,+$PIECE(YPOS1,Y,46),1)),Y,1)  ;EINHEIT ;unity 
	. WRITE ")"
	
	IF BESTELLUNG'=1 WRITE "</A>"
	WRITE "</TD>"
	
	;ARTIKEL NUMMER ;item numeral 
	;---------------------------------------
	WRITE "<TD NOWRAP ALIGN=RIGHT VALIGN=TOP"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE 
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF $PIECE(YPOS1,Y,4)'="" IF $DATA(^INARTT(YM,$PIECE(YPOS1,Y,4))) WRITE "<B>"
	WRITE YCR
	IF BESTELLUNG'=1 DO
	. WRITE YLINK
	. DO ^WWWCGI
	. WRITE """"
	. IF YTARGET'="" WRITE " TARGET="_YTARGET
	. WRITE ">"
	SET ART=$PIECE(YPOS1,Y,4)
	WRITE ART
	IF BESTELLUNG'=1 WRITE "</A>"
	WRITE "&nbsp;"
	WRITE "</TD>"
	
	;BEZEICHNUNG ;notation 
	;---------------------------------------
	WRITE "<TD NOWRAP VALIGN=TOP"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF $PIECE(YPOS1,Y,4)'="" IF $DATA(^INARTT(YM,$PIECE(YPOS1,Y,4))) WRITE "<B>"
	IF $PIECE(YPOS1,Y,66)=1 WRITE "<FONT COLOR=RED>"      ;ARTIKEL ;item 
	IF $PIECE(YPOS1,Y,66)=2 WRITE "<FONT COLOR=ORANGE>"   ;ACHTUNG ;estimation 
	IF $PIECE(YPOS1,Y,66)=3 WRITE "<FONT COLOR=GREEN>"
	
	IF BESTELLUNG'=1 DO
	. WRITE YLINK
	. DO ^WWWCGI
	. WRITE """"
	. IF YTARGET'="" WRITE " TARGET="_YTARGET
	. WRITE ">"
	
	WRITE $PIECE(YPOS1,Y,1)
	IF BESTELLUNG'=1 WRITE "</A>"
	WRITE "&nbsp;"
	WRITE "</TD>"
	
	;WARENHERKUNFT
	;---------------------------------------
	WRITE "<TD NOWRAP VALIGN=TOP ALIGN=LEFT"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF $PIECE(YPOS1,Y,66)=1 WRITE "<FONT COLOR=RED>"
	IF $PIECE(YPOS1,Y,66)=2 WRITE "<FONT COLOR=ORANGE>"
	IF $PIECE(YPOS1,Y,66)=3 WRITE "<FONT COLOR=GREEN>"
	
	IF BESTELLUNG'=1 DO
	. WRITE YLINK
	. DO ^WWWCGI
	. WRITE """"
	. IF YTARGET'="" WRITE " TARGET="_YTARGET
	. WRITE ">"
	
	;IF $PIECE(YPOS1,Y,7)="" IF YTEIL'="" IF $PIECE(YPOS1,Y,4)'="" IF $DATA(^INARTT(YM,$PIECE(YPOS1,Y,4))) SET $PIECE(YPOS1,Y,7)=3  ;WENN KEINE WH UND ABER TEILE
	IF $PIECE(YPOS1,Y,7)="" IF YTEIL'="" DO  ;WENN KEINE WH ABER TEILE IM AUFTRAG ;FIS;07.01.04;24889
	. SET $PIECE(YPOS1,Y,7)=2                ;LAGER ;stock location 
	. IF $EXTRACT($ORDER(^INAUFPT(YM,YAUF,YPOS,YTEIL)),1,$LENGTH(YTEIL))=YTEIL SET $PIECE(YPOS1,Y,7)=3  ;FERTIGUNG
	
	DO
	. IF BESTAND<$PIECE(YPOS1,Y,39)!(YTEIL="") IF $PIECE(YPOS1,Y,7)="" WRITE "- - - - -" QUIT  ;WENN KEIN WH UND KEINE MENGE ;when no And no quantity 
	. IF YTEIL'="" IF $PIECE(YPOS1,Y,7)="" SET $PIECE(YPOS1,Y,7)=2  ;GGF LAGERGESTAND WENN KEIN WH ABER BESTAND ;when no yet 
	
	IF +$PIECE(YPOS1,Y,7)'=0 DO
	. ;W $P(YPOS1,Y,7)," "   ;WENN MIT PARAMETERNUMMER
	. WRITE $PIECE($GET(^WWW101(0,"WARENHERKUNFT",SPRACHE,$PIECE(YPOS1,Y,7),1)),Y,1)
	
	WRITE "</A>"
	WRITE "&nbsp;"
	WRITE "</TD>"
	
	;FERTIGUNGSTERMIN
	;---------------------------------------
	WRITE "<TD NOWRAP ALIGN=RIGHT VALIGN=TOP"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE YCR
	IF BESTELLUNG'=1 DO
	. WRITE YLINK
	. DO ^WWWCGI
	. WRITE """"
	. IF YTARGET'="" WRITE " TARGET="_YTARGET
	. WRITE ">"
	
	WRITE $$^WWWDATE($PIECE(YPOS1,Y,168))
	WRITE "&nbsp;"
	IF BESTELLUNG'=1 WRITE "</A>"
	WRITE "</TD>"
	
	;BESTAND
	;---------------------------------------
	WRITE "<TD NOWRAP ALIGN=RIGHT VALIGN=TOP"
	IF COLOR="" IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF COLOR'="" WRITE " BGCOLOR="_COLOR   
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	
	;WRITE YLINK
	IF BESTELLUNG'=1 DO
	. WRITE "<A"
	. IF BESTAND>0 DO
	. . WRITE " TITLE="_""""
	. . IF $PIECE($GET(^INVORG(YM,YM,1)),Y,70)=1 WRITE $$^WWWTEXT(33690)_": "_$$^INATP1(ART,,,,1)_YCR  ;ATP MENGE;FIS;01.12.03;24599
	. . FOR YA=1:1:99 QUIT:$PIECE($PIECE(LAGERBEST,"#",2),";",YA,99)=""  DO
	. . . SET BEST1=$PIECE($PIECE(LAGERBEST,"#",2),";",YA)
	. . . IF YA=1 WRITE $$^WWWTEXT(31407)_" / "_$$^WWWTEXT(32054)_" / "_$$^WWWTEXT(32671)  ;MENGE/LAGERPLATZ/LAGERPLATZHINWEIS
	. . . WRITE YCR
	. . . WRITE $$^WWWZAHL($PIECE(BEST1,"*",1),0,$LENGTH($PIECE($PIECE(BEST1,"*",1),".",2)))  ;LAGERMENGE
	. . . WRITE " / "
	. . . WRITE $PIECE(BEST1,"*",2)  ;LAGERPLATZ   ;stock location 
	. . . WRITE " / "
	. . . DO
	. . . . NEW TXT,WE
	. . . . SET WE=""
	. . . . FOR  SET WE=$ORDER(^INWE(YM,ART,YLOCATION,$PIECE(BEST1,"*",2),WE)) QUIT:WE=""  DO
	. . . . . SET TXT=$PIECE($GET(^INWE(YM,ART,YLOCATION,$PIECE(BEST1,"*",2),WE,1)),Y,9)
	. . . . . QUIT:TXT=""
	. . . . . WRITE TXT,"&nbsp;"  ;LAGERPLATZHINWEIS
	. . ;
	. . WRITE """"
	. ;
	. IF BESTAND'>0 WRITE " TITLE="_""""_$$^WWWTEXT(31407)_": "_BESTAND_""""
	. WRITE " HREF="_""""_YAKTION_"EP=WWWFORM"
	. IF YTEIL=""  WRITE "&YFORM="_"INAUFWH"_"&YKEY="_YAUF_","_YPOS_"&YBACK="
	. IF YTEIL'="" WRITE "&YFORM="_"INAUFPT0"_"&YKEY="_YAUF_","_YPOS_","_YTEIL_"&YBACK="
	. DO ^WWWCGI
	. WRITE """"
	. IF YTARGET'="" WRITE " TARGET="_YTARGET
	. WRITE ">"
	
	WRITE BESTAND
	IF BESTELLUNG'=1 WRITE "</A>"
	WRITE "&nbsp;"
	WRITE "</TD>"
	
	;MENGE AUFTRÄGE ;order quantity 
	;---------------------------------------
	WRITE "<TD VALIGN=TOP ALIGN=RIGHT"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF $PIECE(YPOS1,Y,66)=1 WRITE "<FONT COLOR=RED>"
	IF $PIECE(YPOS1,Y,66)=2 WRITE "<FONT COLOR=ORANGE>"
	IF $PIECE(YPOS1,Y,66)=3 WRITE "<FONT COLOR=GREEN>"
	DO
	. NEW YKEY
	. SET YKEY=ART
	. WRITE "<A"
	. WRITE " TITLE="_""""_$$^WWWTEXT(32077)_"""" 
	. WRITE " HREF="_""""_YAKTION_"EP=WWWMANU&YFORM=INART&YEXEC=D|^INARTIA()"
	. SET YBACK=""  ;"INART,"
	. DO ^WWWCGI
	. WRITE """"
	. WRITE " TARGET="_YTARGET
	. WRITE ">"
	. WRITE AUFTRAG   ;AUFTRÄGSBESTAND
	. WRITE "</A>"
	
	WRITE "&nbsp;"
	WRITE "</TD>"
	
	;LIEFERANTEN
	;---------------------------------------
	WRITE "<TD NOWRAP ALIGN=RIGHT VALIGN=TOP"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF $PIECE(YPOS1,Y,66)=1 WRITE "<FONT COLOR=RED>"
	IF $PIECE(YPOS1,Y,66)=2 WRITE "<FONT COLOR=ORANGE>"
	IF $PIECE(YPOS1,Y,66)=3 WRITE "<FONT COLOR=GREEN>"
	DO
	. NEW YBACK,YKEY,YI,YA
	. SET YA=0
	. FOR YI=1:1 QUIT:$PIECE(LIEF,Y,YI,999)=""  SET LIEF1=$PIECE(LIEF,Y,YI) DO
	. . QUIT:LIEF1=""
	. . QUIT:'$DATA(^INLIEF(YM,LIEF1))
	. . SET YA=YA+1
	. . IF YA'=1 WRITE "<BR>"
	. . DO
	. . . SET YKEY=LIEF1
	. . . WRITE "<A"
	. . . WRITE " TITLE="_""""_$$^WWWTEXT(32122)_YCR_LIEF1_"""" 
	. . . WRITE " HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INLIEF"
	. . . ;S YBACK="INART,"
	. . . SET YBACK=""
	. . . DO ^WWWCGI
	. . . WRITE """"
	. . . WRITE " TARGET="_YTARGET
	. . . WRITE ">"
	. . . WRITE $EXTRACT($PIECE($GET(^INLIEF(YM,LIEF1,1)),Y,8),1,12)    ;LETZTER LIEFERANT ;last supplier 
	. . . WRITE "</A>"
	. . . WRITE "&nbsp;"
	. . ;
	. . WRITE YCR
	. . DO  ;INFO ATIKEL BEI LIEFEANT ;next to 
	. . . NEW YARTIKEL,YURL
	. . . SET YURL=$PIECE($GET(^INLIEF(YM,LIEF1,1)),Y,119)  ;URL DER ARTIKELBESTÄNDE ;URL the 
	. . . QUIT:YURL=""
	. . .;SET YARTIKEL=$TRANSLATE($PIECE($$$INARTKProductDescription($GET(^INARTK(YM,ART,LIEF1,1))),"|",1)," ")    ; D1
	. . . SET YARTIKEL=$TRANSLATE($PIECE($$$INARTKSupplierItemNo($GET(^INARTK(YM,ART,LIEF1,1))),"|",1)," ")        ; D8   ; SR12027
	. . . WRITE YCR
	. . . SET YURL=YURL_YARTIKEL
	. . . WRITE "<A HREF="
	. . . WRITE "http://"_YURL
	. . . WRITE " TARGET=ARTTIKELINFO"
	. . . WRITE ">"
	. . . WRITE YCR,"<IMG SRC="_""""_YGIF_"left.gif"_""""_" BORDER=0 TITLE='"_$$^WWWTEXT(32196)_"'></A>"
	. . . WRITE "&nbsp;"
	. ;
	. IF YA=0 WRITE "&nbsp;"  ;KEIN LIEFERANT
	
	WRITE "</TD>"
	
	;EINKAUF
	;---------------------------------------
	WRITE "<TD NOWRAP VALIGN=TOP ALIGN=RIGHT"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF $PIECE(YPOS1,Y,66)=1 WRITE "<FONT COLOR=RED>"
	IF $PIECE(YPOS1,Y,66)=2 WRITE "<FONT COLOR=ORANGE>"
	IF $PIECE(YPOS1,Y,66)=3 WRITE "<FONT COLOR=GREEN>"
	IF +$PIECE(YPOS1,Y,5)=0 SET $PIECE(YPOS1,Y,5)=1
	WRITE $$^WWWZAHL($PIECE(YPOS1,Y,47)/$PIECE(YPOS1,Y,5),10,2,YWHR)   ;SELBSTKOSTEN ;total production costs
	WRITE "&nbsp;"
	WRITE "</TD>"
	
	WRITE "</TR>",YCR
	QUIT
	
KOPF ;KOPF ZEILE ;heading 
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=RIGHT"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32025)  ;MENGE MENGENEINHEIT ;quantity 
	WRITE " "
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=RIGHT ALIGN=LEFT"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32024)  ;ARTIKEL ;item 
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT WIDTH=15%"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32026)  ;BEZEICHNUNG ;notation 
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32088)  ;WARENHERKUNFT
	WRITE " "
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=RIGHT ALIGN=LEFT"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32128)  ;Fertigungstermin ;Production Appointment
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=RIGHT ALIGN=LEFT"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32020)  ;Bestand ;Quantity
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=RIGHT"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32021)  ;Anzahl Aufträge ;Number orders 
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=RIGHT"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32022)  ;LIEFERANT ;supplier 
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP ALIGN=RIGHT"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(31409)  ;EINZELPREIS
	WRITE "</TH>"
	
	WRITE "</TR>",YCR
	QUIT
	
ZEILE ;
	WRITE "<TR>"
	SET YDDSATZ=YDDSATZ+1
	FOR YI=1:1:9 DO
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE ">"
	. WRITE "<FONT SIZE=2>"
	. WRITE "&nbsp;"
	. WRITE "</TD>"
	WRITE YCR
	
	QUIT
	
LAGER(YKEY,SORT) ;WARENHERKUNFT AUTOMATISCH FESTLEGEN (AUS LAGERBESTAND) ;automatic 
	NEW YAUF,YPOS,YTEIL,YAART,YTEIL1,BESTAND,YART,SUCH,ARTIKEL
	SET YAUF=$PIECE($GET(YKEY),",",1)
	SET YPOS=$PIECE($GET(YKEY),",",2)
	
	;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK STARTS
	;SUCHEN TEILE DES AUFTRAGS ;seek 
	;IF YAUF'="" DO:YPOS'=""  IF YPOS="" FOR  SET YPOS=$ORDER(^INAUFP(YM,YAUF,YPOS)) QUIT:YPOS=""  DO  ;TYBD 20.1.2002 NICHT NÖTIG
	. ;SET SUCH="^INAUFPXL("_""""_YM_""""_","_YAUF_","_YPOS_")"    ;24.06.04;FAN;25794;alphanumerischen UMSETZTEN
	. SET SUCH="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS_")"   ;24.06.04;FAN;25794;alphanumerischen UMSETZTEN
	. FOR  DO  QUIT:SUCH=""
	. . SET SUCH=$QUERY(@SUCH)
	. . IF $TRANSLATE($PIECE(SUCH,",",2),"""")'=YAUF SET SUCH="" QUIT  ;07.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. . ;IF $PIECE(SUCH,",",2)'=YAUF SET SUCH="" QUIT  ;07.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. . IF $PIECE(SUCH,",",3)=YPOS DO
	. . . SET YTEIL1=@SUCH
	. . . SET ARTIKEL=$PIECE(YTEIL1,Y,4)
	. . . IF ARTIKEL'="" QUIT:$DATA(^INARTT(YM,ARTIKEL))  ;NUR TEILE, DIE KEINE UNTERTEILE HABEN ;TYBD;13.06.2001
	. . . QUIT:$DATA(@SUCH)'=1                            ;NUR TEILE, DIE KEINE UNTERTEILE HABEN
	. . . SET YAART=$PIECE(YTEIL1,Y,26)
	. . . QUIT:YAART=2
	. . . ;IF YAART'=0 IF YAART'=1 IF YAART'=4 IF YAART'=3 QUIT
	. . . QUIT:$PIECE(YTEIL1,Y,7)=3  ;EIGENFERTIGUNG
	. . . QUIT:$PIECE(YTEIL1,Y,7)=4  ;DIENSTLEISTUNG
	. . . ;
	. . . SET YART=$PIECE(YTEIL1,Y,4)
	. . . SET BESTAND=$$^INARTMENGE(YART)  ;GESAMT MENGE ;total quantity 
	. . . IF $PIECE(YTEIL1,Y,39)'>BESTAND DO
	. . . . IF +$PIECE(@SUCH,Y,7)=0 SET $PIECE(@SUCH,Y,7)=2  ;WH AUS LAGERBESTAND ;out of 
	. ;
	. ;ÜBERTRAGEN IN INAUFPT ;transport within 
	. SET YAUFTRAG=YAUF
	. SET SATZ=$GET(^INAUFP(YM,YAUFTRAG,YPOS,1))
	. DO ^INAUFTEILE(YAUFTRAG,YPOS)  ;AUFBEREITUNG INAUFPT
	;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK ENDS
	
	DO ^INAUFPTBINF(YKEY,SORT)
	QUIT
	
]]></Routine>
</Export>