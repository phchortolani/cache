<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDRUCKXML6P" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INDRUCKXML6P
#include INConst
#include WWWConst
#include COMSYS
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		DRUCKEN POSITION XML
	;		Print Line XML
	;
	; Called By : ^INDRUCKXML6
	; 
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 19-Jan-2007	GRF		SR12027: Use strSupDesc to combine supplier description
	; 							with supplier number as presented previously.
	; 09-Jan-2007	GRF		SR12027: Original code duplicated after changed code - removed. 
	; 05-Oct-2006	RPW		SR14746: Fixed missed direct global writes.
	; 04-Sep-2006	GRF		SR12027: D1=>D8; Naked references; remove unneeded $data; quits
	; 11-AUG-2006	BEC		SR14855: P/O print format to print only the net price
	; 							even when PO display. Changes moved  block up (FROM
	; 							INVOICE to PO)                        (REVERTED JW)
	; 17-AUG-2006	BEC		SR14855: P/O print format to print only the net price
	; 							even when PO display.                 (REVERTED JW)
	; 06-Jan-2006	PO		SR14142: Pass document type to GetLineTotal
	; 21-Sep-2005	PO		SR14052: Call GetLineTotal^INAUFHTML
	; 13-Sep-2005	JW		SR13434: Remember tax code for line
	; 29-Aug-2005	Steve S	SR13107: Print Line U/M on Customer Order
	; 26-Aug-2005	Steve S	SR13245: Modified to Call INAUFHTMLPO
	; 24-Aug-2005	Steve S	SR13073: Print Supplier U/M
	; 02-Aug-2005	Steve S	SR13133: Print PO Line discounts
	; 29-Jul-2005	JW		SR12992: Use COMTAX
	; 19.06.2002	DT
	;-------------------------------------------------------------------------------
	new strSupDesc
	
	;SAP-SD;TYBD;26697;3,2,2005;HIER WENN EINZELBUCHUNG;TYBD;14,3,2005
	IF $FIND(YBELEG,7) IF $PIECE(YAUFTRAG1,Y,96)'="" IF $GET(YKUNDE)'="" DO     ; split for clarity ; 04-SEP-2006
	. IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,259)'=1 IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,68)=1 DO SAP^INDRUCK6P()
	
	SET BLANKS=0   ;ZUSATZBLANKS WEGEN HTML TAG ;quibble HTML TAG 
	IF POS'=$ORDER(YAUFTRAG("")) IF $PIECE(POS1,Y,105)=1 SET YPAGEBR=1  ;MANUELLER SEITENWECHSEL
	
	IF +$PIECE(YBELEG1,Y,42)=0 IF +$PIECE(YBELEG1,Y,44)=0 IF +$PIECE(YBELEG1,Y,46)=0 IF +$PIECE(YBELEG1,Y,48)=0 IF +$PIECE(YBELEG1,Y,50)=0 IF +$PIECE(YBELEG1,Y,52)=0 IF +$PIECE(YBELEG1,Y,54)=0 IF +$PIECE(YBELEG1,Y,56)=0 IF +$PIECE(YBELEG1,Y,58)=0 QUIT  ;KEINE POSITIONEN AUSGEGEN ;no 
	
	DO XML^INDRUCK(,,,"<LINE>")
	
	; SR12992: ------------------ Determine Tax ----------------------
 	set MWST = $$INDRUCKTAX^INTAX(YBELEG,POS1,$get(YEKK),$get(YFELDPZ),$get(YKUNDE),$get(YLIEFER),.MWPO)
 	SET MWPO(MWPO)=$GET(MWPO(MWPO))
 	set MWPO(MWPO,POS) = ""			// SR13434: Remember that this line has code MWPO
 	/*	
	DO
	. ;------------------ ERMITTELN STEUERSATZ ---------------------- ;FIS;KORREKTUREN WEGEN STEUERSATZ/STEUERKENNZEICHEN;30.06.04
	. SET MWST=""
	. SET MWPO=$$$INAUFPSalesTax(POS1)  ;POSTIONS MWST-SATZ
	. IF YBELEG=3!(YBELEG=10)!(YBELEG=13) SET MWPO=$$$INAUFPKInputVATPurchase(YEKK)  ;VORSTEUER-SATZ EINKAUF
	. IF YBELEG=12 IF $PIECE($GET(YFELDPZ),Y,21)'="" SET MWPO=$PIECE(YFELDPZ,Y,21)  ;FIS;11.11.03;22349;STEUERSATZ TEILZAHLUNGSRECHNUNG
	. IF MWPO="" IF YBELEG'=3 IF YBELEG'=13 IF YBELEG'=10 SET MWPO=1  ;DFLT. 1 - 16% MWST ;Tax 
	. IF MWPO="" IF YBELEG=3!(YBELEG=10)!(YBELEG=13) SET MWPO=11  ;DFLT. 11 - 16% VST
	. DO  ;MWST NACH PLZ USA ;Tax within ZIP 
	. . NEW PLZ
	. . SET PLZ=$PIECE(YADRES,Y,12)
	. . QUIT:PLZ=""
	. . IF $PIECE($get(^INPLZ(0,PLZ,1)),Y,11)'="" SET MWPO=+$PIECE(^INPLZ(0,PLZ,1),Y,11)  ;STEUERSATZ-PARAMETER = STEUERSATZ % ;tax rate 
	. IF $$EXIST^%R("COMTAX.OBJ",$GET(YUCI)) DO  ;MWST NACH USA CITY TAX ;Tax within 
	. . NEW YTAXLOCATION,YTAX
	. . SET YTAXLOCATION=""
	. . ;IF $GET(YKUNDE)'="" SET YTAXLOCATION=$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,52)
	. . IF $GET(YKUNDE)'="" SET YTAXLOCATION=$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,54)     ;BEC;26384;14.09.04
	. . IF YTAXLOCATION="" IF $GET(YLOCATION)'="" SET YTAXLOCATION=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,52)
	. . ;IF $$IsTaxable^COMTAX($PIECE(POS1,Y,4),YTAXLOCATION)=0 QUIT    ;BEC;07.07.03;23656;WENN MWSTFUNKTION VORHANDEN IST
	. . IF $$IsTaxable^COMTAX($$$INAUFPSalesTax(POS1),YTAXLOCATION)=0 QUIT    ;BEC;07.07.03;23656;WENN MWSTFUNKTION VORHANDEN IST
	. . SET MWPO=$$CombinedTaxRate^COMTAX(1,YTAXLOCATION,+$HOROLOG,$get(YKUNDE)="")  ;COMTAX(TaxCode,TaxLocation,TransactionDate)RETURNS THE COMBINED TAX RATE
	. SET MWST=MWPO
	. IF $PIECE(YADRES,Y,17)'="" IF $PIECE(YADRES,Y,17)'=$GET(YCOUNTRY) SET MWPO=0  ;KEIN DEUTSCHLAND ;no Germany 
	. IF $PIECE(YADRES,Y,50)'="" IF '$FIND($PIECE(YADRES,Y,50),$GET(YCOUNTRY)) SET MWPO=0  ;STEUERID AUSLAND ;foreign country 
	. IF $PIECE(YADRES,Y,54)'="" IF $PIECE(YADRES,Y,54)'=1 SET MWPO=0  ;KEINE STEUER ;no tax 
	. IF $$$INKUNDETaxFreeUntil(YADRES)'="" IF $$$INKUNDETaxFreeUntil(YADRES)'<$HOROLOG SET MWPO=0  ;KEINE STEUER BIS ZUM ;no tax until 
	. IF $PIECE(YADRES,Y,54)=2 IF $PIECE(YADRES,Y,50)="" SET MWPO=MWST  ;EG OHNE UST-ID = STEUER BERECHNEN ! (PRIVATPERSON);FIS;25.03.04 ;without tax calculate 
	. ;
	. IF $PIECE(YADRES,Y,54)=1 DO  ;WENN INLAND DANN AKTUELLE STEUER;TYBD;6,10,2004;26471
	. . SET MWPO=MWST
	. . IF $PIECE(YADRES,Y,55)'="" IF $PIECE(YADRES,Y,55)'<$HOROLOG SET MWPO=0  ;KEINE STEUER BIS ZUM ;no tax until 
	. ;
	. ;IF +MWPO'=0 DO   ;PRUEFEN %SATZ
	. IF +MWPO'=0 IF $DATA(^WWW101(0,"MWST",SPRACHE,MWPO)) DO   ;PRUEFEN %SATZ;FIS;USA KENNZEICHEN NICHT ÜBERSCHREIBEN;05.05.04
	. . NEW MWST
	. . SET MWST(9)=0  ;ENDE ;termination 
	. . SET MWST(0)=+$PIECE($$$WWW101Text($GET(^WWW101(0,"MWST",SPRACHE,MWPO,1)))," ",1)
	. . SET MWST(1)="" FOR  SET MWST(1)=$ORDER(^WWW101(0,"MWST",SPRACHE,MWST(1))) QUIT:MWST(1)=""  QUIT:MWST(1)=MWPO  DO  QUIT:MWST(9)=1
	. . . SET MWST(2)=+$PIECE($$$WWW101Text($GET(^WWW101(0,"MWST",SPRACHE,MWST(1),1)))," ",1)
	. . . IF +MWST(0)=+MWST(2) SET MWPO=MWST(1) SET MWST(9)=1   ;NEUES MWSTKENNZEICHEN ;something new 
	. SET MWPO(MWPO)=$GET(MWPO(MWPO))
	. SET MWST=+$PIECE($$$WWW101Text($GET(^WWW101(0,"MWST",SPRACHE,MWPO,1)))," ",1)
	. IF +MWPO'=0 IF '$DATA(^WWW101(0,"MWST",SPRACHE,MWPO,1)) SET MWST=MWPO  ;TYBD;12.6.2003;#23656; UST NACH PLZ EINSETZTEN USA
	. ;
	. SET $$$INAUFPSalesTax(POS1)=MWPO
	. ;IF YBELEG'=12 IF YBELEG'=3 IF YBELEG'=13 IF YBELEG'=10 SET $PIECE(^INAUFP(YM,YAUFTRAG,POS,1),Y,36)=MWPO  ;SPEICHERN GENUTZTE MWST;FIS;22.03.04;25372;AUSGESCHALTET;19,10,2004;TYBD;26471
	. ;IF YBELEG=12 SET $PIECE(^INAUFPZ(YM,YAUFTRAG,YPZDATUM,1),Y,21)=MWPO  ;SPEICHERN GENUTZTE MWST;FIS;22.03.04;25372;AUSGESCHALTET;19,10,2004;TYBD;26471
	. IF YBELEG=3!(YBELEG=10)!(YBELEG=13) IF $DATA(^INAUFPK(YM,YAUFTRAG,POS)) SET $$$INAUFPKInputVATPurchase(^INAUFPK(YM,YAUFTRAG,POS,1))=MWPO  ;SPEICHERN GENUTZTE MWST;FIS;22.03.04;25372
	*/
  	
  	;NEW SHIPPEDQTY    ;BEC;SR14855;17-AUG-06;P/O print format to print only the net price even when PO diSplay. 
	DO
	. DO  ;ANZEIGEN ;give notice  ;display 
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"P",2,,POS)  ;POSITION
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",240,,$PIECE(POS1,Y,240))  ;POSITION KD
	. ;
	. ;MENGE   ;quantity 
	. SET YA(1)=$PIECE(YBELEG1,Y,42)    ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO                     ;ANZEIGEN ;give notice  ;display 
	. . ;;IF +$PIECE(POS1,Y,5)=0 QUIT   ;KEINE AUSGABE BEI MENGE 0
	. . SET YA(3)=$PIECE(POS1,Y,5)
	. . ;SET SHIPPEDQTY=YA(3)           ;BEC;SR14855;17-AUG-06;P/O print format to print only the net price even when PO diSplay. 
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",240,,$PIECE(POS1,Y,240))  ;POSITION KD
	. . ;
	. . IF $FIND($PIECE(POS1,Y,5),".") SET YA(3)=$$^WWWZAHL($PIECE(POS1,Y,5),0,$LENGTH($PIECE($PIECE(POS1,Y,5),".",2)))
	. . IF '$FIND($PIECE(POS1,Y,5),",") IF '$FIND($PIECE(POS1,Y,5),".") SET YA(3)=$$^WWWZAHL($PIECE(POS1,Y,5),5,0)
	. . DO  ;MENGE NACHLIEFERUNG ;quantity subsequent shipment 
	. . . NEW BACKORDERED,ORDERED
	. . . SET ORDERED=$PIECE(POS1,Y,322)  ;URSPR. GEPLANTE BESTELLMENGE ;ordering quantity 
	. . . IF ORDERED'="" SET ORDERED=$$^WWWZAHL(ORDERED,0,$LENGTH($PIECE(ORDERED,".",2)))
	. . . SET BACKORDERED=$PIECE(POS1,Y,323)  ;GESPLITTETE MENGE ;quantity 
	. . . IF $GET(NULLDRUCK)=1 SET YA(3)=0,BACKORDERED=$PIECE(POS1,Y,5) ;NUR ANZEIGE, KEINE LIEFERUNG
	. . . IF BACKORDERED'="" SET BACKORDERED=$$^WWWZAHL(BACKORDERED,0,$LENGTH($PIECE(BACKORDERED,".",2)))
	. . . DO XML^INDRUCK(,,,"ORDERED",ORDERED)
	. . . DO XML^INDRUCK(,,,"BACKORDERED",BACKORDERED)
	. . . DO XML^INDRUCK(,,,"SHIPPED",YA(3))
	. . ;
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",5,,YA(3))   ;MENGE   ;quantity 
	. . IF $PIECE(YBELEG1,Y,44)=1 DO  ;ANZEIGEN MENGENEINHEIT ;display 
	. . . QUIT:$PIECE(POS1,Y,40)=""
	. . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",40,,$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(POS1,Y,40),1)),Y,1))  ;MENGENEINHEIT
	. ;
	. ;BEC;25600;12.05.04;Verpackungseinheit
	. DO
	. . NEW VALUE,PACK
	. . SET VALUE=""
	. . IF $PIECE(POS1,Y,356)'="" IF $PIECE(POS1,Y,4)'="" DO
	. . . SET PACK=$GET(^INARTPACK(YM,$PIECE(POS1,Y,4),$PIECE(POS1,Y,356),1))
	. . . SET VALUE=$PIECE(PACK,Y,1)_"&nbsp;"
	. . . IF $PIECE(PACK,Y,2)'="" SET VALUE=VALUE_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(PACK,Y,2),1)),Y,1)
	. . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",356,,VALUE)    ;Verpackungseinheit ;Packing Unit 
	. ;
	. ;Artikelnr
	. SET YA(1)=$PIECE(YBELEG1,Y,54)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . SET YA(3)=$PIECE(POS1,Y,4)  ;ART-NR.:XXXXX
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",4,,YA(3))   ;ARTIKELNUMMER
	. . IF YKUNDE'="" IF $PIECE(POS1,Y,4)'="" DO
	. . . NEW ABDATUM
	. . . SET ABDATUM=$ORDER(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),+$HOROLOG+1),-1)   ;TYBD;12.04.2003;ABDATUM
	. . . QUIT:ABDATUM<10000
	. . . IF $PIECE($GET(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),ABDATUM,1)),Y,4)'="" DO  ;SONDERARTIKELNUMMER DES KUNDEN
	. . . . ;DO XML^INDRUCK(,,,"SPECIALNUMBER",$P($PIECE($GET(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),ABDATUM,1)),Y,4)," ",1))  ;27206; Kundenartikelnummer auf Beleg;fan;25.01.05
	. . . . DO XML^INDRUCK(,,,"SPECIALNUMBER",$PIECE($GET(^INKUNDEP(YM,YKUNDE,$PIECE(POS1,Y,4),ABDATUM,1)),Y,4))  ;27206; Kundenartikelnummer auf Beleg;fan;25.01.05
	. ;
	. SET YPROZM=+$PIECE($GET(^INVORG(YM,YM,1)),Y,21)
	. ;einzel preis ;price 
	. SET YA(1)=$PIECE(YBELEG1,Y,56)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . ;NEW PREIS ;price 
	. . ;SET PREIS=+$PIECE(POS1,Y,118)
	. . ;IF YBELEG=3!(YBELEG=13) DO   ;BESTELLUNG = EK ;sales order Planned Cost 
	. . ;. SET PREIS=$PIECE(YEKK,Y,47)  ;SELBSTKOSTEN
	. . ;.;SET PREIS=$PIECE(YEKK,Y,13)/$PIECE(POS1,Y,5)  ;SELBSTKOSTEN
	. . ;. IF YPROZM'=0 IF PREIS'=0 SET PREIS=$JUSTIFY(PREIS-(PREIS/100*YPROZM),0,2)   ;WENN % ABZIEHEN BEI BESTELLUNG
	. . ;QUIT:+PREIS=0
	. . ;IF YINKLMWST=1 IF YBELEG'=3 IF YBELEG'=13 SET PREIS=PREIS+$JUSTIFY(PREIS/100*MWST,0,2)  ;WENN INKL MWST!!
	. . ;SET YA(3)=$$^WWWZAHL(PREIS,10,2,YWHR)
	. . ;IF PREIS<100 IF $LENGTH($PIECE(PREIS,".",2))>2 IF +$EXTRACT($PIECE(PREIS,".",2),3,9)'=0 SET YA(3)=$$^WWWZAHL(PREIS,9,3,YWHR)
	. . NEW PREIS,NKOMMA
	. . SET PREIS=+$PIECE(POS1,Y,118)
	. . IF $PIECE($PIECE(POS1,Y,118),"@",3)'="" SET YWHRF=$PIECE($PIECE(POS1,Y,118),"@",3)  ;TYBD;3,1,2005
	. . SET NKOMMA=""
	. . IF (YBELEG=3) || (YBELEG=10) || (YBELEG=13) DO   ;BESTELLUNG = EK ;sales order Planned Cost 
	. . . SET PREIS=$PIECE(YEKK,Y,47)  ;SELBSTKOSTEN ;total production costs  ;total production costs whole 
	. . . SET NKOMMA=$PIECE(YEKK,Y,25)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . . IF +NKOMMA=0!(NKOMMA>9) SET NKOMMA=2
	. . . ;SET PREIS=$PIECE(YEKK,Y,13)/$PIECE(POS1,Y,5)  ;SELBSTKOSTEN
	. . . IF YWHRF'="" IF YWHR'=YWHR1 IF +$PIECE(YEKK,Y,68)'=0 SET PREIS=$JUSTIFY($PIECE(YEKK,Y,68)*YWHRF,0,NKOMMA)  ;X-RATE FREMDWÄHRUNG;FIS;26316;24.08.04
	. . . IF YPROZM'=0 IF PREIS'=0 SET PREIS=$JUSTIFY(PREIS-(PREIS/100*YPROZM),0,NKOMMA)   ;WENN % ABZIEHEN BEI BESTELLUNG ;when subtract next to sales order 
	. . . ;IF YWHR'=YWHR1 SET YWHRF=$PIECE(YEKK,Y,78)  ;X-RATE FREMDWÄHRUNG;FIS;26316;24.08.04
	. . ;
	. . QUIT:+PREIS=0
	. . IF YINKLMWST=1 IF YBELEG'=3 IF YBELEG'=13 SET PREIS=PREIS+$JUSTIFY(PREIS/100*MWST,0,2)  ;WENN INKL MWST!! ;when 
	. . ;IF YBELEG=3!(YBELEG=13) SET NKOMMA=$PIECE($GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,25)
	. . IF NKOMMA="" SET YA(3)=$$^WWWZAHL(PREIS,10,2,YWHR,,YWHRF)
	. . IF NKOMMA="" IF PREIS<100 IF $LENGTH($PIECE(PREIS,".",2))>2 IF +$EXTRACT($PIECE(PREIS,".",2),3,9)'=0 SET YA(3)=$$^WWWZAHL(PREIS,9,3,YWHR,,YWHRF)
	. . IF NKOMMA'="" SET YA(3)=$$^WWWZAHL(PREIS,10,NKOMMA,YWHR,,YWHRF)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . ;MENGENEINHEIT WENN KEINE MENGE UND KEIN GESAMTPREIS ;when no quantity And no 
	. . IF (+$PIECE(POS1,Y,11)'=0) || ((+$PIECE(POS1,Y,5)=0) && (+$PIECE(POS1,Y,119)=0)) IF $PIECE(POS1,Y,40)'="" SET YA(3)=YA(3)_"/"_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(POS1,Y,40),1)),Y,1)
	. . ;EINZELPREIS DRUCKEN ;print 
	. . IF $PIECE(YAUFTRAG1,Y,104)=1 QUIT  ;OHNE POSITIONSPREISE DRUCKEN ;without print 
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",118,,YA(3)) 
	. ;
	. ;GESpreis
	. SET YA(1)=$PIECE(YBELEG1,Y,58)  ;DRUCK 0/1 ;printing 
	. IF YBELEG=1!(YBELEG=10) IF +$PIECE(POS1,Y,11)'=0 DO   ;WENN ANGEBOT;NUR ALTERNATIVPOSITION = KEIN GESAMTPREIS ;when proposition only no 
	. . ;
	. . SET YA(3)=$PIECE($GET(^WWW101(0,"OPTIONAL",SPRACHE,$PIECE(POS1,Y,11),1)),Y,1)
	. . IF YA(3)="" IF YBELEG=1  SET YA(3)=$$^WWWTEXT(32180)   ;ALTERNATIV BIETEN WIR AN ;afford we upon 
	. . IF YA(3)="" IF YBELEG=10 SET YA(3)=$$^WWWTEXT(32202)   ;BIETEN SIE UNS ALTERNATIV AN ;afford they we upon 
	. . ;
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",119,,YA(3)) 
	. ;
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . NEW PREIS,NKOMMA
	. . IF (YBELEG=1) || (YBELEG=10) IF +$PIECE(POS1,Y,11)'=0 QUIT  ;WENN ALTERNATIV, DANN KEIN PREIS 
	. . ;IF +$PIECE(POS1,Y,5)=0 SET $PIECE(POS1,Y,5)=1
	. . SET PREIS=+$PIECE(POS1,Y,119)
	. . IF $PIECE($PIECE(POS1,Y,119),"@",3)'="" SET YWHRF=$PIECE($PIECE(POS1,Y,119),"@",3)  ;TYBD;3,1,2005
	. . SET NKOMMA=""
	. . IF (YBELEG=3) || (YBELEG=10) || (YBELEG=13) DO   ;BESTELLUNG = EK  ;ACHTUNG ! HIER NUR ANZEIGE !!! ÄNDERUNGEN GGF. AUCH 25 ZEILEN TIEFER !!! ;sales order Planned Cost estimation here is only Show too 
	. . . SET PREIS=$PIECE(YEKK,Y,47)                 ;SELBSTKOSTEN EINZEL ;total production costs 
	. . . ;SET PREIS=$PIECE(YEKK,Y,13)/$PIECE(POS1,Y,5)   ;SELBSTKOSTEN EINZEL
	. . . QUIT:+PREIS=0
	. . . SET NKOMMA=$PIECE(YEKK,Y,25)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . . IF (+NKOMMA=0) || (NKOMMA>9) SET NKOMMA=2
	. . . IF YPROZM'=0 IF PREIS'=0 SET PREIS=$JUSTIFY(PREIS-(PREIS/100*YPROZM),0,NKOMMA)   ;ABZIEHEN ;subtract 
	. . . SET PREIS=PREIS*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4)) ;GESAMTEK
	. . . IF YWHRF'="" IF YWHR'=YWHR1 IF +$PIECE(YEKK,Y,68)'=0 SET PREIS=$JUSTIFY(($PIECE(YEKK,Y,68)*YWHRF)*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4)),0,NKOMMA)  ;X-RATE FREMDWÄHRUNG;FIS;26316;24.08.04
	. . . SET POSTOTAL=PREIS  ;GESAMTPOSTIONSPREIS EINKAUFSPREIS
	. . ;
	. . IF YINKLMWST=1 IF YBELEG'=3 IF YBELEG'=10 IF YBELEG'=13 SET PREIS=$JUSTIFY(($PIECE(POS1,Y,118)+($PIECE(POS1,Y,118)/100*MWST))*$PIECE(POS1,Y,5),0,2)  ;WENN INKL MWST!! ;when 
	. . ;QUIT:+PREIS=0  ;KEIN PREIS ; still show cost if zero PJK/SS 22-Jun-2005 SR:12737
	. . IF NKOMMA=""  SET YA(3)=$$^WWWZAHL(PREIS,12,2,YWHR,,YWHRF)
	. . IF NKOMMA'="" SET YA(3)=$$^WWWZAHL(PREIS,12,NKOMMA,YWHR,,YWHRF)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . IF $PIECE(YAUFTRAG1,Y,104)=1 QUIT  ;OHNE POSITIONSPREISE DRUCKEN ;without print 
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",119,,YA(3)) 
	. . ;
	. . ;BEC;26360;09.08.04;PRICE INCL. UST.
	. . IF YBELEG'=3 IF YBELEG'=10 IF YBELEG'=13 SET PREIS=$JUSTIFY(($PIECE(POS1,Y,123)+($PIECE(POS1,Y,123)/100*MWST)),0,2)  ;BEC;10.09.04;26360
	. . IF NKOMMA=""  SET YA(3)=$$^WWWZAHL(PREIS,12,2,YWHR,,YWHRF)
	. . IF NKOMMA'="" SET YA(3)=$$^WWWZAHL(PREIS,12,NKOMMA,YWHR,,YWHRF)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . IF $PIECE(YAUFTRAG1,Y,104)=1 QUIT  ;OHNE POSITIONSPREISE DRUCKEN ;without print 
	. . ;
	. . DO XML^INDRUCK(,,,"PRICEINCLTAX",YA(3))
	. . DO XML^INDRUCK(,,,"TOTALLINECOST",  $justify($$GetLineTotal^INAUFHTMLPO(YAUFTRAG,POS),0,2)) ;SR12086
	. . DO XML^INDRUCK(,,,"UNITLINECOST",   $justify($$GetUnitTotal^INAUFHTMLPO(YAUFTRAG,POS),0,2)) ;SR12086
	. . DO XML^INDRUCK(,,,"LINESTOCKLOC",   $$GetStockLocations^INAUFHTML(YAUFTRAG,POS))            ;SR12042    *** 'Not Available!' bug on Reprint...
	. . DO XML^INDRUCK(,,,"LINETAXFLAG",    $$GetTaxFlag^INAUFHTML(YAUFTRAG,POS))                   ;SR11963
	. . DO XML^INDRUCK(,,,"LINEDISCOUNTS",  $$GetLineDiscounts^INAUFHTML(YAUFTRAG,POS))             ;SR11963
	. . DO XML^INDRUCK(,,,"POLINEDISCOUNTS",$$GetLineDiscounts^INAUFHTMLPO(YAUFTRAG,POS))           ;SR13133 ; 13245
	. . DO XML^INDRUCK(,,,"COLINEUNIT",     $$GetLineQty^INAUFHTML(YAUFTRAG,POS))                   ;SR13107
	. . DO XML^INDRUCK(,,,"LINEUNIT",       $$GetLineUnit^INAUFHTMLPO(YAUFTRAG,POS))                ;SR13073
	. . do XML^INDRUCK(,,,"TOTALLINEAMOUNT",$justify($$GetLineTotal^INAUFHTML(YAUFTRAG,POS,,YBELEG),0,2)) ; SR14052 ; SR14142
	. . ;
	. . ;BEC;26360;09.08.04;TAXFLAG
	. . SET YA(3)=$GET(MWPO)
	. . DO XML^INDRUCK(,,,"TAXFLAG"_$GET(MWPO),YA(3))
	. ;
	. NEW PREIS
	. SET PREIS=0
	. SET PREIS=+$PIECE(POS1,Y,119)
	. IF YINKLMWST=1 IF YBELEG'=3 IF YBELEG'=13 SET PREIS=$JUSTIFY(($PIECE(POS1,Y,118)+($PIECE(POS1,Y,118)/100*MWST))*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4)),0,2)  ;WENN INKL MWST!! ;when 
	. IF (YBELEG=3) || (YBELEG=10) || (YBELEG=13) DO    ;BEI BESTELLUNG ;next to sales order 
	. . SET PREIS=$PIECE(YEKK,Y,47)                     ;SELBSTKOSTEN EINZEL ;total production costs 
	. . ;SET PREIS=$PIECE(YEKK,Y,13)/$PIECE(POS1,Y,5)   ;SELBSTKOSTEN EINZEL
	. . QUIT:+PREIS=0
	. . SET NKOMMA=$PIECE(YEKK,Y,25)  ;FIS;18.08.04;26250;ANZAHL NK-STELLEN
	. . IF (+NKOMMA=0)!(NKOMMA>9) SET NKOMMA=2
	. . IF YPROZM'=0 IF PREIS'=0 SET PREIS=$JUSTIFY(PREIS-(PREIS/100*YPROZM),0,NKOMMA)   ;ABZIEHEN ;subtract 
	. . SET PREIS=PREIS*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4))  ;GESAMTEK
	. . IF YWHRF'="" IF YWHR'=YWHR1 IF +$PIECE(YEKK,Y,68)'=0 SET PREIS=$JUSTIFY(($PIECE(YEKK,Y,68)*YWHRF)*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4)),0,NKOMMA)  ;X-RATE FREMDWÄHRUNG;FIS;26316;24.08.04
	. ;
	. IF +$PIECE(POS1,Y,11)=0 DO  ;NICHT BEI OPTIONAL ;Not next to 
	. . QUIT:$GET(NULLDRUCK)=1
	. . SET MWPO(MWPO)=MWPO(MWPO)+PREIS
	. . SET SUMME=SUMME+PREIS
	. . SET POSSUM=POSSUM+PREIS
	. ;
	. ;lagerplatz drucken;TYBD;16,09,2003
	. IF $PIECE(YBELEG1,Y,52)=1 DO  ;LAGERPLATZ DRUCKEN ; print storage
	. . NEW BET,LAP,WE,LP,LP1,MENGE
	. . SET LP=""
	. . IF $DATA(^INWEAUF(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . SET LP1=$GET(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ ;data record 
	. . . . . . SET LP(BET,LAP)=$GET(LP(BET,LAP))+$PIECE(LP1,Y,4)
	. . ;
	. . IF $DATA(^INWEAUFALT(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . QUIT:$DATA(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ VORHANDEN ;data record on hand 
	. . . . . . SET LP1=$GET(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ ;data record 
	. . . . . . SET LP(BET,LAP)=$GET(LP(BET,LAP))+$PIECE(LP1,Y,4)
	. . ;
	. . ;LAGERPLATZ  ;storage    ; NOTE : Single site and storage used ; FIXME : Is this correct? <GRF>
	. . IF $PIECE(YBELEG1,Y,52)=1 IF $ORDER(LP(""))'="" DO
	. . . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . . SET BET="" SET BET=$ORDER(LP(BET)) QUIT:BET=""  DO
	. . . . SET LAP="" SET LAP=$ORDER(LP(BET,LAP)) QUIT:LAP=""  DO
	. . . . . DO XML^INDRUCK(,,,"STOCKLOCATION",LAP)
	. ;
	. ;SERIENNUMMER/LOT-NUMMER  ;FIS, 05.06.2001
	. IF ($PIECE(YBELEG1,Y,176)=1) || ($PIECE(YBELEG1,Y,178)=1) DO  ;SERIENNUMMER/LOTNUMMER DRUCKEN ;print 
	. . NEW BET,LAP,WE,SN,SN1,LOT,LOT1
	. . ;SET SN1=$TRANSLATE($PIECE(POS1,Y,56),",",";")
	. . ;SET LOT1=$TRANSLATE($PIECE(POS1,Y,198),",",";")
	. . SET SN1=""
	. . SET SN1(1)=$TRANSLATE($PIECE(POS1,Y,56),",",";")  ;HOLEN ALTE WERTE FÜR VERGLEICH;FIS;25127
	. . SET LOT1=""
	. . SET LOT1(1)=$TRANSLATE($PIECE(POS1,Y,198),",",";")  ;HOLEN ALTE WERTE FÜR VERGLEICH;FIS;25127
	. . IF $DATA(^INWEAUFS(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUFS(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUFS(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUFS(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . SET SN=""
	. . . . . . FOR  SET SN=$ORDER(^INWEAUFS(YM,YAUFTRAG,POS,BET,LAP,WE,SN)) QUIT:SN=""  DO
	. . . . . . . SET LOT=$PIECE($GET(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1)),Y,19)  ;LOTNUMMER
	. . . . . . . IF LOT="" SET LOT=$PIECE($GET(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1)),Y,2)  ;CHARGENNUMMER
	. . . . . . . IF LOT'="" DO
	. . . . . . . . IF LOT1="" IF '$FIND(";"_LOT1_";",";"_LOT_";") SET LOT1=LOT QUIT
	. . . . . . . . IF '$FIND(";"_LOT1_";",";"_LOT_";") SET LOT1=LOT1_";"_LOT
	. . . . . . . ;
	. . . . . . . IF SN1="" IF '$FIND(";"_SN1_";",";"_SN_";") SET SN1=SN QUIT
	. . . . . . . IF '$FIND(";"_SN1_";",";"_SN_";") SET SN1=SN1_";"_SN
	. . ;
	. . IF $DATA(^INWEAUFALTS(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUFALTS(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUFALTS(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUFALTS(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . SET SN=""
	. . . . . . FOR  SET SN=$ORDER(^INWEAUFALTS(YM,YAUFTRAG,POS,BET,LAP,WE,SN)) QUIT:SN=""  DO
	. . . . . . . SET LOT=$PIECE($GET(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE,1)),Y,19)  ;LOTNUMMER
	. . . . . . . IF LOT="" SET LOT=$PIECE($GET(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE,1)),Y,2)  ;CHARGENNUMMER
	. . . . . . . IF LOT'="" DO
	. . . . . . . . IF LOT1="" IF '$FIND(";"_LOT1_";",";"_LOT_";") SET LOT1=LOT QUIT
	. . . . . . . . IF '$FIND(";"_LOT1_";",";"_LOT_";") SET LOT1=LOT1_";"_LOT
	. . . . . . . ;
	. . . . . . . IF SN1="" IF '$FIND(";"_SN1_";",";"_SN_";") SET SN1=SN QUIT
	. . . . . . . IF '$FIND(";"_SN1_";",";"_SN_";") SET SN1=SN1_";"_SN
	. . ;
	. . IF SN1'="" IF SN1(1)'="" DO  ;VERGLEICH GGF. ÄNDERUNG DER SN;FIS;25127 ;preventive composition alteration the 
	. . . SET $PIECE(POS1,Y,56)=SN1
	. . . ;SET $PIECE(^INAUFP(YM,YAUFTRAG,POS,1),Y,56)=$PIECE(POS1,Y,56) // SR14746
	. . . DO
	. . . . NEW SATZ
	. . . . SET SATZ=$GET(^INAUFP(YM,YAUFTRAG,POS,1))
	. . . . SET $PIECE(SATZ,Y,56)=$PIECE(POS1,Y,56) // SR14746
	. . . . SET strStatus=$$$Save("INAUFP",YAUFTRAG_","_POS,SATZ,$$$YES)     // SR14746
	. . ;
	. . IF LOT1'="" IF LOT1(1)'="" DO  ;VERGLEICH GGF. ÄNDERUNG DER LOT-NR.;FIS;25127 ;preventive composition alteration the 
	. . . SET $PIECE(POS1,Y,198)=LOT1
	. . . //SET $PIECE(^INAUFP(YM,YAUFTRAG,POS,1),Y,198)=$PIECE(POS1,Y,198) // SR14746
	. . . DO
	. . . . NEW SATZ
	. . . . SET SATZ=$GET(^INAUFP(YM,YAUFTRAG,POS,1))
	. . . . set $piece(SATZ,Y,198)=$piece(POS1,Y,198) // SR4746
	. . . . SET strStatus=$$$Save("INAUFP",YAUFTRAG_","_POS,SATZ,$$$YES)     // SR14746
	. . ;
	. . ;SERIENNUMMER
	. . IF $PIECE(YBELEG1,Y,176)=1 IF SN1'="" DO
	. . . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . . SET A=YSPE
	. . . ;SET YA(1)=$PIECE(YBELEG1,Y,172)  ;DRUCK 0/1  BARCODE
	. . . SET YA(3)=$$^WWWTEXT(32116)  ;SERIENNUMMER
	. . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",56,,SN1)    ;EINSETZEN  SERIENNUMMER: XXXX,XXXX,...
	. . ;
	. . ;LOTNUMMER
	. . IF $PIECE(YBELEG1,Y,178)=1 IF $TRANSLATE(LOT1,";,")'="" DO
	. . . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . . SET A=YSPE
	. . . ;SET YA(1)=$PIECE(YBELEG1,Y,172)  ;DRUCK 0/1  BARCODE
	. . . SET YA(3)=$$^WWWTEXT(32535)  ;LOT-NUMMER
	. . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",198,,LOT1)  
	. ;
	. SET A=YSPE
	. ;TEXT
	. SET YA(1)=$PIECE(YBELEG1,Y,48)  ;DRUCK 0/1  SUCHTEXT ;printing 
	. IF YA(1)=1 DO  ;ANZEIGEN  ;NICHT ANZEIGEN  ;display Not display 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . SET YA(3)=$PIECE(POS1,Y,1)
	. . ;
	. . ;TYBD;23717;4,08,2003
	. . IF $TRANSLATE($PIECE($get(^INANGPSP(YM,YAUFTRAG,POS,SPRACHE,1)),Y,2)," ")'="" SET YA(3)=$PIECE(^INANGPSP(YM,YAUFTRAG,POS,SPRACHE,1),Y,2)     ;  04-Sep-2006
	. . IF $TRANSLATE($PIECE($get(^INAUFPSP(YM,YAUFTRAG,POS,SPRACHE,1)),Y,2)," ")'="" SET YA(3)=$PIECE(^INAUFPSP(YM,YAUFTRAG,POS,SPRACHE,1),Y,2)     ;  04-Sep-2006
	. . ;
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",1,,YA(3))
	. ;
	. ;STEUERÄNDERUNGSGRUND;FIS;20.04.04;25528
	. IF YBELEG'=3 IF YBELEG'=10 IF YBELEG'=13 DO   ;NICHT BEI BESTELLUNG ODER ANFRAGE ;Not next to sales order Or 
	. . IF $PIECE(POS1,Y,351)'="" DO
	. . . SET YA(1)=$PIECE(YBELEG1,Y,198)  ;DRUCK 0/1 ;printing 
	. . . IF YA(1)=1 DO                    ;ANZEIGEN ;give notice  ;display 
	. . . . IF $DATA(^INPARA(YM,"STEUERAENDGRUND",SPRACHE,$PIECE(POS1,Y,351))) SET $PIECE(POS1,Y,351)=$PIECE($GET(^INPARA(YM,"STEUERAENDGRUND",SPRACHE,$PIECE(POS1,Y,351),1)),Y,1)  ;FIS;26276;12.08.04;GGF. ALS PARAMETER
	. . . . SET YA(3)=$PIECE(POS1,Y,351)  ;STEUERÄNDERUNGSGRUND
	. . . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",351,,YA(3))
	. ;
	. SET A=YSPE
	. ;LIEFERANTENTEXTE AUF BESTELLUNG ;upon sales order 
	. IF (YBELEG=3) || (YBELEG=10) || (YBELEG=13) DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . QUIT:$GET(YLIEFER)=""
	. . QUIT:$PIECE(POS1,Y,4)=""
	. .;SET YA(3)=$PIECE($GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,1)                        ; 04-Sep-2006/19-Jan-2007 vvv
	. .;IF YBELEG=10 SET YA(3)=$PIECE($GET(^INANGPK(YM,YAUFTRAG,POS,1)),Y,1)
	. . set YA(3)      = $$$INAUFPKSupplierItemNumber($GET(^INAUFPK(YM,YAUFTRAG,POS,1)))    ; D8
	. . set strSupDesc = $$$INAUFPKOrderName($GET(^INAUFPK(YM,YAUFTRAG,POS,1)))             ; D1
	. . set:strSupDesc'="" YA(3) = YA(3)_"|"_strSupDesc
	. . IF YBELEG=10 SET YA(3)=$PIECE($GET(^INANGPK(YM,YAUFTRAG,POS,1)),Y,8)           ; 04-Sep-2006/19-Jan-2007 ^^^
	. . IF YA(3)="" QUIT
	. . SET YA(1)=$PIECE(YBELEG1,Y,80)  ;DRUCK 0/1  AUSFÜHRUNG ;printing execution 
	. . DO  ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",4,,YA(3))
	. ;
	. SET A=YSPE
	. ;AUSFUEHRUNG
	. SET YA(1)=$PIECE(YBELEG1,Y,80)  ;DRUCK 0/1  AUSFÜHRUNG ;printing execution 
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . ;IF YBELEG'=3 IF YBELEG'=13 QUIT:$TRANSLATE($PIECE(POS1,Y,10),"| ")'=""  ;KUNDENTEXT VORHANDEN WENN BELEG AN KUNDEN
	. . SET YA(3)=$PIECE(POS1,Y,14)
	. . IF $PIECE(POS1,Y,171)'="" DO
	. . . IF '$FIND($TRANSLATE($PIECE(POS1,Y,14)," -"),"DIN"_$PIECE(POS1,Y,171)) DO
	. . . . IF $EXTRACT(YA(3),$LENGTH(YA(3)))="|" SET YA(3)=$EXTRACT(YA(3),1,$LENGTH(YA(3))-1)
	. . . . IF $EXTRACT(YA(3),$LENGTH(YA(3)))=" " SET YA(3)=$EXTRACT(YA(3),1,$LENGTH(YA(3))-1)
	. . . . SET YA(3)=YA(3)_" DIN-"_$PIECE(POS1,Y,171)
	. . ;
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",14,,YA(3))
	. . ;
	. . ;Bec;25846;14.09.04
	. . DO      
	. . . NEW AUSF
	. . . SET AUSF=YA(3)
	. . . FOR  QUIT:$EXTRACT($REVERSE(AUSF))'="|"  do
	. . . . SET AUSF=$REVERSE($EXTRACT($REVERSE(AUSF),2,99999))
	. . . ;
	. . . SET AUSF=$$^WWWTRANSLATE(AUSF,"|","<BR><LF></LF>")      
	. . . IF AUSF'="" SET AUSF=AUSF_"<BR><LF></LF>"        ;Bec;25819;03.06.04
	. . . SET YA(3)=AUSF
	. . ;
	. . SET YA(3)=$$^WWWTRANSLATE(YA(3),"|","<BR><LF></LF>") 
	. . ;
	. . DO XML^INDRUCK(,,,"D14",YA(3))
	. . ;
	. . SET YA(3)=$LENGTH(YA(3),"<BR>")-1
	. . IF +YA(3)>0 DO
	. . . NEW YII,YIII
	. . . FOR YII=1:1:YA(3) SET YIII=$GET(YIII)_"<BR>"
	. . . SET YA(3)=$GET(YIII)
	. . . IF $GET(YIII)'="" DO XML^INDRUCK(,,,"D14-BR",YA(3))
	. ;
	. SET A=YSPE
	. ;GEWICHT ;wt. 
	. SET YA(1)=$PIECE(YBELEG1,Y,50)  ;DRUCK 0/1  GEWICHT ;printing wt. 
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . QUIT:$GET(NULLDRUCK)=1  ;KEINE MENGE ;no quantity 
	. . IF +$PIECE(POS1,Y,5)=0 SET $PIECE(POS1,Y,5)=1
	. . ;SET YA(3)=$JUSTIFY($PIECE(POS1,Y,43),0,$LENGTH($PIECE($PIECE(POS1,Y,43),".",2)))
	. . SET YA(3)=$JUSTIFY(($PIECE(POS1,Y,43)/$PIECE(POS1,Y,5)),0,$LENGTH($PIECE(($PIECE(POS1,Y,43)/$PIECE(POS1,Y,5)),".",2)))  ;FIS;2.7.04;25762;GESAMTGEWICHT IM AUFTRAG
	. . IF +YA(3)'=0 DO
	. . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",43,,YA(3))
	. . . ;SET YGGEWICHT=$GET(YGGEWICHT)+($PIECE(POS1,Y,43)*$PIECE(POS1,Y,5))
	. . . SET YGGEWICHT=$GET(YGGEWICHT)+$PIECE(POS1,Y,43)  ;FIS;2.7.04;25762;GESAMTGEWICHT IM AUFTRAG
	. ;
	. SET A=YSPE
	. ;RAHMENVERTRAGSNUMMER
	. SET YA(1)=1  ;$PIECE(YBELEG1,Y,50)  ;DRUCK 0/1  RAHMENVERTRAGSNUMMER
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . SET YA(3)=$PIECE(POS1,Y,320)
	. . IF +YA(3)'=0 DO
	. . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",320,,YA(3))
	. ;
	. ;WEITERE DATENFELDER (MULTI-SELECT)
	. DO       ;IF YBELEG=7!(YBELEG=12) DO  ;BEI RECHNUNGEN ;next to 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . NEW DAFELD,YI,FTYP
	. . SET DAFELD=$TRANSLATE($PIECE(YBELEG1,Y,180),";",",")
	. . QUIT:DAFELD=""
	. . FOR YI=1:1  QUIT:$PIECE(DAFELD,",",YI,999)=""  DO
	. . . QUIT:$PIECE(DAFELD,",",YI)=""
	. . . SET YA(3)=$PIECE($GET(^INAUFP(YM,YAUFTRAG,POS,1)),Y,$PIECE(DAFELD,",",YI))
	. . . QUIT:YA(3)=""
	. . . SET FTYP=$PIECE($GET(^WWW003(0,"INAUFP",$PIECE(DAFELD,",",YI),1)),Y,3)  ;FELDTYP
	. . . IF FTYP=1  SET YA(3)=$$^WWWDATE(YA(3))           ;DATUM ;Date 
	. . . IF FTYP=2  SET YA(3)=$PIECE($GET(^WWW100(0,"JA/NEIN",SPRACHE,YA(3),1)),Y,1)  ;JA/NEIN
	. . . IF FTYP=7  SET YA(3)=$$^WWWTIME(YA(3))           ;UHRZEIT
	. . . IF FTYP=8  SET YA(3)=$$^WWWZAHL(YA(3),0,2,YWHR)  ;WÄHRUNG ;money standard 
	. . . IF FTYP=14 SET YA(3)=$$^WWWDATE(+YA(3))_" "_$$^WWWTIME($PIECE(YA(3),",",2))  ;ZEITSTEMPEL
	. . . DO  ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",$PIECE(DAFELD,",",YI),,YA(3))
	. ;
	. ;LIEFERTERMIN IN POSITION ;time of delivery within 
	. IF $PIECE(POS1,Y,19)'="" IF $PIECE(POS1,Y,19)'=$PIECE(YAUFTRAG1,Y,19) DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . ;
	. . SET YA(1)=$PIECE(YBELEG1,Y,80)  ;DRUCK 0/1  AUSFÜHRUNG ;printing execution 
	. . DO
	. . . IF YBELEG'=3 IF YBELEG'=13 IF YBELEG'=10 IF YBELEG'=2 QUIT
	. . . ;
	. . . SET YA(2)=$$^WWWTEXT(32168)                   ;"Liefertermin:"
	. . . IF YBELEG=3!(YBELEG=10) DO                    ;LIEFERANT   ;supplier 
	. . . . IF $PIECE(YAUFTRAG1,Y,197)'="" SET YA(3)=$PIECE($GET(^WWW101(0,"LIEFERKENNZEICHEN",SPRACHE,$PIECE(YAUFTRAG1,Y,197),1)),Y,1)
	. . . . IF $PIECE(YAUFTRAG1,Y,197)'=4 IF $PIECE(YBELEG1,Y,36)'=1   SET YA(3)=$$^WWWDATE($PIECE(POS1,Y,19))
	. . . . IF ($PIECE(YAUFTRAG1,Y,197)=4) || ($PIECE(YBELEG1,Y,36)=1) SET YA(3)=$$^WWWWEEK($PIECE(POS1,Y,19),1)
	. . . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",19,,YA(3))
	. . . ;
	. . . IF YBELEG'=3 IF YBELEG'=13 IF YBELEG'=10 DO   ;KUNDE   ;customer 
	. . . . IF $PIECE(YAUFTRAG1,Y,198)'="" SET YA(3)=$PIECE($GET(^WWW101(0,"LIEFERKENNZEICHEN",SPRACHE,$PIECE(YAUFTRAG1,Y,197),1)),Y,1)
	. . . . IF $PIECE(YAUFTRAG1,Y,198)'=4 IF $PIECE(YBELEG1,Y,36)'=1   SET YA(3)=$$^WWWDATE($PIECE(POS1,Y,19))
	. . . . IF ($PIECE(YAUFTRAG1,Y,198)=4) || ($PIECE(YBELEG1,Y,36)=1) SET YA(3)=$$^WWWWEEK($PIECE(POS1,Y,19),1)
	. . . . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",19,,YA(3))
	. ;
	. ;GEFAHRSTOFFKLASSE   ;BEC;25.04.2003;23156;GEFAHRSTOFFKLASSE EINGESETZT
	. IF $PIECE(POS1,Y,4)'="" DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . IF YBELEG'=6  QUIT
	. . QUIT:$PIECE(POS1,Y,309)=1  ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET A=YSPE
	. . SET YA(1)=$PIECE(YBELEG1,Y,195)  ;DRUCK 0/1   ;printing 
	. . QUIT:YA(1)'=1
	. . NEW ART
	. . SET ART=""
	. . IF $PIECE(POS1,Y,4)'="" SET ART=$GET(^INART(YM,$PIECE(POS1,Y,4),1))
	. . QUIT:$PIECE(ART,Y,315)=""
	. . SET YA(3)="<B>"_$$^WWWFELDNAME("INART","D",315)_": "_$PIECE(ART,Y,315)  ;"GEFAHRGUTKLASSE:" _ GEFAHRSTOFF
	. . IF $PIECE(ART,Y,315)'="" IF $DATA(^INPARA(YM,"GEFAHRENKLASSE",SPRACHE,$PIECE(ART,Y,315),1)) DO
	. . . SET YA(3)=YA(3)_" "_$PIECE(^INPARA(YM,"GEFAHRENKLASSE",SPRACHE,$PIECE(ART,Y,315),1),Y,1)  ;WENN PARAMETER ;when parameter ; 04-Sep-2006
	. . SET YA(3)=YA(3)_"</B>"
	. . ]]><![CDATA[SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . DO XML^INDRUCK(,,,"GEFAHRSTOFFKLASSE",YA(3))
	. ;
	. ;URSPRUNGSLAND   ;FIS;27.09.2004;26280
	. IF $PIECE(POS1,Y,4)'="" DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1     ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . QUIT:$PIECE(POS1,Y,309)=1        ;KEIN LIEFERSCHEIN DRUCKEN ;no packing slip print 
	. . SET YA(1)=$PIECE(YBELEG1,Y,204)  ;DRUCK 0/1   ;printing 
	. . QUIT:YA(1)'=1
	. . NEW ORIGIN,BET,LAP,WE,WE1,YII,ISOALPHA2
	. . SET ORIGIN=""
	. . IF $DATA(^INWEAUF(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . SET WE1=$GET(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ ;data record 
	. . . . . . IF $PIECE(WE1,Y,112)'="" IF '$FIND(";"_ORIGIN_";",";"_$PIECE(WE1,Y,112)_";") SET ORIGIN=ORIGIN_";"_$PIECE(WE1,Y,112)_";"
	. . ;
	. . IF $DATA(^INWEAUFALT(YM,YAUFTRAG,POS)) DO
	. . . SET BET=""
	. . . FOR  SET BET=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET)) QUIT:BET=""  DO
	. . . . SET LAP=""
	. . . . FOR  SET LAP=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP)) QUIT:LAP=""  DO
	. . . . . SET WE=""
	. . . . . FOR  SET WE=$ORDER(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . . QUIT:$DATA(^INWEAUF(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ VORHANDEN ;data record on hand 
	. . . . . . SET WE1=$GET(^INWEAUFALT(YM,YAUFTRAG,POS,BET,LAP,WE,1))  ;DATENSATZ ;data record 
	. . . . . . IF $PIECE(WE1,Y,112)'="" IF '$FIND(";"_ORIGIN_";",";"_$PIECE(WE1,Y,112)_";") SET ORIGIN=ORIGIN_";"_$PIECE(WE1,Y,112)_";"
	. . ;
	. . QUIT:ORIGIN=""
	. . SET YA(3)=""
	. . ;FOR YII=1:1  QUIT:$PIECE(ORIGIN,";",YII,99)=""  IF $PIECE(ORIGIN,";",YII)'=""  SET:YA(3)'="" YA(3)=YA(3)_", " SET YA(3)=YA(3)_$PIECE(ORIGIN,";",YII)
	. . FOR YII=1:1  QUIT:$PIECE(ORIGIN,";",YII,99)=""  IF $PIECE(ORIGIN,";",YII)'=""  DO
	. . . SET:YA(3)'="" YA(3)=YA(3)_", "
	. . . SET YA(3)=YA(3)_$PIECE(ORIGIN,";",YII)
	. . . SET ISOALPHA2=$PIECE($GET(^WWW101(0,"ISO-ALPHA-2",SPRACHE,$PIECE(ORIGIN,";",YII),1)),Y,1)
	. . . IF ISOALPHA2'="" SET YA(3)=YA(3)_"("_ISOALPHA2_")"
	. . ;
	. . DO XML^INDRUCK(,,,"URSPRUNGSLAND",YA(3))
	. ;
	. ;LIEFERANSCHRIFT AUF BESTELLUNG ;upon sales order 
	. IF (YBELEG=3) || (YBELEG=10) || (YBELEG=13) DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . NEW ADR,ADR2,YN
	. . SET ADR=""
	. . QUIT:$GET(YLIEFER)=""
	. . QUIT:$PIECE(POS1,Y,241)'=1  ;KEINE LA ;no 
	. . IF '$DATA(^INAUFPLA(YM,YAUFTRAG,POS)) IF $PIECE(YAUFTRAG1,Y,215)=1 DO  QUIT  ;BEREITS ALS KOPF ;yet when pate 
	. . . SET $PIECE(^INAUFP(YM,YAUFTRAG,POS,1),Y,241)=0  ;UMSETZTEN AUF NICHT DRUCKEN ;upon Not print 
	. . ;
	. . SET ADR=$GET(^INAUFA(YM,YAUFTRAG,6,1))               ;AUFTRAG   ;order 
	. . IF $DATA(^INAUFPLA(YM,YAUFTRAG,POS,1)) SET ADR=^INAUFPLA(YM,YAUFTRAG,POS,1)   ; 04-Sep-2006
	. . IF YBELEG=10 SET ADR=$GET(^INANGA(YM,YAUFTRAG,6,1))  ;ANGEBOT ;quote
	. . IF ADR="" DO
	. . . IF $PIECE(YAUFTRAG1,Y,1)'="" IF $DATA(^INKUNDE(YM,$PIECE(YAUFTRAG1,Y,1))) DO
	. . . . SET ADR2=$GET(^INKUNDE(YM,$PIECE(YAUFTRAG1,Y,1),1))
	. . . . FOR YN=3,4,6,7,10,12,14,16,17 SET $PIECE(ADR,Y,YN)=$PIECE(ADR2,Y,YN)
	. . ;
	. . QUIT:$TRANSLATE(ADR,Y)=""
	. . SET YA(3)=$$^INADRES(ADR,0,1)
	. . IF $TRANSLATE($PIECE(ADR,Y,17)," ")'="" DO  ;LAND (NUR WENN NICHT WIE LIEFERANT) ;rural when Not such as 
	. . . NEW AUSLAND
	. . . SET AUSLAND=0
	. . . IF $PIECE(YADRES,Y,17)="" QUIT
	. . . IF $PIECE(YADRES,Y,17)'=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,17) SET AUSLAND=1  ;AUSLAND ;foreign country 
	. . . IF $PIECE(YADRES,Y,17)'=$PIECE(ADR,Y,17) SET AUSLAND=1                               ;AUSLAND ;foreign country 
	. . . QUIT:AUSLAND=0
	. . . SET YA(3)=YA(3)_$PIECE($GET(^WWW100(0,"LAND",SPRACHE,$PIECE(ADR,Y,17),1)),Y,1)_"|"
	. . ;
	. . SET TEXT=$PIECE(YBELEG1,Y,87)  ;LIEFERANSCHRIFT
	. . DO XML^INDRUCK(,,,TEXT,YA(3))
	. ;
	. ;LIEFERVORSCHRIFT AUF BESTELLUNG ;shipping instruction upon sales order 
	. IF (YBELEG=3) || (YBELEG=10) || (YBELEG=13) DO
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . NEW LIVO
	. . SET LIVO=""
	. . QUIT:$GET(YLIEFER)=""
	. . QUIT:$PIECE(POS1,Y,4)=""
	. . SET LIVO=$PIECE($GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,71)
	. . IF YBELEG=10 SET LIVO=$PIECE($GET(^INANGPK(YM,YAUFTRAG,POS,1)),Y,71)
	. . QUIT:LIVO=""
	. . SET YA(3)=$PIECE($GET(^INVERPVOR(YM,LIVO,1)),Y,2)
	. . IF YA(3)="" QUIT
	. . SET YA(1)=$PIECE(YBELEG1,Y,86)   ;DRUCK 0/1  AUSFÜHRUNG ;printing execution 
	. . IF YA(1)=1 DO                    ;ANZEIGEN ;give notice  ;display 
	. . DO XML^INDRUCK(,,,"INFO1",YA(3))
	. ;
	. SET A=YSPE
	. ;KUNDENTEXT   BEC;24490;21.09.04; auch auf Bestellung
	. SET YA(1)=$PIECE(YBELEG1,Y,81)   ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO                    ;ANZEIGEN ;give notice  ;display 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1   ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . ;SET YA(3)=$PIECE(POS1,Y,10)   ;BEC;25724;14.05.04;
	. . DO                             ;BEC;25724;14.05.04;
	. . . NEW KUNDTEXT,YII
	. . . SET KUNDTEXT=$PIECE(POS1,Y,10)
	. . . FOR  QUIT:$EXTRACT($REVERSE(KUNDTEXT))'="|"  do
	. . . . SET KUNDTEXT=$REVERSE($EXTRACT($REVERSE(KUNDTEXT),2,99999))
	. . . ;
	. . . SET KUNDTEXT=$$^WWWTRANSLATE(KUNDTEXT,"|","<BR><LF></LF>")      
	. . . IF $PIECE(YBELEG1,Y,48)=1 IF KUNDTEXT'="" SET KUNDTEXT=KUNDTEXT_"<BR><LF></LF>"        ;Bec;25819;03.06.04
	. . . SET YA(3)=KUNDTEXT
	. . ;
	. . IF $TRANSLATE($PIECE($get(^INANGPSP(YM,YAUFTRAG,POS,SPRACHE,1)),Y,1)," ")'="" SET YA(3)=$PIECE(^INANGPSP(YM,YAUFTRAG,POS,SPRACHE,1),Y,1)     ; 04-Sep-2006
	. . IF $TRANSLATE($PIECE($get(^INAUFPSP(YM,YAUFTRAG,POS,SPRACHE,1)),Y,1)," ")'="" SET YA(3)=$PIECE(^INAUFPSP(YM,YAUFTRAG,POS,SPRACHE,1),Y,1)     ; 04-Sep-2006
	. . ;
	. . IF $TRANSLATE(YA(3),"| ")="" IF $PIECE(YBELEG1,Y,82)=1 SET YA(3)=$PIECE(POS1,Y,14)  ;WENN KEIN EINTRAG ABER GEKLICKT DANN KUNDENTEXT=AUSFÜHRUNG ;when no yet 
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",10,,YA(3))
	. . ;
	. . ;Bec;25846;14.09.04
	. . SET YA(3)=$LENGTH(YA(3),"<BR>")-1
	. . IF +YA(3)>0 DO
	. . . NEW YII,YIII
	. . . FOR YII=1:1:YA(3) SET YIII=$GET(YIII)_"<BR>"
	. . . SET YA(3)=$GET(YIII)
	. . . IF $GET(YIII)'="" DO XML^INDRUCK(,,,"D10-BR",YA(3))
	. ;
	. NEW RABTOTAL
	. SET RABTOTAL=""
	. ;
	. IF (YBELEG=3) || (YBELEG=10) || (YBELEG=13) IF $GET(NULLDRUCK)'=1 DO  QUIT  ;BESTELLUNGS RABATTE
	. . NEW YI
	. . DO XML^INDRUCK(,,,"<RABATE>")
	. . FOR YI=2:1:4 DO
	. . . QUIT:$PIECE(YEKK,Y,YI)=""  ;KEIN RABATT ;no deduction 
	. . . SET A=YSPE
	. . . ;RABATTE
	. . . SET RABZW=POSTOTAL
	. . . SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. . . IF YA(1)=1 DO                   ;ANZEIGEN RABATT ;display deduction 
	. . . . QUIT:+RABZW=0
	. . . . SET YA(3)=$PIECE(YEKK,Y,YI)
	. . . . QUIT:+YA(3)=0
	. . . . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . . . IF $PIECE(YEKK,Y,50+YI)=""  SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(31412)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT ;deduction 
	. . . . IF $PIECE(YEKK,Y,50+YI)'="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$PIECE(YEKK,Y,49+YI)   ;_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT
	. . . . IF +$PIECE(POS1,Y,11)=0 DO          ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . . . SET RABZW=RABZW-RABATT
	. . . . . SET POSTOTAL=POSTOTAL-RABATT
	. . . . . SET POSSUM=POSSUM-RABATT
	. . . . ;
	. . . . DO XML^INDRUCK(,,,"RABATTINFO"_YI,YA(3))
	. . . . DO XML^INDRUCK(,,,"DISCOUNT"_YI,$piece(YA(3),"%")_"%")      ;BEC;26396;17.09.04
	. . . . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)    ;RABATT ;deduction 
	. . . . SET RABTOTAL=$GET(RABTOTAL)+$GET(RABATT)     ;BEC;17.09.04;26396
	. . . . DO XML^INDRUCK(,,,"RABATT"_YI,YA(3))
	. . ;
	. . DO XML^INDRUCK(,,,"</RABATE>")
	. . FOR YI=5 DO       ; FIXME : FOR loop with one value  <GRF>
	. . . QUIT:+$PIECE(YEKK,Y,YI)=0  ;KEIN RABATT ;no deduction 
	. . . SET $PIECE(YEKK,Y,YI)=+$PIECE(YEKK,Y,YI)*-1  ;ZU/ABSCHLAG %
	. . . SET A=YSPE
	. . . ;RABATTE
	. . . SET RABZW=POSTOTAL
	. . . SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. . . IF YA(1)=1 DO                   ;ANZEIGEN RABATT ;display deduction 
	. . . . QUIT:+RABZW=0
	. . . . SET YA(3)=$PIECE(YEKK,Y,YI)
	. . . . QUIT:+YA(3)=0
	. . . . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . . . IF RABATT<0 SET YA(3)="+"_$JUSTIFY(YA(3)*-1,5,2)_"% "_$$^WWWTEXT(32957)_"   "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;ZUSCHL
	. . . . IF RABATT>0 SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(32958)_"   "_$$^WWWZAHL(RABZW,7,2,YWHR)     ;ABSCHL
	. . . . IF +$PIECE(POS1,Y,11)=0 DO          ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . . . SET RABZW=RABZW-RABATT
	. . . . . SET POSTOTAL=POSTOTAL-RABATT
	. . . . . SET POSSUM=POSSUM-RABATT
	. . . . ;
	. . . . DO XML^INDRUCK(,,,"RABATTINFO"_YI,YA(3))
	. . . . DO XML^INDRUCK(,,,"DISCOUNT"_YI,$piece(YA(3),"%")_"%")      ;BEC;26396;17.09.04
	. . . . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)    ;RABATT ;deduction 
	. . . . DO XML^INDRUCK(,,,"RABATT"_YI,YA(3))
	. . . . SET RABTOTAL=$GET(RABTOTAL)+$GET(RABATT)     ;BEC;17.09.04;26396
	. . ;
	. . FOR YI=6 DO       ; FIXME : FOR loop with one value  <GRF>
	. . . QUIT:+$PIECE(YEKK,Y,YI)=0  ;KEIN RABATT ;no deduction 
	. . . SET $PIECE(YEKK,Y,YI)=+$PIECE(YEKK,Y,YI)*-1  ;ZU/ABSCHLAG %
	. . . ;RABATTE
	. . . SET RABZW=POSTOTAL
	. . . SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. . . IF YA(1)=1 DO                   ;ANZEIGEN RABATT ;display deduction 
	. . . . QUIT:+RABZW=0
	. . . . SET YA(3)=$PIECE(YEKK,Y,YI)
	. . . . QUIT:+YA(3)=0
	. . . . SET RABATT=$JUSTIFY(YA(3),0,2)
	. . . . IF RABATT<0 SET YA(3)="+"_" "_$$^WWWTEXT(32957)  ;ZUSCHLAG ;surcharge 
	. . . . IF RABATT>0 SET YA(3)="-"_" "_$$^WWWTEXT(32958)  ;ABSCHLAG
	. . . . IF +$PIECE(POS1,Y,11)=0 DO          ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . . . SET RABZW=RABZW-RABATT
	. . . . . SET POSTOTAL=POSTOTAL-RABATT
	. . . . . SET POSSUM=POSSUM-RABATT
	. . . . ;
	. . . . DO XML^INDRUCK(,,,"RABATTINFO"_YI,YA(3))
	. . . . DO XML^INDRUCK(,,,"DISCOUNT"_YI,$piece(YA(3),"%")_"%")      ;BEC;26396;17.09.04
	. . . . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . . . DO XML^INDRUCK(,,,"RABATT"_YI,YA(3))
	. . . . SET RABTOTAL=$GET(RABTOTAL)+$GET(RABATT)     ;BEC;17.09.04;26396
	. . ;
	. . IF +$GET(RABTOTAL)'=0 DO
	. . . SET YA(3)=$$^WWWZAHL(RABTOTAL*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . . DO XML^INDRUCK(,,,"RABATT-TOTAL",YA(3))       ;BEC;26396;17.09.04
	. .	;
	. . ; // JW: Incorrect - POSSUM is a sum of the order line prices
	. .	;
	. .	;DO   ;BEC;SR14855;17-AUG-06;P/O print format to print only the net price even when PO diSplay. 
	. . ;. NEW UNIT,TOTAL
	. . ;. SET TOTAL=$G(POSSUM)
	. . ;. SET UNIT=""
	. . ;. IF +$GET(SHIPPEDQTY)'=0 SET UNIT=$$^WWWZAHL((TOTAL/+SHIPPEDQTY),10,2,YWHR,,YWHRF)   ;DIVIDE ERROR
	. . ;. SET TOTAL=$$^WWWZAHL((TOTAL),10,2,YWHR,,YWHRF)
	. . ;. DO XML^INDRUCK(,,,"LINEUNITPRICE",UNIT)         ;BEC;SR14855;17-AUG-06
	. . ;. DO XML^INDRUCK(,,,"LINETOTALPRICE",TOTAL)       ;BEC;SR14855;17-AUG-06
	. ;
	. ;SET A=YSPE   BEC;24490;21.09.04; auch auf Bestellungg
	. ;KUNDENTEXT
	. ;SET YA(1)=$PIECE(YBELEG1,Y,81)  ;DRUCK 0/1
	. ;
	. ;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	. ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	. . ;SET YA(3)=$PIECE(POS1,Y,10)   ;BEC;25724;14.05.04;
	. . DO      ;BEC;25724;14.05.04;
	. . . NEW KUNDTEXT,YII
	. . . SET KUNDTEXT=$PIECE(POS1,Y,10)
	. . . FOR  QUIT:$EXTRACT($REVERSE(KUNDTEXT))'="|"  do
	. . . . SET KUNDTEXT=$REVERSE($EXTRACT($REVERSE(KUNDTEXT),2,99999))
	. . . ;
	. . . SET KUNDTEXT=$$^WWWTRANSLATE(KUNDTEXT,"|","<BR><LF></LF>")      
	. . . IF $PIECE(YBELEG1,Y,48)=1 IF KUNDTEXT'="" SET KUNDTEXT=KUNDTEXT_"<BR><LF></LF>"        ;Bec;25819;03.06.04
	. . . SET YA(3)=KUNDTEXT
	. . ;
	. . IF $TRANSLATE($PIECE($get(^INANGPSP(YM,YAUFTRAG,POS,SPRACHE,1)),Y,1)," ")'="" SET YA(3)=$PIECE(^INANGPSP(YM,YAUFTRAG,POS,SPRACHE,1),Y,1)     ; 04-Sep-2006
	. . IF $TRANSLATE($PIECE($get(^INAUFPSP(YM,YAUFTRAG,POS,SPRACHE,1)),Y,1)," ")'="" SET YA(3)=$PIECE(^INAUFPSP(YM,YAUFTRAG,POS,SPRACHE,1),Y,1)     ; 04-Sep-2006
	. . ;
	. . IF $TRANSLATE(YA(3),"| ")="" IF $PIECE(YBELEG1,Y,82)=1 SET YA(3)=$PIECE(POS1,Y,14)  ;WENN KEIN EINTRAG ABER GEKLICKT DANN KUNDENTEXT=AUSFÜHRUNG ;when no yet 
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",10,,YA(3))
	. . ;
	. . ;Bec;25846;14.09.04
	. . SET YA(3)=$LENGTH(YA(3),"<BR>")-1
	. . IF +YA(3)>0 DO
	. . .NEW YII,YIII
	. . .FOR YII=1:1:YA(3) SET YIII=$GET(YIII)_"<BR>"
	. . .SET YA(3)=$GET(YIII)
	. . .IF $GET(YIII)'="" DO XML^INDRUCK(,,,"D10-BR",YA(3))
	. ;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	. ;
	. SET A=YSPE
	. ;RABATT1
	. NEW RABTOTAL
	. SET RABTOTAL=""
	. SET RABZW=$PIECE(POS1,Y,119)
	. ;IF YINKLMWST=1 I YBELEG'=3 IF YBELEG'=13 SET RABZW=$JUSTIFY(($PIECE(POS1,Y,118)/100*MWPO)*$PIECE(POS1,Y,5),0,2)  ;WENN INKL MWST!!
	. IF YINKLMWST=1 IF YBELEG'=3 IF YBELEG'=13 SET RABZW=$JUSTIFY(($PIECE(POS1,Y,118)+($PIECE(POS1,Y,118)/100*MWST))*$PIECE(POS1,Y,5)/$$^INQTYUNIT($PIECE(POS1,Y,4)),0,2)  ;WENN INKL MWST!!  ;FIS, 12.11.01
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO                   ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:+RABZW=0
	. . SET YA(3)=$PIECE(POS1,Y,121)
	. . QUIT:+YA(3)=0
	. . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(31412)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT ;deduction 
	. . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . SET RABZW=RABZW-RABATT
	. . . SET POSSUM=POSSUM-RABATT
	. . . SET RABATTEXIST=1
	. . ;
	. . DO XML^INDRUCK(,,,"DISCOUNT"_1,$piece(YA(3),"%")_"%")      ;BEC;26396;17.09.04
	. . DO XML^INDRUCK(,,,"RABATTINFO"_1,YA(3))
	. . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)      ;RABATT ;deduction 
	. . DO XML^INDRUCK(,,,"RABATT"_1,YA(3))
	. . SET RABTOTAL=+$GET(RABATT)
	. ;
	. SET A=YSPE
	. ;RABATT2
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO                   ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:+RABZW=0
	. . QUIT:$GET(NULLDRUCK)=1
	. . IF +$PIECE(YAUFTRAG1,Y,70)'=0 IF $PIECE(POS1,Y,122)'=$PIECE(YAUFTRAG1,Y,70) SET $PIECE(POS1,Y,122)=$PIECE(YAUFTRAG1,Y,70)
	. . SET YA(3)=$PIECE(POS1,Y,122)   ;RABATT ;deduction 
	. . QUIT:+YA(3)=0
	. . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . IF $PIECE(POS1,Y,125)="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(31412)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT ;deduction 
	. . IF $PIECE(POS1,Y,125)'="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$PIECE(POS1,Y,125)  ;_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT
	. . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . SET RABZW=RABZW-RABATT
	. . . SET POSSUM=POSSUM-RABATT
	. . . SET RABATTEXIST=1
	. . ;
	. . DO XML^INDRUCK(,,,"RABATTINFO"_2,YA(3))
	. . DO XML^INDRUCK(,,,"DISCOUNT"_2,$piece(YA(3),"%")_"%")      ;BEC;26396;17.09.04
	. . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . DO XML^INDRUCK(,,,"RABATT"_2,YA(3))
	. . SET RABTOTAL=$GET(RABTOTAL)+$GET(RABATT)
	. ;
	. SET A=YSPE
	. ;RABATT3  MENGENRABATT ;volume discount 
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:$GET(NULLDRUCK)=1
	. . QUIT:+RABZW=0
	. . SET YA(3)=$PIECE(POS1,Y,128)   ;RABATT ;deduction 
	. . QUIT:+YA(3)=0
	. . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . IF $PIECE(POS1,Y,129)=""  SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(31412)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT ;deduction 
	. . IF $PIECE(POS1,Y,129)'="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$PIECE(POS1,Y,129)  ;_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT
	. . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . SET RABZW=RABZW-RABATT
	. . . SET POSSUM=POSSUM-RABATT
	. . . SET RABATTEXIST=1
	. . ;
	. . DO XML^INDRUCK(,,,"RABATTINFO"_3,YA(3))
	. . DO XML^INDRUCK(,,,"DISCOUNT"_3,$piece(YA(3),"%")_"%")      ;BEC;26396;17.09.04
	. . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . DO XML^INDRUCK(,,,"RABATT"_3,YA(3))
	. . SET RABTOTAL=$GET(RABTOTAL)+$GET(RABATT)
	. ;
	. SET A=YSPE
	. ;RABATT4  MENGENRABATT ;volume discount   ;TYBD;GEEM;27277;19.2.2005
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:$GET(NULLDRUCK)=1
	. . QUIT:+RABZW=0
	. . SET YA(3)=$PIECE(POS1,Y,212)   ;RABATT ;deduction 
	. . QUIT:+YA(3)=0
	. . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . IF $PIECE(POS1,Y,213)=""  SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(31412)_" "_$$^WWWZAHL(RABZW,7,2,YWHR)      ;RABATT ;deduction 
	. . IF $PIECE(POS1,Y,213)'="" SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$PIECE(POS1,Y,213)  ;_" "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;RABATT
	. . IF +$PIECE(POS1,Y,11)=0 DO  ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . SET RABZW=RABZW-RABATT
	. . . SET POSSUM=POSSUM-RABATT
	. . . SET RABATTEXIST=1
	. . ;
	. . DO XML^INDRUCK(,,,"RABATTINFO"_4,YA(3))
	. . DO XML^INDRUCK(,,,"DISCOUNT"_4,$piece(YA(3),"%")_"%")      ;BEC;26396;17.09.04
	. . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . DO XML^INDRUCK(,,,"RABATT"_4,YA(3))
	. . SET RABTOTAL=$GET(RABTOTAL)+$GET(RABATT)
	. ;
	. SET A=YSPE
	. ;RABATT5 ZU/ABSCHLAG   ;volume discount   ;TYBD;GEEM;27277;19.2.2005
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO                   ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:$GET(NULLDRUCK)=1
	. . QUIT:+RABZW=0
	. . SET YA(3)=$PIECE(POS1,Y,214)   ;RABATT ;deduction 
	. . QUIT:+YA(3)=0
	. . SET RABATT=$JUSTIFY(RABZW/100*YA(3),0,2)
	. . IF RABATT<0 SET YA(3)="+"_$JUSTIFY(YA(3)*-1,5,2)_"% "_$$^WWWTEXT(32957)_"   "_$$^WWWZAHL(RABZW,7,2,YWHR)  ;ZUSCHL
	. . IF RABATT>0 SET YA(3)="-"_$JUSTIFY(YA(3),5,2)_"% "_$$^WWWTEXT(32958)_"   "_$$^WWWZAHL(RABZW,7,2,YWHR)     ;ABSCHL
	. . IF +$PIECE(POS1,Y,11)=0 DO          ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)-RABATT  ;MWST ;Tax 
	. . . SET RABZW=RABZW-RABATT
	. . . SET POSSUM=POSSUM-RABATT
	. . . SET RABATTEXIST=1
	. . ;
	. . DO XML^INDRUCK(,,,"RABATTINFO"_5,YA(3))
	. . DO XML^INDRUCK(,,,"DISCOUNT"_5,$piece(YA(3),"%")_"%")      ;BEC;26396;17.09.04
	. . SET YA(3)=$$^WWWZAHL(RABATT*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . DO XML^INDRUCK(,,,"RABATT"_5,YA(3))
	. . SET RABTOTAL=$GET(RABTOTAL)+$GET(RABATT)
	. ;
	. IF $PIECE(YBELEG1,Y,60)=1 DO    ;TOTAL DISCOUNT VALUE ;whole VALUE 
	. . QUIT:+$GET(RABTOTAL)=0
	. . SET YA(3)=$$^WWWZAHL(RABTOTAL*-1,12,2,YWHR)  ;RABATT ;deduction 
	. . DO XML^INDRUCK(,,,"RABATT-TOTAL",YA(3))       ;BEC;26396;17.09.04
	. ;
	. ; // JW: Incorrect - POSSUM is a sum of the order line prices
	. ; // Also, causes divide (by zero) error if SHIPPEDQTY is 0
	. ;
	. ;Do   ;BEC;SR14855;17-AUG-06;P/O print format to print only the net price even when PO diSplay. 
	. ;. NEW UNIT,TOTAL
	. ;. SET TOTAL=POSSUM
	. ;. SET UNIT=""
	. ;. ;SET UNIT=$$^WWWZAHL((TOTAL/SHIPPEDQTY),10,2,YWHR,,YWHRF)
	. ;. IF SHIPPEDQTY'=0 SET UNIT=$$^WWWZAHL((TOTAL/SHIPPEDQTY),10,2,YWHR,,YWHRF)   ;DIVIDE ERROR
	. ;. SET TOTAL=$$^WWWZAHL((TOTAL),10,2,YWHR,,YWHRF)
	. ;. DO XML^INDRUCK(,,,"LINEUNITPRICE",UNIT)         ;BEC;SR14855;17-AUG-06
	. ;. DO XML^INDRUCK(,,,"LINETOTALPRICE",TOTAL)       ;BEC;SR14855;17-AUG-06
	. ;
	. SET A=YSPE
	. ;SPEZIALZUSCHLAG
	. SET YA(1)=$PIECE(YBELEG1,Y,60)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO  ;ANZEIGEN RABATT ;display deduction 
	. . QUIT:$GET(NULLDRUCK)=1
	. . QUIT:+$PIECE(POS1,Y,211)=0  ;KEIN ZUSCHLAG ;no surcharge 
	. . IF $PIECE(POS1,Y,210)=""  SET YA(3)=$$^WWWTEXT(32351)_" "  ;ZUSTZKOSTEN
	. . IF $PIECE(POS1,Y,210)'="" SET YA(3)=$PIECE(POS1,Y,210)     ;ZUSCHLAGSBEZEICHNUNG
	. . IF $PIECE(POS1,Y,211)>0   SET YA(3)="+ "_YA(3)
	. . ;IF $PIECE(POS1,Y,211)<0 SET YA(3)="- "_YA(3)
	. . ;SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)           ;EINSETZEN;BEC;28.01.04
	. . ;SET A=$EXTRACT(A,1,$G(YA(2)))_YA(3)_$EXTRACT(A,$G(YA(2))+1+$LENGTH(YA(3)),132)   ;EINSETZEN
	. . SET YA(3)=$PIECE(POS1,Y,211)  ;ZUSCHLAG ;surcharge 
	. . IF +$PIECE(POS1,Y,11)=0 DO    ;ANZEIGEN RABATT;FIS;NICHT BEI OPTIONAL;08.04.04
	. . . SET MWPO(MWPO)=MWPO(MWPO)+YA(3)  ;MWST ;Tax 
	. . . SET RABZW=RABZW+YA(3)
	. . . SET POSSUM=POSSUM+YA(3)
	. . . SET RABATTEXIST=1
	. . ;
	. . SET YA(3)=$$^WWWZAHL(YA(3),12,2,YWHR)  ;ZUSCHLAG ;surcharge 
	. . DO XML^INDRUCK($PIECE(YDATEI,",",2),"D",210,,YA(3))
	. ;
	. ;ERSATZTEXT ANSTELLE POSITIONEN DRUCKEN ;print 
	. IF YBELEG'=12 IF $PIECE(YBELEG1,Y,187)=1 IF $PIECE(YBELEG1,Y,188)'="" DO
	. . SET A=YSPE
	. . SET YA(3)=$PIECE(YBELEG1,Y,188)
	. . IF $ORDER(YAUFTRAG(POS),-1)="" DO  ;NUR BEI 1.POSITION ;only next to 
	. . . DO XML^INDRUCK(,,,"INFO2",YA(3))
	. ;
	. ;ERSATZTEXT ANSTELLE POSITIONEN DRUCKEN ;print 
	. IF YBELEG=12 IF $PIECE(YFELDPZ,Y,13)=1 IF $PIECE(YFELDPZ,Y,18)'="" DO
	. . SET A=YSPE
	. . SET YA(3)=$PIECE(YFELDPZ,Y,18)
	. . IF $ORDER(YAUFTRAG(POS),-1)="" DO  ;NUR BEI 1.POSITION ;only next to 
	. . . DO XML^INDRUCK(,,,"INFO2",YA(3))
	. ;
	. ;ERSATZTEXT ANSTELLE POSITIONEN DRUCKEN ;print 
	. IF YBELEG=12 IF $PIECE(YFELDPZ,Y,13)=1 IF $PIECE(YFELDPZ,Y,18)="" IF $PIECE(YBELEG1,Y,188)'="" DO
	. . SET A=YSPE
	. . SET YA(3)=$PIECE(YBELEG1,Y,188)
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)     ;SPALTE ;column 
	. . IF YA(2)="" SET YA(2)=14
	. . IF $ORDER(YAUFTRAG(POS),-1)="" DO  ;NUR BEI 1.POSITION ;only next to 
	. . . DO XML^INDRUCK(,,,"INFO2",YA(3))
	. ;
	. ;SONDERTEXTE JE POSITION JE BELEG ;once once proof 
	. IF $DATA(^INAUFPC(YM,YAUFTRAG,POS,YBELEG,1)) DO
	. . SET YA(3)=$PIECE(^INAUFPC(YM,YAUFTRAG,POS,YBELEG,1),Y,1)           ; 04-Sep-2006
	. . SET YA(1)=$PIECE(YBELEG1,Y,80)       ;DRUCK 0/1  AUSFÜHRUNG ;printing execution 
	. . DO XML^INDRUCK(,,,"INFO3",YA(3))     ;ANZEIGEN ;give notice  ;display 
	
	DO XML^INDRUCK(,,,"</LINE>")  
	QUIT
	
TEILE(DEEP)   ;DRUCKEN DER TEILE ;VAIABLE POS1=TEILEDATENSATZ ;print the 
	NEW SPACE
	
	SET SPACE=DEEP*3  ;EINRUECKUNG
	DO
	. ;MENGE   ;quantity 
	. SET YA(1)=$PIECE(YBELEG1,Y,42)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO                   ;ANZEIGEN ;give notice  ;display 
	. . IF $PIECE(POS1,Y,40)=2!($PIECE(POS1,Y,40)=10)!($PIECE(POS1,Y,40)=11) IF +$PIECE(POS1,Y,45)'=0 SET $PIECE(POS1,Y,5)=$PIECE(POS1,Y,45)  ;DAUER ;permanence 
	. . IF +$PIECE(POS1,Y,5)=0 QUIT
	. . ;SET YA(3)=$TRANSLATE($PIECE(POS1,Y,5),".",",")
	. . IF $PIECE(POS1,Y,40)=2 SET $PIECE(POS1,Y,5)=$PIECE(POS1,Y,5)\60\60
	. . IF $PIECE(POS1,Y,40)=10 SET $PIECE(POS1,Y,5)=$PIECE(POS1,Y,5)\60
	. . IF $PIECE(POS1,Y,40)=11 SET $PIECE(POS1,Y,5)=$PIECE(POS1,Y,5)\100
	. . IF $FIND($PIECE(POS1,Y,5),".") SET YA(3)=$$^WWWZAHL($PIECE(POS1,Y,5),5,$LENGTH($PIECE($PIECE(POS1,Y,5),".",2)))
	. . IF '$FIND($PIECE(POS1,Y,5),",") IF '$FIND($PIECE(POS1,Y,5),".") SET YA(3)=$$^WWWZAHL($PIECE(POS1,Y,5),5,0)
	. . DO XML^INDRUCK($PIECE(YDATEI,",",5),"D",5,,YA(3))
	. . DO  ;MENGENEINHEIT
	. . . QUIT:$PIECE(POS1,Y,40)=""
	. . . SET YA(3)=$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(POS1,Y,40),1)),Y,1)
	. . . DO XML^INDRUCK($PIECE(YDATEI,",",5),"D",40,,YA(3))
	. ;
	. ;Artikelnr
	. SET YA(1)=$PIECE(YBELEG1,Y,54)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO                   ;ANZEIGEN ;give notice  ;display 
	. . SET YA(3)=$PIECE(POS1,Y,4)    ;ART-NR.:XXXXX
	. . DO XML^INDRUCK($PIECE(YDATEI,",",5),"D",4,,YA(3))
	. ;
	. DO  ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . SET YA(3)=$TRANSLATE($PIECE(POS1,Y,1),"|"," ")
	. . DO XML^INDRUCK($PIECE(YDATEI,",",5),"D",1,,YA(3))
	. ;
	. SET A=YSPE
	. ;AUSFUEHRUNG
	. SET YA(1)=$PIECE(YBELEG1,Y,48)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO                   ;ANZEIGEN ;give notice  ;display 
	. . QUIT:$TRANSLATE($PIECE(POS1,Y,10),"| ")'=""  ;KUNDENTEXT VORHANDEN ;on hand 
	. . SET YA(3)=$TRANSLATE($PIECE(POS1,Y,14),"|"," ")
	. . DO XML^INDRUCK($PIECE(YDATEI,",",5),"D",14,,YA(3))
	. ;
	. SET A=YSPE
	. ;KUNDENTEXT
	. SET YA(1)=$PIECE(YBELEG1,Y,48)  ;DRUCK 0/1 ;printing 
	. IF YA(1)=1 DO                   ;ANZEIGEN ;give notice  ;display 
	. . SET YA(3)=$TRANSLATE($PIECE(POS1,Y,10),"|"," ")
	. . DO XML^INDRUCK($PIECE(YDATEI,",",5),"D",10,,YA(3))
	
	QUIT
	
]]></Routine>
</Export>