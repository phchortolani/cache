<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDRPRUN13" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INDRPRUN13(YART,YMENGE,YLIEF,YONCE) ;INDRPRUN13;FIS;WARENANFORDERUNGEN BEI INTERNEN BETRIEBEN;27.09.2001  ; Compiled February 8, 2005 14:37:35
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		WARENANFORDERUNGEN BEI INTERNEN BETRIEBEN
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FIS	27.09.2001  
	;|
	;\------------------------------------------------------------------/
	;
	;                             CREATE WAREHOUSE ORDER
	; ERSTELLTER SUPPLY WIRD ZUM LIEFERBETRIEB ÜBERTRAGEN (IST DORT DEMAND) ;transport yonder 
	; ---------------------------------------------------------------------
	; YART=ARTIKEL
	; YMENGE=BENÖTIGTE MENGE ;quantity 
	; YLIEF=LIEFERBETRIEB
	NEW XML,YKEY,YFELD,NR,ITEM,AUF
	SET AUF=""
	SET YART=$GET(YART)
	QUIT:YART="" AUF
	SET YMENGE=+$GET(YMENGE)
	QUIT:YMENGE=0 AUF
	SET YLIEF=$GET(YLIEF)
	QUIT:YLIEF="" AUF
	IF $GET(YLOCATION)="" QUIT AUF
	SET ITEM=$GET(^INDRPITEM(YM,YLOCATION,YART,1))
	QUIT:ITEM="" AUF
	SET YFELD=""
	SET $PIECE(YFELD,Y,1)=YLIEF  ;BETRIEB (LIEFERBETRIEB) ;location 
	SET $PIECE(YFELD,Y,3)=+$HOROLOG  ;ERSTELLUNGSDATUM
	SET $PIECE(YFELD,Y,4)=YART  ;ARTIKEL ;item 
	SET $PIECE(YFELD,Y,5)=YMENGE  ;MENGE ;quantum  ;quantity
	SET $PIECE(YFELD,Y,6)=+$HOROLOG+$$LEADTIME^INATP1(YART,YLOCATION)  ;FIS;08.02.05
	;SET $PIECE(YFELD,Y,6)=+$HOROLOG  ;BEDARFSDATUM
	SET $PIECE(YFELD,Y,70)=3  ;WARENVERLAGERUNG
	SET $PIECE(YFELD,Y,71)=0  ;PRIORITÄT NORMAL ;priority normal
	SET $PIECE(YFELD,Y,8)=$PIECE($TRANSLATE($PIECE(ITEM,Y,6),",",";"),";",1)  ;ZUSTÄNDIGER MITARBEITER
	SET $PIECE(YFELD,Y,19)=0  ;RELEASED;FIS;25.04.05;SR12200
	IF $GET(BGJOB)'=1 IF $PIECE($GET(^INDRPPLANNER(YM,YLOCATION,YBED,1)),Y,2)'=1 IF $PIECE($GET(^(1)),Y,6)'=1 SET $PIECE(YFELD,Y,19)=1  ;GESPERRT ;DISABLED ;FIS;25.04.05;SR12200
	;IF $GET(BGJOB)=1 SET $PIECE(YFELD,Y,19)=1  ;GESPERRT
	IF $GET(BGJOB)=1 IF '$FIND(";"_$TRANSLATE($PIECE($GET(^INDRPSYS(YM,YLOCATION,1)),Y,43),",",";")_";",";3;") SET $PIECE(YFELD,Y,19)=1  ;GESPERRT  ;SOFORT FREIGEBEN;FIS;26350;01.09.04
	IF $GET(BGJOB)=1 IF $FIND(";"_$TRANSLATE($PIECE($GET(^INDRPSYS(YM,YLOCATION,1)),Y,43),",",";")_";",";3;") SET $PIECE(YFELD,Y,20)=+$H,$P(YFELD,Y,21)=YBED,$PIECE(YFELD,Y,7)=+$H  ;FIRM IF RELEASED IMMIDIATELY;FIS;27.04.05;SR12200
	IF +$GET(YONCE)=1 DO
	. ;;SET $PIECE(YFELD,Y,120)=$HOROLOG  ;SPEICHERN BEARBEITUNGSZEIT;FIS;08.02.05;27255;DO NOT SAVE IS SUPPLY;FIS;25.04.05;SR12200
	. SET $PIECE(YFELD,Y,111)=$PIECE(YONCE,"|",2)    ;SAVE ORDER REFERENCE;FIS;25.04.05;SR12200
	. IF $PIECE(YONCE,"|",2)'="" SET $PIECE(YFELD,Y,71)=1    ;SET PRIORITY;FIS;25.04.05;SR12200
	. QUIT
	DO
	. SET YKEY=$$^WWWNEXT("INDRPSUPPLY")
	. SET AUF=YKEY
	. SET YKEY=YLOCATION_","_YKEY
	. SET OK=$$^WWWSPEI("INDRPSUPPLY",YKEY,YFELD,1)
	. DO ^INDRPSAVES(YKEY,YFELD)  ;CREATE SUPPLY AT DESTINATION LOCATION;FIS;01.04.04 ;LOCATION 
	. QUIT
	QUIT AUF
]]></Routine>
</Export>