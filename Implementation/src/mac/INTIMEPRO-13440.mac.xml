<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INTIMEPRO" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INTIMEPRO
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		AUTRAGSÜBERSICHT PRODUKTION
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| DT	12.06.2000
	;\------------------------------------------------------------------/
	NEW START,STOP,START1,DAUER,YKEY,YFKEY,YBACK,PRODU,FZEIT,TSET,COLOR,PRIO
	
	SET YDDSATZ=$GET(YDDSATZ)+1
	SET FONTSIZE=1
	SET GESTARTET=0  ;NOCH NICHT BEGONNEN ;yet Not 
	SET NICHTALLE=0  ;NOCH NICHT ALLE ;yet Not 
	SET NICHTOK=1  ;ALLES FERTIG ;whatsoever ready-made 
	IF +$PIECE(POS1,Y,50)=0 SET $PIECE(POS1,Y,50)=1  ;DAUER ;permanence 
	SET START=$PIECE(POS1,Y,168)
	SET STOP=START
	IF $PIECE(POS1,Y,190)=1 DO STARTSTOP  ;NUR , WENN TEILE SCHON BEARBEITET WURDEN
	;I STOP<TAG Q  ;KEINE ANZEIGE, DA SCHON ABGELAUFEN, NUR WENN GEWÜNSCHT
	SET DAUER=STOP-START  ;VON BIS  ;until 
	SET FZEIT=$PIECE(POS1,Y,45)  ;FERTIGUNGSZEIT
	IF +DAUER=0 SET DAUER=1
	WRITE "<TR>"
	WRITE "<TD NOWRAP VALIGN=TOP"
	DO  ;FARBE ;tincture 
	. SET YCOLOR1="LIGHTGREY"
	. IF YLEAUF=AUF IF YLEPOS=POS                 SET YCOLOR1=" BGCOLOR=LIGHTGOLDENRODYELLOW"
	. IF YLEAUF'=AUF!(YLEPOS'=POS) IF YDDSATZ#2=1 SET YCOLOR1=" BGCOLOR="_YWHITE
	
	DO
	. IF NICHTOK=0   SET YCOLOR=" BGCOLOR=LIGHTGREEN" QUIT
	. IF NICHTALLE=1 SET YCOLOR=" BGCOLOR=YELLOW"     QUIT
	. IF +START=0    SET YCOLOR=" BGCOLOR=RED"        QUIT
	. SET YCOLOR=YCOLOR1
	
	WRITE YCOLOR
	WRITE ">"
	WRITE "<FONT SIZE="_FONTSIZE_">"
	WRITE "<A TITLE="_""""
	IF START'="" IF START<$HOROLOG WRITE $$^WWWTEXT(32128)_" "_$$^WWWDATE(START)_$CHAR(10)  ;ACHTUNG TERMIN! ;estimation 
	IF START="" WRITE $$^WWWTEXT(32128)_" ??.??.????"_$CHAR(10)  ;FERTIGUNGSTERMIN
	IF $PIECE(AUF1,Y,2)=1 WRITE $PIECE($GET(^WWW101(0,"AUFTRAGSART",SPRACHE,1,1)),Y,1)  ;EIGENAUFTRAG
	IF +$PIECE(AUF1,Y,2)=0 IF $PIECE(AUF1,Y,1)'="" WRITE $PIECE($GET(^INKUNDE(YM,$PIECE(AUF1,Y,1),1)),Y,8)
	;WRITE $CHAR(10)_"("_$P(POS1,Y,4)_") "_$PIECE(POS1,Y,1)  ;POSITION
	WRITE """"
	;WRITE " HREF="_YAKTION_"EP=WWWMANU1&YFORM=INAUFP&YEXEC=D|^INAUFPEXPL('"_AUF_","_POS_"')&YKEY="_AUF_","_POS_"&YFKEY="_AUF_"&YBACK=INTIME,"    ;EP=WWWFORM&YFORM=INAUFP&YKEY="_AUF_","_POS_"&YFKEY="_AUF_"&YBACK=INAUF,&YSEITE=2"
	WRITE " HREF="_YAKTION_"EP=WWWMANU1&YEXEC=DO|^INPROPLANANZ('"_2_"','"_AUF_"','"_POS_"')"
	DO ^WWWCGI
	;WRITE " TARGET=TEILEFRAME2"
	WRITE ">"
	WRITE AUF_"-"_POS
	WRITE "</A>"
	WRITE "&nbsp;&nbsp;"
	DO    ;-------------------------------------AUFTRAGART KURZBEZEICHUNG
	. WRITE "<A TITLE="_""""
	. IF $PIECE(AUF1,Y,2)'=1 IF $PIECE(AUF1,Y,2)'="" WRITE $PIECE($GET(^WWW101(0,"AUFTRAGSART",SPRACHE,$PIECE(AUF1,Y,2),1)),Y,1)_$CHAR(10)  ;EIGENAUFTRAG
	. IF +$PIECE(AUF1,Y,2)=0 DO   ;KUNDE ;lore  ;customer 
	. . IF $PIECE(AUF1,Y,1)'="" WRITE $EXTRACT($PIECE($GET(^INKUNDE(YM,$PIECE(AUF1,Y,1),1)),Y,8),1,17) QUIT
	. . IF $PIECE(AUF1,Y,1)=""  WRITE $PIECE(AUF1,Y,13)        
	. ;
	. IF +$PIECE(AUF1,Y,2)=1 DO  ;EIGENAUFTRAG
	. . WRITE $$^WWWTEXT(32037)  ;"EIGENAUFTRAG"
	. ;
	. IF +$PIECE(AUF1,Y,2)=2 DO  ;LIEFERANT ;purveyor  ;supplier 
	. . IF $PIECE(AUF1,Y,12)'="" SET YLIEFERANT=$EXTRACT($PIECE($GET(^INLIEF(YM,$PIECE(AUF1,Y,12),1)),Y,8),1,17) WRITE YLIEFERANT
	. . IF $PIECE(AUF1,Y,12)="" WRITE $PIECE(AUF1,Y,13)
	. ;
	. IF +$PIECE(POS1,Y,7)'=0 WRITE $CHAR(10)_$$^WWWTEXT(32042)_": "_$PIECE($GET(^WWW101(0,"WARENHERKUNFT",SPRACHE,$PIECE(POS1,Y,7),1)),Y,1)  ;WH
	. IF +$PIECE(POS1,Y,7)=0  WRITE $CHAR(10)_$$^WWWTEXT(32075)
	. WRITE """"
	. WRITE " HREF=#"
	. WRITE ">"
	. WRITE "("_$PIECE(AUF1,Y,2)_")"
	. WRITE "</A>"
	
	WRITE "</FONT>"
	WRITE "</TD>"
	
	;----------------------------------artikel
	WRITE "<TD NOWRAP VALIGN=TOP"
	DO  ;FARBE ;tincture 
	. SET YCOLOR1="LIGHTGREY"
	. IF YLEAUF=AUF IF YLEPOS=POS                 SET YCOLOR1=" BGCOLOR=LIGHTGOLDENRODYELLOW"
	. IF YLEAUF'=AUF!(YLEPOS'=POS) IF YDDSATZ#2=1 SET YCOLOR1=" BGCOLOR="_YWHITE
	
	DO
	. ;IF NICHTOK=0   SET YCOLOR=" BGCOLOR=LIGHTGREEN" QUIT
	. ;IF NICHTALLE=1 SET YCOLOR=" BGCOLOR=YELLOW"     QUIT
	. ;IF +START=0    SET YCOLOR=" BGCOLOR=RED"        QUIT
	. SET YCOLOR=YCOLOR1
	
	WRITE YCOLOR
	WRITE ">"
	WRITE "<FONT SIZE="_FONTSIZE_">"
	WRITE "("_$PIECE(POS1,Y,4)_") "_$EXTRACT($PIECE(POS1,Y,1),1,10)
	IF $EXTRACT($PIECE(POS1,Y,1),11,20)'="" WRITE "..."
	WRITE "</FONT>"
	WRITE "</TD>"
	
	;----------------------------------AUFTRAGSDATUM
	WRITE "<TD NOWRAP VALIGN=TOP"
	DO  ;FARBE ;tincture 
	. SET YCOLOR1="LIGHTGREY"
	. IF YLEAUF=AUF IF YLEPOS=POS                 SET YCOLOR1=" BGCOLOR=LIGHTGOLDENRODYELLOW"
	. IF YLEAUF'=AUF!(YLEPOS'=POS) IF YDDSATZ#2=1 SET YCOLOR1=" BGCOLOR="_YWHITE
	
	DO
	. ;IF NICHTOK=0   SET YCOLOR=" BGCOLOR=LIGHTGREEN" QUIT
	. ;IF NICHTALLE=1 SET YCOLOR=" BGCOLOR=YELLOW"     QUIT
	. ;IF +START=0    SET YCOLOR=" BGCOLOR=RED"        QUIT
	. SET YCOLOR=YCOLOR1
	
	WRITE YCOLOR
	WRITE ">"
	SET COLOR=""
	SET PRIO=""
	IF $PIECE(AUF1,Y,249)'="" DO   ;FARBE ;tincture 
	. SET PRIO=$PIECE(AUF1,Y,249)  ;PRIORITÄT ;priority 
	. IF PRIO'=""  SET COLOR=$PIECE($GET(^WWW101(0,"PRIORITAET",SPRACHE,PRIO,1)),Y,2)  ;FARBCODE
	. IF COLOR'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR,1)),Y,1)      ;FARBNAME
	
	IF PRIO'="" DO
	. WRITE "<A HREF="_""""_"#"_""""  ;LINK SETZTEN FÜR PRIORITÄTS-ANZEIGE IN TOOL-TIP ;to within 
	. WRITE " TITLE="_""""_$$^WWWTEXT(31005)_": "_$PIECE($GET(^WWW101(0,"PRIORITAET",SPRACHE,PRIO,1)),Y,1)_""""  ;PRIORITÄT ;priority 
	. WRITE ">"
	
	WRITE "<FONT SIZE="_FONTSIZE_" "
	IF COLOR'="" WRITE " COLOR="_COLOR
	WRITE ">"
	WRITE $$^WWWDATE($GET(DAT))
	IF PRIO'="" WRITE "</A>"
	WRITE "&nbsp;"
	WRITE YCR
	WRITE "</FONT>"
	WRITE "</TD>"
	
	;--------------AB HIER ANZEIGE DER WOCHEN
	SET FONTSIZE=1
	SET START1=START-$$^WWWDAY(START)+1  ;MONTAG DER WOCHE ;Monday the week 
	SET TSET=0  ;TERMIN GESETZT ;staid 
	FOR WOCH=TAG:7:TAG+((VERGANGEN+ZUKUNFT)*7) DO  ;Z.B. EIN JAHR AUSWERTEN ;e.g. uni- year 
	. SET WEEK=$$^WWWWEEK(WOCH)
	. NEW WTAG,ZEICHEN
	. WRITE YCR
	. WRITE "<TD VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT"
	. SET PRODU=1
	. IF WOCH'=START1 IF WOCH<START!(WOCH>(START+DAUER-1)) DO 
	. . WRITE YCOLOR1  ;FARBE ;tincture 
	. . WRITE ">"
	. . WRITE "<FONT SIZE="_FONTSIZE_">"
	. . WRITE "&nbsp;"
	. . SET PRODU=0
	. . IF $PIECE(POS1,Y,19)="" IF WEEK=WOCHE WRITE "<FONT SIZE="_FONTSIZE_"><A TITLE="_""""_$$^WWWTEXT(32168)_" ? "_""""_"  HREF=#>" WRITE "?" WRITE "</A>"  ;LIEFERTERMIN ;time of delivery 
	. . IF TSET=0 IF $PIECE(POS1,Y,19)'="" IF WEEK=$$^WWWWEEK($PIECE(POS1,Y,19)) WRITE "<FONT SIZE="_FONTSIZE_"><A TITLE="_""""_$$^WWWTEXT(32168)_" "_$$^WWWDATE($PIECE(POS1,Y,19))_""""_" HREF=#>" WRITE "T" WRITE "</A>" SET TSET=1  ;LIEFERTERMIN ;time of delivery 
	. ;
	. IF PRODU=1 DO  ;MARKIEREN
	. . IF $PIECE(AUF1,Y,2)=0 WRITE " BGCOLOR=CADETBLUE>"
	. . IF $PIECE(AUF1,Y,2)=1 WRITE " BGCOLOR=BURLYWOOD>"
	. . WRITE "<FONT SIZE="_FONTSIZE_">"
	. . WRITE "<A TITLE="_""""_$PIECE(POS1,Y,5)_" X "_$PIECE(POS1,Y,1)_$CHAR(10)_$$^WWWDATE(START)
	. . IF $PIECE(POS1,Y,190)=1 WRITE " - "_$$^WWWDATE(STOP)
	. . WRITE " ("_$$^WWWTIME(FZEIT)_")"_$CHAR(13)_$PIECE($GET(^WWW101(0,"AUFTRAGSART",SPRACHE,$PIECE(AUF1,Y,2),1)),Y,1)_""""
	. . WRITE " HREF="
	. . WRITE """"
	. . NEW YI
	. . WRITE YAKTION_"EP=WWWMANU1&YFORM=INAUFP&YEXEC=D|^INAUFPEXPL('"_AUF_","_POS_"')&YKEY="_AUF_","_POS_"&YFKEY="_AUF_"&YBACK=INTIME,"
	. . ;WRITE YAKTION_"EP=WWWMANU1&YEXEC=DO|^INPROPLANANZ('"_2_"','"_AUF_"','"_POS_"')"
	. . DO ^WWWCGI
	. . ;DO VAR^WWWCGI
	. . ;WRITE "javascript:window.open("_""""_YI_""""_","_""""_"TEILEFRAME2"_""""_","_""""_"resizable=1,location=0,directories=0,status=0,menubar=0,scrollbars=0,toolbar=0"_""""_");"
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2"
	. . WRITE ">"
	. . ;W "&nbsp;"
	. . FOR WTAG=WOCH:1:WOCH+6 DO
	. . . SET ZEICHEN="&nbsp;"
	. . . IF START'>WTAG IF WTAG'>(START+DAUER-1) SET ZEICHEN="-"
	. . . IF START=WTAG SET ZEICHEN="|"   ;"<"
	. . . IF WTAG=(START+DAUER-1) SET ZEICHEN="|"  ;">"
	. . . IF DAUER<1.1 IF START=WTAG SET ZEICHEN="|"  ;"-"
	. . . IF $PIECE(POS1,Y,19)="" IF WTAG=WOCHE SET ZEICHEN="?"
	. . . IF $PIECE(POS1,Y,19)'="" IF WTAG=$PIECE(POS1,Y,19) SET ZEICHEN="T"
	. . . WRITE ZEICHEN
	. . . IF WTAG'=(WOCH+6) WRITE "&nbsp;"
	. . ;
	. . WRITE "</A>"
	. ;
	. WRITE "</TD>"
	
	WRITE "</TR>"
	QUIT  
	
STARTSTOP       ; SUCHEN HAUPTTEILEPOSITIONEN ;seek 
	NEW YA,SATZ,BEGINN,SUCH,SUCH1
	
	SET START=$GET(START)
	SET STOP=$GET(STOP)
	SET GESTARTET=0  ;NOCH NICHT BEGONNEN ;yet Not 
	SET NICHTALLE=0  ;NOCHT NICHT ALLE ;Not 
	SET NICHTOK=0  ;ALLES FERTIG ;whatsoever ready-made 
	
	SET SUCH="^INAUFPXL("_""""_YM_""""_","_""""_AUF_""""_","_""""_POS_""""_")"
	FOR  DO  QUIT:SUCH=""
	. SET SUCH=$QUERY(@SUCH)
	. IF $TRANSLATE($PIECE(SUCH,",",2),"""")'=AUF SET SUCH="" QUIT  ;21.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. ;IF $PIECE(SUCH,",",2)'=AUF SET SUCH="" QUIT  ;21.06.04;FAN;25794; 
	. IF $PIECE(SUCH,",",3)'=POS SET SUCH="" QUIT
	. IF $PIECE($PIECE(SUCH,")",1),",",3)=POS DO
	. . QUIT:$DATA(@SUCH)=1  ;NUR HAUPTPOSITIONENE ;only 
	. . SET SUCH1=@SUCH
	. . SET BEGINN=$PIECE(SUCH1,Y,168)   ;PRODUKTIONSBEGINN
	. . IF $DATA(@SUCH)=11 IF BEGINN="" SET NICHTALLE=1  ;DIESER NOCH NICHT EINGETEILT ;this yet Not 
	. . IF $PIECE(SUCH1,Y,163)'="" SET GESTARTET=$PIECE(SUCH1,Y,163)
	. . IF ($PIECE(SUCH1,Y,165)="") || (BEGINN="") SET NICHTOK=1   ;NOCHNICHT ALLES OK ;whatsoever 
	. . QUIT:BEGINN=""
	. . IF START=""     SET START = BEGINN
	. . IF STOP=""      SET STOP  = BEGINN
	. . IF BEGINN<START SET START = BEGINN
	. . IF BEGINN>STOP  SET STOP  = BEGINN
	
	QUIT
	
]]></Routine>
</Export>