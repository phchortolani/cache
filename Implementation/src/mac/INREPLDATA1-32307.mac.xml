<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INREPLDATA1" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INREPLDATA1 ;INREPLDATA1;FIS;SHOW RESULT OF RULE CALCULATION;22.05.2003
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		SHOW RESULT OF RULE CALCULATION
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FIS	22.05.2003
	;|
	;\------------------------------------------------------------------/
	;
	NEW BET,TYPE,VONART,BISART,DATE,CODE,SHOWALL
	;SET YAUSWAHL=$G(YAUSWAHL) ;table-mat 
	SET YAUSWAHL=$P($G(^INUSER(YM,YBED,1)),Y,27)  ;SAVED PROGRAM VARIABLES
	QUIT:YAUSWAHL=""
	SET BET=$P(YAUSWAHL,"#",1)  ;LOCATION
	IF BET="" QUIT  ;WRITE $$^WWWTEXT(32310)  QUIT
	SET TYPE=$P(YAUSWAHL,"#",2)  ;RULE TYPE ;letter 
	IF TYPE="" QUIT  ;WRITE $$^WWWTEXT(32310)  QUIT
	SET VONART=$P(YAUSWAHL,"#",3)  ;FROM ITEM
	SET BISART=$P(YAUSWAHL,"#",6)  ;TO ITEM
	IF VONART="" IF BISART="" QUIT  ;WRITE $$^WWWTEXT(32310)  QUIT
	SET DATE=$P(YAUSWAHL,"#",4)  ;CALCULATION DATE
	SET CODE=+$P(YAUSWAHL,"#",5)  ;SHOW CODE Y/N
	SET SHOWALL=+$P(YAUSWAHL,"#",7)  ;SHOW CALCULATION OF ALL RULES
	KILL ^WWWSOR(YUSER)
	DO SORT
	DO PRINT
	KILL ^WWWSOR(YUSER)
	QUIT
	
SET ;SETZEN AUSWAHL ;typeset Selection 
	;SET %("VAR","YAUSWAHL")=$G(VORG(1))_"#"_$G(VORG(2))_"#"_$G(VORG(3))_"#"_$G(VORG(4))_"#"_$G(VORG(5))_"#"_$G(VORG(6))_"#"_$G(VORG(7))
	SET $P(^INUSER(YM,YBED,1),Y,27)=$G(VORG(1))_"#"_$G(VORG(2))_"#"_$G(VORG(3))_"#"_$G(VORG(4))_"#"_$G(VORG(5))_"#"_$G(VORG(6))_"#"_$G(VORG(7))
	DO ^WWWFORM
	QUIT
	
SET1(ART) ;SETZEN AUSWAHL ;typeset Selection 
	NEW OLDVAL
	SET OLDVAL=$P($G(^INUSER(YM,YBED,1)),Y,27)
	SET $P(OLDVAL,"#",3)=$G(ART)  ;from item
	SET $P(OLDVAL,"#",6)=$G(ART)  ;TO ITEM
	SET $P(OLDVAL,"#",7)=1  ;SHOW ALL CALCULATIONS
	SET $P(^INUSER(YM,YBED,1),Y,27)=OLDVAL
	DO ^WWWFORM
	QUIT
	
SORT ;SEARCH RESULTS
	NEW ART,SEQ,RESULT
	SET ART=""
	IF VONART'="" SET ART=$O(^INREPLDATA(YM,TYPE,BET,VONART),-1)  ;FIRST NODE ;top 
	IF BISART="" SET BISART=$O(^INREPLDATA(YM,TYPE,BET,""),-1)  ;LAST NODE ;charge 
	FOR  SET ART=$O(^INREPLDATA(YM,TYPE,BET,ART)) QUIT:ART=""  QUIT:ART]]BISART  DO
	. SET RULE="" FOR  SET RULE=$O(^INREPLDATA(YM,TYPE,BET,ART,RULE)) QUIT:RULE=""  DO
	. . SET RESULT=$G(^INREPLDATA(YM,TYPE,BET,ART,RULE,1))
	. . IF DATE'="" QUIT:$P(RESULT,Y,3)'=DATE  ;WRONG DATE
	. . ;
	. . IF $D(^INREPLSYS(YM,RULE)) SET ^WWWSOR(YUSER,TYPE,BET,ART,0,RULE)=RESULT QUIT
	. . IF $D(^INREPLRULESUB(YM,TYPE,RULE)) DO
	. . . SET SEQ=$P($G(^INREPLRULESUB(YM,TYPE,RULE,1)),Y,3)
	. . . IF +SEQ=0 SET SEQ=1
	. . . SET ^WWWSOR(YUSER,TYPE,BET,ART,SEQ,RULE)=RESULT
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
	
PRINT ;PRINT RESULTS
	NEW ART,RULE,RESULT,ANZ,YDDSATZ,HEAD,COLSP,LFN,REQQTY
	SET ANZ=0
	SET YDDSATZ=1
	WRITE "<FONT SIZE=2><B>"
	WRITE $$^WWWFELDNAME("INREPLDATA","P",2)_": "_BET_"&nbsp;"  ;LOCATION
	WRITE $$^WWWFELDNAME("INREPLDATA","P",1)_": "_TYPE  ;RULE TYPE ;letter 
	WRITE "<BR>",YCR
	DO START100^WWWTAB
	SET HEAD=$$^WWWFELDNAME("INREPLDATA","D",3)_Y_$$^WWWFELDNAME("INREPLDATA","P",4)_Y_$$^WWWFELDNAME("INREPLDATA","D",1)
	IF CODE=1 SET HEAD=HEAD_Y_$$^WWWFELDNAME("INREPLDATA","D",2)
	IF SHOWALL'=1 SET HEAD=$$^WWWFELDNAME("INREPLDATA","P",3)_Y_HEAD  ;ITEM IN LINE ;ITEM within 
	SET COLSP=3
	IF CODE=1 SET COLSP=COLSP+1
	DO HEADER^WWWTAB(HEAD)
	SET ART="" FOR  SET ART=$O(^WWWSOR(YUSER,TYPE,BET,ART)) QUIT:ART=""  DO
	. IF SHOWALL=1 DO HEADER^WWWTAB($$^WWWFELDNAME("INREPLDATA","P",3)_": "_ART_" "_$P($G(^INART(YM,ART,1)),Y,1),,COLSP,"L")
	. SET LFN="" FOR  SET LFN=$O(^WWWSOR(YUSER,TYPE,BET,ART,LFN)) QUIT:LFN=""  DO
	. . SET RULE="" FOR  SET RULE=$O(^WWWSOR(YUSER,TYPE,BET,ART,LFN,RULE)) QUIT:RULE=""  DO
	. . . SET RESULT=$G(^WWWSOR(YUSER,TYPE,BET,ART,LFN,RULE))
	. . . SET REQQTY=0
	. . . IF $P($G(^INREPLRULE(YM,TYPE,1)),Y,11)=RULE SET REQQTY=1
	. . . IF SHOWALL'=1 QUIT:REQQTY=0
	. . . ;
	. . . SET ANZ=ANZ+1
	. . . DO NL^WWWTAB
	. . . ;
	. . . IF SHOWALL'=1 DO
	. . . . DO NF^WWWTAB
	. . . . WRITE "<FONT SIZE=2>"
	. . . . DO
	. . . . . NEW YFORM,YBACK,YKEY
	. . . . . WRITE YCR,"<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*DO|SET1^INREPLDATA1('"_ART_"')"
	. . . . . DO ^WWWCGI
	. . . . . WRITE """"
	. . . . . WRITE " TITLE="_""""_$$^WWWFELDNAME("INREPLDATA1","M",7)_""""
	. . . . . WRITE ">"
	. . . . . QUIT
	. . . . IF SHOWALL=1 IF REQQTY=1 WRITE "<B>"
	. . . . WRITE $E(ART_" "_$P($G(^INART(YM,ART,1)),Y,1),1,30)
	. . . . WRITE "</A>"
	. . . . WRITE "&nbsp;"
	. . . . WRITE YCR
	. . . . DO EF^WWWTAB
	. . . . QUIT
	. . . ;
	. . . DO NF^WWWTAB
	. . . WRITE "<FONT SIZE=2>"
	. . . IF SHOWALL=1 IF REQQTY=1 WRITE "<B>"
	. . . WRITE $$^WWWDATE($P(RESULT,Y,3))
	. . . WRITE "&nbsp;"
	. . . WRITE YCR
	. . . ;
	. . . DO ZWL^WWWTAB
	. . . WRITE "<FONT SIZE=2>"
	. . . IF SHOWALL=1 IF REQQTY=1 WRITE "<B>"
	. . . WRITE RULE
	. . . WRITE "&nbsp;"
	. . . WRITE YCR
	. . . ;
	. . . DO ZWR^WWWTAB
	. . . WRITE "<FONT SIZE=2>"
	. . . IF SHOWALL=1 IF REQQTY=1 WRITE "<B>"
	. . . DO
	. . . . IF $D(^INREPLSYS(YM,RULE)) WRITE $$^WWWTR(0,$P($G(^INREPLSYS(YM,RULE,1)),Y,12),$P(RESULT,Y,1)) QUIT
	. . . . WRITE $P(RESULT,Y,1)
	. . . . QUIT
	. . . WRITE "&nbsp;"
	. . . WRITE YCR
	. . . ;
	. . . IF CODE=1 DO
	. . . . NEW YII
	. . . . DO ZWL^WWWTAB
	. . . . WRITE "<FONT SIZE=2>"
	. . . . IF SHOWALL=1 IF REQQTY=1 WRITE "<B>"
	. . . . IF $P(RESULT,Y,2)'="" DO
	. . . . . IF '$F($P(RESULT,Y,2),"[1]") WRITE $P(RESULT,Y,2) QUIT
	. . . . . WRITE "[1] "
	. . . . . WRITE $P($P($P(RESULT,Y,2),"[1]",2),"[2]",1)
	. . . . . IF '$F($P(RESULT,Y,2),"[2]") QUIT
	. . . . . WRITE "<BR>",YCR
	. . . . . WRITE "[2] "
	. . . . . WRITE $P($P(RESULT,Y,2),"[2]",2)
	. . . . . QUIT
	. . . . WRITE "&nbsp;"
	. . . . WRITE YCR
	. . . . QUIT
	. . . ;
	. . . DO EF^WWWTAB
	. . . DO EL^WWWTAB
	. . . QUIT
	. . QUIT
	. QUIT
	IF ANZ=0 DO
	. DO NL^WWWTAB
	. DO NF^WWWTAB
	. WRITE "&nbsp;"
	. WRITE YCR
	. ;
	. DO ZWL^WWWTAB
	. WRITE "&nbsp;"
	. WRITE YCR
	. ;
	. DO ZWL^WWWTAB
	. WRITE "&nbsp;"
	. WRITE YCR
	. ;
	. IF CODE=1 DO
	. . DO ZWL^WWWTAB
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . QUIT
	. IF SHOWALL'=1 DO
	. . DO ZWL^WWWTAB
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . QUIT
	. QUIT
	QUIT
]]></Routine>
</Export>