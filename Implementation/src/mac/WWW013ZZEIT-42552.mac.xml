<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWW013ZZEIT" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWW013ZZEIT(TAG,MIT,VON,BIS,PAUS)
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		ERRECHNEN ARBEITSZEIT UND STUNDENSATZ
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 24-Jul-2007	GRF		SR15579: Doco; quits
	; 26.03.2002	FIS
	;-------------------------------------------------------------------------------
	NEW GREST,GZEIT,EINHEIT,PARA,SEKARB,SEKUNDEN,ZUSCHLAG,STDSATZ,SSF
	
	DO PARA
	SET SEKUNDEN=0
	QUIT:$GET(TAG)="" SEKUNDEN
	QUIT:$GET(MIT)="" SEKUNDEN
	QUIT:$GET(VON)="" SEKUNDEN
	QUIT:$GET(BIS)="" SEKUNDEN
	
	SET PAUS=$GET(PAUS)  ;1= KEINE ARBEITS/PAUSENZEITEN BERÃœCKSICHTIGEN ;no 
	SET SEKARB=(BIS-VON)  ;SEKUNDEN GEARBEITET
	IF PAUS'=1 DO  ;ABZUG PAUSEN ;disc. 
	. IF +$PIECE(PARA,Y,95)'=0 DO  ;VOR ARBEITSBEGINN ;pre- 
	. . IF BIS<$PIECE(PARA,Y,95) SET SEKARB=0 QUIT
	. . IF VON<$PIECE(PARA,Y,95) SET SEKARB=SEKARB-($PIECE(PARA,Y,95)-VON)
	. ;
	. IF +$PIECE(PARA,Y,96)'=0 DO  ;NACH ARBEITSENDE ;within 
	. . IF VON>$PIECE(PARA,Y,96) SET SEKARB=0 QUIT
	. . IF BIS>$PIECE(PARA,Y,96) SET SEKARB=SEKARB-(BIS-$PIECE(PARA,Y,96))
	. ;
	. IF +$PIECE(PARA,Y,97)'=0 IF $PIECE(PARA,Y,98)>$PIECE(PARA,Y,97) DO  ;PAUSE 1 ;recess 
	. . IF VON<$PIECE(PARA,Y,97) IF BIS>$PIECE(PARA,Y,98)                          SET SEKARB=SEKARB-($PIECE(PARA,Y,98)-$PIECE(PARA,Y,97))  ;PAUSE1 KOMPLETT
	. . IF VON<$PIECE(PARA,Y,97) IF BIS>$PIECE(PARA,Y,97) IF BIS<$PIECE(PARA,Y,98) SET SEKARB=SEKARB-(BIS-$PIECE(PARA,Y,97))  ;ANGEFANGENE PAUSE1
	. . IF VON>$PIECE(PARA,Y,97) IF VON<$PIECE(PARA,Y,98) IF BIS>$PIECE(PARA,Y,98) SET SEKARB=SEKARB-($PIECE(PARA,Y,98)-VON)  ;ABGEBROCHENE PAUSE1 
	. . IF VON>$PIECE(PARA,Y,97) IF BIS<$PIECE(PARA,Y,98)                          SET SEKARB=0  ;INNERHALB PAUSE1 ;inside 
	. ;
	. IF +$PIECE(PARA,Y,99)'=0 IF $PIECE(PARA,Y,100)>$PIECE(PARA,Y,99) DO  ;PAUSE 2 ;recess 
	. . IF VON<$PIECE(PARA,Y,99) IF BIS>$PIECE(PARA,Y,100)                           SET SEKARB=SEKARB-($PIECE(PARA,Y,100)-$PIECE(PARA,Y,99))  ;PAUSE2 KOMPLETT
	. . IF VON<$PIECE(PARA,Y,99) IF BIS>$PIECE(PARA,Y,99)  IF BIS<$PIECE(PARA,Y,100) SET SEKARB=SEKARB-(BIS-$PIECE(PARA,Y,99))  ;ANGEFANGENE PAUSE2
	. . IF VON>$PIECE(PARA,Y,99) IF VON<$PIECE(PARA,Y,100) IF BIS>$PIECE(PARA,Y,100) SET SEKARB=SEKARB-($PIECE(PARA,Y,100)-VON)  ;ABGEBROCHENE PAUSE2
	. . IF VON>$PIECE(PARA,Y,99) IF BIS<$PIECE(PARA,Y,100)                           SET SEKARB=0  ;INNERHALB PAUSE2 ;inside 
	
	;SET SSF=0   ;SONN UND FEIERTAG ;table-mat And holiday 
	;IF $DATA(^TERMIN9(0,"DE",TAG,1)) SET SSF=1  ;FEIERTAG
	;IF $$^WWWDAY(TAG)=7 SET SSF=1  ;SONNTAG
	;IF SSF=1 SET STDSATZ=STDSATZ+(STDSATZ/100*ZUSCHLAG) ;table-mat 
	SET GREST=SEKARB#EINHEIT
	SET GZEIT=SEKARB\EINHEIT
	IF (GREST+$PIECE(PARA,Y,85))>EINHEIT SET GZEIT=GZEIT+1
	SET SEKUNDEN=GZEIT*EINHEIT
	QUIT SEKUNDEN
	
PARA ;VORGABEN
	SET PARA=$GET(^WWW013(0,MIT,1))  ;MITARBEITERVORGABEN
	SET EINHEIT=$PIECE(PARA,Y,86)    ;ABRECHNUNGSEINHEIT
	IF +EINHEIT=0 SET EINHEIT=60     ;EINE MINUTE ;one minute 
	SET EINHEIT=1                    ;JEDE SEKUNDE ;second 
	SET ZUSCHLAG=$PIECE(PARA,Y,76)   ;SONN UND F. ZUSCHLAG ;And surcharge 
	SET STDSATZ=$PIECE(PARA,Y,75)    ;LOHN ;reward 
	IF +STDSATZ=0 SET STDSATZ=10
	IF $PIECE(PARA,Y,83)="" SET $PIECE(PARA,Y,83)=1  ;ANFANG JEDE MINUTE ;outset minute 
	IF $PIECE(PARA,Y,84)="" SET $PIECE(PARA,Y,84)=0  ;KULANZ
	IF $PIECE(PARA,Y,85)="" SET $PIECE(PARA,Y,85)=0  ;ENDEKULANZ
	QUIT
	
]]></Routine>
</Export>