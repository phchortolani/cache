<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INPROSTUECKA" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INPROSTUECKA(YAUF,YPOS,YLFN,EDITHK)       ;INPROSTUECKA;DT;AUFTRAGS STUECKLISTE;21.09.2000
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		AUFTRAGS STUECKLISTE
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	21.09.2000
	;|
	;\------------------------------------------------------------------/
	;
	;YAUF=AUFTRAG  ODER YAUF=AUFTRAG,POSITION (DANN YPOS="")
	;YPOS=POSITION
	;YLFN=TEILEPOSITION (GESAMTER STRING)
	NEW ZPOS,YARTT,YARTT1,YARTTT,YARTTT1,YMATERIAL,YKEY,MASSE,STUECK,YII,YI,AUFART,EINHEIT,GEWICHT,YDDSATZ
	SET EDITHK=+$G(EDITHK)  ;ÄNDERN HERSTELLKOSTEN ;alter 
	;ZUSAMMENBAUEN DER DATEI ZUM DURCHSUCHEN DER EBENE ;the data file scour the plain 
	SET YLFN=$GET(YLFN)
	IF $GET(YAUF)="" SET YAUF=$PIECE(YLFN,",",1,2)
	IF YLFN="" SET YLFN=$GET(YAUF)_","_$GET(YPOS)
	KILL YDATEI
	SET AUFART=0  ;AUFTRAG ;mandate  ;order 
	IF $PIECE(YLFN,",",1)'="" IF $DATA(^INANG(YM,$PIECE(YLFN,",",1))) SET AUFART=1 ;ANGEBOT ;proposition 
	SET YDATEI="^INAUFPXL("_""""_YM_""""
	IF AUFART=1 SET YDATEI="^INANGPXL("_""""_YM_""""
	FOR YI=1:1 QUIT:$PIECE(YLFN,",",YI)=""  DO  
	. ;SET YDATEI=YDATEI_","_""""_$PIECE(YLFN,",",YI)_""""
	. SET YDATEI=YDATEI_","_""""_$TRANSLATE($PIECE(YLFN,",",YI),"""")_""""  ;FIS;25.06.04
	. SET YDATEI(YI)=YDATEI_")"  ;GGF FÜR UNTERDATEIEN ;to 
	. QUIT
	SET YDATEI(0)=YDATEI_")"
	SET YXL=$GET(@(YDATEI(0)))   ;POSITIONSDATEN
	SET YART=$PIECE(YXL,Y,4)  ;HAUPTARTIKEL
	QUIT:YART=""   ;KEIN ARTIKEL ;no item 
	;QUIT:$PIECE($GET(^INART(YM,YART,1)),Y,26)=2  ;LEISTUNG
	SET YDATEI=YDATEI_","_"YI"_")"  ;LAUFVARIABLE FÜR UNTERTEILE DATEN ;to 
	WRITE "<FONT FACE=ARIAL>"
	WRITE "<FONT SIZE=2>"
	SET YAUF=$GET(YAUF)  ;VORGABE ;handicap  ;default 
	SET YPOS=$GET(YPOS)  ;VORGABE ;handicap  ;default 
	IF YPOS="" DO
	. IF $PIECE(YAUF,",",2)'="" DO
	. . SET YPOS=$PIECE(YAUF,",",2)
	. . SET YAUF=$PIECE(YAUF,",",1)
	. . QUIT
	. QUIT
	QUIT:YPOS=""  ;KEINE POSITION ;no 
	QUIT:YAUF=""  ;KEIN ARTIKEL ;no item 
	KILL ^WWWSOR(YUSER,2)  ;LÖSCHEN ZWISCHENDATEI ;Delete 
	;BEARBEITEN ÜBERSCHRIFT ;superscription 
	SET UES(1)=$$^WWWTEXT(32144)_Y_$$^WWWTEXT(32240)_Y_$$^WWWTEXT(32110)_Y_$$^WWWTEXT(32239)_Y_$$^WWWTEXT(32025)  ;UEBERSCHRIFT
	;SET UES(1)=$$^WWWTEXT(32144)_Y_$$^WWWFELDNAME("INAUFPT0","D",39)_Y_$$^WWWTEXT(32110)_Y_$$^WWWTEXT(32239)_Y_$$^WWWTEXT(32025)  ;UEBERSCHRIFT
	;               Z-POS.                stück                ARTIKELNR          benennung          MENGE
	IF $G(EDITHK)=1 SET UES(1)=UES(1)_Y_$$^WWWFELDNAME("INAUFPT0","D",47)  ;HK
	SET UES(1)=UES(1)_Y_$$^WWWTEXT(32146)_Y_$$^WWWTEXT(32147)_Y_$$^WWWTEXT(32148)_Y_$$^WWWTEXT(32149)_Y_$$^WWWTEXT(32150)
	;                        WERKSTOFF           LÄNGE              BREITE                   GEWICHT"
	DO SORT    ;VORAUSWAHL
	DO DRUCK   ;WERTE DRUCKEN ;print 
	DO STOP^WWWTAB  ;ENDE TABELLE ;termination tabulation 
	KILL ^WWWSOR(YUSER,2)  ;LÖSCHEN ZWISCHENDATEI ;Delete 
	QUIT
	
SORT ;VORSORTIERUNG
	;UNTERTEILEBESCHREIBUNG
	SET YI=""  FOR  SET YI=$ORDER(@(YDATEI)) QUIT:YI=""  DO  ;SUCHEN IN UNTERTEILEDATEI ;seek within 
	. SET YARTT1=$GET(@(YDATEI))
	. ;IF $PIECE(YARTT1,Y,7)'="" QUIT  ;DAUER VORHANDEN
	. IF $PIECE(YARTT1,Y,4)'="" QUIT:$PIECE($GET(^INART(YM,$PIECE(YARTT1,Y,4),1)),Y,26)=2  ;LEISTUNG ;performance 
	. IF $PIECE(YARTT1,Y,18)="" QUIT  ;KEINE STUCKLISTENPOSITION ;no 
	. SET ^WWWSOR(YUSER,2,+$PIECE(YARTT1,Y,18),YI)=""   ;UMSORTIEREN NACH ZEICHNUNGSNUMMER ;within 
	. QUIT
	QUIT
	
DRUCK ;
	;AUSWERTUNG DRUCKEN ;print 
	;DATENSTRUKTUR WIE DER "INAUFP"
	DO
	. SET YDDSATZ=0
	. SET MASSE=0
	. IF $G(EDITHK)'=1 DO ^WWWBACK
	. ;IF $G(YNOBACK)'=1 IF $G(EDITHK)=1 DO SAVE
	. ;
	. DO UPUEB  ;DRUCKEN ÜBERSCHRIFT ;print superscription 
	. SET ZPOS="" FOR  SET ZPOS=$ORDER(^WWWSOR(YUSER,2,ZPOS)) QUIT:ZPOS=""  DO
	. . SET YI="" FOR  SET YI=$ORDER(^WWWSOR(YUSER,2,ZPOS,YI)) QUIT:YI=""  DO
	. . . SET YARTT1=$GET(@(YDATEI))   ;YI=LAUFVARIABLE
	. . . SET YARTTT=$PIECE(YARTT1,Y,4)  ;ARTIKELNUMMER DES TEILS ;partly 
	. . . SET YARTTT1=""
	. . . IF YARTTT'="" SET YARTTT1=$GET(^INART(YM,YARTTT,1)) ;ARTIKELINFO AUS ARTIKELDATEN DES UNTERARTIKELS ;out of 
	. . . WRITE !
	. . . WRITE YCR
	. . . DO NL^WWWTAB
	. . . DO NFR^WWWTAB
	. . . WRITE "</FONT><FONT SIZE=2>",YCR
	. . . IF +ZPOS'=0 WRITE ZPOS                     ;ZEICHNUNGSPOSITION
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "</FONT><FONT SIZE=2>",YCR
	. . . ;WRITE $$^WWWZAHL($PIECE(YARTT1,Y,39),0,$LENGTH($PIECE($PIECE(YARTT1,Y,39),".",2)))   ;MENGE
	. . . ;WRITE "&nbsp;"
	. . . ;
	. . . ;PRÜFEN OB ZUSAMMENFASSUNG MÖGLICH ;sift whether potential 
	. . . SET EINHEIT=$PIECE(YARTT1,Y,40)
	. . . IF +EINHEIT=0 SET EINHEIT=1
	. . . SET GEWICHT=+$PIECE(YARTT1,Y,43)  ;GEWICHT ;wt. 
	. . . ;IF EINHEIT'=1 WRITE 1   ;WENN KEIN STÜCK DANN MENGE 1  ;when no spare part quantity 
	. . . IF EINHEIT'=1 DO
	. . . . IF +$PIECE(YARTT1,Y,195)=0 SET $PIECE(YARTT1,Y,195)=1
	. . . . QUIT
	. . . SET STUECK=$PIECE(YARTT1,Y,195)
	. . . ;
	. . . IF EINHEIT'=1 IF $G(EDITHK)'=1 DO  ;AUSWERTEN DER MENGEN, WENN TEILE GLEICH
	. . . . NEW YII,Q,YARTTC
	. . . . SET YII=YI
	. . . . NEW YI  ;YI NEU WEGEN LAUFVARIABLE S.O. ;recent quibble 
	. . . . SET Q=0
	. . . . SET YI=YII FOR  SET YI=$ORDER(^WWWSOR(YUSER,2,ZPOS,YI)) QUIT:YI=""  DO  QUIT:Q=1
	. . . . . SET YARTTC=$GET(@(YDATEI))   ;YI=LAUFVARIABLE
	. . . . . IF $PIECE(YARTTC,Y,1,198)'=$PIECE(YARTT1,Y,1,198) SET Q=1 QUIT  ;NICHT GLEICH ;Not without delay 
	. . . . . SET STUECK=STUECK+$PIECE(YARTT1,Y,195)  ;MEHRERE STUECKE ALLES GLEICH ;divers whatsoever without delay 
	. . . . . SET GEWICHT=GEWICHT+$PIECE(YARTTC,Y,43)  ;GEWICHT ADDIEREN WENN ZUSAMMENFASSUNG  ;FIS, 07.12.01
	. . . . . KILL ^WWWSOR(YUSER,2,ZPOS,YI)  ;LOESCHEN DOPPELTEST TEIL AUS AUFLISTUNG ;part out of 
	. . . . . QUIT
	. . . . QUIT
	. . . ;
	. . . IF EINHEIT'=1 WRITE STUECK   ;WENN KEIN STÜCK DANN MENGE 1 ODER MENGE AUS WIEDERHOLUNG ;when no spare part quantity Or quantity out of repetition 
	. . . ;
	. . . IF EINHEIT=1 WRITE $$^WWWZAHL($PIECE(YARTT1,Y,39),0,$LENGTH($PIECE($PIECE(YARTT1,Y,39),".",2)))   ;MENGE ;quantum  ;quantity 
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "</FONT><FONT SIZE=2>",YCR
	. . . WRITE $PIECE(YARTT1,Y,4)      ;ARTIKELNUMMER
	. . . WRITE "&nbsp;"
	. . . DO ZWX^WWWTAB(50)
	. . . WRITE "</FONT><FONT SIZE=2>",YCR
	. . . WRITE $EXTRACT($PIECE(YARTT1,Y,1),1,30)     ;BEZEICHNUNG ;notation 
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB   
	. . . WRITE "</FONT><FONT SIZE=2>",YCR
	. . . ;MENGE , WENN NICHT STÜCK
	. . . IF EINHEIT'=1 DO
	. . . . NEW YMENGE
	. . . . SET YMENGE=$PIECE(YARTT1,Y,39)
	. . . . IF +$PIECE(YARTT1,Y,195)'=0 SET YMENGE=$PIECE(YARTT1,Y,39)/$PIECE(YARTT1,Y,195)
	. . . . WRITE $$^WWWZAHL(YMENGE,0,$LENGTH($PIECE($PIECE(YARTT1,Y,39),".",2)))   ;MENGE ;quantum  ;quantity 
	. . . . IF EINHEIT'="" WRITE " ",$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,EINHEIT,1)),Y,1)
	. . . . QUIT
	. . . WRITE "&nbsp;"
	. . . IF $G(EDITHK)=1 DO  ;FIS;16.05.2003;23644;HERSTELLKOSTEN/EINKAUFSPREIS ÄNDERN
	. . . . NEW PRUEF,YII
	. . . . DO ZWR^WWWTAB
	. . . . SET PRUEF="^INAUFPXL("_""""_YM_""""_","
	. . . . FOR YII=1:1  QUIT:$P(YLFN,",",YII,99)=""  SET PRUEF=PRUEF_""""_$P(YLFN,",",YII)_""""_","
	. . . . SET PRUEF=PRUEF_YI_")"
	. . . . IF $D(@PRUEF)=11 WRITE "&nbsp;" QUIT  ;NUR METARIAL
	. . . . WRITE YCR,"("_$PIECE(YARTT1,Y,5)_")"  ;MENGE ;quantum  ;quantity 
	. . . . WRITE YCR,"<input type="_""""_"text"_""""
	. . . . WRITE YCR," name="_""""_"YEDIT"_$TR(YLFN,",","_")_"_"_YI_""""
	. . . . WRITE YCR," size=10 maxlength=12"
	. . . . WRITE YCR," style="_""""_"padding-top:0 ;padding-bottom:0; font-size:8pt; text-align:right;"_""""
	. . . . WRITE YCR," value="_""""_$$^WWWZAHL($PIECE(YARTT1,Y,47),0,2)_""""  ;HERSTELLKOSTEN
	. . . . DO ^WWWEVENTCALL("YEDIT"_$TR(YLFN,",","_")_"_"_YI,,0,8)
	. . . . ;WRITE YCR," onKeyDown='if (event.keyCode == 13) event.keyCode = 9;'"
	. . . . ;WRITE YCR," onFocus='select();'"
	. . . . ;WRITE YCR," onhelp="_""""_"javascript: window.event.returnValue = false; window.event.cancelBubble = true;"_""""
	. . . . ;WRITE YCR," onBlur='retval = EventValue("_""""_YUCI_""""_","_""""_YUSER_""""_","_""""_YFORM_""""_","_""""_"FIXVALID8"_""""_","_""""_"INAUFPT0"_""""_",this.value,"_""""_"0"_""""_","_""""_"YEDIT"_$TR(YLFN,",","_")_"_"_YI_""""_");'"
	. . . . WRITE YCR,">"
	. . . . WRITE "&nbsp;"
	. . . . QUIT
	. . . DO ZW^WWWTAB
	. . . WRITE "</FONT><FONT SIZE=2>",YCR
	. . . SET YMATERIAL=$PIECE(YARTTT1,Y,37)
	. . . SET YMATERIAL1=""
	. . . IF YMATERIAL'="" SET YMATERIAL1=$GET(^INMATERIAL(YM,YMATERIAL,1))
	. . . WRITE $PIECE(YMATERIAL1,Y,1)     ;MATERIAL WERKSTOFF
	. . . WRITE "&nbsp;"
	. . . IF $PIECE(YARTTT1,Y,171)'="" IF $PIECE(YMATERIAL,Y,1)'="" WRITE "<BR>"
	. . . IF $PIECE(YARTTT1,Y,171)'="" WRITE $PIECE(YARTTT1,Y,171)  ;DIN DES TEILS ;ISO partly 
	. . . IF $PIECE(YARTTT1,Y,171)="" WRITE " ",$PIECE(YMATERIAL1,Y,3)   ;DIN DES MATERIALS ;ISO 
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "</FONT><FONT SIZE=2>",YCR
	. . . IF +$PIECE(YARTT1,Y,15)'=0 WRITE $$^WWWZAHL($PIECE(YARTT1,Y,15),0,$LENGTH($PIECE($PIECE(YARTT1,Y,15),".",2)))   ;LÄNGE ;longitude 
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "</FONT><FONT SIZE=2>",YCR
	. . . IF +$PIECE(YARTT1,Y,16)'=0 WRITE $$^WWWZAHL($PIECE(YARTT1,Y,16),0,$LENGTH($PIECE($PIECE(YARTT1,Y,16),".",2)))  ;BREITE ;width 
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "</FONT><FONT SIZE=2>",YCR
	. . . IF +$PIECE(YARTT1,Y,17)'=0 WRITE $$^WWWZAHL($PIECE(YARTT1,Y,17),0,$LENGTH($PIECE($PIECE(YARTT1,Y,17),".",2)))   ;HOEHE
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "</FONT><FONT SIZE=2>",YCR
	. . . ;WRITE $$^WWWZAHL($PIECE(YARTT1,Y,43),0,1)   ;GEWICHT
	. . . ;SET MASSE=MASSE+$JUSTIFY($PIECE(YARTT1,Y,43),0,1)   ;GEWICHT
	. . . ;IF $LENGTH($PIECE($PIECE(YARTT1,Y,43),".",2))>3 SET $PIECE(YARTT1,Y,43)=$JUSTIFY($PIECE(YARTT1,Y,43),0,4)  ;ZU VIELE NACHKOMMASTELLEN
	. . . ;WRITE $$^WWWZAHL($PIECE(YARTT1,Y,43),0,$L($P($P(YARTT1,Y,43),".",2)))   ;GEWICHT 
	. . . IF $LENGTH($PIECE(GEWICHT,".",2))>3 SET $PIECE(YARTT1,Y,43)=$JUSTIFY(GEWICHT,0,4)  ;ZU VIELE NACHKOMMASTELLEN ;within much 
	. . . WRITE $$^WWWZAHL(GEWICHT,0,$LENGTH($PIECE(GEWICHT,".",2)))   ;GEWICHT  ;wt. 
	. . . IF $GET(YART)'=$PIECE(YARTT1,Y,4) SET MASSE=MASSE+GEWICHT   ;GEWICHT ;wt. 
	. . . WRITE "&nbsp;"
	. . . DO EF^WWWTAB
	. . . DO EL^WWWTAB
	. . . QUIT
	. . QUIT
	. QUIT
	;GESAMT MASSE ;total shoal 
	DO
	. DO
	. . WRITE YCR
	. . DO NL^WWWTAB
	. . DO NFR^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZWR^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZWR^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZWR^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZWR^WWWTAB
	. . WRITE "&nbsp;"
	. . IF $G(EDITHK)=1 DO
	. . . DO ZWR^WWWTAB
	. . . WRITE "&nbsp;"
	. . . QUIT
	. . DO ZWR^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZWR^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZWR^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZWR^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZWR^WWWTAB
	. . WRITE "</FONT><FONT SIZE=2>",YCR
	. . WRITE $$^WWWZAHL(MASSE,0,1)   ;GEWICHT ;wt. 
	. . WRITE "&nbsp;"
	. . DO EF^WWWTAB
	. . DO EL^WWWTAB
	. . QUIT
	. QUIT
	QUIT
	
UPUEB ;ÜBERSCHRIFT ;superscription 
	WRITE "<CENTER>"
	DO START00^WWWTAB
	DO NL^WWWTAB
	DO NHWO^WWWTAB
	SET YKEY=YAUF_","_YPOS
	WRITE "<FONT SIZE=3>"
	WRITE "<B>"
	WRITE "<NOBR>"
	WRITE "<A"
	WRITE " TITLE="_""""_$$^WWWTEXT(32123)_"""" 
	I AUFART'=1 WRITE " HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INAUFP"   ;AUFTRAG ;mandate  ;order 
	I AUFART=1 WRITE " HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INANGP"   ;ANGEBOTE
	SET YBACK=""
	DO ^WWWCGI
	WRITE """"_">"
	WRITE $$^WWWTEXT(32143)    ;STUECKLISTE
	WRITE "&nbsp;"
	WRITE YLFN   ;TEILESTRUKTUR
	;WRITE YAUF,",",YPOS
	WRITE " "
	WRITE "("_YART_")"
	WRITE "&nbsp;"
	WRITE $PIECE($GET(^INART(YM,YART,1)),Y,1)  ;ARTIKELBEZEICHNUNG
	WRITE " "
	WRITE "</A>"
	WRITE "</NOBR>"
	WRITE "</B>"
	DO EH^WWWTAB
	DO EL^WWWTAB
	DO STOP^WWWTAB
	WRITE "<BR>"
	WRITE "</CENTER>"
	DO START100^WWWTAB  ;STARTEN DER ÜBERSCHRIFT ;launching the superscription 
	;WRITE "<THEAD>" 
	DO NL^WWWTAB
	FOR I=1:1 QUIT:$PIECE(UES(1),Y,I,99)=""  DO NHZ^WWWTAB WRITE "</FONT><FONT SIZE=2>",YCR WRITE $PIECE(UES(1),Y,I),"&nbsp;" DO EH^WWWTAB
	DO EL^WWWTAB
	;WRITE "</THEAD>"
	QUIT
]]></Routine>
</Export>