<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWSEAR2" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWSEAR2
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		SUCHANZEIGE
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| 07-Jul-2005		shobby		SR12892: WWW1263 is no longer shared.
	;| DT	13.08.1997
	;\------------------------------------------------------------------/
	
	;WRITE YCR,YCR,"<!-- ************************* SUCHVORGABEN (WWWSEAR2)************************* -->",YCR,YCR
	
	;IF YSORT="" IF $PIECE(YSUCH1,Y,3)'="" SET YSORT=+$PIECE(YSUCH1,Y,3)
	;IF YSORT="" SET YSORT=+$PIECE(YSUCH1,Y,7)
	IF +YANZAHL<1 SET YANZAHL=$PIECE(YSUCH1,Y,10)
	IF +YANZAHL<1 SET YANZAHL=100
	I YFORM'="" I YBED'="" I +$P($G(^WWW1263(YM,YFORM,YBED,1)),Y,1)'=0 S YANZAHL=+$P(^(1),Y,1)  ;INDIVIDUELLE SUCHE ;search 
	;DO  ;IF +YSORT'=0 DO
	. NEW YI
	. WRITE "<FONT SIZE=2><NOBR>"
	. SET YI(1)="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"
	. FOR YI=1:1 QUIT:$EXTRACT(YI(1),YI)=""  DO
	. . WRITE YCR
	. . WRITE "<A"
	. . WRITE " TITLE="""_$$^WWWTEXT(206)_" "_$EXTRACT(YI(1),YI)_""""   ;DATENSATZ AUSWÃ„HLEN ;data record pick out 
	. . WRITE " HREF="""_YAKTION_"EP=WWWSEAR&amp;YFORM="_YFORM
	. . WRITE "&amp;YAUSWAHL="_$EXTRACT(YI(1),YI) IF +$EXTRACT(YI(1),YI)'=0 WRITE "*"
	. . WRITE "&amp;YSORT="_+YSORT
	. . WRITE "&amp;YORIENT="_$GET(YORIENT)
	. . WRITE "&amp;YSUCH="_$GET(YSUCH)
	. . ;WRITE "&YANZAHL=200"      ;_$G(YANZAHL)
	. . WRITE "&amp;YANZAHL="_$G(YANZAHL)
	. . DO ^WWWCGI
	. . WRITE """>"
	. . WRITE $EXTRACT(YI(1),YI)
	. . WRITE "</A>"
	. . WRITE "&nbsp;"
	. . WRITE "&nbsp;"
	. . QUIT
	. WRITE "</NOBR></FONT>"
	. QUIT
	;W "<CENTER>"
	WRITE YCR,"<TABLE CELLSPACING=0 BORDER=0>"
	WRITE "<TR>"
	SET YDATEI=$PIECE(YSUCH1,Y,2)
	IF YDATEI="" SET YDATEI=$PIECE($GET(^WWW120(0,YFORM,1)),Y,11)
	QUIT:YDATEI=""
	WRITE YCR
	WRITE YCR
	WRITE "<TD NOWRAP>"
	IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	DO SUCH
	WRITE YCR,"</TD>"
	WRITE YCR
	WRITE YCR
	WRITE "<TD NOWRAP>"
	IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	DO AUSWAHL
	WRITE YCR,"</TD>"
	WRITE YCR
	WRITE "<TD NOWRAP VALIGN=BOTTOM>"
	IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	DO GO
	WRITE YCR,"</TD>"
	WRITE YCR
	WRITE YCR
	WRITE "<TD NOWRAP>"
	IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	DO ANZAHL
	WRITE YCR,"</TD>"
	WRITE YCR
	WRITE YCR
	WRITE "<TD NOWRAP>"
	IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	DO RICHT
	WRITE YCR,"</TD>"
	WRITE YCR
	WRITE YCR,"</TR>"
	WRITE YCR,"</TABLE>"
	;W "</CENTER>"
	QUIT
	
AUSWAHL ;ANZEIGE AB ;Show Confirm. 
	NEW YLKY,YLKY1,YLKY2
	IF $EXTRACT(YAUSWAHL)="|"!($EXTRACT(YAUSWAHL)="*")!($EXTRACT(YAUSWAHL)=" ") SET YAUSWAHL=$EXTRACT(YAUSWAHL,2,99)
	IF $EXTRACT(YAUSWAHL)="|"!($EXTRACT(YAUSWAHL)="*")!($EXTRACT(YAUSWAHL)=" ") SET YAUSWAHL=$EXTRACT(YAUSWAHL,2,99)
	IF $EXTRACT(YAUSWAHL)="." SET YAUSWAHL=$EXTRACT(YAUSWAHL,2,99)
	IF $EXTRACT(YAUSWAHL)="." SET YAUSWAHL=$EXTRACT(YAUSWAHL,2,99)
	SET YLKY2=YAUSWAHL
	IF +YSORT=0 IF YLKY2'="" DO  ;DATUM IN KEY? ;Date within 
	. FOR YLKY1=1:1 SET YLKY=$GET(^WWW002(0,YDATEI,YLKY1,1)) QUIT:YLKY=""  DO
	. . QUIT:$PIECE(YLKY,Y,3)'=1  ;KEIN DATUM ;no Date 
	. . SET YLKY(1)=+$PIECE(YAUSWAHL,",",YLKY1)
	. . IF YLKY(1)>10000 SET $PIECE(YLKY2,",",YLKY1)=$$^WWWDATE(YLKY(1))
	. . QUIT
	. QUIT
	IF +YSORT'=0 DO  ;IN SORTKEY ;within 
	. FOR YLKY1=1:1 SET YLKY=$GET(^WWW002(0,YDATEI,YLKY1,1)) QUIT:YLKY=""  DO
	. . QUIT:$PIECE(YLKY,Y,6)'=YSORT  ;FALSCHER SORT
	. . QUIT:$PIECE(YLKY,Y,3)'=1  ;KEIN DATUM ;no Date 
	. . SET YLKY(1)=YAUSWAHL
	. . IF YLKY(1)>10000 SET YLKY2=$$^WWWDATE(YLKY(1))
	. . QUIT
	. QUIT
	DO  ;VERSTECKTE VORGABE ;default 
	. NEW AUSWTEXT
	. WRITE YCR,"<INPUT TYPE=HIDDEN NAME=""YVORGABE"""
	. IF YAUSWAHL="" SET AUSWTEXT=YKEY
	. IF YAUSWAHL'="" SET AUSWTEXT=YAUSWAHL  ;$$^WWWUML(YAUSWAHL)
	. IF $EXTRACT(AUSWTEXT)=" " SET AUSWTEXT=$EXTRACT(AUSWTEXT,2,99)
	. SET YAUSWAHL=AUSWTEXT
	. WRITE " VALUE="""_AUSWTEXT_""""
	. WRITE ">"
	. Q
	WRITE $$^WWWTEXT(393)_" "  ;(SUCHEN . ODER *) ;Or 
	WRITE "<BR>"
	IF $EXTRACT(YLKY2)="." SET YLKY2=$EXTRACT(YLKY2,2,99)
	DO
	. WRITE YCR
	. WRITE "<INPUT NAME=""YAUSWAHL"" SIZE="""_20_""" MAXLENGTH="""_80_""""
	. WRITE " TYPE=""TEXT"""
	. WRITE " TITLE="""_$$^WWWTEXT(384)_""""
	. WRITE " VALUE=""."_YLKY2_""""
	. ;WRITE " onChange=""document.WWW.style.cursor='wait'; SAVENOW();"""
	. WRITE " onFocus='select();'"
	. WRITE ">"
	. QUIT
	QUIT
	
GO  ;
	WRITE "<BR>"
	DO
	. WRITE "<INPUT TYPE=""IMAGE"""
	. WRITE " SRC="""_YGIF_"more.gif"" "_YWIDTH_" "_YHEIGHT_" VALIGN=BASELINE TITLE="""_$$^WWWUML($$^WWWTEXT(98))
	. WRITE """ border=0>" ; upward
	. WRITE "</A>"
	. QUIT
	QUIT
	
SUCH ;AUSWAHL SORTKEY ;Selection 
	QUIT:YDATEI=""
	NEW YSKEY,YA,YI,YX,YNAME
	IF YSORT="" IF +$PIECE(YSUCH1,Y,3)'=0 SET YSORT=+$PIECE(YSUCH1,Y,3)
	IF YSORT="" SET YSORT=+$PIECE(YSUCH1,Y,7)
	SET YSKEY(0)=""
	SET YLFN="" FOR  SET YLFN=$ORDER(^WWW002(0,YDATEI,YLFN)) QUIT:YLFN=""  DO  ;neue selection;tybd;04,07,2003
	. SET YNAME=""
	. IF YFORM'="" IF $PIECE($GET(^WWW120(0,YFORM,1)),Y,11)=YDATEI SET YNAME=$$^WWWFELDNAME(YFORM,"P",YLFN)
	. IF YNAME="" DO
	. . SET YNAME=$PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,2)
	. . IF $DATA(^WWW0021(0,YDATEI,YLFN,SPRACHE,1)) SET YNAME=$PIECE(^(1),Y,1)
	. . QUIT
	. SET $PIECE(YSKEY(0),"/",YLFN)=YNAME
	. ;
	. SET YSKEY=$PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,6)
	. FOR YI=1:1 SET YA=$PIECE(YSKEY,",",YI) QUIT:YA=""  DO
	. . SET YA(1)=+$PIECE(YA,".",1)
	. . SET YA(2)=+$PIECE(YA,".",2)
	. . QUIT:+YA(1)=0
	. . IF +YA(2)=0 SET YA(2)=1
	. . SET YNAME=""
	. . IF YFORM'="" IF $PIECE($GET(^WWW120(0,YFORM,1)),Y,11)=YDATEI SET YNAME=$$^WWWFELDNAME(YFORM,"P",YLFN)
	. . IF YNAME="" DO
	. . . SET YNAME=$PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,2)
	. . . IF $DATA(^WWW0021(0,YDATEI,YLFN,SPRACHE,1)) SET YNAME=$PIECE(^(1),Y,1)
	. . . QUIT
	. . SET $PIECE(YSKEY(YA(1)),"/",YA(2))=YNAME
	. . QUIT
	. QUIT
	SET YLFN="" FOR  SET YLFN=$ORDER(^WWW003(0,YDATEI,YLFN)) QUIT:YLFN=""  DO
	. SET YSKEY=$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,6)
	. FOR YI=1:1 SET YA=$PIECE(YSKEY,",",YI) QUIT:YA=""  DO
	. . SET YA(1)=+$PIECE(YA,".",1)
	. . SET YA(2)=+$PIECE(YA,".",2)
	. . QUIT:+YA(1)=0
	. . IF +YA(2)=0 SET YA(2)=1
	. . SET YNAME=""
	. . IF YFORM'="" IF $PIECE($GET(^WWW120(0,YFORM,1)),Y,11)=YDATEI DO
	. . . SET YNAME=$$^WWWFELDNAME(YFORM,"D",YLFN)  ;FIS;24.10.03
	. . . ;NEW YLFN1
	. . . ;SET YLFN1=$ORDER(^WWW122s(0,4,YLFN,YFORM,""))
	. . . ;QUIT:YLFN1=""
	. . . ;SET YNAME=$$^WWWFELDNAME(YFORM,"D",YLFN1)
	. . . QUIT
	. . IF YNAME="" DO
	. . . SET YNAME=$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,2)
	. . . IF $DATA(^WWW0031(0,YDATEI,YLFN,SPRACHE,1)) SET YNAME=$PIECE(^(1),Y,1)
	. . . QUIT
	. . SET $PIECE(YSKEY(YA(1)),"/",YA(2))=YNAME
	. . QUIT
	. QUIT
	DO
	. WRITE $$^WWWTEXT(65)_" "  ;SORTIERUNG ;sorting 
	. WRITE "<BR>"
	. WRITE YCR
	. WRITE "<select NAME=""YSORT""" 
	. ;W " onChange='document.WWW.YFUNCT.value=1;  SAVENOW();'"
	. WRITE ">"
	. IF +YSORT=0 WRITE "<option value="""_0_""" SELECTED=SELECTED>"_$$^WWWUML(YSKEY(0))_"</option>"
	. IF +$PIECE(YSUCH1,Y,3)=0 IF +YSORT'=0 WRITE "<option value="""_0_""">"_$$^WWWUML(YSKEY(0))_"</option>"
	. SET YA="0" FOR  SET YA=$ORDER(YSKEY(YA)) QUIT:YA=""  DO 
	. . QUIT:YSKEY(YA)="_FREE"
	. . IF +$PIECE(YSUCH1,Y,3)'=0 QUIT:+YA'=$PIECE(+$PIECE(YSUCH1,Y,3),".",1)
	. . IF YSORT'=YA WRITE "<option value="""_YA_""">"_$$^WWWUML(YSKEY(YA))_"</option>"
	. . IF +YSORT'=0 IF YSORT=YA WRITE "<option value="""_YA_""" SELECTED=SELECTED>"_$$^WWWUML(YSKEY(YA))_"</option>"
	. . QUIT
	. WRITE YCR 
	. WRITE "</select>"
	. QUIT
	QUIT
	
ANZAHL ;ANZ. ANZEIGE ;Show 
	;| 07-Jul-2005		shobby		SR12892: WWW1263 is no longer shared.
	IF +YANZAHL<1 SET YANZAHL=$PIECE(YSUCH1,Y,10)
	IF +YANZAHL<1 SET YANZAHL=100
	IF YFORM'="" IF YBED'="" IF +$PIECE($GET(^WWW1263(YM,YFORM,YBED,1)),Y,1)'=0 SET YANZAHL=+$PIECE(^(1),Y,1)  ;INDIVIDUELLE SUCHE ;search 
	WRITE $$^WWWTEXT(153)_" "   ;ANZAHL DER DATEN ;Number the 
	WRITE "&nbsp;&nbsp;"
	WRITE "<BR>"
	DO
	. WRITE "<INPUT NAME=""YANZAHL"" SIZE="""_4_""" MAXLENGTH="""_3_""""
	. WRITE " TYPE=""TEXT"""
	. WRITE " VALUE="""_+YANZAHL_""""
	. ;WRITE " onChange=""document.WWW.style.cursor='wait'; SAVENOW();"""
	. WRITE ">"
	. QUIT
	QUIT
	
RICHT ;ORIENTIERUNG SUCHLAUF AUF ODER ABSTEIGEND? ;upon Or 
	IF YORIENT="" SET YORIENT=+$PIECE(YSUCH1,Y,9)
	IF YORIENT="" SET YORIENT=0
	DO
	. ;WRITE $$^WWWTEXT(110)_"<br>"  ;SORTIERUNG
	. FOR YI=0,1 DO
	. . SET YA=$PIECE($$^WWWTEXT(112)_"#"_$$^WWWTEXT(111),"#",YI+1)   ;AUFSTEIGEND UND ABSTEIGEND ;And 
	. . WRITE "<INPUT TYPE=""RADIO"" NAME=""YORIENT"" VALUE="""_YI_""""
	. . ;W " onClick='document.WWW.YFUNCT.value=1; SAVENOW();'"
	. . IF YI=YORIENT WRITE " CHECKED=""CHECKED"""
	. . WRITE "> "_YA
	. . WRITE "</INPUT>"
	. . IF YI=0 WRITE "<BR>"
	. . QUIT
	. QUIT
	QUIT
]]></Routine>
</Export>