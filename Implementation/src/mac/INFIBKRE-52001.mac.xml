<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INFIBKRE" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INFIBKRE
#include COMSYS
#include INConst
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		ANLEGEN KREDITOR IN FIBU ABACUS
	;
	; Inputs : none
	;
	; ByRef :
	;	YFORM
	;	YKEY
	;	YFELD
	;
	; Returns : nothing
	;
	; History :
	; 11-Feb-2008	GRF		SR15627: Use $$$save instead of direct set; objSupplier
	; 05-Feb-2007	GRF		SR15424: Naked Reference; doco; expand commands
	; 21-SEP-2006	FAN		SR14746 Sales statistics incorrect
	; 30-May-2005	RobertW	SR12056: Attempt at Performance Increase
	; 19.11.1999	TYB
	;-------------------------------------------------------------------------------
	new BET,MAN,UCI,KRED,NAM,SAT,MANSS,BETSS,LKRE,objSupplier,strStatus
	
	IF YFORM="INLIEF" DO SAVE^INKUNDED54  ;FIS;PRÜFEN STEUERKENNZEICHEN;31.12.04;26636
	
	;VORGABE YKEY=LIEFERANTENNUMMER;YFELD=DATENSATZ AUS LIEFERANTENDATEI ;default out of 
	QUIT:YKEY=""
	QUIT:YFELD=""
	
	;SET $PIECE(^INLIEF(YM,YKEY,1),Y,202)=1 DO ^INDOC("INLIEF",YKEY,YFELD)  ;BRIEF ;letter ; SR15627 vvv
	set objSupplier=$get(^INLIEF(YM,YKEY,1))
	set $$$INLIEFDirectorycreated(objSupplier) = $$$YES
	set strStatus=$$$Save("INLIEF",YKEY,objSupplier,$$$YES)
	do ^INDOC("INLIEF",YKEY,YFELD)                    ;prepare audit record 
	
	SET KRED=$PIECE(YFELD,Y,48)  ;KREDITOREN NUMMER  ;numeral 
	
	;QUIT:KRED=""
	SET NAM=$TRANSLATE($PIECE(YFELD,Y,8),"""")  ;NAME OHNE "
	IF NAM="" SET NAM=$PIECE(YFELD,Y,4) DO  ;NAME IN KURZFORM EINSETZEN ;Name within contraction stow 
	. QUIT:NAM="" 
	. DO 
	. . NEW SATZ
	. . SET SATZ=$GET(^INLIEF(YM,YKEY,1))
	. . SET $PIECE(SATZ,Y,8)=NAM
	. . SET strStatus=$$$Save("INLIEF",YKEY,SATZ,$$$YES)     // SR14746
	
	IF YFORM'="INFIBUM" DO KOPIE  ; KOPIE IN KUNDEN DATEI      ;copy within data file 
	IF YFORM'="INFIBUM" DO DOPPEL ; MÖGLICHER WEISE AUCH ALS KUNDE ANGELEGT ;wise too when customer 
	IF +$PIECE(YFELD,Y,48)=0 DO   ; KREDITOREN NUMMER ;numeral 
	. QUIT:$LENGTH(YKEY)<5
	. NEW SKK
	. SET SKK=$$^WWWUMLAU($PIECE(YFELD,Y,48),1)
	. IF SKK="" SET SKK=" "
	. SET $PIECE(YFELD,Y,48)=$PIECE(YKEY,",",1)
	. DO 
	. . NEW SATZ
	. . SET SATZ=$GET(^INLIEF(YM,$PIECE(YKEY,",",1),1))
	. . SET $PIECE(SATZ,Y,48)=$PIECE(YKEY,",",1)   // SR14746
	. . SET strStatus=$$$Save("INLIEF",$PIECE(YKEY,",",1),SATZ,$$$YES)     // SR14746
	
	SET KRED=$PIECE(YFELD,Y,48)  ;KREDITOREN NUMMER  ;numeral 
	QUIT:KRED=""
	SET BET=$GET(YLOCATION)
	SET BET=$ORDER(^INFIBPAR(0,YM,""))
	QUIT:BET=""
	
	SET YFPARA=$GET(^INFIBPAR(0,YM,BET,1))
	IF +$PIECE(YFPARA,Y,15)=0 QUIT  ;KEINE FIBU ;no 
	IF +$PIECE(YFPARA,Y,17)=0 QUIT  ;KEINE KREDITORENANLAGE ;no 
	
	SET LKRE=6
	IF $PIECE(YFPARA,Y,5)'="" SET LKRE=$PIECE(YFPARA,Y,5)  ;LÄNGE KREDITOREN ;longitude 
	;QUIT:$LENGTH(KRED)'=LKRE   ;MUSS LKRE STELLEN HABEN
	
	IF $PIECE(YFPARA,Y,15)=1 DO ABACUS  QUIT     ;ABACUS FIBU
	IF $PIECE(YFPARA,Y,15)=4 DO DISC    QUIT     ;DISC GL ;DISC  GL 
	IF $PIECE(YFPARA,Y,15)=5 DO SIMBA   QUIT     ;SIMBA FIBU
	IF $PIECE(YFPARA,Y,15)=7 DO FIBUNET QUIT     ; FIBU NET
	
	QUIT
	
KOPIE
	IF $PIECE($GET(FFFELD),"~",1,26)=$PIECE(YFELD,"~",1,26) IF $PIECE($GET(FFFELD),Y,200)=$PIECE(YFELD,Y,200) QUIT   ;Q: WENN HAUPT INFOMATION NICHT GEÄNDERT ;when pate Not 
	IF $PIECE(YFELD,Y,200)'="" DO     ;ÄNDERUNG KOPIE IN LIEF ;alteration copy within 
	. NEW SATZ,KEY,YI,DATA
	. SET DATA=0
	. SET SATZ=""
	. IF $DATA(^INKUNDE(YM,$PIECE(YFELD,Y,200),1)) SET SATZ=$GET(^INKUNDE(YM,$PIECE(YFELD,Y,200),1)) SET DATA=1                 ; SR15424
	. FOR YI=1:1:26 SET $PIECE(SATZ,Y,YI)=$PIECE(YFELD,Y,YI)
	. SET $PIECE(SATZ,Y,200)=YKEY
	. SET KEY=$PIECE(YFELD,Y,200)
	. SET YOK=$$^WWWSPEI("INKUNDE",KEY,SATZ,1)
	. DO
	. . NEW YBACK,YKEY
	. . SET YI=YAKTION_"EP=WWWFORM&YFORM=INKUNDE&YKEY="_$PIECE(YFELD,Y,200)
	. . SET YBACK="INLIEF,"
	. . DO VAR^WWWCGI
	. ;
	. IF DATA'=1 DO        ;NEUANLAGE LIEFERANT: (NR) BEZEICHNUNG ;notation 
	. . DO ^WWWINFO($$^WWWTEXT(58,,1)_" "_$$^WWWTEXT(32096,,1)_" "_$$^WWWTEXT(32231,,1)_": "_" ("_$PIECE(YFELD,Y,200)_") "_$PIECE(YFELD,Y,8),0,YI)
	. ;
	. IF DATA=1 DO        ;ÄNDEREN DATENSATZ BEI LIEFERANT ;data record next to supplier 
	. . DO ^WWWINFO($$^WWWTEXT(40,,1)_" "_$$^WWWTEXT(32096,,1)_" "_$$^WWWTEXT(32231,,1)_": "_" ("_$PIECE(YFELD,Y,200)_") "_$PIECE(YFELD,Y,8),0,YI)
	. ;
	. DO ^WWWFORM2
	. SET Q=1              ;KEINE FORMULAR ANZEIG NACH INFO ;no form within 
	
	QUIT
	
DOPPEL
	;-------------------------------------------------------------------------------
	;  MÖGLICHER WEISE AUCH ALS KUNDE ANGELEGT ;wise too when customer 
	;-------------------------------------------------------------------------------
	QUIT:$PIECE(YFELD,Y,200)'=""
	NEW BEZ,KUNDE
	
	SET BEZ=$$^WWWUMLAU($PIECE(YFELD,Y,8),1)
	IF $DATA(^INKUNDEs(YM,1,BEZ)) DO              ;SSOK
	. SET KUNDE=$ORDER(^INKUNDEs(YM,1,BEZ,""))
	. QUIT:$PIECE($GET(FFFELD),Y,1,26)=$PIECE(YFELD,Y,1,26)     ;Q: WENN HAUPT INFOMATION NICHT GEÄNDERT ;when pate Not 
	. DO
	. . SET FFFELD=YFELD
	. . NEW YBACK,YKEY
	. . SET YI=YAKTION_"EP=WWWFORM&YFORM=INKUNDE&YKEY="_KUNDE
	. . SET YBACK="INLIEF,"
	. . DO VAR^WWWCGI
	. ;
	. ; "Possibly Also As A Customer Created"
	. DO ^WWWINFO($$^WWWTEXT(32797,,1)_"&nbsp;&nbsp;&nbsp;"_" ("_KUNDE_") "_$PIECE(YFELD,Y,8),0,YI)
	. DO ^WWWFORM2
	. SET Q=1         ;KEINE FORMULAR ANZEIG NACH INFO ;no form within 
	
	QUIT
	
ABACUS
	;-------------------------------------------------------------------------------
	;DATENSATZ FÜR ABACUS ;data record to abacus 
	;
	; History:
	; 11-Feb-2008	GRF		SR15627: Use $$$Save and objSupplier
	;-------------------------------------------------------------------------------
	new objSupplier,strStatus
	
	SET YH="^"
	SET YFELD=$TRANSLATE(YFELD,YH)  ;FEHLERHAFTE ZEICHEN ;sign 
	
	SET MAN=0 
	IF $PIECE(YFPARA,Y,2)'="" SET MAN=$PIECE(YFPARA,Y,2)  ;MANDANT IN FIBU ;Company within 
	QUIT:MAN=""
	IF $PIECE(YFPARA,Y,3)'="" SET BET=$PIECE(YFPARA,Y,3)  ;BETRIEB IN FIBU ;location within 
	SET UCI=YUCI
	IF $PIECE(YFPARA,Y,1)'="" SET UCI=$PIECE(YFPARA,Y,1)  ;NAMESPACE IN FIBU ;within 
	SET LKRE=6
	IF $PIECE(YFPARA,Y,5)'="" SET LKRE=$PIECE(YFPARA,Y,5)  ;LÄNGE KREDITOREN ;longitude 
	
	SET NAM=$TRANSLATE($PIECE(YFELD,Y,8),"""")  ;NAME OHNE "
	SET:NAM="" NAM=" "  ;NAME
	
	;SET YIDNU=$$^WWWUPER($PIECE(YFELD,Y,50))
	SET YIDNU=$zconvert($PIECE(YFELD,Y,50),"U")
	
	;I YIDNU'="" I $F(YIDNU,"DE") S YIDNU=""   ;IMMER?
	
	;DATENSATZ ;data record 
	SET SAT(1)=""
	SET SAT(2)=""
	
	IF $PIECE(YFELD,Y,4)'=""   SET $PIECE(SAT(1),YH,1)=$PIECE(YFELD,Y,4)    ;NAME1
	;IF $PIECE(YFELD,Y,5)'=""  SET $PIECE(SAT(1),YH,2)=$PIECE(YFELD,Y,6)    ;NAME2
	IF $PIECE(YFELD,Y,6)'=""   SET $PIECE(SAT(1),YH,2)=$PIECE(YFELD,Y,6)    ;BEC;NAME2;11.11.04;26766;
	IF $PIECE(YFELD,Y,10)'=""  SET $PIECE(SAT(1),YH,3)=$PIECE(YFELD,Y,10)   ;STRASSE
	IF $PIECE(YFELD,Y,12)'=""  SET $PIECE(SAT(1),YH,5)=$PIECE(YFELD,Y,12)   ;STRASSE PLZ ;ZIP 
	IF $PIECE(YFELD,Y,16)'=""  SET $PIECE(SAT(1),YH,7)=$PIECE(YFELD,Y,16)   ;ORT ;village 
	IF $PIECE(YFELD,Y,11)'=""  SET $PIECE(SAT(1),YH,4)=$PIECE(YFELD,Y,11)   ;POSTFACH
	IF $PIECE(YFELD,Y,13)'=""  SET $PIECE(SAT(1),YH,6)=$PIECE(YFELD,Y,13)   ;POSTFACH PLZ ;ZIP 
	IF $PIECE(YFELD,Y,92)'=""  SET $PIECE(SAT(1),YH,10)=$PIECE(YFELD,Y,92)  ;ANSPRECHPARTNER
	IF $PIECE(YFELD,Y,8)'=""   SET $PIECE(SAT(1),YH,9)=NAM                  ;KURZNAME
	IF $PIECE(YFELD,Y,20)'=""  SET $PIECE(SAT(1),YH,12)=$PIECE(YFELD,Y,20)  ;TELEFON
	IF $PIECE(YFELD,Y,22)'=""  SET $PIECE(SAT(1),YH,14)=$PIECE(YFELD,Y,22)  ;TELEFAX
	IF $PIECE(YFELD,Y,24)'=""  SET $PIECE(SAT(1),YH,15)=$PIECE(YFELD,Y,24)  ;EMAIL
	IF $PIECE(YFELD,Y,26)'=""  SET $PIECE(SAT(1),YH,16)=$PIECE(YFELD,Y,26)  ;INTERNET
	IF $PIECE(YFELD,Y,106)'="" SET $PIECE(SAT(2),YH,1)=$PIECE(YFELD,Y,106)  ;BLZ1
	IF $PIECE(YFELD,Y,107)'="" SET $PIECE(SAT(2),YH,2)=$PIECE(YFELD,Y,107)  ;SWIFT
	IF $PIECE(YFELD,Y,104)'="" SET $PIECE(SAT(2),YH,3)=$PIECE(YFELD,Y,104)  ;KONTO1
	IF $PIECE(YFELD,Y,116)'="" SET $PIECE(SAT(2),YH,4)=$PIECE(YFELD,Y,116)  ;BLZ2
	IF $PIECE(YFELD,Y,117)'="" SET $PIECE(SAT(2),YH,5)=$PIECE(YFELD,Y,117)  ;SWIFT
	IF $PIECE(YFELD,Y,114)'="" SET $PIECE(SAT(2),YH,6)=$PIECE(YFELD,Y,114)  ;KONTO2
	IF $PIECE(YFELD,Y,30)'=""  SET $PIECE(SAT(2),YH,8)=$PIECE(YFELD,Y,130)  ;KD NR LIEFERANT ;supplier 
	IF $PIECE(YFELD,Y,56)'=""  SET $PIECE(SAT(2),YH,9)=$PIECE(YFELD,Y,56)   ;ZAHLUNGSKONDITION
	IF $PIECE(YFELD,Y,102)'="" SET $PIECE(SAT(2),YH,10)=$PIECE(YFELD,Y,102) ;ZAHLUNGSWEG
	IF $PIECE(YFELD,Y,100)'="" SET $PIECE(SAT(2),YH,13)=$PIECE(YFELD,Y,100) ;RUNDUNG
	IF $PIECE(YFELD,Y,54)'=""  SET $PIECE(SAT(2),YH,14)=$PIECE(YFELD,Y,54)  ;STEUER ;tax 
	IF $PIECE(YFELD,Y,50)'=""  SET $PIECE(SAT(2),YH,15)=YIDNU               ;ID NR
	SET $PIECE(SAT(2),YH,16)=16000                                          ;VERBINDLICHKEITSKONTO
	IF $PIECE(YFPARA,Y,11)'="" SET $PIECE(SAT(2),YH,16)=$PIECE(YFPARA,Y,11) ;KONTO KOSTENLIEFEANT ;acct. 
	IF +$PIECE(YFELD,Y,52)=1 IF $PIECE(YFPARA,Y,10)'="" SET $PIECE(SAT(2),YH,16)=$PIECE(YFPARA,Y,10)  ;KONTO WARENLIEFERANT ;acct. 
	
	SET $PIECE(SAT(2),YH,17)=0      ;KONTIERUNGS-SPERRE
	SET $PIECE(SAT(2),YH,18)=$PIECE(YFELD,Y,69)   ;LAND ;rural 
	SET $PIECE(SAT(1),YH,8)=$PIECE(YFELD,Y,17)   ;LAND ;rural 
	IF $PIECE(SAT(2),YH,18)="" SET $PIECE(SAT(2),YH,18)="DE"   ;SPRACHE FUER KORRESPONDENZ ;Language 
	SET $PIECE(SAT(2),YH,25)="0"    ;DIVERSER KREDITOR
	SET $PIECE(SAT(2),YH,14)=$PIECE(YFELD,Y,54)   ;STEUERKENNZEICHEN
	
	;S $P(SAT(2),YH,15)=$P(YFELD,Y,50)   ;EG-ID
	SET $PIECE(SAT(1),YH,11)=0   ;ANREDE ;salutation 
	
	SET A1=SAT(1) SET SAT(1)=A1 SET A1=SAT(2) SET SAT(2)=A1
	
	FOR I=1,2 SET SAT2(I)=SAT(I) SET SAT1(I)=$GET(^INKR01U(MAN,1,BET,KRED,I))
	
	;IF SAT1(1)'="" DO   ;PRUEFEN GELÖSCHTE
	;. FOR I=1:1:60 IF $PIECE(SAT(1),YH,I)="" IF $PIECE(SAT1(1),YH,I)'="" SET $PIECE(SAT2(1),YH,I)="GELOESCHT"
	;. FOR I=1:1:60 IF $PIECE(SAT(2),YH,I)="" IF $PIECE(SAT1(2),YH,I)'="" SET $PIECE(SAT2(2),YH,I)="GELOESCHT"
	
	FOR I=1,2 SET ^|UCI|FKR01U(MAN,1,BET,KRED,I)=SAT2(I)
	FOR I=1,2 SET ^INKR01U(MAN,1,BET,KRED,I)=SAT(I)   ;ZWISCHENDATEI ZUR PRUEFUNG
	
	;S ^|UCI|FKR01U(MAN,2,NAM,BET,KRED)=""  ;SORTKEY
	;SET $PIECE(^INLIEF(YM,YKEY,1),Y,67)=+$HOROLOG   ;ANLAGEDATUM      ; SR15627
	set objSupplier = $get(^INLIEF(YM,YKEY,1))
	set $$$INLIEFAccountPayableIntoFIBUTra(objSupplier) = +$horolog    ; D67     Tra...nsfer
	set strStatus=$$$Save("INLIEF",YKEY,objSupplier,$$$YES)
	
	SET MANSS=MAN
	SET BETSS=BET
	FOR  SET BET=$ORDER(^INFIBPAR(0,YM,BET)) QUIT:BET=""   ;WENN MEHRERE MANDANTEN ;when divers 
	. QUIT:BET=""
	. SET YFPARA=$GET(^INFIBPAR(0,YM,BET,1))
	. SET MAN=0 
	. IF $PIECE(YFPARA,Y,2)'="" SET MAN=$PIECE(YFPARA,Y,2)  ;MANDANT IN FIBU ;Company within 
	. IF MAN=MANSS QUIT   ;GLEICHER MANDANT ;same Company 
	. QUIT:MAN=""
	. IF $PIECE(YFPARA,Y,3)'="" SET BET=$PIECE(YFPARA,Y,3)  ;BETRIEB IN FIBU ;location within 
	. SET UCI=YUCI
	. IF $PIECE(YFPARA,Y,1)'="" SET UCI=$PIECE(YFPARA,Y,1)  ;NAMESPACE IN FIBU ;within 
	. FOR I=1,2 SET SAT2(I)=SAT(I) SET SAT1(I)=$GET(^INKR01U(MAN,1,BET,KRED,I))
	. ;IF SAT1(1)'="" DO   ;PRUEFEN GELÖSCHTE
	. ;. FOR I=1:1:60 IF $PIECE(SAT(1),YH,I)="" IF $PIECE(SAT1(1),YH,I)'="" SET $PIECE(SAT2(1),YH,I)="GELOESCHT"
	. ;. FOR I=1:1:60 IF $PIECE(SAT(2),YH,I)="" IF $PIECE(SAT1(2),YH,I)'="" SET $PIECE(SAT2(2),YH,I)="GELOESCHT"
	. ;
	. FOR I=1,2 SET ^|UCI|FKR01U(MAN,1,BET,KRED,I)=SAT2(I)
	. FOR I=1,2 SET ^INKR01U(MAN,1,BET,KRED,I)=SAT(I)   ;ZWISCHENDATEI ZUR PRUEFUNG
	. ;S ^|UCI|FKR01U(MAN,2,NAM,BET,KRED)=""  ;KREDITOR
	
	QUIT
	
	
DISC ;DATENSATZ FÜR DISC ;data record to DISC 
	
	QUIT  ;NICHT MEHR NÖTIG; 7.4.2003
	
	/* vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLES FOLLOWING BLOCK
	
	NEW TYPE,USAGE,SIGN,REST,PARENT
	
	SET MAN=0 
	IF $PIECE(YFPARA,Y,2)'="" SET MAN=$PIECE(YFPARA,Y,2)  ;MANDANT IN FIBU ;Company within 
	QUIT:MAN=""
	IF $PIECE(YFPARA,Y,3)'="" SET BET=$PIECE(YFPARA,Y,3)  ;BETRIEB IN FIBU ;location within 
	SET UCI=YUCI
	IF $PIECE(YFPARA,Y,1)'="" SET UCI=$PIECE(YFPARA,Y,1)  ;NAMESPACE IN FIBU ;within 
	SET LKRE=6
	IF $PIECE(YFPARA,Y,5)'="" SET LKRE=$PIECE(YFPARA,Y,5)  ;LÄNGE KREDITOREN ;longitude 
	
	DO
	. QUIT:BET=""
	. SET URL=$PIECE(YFPARA,Y,30) 
	. QUIT:URL=""  ;NO URL FOR XML ;URL XML 
	. SET REST=""
	. IF $EXTRACT(URL,$LENGTH(URL))'="?" SET URL=URL_"?"
	. SET REST=REST_"soap_method=LedAccount&"
	. SET REST=REST_"Number="_KRED_"&"
	. SET REST=REST_"Description="_$PIECE(YFELD,Y,8)_"&"
	. SET TYPE=4  ;PASSIVE
	. SET REST=REST_"AccountType="_TYPE_"&"
	. DO
	. . SET PARENT="4.00.0000"
	. ;
	. SET REST=REST_"Parent="_PARENT_"&"
	. SET USAGE=4
	. SET REST=REST_"AccountUsage="_USAGE_"&"
	. SET SIGN=2  ;HABEN ;have got 
	. SET REST=REST_"Sign="_SIGN
	. SET ^WWWXMLSOAP(YM,$$^WWWNEXT("WWWXMLSOAP"),1)=URL_REST
	. LOCK +^WWWXMLSOAP:0 IF $TEST DO
	. . LOCK -^WWWXMLSOAP
	. . JOB ^WWWXMLSOAP
	
	LOCK -^WWWXMLSOAP
	QUIT
	;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	*/
	
	
SIMBA
	;-------------------------------------------------------------------------------
	;	SIMBA FIBU
	;
	; History:
	; 11-Feb-2008	GRF		SR15627: Use $$$Save and objSupplier
	;-------------------------------------------------------------------------------
	new objSupplier,strStatus
	
	SET YH=";"
	SET YFELD=$TRANSLATE(YFELD,YH)  ;FEHLERHAFTE ZEICHEN ;sign 
	SET MAN=0 
	IF $PIECE(YFPARA,Y,2)'="" SET MAN=$PIECE(YFPARA,Y,2)  ;MANDANT IN FIBU ;Company within 
	QUIT:MAN=""
	IF $PIECE(YFPARA,Y,3)'="" SET BET=$PIECE(YFPARA,Y,3)  ;BETRIEB IN FIBU ;location within 
	SET UCI=YUCI
	IF $PIECE(YFPARA,Y,1)'="" SET UCI=$PIECE(YFPARA,Y,1)  ;NAMESPACE IN FIBU ;within 
	SET LKRED=6
	IF $PIECE(YFPARA,Y,5)'="" SET LKRED=$PIECE(YFPARA,Y,5)  ;LÄNGE KREDITORENNR ;longitude 
	
	SET KRED=$PIECE(YFELD,Y,48)  ;KREDITOREN NUMMER  ;numeral 
	IF KRED="" SET KRED=YKEY
	QUIT:$LENGTH(+KRED)'=LKRED   ;MUSS LKRED STELLEN HABEN ;put down have got 
	
	IF '$DATA(^INFIBEXPO(YM)) DO
	. SET NUM=$$^WWWNEXT("INFIBEXPO")
	. SET ^INFIBEXPO(YM,NUM,1)=$$^INFIBGF("MND"_YH_MAN)  ;MANDANTENKENNUNG
	. ;     
	. SET NUM=$$^WWWNEXT("INFIBEXPO")
	. SET ^INFIBEXPO(YM,NUM,1)=$$^INFIBGF("BZR"_YH_$EXTRACT(100+$$^WWWMONTH(),2,3)_$$^WWWYEAR())  ;MANDANTENKENNUNG
	
	SET NUM=$$^WWWNEXT("INFIBEXPO")
	DO  
	. SET:NAM="" NAM=" "  ;NAME
	. ;
	. ;SET YIDNU=$$^WWWUPER($PIECE(YFELD,Y,50))
	. SET YIDNU=$zconvert($PIECE(YFELD,Y,50),"U")
	. ;
	. ;DATENSATZ ;data record 
	. SET SAT2(1)=""
	. SET SAT(1)=""
	. SET $PIECE(SAT(1),YH,30)=""
	. ;
	. SET $PIECE(SAT(1),YH,1)="KKS"  ;KENNUNG FIX ;skillful 
	. SET $PIECE(SAT(1),YH,2)=KRED   ;KONTONUMMER
	. SET $PIECE(SAT(1),YH,3)=$TRANSLATE($$^WWWDATE(+$HOROLOG),"-./")         ;DATUM ;Date
	. IF $PIECE(YFELD,Y,3)'=""   SET $PIECE(SAT(1),YH,7)=$PIECE($GET(^INPARA(YM,"ANREDE",SPRACHE,$PIECE(YFELD,Y,3),1)),Y,1)     ;ANREDE ;FIS;29.02.05
	. IF $PIECE(YFELD,Y,4)'=""   SET $PIECE(SAT(1),YH,8)=$PIECE(YFELD,Y,4)    ;NAME1
	. IF $PIECE(YFELD,Y,6)'=""   SET $PIECE(SAT(1),YH,9)=$PIECE(YFELD,Y,6)    ;NAME2 ;BEC;26766;11.11.04
	. IF $PIECE(YFELD,Y,10)'=""  SET $PIECE(SAT(1),YH,10)=$PIECE(YFELD,Y,10)  ;STRASSE
	. IF $PIECE(YFELD,Y,12)'=""  SET $PIECE(SAT(1),YH,12)=$PIECE(YFELD,Y,12)  ;STRASSE PLZ ;ZIP 
	. IF $PIECE(YFELD,Y,16)'=""  SET $PIECE(SAT(1),YH,13)=$PIECE(YFELD,Y,16)  ;ORT ;village 
	. IF +$PIECE(YFELD,Y,11)'=0  SET $PIECE(SAT(1),YH,28)=+$PIECE(YFELD,Y,11) ;POSTFACH
	. IF $PIECE(YFELD,Y,13)'=""  SET $PIECE(SAT(1),YH,29)=$PIECE(YFELD,Y,13)  ;POSTFACH PLZ ;ZIP 
	.;IF $PIECE(YFELD,Y,92)'=""  SET $PIECE(SAT(1),YH,9)=$PIECE(YFELD,Y,92)   ;ANSPRECHPARTNER
	.;SET $PIECE(SAT(1),YH,7)=0                                               ;ANREDE
	.;IF $PIECE(YFELD,Y,3)'=""   SET $PIECE(SAT(1),YH,7)=$PIECE(YFELD,Y,3)    ;ANREDEKENNZEICHEN
	. IF $PIECE(YFELD,Y,19)'=""  SET $PIECE(SAT(1),YH,18)=$PIECE(YFELD,Y,19)  ;ANREDE  ;salutation 
	. IF $PIECE(YFELD,Y,8)'=""   SET $PIECE(SAT(1),YH,4)=$EXTRACT(NAM,1,30)   ;_", "_$PIECE(YFELD,Y,16),1,30)   ;KURZNAME
	. IF $PIECE(YFELD,Y,20)'=""  SET $PIECE(SAT(1),YH,21)=$PIECE(YFELD,Y,20)  ;TELEFON
	. IF $PIECE(YFELD,Y,22)'=""  SET $PIECE(SAT(1),YH,22)=$PIECE(YFELD,Y,22)  ;TELEFAX
	.;IF $PIECE(YFELD,Y,24)'=""  SET $PIECE(SAT(1),YH,)=$PIECE(YFELD,Y,24)    ;EMAIL
	.;IF $PIECE(YFELD,Y,26)'=""  SET $PIECE(SAT(1),YH,)=$PIECE(YFELD,Y,26)    ;INTERNET
	. IF $PIECE(YFELD,Y,106)'="" SET $PIECE(SAT(1),YH,23)=$PIECE(YFELD,Y,106) ;BLZ1
	.;IF $PIECE(YFELD,Y,107)'="" SET $PIECE(SAT(1),YH,)=$PIECE(YFELD,Y,107)   ;SWIFT
	. IF $PIECE(YFELD,Y,104)'="" SET $PIECE(SAT(1),YH,24)=$PIECE(YFELD,Y,104) ;KONTO1
	.;IF $PIECE(YFELD,Y,116)'="" SET $PIECE(SAT(1),YH,)=$PIECE(YFELD,Y,116)   ;BLZ2
	.;IF $PIECE(YFELD,Y,117)'="" SET $PIECE(SAT(1),YH,)=$PIECE(YFELD,Y,117)   ;SWIFT
	.;IF $PIECE(YFELD,Y,114)'="" SET $PIECE(SAT(1),YH,)=$PIECE(YFELD,Y,114)   ;KONTO2
	. IF $PIECE(YFELD,Y,30)'=""  SET $PIECE(SAT(1),YH,15)=$PIECE(YFELD,Y,30)  ;KD NR LIEFERANT ;supplier 
	. IF $PIECE(YFELD,Y,56)'=""  SET $PIECE(SAT(1),YH,17)=$PIECE(YFELD,Y,56)  ;ZAHLUNGSKONDITION
	.;IF $PIECE(YFELD,Y,102)'="" SET $PIECE(SAT(1),YH,26)=$PIECE(YFELD,Y,102) ;ZAHLUNGSWEG
	.;IF $PIECE(SAT(1),Y,26)>3   SET $PIECE(SAT(1),YH,26)=""                  ;ZAHLUNGSWEG
	. SET $PIECE(SAT(1),YH,26)=""                               ;ZAHLUNGSWEG  ;FIS;10.12.04;26705
	. IF $PIECE(YFELD,Y,102)=1   SET $PIECE(SAT(1),YH,26)=2                   ;ÜBERWEISUNG
	. IF $PIECE(YFELD,Y,102)=2   SET $PIECE(SAT(1),YH,26)=3                   ;SCHECK
	. IF $PIECE(YFELD,Y,102)=11  SET $PIECE(SAT(1),YH,26)=1                   ;LASTSCHRIFT (KREDITOR)
	.;IF $PIECE(YFELD,Y,33)'=""  SET $PIECE(SAT(1),YH,)=$PIECE(YFELD,Y,33)    ;LIMIT
	.;IF $PIECE(YFELD,Y,100)'="" SET $PIECE(SAT(1),YH,)=$PIECE(YFELD,Y,100)   ;RUNDUNG
	.;IF $PIECE(YFELD,Y,54)'=""  SET $PIECE(SAT(1),YH,)=$PIECE(YFELD,Y,54)    ;STEUER
	. SET $PIECE(SAT(1),YH,20)=""                                             ;MAHNUNG ;reminder 
	. IF $PIECE(YFELD,Y,50)'=""  SET $PIECE(SAT(1),YH,5)=YIDNU                ;ID NR
	.;SET $PIECE(SAT(1),YH,)=14000  ;FORDERUNGSKONTO
	.;IF $PIECE(YFPARA,Y,9)'=""  SET $PIECE(SAT(1),YH,)=$PIECE(YFPARA,Y,9)  ;KONTO
	.;SET $PIECE(SAT(1),YH,)=0      ;KONTIERUNGS-SPERRE
	. SET $PIECE(SAT(1),YH,19)=$EXTRACT($PIECE(YFELD,Y,69))   ;LAND ;rural 
	. SET $PIECE(SAT(1),YH,11)=$PIECE(YFELD,Y,17)   ;LAND ;rural 
	. IF $PIECE(SAT(1),YH,19)="" SET $PIECE(SAT(1),YH,19)="D"   ;SPRACHE FUER KORRESPONDENZ ;Language 
	. ;SET $PIECE(SAT(1),YH,)=0    ;DIVERSER KREDITOR = NEIN
	. ;SET $PIECE(SAT(1),YH,)=1    ;MAHNTEXT FEST 1
	. ;SET $PIECE(SAT(1),YH,)=1    ;MAHNADRESSE
	. ;SET $PIECE(SAT(1),YH,)=$PIECE(YFELD,Y,54)   ;STEUERKENNZEICHEN
	. ;
	. SET SAT2(1)=SAT(1)
	. SET SAT1(1)=$GET(^INKR01U(MAN,5,BET,KRED,1))
	. ;IF SAT1(1)'="" DO   ;PRUEFEN GELÖSCHTE
	. ;. FOR I=1:1:60 IF $PIECE(SAT(1),YH,I)="" IF $PIECE(SAT1(1),YH,I)'="" SET $PIECE(SAT2(1),YH,I)="GELOESCHT"
	. ;
	. IF $PIECE(SAT2(1),YH,4,99)=$PIECE(SAT1(1),YH,4,99) QUIT  ;KEINE ÄNDERUNG ;no alteration 
	. SET ^INKR01U(MAN,5,BET,KRED,1)=SAT(1)                    ;ZWISCHENDATEI ZUR PRUEFUNG
	.;
	.;SET $PIECE(^INLIEF(YM,YKEY,1),Y,67)=+$HOROLOG   ;ANLAGEDATUM      ; SR15627
	. set objSupplier = $get(^INLIEF(YM,YKEY,1))
	. set $$$INLIEFAccountPayableIntoFIBUTra(objSupplier) = +$horolog    ; D67     Tra...nsfer
	. set strStatus=$$$Save("INLIEF",YKEY,objSupplier,$$$YES)
	. ;
	. SET ^INFIBEXPO(YM,NUM,1)=$$^INFIBGF(SAT2(1))
	
	QUIT
	
	
FIBUNET
	SET YH=";"
	SET YFELD=$TRANSLATE(YFELD,YH)  ;FEHLERHAFTE ZEICHEN ;sign 
	SET MAN=0 
	IF $PIECE(YFPARA,Y,2)'="" SET MAN=$PIECE(YFPARA,Y,2)  ;MANDANT IN FIBU ;Company within 
	QUIT:MAN=""
	IF $PIECE(YFPARA,Y,3)'="" SET BET=$PIECE(YFPARA,Y,3)  ;BETRIEB IN FIBU ;location within 
	SET UCI=YUCI
	IF $PIECE(YFPARA,Y,1)'="" SET UCI=$PIECE(YFPARA,Y,1)  ;NAMESPACE IN FIBU ;within 
	SET LKRED=6
	IF $PIECE(YFPARA,Y,4)'="" SET LKRED=$PIECE(YFPARA,Y,4)  ;LÄNGE KREDITORENNR ;longitude 
	
	SET KRED=$PIECE(YFELD,Y,48)  ;KREDITOREN NUMMER  ;numeral 
	IF KRED="" SET KRED=YKEY
	QUIT:$LENGTH(+KRED)'=LKRED   ;MUSS LKRED STELLEN HABEN ;put down have got 
	
	IF '$DATA(^INFIBEXPO(YM)) DO
	. SET NUM=$$^WWWNEXT("INFIBEXPO")
	. SET ^INFIBEXPO(YM,NUM,1)=$$^INFIBGF("0001"_YH_"0"_YH_1)  ;START ;take-off 
	
	DO 
	. SET:NAM="" NAM=" "  ;NAME
	. ;
	. ;SET YIDNU=$$^WWWUPER($PIECE(YFELD,Y,50))
	. SET YIDNU=$zconvert($PIECE(YFELD,Y,50),"U")
	. ;
	. ;DATENSATZ ;data record 
	. SET SAT(1)=""
	. SET $PIECE(SAT(1),YH,20)=""
	. ;
	. SET $PIECE(SAT(1),YH,1)="2010"  ;KENNUNG FIX ;skillful 
	. SET $PIECE(SAT(1),YH,2)="0"     ;KENNUNG
	. SET $PIECE(SAT(1),YH,3)=KRED    ;KONTONUMMER
	. SET $PIECE(SAT(1),YH,4)=$EXTRACT($PIECE(YFELD,Y,4)_" "_$PIECE(YFELD,Y,6),1,40)  ;NAME1
	. SET $PIECE(SAT(1),YH,6)="0"     ;KENNUNG
	. SET $PIECE(SAT(1),YH,7)="0"     ;INLAND KENNUNG
	. IF $PIECE(YFELD,Y,17)'="" IF $PIECE(YFELD,Y,17)'="DE" SET $PIECE(SAT(1),YH,7)=2   ;LAND ;country 
	. IF $PIECE(YFELD,Y,54)=2 SET $PIECE(SAT(1),YH,7)=1   ;EU LAND ;country 
	. SET $PIECE(SAT(1),YH,8)="0"     ;SPERRE ;suspension 
	. SET $PIECE(SAT(1),YH,14)=$PIECE(YFELD,Y,8)  ;NAME
	. SET $PIECE(SAT(1),YH,22)=YKEY   ;NUMMER ;numeral 
	. SET NUM=$$^WWWNEXT("INFIBEXPO")
	. SET ^INFIBEXPO(YM,NUM,1)=$$^INFIBGF(SAT(1)) 
	. ;
	. SET SAT(1)=""
	. SET $PIECE(SAT(1),YH,12)=""
	. SET $PIECE(SAT(1),YH,1)="2011"              ;KENNUNG FIX ;skillful 
	. SET $PIECE(SAT(1),YH,2)=$PIECE(YFELD,Y,4)   ;NAME1
	. SET $PIECE(SAT(1),YH,3)=$PIECE(YFELD,Y,6)   ;NAME2
	. SET $PIECE(SAT(1),YH,4)=$PIECE(YFELD,Y,10)  ;STRASSE
	. SET $PIECE(SAT(1),YH,4)=$PIECE(YFELD,Y,17)  ;LAND ;country 
	. IF $PIECE(YFELD,Y,12)'="" SET $PIECE(SAT(1),YH,6)=$PIECE(YFELD,Y,12)   ;STRASSE PLZ ;ZIP 
	. IF $PIECE(YFELD,Y,16)'="" SET $PIECE(SAT(1),YH,7)=$PIECE(YFELD,Y,16)   ;ORT ;village 
	. IF +$PIECE(YFELD,Y,11)'=0 SET $PIECE(SAT(1),YH,12)=+$PIECE(YFELD,Y,11) ;POSTFACH
	. IF $PIECE(YFELD,Y,13)'="" SET $PIECE(SAT(1),YH,11)=$PIECE(YFELD,Y,13)  ;POSTFACH PLZ ;ZIP 
	. SET NUM=$$^WWWNEXT("INFIBEXPO")
	. SET ^INFIBEXPO(YM,NUM,1)=$$^INFIBGF(SAT(1))
	. ;
	. SET SAT(1)=""
	. SET $PIECE(SAT(1),YH,12)=""
	. SET $PIECE(SAT(1),YH,1)="2012"  ;KENNUNG FIX ;skillful 
	. IF $PIECE(YFELD,Y,106)'="" SET $PIECE(SAT(1),YH,3)=$PIECE(YFELD,Y,106)  ;BLZ1
	. IF $PIECE(YFELD,Y,104)'="" SET $PIECE(SAT(1),YH,2)=$PIECE(YFELD,Y,104)  ;KONTO1
	. IF $PIECE(YFELD,Y,30)'=""  SET $PIECE(SAT(1),YH,9)=$PIECE(YFELD,Y,30)   ;KD NR LIEFERANT ;supplier 
	. IF $PIECE(YFELD,Y,56)'=""  SET $PIECE(SAT(1),YH,4)=$PIECE(YFELD,Y,56)   ;ZAHLUNGSKONDITION
	. IF $PIECE(YFELD,Y,102)'="" SET $PIECE(SAT(1),YH,5)=+$PIECE(YFELD,Y,102) ;ZAHLUNGSWEG
	. IF $PIECE(SAT(1),Y,26)>3   SET $PIECE(SAT(1),YH,5)=0  ;ZAHLUNGSWEG
	. SET $PIECE(SAT(1),YH,7)=0  ;SKOT
	. SET NUM=$$^WWWNEXT("INFIBEXPO")
	. SET ^INFIBEXPO(YM,NUM,1)=$$^INFIBGF(SAT(1))
	. ;
	. IF $PIECE(YFELD,Y,50)'="" DO
	. . SET SAT(1)=""
	. . SET $PIECE(SAT(1),YH,12)=""
	. . SET $PIECE(SAT(1),YH,1)="2013"  ;KENNUNG FIX ;skillful 
	. . IF $PIECE(YFELD,Y,50)'="" SET $PIECE(SAT(1),YH,2)=YIDNU  ;ID NR
	. . IF $PIECE(YFELD,Y,107)'="" SET $PIECE(SAT(1),YH,10)=$PIECE(YFELD,Y,107)  ;SWIFT
	. . SET NUM=$$^WWWNEXT("INFIBEXPO")
	. . SET ^INFIBEXPO(YM,NUM,1)=$$^INFIBGF(SAT(1))
	
	
	SET NUM=$$^WWWNEXT("INFIBEXPO")
	SET ^INFIBEXPO(YM,NUM,1)=$$^INFIBGF("0005"_YH_"End")  ;
	QUIT
	
]]></Routine>
</Export>