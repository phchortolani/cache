<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INREPLRULESUB" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INREPLRULESUB(TYPE,NAME) ;INREPLRULE;FIS;GETTING VALUE OF RULE;20.05.2003
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		GETTING VALUE OF RULE
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FIS	20.05.2003
	;|
	;\------------------------------------------------------------------/
	;
	NEW VALUE,CODE,COND,DELIM,YI,PARA,FUNCT,PARA1,FEXIT,TYPE1,SAVFUNCT
	SET VALUE=""
	SET FUNCT=""
	SET NAME=$G(NAME)
	QUIT:NAME="" VALUE
	SET TYPE=$G(TYPE)
	QUIT:TYPE="" VALUE
	SET YRLOCATION=$G(YRLOCATION)
	SET YRGROUP=$G(YRGROUP)
	SET YRITEM=$G(YRITEM)
	SET TYPE1=$G(^INREPLRULESUB(YM,TYPE,NAME,1))
	SET COND(1)=$P(TYPE1,Y,4)  ;CONDITION 1
	SET CODE(1)=$P(TYPE1,Y,2)  ;CALCUALTION 1
	SET COND(2)=$P(TYPE1,Y,5)  ;CONDITION 2
	SET CODE(2)=$P(TYPE1,Y,6)  ;CALCULATION 2
	SET FEXIT=+$P(TYPE1,Y,7)  ;FAST EXIT ;next 
	FOR YI=1,2 DO
	. QUIT:CODE(YI)=""  ;NO CALCULATION
	. ;
	. ;EXTRACT SYSTEM VARIABLES
	. SET PARA="" FOR  SET PARA=$O(^INREPLSYS(YM,PARA)) QUIT:PARA=""  DO
	. . IF $F(CODE(YI),""""_PARA_"""")!$F(COND(YI),""""_PARA_"""")  DO
	. . . SET PARA1=""
	. . . DO
	. . . . IF YRLOCATION'="" IF YRITEM'="" IF $D(^INREPLDATA(YM,TYPE,YRLOCATION,YRITEM,PARA)) DO  QUIT  ;OUT OF TEMP FILE
	. . . . . SET PARA1=$P($G(^INREPLDATA(YM,TYPE,YRLOCATION,YRITEM,PARA,1)),Y,1)
	. . . . . QUIT
	. . . . ;IF YRLOCATION'="" IF YRITEM'="" IF $D(^INREPLDATA(YM," ",YRLOCATION,YRITEM,PARA)) DO  QUIT  ;" " WENN TYPE="" (S.INREPLSYS)
	. . . . ;.SET PARA1=$P($G(^INREPLDATA(YM," ",YRLOCATION,YRITEM,PARA,1)),Y,1)
	. . . . ;.QUIT
	. . . . SET PARA1=$G(^INREPLPARAM(YM,PARA,1))  ;OUT OF TEMP FILE OF ALWAYS VALID VARIABLES
	. . . . IF PARA1="" SET PARA1=$$^INREPLSYS(PARA)  ;GET NEW
	. . . . QUIT
	. . . DO  ;IF PARA1'="" DO
	. . . . IF PARA1="" SET PARA1=""""_""""
	. . . . NEW CODEX,YII
	. . . . ;CONDITION
	. . . . SET CODEX=""
	. . . . SET COND(YI)=COND(YI)_Y
	. . . . FOR YII=1:1  QUIT:$P(COND(YI),""""_PARA_"""",YII,999)=""  DO
	. . . . . SET CODEX=CODEX_$P(COND(YI),""""_PARA_"""",YII)
	. . . . . IF $P(COND(YI),""""_PARA_"""",YII+1)'="" SET CODEX=CODEX_PARA1
	. . . . . QUIT
	. . . . SET COND(YI)=$P(CODEX,Y,1)
	. . . . ;CODE
	. . . . SET CODEX=""
	. . . . SET CODE(YI)=CODE(YI)_Y
	. . . . FOR YII=1:1  QUIT:$P(CODE(YI),""""_PARA_"""",YII,999)=""  DO
	. . . . . SET CODEX=CODEX_$P(CODE(YI),""""_PARA_"""",YII)
	. . . . . IF $P(CODE(YI),""""_PARA_"""",YII+1)'="" SET CODEX=CODEX_PARA1
	. . . . . QUIT
	. . . . SET CODE(YI)=$P(CODEX,Y,1)
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. ;
	. ;EXTRACT RULE VARIABLES
	. SET PARA="" FOR  SET PARA=$O(^INREPLRULESUB(YM,TYPE,PARA)) QUIT:PARA=""  DO
	. . IF $F(CODE(YI),""""_PARA_"""")!$F(COND(YI),""""_PARA_"""")  DO
	. . . SET PARA1=""
	. . . DO
	. . . . IF YRLOCATION'="" IF YRITEM'="" IF $D(^INREPLDATA(YM,TYPE,YRLOCATION,YRITEM,PARA)) DO  QUIT:PARA1'=""  ;OUT OF TEMP FILE
	. . . . . SET PARA1=$P($G(^INREPLDATA(YM,TYPE,YRLOCATION,YRITEM,PARA,1)),Y,1)
	. . . . . QUIT
	. . . . QUIT:PARA=NAME  ;ITSELF
	. . . . SET PARA1=$$^INREPLRULESUB(TYPE,PARA)  ;GET NEW
	. . . . QUIT
	. . . DO  ;IF PARA1'="" DO
	. . . . IF PARA1="" SET PARA1=""""_""""
	. . . . NEW CODEX,YII
	. . . . ;CONDITION
	. . . . SET CODEX=""
	. . . . SET COND(YI)=COND(YI)_Y
	. . . . FOR YII=1:1  QUIT:$P(COND(YI),""""_PARA_"""",YII,999)=""  DO
	. . . . . SET CODEX=CODEX_$P(COND(YI),""""_PARA_"""",YII)
	. . . . . IF $P(COND(YI),""""_PARA_"""",YII+1)'="" SET CODEX=CODEX_PARA1
	. . . . . QUIT
	. . . . SET COND(YI)=$P(CODEX,Y,1)
	. . . . ;CODE
	. . . . SET CODEX=""
	. . . . SET CODE(YI)=CODE(YI)_Y
	. . . . FOR YII=1:1  QUIT:$P(CODE(YI),""""_PARA_"""",YII,999)=""  DO
	. . . . . SET CODEX=CODEX_$P(CODE(YI),""""_PARA_"""",YII)
	. . . . . IF $P(CODE(YI),""""_PARA_"""",YII+1)'="" SET CODEX=CODEX_PARA1
	. . . . . QUIT
	. . . . SET CODE(YI)=$P(CODEX,Y,1)
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. ;
	. DO
	. . QUIT:CODE(YI)=""
	. . NEW BOOLEAN,FUNCT,FUNCT1
	. . SET FUNCT=""
	. . SET FUNCT1=""
	. . SET BOOLEAN=0
	. . IF COND(YI)="" SET BOOLEAN=1  ;NO CONDITION
	. . IF COND(YI)'="" SET FUNCT="IF "_COND(YI)_" SET BOOLEAN=1 "  ;if xxx set BOOLEAN=1 ...
	. . SET FUNCT=FUNCT_"SET VALUE="_CODE(YI)  ;... set VALUE=xxx
	. . IF FEXIT=1 SET FUNCT1=" IF VALUE="_""""_""""_" SET FASTEXIT=1"
	. . SET SAVFUNCT=$G(SAVFUNCT)_" ["_YI_"] "_$P(FUNCT," SET BOOLEAN=1 ",1)_$P(FUNCT," SET BOOLEAN=1",2)
	. . XECUTE FUNCT
	. . IF FUNCT1'="" XECUTE FUNCT1
	. . ;EXIT IF FALSE !
	. . IF BOOLEAN=0 DO  QUIT
	. . . SET SAVFUNCT=SAVFUNCT_" ("_$$^WWWTEXT(33423)_")"  ;FALSE
	. . . SET ^INREPLDATA(YM,TYPE,YRLOCATION,YRITEM,NAME,1)=$P($G(^INREPLDATA(YM,TYPE,YRLOCATION,YRITEM,NAME,1)),Y,1)_Y_SAVFUNCT_Y_+$H
	. . . QUIT
	. . IF COND(YI)'="" SET SAVFUNCT=SAVFUNCT_" ("_$$^WWWTEXT(33422)_")"  ;TRUE
	. . IF YRLOCATION'="" IF YRITEM'="" SET ^INREPLDATA(YM,TYPE,YRLOCATION,YRITEM,NAME,1)=VALUE_Y_SAVFUNCT_Y_+$H
	. . IF $G(YBGJOB)=0 WRITE "("_$$^WWWTEXT(388)_": "_YRLOCATION_" "_$$^WWWTEXT(32024)_": "_YRITEM_") "_NAME_": "_VALUE,"<BR>",!  ;LOCATION,ITEM,PARAMETER,VALUE
	. . QUIT
	. QUIT
	QUIT VALUE
]]></Routine>
</Export>