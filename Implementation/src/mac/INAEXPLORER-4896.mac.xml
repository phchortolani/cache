<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAEXPLORER" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAEXPLORER
    ;--------------------------------------------------------------------------------
	; Description of Function :
	;		ANZEIGEN AUFTRAG IN EXPLORER FORM
	;
	;	STARTPUNKT DES EXPLORER MENUES AUS CGI ;out of 
	; 
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 15-Jan-2009	GRF		SR15853: Pass audit string to NewUserSession
	; 19-Aug-2008	FIS		SR15853: create session in common routine
	; 18.06.2000	DT
    ;--------------------------------------------------------------------------------
	new (%request,%session,%KEY,%,%ZCS,%CGIEVAR)
	
	DO ^WWWVORG  ;VORGABEN SETZEN ;typeset 
	SET YBED=$GET(YBED)   ;BEDIENER VORGABE ;handicap 
	IF $GET(YUSER)="" DO   ;KEIN USER ANGEGEBEN ;no 
	. set YUSER = $$NewUserSession^WWWUSER("INAEXPLORER")  ;SR15853
	. ;FOR  SET YUSER=$RANDOM(10000000) QUIT:'$DATA(^WWWUSER(0,YUSER))
	. SET %(YQUERY,"YUSER")=YUSER
	. SET ^WWWUSER(0,YUSER,1)=Y_$GET(YBED)
	
	KILL ^WWWSOR(YUSER)  ;VORGABE LÖSCHEN ;handicap Delete 
	
	;&FILE		= DATEI DIE ANGEZEIGT WIRD (STANDARD=WWWEXPLORE) ;who 
	;&FIX		= FESTER ERSTER KEY (NUR WENN &FILE) ;premier KEY when 
	;&MENUE		= UNTERMENUENAME BEI WWWEXPLORE ;next to 
	;&RECORD	= FELDER DIE ANGEZEIGT WERDEN SOLLEN (STANDARD=1) ;who will should 
	;&OFFSET	= STRUKTUR (WIRD GEBILDET)
	;&HEAD		= TEXT FÜR HEADER ;to 
	;VORGABEN AUS CGI ;out of 
	
	SET YDATEI   = $GET(%(YQUERY,"FILE"))    ;ANZEIGE FILE
	IF YDATEI="" SET YDATEI="INAUFPXL"
	SET YUCI     = $GET(%(YQUERY,"YUCI"))    ;NAMESPACE
	SET YHEADER  = $GET(%(YQUERY,"HEAD"))    ;BEZEICHNUNG ;notation 
	SET YOBJECT  = ""  ;1=OBJECT -DANN LESEN MIT $LI ;read by means of 
	SET YRECORD  = $GET(%(YQUERY,"RECORD"))  ;FELDER, DIE ANGEZEIGT WERDEN (1,2,3,4)
	SET YOFFSET  = $GET(%(YQUERY,"OFFSET"))  ;ANZEIGE AB SUBSCRIPT ;advertisement Confirm. 
	SET YFIX     = $GET(%(YQUERY,"FIX"))     ;FESTER SUBSCRIPT AM BEGINN (MANDANT/DATEN) ;to the inauguration 
	SET YFORM    = $GET(%(YQUERY,"FORM"))    ;FORMNAME FÜR DATENBANK ;to class 
	SET YKEYNUM  = $GET(%(YQUERY,"KEY"))     ;DATENFELD DES KEY FÜR DIE DATENFELDER ;data item KEY to who 
	SET YCOLOR   = ""  ;$GET(%(YQUERY,"COLOR"))  ;AUSWAHL DER FARBE Z.B. 1-2-RED,.. DATENFELD-WENN FELD=2-DANN FARBE VERWENDEN 
	SET YPIC     = ""  ;$GET(%(YQUERY,"PIC"))    ;AUSWAHL DER BILDER Z.B. 1-2-3,.. DATENFELD-WENN FELD=2-DANN BILD 2 VERWENDEN/ OHNE ANGABE=HTMLOBJEKT
	SET YAUFTRAG = $PIECE(YFIX,",",2)
	SET YPOS     = $PIECE(YFIX,",",3)
	IF YAUFTRAG="" SET YAUFTRAG = $PIECE(YOFFSET,",",2)
	IF YPOS=""     SET YPOS     = $PIECE(YOFFSET,",",3)
	SET YTARGET  = $GET(%(YQUERY,"TARGET"))  ;TARGET DER AUSGABE ;who expenses 
	SET YPWD     = ""  ;KEIN EDTI ;no 
	IF YDATEI="WWWEXPLORE" DO  ;MENUESYSTEM
	. SET YPWD     = $GET(%(YQUERY,"PWD"))        ;WENN PASSWORD DANN ÄNDERMÖGLICHKEIT ;when 
	. SET YRECORD  = 1                            ;NUR TEXT ANZEIGEN ;only Text give notice 
	. SET YKILL    = $GET(%(YQUERY,"KILL"))       ;WENN PASSWORD LÖSCHMÖGLICHKEIT 1=KILL ;when 
	. SET YSET     = $GET(%(YQUERY,"SET"))        ;1=NEUES DIRECTORY 2=NEUER LINK 3=kill 4=Rename
	. SET YOFFSET1 = $GET(%(YQUERY,"OFFSET1"))    ;SCHLÜSSEL FÜR EDIT ;key 
	. SET YTEXT    = $GET(%(YQUERY,"TEXT"))       ;DIRECTORY ODER LINKTEXT ;Or 
	. SET YLINK    = $GET(%(YQUERY,"LINK"))       ;NEUER LINK (HTTP:// ...)
	. IF YFIX="" SET YFIX=$GET(%(YQUERY,"MENUE")) ;FESTER SUBSCRIPT AM BEGINN (MANDANT/DATEN) ;to the inauguration 
	. IF YFIX="" SET YFIX="MENUE"  ;TESTMODUS BEI EXPLORER ;next to 
	
	IF YPWD'="" IF $GET(YSET)=3!($GET(YTEXT)'="") IF YOFFSET1'="" DO ^INAEXPLORER3  ;SET UND KILL  ;table-mat And 
	SET YVOR=""
	IF YBED'="" SET YVOR=$GET(^WWW013(0,YBED,1))  ;VORGABEN AUS USER ;out of 
	SET YBER=$PIECE(YVOR,Y,3)  ;BERECHTIGUNG
	SET YLEVEL=0               ;0=DIRECTORY 1=LINK
	SET YVOR=^WWW012(0,YM,1)   ;VORGABEN AUS MANDANT ;out of 
	SET YKOPF=YDATEI           ;ÜBERSCHRIFT ;superscription 
	IF $DATA(^WWW001(0,YDATEI,1)) SET YKOPF=$PIECE($GET(^WWW001(0,YDATEI,1)),Y,1)
	DO ^WWWSTART(YKOPF)        ;STARTEN HTML ;launching HTML 
	WRITE "<BODY" 
	IF YOFFSET'=YFIX WRITE " onLoad='self.focus();document.location=""#TARGET"";'"   
	WRITE " BGCOLOR="_""""_"WHITE"_""""
	IF $PIECE(YVOR,Y,6)'=""  DO
	. ;I $L($P(YVOR,Y,6))=6 W " TEXT="_""""_"#"_$P(YVOR,Y,6)_"""" Q
	. IF $PIECE(YVOR,Y,6)'="" WRITE " TEXT="_""""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE(YVOR,Y,6),1)),Y,1)_""""
	
	IF $PIECE(YVOR,Y,12)'=""  DO    ; FIXME : Get colour once
	. WRITE " LINK="_""""_ $PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE(YVOR,Y,12),1)),Y,1)_""""
	. WRITE " VLINK="_""""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE(YVOR,Y,12),1)),Y,1)_""""
	. WRITE " ALINK="_""""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE(YVOR,Y,12),1)),Y,1)_""""
	
	WRITE " topmargin=1 leftmargin=1>"
	WRITE YCR,"<FONT "
	IF $PIECE(YVOR,Y,9)'=""   WRITE " FACE="_""""_$PIECE($GET(^WWW100(0,"SCHRIFTART",SPRACHE,$PIECE(YVOR,Y,9),1)),Y,1)_""""
	IF $PIECE(YVOR,Y,7)'=""   WRITE " SIZE="_""""_$PIECE(YVOR,Y,7)_""""
	IF $PIECE(YVOR,Y,6)'=""  DO
	. ;I $L($P(YVOR,Y,6))=6 W " COLOR="_""""_"#"_$P(YVOR,Y,6)_"""" Q
	. IF $PIECE(YVOR,Y,6)'="" WRITE " COLOR="_""""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE(YVOR,Y,6),1)),Y,1)_""""
	
	WRITE ">"
	IF YPWD'="" IF +YSET'=0   WRITE "<FORM NAME="_""""_"WWW"_""""_" ACTION="_""""_$PIECE(YAKTION,"?",1)_""""_" Method=POST>"
	;KOPFZEILE
	;DO ^WWWKOPF(YDATEI)
	WRITE "<NOBR>"
	
	WRITE YCR,YCR,"<!-- ********************* DATEI SUBSCRIPS ******************* -->",YCR,YCR
	
	;WRITE "<sup>"
	;WRITE "<big>"
	WRITE YCR
	WRITE "<NOBR>"
	;I YOFFSET=YFIX W "<A NAME='TARGET'></A>"  ;TARGET FÜR MOVE AUF FOCUS
	DO  ;I YOFFSET'=YFIX D
	. WRITE "<A HREF="_""""_YAKTION_"EP=INAEXPLORER"
	. IF YFIX'=""     WRITE "&OFFSET="_YFIX
	. IF YFIX'=""     WRITE "&FIX="_YFIX
	. WRITE "&FILE="_YDATEI
	. WRITE "&FORM="_YFORM
	. IF YHEADER'=""  WRITE "&HEAD="_YHEADER
	. WRITE "&KEY="_YKEYNUM
	. IF +YOBJECT'=0  WRITE "&OBJECT="_YOBJECT
	. IF +YTARGET'="" WRITE "&TARGET="_YTARGET
	. IF YCOLOR'=""   WRITE "&COLOR="_YCOLOR
	. IF YPWD'=""     WRITE "&PWD="_YPWD
	. IF YPIC'=""     WRITE "&PIC="_YPIC
	. WRITE "&RECORD="_YRECORD
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	
	;START ;take-off 
	WRITE YCR
	WRITE "<IMG SRC="_""""_YGIF_"aplatz.gif"_""""_" valign=middle vspace=0 hspace=0 border=0>"
	WRITE $GET(YHEADER)
	IF $GET(YHEADER)'="" WRITE "&nbsp;&nbsp;"
	IF $GET(YHEADER)="" DO
	. IF YFIX=""  WRITE YDATEI  ;DATEI IN DER ANZEIGE ;data file within who advertisement 
	. IF YFIX'="" WRITE YFIX    ;DATEI IN DER ANZEIGE ;data file within who advertisement 
	
	WRITE "</A>"
	;EDIT
	IF YPWD'="" IF YOFFSET=YFIX DO
	. SET YOFFSET2="^"_YDATEI_"("  ;VARIABLE FÜR DEN FILTER FIX/OFFSET BESTIMMUNG ;to strainer provision 
	. IF YFIX'="" FOR YI=1:1 QUIT:$PIECE(YFIX,",",YI)=""  DO   ;FESTE VORGABE  ZUM SUCHSUBSCRIPT
	. . SET YOFFSET2=YOFFSET2_$PIECE(YFIX,",",YI)_","
	. ;
	. IF $EXTRACT(YOFFSET2,$LENGTH(YOFFSET2))="," SET YOFFSET2=$EXTRACT(YOFFSET2,1,$LENGTH(YOFFSET2)-1)
	. SET YOFFSET2=YOFFSET2_")"
	. SET YI=0
	. IF +YSET'=0 IF $GET(YOFFSET1)'="" IF YOFFSET1=YOFFSET2 DO ^INAEXPLORER2 QUIT  ;EDIT TEXT
	. IF +YSET=0 DO ^INAEXPLORER2 QUIT  ;EDIT BILDER ANZEIGEN ;imagery give notice 
	
	WRITE YCR
	DO ^INAEXPLORER1  ;ANZEIGE VERZEICHNISSTUKTUR ;advertisement 
	WRITE YCR,"</NOBR>"
	;WRITE "</big>"
	;WRITE "</sup>"
	IF YPWD'="" WRITE YCR,"</FORM>"
	WRITE YCR,"</NOBR>"
	WRITE YCR
	IF YDATEI'="WWWEXLORE" SET YNOFOOT=1  ;KEINE FUSSZEILE ;no 
	DO ^WWWSTOP
	KILL %
	QUIT
	
]]></Routine>
</Export>