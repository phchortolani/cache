<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INKALKULATION" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INKALKULATION  ;INKALKULATION;DT;ERRECHNEN DER KALKULATION;02.09.2000
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		ERRECHNEN DER KALKULATION
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	02.09.2000
	;|
	;\------------------------------------------------------------------/
	;
	;AUFRUF AUS DER KALKULATIONSVORGABE JE FELD ;out of the once field 
	NEW YFELD,YI,NKOMMA,EK,VK
	SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"D",1)) ;DATENSATZ ;data record 
	SET %TXT(1)=""
	SET NKOMMA=2
	DO
	. SET YI=1,EK=1
	. FOR YI(1)=2 SET YI=YI+(YI/100*$PIECE(YFELD,Y,YI(1)))  ;VOM 100   ;MATERIAL
	. SET YI("H")=YI
	. FOR YI(1)=3,4 SET YI=YI+(YI("H")/100*$PIECE(YFELD,Y,YI(1)))  ;VOM 100   (KOSTEN/GEWINN)
	. SET YI("S")=YI
	. FOR YI(1)=5 SET YI=YI+(YI("S")/100*$PIECE(YFELD,Y,YI(1)))  ;VOM 100   (KOSTEN/GEWINN)
	. ;
	. ;FOR YI(1)=6,7,8 SET YI=YI/(100-$PIECE(YFELD,Y,YI(1)))*100  ;AUF 100  (KUNDENRABATTE)
	. FOR YI(1)=6,7,8 DO  ;FIS, 26.06.02
	. . IF $PIECE(YFELD,Y,YI(1))=100 SET YI=0 QUIT  ;100% BONUS ;special dividend 
	. . SET YI=YI/(100-$PIECE(YFELD,Y,YI(1)))*100  ;AUF 100  (KUNDENRABATTE) ;upon 
	. . QUIT
	. SET VK=YI
	. SET YI=((VK/EK)-1)*100
	. SET $PIECE(YFELD,Y,11)=$JUSTIFY(YI,0,2)   ;2 NACHKOMMASTELLEN
	. FOR YI=11 SET %TXT(1)=%TXT(1)_"#Y"_YFORM_"D"_YI_"~"_$$^WWWZAHL($PIECE(YFELD,Y,YI),0,NKOMMA)
	. FOR YI=2,3,4,5,6,7,8 SET %TXT(1)=%TXT(1)_"#Y"_YFORM_"D"_YI_"~"_$$^WWWZAHL($PIECE(YFELD,Y,YI),0,$LENGTH($PIECE($PIECE(YFELD,Y,YI),".",2)))
	. QUIT
	QUIT
	
PREIS(PREIS) ;UNTERSCHIEDLICHE PREISARTEN
	NEW YFELD,YI,NKOMMA,EK,VK,PREIS1
	IF '$DATA(PREIS) SET PREIS=2
	SET PREIS1=PREIS
	SET PREIS=PREIS-1*100
	SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"D",1)) ;DATENSATZ ;data record 
	SET %TXT(1)=""
	SET NKOMMA=2
	DO
	. SET YI=1,EK=1
	. FOR YI(1)=2+PREIS SET YI=YI+(YI/100*$PIECE(YFELD,Y,YI(1)))  ;VOM 100   ;MATERIAL
	. SET YI("H")=YI
	. FOR YI(1)=3+PREIS,4+PREIS SET YI=YI+(YI("H")/100*$PIECE(YFELD,Y,YI(1)))  ;VOM 100   (KOSTEN/GEWINN)
	. SET YI("S")=YI
	. FOR YI(1)=5+PREIS SET YI=YI+(YI("S")/100*$PIECE(YFELD,Y,YI(1)))  ;VOM 100   (KOSTEN/GEWINN)
	. ;
	. FOR YI(1)=6+PREIS,7+PREIS,8+PREIS SET YI=YI/(100-$PIECE(YFELD,Y,YI(1)))*100  ;AUF 100  (KUNDENRABATTE) ;upon 
	. SET VK=YI
	. SET YI=((VK/EK)-1)*100
	. SET $PIECE(YFELD,Y,10+PREIS1)=$JUSTIFY(YI,0,2)   ;2 NACHKOMMASTELLEN
	. FOR YI=10+PREIS1 SET %TXT(1)=%TXT(1)_"#Y"_YFORM_"D"_YI_"~"_$$^WWWZAHL($PIECE(YFELD,Y,YI),0,NKOMMA)
	. FOR YI=2+PREIS,3+PREIS,4+PREIS,5+PREIS,6+PREIS,7+PREIS,8+PREIS SET %TXT(1)=%TXT(1)_"#Y"_YFORM_"D"_YI_"~"_$$^WWWZAHL($PIECE(YFELD,Y,YI),0,$LENGTH($PIECE($PIECE(YFELD,Y,YI),".",2)))
	. QUIT
	QUIT
]]></Routine>
</Export>