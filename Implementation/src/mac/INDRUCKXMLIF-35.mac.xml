<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDRUCKXMLIF" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
yINDRUCKXMLIF(YREF)    ;INDRUCKXMLIF;FIS;DATENAUFBEREITUNG FÜR STANDARDSCHNITTSTELLE;20.02.2004
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		DATENAUFBEREITUNG FÜR STANDARDSCHNITTSTELLE
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| 30-May-2005		RobertW		SR12056: Attempt at Performance Increase
	;| FIS	20.02.2004
	;|
	;\------------------------------------------------------------------/
	;
	NEW HTML,PART,YZEILE,AUF1,POS1,LFN,POS,YSPRACHE1
	SET YREF=$GET(YREF)
	KILL ^WWWSOR(YUSER,"XML")
	DO READXML
	;K ^TEST99 M ^TEST99=^WWWSOR(YUSER,"XML")
	KILL ^INDMS(YM,YREF)
	DO SETDATA
	KILL ^WWWSOR(YUSER,"XML")
	QUIT
	
READXML ;AUFBEREITEN WERTE AUS XML TAGS ;out of XML in the daytime 
	NEW PAGE,LINE,TEXT,YI,LFN,CLASS,FIELD,VALUE,POS,POSITION,FILE
	SET POS=0
	SET POSITION=""
	SET PAGE="" FOR  SET PAGE=$ORDER(^INDMS(YM,YREF,PAGE)) QUIT:PAGE=""  DO
	. SET LINE="" FOR  SET LINE=$ORDER(^INDMS(YM,YREF,PAGE,LINE)) QUIT:LINE=""  DO  QUIT:LINE=""
	. . SET TEXT=$GET(^INDMS(YM,YREF,PAGE,LINE,1))
	. . QUIT:TEXT=""
	. . ;
	. . IF $FIND(TEXT,"</LINE>") DO  SET POS=0
	. . . IF POSITION="" SET POSITION=1
	. . . MERGE ^WWWSOR(YUSER,"XML",POSITION)=^WWWSOR(YUSER,"XMLtemp",0)
	. . . KILL ^WWWSOR(YUSER,"XMLtemp")
	. . . QUIT
	. . IF $FIND(TEXT,"<LINE>") KILL ^WWWSOR(YUSER,"XMLtemp") SET POS=1 SET POSITION=""
	. . ;
	. . FOR YI=1:1:10 DO  QUIT:'$FIND(TEXT,"<DOCUMENT")  ;MAX 10 DATENFELDER JE ZEILE ;once 
	. . . new strField
	. . . IF $FIND(TEXT,"<DOCUMENT") DO
	. . . . SET CLASS=$PIECE($PIECE($PIECE(TEXT,"<DOCUMENT",2),">",1),"_",1)
	. . . . QUIT:CLASS=""
	. . . . SET FIELD=$PIECE($PIECE($PIECE(TEXT,"<DOCUMENT",2),">",1),"_",2,99)
	. . . . SET VALUE=$PIECE($PIECE(TEXT,"<DOCUMENT"_CLASS_"_"_FIELD_">",2),"</DOCUMENT"_CLASS_"_"_FIELD_">",1)
	. . . . SET TEXT=$PIECE(TEXT,"<DOCUMENT"_CLASS_"_"_FIELD_">",1)_$PIECE(TEXT,"</DOCUMENT"_CLASS_"_"_FIELD_">",2)
	. . . . ;
	. . . . IF POS=1 IF CLASS="INAUFP"!(CLASS="INANGP") IF FIELD="P2" SET POSITION=VALUE  ;LINE ITEM
	. . . . ;
	. . . . SET FILE="XML"
	. . . . IF POS=1 SET FILE="XMLtemp"
	. . . . SET LFN=1
	. . . . ;FOR  QUIT:'$DATA(^WWWSOR(YUSER,FILE,0,CLASS,$$^WWWUPER(FIELD),LFN))  SET LFN=LFN+1  ;MEHRFACH
	. . . . set strField=$zconvert(FIELD,"U")
	. . . . FOR  QUIT:'$DATA(^WWWSOR(YUSER,FILE,0,CLASS,strField,LFN))  SET LFN=LFN+1  ;MEHRFACH
	. . . . ;FOR  QUIT:'$FIND(VALUE,"  ")  SET VALUE=$$^WWWTRANSLATE(VALUE,"  "," ")  ;MAX 1 LEERZEICHEN ;space character 
	. . . . if $FIND(VALUE,"  ") SET VALUE=$$^WWWTRANSLATE(VALUE,"  "," ")  ;MAX 1 LEERZEICHEN ;space character 
	. . . . SET ^WWWSOR(YUSER,FILE,0,CLASS,strField,LFN)=VALUE
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
	
SETDATA ;AUFBAU DATENSATZ STANDARDSCHNITTSTELLE ;data record 
	NEW SATZART,FELDBEZ,A,YSPA,POS,LFN
	SET YSPA=""
	SET $PIECE(YSPA," ",1025)=""  ;1025 STELLEN ;put down 
	SET A=YSPA
	SET LFN=99
	IF YBELEG=7!(YBELEG=17) DO  ;RECHNUNG/GUTSCHRIFT
	. ;FOR SATZART=100,101,105,110,115,120,130,170,400,410,500 DO
	. FOR SATZART=50,100,105,110,115,120,130,170,300,400,410,500 DO  ;NEUE SCHNITTSTELLENBESCHREIBUNG VOM 26.02.04
	. . SET POS=0
	. . DO @SATZART^INSTDIFRECH  ;AUFTRAG ;mandate  ;order 
	. . IF SATZART=170 DO
	. . . NEW SATZART,POS
	. . . SET POS=0 FOR  SET POS=$ORDER(^WWWSOR(YUSER,"XML",POS)) QUIT:POS=""  IF +POS'=0 DO  ;POSITIONEN
	. . . . ;FOR SATZART=200,201,205,210,230,240,280 DO
	. . . . FOR SATZART=200,210,280 DO  ;NEUE SCHNITTSTELLENBESCHREIBUNG VOM 26.02.04
	. . . . . DO @SATZART^INSTDIFRECH
	. . . . . QUIT
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
	
SPE	 ;SATZ SPEICHERN ;typesetting Save 
	SET LFN=LFN+1
	SET ^INDMS(YM,YREF,LFN,SATZART,1)=A
	KILL A
	SET A=YSPA
	QUIT
]]></Routine>
</Export>