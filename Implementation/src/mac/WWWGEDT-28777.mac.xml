<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWGEDT" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWGEDT
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		GLOBAL ANZEIGE
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 30-May-2005	RPW		SR12056: Attempt at Performance Increase
	; 23.04.1998	DT
	;-------------------------------------------------------------------------------
	do START
	quit
	
START ;
	;-------------------------------------------------------------------------------
	;
	; Params:
	;
	; Returns:
	;
	; History:
	; 22-Feb-2008	GRF		Doco; quits; Naked References
	; 05-Nov-2007	shobby	SRBR014748: Standard routine for password check.
	;-------------------------------------------------------------------------------
	DO ^WWWVAR
	SET YDATEI=$GET(%(YQUERY,"YDATEI"))
	NEW YANZMAX
	
	SET YANZMAX=$PIECE($GET(^WWW012(0,YM,1)),Y,160)  ; MAX NUMBER OF DATA RECORDS IN THE SELECT FIELD
	IF +YANZMAX=0 SET YANZMAX=1000
	KILL ^WWWZWS(0,+$HOROLOG,YUSER)
	IF '$DATA(^WWW013(0,YBED)) DO ^WWWINFO($$^WWWTEXT(5)) QUIT
	
	;IF $$^WWWUPER($$^WWWPWDCHECK($PIECE(^WWW013(0,YBED,1),Y,2)))'=$$^WWWUPER(YPWD) DO ^WWWINFO($$^WWWTEXT(5)) QUIT  ;TYBD;26124;20,7,2004;
	;BR014748 IF $zconvert($$^WWWPWDCHECK($PIECE(^WWW013(0,YBED,1),Y,2)),"U")'=$zconvert(YPWD,"U") DO ^WWWINFO($$^WWWTEXT(5)) QUIT  ;TYBD;26124;20,7,2004;
	IF '$$CHECK^WWWPWDCHECK($PIECE(^WWW013(0,YBED,1),Y,2),YPWD) DO ^WWWINFO($$^WWWTEXT(5)) QUIT  ;TYBD;26124;20,7,2004; ;BR014748
	
	;WRITE YCR,YCR,"<!-- ************************* GLOBAL ANZEIGE (WWWGEDT)************************* -->",YCR,YCR
	
	DO ^WWWFORMX  ;VORGABEN FORM U. MANDANT ;shape Company 
	SET YFDATEI=$PIECE(YVOR,Y,11)
	IF YFDATEI'="" SET YDATEI=YFDATEI
	WRITE YCR
	WRITE "<FONT"
	IF $PIECE(YVOR,Y,9)'="" WRITE " FACE="_""""_$PIECE($GET(^WWW100(0,"SCHRIFTART",SPRACHE,$PIECE(YVOR,Y,9),1)),Y,1)_""""
	IF $PIECE(YVOR,Y,7)'="" WRITE " SIZE="_""""_$PIECE(YVOR,Y,7)_""""
	IF $PIECE(YVOR,Y,6)'=""  DO
	. IF $LENGTH($PIECE(YVOR,Y,6))=6  WRITE " COLOR="_""""_"#"_$PIECE(YVOR,Y,6)_""""
	. IF $LENGTH($PIECE(YVOR,Y,6))'=6 WRITE " COLOR="_""""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE(YVOR,Y,6),1)),Y,1)_""""
	
	WRITE ">"
	IF $FIND($PIECE(YVOR,Y,8),1) WRITE "<STRONG><B>"
	IF $FIND($PIECE(YVOR,Y,8),2) WRITE "<U>"
	IF $FIND($PIECE(YVOR,Y,8),3) WRITE "<I>"
	IF $FIND($PIECE(YVOR,Y,8),4) WRITE "<STRIKE>"
	IF $GET(YTARGET)="" DO   ;WENN KEIN TARGET,DANN ENDE BUTTON
	. WRITE YCR,"<DIR>"
	. WRITE "<LI>"
	. WRITE "<A HREF="_""""_YAKTION_"EP=WWWMENU"
	. WRITE "&YBED="_YBED_"&YUCI="_$GET(YUCI)_"&YM="_YM
	. WRITE "&YUSER="_YUSER
	. WRITE "&YANZ="_YANZ
	. WRITE """"
	. WRITE ">"
	. WRITE "<IMG SRC="_""""_YGIF_"oopen.gif"_""""_" valign=middle vspace=0 hspace=0 border=0>"
	. WRITE $$^WWWTEXT(99)
	. WRITE "</A>"
	
	IF YFDATEI="" DO  ;KEINE DATEIVORGABE=DATEIAUSWAHL ;no 
	. WRITE YCR,"<DIR>"
	. WRITE "<LI>"
	. WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&amp;YFORM="_YFORM
	. WRITE "&amp;YBED="_YBED_"&amp;YUCI="_$GET(YUCI)
	. WRITE "&amp;YUSER="_YUSER
	. WRITE "&amp;YANZ="_YANZ
	. WRITE """"
	. WRITE ">"
	. WRITE "<IMG SRC="_""""_YGIF_"oopen.gif"_""""_" TITLE="_""""_$$^WWWTEXT(374)_""""_" valign=middle vspace=0 hspace=0 border=0>"
	. WRITE $$^WWWTEXT(87)
	. WRITE "</A>"
	
	DO DATEI   ;AUSWAHL DATEI UND DATENSATZ ;Selection data file And data record 
	IF YFDATEI="" DO
	. WRITE YCR,"</DIR>"
	
	IF $GET(YTARGET)="" WRITE "</DIR>"
	IF $FIND($PIECE(YVOR,Y,8),1) WRITE "</STRONG></B>"
	IF $FIND($PIECE(YVOR,Y,8),2) WRITE "</U>"
	IF $FIND($PIECE(YVOR,Y,8),3) WRITE "</I>"
	IF $FIND($PIECE(YVOR,Y,8),4) WRITE "</STRIKE>"
	WRITE "</FONT>",YCR
	;D ^WWWSTOP
	QUIT
	
DATEI ;ANZEIGEN ALLE DATEIEN AUS WWW001 ;display out of 
	WRITE YCR,"<DIR>"
	IF YDATEI=""  SET YGLOB="" FOR  SET YGLOB=$ORDER(^WWW001(0,YGLOB)) QUIT:YGLOB=""  DO DATEI1
	IF YDATEI'="" SET YGLOB=YDATEI DO DATEI1
	WRITE "</DIR>",YCR
	QUIT
	
DATEI1 ;DATEIAUSWAHL
	WRITE YCR
	DO
	. SET SATZ=$GET(^WWW001(0,YGLOB,1))
	. WRITE "<LI>"
	. WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&amp;YFORM="_YFORM
	. WRITE "&amp;YBED="_YBED_"&amp;YUCI="_$GET(YUCI)
	. WRITE "&amp;YUSER="_YUSER
	. WRITE "&amp;YDATEI="_YGLOB
	. WRITE "&amp;YANZ="_YANZ
	. WRITE """"
	. WRITE ">"
	. IF YDATEI=""  WRITE "<IMG SRC="_""""_YGIF_"oclose.gif"_""""_" TITLE="_""""_$$^WWWTEXT(374)_""""_" valign=middle vspace=0 hspace=0 border=0>"
	. IF YDATEI'="" WRITE "<IMG SRC="_""""_YGIF_"oopen.gif"_""""_" TITLE="_""""_$$^WWWTEXT(374)_""""_" valign=middle vspace=0 hspace=0 border=0>"
	. IF $DATA(^WWW0011(0,YGLOB,SPRACHE,1)) SET $PIECE(SATZ,Y,1)=$PIECE(^WWW0011(0,YGLOB,SPRACHE,1),Y,1)    ; Naked Ref
	. WRITE YGLOB,"   (",$$^WWWUML($PIECE(SATZ,Y,1))_")"
	. WRITE "</A>"
	. IF YDATEI=YGLOB DO KEY  ;ANZEIGEN KEY´S AUS DATEI ;display out of data file 
	
	QUIT
	
KEY ;KEY WENN NUR EINE DATEI ;KEY when only one data file 
	SET YMAXKEY=+$ORDER(^WWW002(0,YDATEI,""),-1)   ;WIEVIELE PRIMÄRSCHLÜSSEL 
	IF YMAXKEY=0 SET YMAXKEY=1
	DO ^WWWSOR(YDATEI,YFKEY,"",0,0,$GET(YANZMAX),1,"")   ;SUCHEN PRIMÄRSCHLÜSSEL ;seek 
	FOR YLFNLAN=1:1 QUIT:$PIECE(YFKEY,",",YLFNLAN)=""
	IF YLFNLAN>YMAXKEY SET YLFNLAN=YMAXKEY
	FOR YLFN=1:1:YLFNLAN DO KEY1
	KILL ^WWWSOR(YUSER)
	WRITE YCR
	FOR YLFN=1:1:YLFNLAN WRITE "</DIR>"
	QUIT
	
KEY1 ;ANZEIGE EINZELKEY ;Show 
	SET YVORKEY=""
	WRITE YCR,"<DIR>"
	WRITE YCR,"<STRONG>"
	SET NAME=$PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,1)
	IF $DATA(^WWW0021(0,YDATEI,YLFN,SPRACHE,1)) SET NAME=$PIECE(^WWW0021(0,YDATEI,YLFN,SPRACHE,1),Y,1)    ; Naked Ref
	WRITE $$^WWWUML(NAME)
	WRITE "</STRONG>"
	WRITE "<BR>"
	SET YA(2)=""
	FOR  SET YA(2)=$ORDER(^WWWSOR(YUSER,"KEY",YA(2))) QUIT:YA(2)=""  DO
	. SET YKEY=""
	. FOR  SET YKEY=$ORDER(^WWWSOR(YUSER,"KEY",YA(2),YKEY)) QUIT:YKEY=""  DO
	. . WRITE YCR
	. . SET YA=$GET(^WWWSOR(YUSER,"KEY",YA(2),YKEY))
	. . IF YLFN'=YMAXKEY QUIT:YVORKEY=$PIECE(YKEY,",",1,YLFN)  SET YVORKEY=$PIECE(YKEY,",",1,YLFN)
	. . WRITE YCR,"<LI>"
	. . WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&amp;YFORM="_YFORM
	. . WRITE "&amp;YBED="_YBED_"&amp;YUCI="_$GET(YUCI)
	. . WRITE "&amp;YUSER="_YUSER
	. . WRITE "&amp;YDATEI="_YGLOB
	. . WRITE "&amp;YANZ="_YANZ
	. . IF YLFN'=YMAXKEY WRITE "&amp;YFKEY="_$PIECE(YKEY,",",1,YLFN)
	. . IF YLFN=YMAXKEY  WRITE "&amp;YFKEY="_YKEY_"&amp;YKEY="_YKEY
	. . WRITE """"
	. . WRITE ">"
	. . DO
	. . . IF YLFN'=YMAXKEY IF YLFN=YLFNLAN WRITE "<IMG SRC="_""""_YGIF_"oclose.gif"_""""_" TITLE="_""""_$$^WWWTEXT(374)_""""_" valign=middle vspace=0 hspace=0 border=0>" QUIT
	. . . IF YLFN'=YLFNLAN WRITE "<IMG SRC="_""""_YGIF_"oopen.gif"_""""_" TITLE="_""""_$$^WWWTEXT(374)_""""_" valign=middle vspace=0 hspace=0 border=0>" QUIT
	. . . IF YLFN=YMAXKEY IF YFKEY=YKEY WRITE "<IMG SRC="_""""_YGIF_"oopen.gif"_""""_" TITLE="_""""_$$^WWWTEXT(374)_""""_" valign=middle vspace=0 hspace=0 border=0>" QUIT
	. . . WRITE "<IMG SRC="_""""_YGIF_"oclose.gif"_""""_" TITLE="_""""_$$^WWWTEXT(374)_""""_" valign=middle vspace=0 hspace=0 border=0>" QUIT
	. . ;
	. . SET YINHALT=$PIECE(YKEY,",",YLFN)
	. . DO KEYLFN
	. . WRITE $$^WWWUML(YINHALT)
	. . IF YINHALT1'="" WRITE "  (",$$^WWWUML(YINHALT1),")"
	. . WRITE "</A>"
	. . IF YLFN=YMAXKEY IF YFKEY=YKEY DO SATZ   ;DATENSATZ VORHANDEN ;data record on hand 
	
	QUIT
	
SATZ ;
	SET YFELD=$$^WWWSETL(YA)   ;LESEN DATENSATZ ;read data record 
	NEW YLFN
	
	WRITE "<DIR>"
	SET YLFN=""
	FOR  SET YLFN=$ORDER(^WWW003(0,YDATEI,YLFN)) QUIT:YLFN=""  DO   ;ANZEIGE DER DATENFELDER ;Show the 
	. WRITE YCR,"<LI>"
	. SET YINHALT=$PIECE(YFELD,Y,YLFN)
	. WRITE "<STRONG>"
	. SET NAME=$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,1)
	. IF $DATA(^WWW0031(0,YDATEI,YLFN,SPRACHE,1)) SET NAME=$PIECE(^WWW0031(0,YDATEI,YLFN,SPRACHE,1),Y,1)    ; Naked Ref
	. WRITE $$^WWWUML(NAME)   ;BEZEICHNUNG DES EINZELFELDES ;notation 
	. WRITE ": "
	. WRITE "</STRONG>"
	. DO DATEN  ;DATENAUSGABE DES EINZELFELDES ;data output 
	. ;IF $$^WWWUPER($EXTRACT(YINHALT,1,7))="HTTP://"  DO  QUIT   ;VERTEILER AUF LINK ;distributor upon 
	. IF $zconvert($EXTRACT(YINHALT,1,7),"U")="HTTP://"  DO  QUIT   ;VERTEILER AUF LINK ;distributor upon 
	. . SET YINHALT=$PIECE(YINHALT,"YUSER=",1)_YUSER_$PIECE($PIECE(YINHALT,"YUSER=",2),"&",2,99)  ;AKTUELLER USER
	. . WRITE "<A HREF="_""""_YINHALT_""""
	. . WRITE ">"
	. . WRITE "<IMG SRC="_""""_YGIF_"oclose.gif"_""""_" TITLE="_""""_$$^WWWTEXT(374)_""""_" valign=middle vspace=0 hspace=0 border=0>"
	. . WRITE "</A>"
	. ;
	. WRITE $$^WWWUML(YINHALT)
	. IF YINHALT1'="" WRITE "  (",$$^WWWUML(YINHALT1),")"   ;RELATIONSFELDER
	
	WRITE "</DIR>"
	QUIT
	
KEYLFN ;FORMAT KEY
	NEW YKEY,YMAXKEY
	
	SET YINHALT1=""
	SET YTYP=$PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,3)
	SET YQ=0
	IF YINHALT'="" IF $PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,8)'="" DO  QUIT
	. NEW YDAT,YKE,YFE,YSAT,YDATA
	. SET YDAT=$PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,8)
	. SET YKE=$PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,9)
	. IF YKE'="" IF $EXTRACT(YKE)'="""" QUIT
	. SET YFE=$PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,10)
	. SET YSAT="^"_YDAT_"("_$$^WWWYM(YDAT,1)
	. SET YDATA=$GET(^WWW001(0,YDAT,1))
	. IF YKE'="" IF $EXTRACT(YKE)'="," SET YSAT=YSAT_YKE_","
	. IF $PIECE(YDATA,Y,8)'=4 SET YSAT=YSAT_""""_$TRANSLATE(YINHALT,"""")_""""_",1)"
	. IF $PIECE(YDATA,Y,8)=4  SET YSAT=YSAT_""""_$TRANSLATE(YINHALT,"""")_""""_")"
	. IF $DATA(@(YSAT)) SET YINHALT1=$PIECE(@(YSAT),Y,YFE) SET YQ=1
	. SET YSAT(1)=$PIECE($$^WWWSETL(YSAT),Y,YFE)
	. IF YSAT(1)'="" SET YINHALT1=YSAT(1) SET YQ=1
	
	IF YQ=0 DO FORMAT
	QUIT
	
DATEN ;FORMAT DATEN
	SET YINHALT1=""
	SET YTYP=$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,3)
	SET YQ=0
	IF YINHALT'="" IF $PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,8)'="" DO  QUIT
	. NEW YDAT,YKE,YFE,YSAT,YDATA
	. SET YDAT=$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,8)
	. SET YKE =$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,9)
	. IF YKE'="" IF $EXTRACT(YKE)'="""" QUIT
	. SET YFE=$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,10)
	. SET YSAT="^"_YDAT_"("_$$^WWWYM(YDAT,1)
	. SET YDATA=$GET(^WWW001(0,YDAT,1))
	. IF YKE'="" IF $EXTRACT(YKE)'="," SET YSAT=YSAT_YKE_","
	. IF $PIECE(YDATA,Y,8)'=4 SET YSAT=YSAT_""""_$TRANSLATE(YINHALT,"""")_""""_",1)"
	. IF $PIECE(YDATA,Y,8)=4  SET YSAT=YSAT_""""_$TRANSLATE(YINHALT,"""")_""""_")"
	. ;I $D(@(YSAT)) S YINHALT=$P(@(YSAT),Y,YFE) S YQ=1
	. SET YSAT(1)=$PIECE($$^WWWSETL(YSAT),Y,YFE)
	. IF YSAT(1)'="" SET YINHALT1=YSAT(1) SET YQ=1
	
	DO FORMAT
	QUIT
	
FORMAT ;
	QUIT:YINHALT=""
	SET YINHALT=$$^WWWTR(0,YTYP,YINHALT)
	IF YTYP=2 SET:+YINHALT=0 YINHALT="" SET:YINHALT=1 YINHALT="X"          QUIT
	IF YTYP=5 SET YINHALT=$EXTRACT("*****************",1,$LENGTH(YINHALT)) QUIT
	IF YTYP=3 SET YINHALT=$TRANSLATE(YINHALT,"|"," ")                      QUIT
	QUIT
	
]]></Routine>
</Export>