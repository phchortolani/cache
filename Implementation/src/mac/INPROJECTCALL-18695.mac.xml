<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INPROJECTCALL" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INPROJECTCALL(PROJECT) ;INPROJECTCALL;FAN;PROKECTANZEIGE VON SERVICE;25.05.2004;25784  ; Compiled January 7, 2005 16:18:39
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		PROKECTANZEIGE VON SERVICE
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FAN	25.05.2004
	;|
	;\------------------------------------------------------------------/
	;
	;PROJECT=PROJECTNUMMER
	SET PROJECT=$GET(PROJECT)
	QUIT:PROJECT="" 
	NEW SNR,KZ,YFELD
	DO ^WWWFRAME(0,,,,1)  ;TABLE AN   ;11,2,2004;TYBD;HINTERGRUNDFARBE
	DO UEB  ;ÜBERSCHRIFT ;superscription 
	SET ANZ=0
	SET SNR="" FOR  SET SNR=$ORDER(^INCALL(YM,SNR),-1) QUIT:SNR=""  DO  ;PROJECT
	SET SNR="" FOR  SET SNR=$ORDER(^INCALLs(YM,5,$$^WWWUMLAU(PROJECT,1),SNR)) QUIT:SNR=""  DO  ;FIS;07.01.05
	. SET YFELD=$GET(^INCALL(YM,SNR,1))
	. SET KZ=$PIECE(YFELD,Y,20)  ;KURZBETREFF
	. SET PJ=$PIECE(YFELD,Y,81)  ;PROJEKTNAME ZU AUFTRAG ;within order 
	. ;IF '$FIND($$^WWWUMLAU(KZ,1),$$^WWWUMLAU(PROJECT,1)) IF PJ=""  QUIT          ;VOLLTEXTSUCHE IN KURZ,SUCHEN IN PRJEKTNAME
	. ;IF '$FIND($$^WWWUMLAU(KZ,1),$$^WWWUMLAU(PROJECT,1)) IF PJ'="" IF $$^WWWUMLAU(PJ,1)'=$$^WWWUMLAU(PROJECT,1)  QUIT 
	. DO ANZ
	. QUIT
	IF ANZ=0 DO LEER 
	DO ^WWWFRAME(1)  ;TABLE AUS  ;out of 
	QUIT
	
UEB      ;ÜBERSCHRIFT   ;ACHTUNG!!!  AUFRUF AUCH VON ^INPROJECTCALL
	NEW UES
	SET UES=$$^WWWTEXT(31503)_"/"_$$^WWWTEXT(32231)_Y  ;SERVICENR/kunde
	SET UES=UES_$$^WWWTEXT(31506)  ;BETREFF
	DO NL^WWWTAB
	FOR YI=1:1 QUIT:$PIECE(UES,Y,YI,99)=""  DO NHL^WWWTAB WRITE "<FONT SIZE=2>" WRITE $PIECE(UES,Y,YI),"&nbsp;" DO EH^WWWTAB
	DO EL^WWWTAB
	QUIT
	
ANZ      ;ANZEIGE ;advertisement  ;Show 
	NEW DAUER
	DO
	. SET ANZ=ANZ+1
	. DO NL^WWWTAB
	. ;
	. ;NR/KUNDE/ANSPRECHPARTNER
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF $GET(YDDSATZ)'="" DO 
	. IF $PIECE(YFELD,Y,18)=1 WRITE " BGCOLOR=YELLOW"
	. IF $PIECE(YFELD,Y,18)=2 WRITE " BGCOLOR=RED"  ;_$P($G(^WWW101(1,"PRIO",SPRACHE,$P(YFELD,Y,18),1)),Y,2)
	. IF $PIECE(YFELD,Y,18)=0 WRITE " BGCOLOR=WHITE"
	. WRITE ">"
	. WRITE "<FONT SIZE=2>"
	. IF $PIECE(YFELD,Y,82)=1 WRITE "<B>"
	. DO
	. . NEW YKEY
	. . SET YKEY=SNR
	. . QUIT:YKEY=""
	. . WRITE "<A"
	. . ;WRITE " TITLE="_""""_$$^WWWTEXT(71)_" "_$$^WWWTEXT(31506)_" / "_$$^WWWTEXT(32377)_" / "_$$^WWWTEXT(32376)_""""
	. . WRITE " HREF="_""""_YAKTION_"EP=WWWMANU&YFORM=INCALL&YEXEC=D|DETAIL^INCALL2"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TARGET2>"
	. . WRITE YCR,"<IMG SRC="_""""_YGIF_"text.gif"_""""_"HEIGHT=20 ALIGN=ABSBOTTOM TITLE="_""""_$$^WWWTEXT(71)_" "_$$^WWWTEXT(31506)_" / "_$$^WWWTEXT(32377)_" / "_$$^WWWTEXT(32376)_""""_" border=0>"
	. . WRITE "</A>"
	. . QUIT
	. WRITE " "_SNR                   ;_" ( "_$$^WWWTIME($$^INSTATSERVZEIT(SNR))_" )"     ;PROJEKT DAUER
	. IF $PIECE(YFELD,Y,82)=1 WRITE "</B>"
	. WRITE "</FONT>"
	. IF $PIECE(YFELD,Y,82)=1 WRITE "&nbsp;<img src="_""""_YGIF_"pin.gif"_""""_" border=0 height=15>"    ;PERSÖNLICHER MERKER;FIS;04.11.03
	. WRITE "</B>"
	. WRITE YCR
	. WRITE "<BR>"
	. WRITE "<FONT SIZE=1>"
	. WRITE $PIECE(YFELD,Y,5)_"&nbsp;"
	. IF $PIECE(YFELD,Y,6)'="" WRITE $$^WWWUML($PIECE(YFELD,Y,6))                     ;KUNDENNAME1
	. ;IF $PIECE(YFELD,Y,7)'="" WRITE "<BR>" WRITE $$^WWWUML($PIECE(YFELD,Y,7))        ;KUNDENNAME2
	. ;IF $PIECE(YFELD,Y,6)="" IF $PIECE(YFELD,Y,7)="" WRITE " ","<BR>"
	. ;IF $PIECE(YFELD,Y,12)'="" WRITE "<BR>" WRITE $$^WWWUML($PIECE(YFELD,Y,12))      ;ANSPRECHPARTNER
	. WRITE "</FONT SIZE>"
	. WRITE "&nbsp;","</BGCOLOR>"
	. DO EF^WWWTAB
	. ;
	. DO NF^WWWTAB
	. SET CCOLOR="NO"      ;BEMERKUNG COLOR ;remark 
	. IF $PIECE(YFELD,Y,5)'="" IF $PIECE(YFELD,Y,39)'="" DO    ; WENN KD-SERVICE MIT KD-PRIO. ;when by means of 
	. . SET CCOLOR=$PIECE($GET(^INPARA(YM,"PRIOKD",SPRACHE,$PIECE(YFELD,Y,39),1)),Y,2)
	. . IF CCOLOR="" SET CCOLOR="NO"
	. . SET CCOLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,CCOLOR,1)),Y,1)
	. . QUIT
	. IF $PIECE(YFELD,Y,5)'="" IF $PIECE(YFELD,Y,39)="" IF $PIECE(YFELD,Y,15)'="" DO    ; WENN KD-SERVICE OHNE KD-PRIO. MIT SERVICEKZ. ;when without by means of 
	. . SET CCOLOR=$PIECE($GET(^INPARA(YM,"SERVICEKENNZEICHEN",SPRACHE,$PIECE(YFELD,Y,15),1)),Y,2)
	. . IF CCOLOR="" SET CCOLOR="NO"
	. . SET CCOLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,CCOLOR,1)),Y,1)
	. . QUIT
	. IF $PIECE(YFELD,Y,5)="" IF $PIECE(YFELD,Y,15)'="" DO    ; WENN INTER-SERVICE MIT SERVICEKZ. ;when by means of 
	. . SET CCOLOR=$PIECE($GET(^INPARA(YM,"SERVICEKENNZEICHEN",SPRACHE,$PIECE(YFELD,Y,15),1)),Y,2)
	. . IF CCOLOR="" SET CCOLOR="NO"
	. . SET CCOLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,CCOLOR,1)),Y,1)
	. . QUIT
	. DO
	. . WRITE YCR,"<TABLE BORDER=0 CELLSPACING=0>"
	. . WRITE YCR,"<TR>"
	. . WRITE "<TD NOWRAP VALIGN=TOP>"
	. . WRITE "<FONT SIZE=2>"
	. . ;WRITE $$^WWWDATE($PIECE(YFELD,Y,1))     ;_" / "_$$^WWWTIME($PIECE(YFELD,Y,2))    ;
	. . ;WRITE " / "
	. . ;WRITE $$^WWWTEXT(32057)_": "   ;ERFASSER:
	. . WRITE $PIECE(YFELD,Y,3)_" / "
	. . DO EF^WWWTAB
	. . WRITE "<TD NOWRAP VALIGN=TOP "
	. . IF CCOLOR'="NO" WRITE " BGCOLOR="_CCOLOR
	. . WRITE ">"
	. . WRITE "<FONT SIZE=2>"
	. . IF $PIECE(YFELD,Y,5)'="" IF $PIECE(YFELD,Y,39)'="" WRITE "&nbsp;" WRITE $PIECE($GET(^INPARA(YM,"PRIOKD",SPRACHE,$PIECE(YFELD,Y,39),1)),Y,1) WRITE "&nbsp;"
	. . IF $PIECE(YFELD,Y,5)'="" IF $PIECE(YFELD,Y,39)="" IF $PIECE(YFELD,Y,15)'="" WRITE "&nbsp;" WRITE $PIECE($GET(^INPARA(YM,"SERVICEKENNZEICHEN",SPRACHE,$PIECE(YFELD,Y,15),1)),Y,1) WRITE "&nbsp;"
	. . IF $PIECE(YFELD,Y,5)="" IF $PIECE(YFELD,Y,15)'="" WRITE "&nbsp;" WRITE $PIECE($GET(^INPARA(YM,"SERVICEKENNZEICHEN",SPRACHE,$PIECE(YFELD,Y,15),1)),Y,1) WRITE "&nbsp;"
	. . WRITE "</TD>"
	. . IF $P(YFELD,Y,84)'="" DO
	. . . WRITE "<TD NOWRAP VALIGN=TOP><FONT SIZE=2>"
	. . . WRITE " / "_$$^WWWFELDNAME("INCALL","D",84),": "         ;STATUS;FAN;30.03.04;2535
	. . . W $P($G(^INPARA(YM,"BEARBEITUNGSSTATUS",SPRACHE,$P(YFELD,Y,84),1)),Y,1)   ;
	. . . WRITE "</FONT></TD>"
	. . . QUIT
	. . IF $P(YFELD,Y,19)'="" DO
	. . . WRITE "<TD NOWRAP VALIGN=TOP><FONT SIZE=2>"
	. . . WRITE " / "_$$^WWWFELDNAME("INCALL","D",19),": "         ;BITTE UM ;please to 
	. . . W $P($G(^INPARA(YM,"AKTION",SPRACHE,$P(YFELD,Y,19),1)),Y,1)   ;
	. . . IF $P(YFELD,Y,16)'="" W " ("_$P(YFELD,Y,16)_")"     ;FAN;28.10.03;24236 ;buff 
	. . . WRITE "</FONT></TD>"
	. . . QUIT
	. . IF $PIECE(YFELD,Y,83)'="" DO   ;FAN;24500;07.11.2003;ANZEIGE SERVICE TERMIN EINGEFÜGT
	. . . NEW CDATE
	. . . SET CDATE=$PIECE(YFELD,Y,83)
	. . . WRITE YCR
	. . . ;WRITE "<TD>&nbsp;&nbsp;</TD>"
	. . . WRITE "<TD NOWRAP><FONT SIZE=2>"_" / "_$$^WWWTEXT(32801)_":&nbsp;"_"</FONT></TD>"
	. . . DO
	. . . . IF CDATE<(+$HOROLOG+8) WRITE "<TD NOWRAP BGCOLOR="_YRED_" ><FONT SIZE=2>" QUIT
	. . . . WRITE "<TD NOWRAP><FONT SIZE=2>"
	. . . . QUIT
	. . . WRITE $$^WWWDATE(CDATE)_" - "_$PIECE($GET(^INCALLPROJ(YM,CDATE,1)),Y,1)
	. . . WRITE "</FONT></TD>"
	. . . QUIT
	. . WRITE "</TR></TABLE>"
	. . QUIT
	. WRITE "<FONT SIZE=2>"
	. WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INCALL&YKEY="_SNR
	. WRITE "&YBED="_YBED_"&YUCI="_$GET(YUCI)_"&YM="_YM
	. WRITE "&YBACK="_YBACK_"INPROJECT,"
	. WRITE "&YUSER="_YUSER
	. WRITE "&YNAME="_$$^WWWTEXT(31500)_":"_$PIECE($GET(^WWW013(0,YBED,1)),Y,1)  ;TODO für ;to 
	. WRITE """"_">"
	. IF $PIECE(YFELD,Y,20)'="" WRITE "<B>"_$$^WWWUML($EXTRACT($PIECE(YFELD,Y,20),1,85))_"</B>"      ; WEM;#23993;ADDED WWWUML AND EXTRACT
	. IF $PIECE(YFELD,Y,20)'="" IF $$^WWWUML($EXTRACT($PIECE(YFELD,Y,20),86,120))'="" WRITE "..."    ; WEM;#23993;ADDED LINE
	. IF $PIECE(YFELD,Y,21)'="" WRITE " ( "_$PIECE($GET(^INPARA(YM,"BEREICH",SPRACHE,$PIECE(YFELD,Y,21),1)),Y,1)_" )"     ;FAN;24449;27.10.03;Drucken Servicedokumentation mit Bereich
	. WRITE YCR,"</TD>"
	. WRITE YCR,"</TR>"
	. QUIT
	QUIT
	
LEER ;LEERANZEIGE, WENN KEINE DATENSÄTZE
	DO
	. NEW YI,YDDSATZ
	. S YDDSATZ=0
	. FOR YI(1)=1:1:1  DO
	. . DO NL^WWWTAB
	. . DO NF^WWWTAB
	. . WRITE $$^WWWTEXT(119)
	. . WRITE "&nbsp;"
	. . DO EF^WWWTAB
	. . DO NFRX1^WWWTAB(650)
	. . WRITE "&nbsp;"
	. . WRITE "</FONT>"
	. . DO EF^WWWTAB
	. . DO EL^WWWTAB
	. . QUIT
	. QUIT
	QUIT
]]></Routine>
</Export>