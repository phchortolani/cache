<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWDRAGDROP1" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWDRAGDROP1(POSITION,OBJEKT)
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		AUSFÜHREN OBJEKTVERSCHIEBUNG
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 07-Nov-2007	GRF		Doco; quits
	; 30.06.2003	FIS		Created
	;-------------------------------------------------------------------------------
	NEW LEFT,YAC,TOP,PIXEL,HEADLAENG,HEADSIZE,ROWS,COLUMNS,TIMESIZE,YINHALT,START,KEY,TOPX,YCHART,YRETVAL,Q,NEUEDAUER
	NEW XREF,LEFTX,XWID,YEXEC,YFELD,LEFT,TOP,FERTTERMIN,FERTUHRZEIT,LEFTOVER,RIGHTOVER,YINUSE,YSKEY,YKEY,WIDTH
	
	SET YRETVAL=""
	SET YINUSE=0  ;ABBRUCHVARIABLE
	SET Q=0
	;VERSCHIEBEN BEARBEITUNGSFENSTER ;defer 
	;-------------------------------
	IF $EXTRACT(OBJEKT,1,4)="edit" DO  QUIT YRETVAL
	. SET YCHART = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","CHART",1))  ;CHART
	. SET TOP    = $JUSTIFY($PIECE($GET(POSITION),"-",1),0,0)
	. SET LEFT   = $JUSTIFY($PIECE($GET(POSITION),"-",2),0,0)
	. SET $PIECE(^WWWDRAGDROP(0,YCHART,1),Y,17)=TOP_"/"_LEFT
	. SET YRETVAL="#FUNCTION~topedit="_TOP_"; leftedit="_LEFT_";"
	
	;VERSCHIEBEN BALKEN ;defer girder 
	;------------------
	DO
	. SET TOP=$PIECE($GET(POSITION),"-",1)
	. SET LEFT=$PIECE($GET(POSITION),"-",2)
	. SET WIDTH=$PIECE($GET(POSITION),"-",3)-4
	. ;
	. SET YCHART=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","CHART",1))  ;CHART
	. IF YCHART="" SET YRETVAL="!"_$$^WWWTEXT(119,,1) QUIT  ;FEHLER DATENSATZ NICHT GEFUNDEN ;shortcoming data record Not 
	. ;
	. SET PIXEL=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","PIXEL",1))  ;FELDGRÖSSE
	. IF PIXEL'>0 SET PIXEL=17
	. SET HEADLAENG = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","HEADLAENG",1))    ;ANZAHL LINKS FÜR BESCHREIBUNG ;Number on the left to description 
	. SET HEADSIZE  = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","HEADSIZE",1))     ;ANZAHL OBEN FÜR HEADER ;Number upstairs to 
	. SET TIMESIZE  = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","TIMESIZE",1))     ;ZEITSKALA
	. IF +TIMESIZE=0 SET TIMESIZE=1
	. SET BUTTONLINE =+$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","BUTTONLINE",1))  ;HÖHE BUTTONLINE ;highness 
	. SET ROWS       = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","ROWS",1))        ;ZEILEN
	. SET COLUMNS    = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","COLUMNS",1))     ;SPALTEN ;split 
	. SET START      = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","TIMESCALE",1))   ;START ZEITSKALA ;take-off 
	. SET ARBBEGINN  = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","ARBBEGINN",1))   ;ARBEITSBEGINN
	. IF +ARBBEGINN=0 SET ARBBEGINN=$PIECE($GET(^INVORG(YM,YM,1)),Y,152)
	. ;
	. SET YCHART1=$$VORG^WWWDRAGDROP(YCHART)   ;VORGABEN CHART
	. ;
	. SET LEFT = (LEFT\PIXEL)+1
	. SET TOP  = (TOP\PIXEL)+1
	. IF +HEADSIZE'=0   SET TOP=TOP-HEADSIZE
	. IF +BUTTONLINE'=0 SET TOP=TOP-BUTTONLINE
	. IF TOP<1          SET TOP=1
	. IF TOP>ROWS       SET TOP=ROWS
	. IF +HEADLAENG'=0  SET LEFT=LEFT-HEADLAENG
	. IF LEFT<1         SET LEFT=1
	. IF LEFT>(COLUMNS-HEADLAENG) SET LEFT=(COLUMNS-HEADLAENG)
	. ;
	. SET NEUEDAUER=0
	. IF $EXTRACT(OBJEKT,1,4)="size" DO  QUIT:NEUEDAUER=0  ;DAUER ÄNDERN ;permanence alter 
	. . SET OBJEKT=$EXTRACT(OBJEKT,5,99)
	. . IF ($PIECE(YCHART1,Y,62)'=1) || ($PIECE(YCHART1,Y,22)="") QUIT  ;KEINE ÄNDERUNG DER DAUER MÖGLICH ;no alteration the permanence potential 
	. . SET NEUEDAUER=1
	. ;
	. SET YSKEY=""
	. ;SET YKEY=$PIECE(OBJEKT,"_",1)_"-"_$PIECE(OBJEKT,"_",2)_"-"_$PIECE(OBJEKT,"_",3,999)
	. ;SET $PIECE(YKEY,"-",3)=$TRANSLATE($PIECE(YKEY,"-",3),"_",".")
	. SET YKEY=OBJEKT
	. IF $FIND(OBJEKT,"_") SET YKEY=$PIECE(OBJEKT,"_",1)_"-"_$PIECE(OBJEKT,"_",2)
	. IF $PIECE(OBJEKT,"_",3,999)'="" SET $PIECE(YKEY,"-",3)=$TRANSLATE($PIECE(OBJEKT,"_",3,999),"_",".")
	. IF $FIND(YKEY,"%s%") SET YSKEY=$PIECE(YKEY,"%s%",2) SET YKEY=$PIECE(YKEY,"%s%",1)
	. ;
	. SET FERTTERMIN  = (START-1)+(((LEFT-1)\TIMESIZE)+1)  ;NEUER STARTTERMIN TAG
	. SET FERTUHRZEIT = ((LEFT-((FERTTERMIN-START)*TIMESIZE))-1)  ;NEUER STARTTERMIN STUNDE ;time 
	. SET FERTUHRZEIT = ARBBEGINN+(FERTUHRZEIT*3600)  ;ALS UHRZEIT ;when 
	. ;
	. IF $PIECE(YCHART1,Y,37)=1 SET FERTTERMIN=$$^WWWDRAGDROP8(START,,FERTTERMIN) DO  ;NUR ARBEITSTAGE ANZEIGEN ;only display 
	. ;IF $PIECE(YCHART1,Y,37)=1 DO  ;NUR ARBEITSTAGE ANZEIGEN
	. ;. NEW YI,YQ
	. ;. IF FERTTERMIN=START IF '$DATA(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","FEIERTAG",START)) QUIT
	. ;. SET YQ=0
	. ;. FOR YI=START:1  QUIT:YQ=1  DO  ;SUCHEN FEIERTAGE ZWISCHEN START UND FERTIGUNGSTERMIN
	. ;. . IF YI>(START+(COLUMNS-HEADLAENG)) SET YQ=1 QUIT  ;MAX. ANZEIGE
	. ;. . IF $DATA(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","FEIERTAG",YI)) SET FERTTERMIN=FERTTERMIN+1  ;ÜBERSPRINGEN FEIERTAG
	. ;. . IF YI'<FERTTERMIN SET YQ=1  ;TERMIN ERREICHT
	. ;
	. ;EXECUTE NACH VERSCHIEBEN ;EXECUTE within defer 
	. ;------------------------
	. SET YEXEC=""
	. IF $PIECE(YCHART1,Y,34)'="" DO  ;LOCK PRÜFUNG ;quiz 
	. . NEW YDATEI,LOCK,EXEC
	. . SET YDATEI="^"_$PIECE(YCHART1,Y,34)_"("_""""_$$^WWWYM($PIECE(YCHART1,Y,34))_""""_","_""""_$PIECE(YKEY,"-",1)_""""
	. . IF $PIECE(YKEY,"-",2)'="" SET YDATEI=YDATEI_","_""""_$PIECE(YKEY,"-",2)_""""
	. . IF $PIECE(YKEY,"-",3)'="" SET YDATEI=YDATEI_","_""""_$PIECE(YKEY,"-",3)_""""
	. . SET YDATEI(2)=$TRANSLATE(YDATEI,"(,"_"""","/.")_"1/"
	. . SET YDATEI=YDATEI_",1)"
	. . IF $DATA(^WWW006(0,+$HOROLOG,YDATEI(2))) DO
	. . . IF $PIECE($GET(^WWW006(0,+$HOROLOG,YDATEI(2),1)),Y,1)'=YBED SET YINUSE=1  ;LOCK PRÜFEN ;check 
	. ;
	. IF YSKEY=""  SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",YKEY,1))              ;HOLEN DATEN ;send for 
	. IF YSKEY'="" SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",YKEY_"%s%"_YSKEY,1))  ;HOLEN DATEN ;send for 
	. ;
	. ;ÄNDERUNG DES TERMINS ;alteration 
	. IF NEUEDAUER'=1 DO
	. . SET $PIECE(YFELD,Y,$PIECE(YCHART1,Y,21))=FERTTERMIN   ;NEUER STARTTERMIN TAG
	. . SET $PIECE(YFELD,Y,$PIECE(YCHART1,Y,33))=FERTUHRZEIT  ;NEUER STARTTERMIN UHRZEIT
	. ;
	. ;ÄNDERUNG DER DAUER ;alteration the permanence 
	. IF NEUEDAUER=1 DO
	. . IF $PIECE(YFELD,Y,$PIECE(YCHART1,Y,21))<START SET YRETVAL="!"_$$^WWWTEXT(144,,1) QUIT  ;NICHT MÖGLICH ;Not potential 
	. . SET $PIECE(YFELD,Y,$PIECE(YCHART1,Y,22))=$JUSTIFY((((WIDTH/PIXEL))*3600),0,0)  ;DAUER NEU ;permanence recent 
	. ;
	. DO
	. . IF YINUSE=1 IF YSKEY=""  SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",YKEY,2))             QUIT  ;ALTE DATEN ZURÜCKHOLEN
	. . IF YINUSE=1 IF YSKEY'="" SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",YKEY_"%s%"_YSKEY,2)) QUIT  ;ALTE DATEN ZURÜCKHOLEN
	. . ;
	. . DO    ;EVENTHANDELR FÜR TASTENDRUCK (17=STRG 18=ALT) ;to
	. . . IF $PIECE(POSITION,"-",4)="17" IF $PIECE(YCHART1,Y,59)'="" XECUTE $PIECE(YCHART1,Y,59) QUIT  ;SONDER EXECUTE NACH STRG+VERSCHIEBEN ;EXECUTE within 
	. . . IF $PIECE(POSITION,"-",4)="18" IF $PIECE(YCHART1,Y,63)'="" XECUTE $PIECE(YCHART1,Y,63) QUIT  ;SONDER EXECUTE NACH ALT+VERSCHIEBEN ;EXECUTE within 
	. . . XECUTE $PIECE(YCHART1,Y,11)  ;STANDARD EXECUTE NACH VERSCHIEBEN ;EXECUTE within defer 
	. . ;
	. . IF $EXTRACT(YRETVAL)="!" SET YRETVAL=" alert("_""""_$TRANSLATE($EXTRACT(YRETVAL,2,999),"'"_"""","´´")_""""_");"
	. . IF Q=1 IF YSKEY=""  SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",YKEY,2))             QUIT  ;ALTE DATEN ZURÜCKHOLEN
	. . IF Q=1 IF YSKEY'="" SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",YKEY_"%s%"_YSKEY,2)) QUIT  ;ALTE DATEN ZURÜCKHOLEN
	. ;
	. IF YSKEY=""  SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",YKEY,1)=YFELD
	. IF YSKEY'="" SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",YKEY_"%s%"_YSKEY,1)=YFELD
	. ;
	. SET YRETVAL=$$^WWWDRAGDROP4()_YRETVAL  ;PRÜFEN ÄNDERUNGEN UND NEUSETZTEN DIAGRAMM ;check And 
	. IF YINUSE=1    SET YRETVAL=YRETVAL_" alert("_""""_$$^WWWTEXT(392,,1)_""""_");"  ; "Another User has changed the data record. Please Refresh This Page. Save is not possible."
	. IF YRETVAL'="" SET YRETVAL="#FUNCTION~"_YRETVAL
	
	QUIT YRETVAL
]]></Routine>
</Export>