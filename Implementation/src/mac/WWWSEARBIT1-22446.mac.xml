<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWSEARBIT1" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWSEARBIT1	;WWWSEARBIT1;FIS;SHOW SEARCH RESULT OF BIT SEARCH;11.07.2003  ; Compiled February 9, 2005 14:12:50
 
#include COMSYS
 
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		SHOW SEARCH RESULT OF BIT SEARCH
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| 04-Apr-2008		GM			SRBR014923: Changed $$^WWWTEXT() to $$$Text() for language text (53) 
	;| 07-Jul-2005		shobby		SR12892: WWW1263 is no longer shared.
	;| FIS	11.07.2003  
	;|
	;\------------------------------------------------------------------/
	;
	NEW YSUCH1,ANZAHL,ANZAB,TOTAL,ANZBIS,YLFN,YFELDER,YFELDER1,YSEARCHFULLTEXT
	SET YFORM=$GET(YFORM)
	SET YDATEI=$GET(YDATEI)
	IF YFORM="" QUIT
	;YSUCH1="FORMULAR;DATEI;SORTKEY;VORGABEKEY|VORGABEDATEN;ANZEIGE KEY;ANZEIGEFELD;STD SORT;ANZEIGE ERGEBNIS;ORIENTIERUNG;ANZAHL ANZEIGEN;FIXKEY;FELDER MIT SUMMENBILDUNG;WELCHEN KEY UEBERGEBEN;
	SET YSUCH1=""
	SET YSUCHV=""
	IF YSUCH="" SET YSUCH=$ORDER(^WWW123(0,YFORM,""))
	IF YSUCH'="" IF $PIECE($GET(^WWW123(0,YFORM,YSUCH,1)),Y,13)'=""  IF $ORDER(^WWW123(0,YFORM,YSUCH))'="" SET YSUCH=$ORDER(^WWW123(0,YFORM,YSUCH))
	IF YSUCH'="" IF $PIECE($GET(^WWW123(0,YFORM,YSUCH,1)),Y,13)'=""  IF $ORDER(^WWW123(0,YFORM,YSUCH))'="" SET YSUCH=$ORDER(^WWW123(0,YFORM,YSUCH))
	IF YSUCH'="" SET YSUCHV=$GET(^WWW123(0,YFORM,YSUCH,1))
	IF $PIECE(YSUCHV,Y,2)'="" SET YDATEI=$PIECE(YSUCHV,Y,2)
	IF YDATEI="" SET YDATEI=YFORM
	SET ANZAHL=10
	IF +$PIECE($GET(^WWW1263(YM,YFORM,YBED,1)),Y,1)'=0 SET ANZAHL=+$PIECE(^(1),Y,1)  ;INDIVIDUELLE SUCHE ;search 
	IF +$PIECE($GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YANZAHL",1)),Y,1)'=0 SET ANZAHL=$PIECE(^(1),Y,1)
	SET ANZAB=+$PIECE($GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YANZAB",1)),Y,1)
	IF +ANZAB'>0 SET ANZAB=1
	DO BITSEARCH^WWWSEARBIT2(YDATEI,,1)  ;ACHTUNG: ANZAB WIRD GGF. VERÄNDERT !
	SET ANZBIS=(ANZAB+ANZAHL-1)
	SET TOTAL=+$PIECE($GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YRESULT",1)),Y,1)
	IF TOTAL<ANZBIS SET ANZBIS=TOTAL
	IF TOTAL<ANZAB SET ANZAB=0 SET ANZBIS=0
	;DO BITSEARCH^WWWSEARBIT2(YDATEI)
	SET YFELDER=$TRANSLATE($PIECE(YSUCHV,Y,6),";",",")
	SET YFELDER1=$TRANSLATE($PIECE(YSUCHV,Y,16),";",",")
	SET YLFN="" FOR  SET YLFN=$ORDER(^WWW001B(0,YDATEI,YLFN),-1) QUIT:YLFN=""  DO  ;BITFELDER ERGÄNZEN   ;07.06.04;FAN;25866;ZENTRALE DATEI;YM-->0
	. IF $FIND(","_YFELDER_",",","_YLFN_",") QUIT
	. IF $EXTRACT($$^WWWFELDNAME(YDATEI,"D",YLFN),1,5)="_FREE" QUIT  ;FIS;14.10.04
	. SET YFELDER=YFELDER_","_YLFN SET YFELDER1=YFELDER1_","_YLFN
	. QUIT
	SET $PIECE(YSUCH1,Y,1)=YFORM   ;FORMULAR
	SET $PIECE(YSUCH1,Y,2)=YDATEI    ;DATEI ;data file 
	SET $PIECE(YSUCH1,Y,3)=""  ;SORTKEY
	SET $PIECE(YSUCH1,Y,4)=""   ;VORGABEKEY|VORGABEDATEN
	SET $PIECE(YSUCH1,Y,5)=$TRANSLATE($PIECE(YSUCHV,Y,5),";",",")       ;ANZEIGE KEY
	SET $PIECE(YSUCH1,Y,6)=YFELDER     ;ANZEIGEFELD
	SET $PIECE(YSUCH1,Y,7)=""     ;STD SORT
	SET $PIECE(YSUCH1,Y,8)=$TRANSLATE($PIECE(YSUCHV,Y,8),";",",")      ;ANZEIGEERGEBNIS
	SET $PIECE(YSUCH1,Y,9)=1      ;ORIENTIERUNG
	SET $PIECE(YSUCH1,Y,10)=ANZAHL    ;ANZAHL ;Number  ;Number Number 
	SET $PIECE(YSUCH1,Y,11)=""    ;FIXKEY
	SET $PIECE(YSUCH1,Y,11)=$TRANSLATE($PIECE(YSUCHV,Y,12),";",",")    ;FELDER MIT SUMMENBILDUNG
	SET $PIECE(YSUCH1,Y,12)=$TRANSLATE($PIECE(YSUCHV,Y,13),";",",")    ;WELCHEN KEY ÜBERGEBEN
	SET $PIECE(YSUCH1,Y,16)=YFELDER1    ;REIHENFOLGE DATENFELDER ;row 
	SET $PIECE(YSUCH1,Y,17)=""    ;FIXVORGABE SORTKEY
	SET $PIECE(YSUCH1,Y,20)="::"_$$^WWWTEXT(33529)  ;SUCHERGEBNIS
	;IF TOTAL>0 SET $PIECE(YSUCH1,Y,20)=$PIECE(YSUCH1,Y,20)_" "_ANZAB_" - "_ANZBIS_" ( "_$$^WWWTEXT(68)_" "_TOTAL_" )"  ;VON BIS ;until   ;BR014923
	IF TOTAL>0 SET $PIECE(YSUCH1,Y,20)=$PIECE(YSUCH1,Y,20)_" "_ANZAB_" - "_ANZBIS_" ( "_$$$Text($listbuild("53",TOTAL))_" )"  ;VON BIS ;until    ;BR014923  ;$lb("53",""): From %1
	IF TOTAL'>0 SET $PIECE(YSUCH1,Y,20)=$PIECE(YSUCH1,Y,20)_": 0"
	SET YSEARCHFULLTEXT=$PIECE($GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YSEARCHFULLTEXT",1)),Y,1)
	IF YSEARCHFULLTEXT'="" SET $PIECE(YSUCH1,Y,20)=$PIECE(YSUCH1,Y,20)_"</B>&nbsp;&nbsp;"_$$^WWWTEXT(33033)_" "_""""_YSEARCHFULLTEXT_""""
	SET $PIECE(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YSEARCHFULLTEXT",1),Y,1)=""
	;
	IF $PIECE(YSUCHV,Y,25)'="" DO
	. KILL ^CacheTempEDIT(YUSER)
	. MERGE ^CacheTempEDIT(YUSER,"SEL")=^WWWSOR(YUSER,"SEL")  ;ZWISCHENSPEICHERN FÜR BEARBEITUNG;FIS;27046;09.02.05
	. QUIT
	;
	SET YNOSORT=1
	SET YNOFOOT=1
	;
	WRITE YCR,"</pre>"
	WRITE YCR,"<style type='text/css'>"
	WRITE YCR,"body {background-color:"_YSILVER_";}"
	WRITE YCR,"td, th {font-size: 8pt;}"
	WRITE YCR,"</style>"
	NEW YBITSEARCH
	SET YBITSEARCH=1
	DO   ;TYBD ANZAHL ANZEIGEN ;Number display 
	. SET YANZAHL=$PIECE(YSUCH1,Y,10)
	. IF YANZAHL<1 IF YFORM'="" IF YBED'="" IF +$PIECE($GET(^WWW1263(YM,YFORM,YBED,1)),Y,1)'=0 SET YANZAHL=+$PIECE(^(1),Y,1)  ;INDIVIDUELLE SUCHE ;search 
	. IF +YANZAHL<1 SET YANZAHL=100
	. QUIT
	DO ^WWWSEAR3
	;focus setzten
	NEW YHTMFORM
	SET YHTMFORM="WWW"
	;WRITE YCR,"<SCRIPT language="_""""_"JavaScript"_""""_">"
	;WRITE YCR,"<!--"
	$$$StartScript()
	WRITE YCR,"function setFocus() {"
	WRITE YCR,"  var field=parent."_YHTMFORM_".YOPEN.value;"
	WRITE YCR,"  if (parent."_YHTMFORM_".YEXPANDSEAR.checked == 1) {"
	WRITE YCR,"    if (field != '' && field != 'undefined' && field != 'YANZAHL' && field != 0) eval('parent."_YHTMFORM_".'+field+'.focus()');"
	WRITE YCR,"    else parent."_YHTMFORM_".key1.focus();"
	;WRITE YCR,"    else parent."_YHTMFORM_".elements[1].focus();"
	WRITE YCR,"  }"
	WRITE YCR,"  else {"
	WRITE YCR,"     parent."_YHTMFORM_".key1.focus();"
	;WRITE YCR,"    parent."_YHTMFORM_".Y"_YDATEI_"P1.focus();"
	WRITE YCR,"  }"
	WRITE YCR,"}"
	WRITE YCR,"window.setTimeout("_""""_"setFocus();"_""""_",10);"
	WRITE YCR,"window.setTimeout('parent.setHighLight("_""""_((ANZAB\YANZAHL)+1)_""""_")',1);"
	;WRITE YCR,"//-->"
	;WRITE YCR,"</SCRIPT>"
	$$$EndScript()
	QUIT
]]></Routine>
</Export>