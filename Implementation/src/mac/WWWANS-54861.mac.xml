<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWANS" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWANS ;WWWANS;DT;AUTOMATISCHE EMAIL BEANTWORTUNG;10.09.1999
#include COMSYS   ;BR014923
 
	;------------------------------------------------------------------\
	; Description of Function :
	;		AUTOMATISCHE EMAIL BEANTWORTUNG
	;
	; Inputs : 
	;
	; ByRef :
	;
	; Returns :
	;
	; History :
	; 04-Apr-2008	GM		SRBR014923: Changed $$^WWWTEXT() to $$$Text() for language text (53)  
    ; 29-Mar-2006	SC				SR13942: Use JobWrapper^COMUtilJob.
	; 30-May-2005		RobertW		SR12056: Attempt at Performance Increase
	; DT	10.09.1999
	;------------------------------------------------------------------/
	;hintergrundprogramm auto email ;E-Mail 
	;J ^WWWANS
	;YZEILE=LFD ZEILE
	;TEXT(YZEILE)=SENDETEXT
	;SUBJECT=BETREFF
	QUIT:'$DATA(^WWWANS(0))    ;KEINE VORGABEN ;no 
	LOCK +^WWWANS(0):0 QUIT:'$TEST   ;SCHON IN BEARBEITUNG ;yet within adaptation 
	JOB START^WWWANS::1    ;JOB STARTEN ;launching  ;SR13942
	;do JobWrapper^COMUtilJob("START^WWWANS",YUSER,1)
	LOCK -^WWWANS(0)
	QUIT
	
START ;STARTEN VERARBEITUNG ;launching processing 
	;------------------------------------------------------------------
	; History:
	; 29-Mar-2006 	SC		SR13942: No longer set environment within routine. 
	; 						Maintained by calling function.
	;------------------------------------------------------------------
	LOCK +^WWWANS(0):4 QUIT:'$TEST   ;SCHON IN BEARBEITUNG ;yet within adaptation 
	DO ^WWWVAR ;SR13942 reversed
	KILL ^WWWSOR("MAIL")
	SET ^WWWSOR("MAIL",1)=""  
	FOR  DO  QUIT:'$DATA(^WWWSOR("MAIL",1))
	. SET YQ=0
	. SET YMAIL="" FOR  SET YMAIL=$ORDER(^WWWANS(0,YMAIL)) QUIT:YMAIL=""  DO  ;durchsuchen mail ;scour 
	. . SET YANS=$GET(^WWWANS(0,YMAIL,1))  ;DATEN AUS VORGABE ;out of default 
	. . IF $PIECE(YANS,Y,9)="" SET $PIECE(YANS,Y,9)="IN"  ;ABLAGE IN ;within 
	. . IF $PIECE(YANS,Y,10)="" SET $PIECE(YANS,Y,10)="OUT"  ;ABLAGE OUT
	. . SET YSECOUND=$PIECE(YMAIL,Y,7)  ;ANZAHL SEKUNDEN WARTEN ;Number wait for 
	. . SET YSCHEMA=$TRANSLATE($PIECE(YMAIL,Y,8),";",",") IF +YSCHEMA'=0 IF '$FIND(","_YSCHEMA_",",","_$$^WWWDAY($HOROLOG)_",") QUIT  ;NICHT FÜR DIESEN TAG
	. . SET YLAST=$GET(^WWWSOR("MAIL",1,YMAIL))  ;LETZTER VERSUCH ;last experiment 
	. . IF $PIECE(YLAST,Y,1)=+$HOROLOG IF ($PIECE(YLAST,Y,2)+YSECOUND)>$PIECE($HOROLOG,",",2) QUIT  ;ZU FRÜH ;within early 
	. . DO READ  ;LESEN EMAILS
	. . DO SAVE  ;SPEICHERN EMAILS UND AUSWERTEN ;Save And 
	. . SET ^WWWSOR("MAIL",1,YMAIL)=+$HOROLOG_Y_$PIECE($HOROLOG,",",2)  ;ZEITSTEMPEL
	. . QUIT
	. HANG 10 ;WARTEN 60 SEKUNDEN ;wait for 
	. QUIT
	QUIT
	
READ ;SUCHEN FORGABEN ,LESEN EMAIL
	SET TCP=$PIECE(YANS,Y,2)
	IF TCP="" SET TCP=$PIECE($GET(^WWW012(0,YM,1)),Y,39)
	IF TCP="" SET TCP=$PIECE($GET(^WWW012(0,YM,1)),Y,40)
	IF TCP="" SET TCP="127.0.0.1"
	SET GLOB="^WWWSOR("_""""_"MAIL"_""""_",2"
	SET UUSER=$PIECE(YANS,Y,4)
	IF UUSER="" SET UUSER="info"
	SET PASSWD=$PIECE(YANS,Y,5)
	IF PASSWD="" SET PASSWD="info"
	SET DELETE=1 IF $PIECE(YANS,Y,6)=1 SET DELETE=0
	SET EMPFOK=$$^WWWMAILR(TCP,UUSER,PASSWD,DELETE,GLOB)  ;LESEN DATEN ;read 
	QUIT
	
SAVE ;SPEICHERN DATEN
	SET NR="" FOR  SET NR=$ORDER(^WWWSOR("MAIL",2,NR)) QUIT:NR=""  DO
	. SET CC=""
	. SET FROM=""
	. SET SUBJECT=""
	. FOR ITEM="CC","FROM","SUBJECT","DATE" DO
	. . ;FOR I=1:1 QUIT:'$DATA(^WWWSOR("MAIL",2,NR,I,1))  IF $$^WWWUPER($PIECE(^(1),": "))=ITEM DO  QUIT
	. . FOR I=1:1 QUIT:'$DATA(^WWWSOR("MAIL",2,NR,I,1))  IF $zconvert($PIECE(^(1),": "),"U")=ITEM DO  QUIT
	. . . SET FELD=$TRANSLATE($PIECE(^(1),": ",2,255),"<>,+"_"""","()")
	. . . IF ITEM="FROM" IF $PIECE($PIECE(FELD,"(",2),")",1)'="" SET FELD=$PIECE($PIECE(FELD,"(",2),")",1)
	. . . IF ITEM="CC" IF $PIECE($PIECE(FELD,"(",2),")",1)'="" SET FELD=$PIECE($PIECE(FELD,"(",2),")",1)
	. . . SET @ITEM=FELD
	. . . QUIT
	. . QUIT
	. SET SUBJECT=$$^WWWUMLX(SUBJECT)  ;UMSETZUNG UMLAUTE ;transferral 
	. SET BOUNDARY=""
	. SET PRINTABLE=""
	. FOR ITEM="BOUNDARY=","CONTENT-TRANSFER-ENCODING: QUOTED-PRINTABLE" DO
	. . ;FOR I=1:1 QUIT:'$DATA(^WWWSOR("MAIL",2,NR,I,1))  IF $FIND($$^WWWUPER(^(1)),ITEM) DO  QUIT
	. . FOR I=1:1 QUIT:'$DATA(^WWWSOR("MAIL",2,NR,I,1))  IF $FIND($zconvert(^(1),"U"),ITEM) DO  QUIT
	. . . IF ITEM="BOUNDARY=" SET BOUNDARY=$TRANSLATE($PIECE(^(1),"boundary=",2),"""")
	. . . IF ITEM="CONTENT-TRANSFER-ENCODING: QUOTED-PRINTABLE" SET PRINTABLE=I QUIT
	. . . QUIT
	. . QUIT
	. IF BOUNDARY="" SET BOUNDARY="---=_NextPart"
	. IF DATE="" SET DATE=" "
	. IF FROM="" SET FROM=" "
	. IF CC="" SET CC=" "
	. IF PRINTABLE="" DO
	. . FOR PRINTABLE=2:1 QUIT:'$DATA(^WWWSOR("MAIL",2,NR,I,1))  QUIT:^(1)=""  SET ^(1)=$$^WWWUMLX(^(1))
	. . QUIT
	. SET PRINTABLE=PRINTABLE+1
	. MERGE ^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM)=^WWWSOR("MAIL",2,NR)  ;save zwischendatei
	. DO ANSWER  ;PRUEFEN RÜCKEMAIL
	. KILL ^WWWSOR("MAIL",2,NR)
	. QUIT
	KILL ^WWWSOR("MAIL",2)
	QUIT
	
ANSWER ;ANTWORT SUCHEN , pruefen ob save oder send
	;SUBJECT=BETREFF
	SET YOK=0  ;PRUFUNG OK DANN YOK=1  = RUECKEMAIL SENDEN ;transmit 
	SET YPRUE=""
	;PRUEFUNG
	SET YREGEL="" FOR YYREGEL=1:1 SET YREGEL=$ORDER(^WWWANSR(0,YMAIL,YREGEL)) QUIT:YREGEL=""  SET YOK=0 DO  IF YOK=1 DO ANSWER1
	. SET YPRUE=$GET(^WWWANSR(0,YMAIL,YREGEL,1))  ;DATEN AUS REGEL ;out of regulation 
	. IF $PIECE(YPRUE,Y,1)'="" QUIT  ;NUR EINE VERKNÜPFUNG ;only one 
	. IF YYREGEL'=1 QUIT:$PIECE(YPRUE,Y,2)=0  ;UND PRUEFUNG BEI FOLGEREGEL ;And next to 
	. IF +$PIECE(YPRUE,Y,10)=0 SET YOK=0 QUIT  ;KEIN EMAIL ERZEUGEN ;no reproduce 
	. ;variablen = Subject, from , daten in ^WWWANA(0,$P(YANS,Y,9),DATE,SUBJECT,FROM,YZEIL,1)
	. SET YEXE=$PIECE(YPRUE,Y,6) IF YEXE'="" SET Q=0,YOK=0 XECUTE YEXE SET:Q=0 YOK=1 IF YOK=0 QUIT   ;MANUELLE PRÜFUNG OK, q=0 = ok q=1 nichtOK 
	. SET YWAS=+$PIECE(YPRUE,Y,3)
	. SET YWIE=+$PIECE(YPRUE,Y,4)
	. ;SET YTXT=$$^WWWUPER($PIECE(YPRUE,Y,5))
	. SET YTXT=$zconvert($PIECE(YPRUE,Y,5),"U")
	. ;
	. ;PRUEFEN OB EIN E-MAIL ERZEUGT WIRD ;whether uni- 
	. ;
	. IF YWIE=0 SET YOK=1 QUIT    ;IMMER AUFBEREITEN ;constantly 
	. ;
	. IF YWIE=1 DO    ;ENTHÄLTPRÜFUNG
	. . ;IF YWAS=1!(YWAS=0) IF $FIND($$^WWWUPER(SUBJECT),YTXT) SET YOK=1 QUIT
	. . IF YWAS=1!(YWAS=0) IF $FIND($zconvert(SUBJECT,"U"),YTXT) SET YOK=1 QUIT
	. . IF YWAS'=1 DO  ;ALLES ;whatsoever 
	. . . SET YZEI="" FOR  SET YZEI=$ORDER(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI)) QUIT:YZEI=""  DO  QUIT:YOK=1
	. . . . ;IF $FIND($$^WWWUPER($GET(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI,1))),YTXT) SET YOK=1 QUIT
	. . . . IF $FIND($zconvert($GET(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI,1)),"U"),YTXT) SET YOK=1 QUIT
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. ;
	. IF YWIE=2 DO    ;NICHT ENTHÄLTPRÜFUNG ;Not 
	. . SET YOK=1
	. . ;IF YWAS=1!(YWAS=0) IF $FIND($$^WWWUPER(SUBJECT),YTXT) SET YOK=0 QUIT
	. . IF YWAS=1!(YWAS=0) IF $FIND($zconvert(SUBJECT,"U"),YTXT) SET YOK=0 QUIT
	. . IF YWAS'=1 DO  ;ALLES ;whatsoever 
	. . . SET YZEI="" FOR  SET YZEI=$ORDER(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI)) QUIT:YZEI=""  DO  QUIT:YOK=0
	. . . . ;IF $FIND($$^WWWUPER($GET(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI,1))),YTXT) SET YOK=0 QUIT
	. . . . IF $FIND($zconvert($GET(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI,1)),"U"),YTXT) SET YOK=0 QUIT
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. ;
	. IF YWIE=3 DO   ;NICHT VORHANDEN PRÜFUNG ;Not on hand quiz 
	. . SET YOK=1
	. . IF YWAS=1!(YWAS=0) IF $TRANSLATE(SUBJECT," ")'="" SET YOK=0 QUIT
	. . IF YWAS'=1 DO  ;ALLES ;whatsoever 
	. . . SET YZEI="" FOR  SET YZEI=$ORDER(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI)) QUIT:YZEI=""  DO  QUIT:YOK=0
	. . . . IF $TRANSLATE($GET(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI,1))," ")'="" SET YOK=0 QUIT
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. ;
	. ;
	. ;UND PRUEFUNG ;And 
	. IF YOK=1 SET YYREGEL=YREGEL SET YYREGEL=$ORDER(^WWWANSR(0,YMAIL,YYREGEL)) QUIT:YYREGEL=""  DO
	. . SET YPRUE1=$GET(^WWWANSR(0,YMAIL,YREGEL,1))  ;DATEN AUS REGEL ;out of regulation 
	. . QUIT:$PIECE(YPRUE1,Y,1)'=YYREGEL  ;NICHT DIE ZUORDNUNGSREGEL ;Not who 
	. . QUIT:$PIECE(YPRUE1,Y,2)'=0  ;KEINE UND PRÜFUNG ;no And quiz 
	. . SET YEXE=$PIECE(YPRUE1,Y,6) IF YEXE'="" SET Q=0 XECUTE YEXE SET:Q=1 YOK=0 QUIT  ;MANUELLE PRÜFUNG NICHT OK ;quiz Not 
	. . SET YWAS=+$PIECE(YPRUE1,Y,3)
	. . SET YWIE=+$PIECE(YPRUE1,Y,4)
	. . ;SET YTXT=$$^WWWUPER($PIECE(YPRUE1,Y,5))
	. . SET YTXT=$zconvert($PIECE(YPRUE1,Y,5),"U")
	. . ;
	. . ;PRUEFEN OB EIN E-MAIL ERZEUGT WIRD ;whether uni- 
	. . ;
	. . IF YWIE=0 SET YOK=1 QUIT    ;IMMER AUFBEREITEN ;constantly 
	. . ;
	. . IF YWIE=1 DO  QUIT:YOK=0   ;ENTHÄLTPRÜFUNG
	. . . ;IF YWAS=1!(YWAS=0) IF '$FIND($$^WWWUPER(SUBJECT),YTXT) SET YOK=0 QUIT
	. . . IF YWAS=1!(YWAS=0) IF '$FIND($zconvert(SUBJECT,"U"),YTXT) SET YOK=0 QUIT
	. . . IF YWAS'=1 DO  ;ALLES ;whatsoever 
	. . . . SET YOK=0
	. . . . SET YZEI="" FOR  SET YZEI=$ORDER(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI)) QUIT:YZEI=""  DO  QUIT:YOK=1
	. . . . . ;IF $FIND($$^WWWUPER($GET(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI,1))),YTXT) SET YOK=1 QUIT
	. . . . . IF $FIND($zconvert($GET(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI,1)),"U"),YTXT) SET YOK=1 QUIT
	. . . . . QUIT
	. . . . QUIT
	. . . QUIT
	. . ;
	. . IF YWIE=2 DO  QUIT:YOK=0   ;NICHT ENTHÄLTPRÜFUNG ;Not 
	. . . SET YOK=0
	. . . ;IF YWAS=1!(YWAS=0) IF '$FIND($$^WWWUPER(SUBJECT),YTXT) SET YOK=1 QUIT
	. . . IF YWAS=1!(YWAS=0) IF '$FIND($zconvert(SUBJECT,"U"),YTXT) SET YOK=1 QUIT
	. . . IF YWAS'=1 DO  ;ALLES ;whatsoever 
	. . . . SET YZEI="" FOR  SET YZEI=$ORDER(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI)) QUIT:YZEI=""  DO  QUIT:YOK=0
	. . . . . ;IF $FIND($$^WWWUPER($GET(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI,1))),YTXT) SET YOK=0 QUIT
	. . . . . IF $FIND($zconvert($GET(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI,1)),"U"),YTXT) SET YOK=0 QUIT
	. . . . . QUIT
	. . . . QUIT
	. . . QUIT
	. . ;
	. . IF YWIE=3 DO  QUIT:YOK=0   ;NICHT VORHANDEN PRÜFUNG ;Not on hand quiz 
	. . . SET YOK=1
	. . . IF YWAS=1!(YWAS=0) IF $TRANSLATE(SUBJECT," ")'="" SET YOK=0 QUIT
	. . . IF YWAS'=1 DO  ;ALLES ;whatsoever 
	. . . . SET YZEI="" FOR  SET YZEI=$ORDER(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI)) QUIT:YZEI=""  DO  QUIT:YOK=0
	. . . . . IF $TRANSLATE($GET(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YZEI,1))," ")'="" SET YOK=0 QUIT
	. . . . . QUIT
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
	
ANSWER1 ;ANTWORTEN ;respond 
	;YZEILE=LFD ZEILE
	;TEXT(YZEILE)=SENDETEXT
	;SUBJECT=BETREFF
	KILL TEXT,TXT
	NEW YZEILE
	SET YZEILE=0
	;TEXT1
	SET YANT=$PIECE(YPRUE,Y,20) IF YANT'="" DO
	. FOR YLINE=1:1 QUIT:$PIECE(YANT,"|",YLINE,9999)=""  DO
	. . SET YZEILE=YZEILE+1
	. . SET TEXT(YZEILE)=$PIECE(YANT,"|",YLINE)
	. . QUIT
	. QUIT
	SET YEXE=$PIECE(YPRUE,Y,21) IF YEXE'="" XECUTE YEXE   ;MANUELLER EINTRAG
	;TEXT1
	SET YANT=$PIECE(YPRUE,Y,25) IF YANT'="" DO
	. FOR YLINE=1:1 QUIT:$PIECE(YANT,"|",YLINE,9999)=""  DO
	. . SET YZEILE=YZEILE+1
	. . SET TEXT(YZEILE)=$PIECE(YANT,"|",YLINE)
	. . QUIT
	. QUIT
	SET YEXE=$PIECE(YPRUE,Y,26) IF YEXE'="" XECUTE YEXE   ;MANUELLER EINTRAG
	;TEXT2
	SET YANT=$PIECE(YPRUE,Y,30) IF YANT'="" DO
	. FOR YLINE=1:1 QUIT:$PIECE(YANT,"|",YLINE,9999)=""  DO
	. . SET YZEILE=YZEILE+1
	. . SET TEXT(YZEILE)=$PIECE(YANT,"|",YLINE)
	. . QUIT
	. QUIT
	SET YEXE=$PIECE(YPRUE,Y,31) IF YEXE'="" XECUTE YEXE   ;MANUELLER EINTRAG
	IF $PIECE(YPRUE,Y,11)=1 DO  ;ORIGINALTEXT SENDEN ;transmit 
	. SET YZEILE=YZEILE+1
	. SET TEXT(YZEILE)="------------------------------------------------------------------"
	. SET Q=0
	. FOR YLFN=PRINTABLE:1 QUIT:'$DATA(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YLFN,1))  DO  QUIT:Q=1
	. . IF BOUNDARY'="" IF $FIND(^(1),BOUNDARY) SET Q=1 QUIT
	. . SET YZEILE=YZEILE+1
	. . SET TEXT(YZEILE)=">"_^(1)
	. . QUIT
	. QUIT
	
SEND ;SENDEN DES EMAILS ;transmit 
	SET TCP=$PIECE(YANS,Y,3)
	IF TCP="" SET TCP=$PIECE($GET(^WWW012(0,YM,1)),Y,40)
	IF TCP="" SET TCP="127.0.0.1"
	SET UUSER=YMAIL
	IF $PIECE(YPRUE,Y,12)'="" SET UUSER=$PIECE(YPRUE,Y,12)  ;NEUER SENDER ;transmitter 
	SET BETR=SUBJECT  ;BETREFF SETZEN ;typeset 
	;IF $$^WWWLOW($EXTRACT(BETR,1,3))'="re:" SET BETR="Re: "_BETR
	IF $zconvert($EXTRACT(BETR,1,3),"L")'="re:" SET BETR="Re: "_BETR
	IF $PIECE(YPRUE,Y,13)'="" SET BETR=$PIECE(YPRUE,Y,13)  ;NEUER BETREFF
	IF $PIECE(YPRUE,Y,14)'="" SET:BETR'="" BETR=BETR_" " SET BETR=BETR_$PIECE(YPRUE,Y,14)  ;BETREFF ZUSATZ ;cumulative 
	IF BETR="" SET BETR=" "
	IF $PIECE(YPRUE,Y,15)'="" XECUTE @$PIECE(YPRUE,Y,15)  ;EXECUTE BEI BETREFF ;EXECUTE next to 
	SET TXT="TEXT"
	MERGE ^WWWANA(0,$PIECE(YANS,Y,10),$$^WWWDATE($HOROLOG)_" "_$$^WWWTIME($HOROLOG),BETR,FROM)=TEXT  ;SICHERUNG
	SET OKSEND=$$^WWWMAILS(TCP,UUSER,FROM,BETR,TXT)
	IF $PIECE(YPRUE,Y,7)'="" DO WEITER
	QUIT
	
WEITER ;WEITERLEITEN DER NACHRICHT ;the communication 
	NEW TEXT,TXT,txt
	SET YZEILE=0
	SET YZEILE=YZEILE+1
	;SET TEXT(YZEILE)=$$^WWWTEXT(68)_" "_FROM   ;BR014923
	SET TEXT(YZEILE)=$$$Text($listbuild("53",FROM))  ;BR014923  ;$lb("53",""): From %1
	SET YZEILE=YZEILE+1
	SET TEXT(YZEILE)="------------------------------------------------------------------"
	SET Q=0
	FOR YLFN=PRINTABLE:1 QUIT:'$DATA(^WWWANA(0,$PIECE(YANS,Y,9),DATE,SUBJECT,FROM,YLFN,1))  DO  QUIT:Q=1
	. IF BOUNDARY'="" IF $FIND(^(1),BOUNDARY) SET Q=1 QUIT
	. SET YZEILE=YZEILE+1
	. SET TEXT(YZEILE)=^(1)
	. QUIT
	SET TCP=$PIECE(YANS,Y,3)
	IF TCP="" SET TCP=$PIECE($GET(^WWW012(0,YM,1)),Y,40)
	IF TCP="" SET TCP="127.0.0.1"
	SET UUSER=YMAIL
	IF $PIECE(YPRUE,Y,12)'="" SET UUSER=$PIECE(YPRUE,Y,12)  ;NEUER SENDER ;transmitter 
	SET BETR="Fw: "_SUBJECT  ;BETREFF SETZEN ;typeset 
	SET TO=$PIECE(YPRUE,Y,7)  ;WEITERLEITEN AN ;upon 
	SET TXT="TEXT"
	MERGE ^WWWANA(0,$PIECE(YANS,Y,10),$$^WWWDATE($HOROLOG)_" "_$$^WWWTIME($HOROLOG),BETR,TO)=TEXT  ;SICHERUNG
	SET OKSEND=$$^WWWMAILS(TCP,UUSER,TO,BETR,TXT)
	QUIT
]]></Routine>
</Export>