<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWW013ZG" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWW013ZG(MIT,VON,BIS)
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		MITARBEITER IN ZEITRAUM GESAMT ARBEITSZEIT 
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	08.08.2000
	;|
	;\------------------------------------------------------------------/
	;GGF IN WWW013L Ã„NDERN ;within alter 
	NEW A,VVV,BBB,UHRZ,TAGREST,PARA,TAG,LFUN,UHR,PAUSE,FUN,SEKUNDEN
	
	IF MIT="" QUIT 0  ;MITARBERTER
	IF '$DATA(^WWW013(0,MIT,1)) QUIT 0
	IF VON="" QUIT 0  ;VON DATUM ;Date 
	IF BIS="" QUIT 0  ;BIS DATUM ;until Date 
	
	SET BETRIEB=$PIECE($GET(^WWW013(0,MIT,1)),Y,44)
	IF BETRIEB="" SET BETRIEB=YLOCATION
	SET TOTALZ=0
	SET TAGREST=0  ;REST BEI PAUSEN ;residue next to 
	SET PARA=$GET(^WWW013(0,MIT,1))
	FOR TAG=VON:1:BIS DO
	. SET GTAG1=0   ;GESAMTER ZEIT ;time 
	. SET VVV=0
	. SET LFUN=""
	. SET UHRZ=""
	. FOR  SET UHRZ=$ORDER(^WWW013Z(YM,BETRIEB,TAG,MIT,UHRZ)) QUIT:UHRZ=""  DO
	. . SET FUN=$ORDER(^WWW013Z(YM,BETRIEB,TAG,MIT,UHRZ,""))
	. . QUIT:FUN>1  ;KEINE AUSWERTUNG DER LEISTUNGEN ;no the LEISTUNGEN 
	. . IF UHRZ=$ORDER(^WWW013Z(YM,BETRIEB,TAG,MIT,"")) IF FUN'=1 QUIT  ;START MIT CHECKOUT ;take-off by means of 
	. . QUIT:LFUN=FUN  ;WIEDERHLOUNG VON CHECKIN/OUT
	. . SET LFUN=FUN
	. . IF FUN=1 DO
	. . . SET UHR=UHRZ
	. . . SET PAUSE=0
	. . . DO VON  ;ERRECHNEN PAUSE ;calculate pause 
	. . . SET VVV=UHRZ
	. . IF FUN=0 IF +VVV'=0 DO  ;ENDE ARBEIT ;termination work 
	. . . SET BBB=UHRZ
	. . . QUIT:BBB<VVV   ;FEHLER ;shortcoming 
	. . . QUIT:BBB=VVV   ;FEHLER ;shortcoming 
	. . . DO BIS
	. . . SET TOTALZ=TOTALZ+SEKUNDEN  ;GESAMTER ZEITRAUM
	
	QUIT TOTALZ
	
VON ;RECHNEN VON ;have faith in 
	DO PARA
	SET PAUSE=0
	SET UHR1=$ORDER(^WWW013Z(YM,BETRIEB,TAG,MIT,UHR),-1)
	IF UHR1'="" SET PAUSE=UHR-UHR1  ;PAUSE ;recess 
	IF PAUSE>3900!(UHR=$ORDER(^WWW013Z(YM,BETRIEB,TAG,MIT,""))) DO  QUIT  ;ANFANG D. TAGES ;outset 
	. SET UHRSTART=UHR+10
	. SET SREST=UHRSTART#$PIECE(PARA,Y,83)
	. SET SZEIT=UHRSTART\$PIECE(PARA,Y,83)
	. SET SZEIT=SZEIT+1
	. IF (SREST-$PIECE(PARA,Y,84)-1)<1 SET SZEIT=SZEIT-1
	. SET UHR=SZEIT*$PIECE(PARA,Y,83)
	. SET PAUSE=0
	
	IF PAUSE>300 DO  QUIT
	. IF PAUSE>2100 SET UHR=UHR1-(TAGREST*60)+3540,PAUSE=3600,TAGREST=0 QUIT
	. SET UHR=UHR1-TAGREST+1740,PAUSE=1800,TAGREST=0 QUIT
	
	SET PAUSE=0
	QUIT
	
BIS ;ERRECHNEN ARBEITSZEIT UND STDSATZ ;working hours And 
	DO PARA
	SET SEKARB=(BBB-VVV)  ;SEKUNDEN GEARBEITET
	SET SEKARB=SEKARB+TAGREST SET TAGREST=0  ;WENN VORHER EIN REST BLIEB ;when pre- uni- residue 
	SET SSF=0   ;SONN und Feiertag ;and holiday 
	IF $DATA(^TERMIN9(0,"DE",TAG,1)) SET SSN=1  ;feiertag
	IF $$^WWWDAY(TAG)=7 SET SSF=1  ;SONNTAG ;Sunday 
	SET GREST=SEKARB#EINHEIT
	SET GZEIT=SEKARB\EINHEIT
	IF (GREST+$PIECE(PARA,Y,85))>EINHEIT SET GZEIT=GZEIT+1
	SET SEKUNDEN=GZEIT*EINHEIT
	SET TAGREST=SEKARB-SEKUNDEN
	QUIT
	
PARA ;VORGABEN
	SET ZUSCHLAG=$PIECE(PARA,Y,76)    ;SONN UND F. ZUSCHLAG ;And surcharge 
	SET STDSATZ=$PIECE(PARA,Y,75)      ;LOHN ;reward 
	SET EINHEIT=$PIECE(PARA,Y,86)   ;ABRECHNUNGSEINHEIT
	IF +EINHEIT=0 SET EINHEIT=60  ;eine MINUTE ;one minute 
	IF $PIECE(PARA,Y,83)="" SET $PIECE(PARA,Y,83)=1  ;ANFANG JEDE minute ;outset 
	IF $PIECE(PARA,Y,84)="" SET $PIECE(PARA,Y,84)=0  ;KULANZ
	IF $PIECE(PARA,Y,85)="" SET $PIECE(PARA,Y,85)=0  ;ENDEKULANZ
	QUIT
	
]]></Routine>
</Export>