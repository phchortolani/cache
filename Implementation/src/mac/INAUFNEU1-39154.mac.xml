<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFNEU1" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFNEU1
#include COMSYS
#include INConst
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		VERTEILEN KUNDENSUCHE /LIEFERANTENSUCHE 
	;	 	Called by form INAUFNEU (Create New Order) when saving data
	;
	; Inputs : 
	;	VORG(2)		Enter Customer Number
	;	VORG(3)		Full Text Search for Customers
	;	VORG(5)		Enter Order Number
	;
	;	VORG(6)		Master Scheduled Order			(y/n)
	;
	;	VORG(7)		Enter Supplier Number
	;	VORG(8)		Full Text Search for Suppliers
	;	VORG(9)		Edit Order Number
	;
	;	VORG(10)	Requisition						(y/n)
	;
	; ByRef :
	;
	; Returns :
	;	Calls Form INAUF
	;	with VORG(1) in addition
	;	and YFELD	equivalent to objINAUF - saved as well
	;	
	; History :
	; 11-Jul-2007	GRF		SR15572: Doco; quits; naked reference
	; 04-Jan-2007	shobby	SR15348:Redirect form to new 'Create Requistion' screen
	; 						when 'Requisition' checkbox is ticked.
	; 23-Jul-2005	GRF		SR13024 : Doco
	; 14.01.2000	DT
	;-------------------------------------------------------------------------------
	NEW ACCVK,ACCAL,ACCKD,ACCEI,ACCLE,ACCRE
	
	;----------------------------------BERECHTIGUNGEN------------------------------- fan 02.10.02
	DO VOR^INAUFBERECHT     ;19.12.03;FAN;24831;VORBEREITEN-------BERECHTIGUNGEN-
	
	;---------------------------------------
	; Customer Order
	;---------------------------------------
	
	IF VORG(2)'="" IF $DATA(^INKUNDE(YM,VORG(2))) SET VORG(1)=VORG(2)  ;KUNDENNUMMER ALS AUSWAHL ;when Selection 
	IF VORG(3)'="" SET VORG(1)=VORG(3)  ;VOLLTEXTSUCHE KUNDEN
	SET VORG(1)="#"_$GET(VORG(1))       ;NORMALE SUCHE ;search 
	
	;IF $G(VORG(4))'="" SET VORG(1)="-"_VORG(4)  ;SUCHE NACH AUFTAGSNUMMER  ;ALT, NUR WENN ALLE AUFTRAÄGE ANGEZEIGT WERDEN SOLLEN TYBD 13.07.2002
	IF VORG(9)'="" SET VORG(5)=VORG(9)
	
	;IF VORG(5)'="" IF $DATA(^INAUF(YM,VORG(5),1)) SET AUF1=$G(^INAUF(YM,VORG(5),1)) DO
	;. ;IF +$P(AUF1,Y,169)'=0 IF ACCRE=1 SET VORG(1)="-"_VORG(5)  ;REKLAMATIONEN
	;. IF +$P(AUF1,Y,169)=0 DO
	;. . IF $P(AUF1,Y,2)="" SET $P(AUF1,Y,2)=0
	;. . IF $P(AUF1,Y,2)=0 IF ACCKD=1 SET VORG(1)="-"_VORG(5)      ;KUNDE AUFTRAG
	;. . IF $P(AUF1,Y,2)=1 IF ACCEI=1 SET VORG(1)="-"_VORG(5)      ;EIGENE AUFTRAG
	;. . IF $P(AUF1,Y,2)=2 IF ACCLE=1 SET VORG(1)="-"_VORG(5)      ;LIEFERRANTEN-BESTELLUNGEN
	
	IF (VORG(5)'="") && '$DATA(^INAUF(YM,VORG(5),1)) && ($ORDER(^INAUFs(YM,24,$$^WWWUMLAU(VORG(5),1),""))'="") {
		SET VORG(5)=$ORDER(^INAUFs(YM,24,$$^WWWUMLAU(VORG(5),1),""))   ;ANZEIGEN KUNDENAUFTRAG;TYBD;31,12,2004
	}
	IF (VORG(5)'="") && $DATA(^INAUF(YM,VORG(5),1)) {
		SET AUF1=$GET(^INAUF(YM,VORG(5),1))      ; SR15572 naked ref
		SET ACC=$$^INAUFBERECHT(AUF1)            ;19.12.03;FAN;24831 
		IF ACC=1 SET VORG(1)="-"_VORG(5)
	}
	
	IF (VORG(2)'="") && (VORG(5)'="") && $DATA(^INKUNDE(YM,VORG(2))) && '$DATA(^INAUF(YM,VORG(5))) {
		;NEUANLAGE KUNDENAUFTRAG MIT SPEZ. AUFTRAGSNUMMER ;customer´s order by means of 
		SET VORG(1)="*"_VORG(2)_"#"_VORG(5)
	}
	
	SET ARTIKEL=""  ;AUS ARTIKELANLAGE ;out of 
	
	;---------------------------------------
	; Manufacturing Order
	;---------------------------------------
	IF VORG(6)=1 DO  QUIT  ;EIGENAUFTRAG
	. DO NEU^INAUFNEU1("EIGEN")
	
	;---------------------------------------
	; Requisition
	;---------------------------------------
	IF VORG(10)=1 DO  QUIT  ;REQUISITION;TYBD;17.11.2003
	. ;DO NEU^INAUFNEU1("REQUISITION") 	;SR15348
	. do GoToForm^COMUtilForm("INRequisition","")
	
	IF $EXTRACT(VORG(1))="-" DO  QUIT   ;AUSWAHL DER AUFTRAGES SPRUNG AUF AUFTRAGSBEARBEITUNG ;Selection the rift upon sales order processing 
	. SET %("VAR","YKEY")=$EXTRACT(VORG(1),2,99)
	. SET %("VAR","YBACK")="INAUFNEU,"
	. SET %("VAR","YFORM")="INAUF"
	. DO ^WWWFORM
	
	;---------------------------------------
	; Supplier Order
	;---------------------------------------
	IF (VORG(7)'="") || (VORG(8)'="") DO      ;LIEFERANTEN
	. IF VORG(7)'="" IF $DATA(^INLIEF(YM,VORG(7))) DO  QUIT
	. . SET VORG(1)="."_VORG(7)               ;LIEFERANTENNUMMER ALS SUCHFUNKTION ;when 
	. . IF VORG(5)'="" IF '$DATA(^INAUF(YM,VORG(5))) SET VORG(1)="*"_VORG(1)_"#"_VORG(5)  ;NEUANLAGE LF-BESTELLUNG MIT SPEZ. AUFTRAGSNUMMER ;by means of 
	. IF VORG(8)'="" SET VORG(1)="."_VORG(8)  ;VOLLTEXTSUCHE NACH LIEFERANTEN ;within 
	
	if VORG(11)=1 { // SR14427
		SET %("VAR","YBACK")="INAUFNEU,"
		set %("VAR","YFORM") = "INTFR"
		do ^WWWFORM
		quit
	}
	
	SET %("VAR","YBACK")="INAUFNEU,"
	SET %("VAR","YAUSWAHL")=VORG(1)
	SET %("VAR","YFORM")="INAUFNEU"
	DO ^WWWFORM
	
	QUIT
	
NEU(KDNR,ANSPR,AUFNR,NOSHOW,AUFTYPE)
	;-------------------------------------------------------------------------------
	; Code to create new orders       ;NEUEN AUFTRAG ANLEGEN; ACHTUNG EINSPRUNG!!!
	;
	; Params:
	; KDNR - Customer Id ???
	; ANSPR - ???
	; AUFNR - Order Id ???
	; NOSHOW - ???
	; AUFTYPE - Order Type ???
	;
	; ByRefs: None ???
	;
	; Returns: Nothing
	;
	; History:
	; 22-Sep-2006	PO		SR14924: Set default sourcing method for customer orders
	;-------------------------------------------------------------------------------
	;NEUER AUFTRAG AUTOMATISCH = S AUFTRAGSNUMMER=$$^WWWNEXT("INAUF") D NEU^INAUFNEU1(KDNUMMER,,AUFTRAGSNUMMER,1) 
	SET NOSHOW  = $GET(NOSHOW)     ;KEIN VERZWEIG IN AUFTRAG ;no within order 
	SET VORG(1) = $GET(KDNR)       ;KUNDENNUMMER
	QUIT:VORG(1)=""
	
	SET ANSPR = $GET(ANSPR)        ;ANSPRECHPRARTNER
	SET AUFNR = $GET(AUFNR)        ;FESTE AUFTRAGSNUMMER
	
	SET YKEY = ""
	IF AUFNR'="" IF '$DATA(^INAUF(YM,AUFNR)) SET YKEY=AUFNR SET ^INAUF(YM,AUFNR,1)=""  ;LOCK AUFTRAGSNUMMER
	IF YKEY="" DO
	. IF $DATA(^INLIEF(YM,VORG(1),1)) IF $DATA(^WWW128(YM,"INAUFL",1)) SET YKEY=$$^WWWNEXT("INAUFL")
	. IF VORG(1)="EIGEN"              IF $DATA(^WWW128(YM,"INAUFE",1)) SET YKEY=$$^WWWNEXT("INAUFE")
	. IF VORG(1)="REQUISITION"        IF $DATA(^WWW128(YM,"INAUFR",1)) SET YKEY=$$^WWWNEXT("INAUFR")  ;REQUISITION;TYBD;17,11,2003
	
	IF YKEY="" SET YKEY=$$^WWWNEXT("INAUF")
	
	
	;PRUEFEN OB NEUER DATENSATZ ;whether data record 
	SET YKEYALT=YKEY-1
	IF $PIECE($GET(^INAUF(YM,YKEYALT,1)),Y,200)=($GET(YTRAKT)-2) IF $PIECE($GET(^INAUF(YM,YKEYALT,1)),Y,4)=+$HOROLOG DO  QUIT
	. SET %("VAR","YKEY")=YKEYALT       ;SCHLÜSSEL AUFTRAGSNUMMER 
	. SET YKEY=YKEYALT
	. QUIT:$GET(NOSHOW)=1               ;KEIN AUFRUF ;no 
	. SET %("VAR","YBACK")="INAUFNEU,"  ;ZURÜCK ;back 
	. SET %("VAR","YFORM")="INAUF"
	. DO ^WWWFORM                       ;ALTER AUFTRAG ;governor order 
	
	SET %("VAR","YKEY")=YKEY            ;SCHLÜSSEL AUFTRAGSNUMMER
	SET %("VAR","YBACK")="INAUFNEU,"    ;ZURÜCK ;back 
	SET YFELD=""                        ;VARIABEL
	IF ANSPR'="" DO 
	. NEW NAME,ANREDE,ANSPR1
	. SET ANSPR1=$GET(^INPARTN(YM,VORG(1),ANSPR,1))
	. SET NAME=$PIECE(ANSPR1,Y,2)
	. ;IF $PIECE(ANSPR1,Y,3)'="" SET NAME=$PIECE(ANSPR1,Y,3)_" "_NAME  ;DEAKTIVIERT, DA ZU LANG !  FIS,14.05.02
	. SET ANREDE=$PIECE(ANSPR1,Y,1)
	. IF +ANREDE'=0 SET NAME=$PIECE($GET(^INPARA(YM,"ANREDE",SPRACHE,ANREDE,1)),Y,1)_" "_NAME
	. SET $PIECE(YFELD,Y,10)=NAME                    ;ANSPRECHPARTNER = AUFTRAGSERTEILUNG DURCH ;trans- 
	. SET $PIECE(YFELD,Y,305)=NAME                   ;BEC;25523;14.04.04;Ansprechpartner im Auftrag
	. SET $PIECE(YFELD,Y,306)=$PIECE(ANSPR1,Y,6)     ;BEC;25523;14.04.04;Tel  
	. SET $PIECE(YFELD,Y,307)=$PIECE(ANSPR1,Y,7)     ;BEC;25523;14.04.04;FAX
	. SET $PIECE(YFELD,Y,308)=$PIECE(ANSPR1,Y,8)     ;BEC;25523;14.04.04;EMAIL  
	. SET $PIECE(YFELD,Y,317)=ANSPR                  ;FIS;27046;16.02.05;ANSPRECHPARTER NUMMER  
	
	SET $PIECE(YFELD,Y,14)=YBED                      ;ZUSTÄNDIGER MITARBEITER
	
	;---------------------------------------
	; Manufacturing Order
	;---------------------------------------
	IF VORG(1)="EIGEN" DO  QUIT                        ;EIGENAUFTRAG OHNE KUNDEN ;without 
	. DO DFLT                                          ;VORGABE;TYBD;21,7,2004;26119
	. SET $PIECE(YFELD,Y,1)  = ""                      ;KUNDE          ;customer 
	. SET $PIECE(YFELD,Y,2)  = 1                       ;EIGENAUFTRAG
	. SET $PIECE(YFELD,Y,4)  = +$HOROLOG               ;AUFTRAGSDATUM
	. SET $PIECE(YFELD,Y,41) = +$HOROLOG               ;ERFASSUNGSDATUM
	. SET $PIECE(YFELD,Y,42) = YBED                    ;MITARBEITER
	. SET $PIECE(YFELD,Y,5)  = $PIECE($HOROLOG,",",2)  ;AUFTRAGSUHRZEIT
	. SET $PIECE(YFELD,Y,6)  = YLOCATION               ;BETRIEB
	. SET $PIECE(YFELD,Y,313)= YLOCATION               ;ERFASSUNGSBETRIEB;06.07.04;FIS;25803
	. SET $PIECE(YFELD,Y,13) = $$^WWWTEXT(32037)       ;TEXT
	. ;IF $PIECE($GET(^INVORG(YM,YM,1)),Y,66)=1 SET $PIECE(YFELD,Y,38)=1  ;AUTOMATISCHE SPERRE BEI NEUANLAGE  -> NUR LF-BESTELLUNGEN
	. SET $PIECE(YFELD,Y,200)=YTRAKT                   ;SAVED BEI TRANSAKTION ;next to 
	. SET YA=$$^WWWSPEI("INAUF",YKEY,YFELD,1)          ;SPEICHERN DATEN UND SORTKEY ;Save And 
	. DO                                       ;25931;TYBD;18,6,2004;BITMAP FÜR INAUF1
	. . NEW YFORM,YVOR
	. . SET YA=$$^WWWSPEI("INAUF1",YKEY,$$^WWWTEXT(32037)_Y_1_Y_Y_+$HOROLOG,1)
	. . ;SET ^INAUF1(YM,YKEY,1)=$$^WWWTEXT(32037)_Y_1_Y_Y_+$HOROLOG  ;OFFENER AUFTRAG "Eigenauftrag"
	. ;
	. QUIT:$GET(NOSHOW)=1                   ;KEIN AUFRUF ;no 
	. SET %("VAR","YFORM")="INAUF"
	. DO ^WWWFORM                           ;NEUER AUFTRAG ;order 
	
	;---------------------------------------
	; Requisition
	;---------------------------------------
	IF VORG(1)="REQUISITION" DO  QUIT  ;REQUISITION
	. DO DFLT  ;VORGABE;TYBD;21,7,2004;26119
	. SET $PIECE(YFELD,Y,1)   = ""                        ;KUNDE   ;customer 
	. SET $PIECE(YFELD,Y,2)   = 5                         ;EIGENAUFTRAG
	.;SET $PIECE(YFELD,Y,265) = 1                         ;REQUISITION  ;FIS;AUSGESCHALTET LT. ANDRE ZUVANOV (DISCLINC BRAZIL);13.01.04
	. SET $PIECE(YFELD,Y,4)   = +$HOROLOG                 ;AUFTRAGSDATUM
	. SET $PIECE(YFELD,Y,41)  = +$HOROLOG                 ;ERFASSUNGSDATUM
	. SET $PIECE(YFELD,Y,42)  = YBED                      ;MITARBEITER
	. SET $PIECE(YFELD,Y,5)   = +$PIECE($HOROLOG,",",2)   ;AUFTRAGSUHRZEIT
	. SET $PIECE(YFELD,Y,6)   = YLOCATION                 ;BETRIEB
	. SET $PIECE(YFELD,Y,313) = YLOCATION                 ;ERFASSUNGSBETRIEB;06.07.04;FIS;25803
	. SET $PIECE(YFELD,Y,13)  = $$^WWWTEXT(33669)         ;"Requisition"
	. IF $PIECE($GET(^INVORG(YM,YM,1)),Y,66)=1 SET $PIECE(YFELD,Y,38)=1  ;AUTOMATISCHE SPERRE BEI NEUANLAGE  -> NUR LF-BESTELLUNGEN ;suspension next to only 
	. SET $PIECE(YFELD,Y,200) = YTRAKT                    ;SAVED BEI TRANSAKTION ;next to 
	. SET YA=$$^WWWSPEI("INAUF",YKEY,YFELD,1)             ;SPEICHERN DATEN UND SORTKEY ;Save And 
	. DO                                                  ;25931;TYBD;18,6,2004;BITMAP FÜR INAUF1
	. . NEW YFORM,YVOR
	. . SET YA=$$^WWWSPEI("INAUF1",YKEY,$$^WWWTEXT(33669)_Y_5_Y_Y_+$HOROLOG,1)
	. . ;SET ^INAUF1(YM,YKEY,1)=$$^WWWTEXT(33669)_Y_5_Y_Y_+$HOROLOG  ;OFFENER AUFTRAG "requsition"
	. ;
	. QUIT:$GET(NOSHOW)=1                   ;KEIN AUFRUF ;no 
	. SET %("VAR","YFORM")="INAUF"
	. DO ^WWWFORM                           ;NEUER AUFTRAG ;order 
	
	;---------------------------------------
	; Layby - Not functional
	;---------------------------------------
	;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	;;;IF VORG(1)="LAYBY" DO  QUIT  ;REQUISITION  ;ERWEITERUNG VON DISCLINC;04.05.04  ??? AKTIVIEREN ???
	. SET $PIECE(YFELD,Y,1)=""   ;KUNDE   ;customer 
	. SET $PIECE(YFELD,Y,2)=6   ;LAYBY AUFTRAG ;order 
	. SET $PIECE(YFELD,Y,4)=+$HOROLOG   ;AUFTRAGSDATUM
	. SET $PIECE(YFELD,Y,41)=+$HOROLOG   ;ERFASSUNGSDATUM
	. SET $PIECE(YFELD,Y,42)=YBED   ;MITARBEITER
	. SET $PIECE(YFELD,Y,5)=+$PIECE($HOROLOG,",",2)   ;AUFTRAGSUHRZEIT
	. SET $PIECE(YFELD,Y,6)=YLOCATION   ;BETRIEB
	. SET $PIECE(YFELD,Y,313)=YLOCATION   ;ERFASSUNGSBETRIEB;06.07.04;FIS;25803
	. SET $PIECE(YFELD,Y,13)=$$^WWWTEXT("IN00003")   ;TEXT "Layby"  ;
	. IF $PIECE($GET(^INVORG(YM,YM,1)),Y,66)=1 SET $PIECE(YFELD,Y,38)=1  ;AUTOMATISCHE SPERRE BEI NEUANLAGE  -> NUR LF-BESTELLUNGEN ;suspension next to only 
	. SET $PIECE(YFELD,Y,200)=YTRAKT  ;SAVED BEI TRANSAKTION ;next to 
	. SET YA=$$^WWWSPEI("INAUF",YKEY,YFELD,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	. DO  ;25931;TYBD;18,6,2004;BITMAP FÜR INAUF1
	. . NEW YFORM,YVOR
	. . SET YA=$$^WWWSPEI("INAUF1",YKEY,$$^WWWTEXT("IN00003")_Y_6_Y_Y_+$HOROLOG,1)
	. . ;SET ^INAUF1(YM,YKEY,1)=$$^WWWTEXT("IN00003")_Y_6_Y_Y_+$HOROLOG  ;OFFENER AUFTRAG "layby"
	. QUIT:$GET(NOSHOW)=1                   ;KEIN AUFRUF ;no 
	. SET %("VAR","YFORM")="INAUF"
	. DO ^WWWFORM                           ;NEUER AUFTRAG ;order 
	;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	
	;---------------------------------------
	; Customer
	;---------------------------------------
	
	SET YSATZ=$GET(^INKUNDE(YM,VORG(1),1))   ;KUNDENNUMMER
	IF YSATZ'="" IF $GET(AUFTYPE)'=2 DO  QUIT  ;AUFTRAG VON KUNDEN;TYBD;IF CUSTOMER = SUPPLIER;31.08.2003
	. NEW DEBIT
	. DO DFLT  ;VORGABE;TYBD;21,7,2004;26119
	. SET $PIECE(YFELD,Y,1)=VORG(1)   ;KUNDE   ;customer 
	. SET $PIECE(YFELD,Y,2)=0   ;kundenauftrag
	. SET $PIECE(YFELD,Y,4)=+$HOROLOG   ;AUFTRAGSDATUM
	. SET $PIECE(YFELD,Y,41)=+$HOROLOG   ;ERFASSUNGSDATUM
	. SET $PIECE(YFELD,Y,42)=YBED   ;MITARBEITER
	. SET $PIECE(YFELD,Y,5)=+$PIECE($HOROLOG,",",2)   ;AUFTRAGSUHRZEIT
	. SET $PIECE(YFELD,Y,6)=YLOCATION   ;BETRIEB
	. SET $PIECE(YFELD,Y,313)=YLOCATION   ;ERFASSUNGSBETRIEB;06.07.04;FIS;25803
	. SET $PIECE(YFELD,Y,13)=$PIECE(YSATZ,Y,8)   ;TEXT
	. SET $PIECE(YFELD,Y,15)=$PIECE(YSATZ,Y,15)   ;BELEG DRUCK AN ;proof printing upon 
	. ;---------------------------------------------------------------RECHNUNGSEMPFANG----FAN 21.09.2001
	. MERGE ^INAUFA(YM,YKEY)=^INKUNDEA(YM,VORG(1))  ;ANSCHRIFTEN
	. IF $PIECE(YSATZ,Y,38)'="" DO
	. . KILL ^INAUFA(YM,YKEY,7)        ;BEC;16.12.04;26820;KEINE SONDERANSCHRIFT DES EIGENEN KUNDEN
	. . KILL ^INAUFA(YM,YKEY,12)  
	. . KILL ^INAUFA(YM,YKEY,17)  
	. . MERGE ^INAUFA(YM,YKEY,7,1) =^INKUNDEA(YM,$PIECE(YSATZ,Y,38),7,1)    ;ANSCHRIFTEN
	. . MERGE ^INAUFA(YM,YKEY,12,1)=^INKUNDEA(YM,$PIECE(YSATZ,Y,38),12,1)   ;ANZAHLUNGS ANSCHRIFTEN
	. . MERGE ^INAUFA(YM,YKEY,17,1)=^INKUNDEA(YM,$PIECE(YSATZ,Y,38),17,1)   ;GUTSCHRIFT ANSCHRIFTEN
	. ;
	. IF ANSPR'="" IF $DATA(^INPARTN(YM,VORG(1),ANSPR,1)) DO
	. . NEW ANSCHRIFT1,SOND1
	. . SET ANSCHRIFT1=$GET(^INPARTN(YM,VORG(1),ANSPR,1))
	. . QUIT:$PIECE(ANSCHRIFT1,Y,32)=1                     ;INAKTIV
	. . QUIT:$PIECE(ANSCHRIFT1,Y,51)=""                    ;STRASSE
	. . QUIT:$PIECE(ANSCHRIFT1,Y,53)=""                    ;ORT
	. . ;
	. . ;SET $PIECE(SOND1,Y,3)=$PIECE(ANSCHRIFT1,Y,1)      ;ANREDE;BEC;15.02.05;AUSGESCHALTET WEGEN LAYOUT
	. . ;SET $PIECE(SOND1,Y,4)=$PIECE(ANSCHRIFT1,Y,3)      ;NAME1 
	. . IF VORG(1)'="" SET $PIECE(SOND1,Y,4)=$PIECE($GET(^INKUNDE(YM,VORG(1),1)),Y,4)   ;NAME1 (KUNDENNAME AUS KD-STAMM)
	. . ;SET $PIECE(SOND1,Y,6)=$PIECE(ANSCHRIFT1,Y,2)      ;NAME2 
	. . SET $PIECE(SOND1,Y,6)=$PIECE(ANSCHRIFT1,Y,3)       ;BEC;16.02.05;(VOR UND NACHNAME AUS ANSP)
	. . IF $PIECE(SOND1,Y,6)'="" SET $PIECE(SOND1,Y,6)=$PIECE(SOND1,Y,6)_" "
	. . SET $PIECE(SOND1,Y,6)=$PIECE(SOND1,Y,6)_$PIECE(ANSCHRIFT1,Y,2) 
	. . ;
	. . SET $PIECE(SOND1,Y,7)=$PIECE(ANSCHRIFT1,Y,4)      ;NAME3
	. . SET $PIECE(SOND1,Y,10)=$PIECE(ANSCHRIFT1,Y,51)    ;STRASSE
	. . SET $PIECE(SOND1,Y,11)=""                         ;POSTFACH
	. . SET $PIECE(SOND1,Y,12)=$PIECE(ANSCHRIFT1,Y,52)    ;PLZ(STRASSE)
	. . SET $PIECE(SOND1,Y,13)=""                         ;PLZ(POSTFACH)
	. . SET $PIECE(SOND1,Y,14)=""                         ;BUNDESLAND
	. . SET $PIECE(SOND1,Y,15)=""                         ;BELEGVERSAND VIA
	. . SET $PIECE(SOND1,Y,16)=$PIECE(ANSCHRIFT1,Y,53)    ;ORT
	. . SET $PIECE(SOND1,Y,17)=""                         ;LAND
	. . SET $PIECE(SOND1,Y,19)=$PIECE(ANSCHRIFT1,Y,31)    ;BRIEFANREDE
	. . SET $PIECE(SOND1,Y,20)=$PIECE(ANSCHRIFT1,Y,6)     ;TEL
	. . SET $PIECE(SOND1,Y,21)=""                         ;TEL. PRIV.
	. . SET $PIECE(SOND1,Y,22)=$PIECE(ANSCHRIFT1,Y,7)     ;FAX
	. . SET $PIECE(SOND1,Y,24)=$PIECE(ANSCHRIFT1,Y,8)     ;EMAIL
	. . SET $PIECE(SOND1,Y,54)=""                         ;STEUERKENNZEICHEN
	. . SET $PIECE(SOND1,Y,69)=""                         ;BELEGSPRACHE
	. . DO
	. . . NEW YFORM,YVOR,YOK
	. . . SET YOK=$$^WWWSPEI("INAUFA",YKEY_",6",SOND1,1)   ;LIEFERADRESSE
	. ;
	. ;---------------------------------------------------------------
	. SET $PIECE(YFELD,Y,51)=$PIECE(YSATZ,Y,51)   ;WÄHRUNG KUNDE ;money standard customer 
	. ;IF $PIECE(YFELD,Y,51)'="" IF $PIECE(YFELD,Y,51)'=YWHR SET $PIECE(YFELD,Y,314)=$PIECE($GET(^WWWWAE(0,$PIECE(YFELD,Y,51),1)),Y,5)   ;EXCHANGE RATE;FIS;26316;24.08.04
	. SET $PIECE(YFELD,Y,70)=$PIECE(YSATZ,Y,70)   ;NACHLASS %
	. ;SET $PIECE(YFELD,Y,71)=$PIECE(YSATZ,Y,71)   ;NACHLASS GESAMT  ;KUNDENRABATT WIRD IN INAUF JE POSITION GESETZT;FIS;10.03.04
	. SET $PIECE(YFELD,Y,56)=$PIECE(YSATZ,Y,56)   ;kondition
	. SET $PIECE(YFELD,Y,57)=$PIECE(YSATZ,Y,57)   ;SONDER-kondition  ;TYBD;7,2,2005
	. SET $PIECE(YFELD,Y,74)=$PIECE(YSATZ,Y,74)   ;SKONTO
	. SET $PIECE(YFELD,Y,75)=$PIECE(YSATZ,Y,75)   ;SKONTO TAGE
	. SET $PIECE(YFELD,Y,76)=$PIECE(YSATZ,Y,76)   ;NETTO TAGE
	. SET $PIECE(YFELD,Y,312)=$PIECE(YSATZ,Y,234)     ;BEC;25693;21.06.04;lIEFERSCHEIN MIT RECHNUNG
	. SET $PIECE(YFELD,Y,200)=YTRAKT  ;SAVED BEI TRANSAKTION  ;next to 
	. set $$$INAUFSourcingMethod(YFELD) = $$^INAUFD342() // SR14924
	. ;
	. IF $PIECE($GET(^INVORG(YM,YM,1)),Y,4)=1 DO   ;NUR WENN KREDITLIMIT ;only when 
	. . IF $PIECE(YSATZ,Y,36)="" DO  QUIT  ;OHNEN KREDITGRUPPE
	. . . IF +$PIECE(YSATZ,Y,33)=0 SET $PIECE(YFELD,Y,38)=+$PIECE($GET(^INVORG(YM,YM,1)),Y,89) QUIT  ;KEIN KREDIT/ODER UNBESCHRÄNKT ;no absolute 
	. . . QUIT:$GET(VORG(1))=""
	. . . SET DEBIT=$PIECE($GET(^INKUNDE(YM,$GET(VORG(1)),1)),Y,48)
	. . . IF DEBIT'="" IF $FIND($$^INSALDO(DEBIT),"S")!($FIND($$^INSALDO(DEBIT),"D")) IF $PIECE(YSATZ,Y,33)<($$^INSALDO(DEBIT)+$$^INKUNDAUF(VORG(1),3)) SET $PIECE(YFELD,Y,38)=1   ;SPERRE WEGEN LIMIT ;suspension quibble 
	. . ;
	. . IF $PIECE(YSATZ,Y,36)'="" DO  ;MIT KREDITGRUPPE ;by means of 
	. . . NEW KRED,KUN,SUM
	. . . SET SUM=0
	. . . SET $PIECE(YSATZ,Y,33)=$PIECE($GET(^INKUNDE(YM,$PIECE(YSATZ,Y,36),1)),Y,33)  ;KREDITLIMIT HAUPTKUNDE
	. . . IF +$PIECE(YSATZ,Y,33)=0 SET $PIECE(YFELD,Y,38)=+$PIECE($GET(^INVORG(YM,YM,1)),Y,89) QUIT  ;KEIN KREDIT/ODER UNBESCHRÄNKT ;no absolute 
	. . . SET DEBIT=$PIECE($GET(^INKUNDE(YM,$PIECE(YSATZ,Y,36),1)),Y,48)
	. . . IF DEBIT'="" IF $FIND($$^INSALDO(DEBIT),"S") || $FIND($$^INSALDO(DEBIT),"D") SET SUM=SUM+$PIECE($$^INSALDO(DEBIT)," ",1)
	. . . IF DEBIT'="" IF $FIND($$^INSALDO(DEBIT),"H") || $FIND($$^INSALDO(DEBIT),"K") SET SUM=SUM-$PIECE($$^INSALDO(DEBIT)," ",1)
	. . . SET KRED=""
	. . . FOR  SET KRED=$ORDER(^INKUNDEs(YM,8,$$^WWWUMLAU($PIECE(YSATZ,Y,36),1),KRED)) QUIT:KRED=""  DO
	. . . . SET KUN=""
	. . . . FOR  SET KUN=$ORDER(^INKUNDEs(YM,8,$$^WWWUMLAU($PIECE(YSATZ,Y,36),1),KRED,KUN)) QUIT:KUN=""  DO
	. . . . . SET DEBIT=$PIECE($GET(^INKUNDE(YM,KUN,1)),Y,48)
	. . . . . QUIT:DEBIT=""
	. . . . . IF $FIND($$^INSALDO(DEBIT),"S") || $FIND($$^INSALDO(DEBIT),"D") SET SUM=SUM+$PIECE($$^INSALDO(DEBIT)," ",1)
	. . . . . IF $FIND($$^INSALDO(DEBIT),"H") || $FIND($$^INSALDO(DEBIT),"K") SET SUM=SUM-$PIECE($$^INSALDO(DEBIT)," ",1)
	. . . ;
	. . . IF $PIECE(YSATZ,Y,33)<(SUM+$$^INKUNDAUF(VORG(1),3)) SET $PIECE(YFELD,Y,38)=1   ;SPERRE WEGEN LIMIT;TYBD;14.04.2003 ;suspension quibble 
	. ;
	. IF $PIECE(YSATZ,Y,32)=1 SET $PIECE(YFELD,Y,38)=1  ;KUNDE GESPERRT ;customer DISABLED 
	. IF $PIECE(YSATZ,Y,246)'="" SET $PIECE(YFELD,Y,38)=1,$PIECE(YFELD,Y,238)=$PIECE(YSATZ,Y,246)  ;KUNDENAUFTRÄGE SPERREN; BLOCK CUSTOMER ORDERS;FIS;03.01.05;26981 
	. ;IF $PIECE($GET(^INVORG(YM,YM,1)),Y,66)=1 SET $PIECE(YFELD,Y,38)=1  ;AUTOMATISCHE SPERRE BEI NEUANLAGE -> NUR LF-BESTELLUNGEN
	. ;
	. ;IF $PIECE($GET(^INVORG(YM,YM,1)),Y,113)=1 DO  ;ERST BEI ANLAGE DER 1. POSITION ;FIS, 06.12.02
	. ;. NEW YKEYX
	. ;. SET YKEYX=YKEY
	. ;. NEW YFORM,YKEY,YFELD
	. ;. DO CALL(VORG(1),YKEYX)  ;SERVICE AUTOMATISCH ANLEGEN
	. ;
	. SET YA=$$^WWWSPEI("INAUF",YKEY,YFELD,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	. DO                                       ;25931;TYBD;18,6,2004;BITMAP FÜR INAUF1
	. . NEW YFORM,YVOR
	. . SET YA=$$^WWWSPEI("INAUF1",YKEY,$PIECE(YSATZ,Y,8)_Y_0_Y_Y_+$HOROLOG,1)
	. . ;SET ^INAUF1(YM,YKEY,1)=$PIECE(YSATZ,Y,8)_Y_0_Y_Y_+$HOROLOG  ;OFFENER AUFTRAG
	. ;
	. QUIT:$GET(NOSHOW)=1  ;KEIN AUFRUF ;no 
	. SET %("VAR","YFORM")="INAUF"
	. SET %("VAR","YKEY")=YKEY
	. DO  ;KONTAKT SPEICHERN ;contact Save 
	. . NEW LFN
	. . SET LFN=$$^WWWNEXT1("INKUNDED",VORG(1),2)
	. . IF LFN'="" DO
	. . . NEW KONTAKT
	. . . SET KONTAKT=$PIECE($GET(^INVORG(YM,YM,1)),Y,75)
	. . . ;IF KONTAKT'="" SET ^INKUNDED(YM,VORG(1),LFN,1)=Y_YBED_Y_KONTAKT_Y_$PIECE(YFELD,Y,10)_Y_$$^WWWTEXT(32047)_" "_YKEY_Y_Y_Y_Y_Y_+$H_Y_$PIECE($H,",",2)_Y_Y_Y_Y_Y_Y_Y_Y
	. . . IF KONTAKT'="" DO   ;WEM;25658;11.05.2004;SPEICHERN ÜBER WWWSPEI
	. . . . NEW YVOR,YFORM,YOK,DS
	. . . . SET DS=""
	. . . . SET $PIECE(DS,Y,2)=YBED
	. . . . SET $PIECE(DS,Y,3)=KONTAKT
	. . . . SET $PIECE(DS,Y,4)=$PIECE(YFELD,Y,10)
	. . . . SET $PIECE(DS,Y,5)=$$^WWWTEXT(32047)_" "_YKEY
	. . . . SET $PIECE(DS,Y,10)=+$HOROLOG
	. . . . SET $PIECE(DS,Y,11)=$PIECE($HOROLOG,",",2)
	. . . . ;SET YOK=$$^WWWSPEI("INKUNDED",VORG(1)_","_LFN,DS,1)   ;WEM;11.05.2004;AUSKOMMENTIERT, DA ES NICHT FUNKTIONIERT HAT
	. . . . SET ^INKUNDED(YM,VORG(1),LFN,1)=DS
	. . . . DO ^WWWSSORT("INKUNDED",VORG(1)_","_LFN)
	. ;
	. DO ^WWWFORM ;NEUER AUFTRAG ;order 
	
	SET YSATZ=$GET(^INLIEF(YM,VORG(1),1))    ;LIEFERANTENUMMER
	IF YSATZ'="" DO  QUIT                    ;AUFTRAG AN LIEFERANT ;order upon supplier 
	. DO DFLT                                ;VORGABE;TYBD;21,7,2004;26119
	. SET $PIECE(YFELD,Y,12)=VORG(1)         ;LIEFERANT   ;supplier 
	. SET $PIECE(YFELD,Y,2)=2                ;LIEFERANTENAUFTRAG
	. SET $PIECE(YFELD,Y,4)=+$HOROLOG        ;AUFTRAGSDATUM
	. SET $PIECE(YFELD,Y,41)=+$HOROLOG       ;ERFASSUNGSDATUM
	. SET $PIECE(YFELD,Y,42)=YBED            ;MITARBEITER
	. SET $PIECE(YFELD,Y,5)=+$PIECE($HOROLOG,",",2)   ;AUFTRAGSUHRZEIT
	. SET $PIECE(YFELD,Y,6)=YLOCATION             ;BETRIEB
	. SET $PIECE(YFELD,Y,313)=YLOCATION           ;ERFASSUNGSBETRIEB;06.07.04;FIS;25803
	. SET $PIECE(YFELD,Y,13)=$PIECE(YSATZ,Y,8)    ;TEXT
	. SET $PIECE(YFELD,Y,15)=$PIECE(YSATZ,Y,15)   ;BELEG DRUCK AN ;proof printing upon 
	. SET $PIECE(YFELD,Y,51)=$PIECE(YSATZ,Y,51)   ;FOREIGN CURRANCY;FIS;26316;24.08.04
	. ;IF $PIECE(YFELD,Y,51)'="" IF $PIECE(YFELD,Y,51)'=YWHR SET $PIECE(YFELD,Y,314)=$PIECE($GET(^WWWWAE(0,$PIECE(YFELD,Y,51),1)),Y,5)   ;EXCHANGE RATE;FIS;26316;24.08.04
	. ;
	. IF $PIECE(YSATZ,Y,32)=1 SET $PIECE(YFELD,Y,38)=1  ;LIEFERANT GESPERRT  ;supplier DISABLED 
	. IF $PIECE($GET(^INVORG(YM,YM,1)),Y,66)=1 SET $PIECE(YFELD,Y,38)=1  ;AUTOMATISCHE SPERRE BEI NEUANLAGE ;suspension next to 
	. SET $PIECE(YFELD,Y,200)=YTRAKT  ;SAVED BEI TRANSAKTION ;next to 
	. ;
	. IF $GET(VORG(1))'="" FOR YA=3,10 IF $DATA(^INLIEFA(YM,VORG(1),YA,1)) SET ^INAUFA(YM,YKEY,YA,1)=^INLIEFA(YM,VORG(1),YA,1)  ;ANSCHRIFTEN nicht vorhanden ;not on hand 
	. ;
	. SET YA=$$^WWWSPEI("INAUF",YKEY,YFELD,1)  ;SPEICHERN DATEN UND SORTKEY ;Save And 
	. DO  ;25931;TYBD;18,6,2004;BITMAP FÜR INAUF1
	. . NEW YFORM,YVOR
	. . SET YA=$$^WWWSPEI("INAUF1",YKEY,$PIECE(YSATZ,Y,8)_Y_2_Y_Y_+$HOROLOG,1)
	. . ;SET ^INAUF1(YM,YKEY,1)=$PIECE(YSATZ,Y,8)_Y_2_Y_Y_+$HOROLOG  ;OFFENER AUFTRAG
	. ;
	. QUIT:$GET(NOSHOW)=1  ;KEIN AUFRUF ;no 
	. SET %("VAR","YFORM")="INAUF"
	. SET %("VAR","YKEY")=YKEY
	. DO ^WWWFORM ;NEUER AUFTRAG ;order 
		
	QUIT
	
CALL(YKEY1,YKEY2,YINFO) ;ERSTELLEN SERVICEAUFTRAG (KUNDE, AUFTRAG, POS)     
	NEW CALL,CALL1,KUND,YFORM,YVOR,YVORG,YFELD,YOK,YKEY,YKEY3,YLINK
	
	IF $PIECE($GET(YKEY2),",",2)'="" SET YKEY3=$PIECE(YKEY2,",",2) SET YKEY2=$PIECE(YKEY2,",",1)
	
	IF $GET(YKEY1)="" IF $GET(YKEY2)'=""  SET YKEY1=$PIECE($GET(^INAUF(YM,YKEY2,1)),Y,1)  ;KUNDENNUMMER 
	IF $GET(YKEY1)="" SET YFORM="INAUFP," SET YBACK="INAUFP," DO ^WWWBACK DO ^WWWINFO($$^WWWTEXT(33320)) QUIT  ;BEC 06.03.03  ;NUR FÜR KUNDENAUFTRAG MÖGLICH ;only to customer´s order potential 
	QUIT:$GET(YKEY1)=""
	
	SET CALL1=""
	IF $PIECE(CALL1,Y,1)="" SET $PIECE(CALL1,Y,1)=$PIECE($HOROLOG,",",1)  ;DATUM ;Date
	IF $PIECE(CALL1,Y,2)="" SET $PIECE(CALL1,Y,2)=$PIECE($HOROLOG,",",2)  ;UHRZEIT
	
	SET KUND=$GET(^INKUNDE(YM,YKEY1,1))
	IF $PIECE(CALL1,Y,5)=""  SET $PIECE(CALL1,Y,5)  = YKEY1               ;KURZBEZ
	IF $PIECE(CALL1,Y,6)=""  SET $PIECE(CALL1,Y,6)  = $PIECE(KUND,Y,8)    ;KURZBEZ
	IF $PIECE(CALL1,Y,6)=""  SET $PIECE(CALL1,Y,6)  = $PIECE(KUND,Y,4)    ;NAME1
	IF $PIECE(CALL1,Y,7)=""  SET $PIECE(CALL1,Y,7)  = $PIECE(KUND,Y,6)    ;NAME2
	IF $PIECE(CALL1,Y,8)=""  SET $PIECE(CALL1,Y,8)  = $PIECE(KUND,Y,20)   ;TEL
	IF $PIECE(CALL1,Y,9)=""  SET $PIECE(CALL1,Y,9)  = $PIECE(KUND,Y,22)   ;FAX
	IF $PIECE(CALL1,Y,10)="" SET $PIECE(CALL1,Y,10) = $PIECE(KUND,Y,24)   ;EMAIL
	IF $PIECE(CALL1,Y,3)=""  SET $PIECE(CALL1,Y,3)  = YBED
	IF $PIECE(CALL1,Y,16)="" SET $PIECE(CALL1,Y,16) = YBED
	SET $PIECE(CALL1,Y,27) = YKEY2
	SET $PIECE(CALL1,Y,81) = YKEY2
	SET $PIECE(CALL1,Y,20) = YKEY2
	SET $PIECE(CALL1,Y,18) = 2                   ;PRIORITÄT NEU/EILIG ;priority 
	SET $PIECE(CALL1,Y,39) = 2                   ;PRIORITÄT DES KUNDEN =WICHTIG ;priority 
	SET $PIECE(CALL1,Y,15) = 2                   ;SERVICEKENNZEICHEN ANREGUNG ;excitement 
	SET $PIECE(CALL1,Y,19) = 2                   ;BITTE UM ERLEDIGUNG ;please to transaction 
	IF $GET(YKEY3)'="" SET $PIECE(CALL1,Y,11)=6  ;MELDUNG VIA AUFTRAGSPOSITION ;status signal via 
	
	IF $GET(YKEY2)'="" DO
	. NEW PERSON,NR,PERSON1
	. SET PERSON=$PIECE($GET(^INAUF(YM,YKEY2,1)),Y,10)
	. QUIT:PERSON=""
	. SET $PIECE(CALL1,Y,12)=PERSON  ;ANSPRECHPARTNER=BESTELLT VON
	. SET PERSON=$REVERSE($PIECE($REVERSE(PERSON)," ",1))
	. IF YKEY1'="" IF $DATA(^INPARTNs(YM,1,$$^WWWUMLAU(PERSON,1),YKEY1)) DO
	. . SET NR=$ORDER(^INPARTNs(YM,1,$$^WWWUMLAU(PERSON,1),YKEY1,""))
	. . IF $ORDER(^INPARTNs(YM,1,$$^WWWUMLAU(PERSON,1),YKEY1,NR))'="" QUIT  ;NUR WENN EINDEUTIG ;only when 
	. . SET PERSON1=$GET(^INPARTN(YM,YKEY1,NR,1))
	. . IF $PIECE(PERSON1,Y,6)'="" SET $PIECE(CALL1,Y,8)  = $PIECE(PERSON1,Y,6)   ;TEL
	. . IF $PIECE(PERSON1,Y,7)'="" SET $PIECE(CALL1,Y,9)  = $PIECE(PERSON1,Y,7)   ;FAX
	. . IF $PIECE(PERSON1,Y,8)'="" SET $PIECE(CALL1,Y,10) = $PIECE(PERSON1,Y,8)   ;EMAIL
	
	IF $GET(YKEY3)'="" DO  ;WENN MIT POSITION ;when by means of 
	. SET $PIECE(CALL1,Y,27)=YKEY2
	. SET $PIECE(CALL1,Y,29)=YKEY3
	. SET $PIECE(CALL1,Y,81)=$PIECE($GET(^INAUF(YM,YKEY2,1)),Y,8)            ;PROJECT
	. SET $PIECE(CALL1,Y,20)=$PIECE($GET(^INAUFP(YM,YKEY2,YKEY3,1)),Y,1)     ;=BETREFF
	. SET $PIECE(CALL1,Y,17)=$PIECE($GET(^INAUFP(YM,YKEY2,YKEY3,1)),Y,10)    ;TEXT
	. IF $PIECE($GET(^INAUFP(YM,YKEY2,YKEY3,1)),Y,26)=2 DO                   ;NUR FÜR LEISTUNGEN  ;only to LEISTUNGEN 
	. . SET $PIECE(CALL1,Y,65)=$PIECE($GET(^INAUFP(YM,YKEY2,YKEY3,1)),Y,5)   ;AUFWAND ;luxury 
	. . SET $PIECE(CALL1,Y,66)=$PIECE($GET(^INAUFP(YM,YKEY2,YKEY3,1)),Y,40)  ;MENGENEINHEIT
	
	IF $PIECE(CALL1,Y,14)'="" IF $PIECE(CALL1,Y,5)'="" DO
	. NEW LFN,Q
	. SET Q=0
	. SET LFN=""
	. FOR  SET LFN=$ORDER(^INKUNDEAP(YM,$PIECE(CALL1,Y,5),LFN)) QUIT:LFN=""  DO
	. . SET:$FIND($$^WWWUMLAU($GET(^INKUNDEAP(YM,$PIECE(CALL1,Y,5),LFN,1)),1),$$^WWWUMLAU($PIECE(CALL1,Y,14),1)) Q=1
	. ;
	. QUIT:Q=1
	. ;SET LFN=$ORDER(^INKUNDEAP(YM,$PIECE(CALL1,Y,5),""),-1)+1
	. ;SET ^INKUNDEAP(YM,$PIECE(CALL1,Y,5),LFN,1)=$PIECE(CALL1,Y,14)
	
	IF $PIECE(CALL1,Y,22)=1 DO   ;WENN ERLEDIGT ABER KEIN EINTRAG VON DATUM UND UHRZEIT ;when yet no Date And 
	. IF $PIECE(CALL1,Y,23)="" SET $PIECE(CALL1,Y,23)=$PIECE($HOROLOG,",",1) ;DATUM ;Date
	. IF $PIECE(CALL1,Y,24)="" SET $PIECE(CALL1,Y,24)=$PIECE($HOROLOG,",",2) ;UHRZEIT
	
	SET CALL=$$^WWWNEXT("INCALL")
	SET YOK=$$^WWWSPEI("INCALL",CALL,CALL1,1)
	
	;SPEIHERN INFO IN AUFTRAGSPOSITION ;within 
	IF $GET(YKEY2)'="" IF $GET(YKEY3)'="" DO
	. NEW YFELD,YFORM,YVOR,YOK
	. SET YFELD=$GET(^INAUFP(YM,YKEY2,YKEY3,1))
	. SET $PIECE(YFELD,Y,302)=CALL
	. SET $PIECE(YFELD,Y,303)=+$HOROLOG
	. SET $PIECE(YFELD,Y,304)=$PIECE($HOROLOG,",",2)
	. SET $PIECE(YFELD,Y,305)=YBED
	. SET YOK=$$^WWWSPEI("INAUFP",YKEY2_","_YKEY3,YFELD,1)
	
	IF $GET(YKEY3)'="" IF +$GET(YINFO)=0 DO  ;LINK FÜR OK  ;AUS BUTTON ;to out of 
	. SET YLINK=""
	. DO  ;LINK
	. . NEW YKEY,YI
	. . SET YI=YAKTION_"EP=WWWFORM&YFORM=INCALL&YKEY="_CALL
	. . DO VAR^WWWCGI
	. . SET YLINK=YI
	. ;
	. DO ^WWWINFO($$^WWWTEXT(33234)_" ("_CALL_")",0,YLINK)  ;SERVICE AUFTRAG ANGELEGT ;order 
	
	IF $GET(YKEY3)'="" IF +$GET(YINFO)=1 DO  ;LINK FÜR OK  ;AUS AUTOMATIK ;to out of 
	. DO
	. . NEW YFORM,YKEY,YBACK
	. . WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INCALL&YKEY="_CALL_"&YFKEY="_YKEY2_","_YKEY3_"&YBACK=INAUF,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE ">"
	. ;
	. WRITE "<font size=2 color="_YRED_"><b>"_$$^WWWTEXT(33234)_" ("_CALL_")</b></font>"  ;SERVICE AUFTRAG ANGELEGT ;order 
	. WRITE "</A>"
	. WRITE "<BR>"
	. WRITE YCR
			
	QUIT
	
DFLT ; VORGABEN AUS CUSTOMIZING  ;TYBD;21,7,2004;26119;
	NEW YBBN,YFORM,YLFN,YSATZ,YSATZ1
	
	SET YFORM="INAUF"
	SET YBBN=""
	FOR  SET YBBN=$ORDER(^WWW122D(0,YFORM,YBBN)) QUIT:YBBN=""  DO
	. SET YSATZ=$GET(^WWW122(0,YFORM,YBBN,1))  ;FELDDEFINITION
	. SET YLFN=$PIECE(YSATZ,Y,1)  ;DATENBANKFELD
	. QUIT:YLFN=""
	. IF $DATA(^WWW122D(0,YFORM,YBBN,YM,1)) DO
	. . NEW YSATZ1
	. . SET YSATZ1=$GET(^WWW122D(0,YFORM,YBBN,YM,1))
	. . IF $PIECE(YSATZ1,Y,1)'="" SET $PIECE(YFELD,Y,YLFN)=$PIECE(YSATZ1,Y,1)  ;SONDERVORGABE ;FIS;16.04.04;25550;SPEICHERN VORBELEGUNG FÜR PRÜFEN SAVE OHNE DATENFELDER
	
	QUIT
]]></Routine>
</Export>