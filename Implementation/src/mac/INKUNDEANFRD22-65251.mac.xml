<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INKUNDEANFRD22" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INKUNDEANFRD22(KEY)  ;INKUNDEANFRD22;ULM;ANFRAGESTATUS;03.09.2002
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		ANFRAGESTATUS
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| ULM	03.09.2002
	;|
	;\------------------------------------------------------------------/
	;
	NEW ANG,ANFRAGE,ANFR1,STATUS,DATUM,SATZ,NR,YI
	SET ANFRAGE=$GET(KEY)  ;ANFRAGENUMMER
	QUIT:ANFRAGE=""
	SET ANFR1=$GET(^INKUNDEANFR(YM,ANFRAGE,1))
	QUIT:ANFR1=""
	IF $PIECE(ANFR1,Y,22)=2 SET YINHALT=2 QUIT  ;ABLEHNUNG (MANUELL GESETZT) ;rejection 
	IF $TRANSLATE($PIECE(ANFR1,Y,25)," |;")'="" SET YINHALT=2 QUIT  ;ABLEHNUNG (DURCH ABLEHNUNGSTEXT GESETZT)
	IF $TRANSLATE($PIECE(ANFR1,Y,26)," ;")'="" SET YINHALT=2 QUIT  ;ABLEHNUNG (DURCH ABLEHNUNGSGRUND GESETZT)
	IF $PIECE(ANFR1,Y,22)=5 SET YINHALT=5 QUIT  ;KEINE ANTWORT (MANUELL GESETZT) ;no 
	IF '$DATA(^INANGs(YM,16,$$^WWWUMLAU(ANFRAGE,1))) SET YINHALT=0 QUIT  ;OFFEN ;vulnerable 
	SET STATUS=4  ;ERLEDIGT
	;SUCHEN OFFENE ANGEBOTE ;seek 
	SET ANG="" FOR  SET ANG=$ORDER(^INANGs(YM,16,$$^WWWUMLAU(ANFRAGE,1),ANG)) QUIT:ANG=""  DO  QUIT:STATUS=1
	. SET SATZ=$GET(^INANG(YM,ANG,1))
	. QUIT:SATZ=""
	. IF $PIECE(SATZ,Y,60)=1 QUIT  ;ERLEDIGT
	. IF $TRANSLATE($PIECE(SATZ,Y,203),";")'="" QUIT  ;ABGELEHT = ERLEDIGT
	. IF $PIECE(SATZ,Y,78)'="" SET STATUS=3 QUIT  ;AUFTRAG ;mandate  ;order 
	. SET STATUS=1  ;ANGEBOT ;proposition 
	. QUIT
	SET YINHALT=STATUS
	QUIT
]]></Routine>
</Export>