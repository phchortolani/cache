<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWROUTINE" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWROUTINE ;WWWROUTINE;FAN;ROUTINE ÄNDERUNGSPROTOKOLL;13.03.2001
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		ROUTINE ÄNDERUNGSPROTOKOLL
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FAN	13.03.2001
	;|
	;\------------------------------------------------------------------/
	;
	NEW NAME,DATUM,BEZ,SORT,SORTNACH
	SET VORG(1)=$GET(VORG(1))  ;VORGABE VON ;default 
	IF VORG(1)="" SET VORG(1)=$HOROLOG-7  ;EINE WOCHE VORHER ;one week pre- 
	SET VORG(2)=$GET(VORG(2))  ;VORGABE BIS ;default until 
	IF VORG(2)="" SET VORG(2)=$HOROLOG  ;HEUTE ;today 
	SET VORG(4)=$G(VORG(4))
	IF VORG(4)="" SET VORG(4)=1
	IF VORG(4)=1 SET SORT=-1  SET SORTNACH="DATUM"
	IF VORG(4)=2 SET SORT=1  SET SORTNACH="DATUM"
	IF VORG(4)=3 SET SORT=-1  SET SORTNACH="NAME"
	IF VORG(4)=4 SET SORT=1  SET SORTNACH="NAME"
	SET VORG(3)=$TRANSLATE($GET(VORG(3)),"*")
	KILL ^WWWSOR(YUSER)  ;LÖSCHEN ZWISCHENDATEI ;Delete 
	IF SORTNACH="DATUM" DO SORTDATUM
	IF SORTNACH="NAME" DO SORTNAME
	DO DRUCK   ;WERTE DRUCKEN ;print 
	DO STOP^WWWTAB  ;ENDE TABELLE ;termination tabulation 
	QUIT
	
SORTDATUM   ;VORSORTIERUNG
	;---------------VORSORTIERUNG
	IF VORG(3)="" SET NAME="A" FOR  SET NAME=$ORDER(^ROUTINE(NAME))  QUIT:NAME=""  QUIT:'$FIND(NAME,VORG(3))   DO  
	. SET DATUM=$GET(^ROUTINE(NAME,0)) 
	. QUIT:DATUM<VORG(1)
	. QUIT:DATUM>VORG(2)
	. SET BEZ=$PIECE($GET(^ROUTINE(NAME,0,1)),";",4)
	. IF BEZ="" SET BEZ=$PIECE($GET(^ROUTINE(NAME,0,1)),",",3)
	. SET ^WWWSOR(YUSER,DATUM,NAME)=BEZ
	. QUIT
	IF VORG(3)'="" SET NAME=$ORDER(^ROUTINE(VORG(3)),-1)  FOR  SET NAME=$ORDER(^ROUTINE(NAME))  QUIT:NAME=""  QUIT:'$FIND(NAME,VORG(3))   DO  
	. SET DATUM=$GET(^ROUTINE(NAME,0)) 
	. QUIT:DATUM<VORG(1)
	. QUIT:DATUM>VORG(2)
	. SET BEZ=$PIECE($GET(^ROUTINE(NAME,0,1)),";",4)
	. IF BEZ="" SET BEZ=$PIECE($GET(^ROUTINE(NAME,0,1)),",",3)
	. SET ^WWWSOR(YUSER,DATUM,NAME)=BEZ
	. QUIT
	;ÜBERSCHRIFT BEARBEITEN ;superscription 
	SET UES(1)=$$^WWWTEXT(32298)_Y_$$^WWWTEXT(127)_Y_$$^WWWTEXT(32299)
	QUIT
	
SORTNAME   ;VORSORTIERUNG
	;---------------VORSORTIERUNG
	IF VORG(3)="" SET NAME="A" FOR  SET NAME=$ORDER(^ROUTINE(NAME))  QUIT:NAME=""  QUIT:'$FIND(NAME,VORG(3))   DO  
	. SET DATUM=$GET(^ROUTINE(NAME,0)) 
	. QUIT:DATUM<VORG(1)
	. QUIT:DATUM>VORG(2)
	. SET BEZ=$PIECE($GET(^ROUTINE(NAME,0,1)),";",4)
	. IF BEZ="" SET BEZ=$PIECE($GET(^ROUTINE(NAME,0,1)),",",3)
	. SET ^WWWSOR(YUSER,NAME)=DATUM_Y_BEZ 
	. QUIT
	IF VORG(3)'="" SET NAME=$ORDER(^ROUTINE(VORG(3)),-1) FOR  SET NAME=$ORDER(^ROUTINE(NAME))  QUIT:NAME=""  QUIT:'$FIND(NAME,VORG(3))   DO  
	. SET DATUM=$GET(^ROUTINE(NAME,0)) 
	. QUIT:DATUM<VORG(1)
	. QUIT:DATUM>VORG(2)
	. SET BEZ=$PIECE($GET(^ROUTINE(NAME,0,1)),";",4)
	. IF BEZ="" SET BEZ=$PIECE($GET(^ROUTINE(NAME,0,1)),",",3)
	. SET ^WWWSOR(YUSER,NAME)=DATUM_Y_BEZ
	. QUIT
	;ÜBERSCHRIFT BEARBEITEN ;superscription 
	SET UES(1)=$$^WWWTEXT(32298)_Y_$$^WWWTEXT(127)_Y_$$^WWWTEXT(32299)
	QUIT
	
DRUCK   ;AUSWERTUNG DRUCKEN ;print 
	DO ^WWWBACK
	DO ^WWWLISTKOPF  ;DRUCKEN DECKBLATT ;print 
	SET YDDSATZ=0
	;DRUCKEN TABELLE ;print tabulation 
	DO UPUEB  ;DRUCKEN ÜBERSCHRIFT ;print superscription 
	IF SORTNACH="DATUM" DO
	. SET DATUM="" FOR  SET DATUM=$ORDER(^WWWSOR(YUSER,DATUM),SORT) QUIT:DATUM=""  DO
	. . SET NAME="" FOR  SET NAME=$ORDER(^WWWSOR(YUSER,DATUM,NAME),1) QUIT:NAME=""  DO
	. . . SET BEZ=$GET(^WWWSOR(YUSER,DATUM,NAME))
	. . . WRITE !
	. . . WRITE YCR
	. . . DO NL^WWWTAB
	. . . DO NF^WWWTAB
	. . . WRITE NAME
	. . . WRITE YCR
	. . . WRITE "&nbsp;"
	. . . DO ZWL^WWWTAB
	. . . WRITE BEZ
	. . . WRITE YCR
	. . . WRITE "&nbsp;"
	. . . DO ZWL^WWWTAB
	. . . WRITE $$^WWWDATE(DATUM)_"&nbsp;&nbsp;&nbsp;"_$$^WWWTIME(DATUM)
	. . . WRITE YCR
	. . . WRITE "&nbsp;"
	. . . DO EF^WWWTAB
	. . . DO EL^WWWTAB
	. . . QUIT
	. . QUIT
	. QUIT
	IF SORTNACH="NAME" DO  
	. SET NAME="" FOR  SET NAME=$ORDER(^WWWSOR(YUSER,NAME),SORT) QUIT:NAME=""  DO
	. . SET BEZ=$GET(^WWWSOR(YUSER,NAME)) 
	. . WRITE !
	. . WRITE YCR
	. . DO NL^WWWTAB
	. . DO NF^WWWTAB
	. . WRITE NAME
	. . WRITE YCR
	. . WRITE "&nbsp;"
	. . DO ZWL^WWWTAB
	. . WRITE $PIECE(BEZ,Y,2)
	. . WRITE YCR
	. . WRITE "&nbsp;"
	. . DO ZWL^WWWTAB
	. . WRITE $$^WWWDATE($PIECE(BEZ,Y,1))_"&nbsp;&nbsp;&nbsp;"_$$^WWWTIME($PIECE(BEZ,Y,1))
	. . WRITE YCR
	. . WRITE "&nbsp;"
	. . DO EF^WWWTAB
	. . DO EL^WWWTAB
	. . QUIT
	. QUIT
	QUIT
	
UPUEB ;ÜBERSCHRIFT ;superscription 
	WRITE "<CENTER>"
	DO START00^WWWTAB
	DO NL^WWWTAB
	DO NHWO^WWWTAB
	WRITE "<FONT SIZE=3>"
	WRITE "<B>"
	WRITE "<NOBR>"
	WRITE YKOPF
	WRITE "</NOBR>"
	WRITE "</B>"
	DO EH^WWWTAB
	DO EL^WWWTAB
	DO STOP^WWWTAB
	WRITE "<BR>"
	WRITE "</CENTER>"
	DO START100^WWWTAB  ;STARTEN DER ÜBERSCHRIFT ;launching the superscription 
	WRITE "<THEAD>" 
	DO NL^WWWTAB
	FOR I=1:1 QUIT:$PIECE(UES(1),Y,I,99)=""  DO NHW^WWWTAB WRITE $PIECE(UES(1),Y,I),"&nbsp;" DO EH^WWWTAB
	DO EL^WWWTAB
	WRITE "</THEAD>"
	QUIT
]]></Routine>
</Export>