<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFPTT" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFPTT
#include COMSYS
#include INConst
	/*------------------------------------------------------------------------------
	; Description of Function :
	;		POSITIONS ARTIKELTEILESTRUKTUR TABELLE ANZEIGE eines AUFTRAGES bei Artikelteileanlage
	;	DIESES PROGRAMM ZEIGT DIE TABELLE DER TEILE IN DER POSITIONS - ARTIKEL- STRUKTUR - ERFASSUNG AN 
	;	this programme who tabulation the within the texture logging upon 
	;	VERSCHIEBEN DER TEILE IST MÖGLICH ;defer the potential 
	;
	; Called By :	LIST     : Button 6 "Print Parts List" on form INAUFPTT1 => Routine INAUFPTT
	;				PROC     : INAUFPTT execute
	;				PROCZ    : Routine INAUFPTT2, INAUFPTT execute
	;				NEU      : Routine INAUFPTT
	;				INAUFPTT : Routine INAUFPTT
	; Inputs : 
	;
	; ByRef :
	;	YKEY		idOrder_,_idOrderLine
	;	YLISTEN		
	;	YPARA		
	;
	; Returns :
	;
	;
	; History :
	; 29-Dec-2006	GRF		SR15333: Naked References
	; 25-Sep-2006	GRF		Doco; macro; YCR
	; 01-Jun-2006	GRF		Doco
	; 01-Feb-2006	GRF		SR14203: Doco
	; 13-Sep-2005	GRF		Doco
	; 17-Aug-2005	GRF		SR13215: /3600
	; 10-AUG-2005   TYBD    SR13166: ADD BACKBUTTON 
	; 11.11.2000	DT		(C) BY DITMAR TYBUSSEK
	;-----------------------------------------------------------------------------*/
	NEW AUFPARTIKEL,ZUSATZ,ART,ARTT,ARTX,KEINEUNTERTEILE,TEILE,GEWICHT,DAUER,RDAUER,WERT,TART
	new YAUF,YPOS,YALT,MENGE,EKNEU,YAUFPXL1,YAUFPXL2,MITRUEST,MENGEP,TEILEXIST
	
	;ACHTUNG YPARA=ENTHÄLT DIE STRUKTUR ZURUECK ZUM OBERARTIKEL (WENN AUSWAHL UNTER/UNTERARTIKEL) ;estimation who texture Selection 
	QUIT:YKEY=""
	SET YAUF=$PIECE(YKEY,",",1)			QUIT:YAUF=""
	SET YPOS=$PIECE(YKEY,",",2)			QUIT:YPOS=""
	
	;---------------------------------------
	
	SET YLISTEN    = $GET(YLISTEN)
	SET VERSCHNITT = $$$INVORGBlendInAdd($GET(^INVORG(YM,YM,1)))  ; D10    VERSCHNITT IN % ;within 
	
	;ABGESCHLOSSEN
	SET EKNEU    = 1
	SET MITRUEST = 1
	;	D244		$$$INAUFPFromStockToProduction()        ENTHÄLT BEREITS TATSÄCHLICHEN EK - NICHT ÄNDERN! KEINE RÜSTZEITEN ;yet Planned Cost Not alter no 
	;	                                                    ALREADY CONTAINS ACTUAL EK - NOT CHANGING! NO PREPARATION TIMES
	;	D245		$$$INAUFPNoRecalculationOfCostAllo()    NEURECHNEN HERSTELLKOSTEN NICHT ERLAUBT ;RE-CALCULATION OF MANUFACTURING COSTS NOT PERMITTED
	IF $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,254)=1   SET EKNEU=0
	IF $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,244)'="" SET EKNEU=0
	
	SET YPARA=$GET(YPARA)  ;ARTIKELTEILEBENE
	FOR  QUIT:$EXTRACT(YPARA)'=","  SET YPARA=$EXTRACT(YPARA,2,99)  ;KOMMA HERAUSFILTERN ;strip leading commas
	SET YPARAX=YPARA  ;SICHERN YPARA FÜR SPÄTERE VERWENDUNG ;safeguard to 
	
	;FÜR DIE GESAMMTSUMME ;to who 
	SET GEWICHT   = 0
	SET DAUER	  = 0
	SET RDAUER	  = 0
	SET WERT	  = 0
	SET ZUSATZ	  = 0
	SET TEILEXIST = 0
	SET YDDSATZ   = 0  ;ANZEIGE WEISS ;Show 
	
	; Return to previous part list level
	;---------------------------------------
	IF $TRANSLATE(YPARA,",")'="" DO   ;ZURUECK ZU OBERARTIKEL ;within 
	. NEW YPARA,YPARA1,YPARA2,YKEY,YBACK,YI,TEILETEXT
	. SET YKEY=YAUF_","_YPOS
	. SET YPARA=$PIECE(YPARAX,",",1,$LENGTH(YPARAX,",")-1)
	. WRITE "<A"
	. WRITE " TITLE="_"""" DO  WRITE """"  ;TEXT
	. . WRITE $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,1)   ;HAUPTPOSITION
	. . FOR YI=1:1 QUIT:$PIECE(YPARAX,",",YI)=""  DO  ;Teile aufbauen ;parts construct 
	. . . IF YI=2 WRITE "   "
	. . . DO 
	. . . . WRITE $CHAR(13)
	. . . . FOR YI(1)=1:1:YI WRITE "   "
	. . . . WRITE "\__"
	. . . ;
	. . . SET TEILETEXT="("_$PIECE($GET(^INAUFPT(YM,YAUF,YPOS,$TRANSLATE($PIECE(YPARAX,",",1,YI),",",".")_".",1)),Y,4)_") "_$PIECE($GET(^INAUFPT(YM,YAUF,YPOS,$TRANSLATE($PIECE(YPARAX,",",1,YI),",",".")_".",1)),Y,1)   ;OBERTEIL ANZEIGEN ;display 
	. . . WRITE $PIECE(YPARAX,",",YI)_" "_TEILETEXT
	. ;
	. WRITE " HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INAUFPTT1"
	. SET YBACK="INAUF,INAUFP,"
	. DO ^WWWCGI
	. WRITE """"_">"
	. WRITE "<FONT SIZE=2>"
	. ;WRITE "<FONT COLOR=FIREBRICK>"
	. WRITE "<B>"
	. WRITE YCR,"<IMG SRC="_""""_YGIF_"hback.gif"_""""_" TITLE="_""""_$$^WWWTEXT(32108)_""""_" id="_""""_"BUTTON_BACK"_""""_" border=0 VSPACE=0>"   ;backbutton;TYBD;SR13166
	. WRITE $$^WWWTEXT(32108)  ;ÜBERGEORDNETE ARTIKEL ; "Back To Superior Item  "
	. WRITE "</B>"
	. ;WRITE "</FONT>"
	. ;WRITE YCR,"<IMG SRC="_""""_YGIF_"teile.gif"_""""_" TITLE="_""""_$$^WWWTEXT(32108)_""""_" width=18 height=18 border=0 VSPACE=0>"   ;übergeordneter Artikel
	. WRITE "</A>"
	. WRITE "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
	. WRITE "<B>"_$GET(TEILETEXT)_"</B>"
	. WRITE "</FONT>"
	
	WRITE "<BR>"
	
	;Start anzeige
	;ANZEIGE ERFASSTE WERTE ;Show 
	DO ^WWWFRAME(0)
	WRITE YCR
	
	DO KOPF ;DRUCKEN KOPFZEILE ;print part header
	
	;EINZELTEILE ANZEIGEN ;display 
	SET ARTX=0   ;KEINE TEILE ;no 
	
	;ZUSAMMENSTELLEN LAUFVARIABLE
	SET YAUFPXL="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_""""_YPOS_""""
	FOR YI=1:1 QUIT:$PIECE(YPARA,",",YI)=""  SET YAUFPXL=YAUFPXL_","_$PIECE(YPARA,",",YI)
	SET YAUFPXL1=YAUFPXL_",ARTT,ARTTT)"  ;PRUEFUNG AUF UNTERPOSITIONEN ;upon 
	SET YAUFPXL2=YAUFPXL_",ARTT)"        ;PRUEFUNG AUF UNTERPOSITIONEN ;upon 
	SET YAUFPXL0=""                      ;KEINE VORPOSITION ;no 
	IF $PIECE(YPARA,",",1)'="" SET YAUFPXL0=YAUFPXL_")"  ;PRUEFUNG VOR-POSITION
	SET YAUFPXL=YAUFPXL_",ARTT)"         ;LAUF GLOBAL ;trend 
	
	SET MENGE  = $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,5)   ;MENGE DER POS ;line quantity
	SET MENGEP = $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,39)  ;GERECHNETE PRODUKTIONSMENGE ÜBERGEORDNETES TEIL  ;FIS;23.09.04 ;part 
	IF $DATA(^INAUFPT(YM,YAUF,YPOS)) DO
	. IF $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,40)=2 SET MENGE=1,MENGEP=1
	. IF $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,40)=10 SET MENGE=1,MENGEP=1
	. IF $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,40)=11 SET MENGE=1,MENGEP=1
	
	SET ARTIKEL=$PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,4)  ;ART DER POS ;Type the 
	SET AUFPARTIKEL=ARTIKEL
	IF YAUFPXL0'="" DO  ;WENN UNTERTEIL DES UNTERTEILS ;when 
	. SET MENGE  = $PIECE($GET(@YAUFPXL0),Y,5)    ;GERECHNETE MENGE ÜBERGEORDNETES TEIL ;quantity part 
	. SET MENGEP = $PIECE($GET(@YAUFPXL0),Y,39)   ;GERECHNETE PRODUKTIONSMENGE ÜBERGEORDNETES TEIL  ;FIS;23.09.04 ;part 
	. IF $PIECE($GET(@YAUFPXL0),Y,40)=2  SET MENGE=1,MENGEP=1  ;FIS;25.05.04;25780  ;LEISTUNG IN LEISTUNG
	. IF $PIECE($GET(@YAUFPXL0),Y,40)=10 SET MENGE=1,MENGEP=1  ;FIS;25.05.04;25780  ;LEISTUNG IN LEISTUNG
	. IF $PIECE($GET(@YAUFPXL0),Y,40)=11 SET MENGE=1,MENGEP=1  ;FIS;25.05.04;25780  ;LEISTUNG IN LEISTUNG
	. SET ARTIKEL=$PIECE($GET(@YAUFPXL0),Y,4)  ;ARTIKELNUMMER
	
	SET ARTT=""
	FOR  SET ARTT=$ORDER(@YAUFPXL) QUIT:ARTT=""  DO   ;SUCHEN TEILE ;seek 
	. SET TEILE=$GET(@YAUFPXL)  ;LESEN UNTERTEILDATENSATZ ;read 
	. IF TEILE'="" SET TEILEXIST=1
	. NEW YTEILSUM
	. SET YTEILSUM=""
	. IF YLISTEN=1 DO
	. . DO  ;IF $PIECE(TEILE,Y,40)'=1 DO  ;AUSWERTEN DER MENGEN, WENN TEILE GLEICH
	. . . NEW YARTTX,Q,YARTTC,TEILE1
	. . . SET TEILE1=TEILE
	. . . SET YTEILSUM=1
	. . . SET Q=0
	. . . SET YARTTX=ARTT
	. . . FOR  SET ARTT=$ORDER(@YAUFPXL) QUIT:ARTT=""  DO  QUIT:Q=1
	. . . . SET YARTTC=$GET(@YAUFPXL)  ;TEILE INFO
	. . . . IF $PIECE(YARTTC,Y,1,40)'=$PIECE(TEILE1,Y,1,40) SET Q=1 SET ARTT=YARTTX QUIT  ;NICHT GLEICH ;Not without delay 
	. . . . SET YARTTX=ARTT
	. . . . ;
	. . . . SET YTEILSUM=YTEILSUM+1
	. . . . ;SET $PIECE(TEILE,Y,5)=$PIECE(TEILE,Y,5)+$PIECE(YARTTC,Y,5)    ;MEHRERE STUECKE ALLES GLEICH MENGE
	. . . . SET $PIECE(TEILE,Y,43)=$PIECE(TEILE,Y,43)+$PIECE(YARTTC,Y,43)  ;MEHRERE STUECKE ALLES GLEICH GEWICHT   ;divers whatsoever without delay wt. 
	. . . . SET $PIECE(TEILE,Y,45)=$PIECE(TEILE,Y,45)+$PIECE(YARTTC,Y,45)  ;MEHRERE STUECKE ALLES GLEICH ZEIT      ;divers whatsoever without delay time 
	. . . . SET $PIECE(TEILE,Y,70)=$PIECE(TEILE,Y,70)+$PIECE(YARTTC,Y,70)  ;MEHRERE STUECKE ALLES GLEICH RUESTZEIT ;divers whatsoever without delay 
	. . . . SET $PIECE(TEILE,Y,47)=$PIECE(TEILE,Y,47)+$PIECE(YARTTC,Y,47)  ;MEHRERE STUECKE ALLES GLEICH WERT      ;divers whatsoever without delay worthy 
	. . . ;
	. . . IF ARTT="" SET ARTT=$ORDER(@YAUFPXL,-1)
	. ;
	. DO ANZEIGE
	
	IF $GET(YDDSATZ)<10 DO
	. NEW YBLANKLINE
	. SET YBLANKLINE=$GET(YDDSATZ)
	. FOR YBLANKLINE=YBLANKLINE:1:10 DO
	. . WRITE "<TR>"
	. . SET YDDSATZ=YDDSATZ+1
	. . FOR YI=1:1:17 DO
	. . . WRITE "<TD NOWRAP VALIGN=TOP"
	. . . IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . . WRITE ">"
	. . . WRITE "<FONT SIZE=2>"
	. . . WRITE "&nbsp;"
	. . . WRITE "</TD>"
	. . . WRITE YCR
	
	DO GESAMT   ;SUMMENZEILE
	
	DO ^WWWFRAME(1)
	IF ARTX=0 WRITE YCR,$$^WWWTEXT(32109),YCR   ;kein POSITIONSARTIKELTEILE vorhanden ; "No Level Edited"
	QUIT
	
GESAMT ;ENDEZEILE GESAMTWERTE
	
	;---------------------------------------
	
	WRITE "<TR>"
	
	FOR YI=1:1:10 DO
	. WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	. IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	. WRITE "&nbsp;"  ;POSITIONIERUNG
	. WRITE YCR,"</TH>"
	
	WRITE "<TH ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	WRITE $$^WWWZAHL(GEWICHT,0,1)
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	WRITE "<TH ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	WRITE $$^WWWTIME(DAUER)
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	SET RDAUER=RDAUER*$$^INPROLOS(ARTIKEL,MENGE)
	WRITE "<TH ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	IF MITRUEST=1 WRITE $$^WWWTIME(RDAUER)
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	WRITE "<TH NOWRAP ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	WRITE $$^WWWZAHL(WERT,0,2,YWHR)
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	FOR YI=1:1:3 DO
	. WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	. IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	. WRITE "&nbsp;"  ;längen
	. WRITE YCR,"</TH>"
	
	WRITE YCR,"</TR>"
	
	;---------------------------------------
	
	SET ZUSATZ=0
	IF MITRUEST=1 IF ARTIKEL'="" SET ZUSATZ=$PIECE($GET(^INART(YM,ARTIKEL,1)),Y,74)+$PIECE($GET(^INART(YM,ARTIKEL,1)),Y,75)
	IF MITRUEST=1 IF YAUFPXL0'="" DO  ;FIS;ZUSATZKOSTEN AUS AUFTRAG HOLEN;10.09.04;26268
	. SET ZUSATZ=$PIECE(@YAUFPXL0,Y,74)+$PIECE(@YAUFPXL0,Y,75)
	
	IF MITRUEST=1 IF YAUFPXL0="" DO  ;FIS;ZUSATZKOSTEN AUS AUFTRAG HOLEN;10.09.04;26268
	. SET ZUSATZ=$PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,74)+$PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,75)
	
	IF +ZUSATZ'=0 IF +$GET(MENGE)'=0 SET ZUSATZ=ZUSATZ*($$^INPROLOS($GET(ARTIKEL),$GET(MENGEP))/MENGE)  ;FIS;13.09.04;26268
	
	;---------------------------------------
	
	IF +ZUSATZ'=0 DO
	. WRITE "<TR>"
	. FOR YI=1:1:13 DO
	. . WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. . IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	. . IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	. . WRITE "&nbsp;"  ;POSITIONIERUNG
	. . WRITE YCR,"</TH>"
	. ;
	. WRITE "<TH NOWRAP ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	. IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	. IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	. WRITE $$^WWWZAHL(ZUSATZ,0,2,YWHR)
	. WRITE "&nbsp;"
	. WRITE YCR,"</TH>"
	. FOR YI=1:1:3 DO
	. . WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. . IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	. . IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	. . WRITE "&nbsp;"  ;längen
	. . WRITE YCR,"</TH>"
	. ;
	. WRITE YCR,"</TR>"
	
	;---------------------------------------
	
	WRITE "<TR>"
	
	FOR YI=1:1:12 DO
	. WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	. IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	. WRITE "&nbsp;"  ;POSITIONIERUNG
	. WRITE YCR,"</TH>"
	
	SET RWERT=0 
	DO
	. NEW WG,BETR,STDWERT
	. SET BETR=$GET(YLOCATION)
	. IF BETR="" SET BETR=$ORDER(^INKALK(YM,""))
	. IF BETR="" SET BETR=$ORDER(^WWW0121(0,YM,""))
	. IF BETR="" SET BETR=1
	. SET WG=$PIECE($GET(^INVORG(YM,YM,1)),Y,13)  ;STANDARD WARENGRUPPE
	. IF WG="" SET WG=$ORDER(^INKALK(YM,BETR,""))
	. IF WG="" SET WG=1
	. SET STDWERT=$PIECE($GET(^INKALK(YM,BETR,WG,1)),Y,1)/3600
	. SET RWERT=$JUSTIFY(RDAUER*STDWERT,0,2)
	
	WRITE "<TH ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	IF MITRUEST=1 WRITE $$^WWWZAHL(RWERT,0,2)
	IF MITRUEST=0 SET RWERT=0  ;SCHON ABGESCHLOSSEN ;yet 
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	WRITE "<TH NOWRAP ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	WRITE $$^WWWZAHL(WERT*MENGE+ZUSATZ+RWERT,0,2,YWHR)
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	FOR YI=1:1:3 DO
	. WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	. IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	. WRITE "&nbsp;"  ;längen
	. WRITE YCR,"</TH>"
	
	SET EKNEU=1
	IF $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,254)=1   SET EKNEU=0  ;NEURECHNEN HERSTELLKOSTEN NICHT ERLAUBT ;Change not permitted 
	IF $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,244)'="" SET EKNEU=0  ;ENTHÄLT BEREITS TATSÄCHLICHEN EK - NICHT ÄNDERN ! ;yet Planned Cost Not alter 
	
	;IF +GEWICHT'=0 SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,43)=GEWICHT*MENGE
	;IF +DAUER'=0 SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,45)=DAUER*MENGE
	;IF +RDAUER'=0 SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,70)=RDAUER
	;SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,71)=RWERT
	;SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,47)=$$^INAUFKOST(YAUF,YPOS)
	;SET YOK=$$^INAUFPNETTO(YAUF,YPOS)
	
	IF YAUFPXL0="" DO
	. ;SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,43)=GEWICHT*MENGE
	. IF $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,4)'="" IF $PIECE($GET(^INART(YM,$PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,4),1)),Y,255)'=1 SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,43)=GEWICHT*MENGE  ;FIS;21.09.04;26400;GEWICHT NICHT RECHNEN
	. ;IF +DAUER'=0 SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,45)=$J(DAUER*MENGE,0,0)  ;TYBD;25778;3,6,2004
	. ;SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,45)=$JUSTIFY(DAUER*MENGE,0,0)  ;TYBD;25778;3,6,2004
	. IF $GET(TEILEXIST)=1 SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,45)=$JUSTIFY(DAUER*MENGE,0,0)  ;FIS;15,2,2005;27318;NUR RECHNEN, WENN UNTERTEILE VORHANDEN
	. SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,70)=RDAUER*$$^INPROLOS(ARTIKEL,MENGE)
	. SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,71)=RWERT
	. ;SET ZUSATZ=ZUSATZ*$$^INPROLOS(ARTIKEL,MENGE)  ;FIS;13.09.04;26268
	. IF +MENGEP'=0 SET ZUSATZ=(ZUSATZ/MENGEP)  ;FIS;23.09.04;26268
	. DO NEU
	. IF EKNEU=1 SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,47)=$$^INAUFKOST(YAUF,YPOS)
	. SET YOK=$$^INAUFPNETTO(YAUF,YPOS)
	
	IF YAUFPXL0'="" DO
	. SET $PIECE(@YAUFPXL0,Y,43)=GEWICHT*MENGE
	. ;IF +DAUER'=0 SET $PIECE(@YAUFPXL0,Y,45)=$JUSTIFY(DAUER*MENGE,0,0)  ;TYBD;25778;3,6,2004
	. ;SET $PIECE(@YAUFPXL0,Y,45)=$JUSTIFY(DAUER*MENGE,0,0)  ;TYBD;25778;3,6,2004
	. IF $GET(TEILEXIST)=1 SET $PIECE(@YAUFPXL0,Y,45)=$JUSTIFY(DAUER*MENGE,0,0)  ;FIS;15,2,2005;27318;NUR RECHNEN, WENN UNTERTEILE VORHANDEN
	. SET $PIECE(@YAUFPXL0,Y,70)=RDAUER*$$^INPROLOS(ARTIKEL,MENGE)
	. SET $PIECE(@YAUFPXL0,Y,71)=RWERT
	. ;SET ZUSATZ=ZUSATZ*($$^INPROLOS(ARTIKEL,MENGEP)/MENGE)  ;FIS;13.09.04;26268
	. IF +$GET(MENGEP)'=0 SET ZUSATZ=(ZUSATZ/MENGEP)  ;FIS;23.09.04;26268
	. IF EKNEU=1 DO  ;TEILE NACHRECHNEN
	. . NEW ARTT
	. . SET ARTT=""
	. . SET ARTT=$ORDER(@YAUFPXL2)
	. . IF ARTT'="" SET $PIECE(@YAUFPXL0,Y,47)=WERT*MENGE  ;+ZUSATZ  ;TEILE VORHANDEN ;on hand 
	. ;
	. DO NEU
	. IF EKNEU=1 SET $PIECE(^INAUFP(YM,YAUF,YPOS,1),Y,47)=$$^INAUFKOST(YAUF,YPOS)
	
	; FIXME : where is </TR> for previous <TR>? <GRF>
	;---------------------------------------
	
	; "Item Has Additional Costs (Per Lot Size)"                      ;artikel enthält Zusatzkosten
	; "Additional Costs Will Be Calculated At The Past Calculation"   ;Zusatzkosten WERDEN ERST DURCH DIE KALKULATION NEU BERECHNET
	IF $get(ZUSATZ(1))=1 DO
	. WRITE "<TR>"
	. WRITE "<TD COLSPAN=17>"
	. WRITE "<font size=2 color="_YRED_">"
	. WRITE "&nbsp;*&nbsp;"_$$^WWWTEXT(34091)
	. WRITE "<BR>&nbsp;&nbsp;&nbsp;"_$$^WWWTEXT(34092)
	. WRITE "</font>"
	. WRITE "</td></tr>",YCR
	
	QUIT
	
ANZEIGE ;DER ARTIKELTEILE ;the 
	NEW AB
	
	SET ARTX=1  ;TEIL VORHANDEN = SUMME ANZEIGEN ;part on hand sum display 
	SET YDDSATZ=YDDSATZ+1  ;ANZEIGE WEISS ;Show 
	;---------------------------------------
	
	WRITE YCR,"<TR>"
	
	;LÖSCHEN ;Delete 
	WRITE "<TD NOWRAP VALIGN=MIDDLE"
	
	;I YDDSATZ#2=1 W " BGCOLOR="_YWHITE
	SET YALT=$$^WWWTEXT(41)
	IF $PIECE(TEILE,Y,20)'="" DO   ;FARBKENNUNG UND TEXT ;And Text 
	. NEW YCOL
	. SET YCOL=$PIECE($GET(^INARTPARA(YM,SPRACHE,$PIECE(TEILE,Y,20),1)),Y,2)
	. SET YALT=$PIECE($GET(^INARTPARA(YM,SPRACHE,$PIECE(TEILE,Y,20),1)),Y,1)
	. IF YCOL'="" WRITE " BGCOLOR="_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,YCOL,1)),Y,1)
	
	WRITE " WIDTH=24"
	WRITE ">"
	DO
	. NEW DATEI,CONFTXT
	. SET AB=+$PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,90)  ;PRODUKTION-ABGESCHLOSSEN=BESTAND KORRIGIERT
	. IF AB'=1 DO
	. . SET DATEI="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. . IF $GET(YPARA)'="" SET DATEI=DATEI_","_YPARA
	. . SET DATEI=DATEI_")"
	. . IF $PIECE($GET(@DATEI),Y,244)'="" SET AB=1 QUIT  ;LAGERBUCHUNG DES OBERTEILS BEREITS ERFOLGT ;yet 
	. . SET FERT=$PIECE($GET(@DATEI),Y,165)  ;FERTIGUNGSNUMMER
	. . IF FERT'="" IF $PIECE($GET(^INPROSTEMP1(YM,FERT,1)),Y,22)'="" SET AB=1 QUIT  ;LAGERBUCHUNG DES OBERTEILS BEREITS ERFOLGT ;yet 
	. . IF FERT'="" IF $PIECE($GET(^INPROSTEMP(YM,FERT,1)),Y,22)'="" SET AB=1  ;LAGERBUCHUNG DES OBERTEILS BEREITS ERFOLGT ;yet 
	. ;
	. WRITE "<A HREF="_""""
	. SET CONFTXT=" ("_YAUF_","_YPOS_","_YPARA_","_ARTT_") "_$TRANSLATE($PIECE(TEILE,Y,1),"'"_"""","´´")_"  "_$$^WWWTEXT(321)  ;LÖSCHEN ? ;Delete 
	. DO  ;PRÜFUNG WICHTIGE UNTERDATEIEN;24921;FIS;13.01.04
	. . NEW TEILEKEY,TXT
	. . SET TEILEKEY=$TRANSLATE($GET(ARTT),",",".")_"."
	. . IF $GET(YPARA)'="" SET TEILEKEY=$TRANSLATE(YPARA,",",".")_"."_TEILEKEY
	. . SET TXT=""
	. . FOR TEILEKEY(1)=TEILEKEY,"" DO
	. . . DO:TEILEKEY(1)'=""  IF TEILEKEY(1)="" SET TEILEKEY(1)=TEILEKEY FOR  SET TEILEKEY(1)=$ORDER(^INAUFPT(YM,YAUF,YPOS,TEILEKEY(1))) QUIT:TEILEKEY(1)=""  QUIT:$EXTRACT(TEILEKEY(1),1,$LENGTH(TEILEKEY))'=TEILEKEY  DO
	. . . . IF $DATA(^INWEAUFPT(YM,YAUF,YPOS,TEILEKEY(1)))    SET TXT=TXT_"\n"_$$^WWWTEXT(33715,1)_" ("_YAUF_","_YPOS_","_TEILEKEY(1)_")"  ;ACHTUNG! LAGERENTNAHMEINFORMATIONEN WERDEN GELÖSCHT ;will 
	. . . . IF $DATA(^INAUFPTEXTRA(YM,YAUF,YPOS,TEILEKEY(1))) SET TXT=TXT_"\n"_$$^WWWTEXT(33717,1)_" ("_YAUF_","_YPOS_","_TEILEKEY(1)_")"  ;ACHTUNG! ZUSATZKOSTEN WERDEN GELÖSCHT ;additional costs will 
	. . . . IF $DATA(^INAUFPTSN(YM,YAUF,YPOS,TEILEKEY(1)))    SET TXT=TXT_"\n"_$$^WWWTEXT(33716,1)_" ("_YAUF_","_YPOS_","_TEILEKEY(1)_")"  ;ACHTUNG! SN-ZUORDNUNG WIRD GELÖSCHT
	. . ;
	. . IF TXT'="" SET CONFTXT=CONFTXT_"\n"_TXT
	. ;
	. WRITE "JavaScript:if (confirm('"_CONFTXT_"')) {"
	. IF AB=1 DO             ;fan  11.09.02
	. . NEW DATEI,ART,ART1
	. . SET DATEI="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. . ;IF $GET(YPARA)'="" SET DATEI=DATEI_","_YPARA_","_ARTT
	. . IF $GET(YPARA)'="" SET DATEI=DATEI_","_YPARA
	. . IF $GET(ARTT)'="" SET DATEI=DATEI_","_ARTT
	. . SET DATEI=DATEI_")"
	. . QUIT:'$DATA(@DATEI)
	. . QUIT:$DATA(@DATEI)=10  ;KEY NICHT VOLLSTÄNDIG ;KEY Not integral 
	. . SET ART=$PIECE(@DATEI,Y,4)
	. . QUIT:ART=""
	. . SET ART1=$GET(^INART(YM,ART,1))
	. . QUIT:$PIECE(ART1,Y,26)=2       ;LEISTUNG ;performance 
	. . QUIT:$PIECE(ART1,Y,29)=1       ;Artikel ohne Bestandsführung    ;Item Without 
	. . WRITE " alert('"_$$^WWWTEXT(33037,,1)_"');"  ;ACHTUNG, DER LAGERBESTAND MUSS GGF. MANUELL KORIGIERT WERDEN
	. ;
	. IF $PIECE(TEILE,Y,165)'="" DO             ;FERTIGUNGSANWEISUNG GEDRUCKT
	. . WRITE " alert('"_$$^WWWTEXT(33568,,1)_"');"  ;FIS;25116;ACHTUNG, FERTIGUNGSANWEISUNG BEREITS GEDRUCKT
	. ;
	. WRITE " window.location='"
	. WRITE YAKTION_"EP=WWWMANU&YEXEC=*D|PROC^INAUFPTT"
	. WRITE "&YPARA1="_YAUF_","_YPOS_","_YPARA_","_ARTT
	. WRITE "&YFUNCT1=KILL"_","_AB
	. DO ^WWWCGI
	. WRITE "';"
	. WRITE "}"
	. WRITE """"_">"
	. WRITE YCR,"<IMG SRC="_""""_YGIF_"del.gif"_""""_" TITLE="_""""_YALT_""""_" width=18 height=18 border=0 VSPACE=0>"
	. WRITE "</A>"
	
	WRITE "</TD>",YCR
	
	;TEILE DER TEILE ;the 
	SET KEINEUNTERTEILE=1
	SET ARTTT="" 
	SET ARTTT=$ORDER(@YAUFPXL1)
	IF ARTTT'="" SET KEINEUNTERTEILE=0  ;TEIL IM TEIL VORHANDEN ;part part on hand
	IF $GET(AUFPARTIKEL)'="" IF $GET(AUFPARTIKEL)=$PIECE($GET(TEILE),Y,4) SET KEINEUNTERTEILE=2  ;TYBD;28,12,2004
	DO  ;TEILE der teile ;who 
	. WRITE YCR
	. SET YBACK1=YBACK
	. NEW YPARA,YBACK,YKEY
	. ;
	. SET YPARA=YPARAX
	. IF YPARA'="" SET YPARA=YPARA_","
	. SET YPARA=YPARA_ARTT   ;NEUES UNTERTEIL ;something new 
	. ;
	. SET YKEY=YAUF_","_YPOS
	. WRITE "<TD NOWRAP VALIGN=MIDDLE"
	. ;I YDDSATZ#2=1 W " BGCOLOR="_YWHITE
	. IF $PIECE(TEILE,Y,20)'="" DO   ;FARBKENNUNG
	. . NEW YCOL
	. . SET YCOL=$PIECE($GET(^INARTPARA(YM,SPRACHE,$PIECE(TEILE,Y,20),1)),Y,2)
	. . IF YCOL'="" WRITE " BGCOLOR="_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,YCOL,1)),Y,1)
	. ;
	. WRITE " WIDTH=24"
	. WRITE ">"
	. DO
	. . IF KEINEUNTERTEILE'=2 WRITE "<FONT SIZE=2>"
	. . IF KEINEUNTERTEILE'=2 WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INAUFPTT1"
	. . IF KEINEUNTERTEILE'=2 SET YBACK=""   ;YBACK1
	. . IF KEINEUNTERTEILE'=2 DO ^WWWCGI
	. . IF KEINEUNTERTEILE'=2 WRITE """"_">"
	. . IF KEINEUNTERTEILE=2 WRITE YCR,"<IMG SRC="_""""_YGIF_"blank.gif"_""""_" TITLE="_""""_$$^WWWTEXT(32107)_""""_" width=18 height=18 border=0 VSPACE=0>"
	. . IF KEINEUNTERTEILE=1 WRITE YCR,"<IMG SRC="_""""_YGIF_"blank.gif"_""""_" TITLE="_""""_$$^WWWTEXT(32107)_""""_" width=18 height=18 border=0 VSPACE=0>"
	. . IF KEINEUNTERTEILE=0 WRITE YCR,"<IMG SRC="_""""_YGIF_"teile.gif"_""""_" TITLE="_""""_$$^WWWTEXT(32107)_""""_" width=18 height=18 border=0 VSPACE=0>"
	. . IF KEINEUNTERTEILE'=2 WRITE "</A>"
	
	WRITE "</TD>",YCR
	
	;AUF UND UP ;upon And 
	WRITE "<TD NOWRAP VALIGN=MIDDLE"
	
	;I YDDSATZ#2=1 W " BGCOLOR="_YWHITE
	WRITE " WIDTH=20>"
	WRITE "<FONT SIZE=2>"
	IF $PIECE(TEILE,Y,165)'="" WRITE "&nbsp;"  ;Fertigungsanweisung schon gedruckt
	IF $PIECE(TEILE,Y,165)="" DO  ;NOCH KEINE FERTIGUNGSANWEISUNG GEDRUKT ;yet no 
	. ;EINE POSITION HOCHRÜCKEN ;one 
	. WRITE "<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|PROC^INAUFPTT"
	. DO
	. . SET YBACK1=YBACK
	. . NEW YBACK
	. . WRITE "&YPARA1="_YAUF_","_YPOS_","_YPARA_","_ARTT
	. . WRITE "&YFUNCT1=UP"
	. . SET YBACK=YBACK1
	. . DO ^WWWCGI
	. ;
	. WRITE """"_">"
	. WRITE "<IMG SRC="_""""_YGIF_"scrup.gif"_""""_" TITLE="_""""_$$^WWWTEXT(32015)_""""_" border=0 VSPACE=0>"
	. WRITE "</A>"
	. ;EINE POSITION HERUNTER ;one 
	. WRITE "<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|PROC^INAUFPTT"
	. ;
	. DO
	. . SET YBACK1=YBACK
	. . NEW YBACK
	. . WRITE "&YPARA1="_YAUF_","_YPOS_","_YPARA_","_ARTT
	. . WRITE "&YFUNCT1=DOWN"
	. . SET YBACK=YBACK1
	. . DO ^WWWCGI
	. ;
	. WRITE """"_">"
	. WRITE "<IMG SRC="_""""_YGIF_"scrdown.gif"_""""_" TITLE="_""""_$$^WWWTEXT(32016)_""""_" border=0 VSPACE=0>"
	. WRITE "</A>"
	
	WRITE "</TD>",YCR
	
	DO  ;TEILENUMMER
	. SET YBACK1=YBACK
	. NEW YBACK,YKEY,COLOR
	. ;
	. SET YKEY=YAUF_","_YPOS_","
	. IF YPARA'="" SET YKEY=YKEY_$TRANSLATE(YPARA,",",".")_"."
	. SET YKEY=YKEY_ARTT_"."  ;TEILESTRUKTUR
	. ;
	. WRITE "<TD NOWRAP VALIGN=MIDDLE"
	. SET COLOR=""
	. IF YDDSATZ#2=1 SET COLOR=YWHITE
	. IF $PIECE(TEILE,Y,165)'="" DO    ;FERTIGUNGSNUMMER
	. . SET COLOR="YELLOW"
	. . IF $DATA(^INPROSTEMP0(YM,$PIECE(TEILE,Y,165))) SET COLOR="LIGHTGREEN"  ;ABGESCHLOSSEN 
	. . IF $GET(AB)=1 SET COLOR="LIGHTGREEN"  ;ABGESCHLOSSEN 
	. . QUIT
	. IF COLOR'="" WRITE " BGCOLOR="_COLOR
	. WRITE " ALIGN=RIGHT>"
	. IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	. IF YLISTEN=1 WRITE "<FONT SIZE=1>"
	. WRITE "<A TITLE="_""""_$$^WWWTEXT(32061)_""""_" HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INAUFPT"
	. SET YBACK=YBACK1_"INAUFPTT1,"
	. DO ^WWWCGI
	. WRITE """"_">"
	. WRITE ARTT
	. WRITE "&nbsp;"
	. WRITE "</A>"
	. WRITE "</TD>"
	
	;AUF UND UP  ZEICHNUNGSPOSITIONEN ;upon And 
	WRITE YCR,"<TD NOWRAP VALIGN=MIDDLE"
	
	;I YDDSATZ#2=1 W " BGCOLOR="_YWHITE
	WRITE " WIDTH=20>"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	
	;EINE POSITION + IN DER ZEICHNUNG ;one within the drawing 
	WRITE "<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|PROCZ^INAUFPTT"
	DO
	. SET YBACK1=YBACK
	. NEW YBACK
	. WRITE "&YPARA1="_YAUF_","_YPOS_","_YPARA_","_ARTT
	. WRITE "&YFUNCT1=UP"
	. SET YBACK=YBACK1
	. DO ^WWWCGI
	
	WRITE """"_">"
	WRITE "<IMG SRC="_""""_YGIF_"scrup.gif"_""""_" TITLE="_""""_$$^WWWTEXT(32015)_""""_" border=0 VSPACE=0>"
	WRITE "</A>"
	
	;EINE POSITION - IN DER ZEICHNUNG ;one within the drawing 
	WRITE "<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|PROCZ^INAUFPTT"
	DO
	. SET YBACK1=YBACK
	. NEW YBACK
	. WRITE "&YPARA1="_YAUF_","_YPOS_","_YPARA_","_ARTT
	. WRITE "&YFUNCT1=DOWN"
	. SET YBACK=YBACK1
	. DO ^WWWCGI
	
	WRITE """"_">"
	WRITE "<IMG SRC="_""""_YGIF_"scrdown.gif"_""""_" TITLE="_""""_$$^WWWTEXT(32016)_""""_" border=0 VSPACE=0>"
	WRITE "</A>"
	WRITE "</TD>",YCR
	
	NEW YARTART
	SET YARTART=""
	IF $PIECE(TEILE,Y,4)'="" SET YARTART=$PIECE($GET(^INART(YM,$PIECE(TEILE,Y,4),1)),Y,26)
	FOR YI=18,4,1,5,40,43,45,70,47,15,16,17 DO  ;AUSGABE DER DATENTABELLE ;expenses the 
	. WRITE YCR
	. SET YBACK1=YBACK
	. NEW YBACK,YKEY,YCOLOR
	. SET YKEY=YAUF_","_YPOS_","_ARTT
	. ;WRITE "<TD NOWRAP VALIGN=MIDDLE"
	. WRITE "<TD"
	. IF YLISTEN'=1 WRITE " NOWRAP"
	. WRITE " VALIGN=MIDDLE"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. IF (YI=4) || (YI=5) || (YI=45) || (YI=47) || (YI=43) || (YI=18) WRITE " ALIGN=RIGHT"
	. WRITE ">"
	. IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	. IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	. ;
	. SET YCOLOR=""
	. IF YI=47 IF $PIECE(TEILE,Y,26)=2 IF $PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,254)=1 SET YCOLOR="red"  ;LEISTUNGSWERTE NUR IN OBERTEIL RICHTIG BERECHNET ;only within rightly 
	. ;
	. DO   ;IN AUFTRAGSARTIKEL SPRINGEN UND ARTIKEL ÄNDERN ;within leap And item alter 
	. . NEW YKEY
	. . SET YKEY=YAUF_","_YPOS_","
	. . IF YPARA'="" SET YKEY=YKEY_$TRANSLATE(YPARA,",",".")_"."
	. . SET YKEY=YKEY_ARTT_"."  ;TEILESTRUKTUR
	. . WRITE "<A"
	. . WRITE " TITLE="_""""
	. . IF YCOLOR'="" WRITE $$^WWWTEXT(33070)_YCR_YCR      ;ACHTUNG! VORGEGEBENE AUSFÜHRUNGSZEIT '= GESTEMPELTE ZEIT ;execution time time 
	. . IF +VERSCHNITT=0!(YI'=8) WRITE $$^WWWTEXT(32060)   ;ARTIKEL BEARBEITEN ;item 
	. . IF +VERSCHNITT'=0&(YI=8) WRITE $$^WWWTEXT(32120)_" "_VERSCHNITT_"%"
	. . IF (YI=1)||(YI=4) DO
	. . . QUIT:$PIECE(TEILE,Y,4)=""
	. . . IF YARTART'="" WRITE $CHAR(13)_$PIECE($GET(^WWW101(0,"ARTIKEL-ART",SPRACHE,YARTART,1)),Y,1)
	. . ;
	. . WRITE """"
	. . WRITE " HREF="_""""_YAKTION_"EP=WWWFORM"
	. . IF (KEINEUNTERTEILE=0) || (YARTART=2) DO        ;WENN LEISTUNG DANN ANDERBAR ;when performance 
	. . . IF YARTART=2 WRITE "&YFORM="_"INAUFPT" QUIT   ;UNTERTEIL MIT ANDERUNG ;by means of 
	. . . WRITE "&YFORM="_"INAUFPT0"                    ;WEITERE TEILE
	. . ;
	. . IF KEINEUNTERTEILE=1 IF YARTART'=2 DO   ;KEINE LEISTUNG UND UNTERTEIL= KEINE ÄNDERUNG ;no performance And no alteration 
	. . . WRITE "&YFORM="_"INAUFPT0"            ;UNTERTEIL KEINE WEITEREN TEILE ;no 
	. . ;
	. . ;IF $PIECE(TEILE,Y,26)=2  WRITE " HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INAUFPT"
	. . ;IF $PIECE(TEILE,Y,26)'=2 WRITE " HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INAUFPT0"
	. . SET YBACK=YBACK1_"INAUFPTT1,"  ; ZURÜCK ;back 
	. . DO ^WWWCGI
	. ;
	. WRITE """"_">"
	. SET YTYPE=6  ;TEXTFORMAT
	. IF YI=43 SET YTYPE=12   ;GEWICHT ;wt. 
	. IF YI=15 SET YTYPE=12   ;LÄNGE   ;length
	. IF YI=16 SET YTYPE=12   ;BREITE  ;width 
	. IF YI=17 SET YTYPE=12   ;HÖHE    ;height 
	. IF YI=5  SET YTYPE=12   ;MENGE   ;quantity 
	. IF YI=45 SET YTYPE=7    ;UHRZEITFORMAT
	. IF YI=70 SET YTYPE=7    ;UHRZEITFORMAT
	. IF YI=70 DO
	. . IF EKNEU=0 SET $PIECE(TEILE,Y,YI)=0   ;KEINE RUESTZEITEN MEHR ;no more 
	. ;
	. IF YI=47 SET YTYPE=8   ;BETRAGSFORMAT
	. IF YI=40 IF $PIECE(TEILE,Y,YI)'="" SET $PIECE(TEILE,Y,YI)=$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(TEILE,Y,YI),1)),Y,1)  ;EINHEIT ZUORDNEN FÜR DEN AUSDRUCK ;unit refer to term 
	. IF YI=5 IF $GET(YTEILSUM)>1 WRITE YTEILSUM_"X"   ;ANZAHL DER SUMMEN ;Number the totals 
	. ;
	. IF YI=47 IF +$PIECE(TEILE,Y,74)'=0!(+$PIECE(TEILE,Y,75)'=0) DO  ;ARTIKEL MIT ZUSATZKOSTEN KENNZEICHEN;FIS;21.12.2004;26268
	. . WRITE "<font color="_YRED_">*</font>"
	. . SET ZUSATZ(1)=1  ;MERKEN FÜR FUSSTEXT
	. . QUIT
	. IF YCOLOR'="" WRITE "<font color="_""""_YCOLOR_""""_">"
	. IF YI'=70 WRITE $$^WWWTR(0,YTYPE,$PIECE(TEILE,Y,YI))  ;MIT UMFORMUNG ;by means of transformation 
	. IF YI=70 DO
	. . IF MITRUEST=1 WRITE $$^WWWTR(0,YTYPE,$PIECE(TEILE,Y,YI)) QUIT  ;MIT UMFORMUNG ;by means of transformation 
	. . WRITE "&nbsp;"
	. ;
	. IF YCOLOR'="" WRITE "</font>" 
	. ;
	. IF YI=43 IF $GET(ARTIKEL)'=$PIECE(TEILE,Y,4) SET GEWICHT = GEWICHT+$PIECE(TEILE,Y,YI)  ;ADDIEREN ;sum up 
	. IF YI=45 IF $GET(ARTIKEL)'=$PIECE(TEILE,Y,4) SET DAUER   = DAUER  +$PIECE(TEILE,Y,YI)  ;ADDIEREN ;sum up 
	. IF YI=70 DO
	. . IF MITRUEST=1 IF $GET(ARTIKEL)'=$PIECE(TEILE,Y,4) SET RDAUER=RDAUER+$PIECE(TEILE,Y,YI)  ;ADDIEREN ;sum up 
	. . IF MITRUEST=0 SET $PIECE(TEILE,Y,YI)=""   ;KEINE RUESTZEITEN MEHR ;no more 
	. ;
	. IF YI=47 IF $GET(ARTIKEL)'=$PIECE(TEILE,Y,4) SET WERT=WERT+$PIECE(TEILE,Y,YI)          ;ADDIEREN ;sum up 
	. ;IF $PIECE(TEILE,Y,4)'="" DO  ;ZUSATZKOSTEN
	. . NEW YFELD1,KOST
	. . . SET YFELD1=$GET(^INART(YM,$PIECE(TEILE,Y,4),1))
	. . . IF $PIECE(YFELD1,Y,74)'="" DO  ;WERKZEUGKOSTEN
	. . . . SET KOST=$PIECE(YFELD1,Y,74)
	. . . . IF $GET(ARTIKEL)'=$PIECE(TEILE,Y,4) SET WERT=WERT+KOST
	. . . . QUIT
	. . . IF $PIECE(YFELD1,Y,75)'="" DO  ;EXTRAKOSTEN
	. . . . SET KOST=$PIECE(YFELD1,Y,75)
	. . . . IF $GET(ARTIKEL)'=$PIECE(TEILE,Y,4) SET WERT=WERT+KOST
	. ;
	. WRITE "</A>"
	. WRITE "&nbsp;"
	. WRITE "</TD>"
	
	WRITE "</TR>",YCR
	
	;---------------------------------------
	
	QUIT
	
KOPF ;kopf der anzeigetabelle ;who 
	WRITE "<THEAD>",YCR
	
	;---------------------------------------
	
	IF YLISTEN=1 DO
	. WRITE "<TR>"
	. NEW YI
	. FOR YI=1:1:17 DO
	. . WRITE "<TH VALIGN=TOP NOWRAP ALIGN=LEFT"
	. . WRITE " BGCOLOR="_YDARKGRAY
	. . WRITE ">"
	. . WRITE "<FONT SIZE=1>"
	. . IF YI=8 DO 
	. . . QUIT:YAUF=""
	. . . QUIT:YPOS=""
	. . . WRITE $$^WWWTEXT(32047)_": "_YAUF_"-"_YPOS  ;AUFTRAGSNUMMER (32178ANGEBOT)
	. . . WRITE "  ",$PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,4)_" "
	. . . WRITE " (",$PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,1)_") "
	. . WRITE "&nbsp;"
	. . WRITE "</TH>"
	. ;
	. WRITE "</TR>",YCR
	
	;---------------------------------------
	
	WRITE YCR,"<TR>"
	
	WRITE "<TH BGCOLOR="_YDARKGRAY_" >"
	WRITE "<FONT SIZE=2>"
	WRITE "&nbsp;"   ;LÖSCHEN
	WRITE "</TH>"
	
	WRITE "<TH BGCOLOR="_YDARKGRAY_" WIDTH=24>"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	WRITE "&nbsp;"    ;TEILE DER TEILE VORHANDEN
	WRITE "</TH>"
	
	WRITE "<TH BGCOLOR="_YDARKGRAY_" WIDTH=20>"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	WRITE "<A TITLE="_""""_$$^WWWTEXT(32151)_""""          ; "Production Line Item"   ;FERTIGUNGSPOSITION
	WRITE " HREF=#>"
	WRITE "&nbsp;P&nbsp;"  ;POSITIONIERUNG
	WRITE "</A>"
	WRITE "</TH>"
	
	WRITE "<TH NOWRAP ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	WRITE "<A TITLE="_""""_$$^WWWTEXT(32151)_""""          ; "Production Line Item"   ;FERTIGUNGSPOSITION
	WRITE " HREF=#>"
	SET TEXT=$PIECE($GET(^WWW0021(0,"INAUFP",2,SPRACHE,1)),Y,1)    ; Language Text    ; SPRACHENTEXT
	IF TEXT="" SET TEXT=$PIECE($GET(^WWW002(0,"INAUFP",2,1)),Y,2)  ; "Line Item"      ; POSITION
	WRITE "P-"_TEXT
	WRITE "</A>"
	WRITE "</TH>"
	
	WRITE "<TH BGCOLOR="_YDARKGRAY_" WIDTH=20>"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	WRITE "<A TITLE="_""""_$$^WWWTEXT(32152)_""""          ; "Painting Line Item"     ;ZEICHNUNGSPOSITION
	WRITE " HREF=#>"
	WRITE "&nbsp;Z&nbsp;"  ;ZEICHNUNGS POSITIONIERUNG
	WRITE "</A>"
	WRITE "</TH>"
	
	; Z-Pos., Item Number, Item Name, Quantity, Quantity Unit, Weight In Kg, Execution Time, Setup Time, Cost, Length, Width, Height
	FOR YI=18,4,1,5,40,43,45,70,47,15,16,17 DO  ;AUSGABE DER DATENTABELLE ;expenses the 
	. WRITE "<TH ALIGN=LEFT NOWRAP BGCOLOR="_YDARKGRAY_">"
	. IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	. IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	. IF YI=18 WRITE "<A TITLE="_""""_$$^WWWTEXT(32152)_"""" WRITE " HREF=#>" ;ZEICHNUNGSPOSITION
	. SET TEXT=$PIECE($GET(^WWW0031(0,"INAUFP",YI,SPRACHE,1)),Y,1)            ;SPRACHENTEXT
	. IF TEXT="" SET TEXT=$PIECE($GET(^WWW003(0,"INAUFP",YI,1)),Y,2)          ;DATENFELD ;data item 
	. WRITE TEXT
	. IF YI=18 WRITE "</A>"
	. WRITE "</TH>"
	
	WRITE "</TR>"
	
	;---------------------------------------
	
	WRITE "</THEAD>",YCR
	QUIT
	
PROC ;BEARBEITUNG DER FUNKTIONEN BEI BUTTON AUF AB UND LÖSCHEN ;adaptation the next to upon Confirm. And Delete 
	NEW ADDON
	
	SET ADDON=$EXTRACT(10000_$RANDOM(10000),2,4)
	KILL ^WWWSOR(YUSER_ADDON,"NEU")
	NEW YI,DATEI,ARTT,ARTT1,DATEI1,DATEI2,DATEI3,YYMAX,DELKEY
	
	SET YFUNCT1 = $GET(%(YQUERY,"YFUNCT1"))  ;FUNKTION (UP DOWN KILL)
	SET YPARA1  = $GET(%(YQUERY,"YPARA1"))   ;ARTIKEL UND TEILENUMMER ;item And 
	SET YAUF    = $PIECE(YPARA1,",",1)
	SET YPOS    = $PIECE(YPARA1,",",2)
	SET ARTT    = $TRANSLATE($PIECE(YPARA1,",",3,99),".]]><![CDATA["_"""",",")  ;TEILE AUS INAUFPXL ;out of 
	FOR  QUIT:$EXTRACT(ARTT)'=","  SET ARTT=$EXTRACT(ARTT,2,99)  ;KOMMA HERAUSFILTERN (WENN YPARA="")
	
	IF $PIECE(YFUNCT1,",",1)="KILL" DO   ;LÖSCHEN DATENSATZ ;Delete data record 
	. QUIT:YAUF=""
	. QUIT:YPOS=""
	. QUIT:ARTT=""
	. ;
	. SET DATEI="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  SET DATEI=DATEI_","_$PIECE(ARTT,",",YI)
	. SET DATEI=DATEI_")"
	. QUIT:'$DATA(@DATEI)
	. ;
	. SET YSTEMPEL=$PIECE($GET(@(DATEI)),Y,165)
	. ;IF YSTEMPEL'="" DO
	. ;. KILL ^INPROSTEMP(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMP0(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMP1(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMPT(YM,YSTEMPEL)
	. ;
	. IF YSTEMPEL'="" DO
	. . NEW YWORK
	. . SET YWORK=""
	. . FOR  SET YWORK=$ORDER(^INPROSTEMPT(YM,YSTEMPEL,YWORK)) QUIT:YWORK=""  DO
	. . . IF $TRANSLATE($PIECE($GET(^INPROSTEMPT(YM,YSTEMPEL,YWORK,1)),Y,9),"""")=$TRANSLATE(YAUF_","_YPOS_","_ARTT,"""") KILL ^INPROSTEMPT(YM,YSTEMPEL,YWORK,1)  ;AUSFÜHRUNG BEREITS GEDRUCKT ;execution yet 
	. ;
	. DO SUBFILE(YAUF,YPOS,$TRANSLATE(ARTT,",",".")_".","KILL")  ;SICHERN UND LÖSCHEN WICHTIGE UNTERDATEIEN;FIS;12.01.04;24921
	. ;
	. IF $PIECE(YFUNCT1,",",2)=1 DO        ;BESTAND SOLL ÄNDER. PROTOKOLL     FAN 11.09.02 ;protocol buff 
	. . NEW YFELD,SATZ
	. . SET YFELD=$GET(@DATEI)
	. . SET $PIECE(SATZ,Y,1)=YAUF
	. . SET $PIECE(SATZ,Y,2)=YPOS
	. . SET $PIECE(SATZ,Y,3)=ARTT
	. . SET $PIECE(SATZ,Y,4)=$PIECE(YFELD,Y,4)       ;ARTIKEL NUMMER ;item numeral 
	. . SET $PIECE(SATZ,Y,5)=$PIECE(YFELD,Y,1)       ;ARTIKEL BEZEICHNUNG ;item notation 
	. . SET $PIECE(SATZ,Y,6)=$PIECE(YFELD,Y,39)      ;PRODUKTIONSMENGE
	. . SET $PIECE(SATZ,Y,7)=$PIECE(YFELD,Y,40)      ;MENGE EINHEIT ;quantity unit
	. . SET $PIECE(SATZ,Y,8)=$PIECE(YFELD,Y,165)     ;FERTIGUNGSNUMMER
	. . IF $PIECE(SATZ,Y,4)'="" SET $PIECE(SATZ,Y,9)=$$^INARTMENGE($PIECE(SATZ,Y,4))     ;ARTIKEL BESTAND ;item 
	. . SET ^INAUFPTPROTO(YM,+$HOROLOG,$PIECE($HOROLOG,",",2),YBED,1)=SATZ
	. ;
	. IF $PIECE($GET(^INVORG(YM,YM,1)),Y,70)=1 DO  ;BEDARF AUS DRP LÖSCHEN ;out of DRP Delete 
	. . NEW LENGTH,DATEIX,BETRIEB,DEMAND
	. . SET BETRIEB=$PIECE($GET(^INAUF(YM,YAUF,1)),Y,6)
	. . IF BETRIEB="" SET BETRIEB=$GET(YLOCATION)
	. . QUIT:BETRIEB=""
	. . SET SUCH=DATEI
	. . FOR  DO  QUIT:SUCH=""
	. . . SET SUCH=$QUERY(@SUCH)
	. . . IF $TRANSLATE($PIECE(SUCH,",",2),"""")'=YAUF SET SUCH="" QUIT  ;FALSCHER AUFTRAG ;07.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. . . ;IF $PIECE(SUCH,",",2)'=YAUF SET SUCH="" QUIT  ;07.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. . . IF $PIECE(SUCH,",",3)'=YPOS SET SUCH="" QUIT  ;FALSCHE POSITION
	. . . SET LENGTH=$QLENGTH(DATEI)
	. . . SET DATEIX=$PIECE($PIECE($PIECE(DATEI,"(",2),")",1),",",3,LENGTH)  ;NUR TEILEKEY ;only 
	. . . IF $PIECE($PIECE($PIECE(SUCH,")",1),"(",2),",",3,LENGTH)'=DATEIX SET SUCH="" QUIT  ;FALSCHES TEIL ;part 
	. . . IF $PIECE(@SUCH,Y,200)'="" DO  ;UNTERTEILE
	. . . . NEW SATZ,YFORM,YVOR,YOK
	. . . . SET DEMAND=$PIECE(@SUCH,Y,200)
	. . . . QUIT:DEMAND=""
	. . . . SET SATZ=$GET(^INDRPDEMAND(YM,BETRIEB,DEMAND,1))
	. . . . QUIT:SATZ=""
	. . . . SET $PIECE(SATZ,Y,98)=1  ;VORGANG GELÖSCHT
	. . . . SET $PIECE(SATZ,Y,72)=""  ;TEILE-EINTRAG
	. . . . SET $PIECE(SATZ,Y,115)=$$^WWWTEXT(33693)  ;UNTERTEIL AUS TEILESTRUKTUR GELÖSCHT ;out of 
	. . . . SET YOK=$$^WWWSPEI("INDRPDEMAND",BETRIEB_","_DEMAND,SATZ,1)  ;FIS;04.12.03
	. . . . ;DO ^WWWSKILL("INDRPDEMAND",BETRIEB_","_DEMAND,1)  ;LÖSCHEN SORTKEY
	. . . . ;SET $PIECE(^INDRPDEMAND(YM,BETRIEB,DEMAND,1),Y,98)=1  ;VORGANG GELÖSCHT
	. . . . ;SET $PIECE(^INDRPDEMAND(YM,BETRIEB,DEMAND,1),Y,72)=""  ;TEILESTRUKTUR-EINTRAG
	. . . . ;DO ^WWWSSORT("INDRPDEMAND",BETRIEB_","_DEMAND)  ;AUFBEREITEN SORTKEY
	. . ;
	. . IF $PIECE(@DATEI,Y,200)'="" DO  ;HAUPTTEIL
	. . . NEW SATZ,YFORM,YVOR,YOK
	. . . SET DEMAND=$PIECE(@DATEI,Y,200)
	. . . QUIT:DEMAND=""
	. . . SET SATZ=$GET(^INDRPDEMAND(YM,BETRIEB,DEMAND,1))
	. . . QUIT:SATZ=""
	. . . SET $PIECE(SATZ,Y,98)=1  ;VORGANG GELÖSCHT
	. . . SET $PIECE(SATZ,Y,72)=""  ;TEILE-EINTRAG
	. . . SET $PIECE(SATZ,Y,115)=$$^WWWTEXT(33693)  ;UNTERTEIL AUS TEILESTRUKTUR GELÖSCHT ;out of 
	. . . SET YOK=$$^WWWSPEI("INDRPDEMAND",BETRIEB_","_DEMAND,SATZ,1)  ;FIS;04.12.03
	. . . ;DO ^WWWSKILL("INDRPDEMAND",BETRIEB_","_DEMAND,1)  ;LÖSCHEN SORTKEY
	. . . ;SET $PIECE(^INDRPDEMAND(YM,BETRIEB,DEMAND,1),Y,98)=1  ;VORGANG GELÖSCHT
	. . . ;SET $PIECE(^INDRPDEMAND(YM,BETRIEB,DEMAND,1),Y,72)=""  ;TEILESTRUKTUR-EINTRAG
	. . . ;DO ^WWWSSORT("INDRPDEMAND",BETRIEB_","_DEMAND)  ;AUFBEREITEN SORTKEY
	. ;
	. KILL @DATEI  ;LÖSCHEN DATEN TEILESTUKTUR ;Delete 
	. KILL ^WWWSOR(YUSER_ADDON,"NEU")
	. DO NEU  ;NEUAUFBAU
	
	IF YFUNCT1="UP" DO   ;EINE POSITION HERAUF ;one upwards 
	. NEW YZWS,YMOVE
	. SET YYMAX=1
	. SET YMOVE=1
	. QUIT:YAUF=""
	. QUIT:YPOS=""
	. QUIT:ARTT=""
	. ;
	. ; DATEI ORIGINAL ;data file 
	. SET DATEI="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  SET DATEI=DATEI_","_$PIECE(ARTT,",",YI) SET YYMAX=YI
	. SET DATEI=DATEI_")"
	. ;
	. IF $PIECE(ARTT,",",YYMAX)<2 QUIT  ;ZU HOCH ;within towering 
	. ;
	. ;DATEI ZWISCHENSICHERN ;data file 
	. SET DATEI1="^WWWSOR("_""""_YUSER_ADDON_""""_","_""""_"HELP"_""""_","_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  DO
	. . IF YI'=YYMAX SET DATEI1=DATEI1_","_$PIECE(ARTT,",",YI)
	. . ;IF YI=YYMAX SET DATEI1=DATEI1_","_($PIECE(ARTT,",",YI)-1)  ;LETZTE -1 ;last 
	. . IF YI=YYMAX DO  ;FIS;02.11.04;26453;POSITIONEN MIT GEDRUCKTER FERTIGUNGSANWESIUNG ÜBERSPRINGEN
	. . . NEW DATEIX
	. . . SET DATEIX=$PIECE(DATEI,",",1)_","_$PIECE(DATEI1,",",4,99)
	. . . IF $PIECE($GET(@(DATEIX_","_$PIECE(ARTT,",",YI)_")")),Y,165)'="" SET DATEI1="" QUIT  ;FIS;29.11.04
	. . . FOR  QUIT:$PIECE($GET(@(DATEIX_","_($PIECE(ARTT,",",YI)-YMOVE)_")")),Y,165)=""  SET YMOVE=YMOVE+1 
	. . . SET DATEI1=DATEI1_","_($PIECE(ARTT,",",YI)-YMOVE)  ;LETZTE -1 ;last
	. . . IF ($PIECE(ARTT,",",YI)-YMOVE)<1 SET DATEI1=""
	. ;
	. QUIT:DATEI1=""  ;FIS;02.11.04;26453
	. SET DATEI1=DATEI1_")"
	. SET YSTEMPEL=$PIECE($GET(@DATEI),Y,165)
	. ;SET $PIECE(@DATEI,Y,165)=""
	. ;IF YSTEMPEL'="" DO  ;TYBD 21.12.2001
	. ;. KILL ^INPROSTEMP(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMP0(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMP1(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMPT(YM,YSTEMPEL)
	. DO SUBFILE(YAUF,YPOS,$TRANSLATE(ARTT,",",".")_".","UP",YMOVE)  ;SICHERN UND LÖSCHEN WICHTIGE UNTERDATEIEN;FIS;12.01.04;24921
	. ;
	. MERGE @DATEI1=@DATEI
	. KILL @DATEI  ;LÖSCHEN DATEN ALTE TEILESTUKTUR ;Delete 
	. ;DATEI ORIGINAL 2 ;data file 
	. SET DATEI2="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  DO
	. . IF YI'=YYMAX SET DATEI2=DATEI2_","_$PIECE(ARTT,",",YI)
	. . ;IF YI=YYMAX SET DATEI2=DATEI2_","_($PIECE(ARTT,",",YI)-1)  ;LETZTE -1 ;last 
	. . IF YI=YYMAX SET DATEI2=DATEI2_","_($PIECE(ARTT,",",YI)-YMOVE)  ;LETZTE -n ;last ;FIS;02.11.04;26453
	. ;
	. SET DATEI2=DATEI2_")"
	. ;DATEI ZWISCHENSICHERN ;data file 
	. SET DATEI3="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  DO
	. . SET DATEI3=DATEI3_","_$PIECE(ARTT,",",YI)
	. ;
	. SET DATEI3=DATEI3_")"
	. SET YSTEMPEL=$PIECE($GET(@DATEI2),Y,165)
	. ;SET $PIECE(@DATEI2,Y,165)=""
	. ;IF YSTEMPEL'="" DO  ;TYBD 21.12.2001 (WENN VERSCHOBEN, DANN NICHT LÖSCHEN
	. ;. KILL ^INPROSTEMP(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMP0(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMP1(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMPT(YM,YSTEMPEL)
	. IF $TRANSLATE($GET(@DATEI2),Y_3)'="" MERGE @DATEI3=@DATEI2   ;EINEN HERUNTER
	. KILL @DATEI2  ;LÖSCHEN DATEN ALTE TEILESTUKTUR ;Delete 
	. IF $TRANSLATE($GET(@DATEI1),Y_3)'="" MERGE @DATEI2=@DATEI1
	. KILL @DATEI1
	. DO NEU  ;NEUAUFBAU
	
	IF YFUNCT1="DOWN" DO   ;EINE POSITION HERUNTER ;one 
	. NEW YMOVE
	. SET YYMAX=1
	. SET YMOVE=1
	. QUIT:YAUF=""
	. QUIT:YPOS=""
	. QUIT:ARTT=""
	. ;
	. ;DATEI ORIGINAL ;data file 
	. SET DATEI="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  SET DATEI=DATEI_","_$PIECE(ARTT,",",YI) SET YYMAX=YI
	. SET DATEI=DATEI_")"
	. ;DATEI ZWISCHENSICHERN ;data file 
	. SET DATEI1="^WWWSOR("_""""_YUSER_ADDON_""""_","_""""_"HELP"_""""_","_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  DO
	. . IF YI'=YYMAX SET DATEI1=DATEI1_","_$PIECE(ARTT,",",YI)
	. . ;IF YI=YYMAX SET DATEI1=DATEI1_","_($PIECE(ARTT,",",YI)+1)  ;LETZTE +1 ;last 
	. . IF YI=YYMAX DO  ;FIS;02.11.04;26453;POSITIONEN MIT GEDRUCKTER FERTIGUNGSANWESIUNG ÜBERSPRINGEN
	. . . NEW DATEIX
	. . . SET DATEIX=$PIECE(DATEI,",",1)_","_$PIECE(DATEI1,",",4,99)
	. . . IF $PIECE($GET(@(DATEIX_","_$PIECE(ARTT,",",YI)_")")),Y,165)'="" SET DATEI1="" QUIT  ;FIS;29.11.04
	. . . FOR  QUIT:$PIECE($GET(@(DATEIX_","_($PIECE(ARTT,",",YI)+YMOVE)_")")),Y,165)=""  SET YMOVE=YMOVE+1 
	. . . SET DATEI1=DATEI1_","_($PIECE(ARTT,",",YI)+YMOVE)  ;LETZTE -1 ;last
	. ;
	. QUIT:DATEI1=""  ;FIS;29.11.04;26453
	. SET DATEI1=DATEI1_")"
	. SET YSTEMPEL=$PIECE($GET(@DATEI),Y,165)
	. ;SET $PIECE(@DATEI,Y,165)=""  ;TYBD 21.12.2001
	. ;IF YSTEMPEL'="" DO
	. ;. KILL ^INPROSTEMP(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMP0(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMP1(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMPT(YM,YSTEMPEL)
	. DO SUBFILE(YAUF,YPOS,$TRANSLATE(ARTT,",",".")_".","DOWN",YMOVE)  ;SICHERN UND LÖSCHEN WICHTIGE UNTERDATEIEN;FIS;12.01.04;24921
	. MERGE @DATEI1=@DATEI
	. KILL @(DATEI)  ;LÖSCHEN DATEN ALTE TEILESTUKTUR ;Delete 
	. ;DATEI ORIGINAL 2 ;data file 
	. SET DATEI2="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  DO
	. . IF YI'=YYMAX SET DATEI2=DATEI2_","_$PIECE(ARTT,",",YI)
	. . ;IF YI=YYMAX SET DATEI2=DATEI2_","_($PIECE(ARTT,",",YI)+1)  ;LETZTE +1 ;last 
	. . IF YI=YYMAX SET DATEI2=DATEI2_","_($PIECE(ARTT,",",YI)+YMOVE)  ;LETZTE +n ;last ;FIS;02.11.04;26453
	. . QUIT
	. SET DATEI2=DATEI2_")"
	. ;DATEI ZWISCHENSICHERN ;data file 
	. SET DATEI3="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  DO
	. . SET DATEI3=DATEI3_","_$PIECE(ARTT,",",YI)
	. . QUIT
	. SET DATEI3=DATEI3_")"
	. SET YSTEMPEL=$PIECE($GET(@DATEI2),Y,165)
	. ;SET $PIECE(@DATEI2,Y,165)=""  ;TYBD 21.12.2001
	. ;IF YSTEMPEL'="" DO
	. ;. KILL ^INPROSTEMP(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMP0(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMP1(YM,YSTEMPEL)  
	. ;. KILL ^INPROSTEMPT(YM,YSTEMPEL)
	. IF $TRANSLATE($GET(@(DATEI2)),Y_3)'="" MERGE @DATEI3=@DATEI2   ;EINEN HERUNTER
	. KILL @DATEI2  ;LÖSCHEN DATEN ALTE TEILESTUKTUR ;Delete 
	. IF $TRANSLATE($GET(@(DATEI1)),Y_3)'="" MERGE @DATEI2=@DATEI1
	. KILL @DATEI1
	. DO NEU  ;NEUAUFBAU
	
	IF YAUF'="" IF YPOS'="" DO NEU   ;NEUAUFBAU
	
	QUIT:$GET(YSONDERFUNKTION)=1  ;SONDERFUNKTIONSAUFRUF AUS INAUFPTT2 ;out of 
	
	SET YFORM="INAUFPTT1"
	SET %(YQUERY,"YFORM")=YFORM
	SET %("VAR","YFORM")=YFORM
	DO ^WWWFORM
	QUIT
	
PROCZ ;BEARBEITUNG DER FUNKTIONEN BEI BUTTON AUF AB UND LÖSCHEN  FÜR ZEICHNUNGSPOSITIONEN ;adaptation the next to upon Confirm. And Delete to 
	NEW YI,DATEI
	
	SET YFUNCT1 = $GET(%(YQUERY,"YFUNCT1"))  ;FUNKTION (UP DOWN KILL)
	SET YPARA1  = $GET(%(YQUERY,"YPARA1"))   ;ARTIKEL UND TEILENUMMER ;item And 
	SET YAUF	= $PIECE(YPARA1,",",1)
	SET YPOS	= $PIECE(YPARA1,",",2)
	SET ARTT	= $TRANSLATE($PIECE(YPARA1,",",3,99),"."_"""",",")  ;TEILE AUS INAUFPXL ;out of 
	FOR  QUIT:$EXTRACT(ARTT)'=","  SET ARTT=$EXTRACT(ARTT,2,99)     ;KOMMA HERAUSFILTERN ;comma 
	
	IF YFUNCT1="UP" DO   ;EINE POSITION HERAUF ;one upwards 
	. IF YAUF'="" IF YPOS'="" IF ARTT'="" DO
	. . SET DATEI="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. . FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  SET DATEI=DATEI_","_$PIECE(ARTT,",",YI)
	. . SET DATEI=DATEI_")"
	. . SET YI=$PIECE($GET(@DATEI),Y,18)
	. . SET YI=YI+1
	. . SET $PIECE(@DATEI,Y,18)=YI
	
	IF YFUNCT1="DOWN" DO   ;EINE POSITION HERUNTER ;one 
	. IF YAUF'="" IF YPOS'="" IF ARTT'="" DO
	. . SET DATEI="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS
	. . FOR YI=1:1 QUIT:$PIECE(ARTT,",",YI)=""  SET DATEI=DATEI_","_$PIECE(ARTT,",",YI)
	. . SET DATEI=DATEI_")"
	. . SET YI=$PIECE($GET(@DATEI),Y,18)
	. . SET YI=YI-1
	. . IF YI<1 SET YI=""
	. . SET $PIECE(@DATEI,Y,18)=YI
	
	SET YFORM="INAUFPTT1"
	SET %(YQUERY,"YFORM")=YFORM
	SET %("VAR","YFORM")=YFORM
	DO ^WWWFORM
	QUIT
	
NEU ;NEU AUFBAU DER INAUFPT  (EINSPRUNG VON AUSSEN) ;recent the 
	NEW SUCH,SUCH1,YYI,BETRIEB
	
	SET SUCH="^INAUFPXL("_""""_YM_""""_","_""""_YAUF_""""_","_"-1"_")"
	KILL ^INAUFPT(YM,YAUF,YPOS)
	FOR  DO  QUIT:SUCH=""
	. SET SUCH=$QUERY(@SUCH)
	. IF $TRANSLATE($PIECE(SUCH,",",2),"""")'=YAUF SET SUCH="" QUIT  ;07.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. ;IF $PIECE(SUCH,",",2)'=YAUF SET SUCH="" QUIT  ;07.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. IF $PIECE(SUCH,",",3)=YPOS DO
	. . SET SUCH1=@SUCH
	. . SET SUCH(1)=$PIECE($PIECE(SUCH,")",1),",",4,99)
	. . SET SUCH(0)=$LENGTH(SUCH(1),",")  ;ANZAHL DER ,
	. . ;
	. . ;RUESTZEIT NUR BEI LEISTUNGEN GÜLTIG;FIS;25.05.04;25780
	. . IF +$PIECE(SUCH1,Y,70)'=0 IF $DATA(@SUCH)'=11 DO  ;KEINE UNTERTEILE ;no 
	. . . IF $PIECE(SUCH1,Y,40)'=2 IF $PIECE(SUCH1,Y,40)'=10 IF $PIECE(SUCH1,Y,40)'=11 SET $PIECE(SUCH1,Y,70)=""  ;KEINE LEISTUNG=KEINE RÜSTZEIT ;no setup time 
	. . ;
	. . ;BERECHNEN DER BENÖTIGTEN MENGE ;calculate the quantity 
	. . SET SUCH(3)=$PIECE($GET(^INAUFP(YM,YAUF,YPOS,1)),Y,5)  ;BASISMENGE
	. . SET SUCH("M",+SUCH(0))=$PIECE(SUCH1,Y,5)
	. . FOR YYI=1:1:SUCH(0) IF +$GET(SUCH("M",YYI))'=0 SET SUCH(3)=SUCH(3)*$GET(SUCH("M",YYI))
	. . SET $PIECE(SUCH1,Y,39)=SUCH(3)   ;MENGE FÜR PRODUKTION ;quantity to production 
	. . ;
	. . SET SUCH(2)=""
	. . FOR YYI=1:1:SUCH(0) SET SUCH(2)=SUCH(2)_$PIECE(SUCH(1),",",YYI)_"."
	. . SET ^INAUFPT(YM,YAUF,YPOS,SUCH(2),1)=SUCH1
	. . SET @SUCH=SUCH1
	. . SET BETRIEB=$PIECE($GET(^INAUF(YM,YAUF,1)),Y,6)
	. . IF BETRIEB="" SET BETRIEB=YLOCATION
	. . IF $PIECE(SUCH1,Y,200)'="" IF $DATA(^INDRPDEMAND(YM,BETRIEB,$PIECE(SUCH1,Y,200),1)) do
	. . . ;TEILESTRUKTUR NACH DRP ÜBERTRAGEN ;within DRP transport 
	. . . SET $PIECE(^INDRPDEMAND(YM,BETRIEB,$PIECE(SUCH1,Y,200),1),Y,72)=YAUF_"."_YPOS_"."_SUCH(2)   ; SR15333
	
	QUIT
	
SUBFILE(YAUF,YPOS,YTEIL,YACTION,YMOVE)	  ;SICHERN UND LÖSCHEN WICHTIGE UNTERDATEIEN;FIS;12.01.04;24921
	NEW TEILEKEY,TEILEKEY1,YI,YTEIL1,DATEI
	
	SET YAUF  = $GET(YAUF)            QUIT:YAUF=""
	SET YPOS  = $GET(YPOS)            QUIT:YPOS=""
	SET YTEIL = $GET(YTEIL)           QUIT:YTEIL=""
	
	SET YACTION = $GET(YACTION)
	SET YMOVE   = $GET(YMOVE)
	IF +YMOVE=0 SET YMOVE = 1
	
	IF YACTION="KILL" DO  QUIT
	. FOR TEILEKEY=YTEIL,"" DO  ;SELBST + UNTERTEILE ;self 
	. . DO:TEILEKEY'=""  IF TEILEKEY="" SET TEILEKEY=YTEIL FOR  SET TEILEKEY=$ORDER(^INAUFPT(YM,YAUF,YPOS,TEILEKEY)) QUIT:TEILEKEY=""  QUIT:$EXTRACT(TEILEKEY,1,$LENGTH(YTEIL))'=YTEIL  DO
	. . . MERGE ^INXAUFPTEXTRA(YM,YAUF,YPOS,TEILEKEY)  = ^INAUFPTEXTRA(YM,YAUF,YPOS,TEILEKEY)
	. . . DO ^WWWSKILL("INAUFPTEXTRA",YAUF_","_YPOS_","_TEILEKEY)   ;LÖSCHEN ZUSATZKOSTEN ;Delete additional costs 
	. . . ;
	. . . MERGE ^INXAUFPTEXTRAW(YM,YAUF,YPOS,TEILEKEY) = ^INAUFPTEXTRAW(YM,YAUF,YPOS,TEILEKEY)
	. . . DO ^WWWSKILL("INAUFPTEXTRAW",YAUF_","_YPOS_","_TEILEKEY)  ;WERKZEUGKOSTEN
	. . . ;
	. . . MERGE ^INXAUFPTEXTRAE(YM,YAUF,YPOS,TEILEKEY) = ^INAUFPTEXTRAE(YM,YAUF,YPOS,TEILEKEY)
	. . . DO ^WWWSKILL("INAUFPTEXTRAE",YAUF_","_YPOS_","_TEILEKEY)  ;EXTRAKOSTEN
	. . . ;
	. . . MERGE ^INXAUFPTEXTRAV(YM,YAUF,YPOS,TEILEKEY) = ^INAUFPTEXTRAV(YM,YAUF,YPOS,TEILEKEY)
	. . . DO ^WWWSKILL("INAUFPTEXTRAV",YAUF_","_YPOS_","_TEILEKEY)  ;VERSCHNITT
	. . . ;
	. . . MERGE ^INXAUFPTSN(YM,YAUF,YPOS,TEILEKEY)     = ^INAUFPTSN(YM,YAUF,YPOS,TEILEKEY)
	. . . DO ^WWWSKILL("INAUFPTSN",YAUF_","_YPOS_","_TEILEKEY)      ;SN-ZUORDNUNG
	. . . ;
	. . . MERGE ^INXWEAUFPT(YM,YAUF,YPOS,TEILEKEY)     = ^INWEAUFPT(YM,YAUF,YPOS,TEILEKEY)
	. . . DO ^WWWSKILL("INWEAUFPT",YAUF_","_YPOS_","_TEILEKEY)      ;ENTNAHME-LAGERPLÄTZE
	
	;---------------------------------------
	
	SET YTEIL1=""  ;ERMITTELN NEUER KEY ;find KEY 
	FOR YI(1)=1:1  QUIT:$PIECE(YTEIL,".",YI(1),999)=""  SET YI(2)=$PIECE(YTEIL,".",YI(1)) DO
	. ;IF $PIECE(YTEIL,".",YI(1)+1)="" IF YACTION="UP" SET YI(2)=YI(2)-1
	. ;IF $PIECE(YTEIL,".",YI(1)+1)="" IF YACTION="DOWN" SET YI(2)=YI(2)+1
	. IF $PIECE(YTEIL,".",YI(1)+1)="" IF YACTION="UP"   SET YI(2)=YI(2)-YMOVE  ;FIS;02.11.04;26453;POSITIONEN MIT GEDRUCKTER FERTIGUNGSANWESIUNG ÜBERSPRINGEN
	. IF $PIECE(YTEIL,".",YI(1)+1)="" IF YACTION="DOWN" SET YI(2)=YI(2)+YMOVE  ;FIS;02.11.04;26453
	. SET YTEIL1=YTEIL1_YI(2)_"."
	
	FOR DATEI="INAUFPTEXTRA","INAUFPTEXTRAW","INAUFPTEXTRAE","INAUFPTEXTRAV","INAUFPTSN" DO
	. ;
	. ;SICHERN WERTE ALTE ZEILE ;safeguard 
	. SET DATEI(1)="^"_DATEI_"("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS_",TEILEKEY)"
	. SET TEILEKEY=$ORDER(^INAUFPT(YM,YAUF,YPOS,YTEIL1),-1)
	. FOR  SET TEILEKEY=$ORDER(@DATEI(1))  QUIT:TEILEKEY=""  QUIT:$EXTRACT(TEILEKEY,1,$LENGTH(YTEIL1))'=YTEIL1  DO
	. . SET TEILEKEY1=YTEIL_$EXTRACT(TEILEKEY,$LENGTH(YTEIL1)+1,99)
	. . SET DATEI(2)="^WWWSOR("_""""_YUSER_ADDON_""""_","_""""_"SUB"_""""_","_""""_TEILEKEY1_""""_")"
	. . MERGE @DATEI(2)=@DATEI(1)   ;ZWISCHENSPEICHERN ALTE ZEILE
	. . DO ^WWWSKILL(DATEI,YAUF_","_YPOS_","_TEILEKEY)    ;LÖSCHEN ALTE ZEILE ;Delete 
	. ;
	. ;SICHERN WERTE NEUE ZEILE ;safeguard 
	. SET DATEI(1)="^"_DATEI_"("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS_",TEILEKEY)"
	. SET TEILEKEY=$ORDER(^INAUFPT(YM,YAUF,YPOS,YTEIL),-1)
	. FOR  SET TEILEKEY=$ORDER(@DATEI(1))  QUIT:TEILEKEY=""  QUIT:$EXTRACT(TEILEKEY,1,$LENGTH(YTEIL))'=YTEIL  DO
	. . SET TEILEKEY1=YTEIL1_$EXTRACT(TEILEKEY,$LENGTH(YTEIL)+1,99)
	. . SET DATEI(2)="^WWWSOR("_""""_YUSER_ADDON_""""_","_""""_"SUB"_""""_","_""""_TEILEKEY1_""""_")"
	. . MERGE @DATEI(2)=@DATEI(1)   ;ZWISCHENSPEICHERN ALTE ZEILE
	. . DO ^WWWSKILL(DATEI,YAUF_","_YPOS_","_TEILEKEY)    ;LÖSCHEN ALTE ZEILE ;Delete 
	. ;
	. ;RÜCKHOLEN ZWISCHENGESPEICHERTE WERTE
	. SET DATEI(1)="^WWWSOR("_""""_YUSER_ADDON_""""_","_""""_"SUB"_""""_",TEILEKEY)"
	. SET TEILEKEY=""
	. FOR  SET TEILEKEY=$ORDER(@DATEI(1))  QUIT:TEILEKEY=""  DO
	. . SET DATEI(2)="^"_DATEI_"("_""""_YM_""""_","_""""_YAUF_""""_","_YPOS_","_""""_TEILEKEY_""""_")"
	. . MERGE @DATEI(2)=@DATEI(1)   ;SPEICHERN ALTE WERTE AUF NEUE ZEILE ;Save upon 
	. . DO ^WWWSSORT(DATEI,YAUF_","_YPOS_","_TEILEKEY)      ;SORTKEY AUFBEREITEN
	. . KILL @DATEI(1)  ;LÖSCHEN ZWISCHENDATEI ;Delete 
	
	QUIT
	
LIST(YKEY) ;LISTE DER AUFTRAGSTEILE ;List the order parts
	NEW YLISTEN
	
	SET YLISTEN=1
	DO
	. NEW YFORM
	. DO ^WWWBACK
	
	DO ^INAUFPTT
	QUIT
	
]]></Routine>
</Export>