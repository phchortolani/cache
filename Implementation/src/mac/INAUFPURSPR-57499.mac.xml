<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFPURSPR" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFPURSPR(YK)
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		ARTIKEL URSPRUNGS-AUFTRAG ANZEIGEN
	;
	; Inputs : 
	;	YK=AUSWAHL AUFTRAG(1) / POSITION(2) / AUFTRAG~POSITION(3)	;|
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 29-Dec-2006	GRF		SR15333: Naked References; quits; expand commands
	; 23.08.2001	FIS
	;-------------------------------------------------------------------------------
	NEW AUF,POS,WE1,BET,LAP,WE,XAUF,XPOS,XYFELD
	
	SET YKEY=$GET(YKEY)
	IF YKEY="" SET YKEY=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"P",1))
	SET AUF=$PIECE(YKEY,",",1)         QUIT:AUF=""
	SET POS=$PIECE(YKEY,",",2)         QUIT:POS=""
	
	SET YFELD=$GET(YFELD)
	IF YFELD="" SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"D",1))
	IF YFELD="" SET YFELD=$GET(^INAUFP(YM,AUF,POS,1))
	SET YINHALT=""
	
	;REKLAMATIOANSAUFTRÄGE
	;	D237		$$$INAUFPOrderNo1()
	;	D238		$$$INAUFPLineItem2()
	IF $PIECE(YFELD,Y,237)'="" IF $PIECE(YFELD,Y,238)'="" DO
	. IF $DATA(^INAUFP(YM,$PIECE(YFELD,Y,237),$PIECE(YFELD,Y,238),1)) DO
	. . SET XYFELD=$get(^INAUFP(YM,$PIECE(YFELD,Y,237),$PIECE(YFELD,Y,238),1))           ; SR15333
	. . ;QUIT:$PIECE(XYFELD,Y,4)'=$PIECE(YFELD,Y,4)  ;FALSCHER ARTIKEL
	. . SET AUF=$PIECE(YFELD,Y,237)
	. . SET POS=$PIECE(YFELD,Y,238)
	
	;SUCHEN URSPRUNGSAUFTRAG AUS LAGERPLATZ ;seek out of stock location 
	SET YK=$GET(YK)
	QUIT:+YK=0 
	SET WE1=""
	IF $DATA(^INWEAUF(YM,AUF,POS)) DO
	. SET BET=""
	. FOR  SET BET=$ORDER(^INWEAUF(YM,AUF,POS,BET)) QUIT:BET=""  DO  QUIT:WE1'=""
	. . SET LAP=""
	. . FOR  SET LAP=$ORDER(^INWEAUF(YM,AUF,POS,BET,LAP)) QUIT:LAP=""  DO  QUIT:WE1'=""
	. . . SET WE=""
	. . . FOR  SET WE=$ORDER(^INWEAUF(YM,AUF,POS,BET,LAP,WE)) QUIT:WE=""  DO  QUIT:WE1'=""
	. . . . SET WE1=$GET(^INWEAUF(YM,AUF,POS,BET,LAP,WE,1))
	
	IF WE1="" IF $DATA(^INWEAUFALT(YM,AUF,POS)) DO 
	. SET BET=""
	. FOR  SET BET=$ORDER(^INWEAUFALT(YM,AUF,POS,BET)) QUIT:BET=""  DO  QUIT:WE1'=""
	. . SET LAP=""
	. . FOR  SET LAP=$ORDER(^INWEAUFALT(YM,AUF,POS,BET,LAP)) QUIT:LAP=""  DO  QUIT:WE1'=""
	. . . SET WE=""
	. . . FOR  SET WE=$ORDER(^INWEAUFALT(YM,AUF,POS,BET,LAP,WE)) QUIT:WE=""  DO  QUIT:WE1'=""
	. . . . SET WE1=$GET(^INWEAUFALT(YM,AUF,POS,BET,LAP,WE,1))
	
	IF WE1'="" DO
	. SET XAUF=$PIECE(WE1,Y,28)  ;AUFTRAG ;order 
	. QUIT:XAUF=""
	. SET XPOS=$PIECE(WE1,Y,29)  ;POSITION
	. QUIT:XPOS=""
	. QUIT:'$DATA(^INAUF(YM,XAUF))
	. QUIT:'$DATA(^INAUFP(YM,XAUF,XPOS))  ;FIS;07.01.04
	. ;
	. IF YK=1 SET YINHALT=XAUF QUIT  ;AUFTRAG ;mandate  ;order 
	. IF YK=3 SET YINHALT=XAUF_Y_XPOS QUIT  ;AUFTRAG~POSITION
	. SET YINHALT=XPOS  ;POSITION
	
	;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv Disabled Block start
	;;IF YINHALT="" IF $PIECE(YFELD,Y,5)<0 DO  ;STORNO-AUFTRÄGE  ;FIS;29.06.04;26006
	. IF YK=1 SET YINHALT=$PIECE(YFELD,Y,201) QUIT  ;AUFTRAG ;mandate  ;order 
	. IF YK=3 SET YINHALT=$PIECE(YFELD,Y,201)_Y_$PIECE(YFELD,Y,202) QUIT  ;AUFTRAG~POSITION
	. SET YINHALT=$PIECE(YFELD,Y,202)  ;POSITION
	;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Disabled block end
	QUIT
	
LINK ;LINK ZU URSPRUNGSAUFTRAG  ---  EINSPRUNG AUS FORMULAR !!!
	NEW YINHALT,XYKEY
	
	DO ^INAUFPURSPR(3)
	IF $GET(YINHALT)="" QUIT
	IF $PIECE(YINHALT,Y,1)'="" IF $PIECE(YINHALT,Y,2)'="" IF $DATA(^INAUFP(YM,$PIECE(YINHALT,Y,1),$PIECE(YINHALT,Y,2))) DO
	. SET XYKEY=YKEY
	. DO
	. . NEW YKEY,YFORM,YBACK,YFKEY,YOPEN
	. . WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INAUFP&YKEY="_$PIECE(YINHALT,Y,1)_","_$PIECE(YINHALT,Y,2)  ;_"&YFKEY="_$PIECE(YINHALT,Y,1)_"&YBACK=INAUF,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . ;WRITE " TITLE="_""""_$$^WWWTEXT(32982)_""""  ;URSPRUNGSAUFTRAG ANZEIGEN
	. . WRITE ">"
	. ;
	. WRITE "<img src="_YGIF_"eigen.gif border=0 ALIGN=ABSBOTTOM TITLE="_""""_$$^WWWTEXT(32982)_""""_">"  ;URSPRUNGSAUFTRAG ANZEIGEN ;display 
	. WRITE "</A>"
	
	QUIT
]]></Routine>
</Export>