<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFPTEXTRA" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFPTEXTRA ;INAUFPTEXTRA;FIS;RECHNEN EXTRAKOSTEN;06.12.2002
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		RECHNEN EXTRAKOSTEN
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FIS	06.12.2002
	;|
	;\------------------------------------------------------------------/
	;
	
NEU ;NEURECHNEN FELDER IN FORMULAR ;within form 
	NEW YFELD,YKEY
	SET YKEY=$GET(^WWWDATEN(YM,+$H,YUSER,"INAUFPTEXTRA","P",1))
	SET YFELD=$GET(^WWWDATEN(YM,+$H,YUSER,"INAUFPTEXTRA","D",1))
	QUIT:YFELD=""
	DO SET^INAUFPTEXTRA
	SET %TXT(1)=$GET(%TXT(1))
	SET %TXT(1)=%TXT(1)_"#YINAUFPTEXTRAD1~"_$$^WWWZAHL($PIECE(YFELD,Y,1),0,2)  ;WERKZEUGKOSTEN
	SET %TXT(1)=%TXT(1)_"#YINAUFPTEXTRAD3~"_$$^WWWZAHL($PIECE(YFELD,Y,3),0,2)  ;EXTRAKOSTEN
	SET %TXT(1)=%TXT(1)_"#YINAUFPTEXTRAD5~"_$$^WWWZAHL($PIECE(YFELD,Y,5),0,2)  ;VERSCHNITT
	SET %TXT(1)=%TXT(1)_"#YINAUFPTEXTRAD11~"_$$^WWWZAHL($PIECE(YFELD,Y,11),0,2)  ;SUMME ;sum 
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,"INAUFPTEXTRA","D",1)=YFELD
	QUIT
	
SET ;SETZTEN WERTE
	NEW AUF,POS,TEIL,KOST
	SET AUF=$PIECE($GET(YKEY),",",1)
	QUIT:AUF=""
	SET POS=$PIECE($GET(YKEY),",",2)
	QUIT:POS=""
	SET TEIL=$PIECE($GET(YKEY),",",3)
	QUIT:TEIL=""
	IF YFORM'="INAUFPTEXTRA" NEW YFELD SET YFELD=$GET(^INAUFPTEXTRA(YM,AUF,POS,TEIL,1))  ;EINSPRUNG !!
	QUIT:$GET(YFELD)=""
	SET KOST(1)=$PIECE(YFELD,Y,1)
	IF $PIECE(YFELD,Y,2)=1 DO  ;RECHNEN WERKZEUGKOSTEN ;have faith in 
	. NEW LFN
	. SET KOST(1)=0
	. SET LFN="" FOR  SET LFN=$ORDER(^INAUFPTEXTRAW(YM,AUF,POS,TEIL,LFN)) QUIT:LFN=""  DO
	. . SET KOST(1)=KOST(1)+$PIECE($GET(^INAUFPTEXTRAW(YM,AUF,POS,TEIL,LFN,1)),Y,2)
	. . QUIT
	. SET $PIECE(YFELD,Y,1)=KOST(1)
	. QUIT
	SET KOST(2)=$PIECE(YFELD,Y,3)
	IF $PIECE(YFELD,Y,4)=1 DO  ;RECHNEN EXTRAKOSTEN ;have faith in 
	. NEW LFN
	. SET KOST(2)=0
	. SET LFN="" FOR  SET LFN=$ORDER(^INAUFPTEXTRAE(YM,AUF,POS,TEIL,LFN)) QUIT:LFN=""  DO
	. . SET KOST(2)=KOST(2)+$PIECE($GET(^INAUFPTEXTRAE(YM,AUF,POS,TEIL,LFN,1)),Y,2)
	. . QUIT
	. SET $PIECE(YFELD,Y,3)=KOST(2)
	. QUIT
	SET KOST(3)=$PIECE(YFELD,Y,5)
	IF $PIECE(YFELD,Y,6)=1 DO  ;RECHNEN VERSCHNITTKOSTEN ;have faith in 
	. NEW LFN
	. SET KOST(3)=0
	. SET LFN="" FOR  SET LFN=$ORDER(^INAUFPTEXTRAV(YM,AUF,POS,TEIL,LFN)) QUIT:LFN=""  DO
	. . SET KOST(3)=KOST(3)+$PIECE($GET(^INAUFPTEXTRAV(YM,AUF,POS,TEIL,LFN,1)),Y,2)
	. . QUIT
	. SET $PIECE(YFELD,Y,5)=KOST(3)
	. QUIT
	SET $PIECE(YFELD,Y,11)=KOST(1)+KOST(2)+KOST(3)
	IF $PIECE(YFELD,Y,12)=1 DO  ;KEINE ZUSATZKOSTEN;FIS;22540;29.01.04
	. SET $PIECE(YFELD,Y,1)=""
	. SET $PIECE(YFELD,Y,3)=""
	. SET $PIECE(YFELD,Y,5)=""
	. SET $PIECE(YFELD,Y,11)=""
	. QUIT
	DO
	. NEW YFORM,YVOR,YOK
	. SET YOK=$$^WWWSPEI("INAUFPTEXTRA",AUF_","_POS_","_TEIL,YFELD)
	. QUIT
	QUIT
	
CHECK	;PRÜFEN, OB ZUSATZKOSTENERFASSUNG MÖGLICH;FIS;22540;12.01.04
	NEW PRUEF
	SET YKEY=$GET(YKEY)
	IF $PIECE(YKEY,",",1)="" SET YQ=1_$$^WWWTEXT(32072) QUIT  ;BITTE DATENSATZ WÄHLEN ;please data record pick out 
	IF $PIECE(YKEY,",",2)="" SET YQ=1_$$^WWWTEXT(32072) QUIT  ;BITTE DATENSATZ WÄHLEN ;please data record pick out 
	IF $PIECE(YKEY,",",3)="" SET YQ=1_$$^WWWTEXT(32072) QUIT  ;BITTE DATENSATZ WÄHLEN ;please data record pick out 
	SET PRUEF=$ORDER(^INAUFPT(YM,$PIECE(YKEY,",",1),$PIECE(YKEY,",",2),$PIECE(YKEY,",",3)))
	IF PRUEF="" SET YQ=1_$$^WWWTEXT(33712) QUIT  ;NUR IN FERTIGUNGSTEILEN MÖGLICH ;only within potential 
	IF $EXTRACT(PRUEF,1,$LENGTH($PIECE(YKEY,",",3)))'=$PIECE(YKEY,",",3) SET YQ=1_$$^WWWTEXT(33712) QUIT  ;NUR IN FERTIGUNGSTEILEN MÖGLICH ;only within potential 
	QUIT
]]></Routine>
</Export>