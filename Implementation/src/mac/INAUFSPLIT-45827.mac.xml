<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFSPLIT" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFSPLIT ;INAUFSPLIT;ULM;TEILLIEFERUNGEN ;17.10.2002
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		TEILLIEFERUNGEN 
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| ULM	17.10.2002
	;|
	;\------------------------------------------------------------------/
	;
	;STARTEN SPLITPROCESS ;launching 
	NEW YTEXT
	SET YTEXT=""
	SET AUF=$GET(VORG(20))
	SET POS=$GET(VORG(21))
	SET MG=$GET(VORG(22))
	IF AUF'="" IF POS'="" DO
	. NEW YII
	. SET YII(1)=0
	. FOR YII=2:3:14 DO  QUIT:YII(1)=1
	. . QUIT:+$GET(VORG(YII))=0
	. . IF POS="" SET YII(1)=1 QUIT
	. . IF $GET(^INAUFP(YM,AUF,POS,1))="" SET YII(1)=1 QUIT
	. . IF $GET(VORG(YII+1))'="" DO
	. . . IF $DATA(^INAUFP(YM,AUF,POS,1)) SET $PIECE(^(1),Y,19)=$GET(VORG(YII+1))
	. . . QUIT
	. . IF +$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,5)'=+MG SET YII(1)=1 QUIT
	. . SET ML=VORG(YII)
	. . SET POSNEU=POS
	. . SET YTEXT=YTEXT_$$^WWWTEXT(32677)_": "_$GET(POSNEU)_" ("_$$^WWWTEXT(31407)_": "_VORG(YII)_") |"
	. . SET MR=MG-ML
	. . IF +MR=0!(MR<0) SET YII(1)=1 QUIT
	. . DO ^INSPLIT(AUF,POS,MG,ML,MR)
	. . SET MG=MG-ML
	. . SET POS=$GET(POSNEU)
	. . QUIT
	. QUIT
	;MANUELLER BACKBUTTON
	;;DO
	. NEW YFORM,YKEY,YBACK
	. WRITE "<A HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUF&YKEY="_AUF  ;ZURÜCK ZU AUFTRAG ;back within order 
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE "<IMG SRC="_""""_YGIF_"hback.gif"_""""_" "_YHEIGHT_" "_YWIDTH_" TITLE="_""""_$$^WWWTEXT(99)_""""_" border=0></A>"
	. WRITE "</A>"
	. QUIT
	NEW YI
	SET YI=""
	DO  ;RÜCKBUTTON MIT LINK
	. NEW YBACK,YKEY
	. SET YBACK=""
	. SET YI=YAKTION_"EP=WWWFORM&YFORM=INAUF&YKEY="_AUF
	. DO VAR^WWWCGI
	. QUIT
	;ANZEIGE LINKS ZU NEUEN AUFTRAGSPOSITIONEN ;Show on the left within 
	IF YTEXT="" SET YTEXT=$$^WWWTEXT(32292)  ;BITTE PRÜFEN
	DO ^WWWINFO(YTEXT,0,YI,2)
	QUIT
	
FELD  ;AUSFÜLLEN DER FORMULARFELDER ;fill up the 
	NEW DIF,YFELD,YII,SUM
	SET YFELD=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"M",1))
	IF +YINHALT<0 SET $PIECE(YFELD,Y,YLFN)=" "
	SET SUM=0
	FOR YII(1)=2:3:14 DO
	. SET SUM=SUM+$PIECE(YFELD,Y,YII(1))
	. QUIT
	IF +$PIECE(YFELD,Y,2)=0!($PIECE(YFELD,Y,2)<0) DO
	. SET $PIECE(YFELD,Y,2)=$PIECE(YFELD,Y,22)
	. SET SUM=$PIECE(YFELD,Y,22)
	. FOR YII(1)=5:3:14 SET $PIECE(YFELD,Y,YII(1))=" "
	. QUIT
	SET DIF=$PIECE(YFELD,Y,22)-SUM
	SET $PIECE(YFELD,Y,2)=$PIECE(YFELD,Y,2)+DIF
	SET SUM=0
	FOR YII(1)=2:3:14 DO
	. SET SUM=SUM+$PIECE(YFELD,Y,YII(1))
	. QUIT
	IF +$PIECE(YFELD,Y,2)=0!($PIECE(YFELD,Y,2)<0) DO
	. SET $PIECE(YFELD,Y,2)=$PIECE(YFELD,Y,22)
	. SET SUM=$PIECE(YFELD,Y,22)
	. FOR YII(1)=5:3:14 SET $PIECE(YFELD,Y,YII(1))=" "
	. QUIT
	SET DIF=$PIECE(YFELD,Y,22)-SUM
	IF DIF<0 DO
	. FOR YII(1)=14:-3:2 DO  QUIT:DIF=0
	. . QUIT:+$PIECE(YFELD,Y,YII(1))=0
	. . SET $PIECE(YFELD,Y,YII(1))=$PIECE(YFELD,Y,YII(1))+DIF
	. . IF $PIECE(YFELD,Y,YII(1))<0 DO
	. . . SET DIF=$PIECE(YFELD,Y,YII(1))
	. . . SET $PIECE(YFELD,Y,YII(1))=" "
	. . . QUIT
	. . QUIT
	. QUIT
	IF DIF>0 DO
	. FOR YII(1)=14:-3:2 DO  QUIT:DIF=0
	. . QUIT:+$PIECE(YFELD,Y,YII(1))=0
	. . IF $PIECE(YFELD,Y,YII(1))'=0 DO
	. . . SET $PIECE(YFELD,Y,YII(1))=$PIECE(YFELD,Y,YII(1))+DIF
	. . . SET DIF=0
	. . . QUIT
	. . QUIT
	. QUIT
	IF +$PIECE(YFELD,Y,2)=0!($PIECE(YFELD,Y,2)<0) DO
	. SET $PIECE(YFELD,Y,2)=$PIECE(YFELD,Y,22)
	. SET SUM=$PIECE(YFELD,Y,22)
	. FOR YII(1)=5:3:14 SET $PIECE(YFELD,Y,YII(1))=" "
	. QUIT
	FOR YII=2:3:14 SET:+$PIECE(YFELD,Y,YII)=0 $PIECE(YFELD,Y,YII)=" " 
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"M",1)=YFELD
	FOR YII=2:3:14 SET %TXT(1)=$GET(%TXT(1))_"#"_"Y"_YFORM_"M"_YII_"~"_$PIECE(YFELD,Y,YII)
	IF YINHALT'="" IF +$PIECE(YFELD,Y,22)=+$PIECE(YFELD,Y,2) SET %TXT(1)=%TXT(1)_"#!"_$$^WWWTEXT(219)
	QUIT
	
SETKEY ;SETZEN VARIABLEN FÜR FORM ;typeset to shape 
	SET VORG20=$PIECE($GET(YKEY),",",1)
	SET VORG21=$PIECE($GET(YKEY),",",2)
	IF VORG20="" SET VORG20=" "
	IF VORG20="" SET VORG20=" "
	SET VORG22=""
	SET VORG23=""
	IF VORG20'="" IF VORG21'="" DO
	. IF $PIECE($GET(^INAUF(YM,VORG20,1)),Y,2)=1 WRITE "<FONT COLOR="_YRED_">"_$$^WWWTEXT(144) QUIT  ;NOT MANUFACTERING ;!($PIECE($GET(^INAUF(YM,VORG20,1)),Y,2)=2);FIS;SR12128
	. NEW ME,DAT
	. SET VORG22=$PIECE($GET(^INAUFP(YM,VORG20,VORG21,1)),Y,5)
	. SET ME=$PIECE($GET(^INAUFP(YM,VORG20,VORG21,1)),Y,40)
	. IF ME'="" SET VORG23=$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,ME,1)),Y,1)
	. SET VORG3=$PIECE($GET(^INAUFP(YM,VORG20,VORG21,1)),Y,19)
	. IF +VORG3=0 SET VORG3=$PIECE($GET(^INAUF(YM,VORG20,1)),Y,19)
	. QUIT
	QUIT
]]></Routine>
</Export>