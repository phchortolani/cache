<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWPRINTING" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWPRINTING(YPRINTER,YPRINTING,YDATA) ;WWWPRINTING;TYBD;PRINT LABEL;5,9,2004  ; Compiled March 16, 2005 09:29:09
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		PRINT LABEL
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| TYBD	5,9,2004  
	;|
	;\------------------------------------------------------------------/
	;
	;
	;SAMPLE: SET ERROR=$$^WWWPRINTING(1,,"<B>TEST</B> LINE 1~TEST LINE 2")
	;
	;YPRINTER=DEFINDED IN WWWPRINTER ;within 
	;         IF NON = DEFAULT PRINTER
	;
	;YPRINTING=DEFINED IN WWWPRINTING = LABELDFINITION  ;within 
	;         IF NON = NO PREDEFINITION
	;
	;
	;YDATA = LINE1~LINE2~LINE3~LINEn
	;        DATA TO PRINT
	;        IF NON = BLANK PAGE ;shiny page 
	;
	NEW RETURN,YINIT,YI,YPRINTER1,PPARAM
	;
	SET YINIT(1)=""  ;INIT ON
	SET YINIT(2)=""  ;INIT OFF
	SET YINIT(3)=""  ;INIT IN LINE ;within 
	SET RETURN=1     ;ERROR
	IF $GET(Y)="" SET Y="~"  ;DELIMITER
	;
	SET YPRINTER1=YPRINTER
	;
	IF $GET(YPRINTER)'="" DO
	. SET YINIT(1)=$TRANSLATE($PIECE($GET(^WWWPRINTER(0,YPRINTER,1)),Y,2),"|"," ")
	. SET YINIT(2)=$TRANSLATE($PIECE($GET(^WWWPRINTER(0,YPRINTER,1)),Y,3),"|"," ")
	. SET YPRINTER=$PIECE($GET(^WWWPRINTER(0,YPRINTER,1)),Y,1)
	. QUIT
	;	
	SET YPRINTER=$GET(YPRINTER)	
	SET PPARA="wns"  ;file
	IF $FIND(YPRINTER,"/usr/cache") SET PPARA="wq"   ;queue 
	IF $EXTRACT(YPRINTER)'="/" SET YPRINTER="|PRN|"_$GET(YPRINTER),PPARA=""
	;
	;
	OPEN YPRINTER:PPARA:4 QUIT:'$TEST RETURN  ;NOT SUCCESS ;privation 
	;
	SET YDATA=$GET(YDATA)
	SET YPRINTING=$GET(YPRINTING)
	;
	USE YPRINTER 
	;
	FOR YI(1)=1:1 QUIT:$PIECE(YINIT(1)," ",YI(1),9999)=""  DO
	. quit:$PIECE(YINIT(1)," ",YI(1))=" "
	. IF $EXTRACT($PIECE(YINIT(1)," ",YI(1)))="#" WRITE $EXTRACT($PIECE(YINIT(1)," ",YI(1)),2,999) QUIT
	. WRITE $CHAR($PIECE(YINIT(1)," ",YI(1)))
	. QUIT
	; 	
	FOR YI=1:1 QUIT:$PIECE(YDATA,Y,YI,9999)=""  DO
	. IF YPRINTING'="" DO
	. . IF $DATA(^WWWPRINTING(0,YPRINTING,YI,1)) DO
	. . . SET YINIT(3)=$PIECE(^(1),Y,1) 
	. . . FOR YI(1)=1:1 QUIT:$PIECE(YINIT(3)," ",YI(1),9999)=""  DO
	. . . . IF $EXTRACT($PIECE(YINIT(3)," ",YI(1)))="#" WRITE $EXTRACT($PIECE(YINIT(3)," ",YI(1)),2,999) QUIT
	. . . . WRITE $CHAR($PIECE(YINIT(3)," ",YI(1)))
	. . . . QUIT
	. . . WRITE $PIECE(^(1),Y,2) 
	. . . QUIT
	. . QUIT
	. IF $FIND($PIECE(YDATA,Y,YI),"<") DO  ;STEUERUNG ;steerage 
	. . NEW YDATA1,YDATA2,YII,YCODE,YENDE,YSEQ
	. . SET YDATA1=$PIECE(YDATA,Y,YI)
	. . SET YDATA2=""
	. . FOR YII=1:1:20 QUIT:$PIECE(YDATA1,"<",2)=""  DO
	. . . SET YCODE=$PIECE($PIECE(YDATA1,"<",2),">",1)
	. . . SET YENDE=0
	. . . IF $EXTRACT(YCODE)="/" SET YENDE=1 SET YCODE=$EXTRACT(YCODE,2,999)
	. . . ;START ;take-off 
	. . . SET YINIT(4)=""
	. . . IF YCODE'="" IF YPRINTER1'="" IF YENDE=0 SET YINIT(4)=$PIECE($GET(^WWWPRINTERESC(0,YPRINTER1,YCODE,1)),Y,1)
	. . . ;ENDE ;termination 
	. . . IF YCODE'="" IF YPRINTER1'="" IF YENDE=1 SET YINIT(4)=$PIECE($GET(^WWWPRINTERESC(0,YPRINTER1,YCODE,1)),Y,2)
	. . . SET YSEQ=""
	. . . ;
	. . . FOR YI(1)=1:1 QUIT:$PIECE(YINIT(4)," ",YI(1),9999)=""  DO
	. . . . IF $EXTRACT($PIECE(YINIT(4)," ",YI(1)))="#" SET YSEQ=YSEQ_$EXTRACT($PIECE(YINIT(4)," ",YI(1)),2,999) QUIT
	. . . . SET YSEQ=YSEQ_$CHAR($PIECE(YINIT(4)," ",YI(1)))
	. . . . QUIT
	. . . SET YDATA1=$PIECE(YDATA1,"<",1)_YSEQ_$PIECE(YDATA1,">",2,99)
	. . . QUIT
	. . SET $PIECE(YDATA,Y,YI)=YDATA1
	. . QUIT
	. WRITE $PIECE(YDATA,Y,YI)
	. WRITE !  ;LINEFEED
	. QUIT
	; 	
	FOR YI(1)=1:1 QUIT:$PIECE(YINIT(2)," ",YI(1),9999)=""  DO
	. QUIT:$PIECE(YINIT(1)," ",YI(1))=" "
	. IF $EXTRACT($PIECE(YINIT(2)," ",YI(1)))="#" WRITE $EXTRACT($PIECE(YINIT(2)," ",YI(1)),2,999) QUIT
	. WRITE $CHAR($PIECE(YINIT(2)," ",YI(1)))
	. QUIT
	WRITE #	
	CLOSE YPRINTER
	;
	DO OPEN^WWWSTART             ;BEC;27.12.04
	;
	SET RETURN=0
	QUIT RETURN  ;PRINTED  
]]></Routine>
</Export>