<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDRUCKXMLTR" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INDRUCKXMLTR(YREF)
#include COMSYS
#include INConst
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		HTML VORLAGEN DRUCKEN MIT DATEN AUS XML
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :	
	; 19-Jan-2007	GRF		SR12027: Doco; missed final quit; FIXME notes
	; 30-May-2005	RobertW	SR12056: Attempt at Performance Increase
	; 18.06.2003	FIS
	;-------------------------------------------------------------------------------
	
	;===============================================================================
	;	<LINE>											</LINE>
	;	<DOCUMENT: CLASS : FIELD >	      VALUE			</<DOCUMENT>
	;								<START>  <STOP>
	;	<CLASS>											</CLASS>
	;	<LF>											</LF>
	;===============================================================================
	
	NEW HTML,PART,YZEILE,AUF1,POS1,LFN,POS,YSPRACHE1,UMBRUCH
	
	SET YREF=$GET(YREF)
	IF $GET(YTEST)=1 QUIT  ;KEINE UMSETZTUNG, NUR ANZEIGE DES CODES
	KILL ^WWWSOR(YUSER,"XML")
	DO SENDLINK   ;BEC;26820;02.12.04;LINK ZUM VERSENDEN
	DO READXML
	;M ^TEST1=^INDMS(YM,YREF)
	KILL ^INDMS(YM,YREF)
	
	;+++++++++++++++++++***********************************************
	;	SETHTML constructs the HTML string from the INDRPARAHTML settings.
	;	NOTE: It does ***NOT*** write ANY of it out yet!!!
	;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	DO SETHTML
	;KILL ^TEST1 MERGE ^TEST1=^WWWSOR(YUSER,"XML")
	KILL ^WWWSOR(YUSER,"XML")
	QUIT
	
	; TODO SS - $ movement
	
	
READXML ;AUFBEREITEN WERTE IN XML TAGS ;within XML in the daytime 
	NEW PAGE,LINE,TEXT,YI,LFN,CLASS,FIELD,VALUE,POS,POSITION,FILE
	
	;+++++++++++++++++++++++++++++++++++++++
	;  ^INDMS : Historical Documents
	;  
	;  With TEXT = "xxx <DOCUMENT:class:fld> yyy </DOCUMENT> zzz"
	;  
	;  extracts    VALUE = yyy
	;  and returns TEXT  = xxxzzz
	;+++++++++++++++++++++++++++++++++++++++
	
	SET POS      = 0
	SET POSITION = ""
	SET PAGE     = ""
	FOR  SET PAGE=$ORDER(^INDMS(YM,YREF,PAGE)) QUIT:PAGE=""  DO
	. SET LINE=""
	. FOR  SET LINE=$ORDER(^INDMS(YM,YREF,PAGE,LINE)) QUIT:LINE=""  DO  QUIT:LINE=""
	. . SET TEXT=$GET(^INDMS(YM,YREF,PAGE,LINE,1))
	. . QUIT:TEXT=""
	. . ;
	. . IF $FIND(TEXT,"</LINE>") DO  SET POS=0
	. . . IF POSITION="" SET POSITION=1
	. . . MERGE ^WWWSOR(YUSER,"XML",POSITION)=^WWWSOR(YUSER,"XMLtemp",0)
	. . . KILL ^WWWSOR(YUSER,"XMLtemp")
	. . ;
	. . IF $FIND(TEXT,"<LINE>") KILL ^WWWSOR(YUSER,"XMLtemp") SET POS=1 SET POSITION=""
	. . ;
	. . FOR YI=1:1:10 DO  QUIT:'$FIND(TEXT,"<DOCUMENT:")  ;MAX 10 DATENFELDER JE ZEILE ;once 
	. . . new strField
	. . . IF $FIND(TEXT,"<DOCUMENT") DO
	. . . . SET CLASS=$PIECE($PIECE($PIECE(TEXT,"<DOCUMENT",2),":",2),">",1)
	. . . . QUIT:CLASS=""
	. . . . SET FIELD=$PIECE($PIECE($PIECE(TEXT,"<DOCUMENT",2),":",3),">",1)
	. . . . QUIT:FIELD=""
	. . . . ;
	. . . . ; FIXME : If there are multiple <DOCUMENT></DOCUMENT> pairs in TEXT then
	. . . . ;         we need to concatenate ",2,999)" rather than just ",2)"
	. . . . ;         (ditto in subr SPE)                                     <GRF>
	. . . . ;
	. . . . SET VALUE = $PIECE($PIECE(TEXT,"<DOCUMENT:"_CLASS_":"_FIELD_">",2),"</DOCUMENT:"_CLASS_":"_FIELD_">",1)
	. . . . SET TEXT  = $PIECE(TEXT,"<DOCUMENT:"_CLASS_":"_FIELD_">",1)_$PIECE(TEXT,"</DOCUMENT:"_CLASS_":"_FIELD_">",2)
	. . . . ;
	. . . . IF POS=1 IF (CLASS="INAUFP")!(CLASS="INANGP") IF FIELD="P2" SET POSITION=VALUE  ;LINE ITEM
	. . . . ;
	. . . . SET FILE="XML"
	. . . . IF POS=1 SET FILE="XMLtemp"
	. . . . SET LFN=1
	. . . . set strField=$zconvert(FIELD,"U")
	. . . . FOR  QUIT:'$DATA(^WWWSOR(YUSER,FILE,0,CLASS,strField,LFN))  SET LFN=LFN+1   ;MEHRFACH
	. . . . SET VALUE=$$^WWWTRANSLATE($$^WWWTRANSLATE(VALUE,"   ","  "),"  "," ")       ;MAX 1 LEERZEICHEN ;space character 
	. . . . ;IF $FIND(VALUE,$$^WWWWHR(YWHR)_" ") DO                            ;BEC;21.04.04;25584;WÄHRUNGEN UMFORMATIEREN
	. . . . IF $$^WWWWHR(YWHR)'="" IF $FIND(VALUE,$$^WWWWHR(YWHR)_" ") DO      ;BEC;17.05.04;25724;NUR WENN WÄHRUNGEN VORHANDEN
	. . . . . NEW VALUE1                                   ;BEC;17.08.04;26182
	. . . . . SET VALUE1=$PIECE(VALUE,$$^WWWWHR(YWHR),1)   ;BEC;17.08.04;26182
	. . . . . ;SR12345 -- DO NOT CONVERT/FORMAT SPACES
	. . . . . ;SET VALUE=$PIECE(VALUE,$$^WWWWHR(YWHR),2)   ;BEC;17.08.04;26182
	. . . . . ;SET VALUE=$$^WWWTRANSLATE($$^WWWTRANSLATE(VALUE,"   ","  "),"  "," ")
	. . . . . ;SET VALUE=$PIECE(VALUE," ",2)_" "_$PIECE(VALUE," ",1)
	. . . . . ;SET VALUE=VALUE1_$PIECE(VALUE," ",2)_" "_$PIECE(VALUE," ",1)_$$^WWWWHR(YWHR)    ;BEC;17.08.04;26182
	. . . . ;
	. . . . ;SET ^WWWSOR(YUSER,FILE,0,CLASS,$$^WWWUPER(FIELD),LFN)=VALUE
	. . . . SET ^WWWSOR(YUSER,FILE,0,CLASS,strField,LFN)=VALUE
	. . . . ;SET ^WWWSOR(YUSER,FILE,0,CLASS,$$^WWWUPER(FIELD),LFN)=VALUE
	
	QUIT
	
SETHTML
    ;-------------------------------------------------------------------------------
    ; EINSETZTEN WERTE IN HTML VORLAGE UND NEUAUFBAU DER INDMS ;within HTML And the 
    ;
    ; Params:
    ;
    ; Returns:
    ;
    ; History:
    ; 10-Jan-2005	PO		SR14152: Do not print out "(Copy)" on 2nd and following customer invoices
    ;  6-Sep-2005	JW		SR13419: Reverted part of SR13107. Don't need to deliver to invoice.
	; 22-Aug-2005	Steve S	SR13107: Skip line if not a confirmation and not delivered
	;								Included COMSYS -- macro usage
    ; 12-Jul-2005	PO		SR12923: Ensure unsourced stock is shown on order confirmations
	; 17-Jun-2005	RPW/SS	SR12607: Skip line if not a confirmation and not sourced
    ;-------------------------------------------------------------------------------
	NEW AUF1,POS1,POSITION,HTML,LFN,COUNTRY,lstPrints,idPrint
	
	SET YSPRACHE1=$GET(SPRACHE)
	SET YDRUCKART=+$GET(YDRUCKART)
	SET POSITION=0
	SET HTML=$GET(^INDRPARAHTML(YM,YBETRIEB,YBELEG,YSPRACHE1,YDRUCKART,1))  ;HTML-VORLAGE
	IF HTML="" IF $DATA(^INDRPARAHTML(YM,YBETRIEB,YBELEG)) DO
	. NEW XSPRACHE
	. SET XSPRACHE=""
	. IF $DATA(^INDRPARAHTML(YM,YBETRIEB,YBELEG,YSPRACHE1)) SET XSPRACHE=YSPRACHE1
	. IF XSPRACHE="" SET XSPRACHE=$ORDER(^INDRPARAHTML(YM,YBETRIEB,YBELEG,""))
	. QUIT:XSPRACHE=""
	. SET YSPRACHE1=XSPRACHE
	. IF $DATA(^INDRPARAHTML(YM,YBETRIEB,YBELEG,YSPRACHE1,YDRUCKART,1)) SET HTML=$get(^INDRPARAHTML(YM,YBETRIEB,YBELEG,YSPRACHE1,YDRUCKART,1)) QUIT
	. SET YDRUCKART=$ORDER(^INDRPARAHTML(YM,YBETRIEB,YBELEG,YSPRACHE1,""))
	. IF YDRUCKART'="" SET HTML=$GET(^INDRPARAHTML(YM,YBETRIEB,YBELEG,YSPRACHE1,YDRUCKART,1))
	
	IF HTML="" WRITE $$^WWWTEXT(35) QUIT  ;HTML-VORLAGE BILDEN /CREATE DEFAULT ;shape 
	SET LFN=0
	SET YZEILE=0
	SET AUF1=$GET(^INAUF(YM,YAUFTRAG,1))  ;AUFTRAGSDATEN
	IF (YBELEG=1) || (YBELEG=10) SET AUF1=$GET(^INANG(YM,YAUFTRAG,1))  ;ANGEBOTSDATEN
	SET POS1=""
	
	;HTML ANFANG ;HTML outset 
	;HEADER UND BODY-ANFANG ;And 
	SET YZEILE=YZEILE+1
	SET HTML(YZEILE)="<html>"
	SET HTML(YZEILE)=HTML(YZEILE)_"|<!--********************* "_$$^WWWFELDNAME("INDRPARAHTML","D",6)_" *****************-->"
	SET HTML(YZEILE)=HTML(YZEILE)_"|<head>|"_$PIECE(HTML,Y,6)_"|</head>"
	SET HTML(YZEILE)=HTML(YZEILE)_"|<body"
	;IF $GET(YHTMLSEND)=0 SET HTML(YZEILE)=HTML(YZEILE)_" onLoad="_""""_"window.print();"_""""
	IF $GET(YUSERAGENT)="MSIE" IF $GET(YHTMLSEND)=0 SET HTML(YZEILE)=HTML(YZEILE)_" onLoad="_""""_"window.setTimeout('document.body.focus(); window.print();',10);"_""""    ;BEC;13.01.05;26992;FOCUS SETZTEN
	IF $GET(YUSERAGENT)'="MSIE" IF $GET(YHTMLSEND)=0 SET HTML(YZEILE)=HTML(YZEILE)_" onLoad="_""""_"window.setTimeout('window.print();',10);"_""""                          ;BEC;13.01.05;26992;FOCUS SETZTEN
	SET HTML(YZEILE)=HTML(YZEILE)_">"
	SET HTML(YZEILE)=HTML(YZEILE)_$CHAR(9)_"<!--EOF-->"
	DO SPE
	
	;BELEGANFANG
	SET YZEILE=YZEILE+1
	SET HTML(YZEILE)=""
	SET HTML(YZEILE)=HTML(YZEILE)_"<!--********************* Table Start *****************-->"
	SET HTML(YZEILE)=HTML(YZEILE)_"|<table style="_""""_"table-layout:fixed;"_""""_" border=0 cellspacing=0 cellpadding=0"
	IF +$PIECE(HTML,Y,13)'=0 SET HTML(YZEILE)=HTML(YZEILE)_" height="_""""_$PIECE(HTML,Y,13)_""""  ;BELEGHÖHE
	IF +$PIECE(HTML,Y,14)'=0 SET HTML(YZEILE)=HTML(YZEILE)_" width="_""""_$PIECE(HTML,Y,14)_""""  ;BELEGBREITE
	SET HTML(YZEILE)=HTML(YZEILE)_">|<tr>|<td align=left valign=top"
	IF +$PIECE(HTML,Y,10)'=0 SET HTML(YZEILE)=HTML(YZEILE)_" heigth="_""""_$PIECE(HTML,Y,10)_""""  ;HÖHE BELEGKOPF ;highness 
	SET HTML(YZEILE)=HTML(YZEILE)_">"
	SET HTML(YZEILE)=HTML(YZEILE)_$CHAR(9)_"<!--EOF-->"
	DO SPE
	
	;KOPFTEXT
	DO
	. SET YZEILE=YZEILE+1
	. SET HTML(YZEILE)=""
	. SET HTML(YZEILE)=HTML(YZEILE)_"<!--********************* "_$$^WWWFELDNAME("INDRPARAHTML","D",1)_" *****************-->|"
	. SET HTML(YZEILE)=HTML(YZEILE)_$PIECE(HTML,Y,1)
	. SET HTML(YZEILE)=HTML(YZEILE)_$CHAR(9)_"<!--EOF-->"
	. DO SPE
	
	;ENDE KOPF, ANFANG BELEGTEXT
	SET YZEILE=YZEILE+1
	SET HTML(YZEILE)="</td></tr>"    
	SET HTML(YZEILE)=HTML(YZEILE)_"|<tr><td align=left valign=top"  
	IF +$PIECE(HTML,Y,11)'=0 SET HTML(YZEILE)=HTML(YZEILE)_" height="_""""_$PIECE(HTML,Y,11)_""""  ;HÖHE BELEGTEXT    ;highness 
	SET HTML(YZEILE)=HTML(YZEILE)_">"
	SET HTML(YZEILE)=HTML(YZEILE)_$CHAR(9)_"<!--EOF-->"
	DO SPE
	
	;BELEGTEXT TEIL1
	DO
	. SET YZEILE=YZEILE+1
	. SET HTML(YZEILE)=""
	. SET HTML(YZEILE)=HTML(YZEILE)_"<!--********************* "_$$^WWWFELDNAME("INDRPARAHTML","D",2)_" *****************-->|"
	. SET HTML(YZEILE)=HTML(YZEILE)
	. ;SR10960: Check for previous print history : 01-Jul-09: FIS: NOT HARDCODET ! SEE INDRUCKHTML1
	. //set idPrint=YAUFTRAG
	. //set lstPrints=""
	. //for  set idPrint=$order(^INDMSA(YM,idPrint)) quit:YAUFTRAG'=(idPrint\1)  do ; Due to IP using a constructed primary key a.b instead of primary key a and primary k b, there is no reliable way of getting the print number
	. //. set lstPrints=lstPrints_$lb($P(^INDMSA(YM,idPrint,1),Y,11))
	. //if (YBELEG'=7) || ($get(YCOPY)=1) if $listfind(lstPrints,YBELEG)'=0 SET HTML(YZEILE)=HTML(YZEILE)_"|<center>("_$$^WWWTEXT(32097)_")</center>|" ; SR14152 Do not print out "(Copy)" on customer invoices  : NOT AS HARDCODED: see INDRUCKHTML1
	. //;if $listfind(lstPrints,YBELEG)'=0 SET HTML(YZEILE)=HTML(YZEILE)_"|<center>("_$$^WWWTEXT(32097)_")</center>|" ; SR14152
	. SET HTML(YZEILE)=HTML(YZEILE)_$PIECE(HTML,Y,2)_$CHAR(9)_"<!--EOF-->"
	. DO SPE
	
	IF $PIECE(AUF1,Y,275)=1 DO FF     ;UMBRUCH ZWISCHEN BELEGTEXT UND POSITIONSTEXT ;make-up inter- And 
	
	;POSITIONEN
	SET YZEILE=YZEILE+1
	SET HTML(YZEILE)="<!-- SCOTT: BEFORE LINES -->"
	DO SPE
	
	DO
	. SET ANZ=1
	. SET UMBRUCH=$PIECE(HTML,Y,15)     ;BEC;14.04.04;25537
	. IF UMBRUCH="" SET UMBRUCH=23      ;bec;25819;01.06.04;
	. IF $PIECE(HTML,Y,18)=1 SET $PIECE(HTML,Y,15)=""   ;BEC;14.09.04;25846
	. SET POS=""
	. FOR  SET POS=$ORDER(YAUFTRAG(POS)) QUIT:POS=""  DO
	. . IF '$DATA(^WWWSOR(YUSER,"XML",POS)) QUIT  ;NICHT AUFBEREITET ;Not 
	. . DO
	. . . IF YBELEG'=1 IF YBELEG'=10 SET POS1=$GET(^INAUFP(YM,YAUFTRAG,POS,1)) QUIT  ;AUFTRAGSPOSITION
	. . . IF '$DATA(^INANGGOEP(YM,YAUFTRAG)) SET POS1=$GET(^INANGP(YM,YAUFTRAG,POS,1)) QUIT  ;ANGEBOTSPOSITION
	. . . SET POS1=$GET(^INANGGOEP(YM,YAUFTRAG,POS,1))  ;ANGEBOTSPOSITION GÖBEL
	. . ;
	. . SET YZEILE=YZEILE+1
	. . SET HTML(YZEILE)=""
	. . IF ANZ=1 SET HTML(YZEILE)=HTML(YZEILE)_"<!--********************* "_$$^WWWFELDNAME("INDRPARAHTML","D",3)_" *****************-->|"
	. . SET HTML(YZEILE)=HTML(YZEILE)_$PIECE(HTML,Y,3)_$CHAR(9)_"<!--EOF-->"
	. . quit:(YHTML=1)&&($piece(AUF1,Y,2)=0)&&($$$INAUFPSource($get(^INAUFP(YM,YAUFTRAG,POS,1)))="")&&(YBELEG'=2) ; 12-Jul-2005	PO	SR12923: Ensure unsourced stock is shown on order confirmations; 17-Jun-2005	RPW/SS		SR12607: Skip line if not sourced
	. . set idSingleLine=$order(^CacheTempSingleLine(YUSER,YAUFTRAG,""))
	. . quit:(YHTML=1)&&($piece(AUF1,Y,2)=0)&&(YBELEG'=2)&&($data(^CacheTempSingleLine(YUSER)))&&(idSingleLine'="")&&(POS'=idSingleLine) ; 22-Aug-2005 SS Skip if undelivered and printing invoice (SR13107)
	. . ;quit:(YHTML=1)&&($piece(AUF1,Y,2)=0)&&(YBELEG'=2)&&($$$INAUFPDeliveryNoteNumber($get(^INAUFP(YM,YAUFTRAG,POS,1)))="") ; 29-Aug-2005 SS		// SR13419
	. . DO SPE
	. . ;
	. . SET ANZ=ANZ+1
	. . SET POS1=""  ;RÜCKSETZEN DATEN
	. . IF $PIECE(AUF1,Y,276)=1 IF $ORDER(YAUFTRAG(POS))'="" DO FF  QUIT  ;UMBRUCH ZWISCHEN POSITIONEN ;make-up inter- 
	. . ;IF ANZ>$PIECE(HTML,Y,15) DO FF SET ANZ=1  ;MEHR POSITIONEN ALS PRO SEITE DEFINIERT
	. . IF +UMBRUCH>0 IF ANZ>UMBRUCH DO FF SET ANZ=1  ;BEC;14.04.04;25537; wenn nichts eingetragen ist, kein Umbruch
	. ;
	. ;IF +$PIECE(HTML,Y,15)>0 IF ANZ<$PIECE(HTML,Y,15) DO
	. IF +UMBRUCH>0 IF ANZ<UMBRUCH DO           ; ;BEC;14.04.04;25537;
	. . FOR YI=ANZ:1:$PIECE(HTML,Y,15) DO
	. . . SET YZEILE=YZEILE+1
	. . . SET HTML(YZEILE)=$PIECE(HTML,Y,3)_$CHAR(9)_"<!--EOF-->"
	. . . NEW POS
	. . . SET POS="Y"  ;RÜCKSETZEN DATEN
	. . . IF $PIECE(HTML,Y,16)=1 SET POS="X"  ;LEERZEICHEN ;space character 
	. . . DO SPE
	
	SET YZEILE=YZEILE+1
	SET HTML(YZEILE)="<!-- SCOTT: AFTER LINES -->"
	DO SPE
	
	IF $PIECE(AUF1,Y,277)=1 DO FF  ;UMBRUCH ZWISCHEN POSITIONEN UND BELEGFUSS ;make-up inter- And 
	
	;BELEGTEXT TEIL 2 ;part 
	DO
	. SET YZEILE=YZEILE+1
	. SET HTML(YZEILE)=""
	. SET HTML(YZEILE)=HTML(YZEILE)_"<!--********************* "_$$^WWWFELDNAME("INDRPARAHTML","D",7)_" *****************-->|"
	. SET HTML(YZEILE)=HTML(YZEILE)_$PIECE(HTML,Y,7)_$CHAR(9)_"<!--EOF-->"
	. DO SPE
	
	;ENDE BELEGTEXT, ANFANG FUSS
	SET YZEILE=YZEILE+1
	SET HTML(YZEILE)="</td></tr>"    
	SET HTML(YZEILE)=HTML(YZEILE)_"|<tr><td align=left valign=bottom"  
	IF +$PIECE(HTML,Y,12)'=0 SET HTML(YZEILE)=HTML(YZEILE)_" height="_""""_$PIECE(HTML,Y,12)_""""  ;HÖHE BELEGFUSS ;highness 
	SET HTML(YZEILE)=HTML(YZEILE)_">"
	SET HTML(YZEILE)=HTML(YZEILE)_$CHAR(9)_"<!--EOF-->"
	DO SPE
	
	;FUSSTEXT
	DO
	. SET YZEILE=YZEILE+1
	. SET HTML(YZEILE)=""
	. SET HTML(YZEILE)=HTML(YZEILE)_"<!--********************* "_$$^WWWFELDNAME("INDRPARAHTML","D",4)_" *****************-->|"
	. SET HTML(YZEILE)=HTML(YZEILE)_$PIECE(HTML,Y,4)_$CHAR(9)_"<!--EOF-->"
	. DO SPE
	
	;HTML ENDE ;HTML termination 
	SET YZEILE=YZEILE+1
	SET HTML(YZEILE)=""
	SET HTML(YZEILE)=HTML(YZEILE)_"<!--********************* Table Stop *****************-->|"
	SET HTML(YZEILE)=HTML(YZEILE)_"</td></tr></table>"
	SET HTML(YZEILE)=HTML(YZEILE)_"|</body>|</html>"
	SET HTML(YZEILE)=HTML(YZEILE)_$CHAR(9)_"<!--EOF-->"
	DO SPE
	
	QUIT
	
FF   ;SEITENUMBRUCH ;page make-up 
	SET YZEILE=YZEILE+1
	SET HTML(YZEILE)=""
	SET HTML(YZEILE)=$PIECE(HTML,Y,17)  ;code vor
	SET HTML(YZEILE)=HTML(YZEILE)_"|<!--********************* Page Break *****************-->"
	IF $PIECE(HTML,Y,4)'="" DO  ;BELEGFUSS
	. SET HTML(YZEILE)=HTML(YZEILE)_"|</td></tr>"    
	. SET HTML(YZEILE)=HTML(YZEILE)_"|<tr><td align=left valign=bottom"  
	. IF +$PIECE(HTML,Y,12)'=0 SET HTML(YZEILE)=HTML(YZEILE)_" height="_""""_$PIECE(HTML,Y,12)_""""  ;HÖHE BELEGFUSS ;highness 
	. SET HTML(YZEILE)=HTML(YZEILE)_">"
	. SET HTML(YZEILE)=HTML(YZEILE)_$PIECE(HTML,Y,4)  ;BELEGFUSS
	
	SET HTML(YZEILE)=HTML(YZEILE)_"|</td></tr></table>"
	SET HTML(YZEILE)=HTML(YZEILE)_"|<p style="_""""_"page-break-before:always;"_""""_"></p>"_$CHAR(9)
	SET HTML(YZEILE)=HTML(YZEILE)_"|<table style="_""""_"table-layout:fixed;"_""""_" border=0 cellspacing=0 cellpadding=0"
	IF +$PIECE(HTML,Y,13)'=0 SET HTML(YZEILE)=HTML(YZEILE)_" height="_""""_$PIECE(HTML,Y,13)_""""  ;BELEGHÖHE
	IF +$PIECE(HTML,Y,14)'=0 SET HTML(YZEILE)=HTML(YZEILE)_" width="_""""_$PIECE(HTML,Y,14)_""""  ;BELEGBREITE
	SET HTML(YZEILE)=HTML(YZEILE)_">|<tr>|<td align=left valign=top"
	IF +$PIECE(HTML,Y,10)'=0 SET HTML(YZEILE)=HTML(YZEILE)_" heigth="_""""_$PIECE(HTML,Y,10)_""""  ;HÖHE BELEGKOPF ;highness 
	SET HTML(YZEILE)=HTML(YZEILE)_">"
	SET HTML(YZEILE)=HTML(YZEILE)_"|<!--********************* "_$$^WWWFELDNAME("INDRPARAHTML","D",5)_" *****************-->|"
	SET HTML(YZEILE)=HTML(YZEILE)_$PIECE(HTML,Y,5)_$CHAR(9)_"<!--EOF-->"  ;BELEGKOPF 2. SEITE ;side 
	IF $DATA(^WWWSOR(YUSER,"XML",0,"MANU","BETREFF12",1)) SET ^WWWSOR(YUSER,"XML",0,"MANU","BETREFF12",1)=$GET(^WWWSOR(YUSER,"XML",0,"MANU","BETREFF12",1))+1
	DO SPE
	
	QUIT
	
SPE   ;SPEICHERN ZEILE ;Save 
	SET YSEITE=1  ;NUR 1 SEITE DA HTML ;only side yonder HTML 
	DO ^INDRUCKHTML1  ;AUSTAUSCH STANDARD TAGS ;in the daytime 
	DO  ;AUSTAUSCH BELEG-TAGS
	. NEW SPRACHE,CODE
	. SET SPRACHE=YSPRACHE1  ;BELEGSPRACHE
	. SET COUNTRY=$GET(YCOUNTRY)
	. SET HTML(YZEILE)=$TRANSLATE(HTML(YZEILE),"|",$CHAR(9))
	. SET HTML(YZEILE)=HTML(YZEILE)_"<!--EOF-->"
	. ;
	. FOR YI1=1:1:1200 SET YI(1)=$PIECE(HTML(YZEILE),$CHAR(9),YI1) DO  QUIT:$FIND(YI(1),"<!--EOF-->")  ;LESEN HTML-CODE ;read 
	. . QUIT:$TRANSLATE(YI(1),"| "_$CHAR(13)_$CHAR(10))=""
	. . ;
	. . ;DATEN AUS BELEG ;out of proof 
	. . FOR YIII=1:1:10 DO  QUIT:'$FIND(YI(1),"<DOCUMENT:")  ;MAX 10 DATENFELDER JE ZEILE ;once 
	. . . IF $FIND(YI(1),"<DOCUMENT:") DO
	. . . . SET LFN=""
	. . . . SET LFN(1)=""
	. . . . SET CLASS=$PIECE($PIECE($PIECE(YI(1),"<DOCUMENT",2),":",2),">",1)  ;Z.B. INAUFP ;e.g. 
	. . . . SET FIELD=$PIECE($PIECE($PIECE(YI(1),"<DOCUMENT",2),":",3),">",1)  ;Z.B. D4 ;e.g. 
	. . . . SET CODE=$PIECE($PIECE(YI(1),"<DOCUMENT:"_CLASS_":"_FIELD_">",2),"</DOCUMENT:"_CLASS_":"_FIELD_">",1)   ;BEC;24490;DAMIT <START></STOP> AUCH GEHT ;therewith too 
	. . . . IF +$EXTRACT(FIELD)'=0 SET LFN=$EXTRACT(FIELD),LFN(1)=LFN,FIELD=$EXTRACT(FIELD,2,99)  ;2D4 -> 2, D4     ;26390;FIS;16.09.04;NUMMER DER AUFBEREITUNG
	. . . . IF $FIND(CODE,"PIECE") SET LFN=+$PIECE(CODE,"PIECE",2)  ;26390;FIS;16.09.04;NUMMER DER AUFBEREITUNG
	. . . . SET VALUE=""
	. . . . IF CLASS'="" IF FIELD'="" DO
	. . . . . IF $DATA(^WWWSOR(YUSER,"XML",0,CLASS,FIELD)) DO  QUIT
	. . . . . . ;SET LFN="" FOR  SET LFN=$ORDER(^WWWSOR(YUSER,"XML",0,CLASS,FIELD,LFN)) QUIT:LFN=""  DO
	. . . . . . DO:LFN'=""  IF LFN="" FOR  SET LFN=$ORDER(^WWWSOR(YUSER,"XML",0,CLASS,FIELD,LFN)) QUIT:LFN=""  DO  QUIT:VALUE'=""  ;26390;FIS;16.09.04;NUMMER DER AUFBEREITUNG
	. . . . . . . SET VALUE=$PIECE($GET(^WWWSOR(YUSER,"XML",0,CLASS,FIELD,LFN)),Y,1)
	. . . . . . . IF VALUE="" IF $PIECE(HTML,Y,16)=1 SET VALUE="&nbsp;"
	. . . . . . . ;KILL ^WWWSOR(YUSER,"XML",0,CLASS,FIELD,LFN)  ;NUR 1 X
	. . . . . ;
	. . . . . IF $GET(POS)'="" IF $DATA(^WWWSOR(YUSER,"XML",POS,CLASS,FIELD)) DO
	. . . . . . ;SET LFN="" FOR  SET LFN=$ORDER(^WWWSOR(YUSER,"XML",POS,CLASS,FIELD,LFN)) QUIT:LFN=""  DO
	. . . . . . DO:LFN'=""  IF LFN="" FOR  SET LFN=$ORDER(^WWWSOR(YUSER,"XML",POS,CLASS,FIELD,LFN)) QUIT:LFN=""  DO  QUIT:VALUE'=""  ;26390;FIS;16.09.04;NUMMER DER AUFBEREITUNG
	. . . . . . . SET VALUE=$PIECE($GET(^WWWSOR(YUSER,"XML",POS,CLASS,FIELD,LFN)),Y,1)
	. . . . . . . IF VALUE="" IF $PIECE(HTML,Y,16)=1 SET VALUE="&nbsp;"
	. . . . . . . ;KILL ^WWWSOR(YUSER,"XML",POS,CLASS,FIELD,LFN)  ;NUR 1 X
	. . . . ;
	. . . . IF VALUE'="" IF CODE'="" IF $FIND(CODE,"<START>") SET VALUE=$PIECE(CODE,"<START>",1)_VALUE_$PIECE(CODE,"</STOP>",2)    ;BEC;24490;DAMIT <START></STOP> AUCH GEHT ;therewith too 
	. . . . IF $GET(POS)="X" SET VALUE="&nbsp;"
	. . . . IF $GET(POS)="Y" SET VALUE=""
	. . . . IF VALUE="" IF $PIECE(HTML,Y,16)=1 SET VALUE="&nbsp;"
	. . . . IF VALUE'="" SET VALUE=$$^WWWTRANSLATE(VALUE,$CHAR(128),"&euro;")       ;bec;14.14.04;25480;Eurozeichnen umsetzten
	. . . . SET YI(1)=$PIECE(YI(1),"<DOCUMENT:"_CLASS_":"_LFN(1)_FIELD_">",1)_$GET(VALUE)_$PIECE(YI(1),"</DOCUMENT:"_CLASS_":"_LFN(1)_FIELD_">",2)
	. . ;
	. . SET $PIECE(HTML(YZEILE),$CHAR(9),YI1)=YI(1)
	. ;
	. FOR YI1=1:1:1200 SET YI(1)=$PIECE(HTML(YZEILE),$CHAR(9),YI1) DO  QUIT:$FIND(YI(1),"<!--EOF-->")  ;LESEN HTML-CODE ;read 
	. . QUIT:$TRANSLATE(YI(1),"| "_$CHAR(13)_$CHAR(10))=""
	. . ;
	. . ;DATEN AUS KLASSE ;out of class 
	. . FOR YIII=1:1:10 DO  QUIT:'$FIND(YI(1),"<CLASS:")  ;MAX 10 DATENFELDER JE ZEILE ;once 
	. . . NEW NOREL,YADRESX,ADD,CODE
	. . . SET ADD=""
	. . . IF $FIND(YI(1),"<CLASS:") DO
	. . . . SET CLASS=$PIECE($PIECE($PIECE(YI(1),"<CLASS",2),":",2),">",1)
	. . . . SET FIELD=$PIECE($PIECE($PIECE(YI(1),"<CLASS",2),":",3),">",1)
	. . . . SET CODE=$PIECE($PIECE(YI(1),"<CLASS:"_CLASS_":"_FIELD_">",2),"</CLASS:"_CLASS_":"_FIELD_">",1)   ;BEC;24490;DAMIT <START></STOP> AUCH GEHT ;therewith too 
	. . . . SET VALUE=""
	. . . . IF CLASS'="" IF $EXTRACT(FIELD)="P" DO
	. . . . . IF CLASS="WWW0121" SET VALUE=$GET(YLOCATION) QUIT  ;LOCATION
	. . . . . IF CLASS="INKUNDE" SET VALUE=$GET(YKUNDE)    QUIT  ;CUSTOMER
	. . . . . IF CLASS="INLIEF"  SET VALUE=$GET(YLIEFER)   QUIT  ;SUPPLIER
	. . . . . IF (CLASS="INAUF") || (CLASS="INANG")                          SET VALUE=$GET(AUF) QUIT  ;ORDER
	. . . . . IF (CLASS="INAUFP") || (CLASS="INANGP") IF $EXTRACT(FIELD,2)=1 SET VALUE=$GET(AUF) QUIT  ;ORDER
	. . . . . IF (CLASS="INAUFP") || (CLASS="INANGP") IF $EXTRACT(FIELD,2)=2 SET VALUE=$GET(POS) QUIT  ;ORDER L.I.
	. . . . ;
	. . . . IF CLASS'="" IF ($EXTRACT(FIELD)="D") || ($EXTRACT(FIELD)="M") IF +$EXTRACT(FIELD,2,99)'=0 DO
	. . . . . IF CLASS="WWW0121" IF $GET(YLOCATION)'="" SET VALUE=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,+$EXTRACT(FIELD,2,99))   QUIT  ;LOCATION
	. . . . . IF CLASS="INKUNDE" IF $GET(YKUNDE)'=""    SET VALUE=$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,+$EXTRACT(FIELD,2,99))        QUIT  ;CUSTOMER
	. . . . . IF CLASS="INLIEF"  IF $GET(YLIEFER)'=""   SET VALUE=$PIECE($GET(^INLIEF(YM,YLIEFER,1)),Y,+$EXTRACT(FIELD,2,99))        QUIT  ;SUPPLIER
	. . . . . IF (CLASS="INAUF") || (CLASS="INANG") IF $GET(AUF1)'="" SET VALUE=$PIECE(AUF1,Y,+$EXTRACT(FIELD,2,99))                 QUIT  ;ORDER
	. . . . . IF CLASS="INAUFPK"                        SET VALUE=$PIECE($GET(^INAUFPK(YM,YAUFTRAG,POS,1)),Y,+$EXTRACT(FIELD,2,99))  QUIT  ;SUPPLIER L.I. ;12086
	. . . . . ;
	. . . . . ; FIXME : Should the following line also have a quit?
	. . . . . ; 
	. . . . . IF CLASS="INARTK"  if $get(POS1)'=""      set VALUE=$piece($get(^INARTK(YM,YAUFTRAG,POS,1)),Y,+$EXTRACT(FIELD,2,99))         ;SUPPLIER ITEM TERMS
	. . . . . IF (CLASS="INAUFP") || (CLASS="INANGP") IF $GET(POS1)'="" SET VALUE=$PIECE(POS1,Y,+$EXTRACT(FIELD,2,99))               QUIT  ;ORDER L.I.
	. . . . . SET YADRESX=$GET(YADRES)
	. . . . . IF $EXTRACT(CLASS,1,6)="INAUFA" IF +$EXTRACT(CLASS,7,99)'=0 SET YADRESX=$GET(^INAUFA(YM,YAUFTRAG,$EXTRACT(CLASS,7,99),1)) SET ADD=$EXTRACT(CLASS,7,99) SET CLASS=$EXTRACT(CLASS,1,6)
	. . . . . IF $EXTRACT(CLASS,1,6)="INANGA" IF +$EXTRACT(CLASS,7,99)'=0 SET YADRESX=$GET(^INANGA(YM,YAUFTRAG,$EXTRACT(CLASS,7,99),1)) SET ADD=$EXTRACT(CLASS,7,99) SET CLASS=$EXTRACT(CLASS,1,6)
	. . . . . IF (CLASS="INAUFA") || (CLASS="INANGA") DO
	. . . . . . IF YADRESX="" IF $GET(YKUNDE)'=""  SET YADRESX=$GET(^INKUNDE(YM,YKUNDE,1))  ;CUSTOMER
	. . . . . . IF YADRESX="" IF $GET(YLIEFER)'="" SET YADRESX=$GET(^INLIEF(YM,YLIEFER,1))  ;SUPPLIER
	. . . . . . IF YADRESX'="" SET VALUE=$PIECE(YADRESX,Y,+$EXTRACT(FIELD,2,99))            ;ADDRESS
	. . . . . . IF +$EXTRACT(FIELD,2,99)=14 IF SPRACHE'="DE" SET ADD=CLASS_ADD SET CLASS=""  ;24969;22.01.04;PLZ NICHT UMSETZEN / DO NOT EXPAND ZIP-CODE ;ZIP Not transact money privation 
	. . . . . ;
	. . . . . IF $PIECE(YADRESX,Y,17)'="" SET COUNTRY=$PIECE(YADRESX,Y,17)  ;ANDERES LAND ;rural 
	. . . . ;
	. . . . IF $GET(POS)="X" SET VALUE="&nbsp;"
	. . . . IF $GET(POS)="Y" SET VALUE=""
	. . . . IF $EXTRACT(FIELD)="D" IF +$EXTRACT(FIELD,2,99)'=0 IF CLASS'="" DO   ;D= RELATIONSFELDER UMSETZTEN
	. . . . . NEW YFELD,TRENN,YDATEI,FELD                                        ;M= NICHT UMSETZTEN !! ;Not 
	. . . . . SET TEXT=""
	. . . . . SET FELD=+$EXTRACT(FIELD,2,99)
	. . . . . SET $PIECE(YFELD,Y,FELD)=VALUE
	. . . . . SET YDATEI=CLASS
	. . . . . DO RELATION^INRELNAME
	. . . . . SET VALUE=TEXT
	. . . . ;
	. . . . IF VALUE'="" IF CODE'="" IF $FIND(CODE,"<START>") SET VALUE=$PIECE(CODE,"<START>",1)_VALUE_$PIECE(CODE,"</STOP>",2)    ;BEC;24490;DAMIT <START></STOP> AUCH GEHT ;therewith too 
	. . . . IF VALUE="" IF $PIECE(HTML,Y,16)=1 SET VALUE="&nbsp;"
	. . . . SET YI(1)=$PIECE(YI(1),"<CLASS:"_CLASS_ADD_":"_FIELD_">",1)_$GET(VALUE)_$PIECE(YI(1),"</CLASS:"_CLASS_ADD_":"_FIELD_">",2)
	. . ;
	. . ;<CODE:>  EINFÜGEN VON HTMLCODE, WENN DAS DATENFELD VORHANDEN IST
	. . ;
	. . FOR YIII=1:1:10 DO  QUIT:'$FIND(YI(1),"<CODE:")  ;MAX 10 DATENFELDER JE ZEILE ;once 
	. . . NEW TYPE,CLASS,FIELD,CODE
	. . . IF $FIND(YI(1),"<CODE:") DO
	. . . . SET TYPE =$PIECE($PIECE($PIECE(YI(1),"<CODE",2),":",2),">",1)
	. . . . SET CLASS=$PIECE($PIECE($PIECE(YI(1),"<CODE",2),":",3),">",1)
	. . . . SET FIELD=$PIECE($PIECE($PIECE(YI(1),"<CODE",2),":",4),">",1)
	. . . . SET VALUE=""
	. . . . IF CLASS'="" IF TYPE'="" IF FIELD'="" IF $GET(POS)'="" DO
	. . . . . SET CODE=$PIECE($PIECE(YI(1),"<CODE:"_TYPE_":"_CLASS_":"_FIELD_">",2),"</CODE:"_TYPE_":"_CLASS_":"_FIELD_">",1)
	. . . . . IF $DATA(^WWWSOR(YUSER,"XML",POS,CLASS,FIELD)) SET VALUE=$PIECE($GET(^WWWSOR(YUSER,"XML",POS,CLASS,FIELD,1)),Y,1)
	. . . . . IF VALUE'="" SET VALUE=CODE
	. . . . ;
	. . . . DO 
	. . . . . SET YI(1)=$PIECE(YI(1),"<CODE:"_TYPE_":"_CLASS_":"_FIELD_">",1)_$GET(VALUE)_$PIECE(YI(1),"</CODE:"_TYPE_":"_CLASS_":"_FIELD_">",2) 
	. . ;
	. . ;TAG FÜR ZEILE+  ;BEC;24490;DAMIT DIE ANZAHL HOCHGEZÄHLT WIRD
	. . ;I $E($G(VALUE))=2 W $G(VALUE)_"<BR>"
	. . ;<LF>   ;bec;25819;01.06.04; verschoben hinter CODE
	. . FOR YIII=1:1:10 DO  QUIT:'$FIND(YI(1),"<LF")  ;MAX 10 DATENFELDER JE ZEILE ;once 
	. . . IF $FIND(YI(1),"<LF") DO
	. . . . SET ANZ=$GET(ANZ)+($length(YI(1),"<LF></LF>")-1)
	. . . . SET VALUE=""
	. . . . ;SET YI(1)=$PIECE(YI(1),"<LF>",1)_$GET(VALUE)_$PIECE(YI(1),"</LF>",2)     ;BEC;25724;18.05.04
	. . . . SET YI(1)=$$^WWWTRANSLATE(YI(1),"<LF></LF>")
	. . . . SET YI(1)=$$^WWWTRANSLATE(YI(1),"<lf></lf>")
	. . ;
	. . ;
	. . SET $PIECE(HTML(YZEILE),$CHAR(9),YI1)=YI(1)
	. ;
	. SET HTML(YZEILE)=$PIECE(HTML(YZEILE),"<!--EOF-->",1)
	
	SET ^INDMS(YM,YREF,YSEITE,YZEILE,1)=$GET(HTML(YZEILE))
	QUIT
	
SENDLINK     ;BEC;26820;02.12.04;LINK ZUM VERSENDEN
	SET YADRES = $GET(YADRES)
	SET BELEG  = $GET(BELEG)
	
	IF $GET(YHTMLSEND)=0 IF $PIECE(YADRES,Y,15)=1 IF $PIECE(YADRES,Y,24)'="" DO  ;VIA EMAIL
	. NEW YI,YPRINT,YKEY,YBACK
	. SET LFN=8
	. IF YBELEG'=1 IF YBELEG'=2 IF YBELEG'=5 IF YBELEG'=7 IF YBELEG'=3 QUIT
	. IF (YBELEG=3) || (YBELEG=13) IF $GET(YLIEFER)="" QUIT
	. IF YBELEG=1  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|MAIL^INANGEBOT1&YKEY="_YAUFTRAG
	. IF YBELEG=2  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|MAIL^INAB1&YKEY="_YAUFTRAG
	. IF YBELEG=3  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|MAIL^INAUFBES1&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  ;BESTELLUNG ;sales order 
	. IF YBELEG=13 SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|MAIL^INAUFBESTORNO&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  
	. IF YBELEG=7  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|MAIL^INRECH1&YKEY="_YAUFTRAG
	. IF YBELEG=5  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|MAIL^INAUFAV1&YKEY="_YAUFTRAG
	.;IF YBELEG=10 SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|MAIL^INANGANF1&YKEY="_YAUFTRAG  ;ANFRAGE
	. DO VAR^WWWCGI
	. SET A=A_YI
	. SET A=A_""""
	. SET A=A_" TITLE="_""""_$$^WWWTEXT(34035,,1)_": "_$PIECE(YADRES,Y,24)_""""      ;BEC;26820;22.11.04
	. SET A=A_">"
	. SET A=A_$$^WWWTEXT(34035)     ;"via E-Mail";BEC;26820;22.11.04
	. SET A=A_"</A>"
	. SET A="<div class="_""""_"noprint"_""""_">"_A_"</div>"
	. WRITE A
	
	IF $GET(YHTMLSEND)=0 IF $PIECE(YADRES,Y,15)=2 IF $PIECE(YADRES,Y,22)'="" DO  ;VIA FAX
	. NEW YI,YPRINT,YKEY,YBACK
	. SET LFN=8
	. IF YBELEG'=1 IF YBELEG'=2 IF YBELEG'=5 IF YBELEG'=7 IF YBELEG'=3 QUIT 
	. IF (YBELEG=3) || (YBELEG=13) IF $GET(YLIEFER)=""  QUIT
	. IF YBELEG=1  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|FAX^INANGEBOT1&YKEY="_YAUFTRAG
	. IF YBELEG=2  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|FAX^INAB1&YKEY="_YAUFTRAG
	. IF YBELEG=3  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|FAX^INAUFBES1&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  ;BESTELLUNG ;sales order 
	. IF YBELEG=13 SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|FAX^INAUFBESTORNO&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  
	. IF YBELEG=7  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|FAX^INRECH1&YKEY="_YAUFTRAG
	. IF YBELEG=5  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|FAX^INAUFAV1&YKEY="_YAUFTRAG
	. DO VAR^WWWCGI
	. SET A=A_YI
	. SET A=A_""""
	. SET A=A_" TITLE="_""""_$$^WWWTEXT(34036,,1)_": "_$PIECE(YADRES,Y,22)_""""    ;;BEC;26820;22.11.04
	. SET A=A_">"
	. ;SET A=A_"via FAX"
	. SET A=A_$$^WWWTEXT(34036)    ;VIA FAX;BEC;26820;22.11.04
	. IF $GET(YFAX)'="" SET A=A_" "_YFAX
	. SET A=A_"</A>"
	. SET A=A_"</A>"
	. SET A="<div class="_""""_"noprint"_""""_">"_A_"</div>"
	. WRITE A
	
	IF $GET(YHTMLSEND)=0 IF $PIECE(YADRES,Y,15)=3 DO  ;IF $PIECE(YADRES,Y,24)'="" DO  ;VIA XML
	. NEW YI,YPRINT,YKEY,YBACK
	. SET LFN=8
	. IF YBELEG'=1 IF YBELEG'=2 IF YBELEG'=5 IF YBELEG'=7 IF YBELEG'=3 QUIT
	. IF (YBELEG=3) || (YBELEG=13) IF $GET(YLIEFER)=""  QUIT
	. IF YBELEG=1  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|XML^INANGEBOT1&YKEY="_YAUFTRAG
	. IF YBELEG=2  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|XML^INAB1&YKEY="_YAUFTRAG
	. IF YBELEG=3  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|XML^INAUFBES1&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  ;BESTELLUNG ;sales order 
	. IF YBELEG=13 SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|XML^INAUFBESTORNO&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  
	. IF YBELEG=7  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|XML^INRECH1&YKEY="_YAUFTRAG
	. IF YBELEG=5  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|XML^INAUFAV1&YKEY="_YAUFTRAG
	. DO VAR^WWWCGI
	. SET A=A_YI
	. SET A=A_""""
	. SET A=A_">"
	. ;SET A=A_"via XML"
	. SET A=A_$$^WWWTEXT(33150)    ;VIA XML;BEC;26820;22.11.04
	. SET A=A_"</A>"
	. SET A="<div class="_""""_"noprint"_""""_">"_A_"</div>"
	. WRITE A
	
	IF $GET(YHTMLSEND)=0 IF $PIECE(YADRES,Y,15)=4 DO  ;IF $PIECE(YADRES,Y,24)'="" DO  ;VIA EDI
	. NEW YI,YPRINT,YKEY,YBACK
	. SET LFN=8
	. IF YBELEG'=1 IF YBELEG'=2 IF YBELEG'=5 IF YBELEG'=7 IF YBELEG'=3 QUIT
	. IF (YBELEG=3) || (YBELEG=13) IF $GET(YLIEFER)=""  QUIT
	. IF YBELEG=1  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDI^INANGEBOT1&YKEY="_YAUFTRAG
	. IF YBELEG=2  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDI^INAB1&YKEY="_YAUFTRAG
	. IF YBELEG=3  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDI^INAUFBES1&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  ;BESTELLUNG ;sales order 
	. IF YBELEG=13 SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDI^INAUFBESTORNO&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  
	. IF YBELEG=7  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDI^INRECH1&YKEY="_YAUFTRAG
	. IF YBELEG=5  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDI^INAUFAV1&YKEY="_YAUFTRAG
	. DO VAR^WWWCGI
	. SET A=A_YI
	. SET A=A_""""
	. SET A=A_">"
	. ;SET A=A_"via EDI"
	. SET A=A_$$^WWWTEXT(34046)    ;VIA EDIFACT;BEC;26820;22.11.04
	. SET A=A_"</A>"
	. SET A="<div class="_""""_"noprint"_""""_">"_A_"</div>"
	. WRITE A
	
	IF $GET(YHTMLSEND)=0 IF $PIECE(YADRES,Y,15)=5 DO  ;VIA FTP
	. NEW YI,YPRINT,YKEY,YBACK
	. SET LFN=8
	. IF YBELEG'=1 IF YBELEG'=2 IF YBELEG'=5 IF YBELEG'=7 IF YBELEG'=3 QUIT
	. IF (YBELEG=3) || (YBELEG=13) IF $GET(YLIEFER)=""  QUIT
	. IF YBELEG=1  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|FTP^INANGEBOT1&YKEY="_YAUFTRAG
	. IF YBELEG=2  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|FTP^INAB1&YKEY="_YAUFTRAG
	. IF YBELEG=3  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|FTP^INAUFBES1&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  ;BESTELLUNG ;sales order
	. IF YBELEG=13 SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|FTP^INAUFBESTORNO&YKEY="_YAUFTRAG_","_$GET(YLIEFER)   
	. IF YBELEG=7  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|FTP^INRECH1&YKEY="_YAUFTRAG
	. IF YBELEG=5  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|FTP^INAUFAV1&YKEY="_YAUFTRAG
	. DO VAR^WWWCGI
	. SET A=A_YI
	. SET A=A_""""
	. SET A=A_">"
	. ;SET A=A_"via FTP"
	. SET A=A_$$^WWWTEXT(33152)    ;VIA FTP;BEC;26820;22.11.04
	. SET A=A_"</A>"
	. SET A="<div class="_""""_"noprint"_""""_">"_A_"</div>"
	. WRITE A
	
	IF $GET(YHTMLSEND)=0 IF $PIECE(YADRES,Y,15)=6 DO   ;IF $PIECE(YADRES,Y,24)'="" DO  ;VIA EDIPRO
	. NEW YI,YPRINT,YKEY,YBACK
	. SET LFN=8
	. IF YBELEG'=1 IF YBELEG'=2 IF YBELEG'=5 IF YBELEG'=7 IF YBELEG'=3 QUIT
	. IF (YBELEG=3) || (YBELEG=13) IF $GET(YLIEFER)=""  QUIT
	. IF YBELEG=1  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDIP^INANGEBOT1&YKEY="_YAUFTRAG
	. IF YBELEG=2  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDIP^INAB1&YKEY="_YAUFTRAG
	. IF YBELEG=3  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDIP^INAUFBES1&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  ;BESTELLUNG ;sales order 
	. IF YBELEG=13 SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDIP^INAUFBESTORNO&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  
	. IF YBELEG=7  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDIP^INRECH1&YKEY="_YAUFTRAG
	. IF YBELEG=5  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|EDIP^INAUFAV1&YKEY="_YAUFTRAG
	. DO VAR^WWWCGI
	. SET A=A_YI
	. SET A=A_""""
	. SET A=A_">"
	. ;SET A=A_"via EDIPro"
	. SET A=A_$$^WWWTEXT(34043)    ;VIA EDIPro;BEC;26820;22.11.04
	. SET A=A_"</A>"
	. SET A="<div class="_""""_"noprint"_""""_]]><![CDATA[">"_A_"</div>"
	. WRITE A
	
	IF $GET(YHTMLSEND)=0 IF $PIECE(YADRES,Y,15)=7 DO  ;VIA PDF
	. NEW YI,YPRINT,YKEY,YBACK
	. SET LFN=8
	. IF YBELEG'=1 IF YBELEG'=2 IF YBELEG'=5 IF YBELEG'=7 IF YBELEG'=3 QUIT
	. IF (YBELEG=3) || (YBELEG=13) IF $GET(YLIEFER)=""  QUIT
	. IF YBELEG=1  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|PDF^INANGEBOT1&YKEY="_YAUFTRAG
	. IF YBELEG=2  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|PDF^INAB1&YKEY="_YAUFTRAG
	. IF YBELEG=3  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|PDF^INAUFBES1&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  ;BESTELLUNG ;sales order
	. IF YBELEG=13 SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|PDF^INAUFBESTORNO&YKEY="_YAUFTRAG_","_$GET(YLIEFER)   
	. IF YBELEG=7  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|PDF^INRECH1&YKEY="_YAUFTRAG
	. IF YBELEG=5  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=D|PDF^INAUFAV1&YKEY="_YAUFTRAG
	. DO VAR^WWWCGI
	. SET A=A_YI
	. SET A=A_""""
	. SET A=A_">"
	. SET A=A_"via PDF"
	. SET A=A_$$^WWWTEXT(34044)    ;VIA PDF;BEC;26820;22.11.04
	. SET A=A_"</A>"
	. SET A="<div class="_""""_"noprint"_""""_">"_A_"</div>"
	. WRITE A
	
	IF $GET(YHTMLSEND)=0 IF $PIECE(YADRES,Y,15)=9 DO   ;IF $PIECE(YADRES,Y,24)'="" DO  ;VIA STANDARDSCHNITTSTELLE;FIS;20.02.04
	. NEW YI,YPRINT,YKEY,YBACK
	. SET LFN=8
	. IF YBELEG'=1 IF YBELEG'=2 IF YBELEG'=5 IF YBELEG'=7 IF YBELEG'=3 QUIT
	. IF (YBELEG=3) || (YBELEG=13) IF $GET(YLIEFER)=""  QUIT
	. IF YBELEG=1  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|STDIF^INANGEBOT1&YKEY="_YAUFTRAG
	. IF YBELEG=2  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|STDIF^INAB1&YKEY="_YAUFTRAG
	. IF YBELEG=3  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|STDIF^INAUFBES1&YKEY="_YAUFTRAG_","_$GET(YLIEFER)  ;BESTELLUNG ;sales order
	. IF YBELEG=13 SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|STDIF^INAUFBESTORNO&YKEY="_YAUFTRAG_","_$GET(YLIEFER)   
	. IF YBELEG=7  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|STDIF^INRECH1&YKEY="_YAUFTRAG
	. IF YBELEG=5  SET A="<A HREF="_""""_YAKTION_"EP=WWWMANU&YEXEC=*D|STDIF^INAUFAV1&YKEY="_YAUFTRAG
	. DO VAR^WWWCGI
	. SET A=A_YI
	. SET A=A_""""
	. SET A=A_">"
	. ;SET A=A_"via "_$PIECE($GET(^WWW101(0,"MEDIUM1",SPRACHE,9,1)),Y,1)
	. ;SET A=A_"via "_$PIECE($GET(^WWW101(0,"MEDIUM1",SPRACHE,9,1)),Y,1)     ;BEC;25866;07.06.04;DA ZENTRALE DATEI
	. SET A=A_$$^WWWTEXT(34045)_" "_$PIECE($GET(^WWW101(0,"MEDIUM1",SPRACHE,9,1)),Y,1)     ;BEC;26820;22.11.04
	. SET A=A_"</A>"
	. SET A="<div class="_""""_"noprint"_""""_">"_A_"</div>"
	. WRITE A
	
	QUIT
	
]]></Routine>
</Export>