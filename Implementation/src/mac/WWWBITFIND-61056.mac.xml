<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWBITFIND" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWBITFIND(YUSER,YDATEI,YNUMBER,YKEY,YORIENTATION,YSORT) ;WWWBITFIND;DT;SUCHEN BITS, UMWANDELN UND IN WWWSOR FÜR SEARCH EINBAUEN;  ; Compiled March 4, 2005 14:11:15
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		SUCHEN BITS, UMWANDELN UND IN WWWSOR FÜR SEARCH EINBAUEN
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	SUCHEN BITS, UMWANDELN UND IN WWWSOR FÜR SEARCH EINBAUEN
	;|
	;\------------------------------------------------------------------/
	;
	;
	;
	;YUSER = USER AUS WWWSOR(YUSER,"BIT"
	;DATEI = DATEI FÜR SUCHBILDER ;data file data file to 
	;YNUMBER = ANZAHL DER ZU SUCHENDEN FELDER "" = ALLE
	;YKEY = ANZEIGE AB (WELCHEM BIT) ;Show Confirm. 
	;YORIENTATION = 1 = VOR -1 =RUECK ;pre- 
	;
	;YSORT= DATEI/KEY,KEYn#DATEI/KEY,KEYn
	;z.b. #INPARTNFAVORIT/11700,1#INFAVORIT/1#INKUNDEFAVORIT/11700
	;
	;D ^WWWBITFIND(YUSER,YDATEI,YNUMBER,YKEY,YORIENTATION)  ;NUR BESTIMMTEDATEN
	;D ^WWWBITFIND(YUSER,YDATEI)   ;ALLES
	;
	;ERGEBNIS IST IN WWWSOR(YUSER,"KEY") VERWENDBAR IN D ^WWWSEAR3
	NEW FIELD,COUNT,COUNT1,COUNT2,YNUMBER1,YLKEY,YNKEY,YKEYX,RETURN,STRING,YYM,BIT,SCHL,BIT1,SORT1
	;
	SET YNUMBER1=0
	SET YLKEY=$GET(YKEY)
	SET YDATEI=$GET(YDATEI)
	QUIT:YDATEI="" ""
	SET YYM=$$^WWWYM(YDATEI)
	SET YMAXKEY=$ORDER(^WWW002(0,YDATEI,""),-1)
	IF $GET(YUSER)="" SET YUSER=0
	SET YNUMBER=$GET(YNUMBER)
	IF +YNUMBER=0 SET YNUMBER=1000
	SET YSTART=+$GET(YSTART)
	SET YORIENTATION=$GET(YORIENTATION)
	SET YKEYX=$GET(YKEY)  ;
	SET YORIENTATION=1                ;FAN;13.07.04; VORLÄUFIG.
	;
	SET YSORT=$GET(YSORT)
	IF YSORT'="" DO
	. FOR YSORT(1)=1:1 QUIT:$PIECE(YSORT,"#",YSORT(1))=""  DO
	. . NEW YDATEI1,YKEY1,YNOT
	. . SET YSORT(2)=$PIECE(YSORT,"#",YSORT(1))   ;n. File
	. . SET YNOT="",YNOT(1)=0
	. . SET YDATEI1=$PIECE(YSORT(2),"/",1)
	. . IF $EXTRACT(YDATEI1)="~" SET YNOT=1,YDATEI1=$EXTRACT(YDATEI1,2,99)  ;NICHT!  ;FIS;03.02.05
	. . QUIT:YDATEI1=""
	. . SET YKEY1=$PIECE(YSORT(2),"/",2)
	. . QUIT:YKEY1=""
	. . DO SEARCHRECORD
	. . DO FINDRECORD(YKEYX,"BITSET")
	. . IF YNOT(1)>0 IF $PIECE($GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YRESULT",1)),Y,1)'=0 DO
	. . . SET $PIECE(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YRESULT",1),Y,1)=$PIECE($GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YRESULT",1)),Y,1)-YNOT(1)
	. . . QUIT
	. . QUIT
	. QUIT
	;
	;
	DO FINDRECORD(YKEYX,"BIT")
	QUIT
	;
	
FINDRECORD(YKEY,BITNAME) ; 
	;
	SET COUNT=$GET(YKEY)\64000-1   ;FELD IN DER EBENE ;field within the plain 
	IF COUNT=-1 SET COUNT=""
	IF YORIENTATION'=-1 DO
	. FOR COUNT1=0:1 SET COUNT=$ORDER(^WWWSOR(YUSER,BITNAME,0,COUNT)) QUIT:COUNT=""  DO  QUIT:YNUMBER1'<YNUMBER   ;GENUG GEFUNDEN ;sufficiently 
	. . SET STRING=$GET(^WWWSOR(YUSER,BITNAME,0,COUNT))
	. . SET BIT=0
	. . SET BIT1=0
	. . SET YKEY=$GET(YKEY)
	. . IF COUNT1=0 SET BIT1=+YKEY#64000-1 SET:BIT1<0 BIT1=0  ;FELD IN DER EBENE  ;field within the plain 
	. . FOR COUNT2=0:1 SET BIT=$BITFIND(STRING,1,BIT+1) QUIT:+BIT=0  IF COUNT2'<BIT1 DO  QUIT:YNUMBER1'<YNUMBER
	. . . SET YLKEY=BIT+(COUNT*64000)-1
	. . . SET YNUMBER1=YNUMBER1+1
	. . . ;SET YKEY=YLKEY ;table-mat 
	. . . SET YKEY=""
	. . . SET SCHL(1)="^"_YDATEI_"bi("_""""_YYM_""""_",1,YLKEY)"
	. . . SET SCHL(2)="^"_YDATEI_"bi("_""""_YYM_""""_",1,YLKEY,"_""""_""""_")"
	. . . QUIT:'$DATA(@SCHL(1))
	. . . IF $DATA(@SCHL(1)) DO   ;SONDERKEY VORHANDEN ;on hand 
	. . . . SET YKEY=$ORDER(@SCHL(2))
	. . . . ;IF YKEY="" SET YKEY=YLKEY
	. . . . QUIT
	. . . QUIT:YKEY=""
	. . . ;IF $GET(YSORT)'="" QUIT:$DATA(^WWWSOR(YUSER,"SEL",YKEY))  ;TYBD;3,1,2005
	. . . ;IF $GET(YSORT)'="" QUIT:$DATA(^WWWSOR(YUSER,"NOT",YKEY))  ;TYBD;3,1,2005
	. . . IF $GET(YSORT)'="" IF $DATA(^WWWSOR(YUSER,"SEL",YKEY)) SET YNUMBER1=YNUMBER1-1 QUIT  ;FIS;9,2,2005
	. . . IF $GET(YSORT)'="" IF $DATA(^WWWSOR(YUSER,"NOT",YKEY)) SET YNUMBER1=YNUMBER1-1 QUIT  ;FIS;9,2,2005
	. . . IF $GET(YNOT)=1 DO  QUIT
	. . . . SET ^WWWSOR(YUSER,"NOT",YKEY)=""
	. . . . SET YNOT(1)=$GET(YNOT(1))+1
	. . . . SET YNUMBER1=YNUMBER1-1
	. . . . QUIT
	. . . SET ^WWWSOR(YUSER,"SEL",YKEY)=""
	. . . SET ^WWWSOR(YUSER,"KEY",YNUMBER1,YKEY)="^"_YDATEI_"("_""""_YYM_""""_","_YKEY_","_1_")"
	. . . QUIT
	. . QUIT
	. QUIT
	IF YORIENTATION=-1 DO
	. FOR  SET COUNT=$ORDER(^WWWSOR(YUSER,BITNAME,0,COUNT)) QUIT:COUNT=""  DO  QUIT:YNUMBER1'<YNUMBER   ;GENUG GEFUNDEN ;sufficiently 
	. . SET STRING=$GET(^WWWSOR(YUSER,BITNAME,0,COUNT))
	. . SET BIT=0 FOR  SET BIT=$BITFIND(STRING,1,BIT+1,-1) QUIT:+BIT=0  DO  QUIT:YNUMBER1'<YNUMBER
	. . . SET YLKEY=BIT+(COUNT*64000)-1
	. . . SET YNUMBER1=YNUMBER1+1
	. . . SET YKEY=YLKEY
	. . . SET SCHL(1)="^"_YDATEI_"bi("_""""_YYM_""""_",1,YLKEY)"
	. . . SET SCHL(2)="^"_YDATEI_"bi("_""""_YYM_""""_",1,YLKEY,"_""""_""""_")"
	. . . IF $DATA(@SCHL(1)) DO   ;SONDERKEY VORHANDEN ;on hand 
	. . . . SET YKEY=$ORDER(@SCHL(2))
	. . . . IF YKEY="" SET YKEY=YLKEY
	. . . . QUIT
	. . . ;IF $GET(YSORT)'="" QUIT:$DATA(^WWWSOR(YUSER,"SEL",YKEY))  ;TYBD;3,1,2004
	. . . ;IF $GET(YSORT)'="" QUIT:$DATA(^WWWSOR(YUSER,"NOT",YKEY))  ;TYBD;3,1,2004
	. . . IF $GET(YSORT)'="" IF $DATA(^WWWSOR(YUSER,"SEL",YKEY)) SET YNUMBER1=YNUMBER1-1 QUIT  ;FIS;9,2,2005
	. . . IF $GET(YSORT)'="" IF $DATA(^WWWSOR(YUSER,"NOT",YKEY)) SET YNUMBER1=YNUMBER1-1 QUIT  ;FIS;9,2,2005
	. . . IF $GET(YNOT)=1 DO  QUIT
	. . . . SET ^WWWSOR(YUSER,"NOT",YKEY)=""
	. . . . SET YNOT(1)=$GET(YNOT(1))+1
	. . . . SET YNUMBER1=YNUMBER1-1
	. . . . QUIT
	. . . SET ^WWWSOR(YUSER,"SEL",YKEY)=""
	. . . SET ^WWWSOR(YUSER,"KEY",YNUMBER1,YKEY)="^"_YDATEI_"("_""""_YYM_""""_","_YKEY_","_1_")"
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
	;
	;
	
SEARCHRECORD ;
	;
	SET FILE="^"_YDATEI1_"b("_""""_$$^WWWYM(YDATEI1,0)_""""_","_0_","_""""_YKEY1_""""_","_"COUNT"_")"
	SET FILE2="^"_YDATEI1_"b("_""""_$$^WWWYM(YDATEI1,0)_""""_","_0_","_""""_YKEY1_""""_","_"COUNT"_")"
	SET FILE1="^WWWSOR(YUSER,"_""""_"BIT"_""""_",0,"_"COUNT"_")"  ;NORMALER LOOCKUP 
	;
	SET COUNT="" FOR  SET COUNT=$ORDER(@FILE) QUIT:COUNT=""  DO
	. SET FILE(1)=$GET(@FILE1)
	. SET FILE(2)=$GET(@FILE2) 
	. DO
	. . SET RESULT=$BITLOGIC(FILE(2)&FILE(1))
	. . SET ^WWWSOR(YUSER,"BITSET",0,COUNT)=RESULT   ;NORMALER SAVE
	. . QUIT
	. QUIT
	QUIT
]]></Routine>
</Export>