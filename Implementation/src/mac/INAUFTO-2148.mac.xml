<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFTO" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFTO
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		TOUR PLANEN / AUFLISTEN DER EINGETEILTEN POSITIONEN IM MONAT
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 04-Jun-2010	GRF		SR17146: call "DD.MM.YYYY" wrapper for WWWDATE1; </FONT>
	; 17-May-2006	GRF		Doco; dot level
	; 21-Dec-2005	Steve S	SR13993: Check tour date
	; 05.08.2000	DT		Created
	;-------------------------------------------------------------------------------
	NEW VORG,LITM,MONAT,MON,JAH,A,MENDE,AUF,AUF1,POS,POS1,YDAT,YDATV,WOCHE,MONG,UHR,TAG,DATE
	
	SET AUF=$PIECE(YKEY,",",1)                        ; FAN 20.07.2001 ;buff 
	QUIT:AUF=""
	SET ^WWW126(YM,"INAUF",YBED,1,1)=AUF
	SET POS=$PIECE(YKEY,",",2)
	QUIT:POS=""
	
	;---------------------------------------
	
	IF $DATA(^INAUFP(YM,AUF,POS,1)) IF $PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,205)=1 DO
	. WRITE "<BR><FONT COLOR="_YRED_">"_"<B>"_$$^WWWTEXT(185)_"</B>"
	. WRITE ": "_$$^WWWTEXT(32047)_" "_$$^WWWTEXT(216)_" "_AUF_"-"_POS_" "_$$^WWWTEXT(32285)_" "_$$^WWWTEXT(10004)_"!"
	. WRITE "</FONT><BR><BR>"
	
	SET VORG=$GET(%(YQUERY,"YFUNCT1"))
	IF VORG="" SET VORG=$PIECE($GET(^INVORG(YM,YM,1)),Y,57)
	IF VORG="" SET VORG=1
	SET DATE=$GET(%(YQUERY,"YFUNCT"))
	IF DATE="" DO
	. SET DATE=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,76)
	. ;SR13993: Check tour date
	. IF DATE>10000 if $$IncludeTour^INTOURCHECK(DATE) SET ^INTOUR(YM,DATE,1)=""  ;MÖGLICHES TOURDATUM
	
	IF DATE<10000 SET DATE=+$HOROLOG
	IF $PIECE($GET(^INVORG(YM,YM,1)),Y,198)=1 QUIT  ;TYBD;26086;NICHT ANZEIGEN, WENN ZU VIELE;16,11,2004
	
	;BUTTONS
	;-------------------------
	DO START^WWWBUTTON(90)
	;MONAT ;month 
	DO
	. NEW YI,YTXT
	. SET YI=YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1="_0
	. DO VAR^WWWCGI
	. DO BUTTON^WWWBUTTON($EXTRACT($$^WWWTEXT(33384)),YI,$$^WWWTEXT(33384))  ;  ;MONAT ;month 
	WRITE "<td>&nbsp;</td>"
	
	;WOCHE ;week 
	DO
	. NEW YI,YTXT
	. SET YI=YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1="_1
	. DO VAR^WWWCGI
	. DO BUTTON^WWWBUTTON($EXTRACT($$^WWWTEXT(33383)),YI,$$^WWWTEXT(33383))  ;  ;WOCHE ;week 
	WRITE "<td>&nbsp;</td>"
	
	;TAG
	DO
	. NEW YI,YTXT
	. SET YI=YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1="_2
	. DO VAR^WWWCGI
	. DO BUTTON^WWWBUTTON($EXTRACT($$^WWWTEXT(33385)),YI,$$^WWWTEXT(33385))  ;  ;TAG
	WRITE "<td>&nbsp;</td>"
	
	;VOR ;pre- 
	DO
	. NEW YI,YTXT,YFUNCT,YFUNCT1
	. SET YI=YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT="
	. IF VORG=0 SET YI=YI_(DATE-$$^WWWMONTHDAYS(DATE))_"&YFUNCT1=0" SET YTXT="-"_$$^WWWTEXT(33384)  ;1 MONAT VOR ;month pre- 
	. IF VORG=1 SET YI=YI_(DATE-7)_"&YFUNCT1=1" SET YTXT="-"_$$^WWWTEXT(33383)  ;1 WOCHE VOR ;week pre- 
	. IF VORG=2 SET YI=YI_(DATE-1)_"&YFUNCT1=2" SET YTXT="-"_$$^WWWTEXT(33385)  ;1 TAG VOR ;TAG pre- 
	. DO VAR^WWWCGI
	. DO BUTTON^WWWBUTTON(YTXT,YI,"-"_$$^WWWTEXT(33384))
	WRITE "<td>&nbsp;</td>"
	
	;ZURÜCK ;retro-  ;back 
	DO
	. NEW YI,YTXT,YFUNCT,YFUNCT1
	. SET YI=YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT="
	. IF VORG=0 SET YI=YI_(DATE+$$^WWWMONTHDAYS(DATE))_"&YFUNCT1=0" SET YTXT="+"_$$^WWWTEXT(33384)  ;1 MONAT WEITER ;month ulterior 
	. IF VORG=1 SET YI=YI_(DATE+7)_"&YFUNCT1=1" SET YTXT="+"_$$^WWWTEXT(33383)  ;1 WOCHE WEITER ;week ulterior 
	. IF VORG=2 SET YI=YI_(DATE+1)_"&YFUNCT1=2" SET YTXT="+"_$$^WWWTEXT(33385)  ;1 TAG WEITER ;TAG ulterior 
	. DO VAR^WWWCGI
	. DO BUTTON^WWWBUTTON(YTXT,YI,"+"_$$^WWWTEXT(33384))
	
	DO END^WWWBUTTON
	
	;IF SPRACHE="DE" DO
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1="_0
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"M.gif"_""""_" BORDER=0 TITLE='Monat &Uuml;bersicht'></A>"
	;. ;
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1="_1
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"W.gif"_""""_" BORDER=0 TITLE='Woche &Uuml;bersicht'></A>"
	;. ;
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1="_2
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"T.gif"_""""_" BORDER=0 TITLE='Tag &Uuml;bersicht'></A>"
	;
	;IF SPRACHE'="DE" DO
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1="_0
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"M.gif"_""""_" BORDER=0 TITLE='Month of overview'></A>"
	;. ;
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1="_1
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"W.gif"_""""_" BORDER=0 TITLE='Week of overview'></A>"
	;. ;
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1="_2
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"D.gif"_""""_" BORDER=0 TITLE='Day of overview'></A>"
	
	WRITE "&nbsp;"
	IF VORG=0 DO INAUFTOM
	IF VORG=1 DO INAUFTOW
	IF VORG=2 DO INAUFTOT
	QUIT
	
INAUFTOM    ;MONATSÜBERSICHT
	;SET MONAT=$GET(%(YQUERY,"YFUNCT"))
	;IF MONAT="" DO  ;MONAT DER AUFTRAGSPOSITION
	;. SET MONAT=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,76)
	;. IF MONAT>10000 SET ^INTOUR(YM,MONAT,1)=""  ;MÖGLICHES TOURDATUM
	;
	;IF MONAT<10000 SET MONAT=+$HOROLOG ;table-mat 
	
	SET MONAT=DATE
	SET MONATM=MONAT-$$^WWWMONTHDAYS(MONAT)
	SET MONATP=MONAT+$$^WWWMONTHDAYS(MONAT)
	WRITE "<FONT FACE=ARIAL>"
	SET MON=$$^WWWMONTH(MONAT)
	SET JAH=$$^WWWYEAR(MONAT)
	SET A="312831303130313130313031"
	SET MENDE=$EXTRACT(A,2*MON-1,2*MON) IF JAH#4=0&(+MON=2) SET MENDE=29  ;max tage im Monat ;From Date 
	
	;IF SPRACHE="DE" DO
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=0&YFUNCT="_MONATM
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"monatm.gif"_""""_" BORDER=0 TITLE='Monat zur&uuml;ck'></A>"
	;. ;
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=0&YFUNCT="_MONATP
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"monatp.gif"_""""_" BORDER=0 TITLE='Monat vor'></A>"
	;
	;IF SPRACHE'="DE" DO
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=0&YFUNCT="_MONATM
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"mmonth.gif"_""""_" BORDER=0 TITLE='month back'></A>"
	;. ;
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=0&YFUNCT="_MONATP
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"pmonth.gif"_""""_" BORDER=0 TITLE='next month'></A>"
	
	WRITE "<b>"
	WRITE "&nbsp;&nbsp;&nbsp;"
	WRITE $$^WWWTEXT(32100)_": "_$PIECE($GET(^WWW101(0,"MONAT",SPRACHE,+MON,1)),Y,1)_" - "_JAH  
	WRITE "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  
	WRITE "</b>"    
	
	;IF $GET(YKEY)'="" DO  ;TRACKING
	;. NEW AUF,POS,TRACK,TRACK1,VERSAND,URL
	;. SET AUF=$PIECE(YKEY,",",1)
	;. SET ^WWW126(YM,"INAUF",YBED,1,1)=AUF
	;. SET POS=$PIECE(YKEY,",",2)
	;. IF AUF'="" IF POS'="" DO
	;. . SET TRACK=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,104)  ;TRACKING NUMMER
	;. . IF TRACK'="" DO
	;. . . SET VERSAND=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,95)  ;VERSENDER
	;. . . IF VERSAND'="" DO
	;. . . . SET URL=$PIECE($GET(^INSPED(YM,VERSAND,1)),Y,27)  ;TRACKING URL
	;. . . . I URL'="" D
	;. . . . . SET URL=URL_TRACK
	;. . . . . WRITE "<A HREF="
	;. . . . . WRITE URL
	;. . . . . WRITE ">"
	;. . . . . WRITE YCR,"<IMG SRC="_""""_YGIF_"tracking-b.gif"_""""_" BORDER=0 TITLE='tracking'></A>"
	
	DO LINK ;LINK FÜR TRAKING UND VERSANDAUFKLEBER BEC;06.08.03;24116;IN EIGENES LABEL
	DO START100^WWWTAB 
	WRITE "<TR>"
	WRITE "<TH BGCOLOR="_YDARKGRAY_" ALIGN=LEFT WIDTH=150>"
	WRITE "<FONT SIZE=1>&nbsp;</FONT>"
	WRITE "</TH>"
	
	FOR I=1:1:MENDE DO
	. WRITE YCR
	. WRITE "<TH BGCOLOR="_YDARKGRAY_" ALIGN=LEFT><FONT SIZE=1>"
	. WRITE $EXTRACT(100+I,2,3)
	. WRITE "<BR>"
	. SET YDATE = $$DMY^WWWDATE1($EXTRACT(100+I,2,3)_"."_$EXTRACT(100+MON,2,3)_"."_JAH)   ; SR17146
	. SET A1    = $$^WWWTEXT(30022)   ; "Monday,Tuesday,Wed..."
	. WRITE $EXTRACT($PIECE(A1,",",$$^WWWDAY(YDATE)),1,2)
	. WRITE "</FONT></TH>"
	
	WRITE "</TR>"
	
	SET YDATV = $$DMY^WWWDATE1("01."_$EXTRACT(100+MON,2,3)_"."_JAH)  ;SUCHEN AB ;seek Confirm. ; SR17146
	FOR YDAT=YDATV:1:(YDATV+MENDE) DO
	. NEW YKEY
	. SET YTOUR=""
	. FOR  SET YTOUR=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR)) QUIT:YTOUR=""  DO
	. . SET AUF=""
	. . FOR  SET AUF=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR,AUF)) QUIT:AUF=""  DO
	. . . SET POS=""
	. . . FOR  SET POS=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR,AUF,POS)) QUIT:POS=""  DO
	. . . . SET POS1=$GET(^INAUFP(YM,AUF,POS,1))
	. . . . SET AUF1=$GET(^INAUF(YM,AUF,1))
	. . . . WRITE YCR
	. . . . SET LITM=$PIECE(AUF1,Y,19)
	. . . . WRITE YCR,YCR,"<TR>"
	. . . . WRITE YCR,"<TD NOWRAP ALIGN=TOP"
	. . . . IF $PIECE(POS1,Y,92)="" IF LITM'="" IF LITM<$HOROLOG WRITE " BGCOLOR=RED"  ;NOCH NICHT AUSGELIEFERT ABER VERGANGENTEIT!! ;yet Not yet 
	. . . . IF $PIECE(POS1,Y,92)="" IF $PIECE(POS1,Y,76)'="" IF LITM'="" IF LITM'<$HOROLOG IF LITM<$PIECE(POS1,Y,76) WRITE " BGCOLOR=YELLOW"  ;KUNDE WOLLTE FRUEHER ;customer 
	. . . . IF +LITM=+$HOROLOG WRITE " BGCOLOR=YELLOW"
	. . . . WRITE ">"
	. . . . WRITE YCR,"<FONT SIZE=2>"
	. . . . WRITE YCR,"<A TITLE="_""""
	. . . . ;WRITE $$^WWWTEXT(32041)_" "
	. . . . ;SET POSX="" FOR  SET POSX=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR,AUF,POSX)) QUIT:POSX'=""  WRITE POSX_" "
	. . . . ;WRITE $CHAR(10)
	. . . . IF LITM'="" IF LITM<$HOROLOG WRITE $$^WWWTEXT(32063)_" "_$$^WWWDATE(LITM)_$CHAR(10)  ;ACHTUNG TERMIN! ;estimation 
	. . . . IF LITM="" WRITE $$^WWWTEXT(32063)_" ??.??.????"_$CHAR(10)  ;ACHTUNG TERMIN! ;estimation 
	. . . . IF $PIECE(AUF1,Y,2)=1 WRITE $PIECE($GET(^WWW101(0,"AUFTRAGSART",SPRACHE,1,1)),Y,1)  ;EIGENAUFTRAG
	. . . . IF +$PIECE(AUF1,Y,2)=0 IF $PIECE(AUF1,Y,1)'="" WRITE $PIECE($GET(^INKUNDE(YM,$PIECE(AUF1,Y,1),1)),Y,8)
	. . . . WRITE $CHAR(10)_$PIECE(POS1,Y,1)  ;POSITION
	. . . . WRITE """"
	. . . . WRITE " HREF="_YAKTION_"EP=WWWFORM&YFORM=INAUFP&YKEY="_AUF_","_POS_"&YFKEY="_AUF_"&YBACK=INAUFBANZ,INAUFTO,&YFUNCT="_MONAT
	. . . . DO ^WWWCGI
	. . . . WRITE ">"
	. . . . WRITE YCR_AUF_"-"_POS
	. . . . WRITE "</A>"
	. . . . WRITE "</FONT>"
	. . . . WRITE "</TD>"
	. . . . ;
	. . . . FOR TAG=1:1:MENDE DO
	. . . . . NEW JN
	. . . . . WRITE YCR
	. . . . . WRITE "<TD ALIGN=LEFT WIDTH=26"
	. . . . . SET SSN   = 0
	. . . . . SET YDATE = $$DMY^WWWDATE1($EXTRACT(100+TAG,2,3)_"."_$EXTRACT(100+MON,2,3)_"."_JAH)  ; SR17146
	. . . . . IF YDATE'="" IF $DATA(^TERMIN9(0,"DE",YDATE,1)) WRITE " BGCOLOR=MISTYROSE" SET SSN=1   ;FEIERTAG ;holiday 
	. . . . . SET JN=""
	. . . . . IF YDAT=YDATE SET JN=1  ;DATUM DER AUSLIEFERUNG ;Date the handover 
	. . . . . IF JN="" IF $$^WWWDAY(YDATE)>5 WRITE " BGCOLOR=MISTYROSE" SET SSN=1  ;SONN UND FEIERTAG ;And holiday 
	. . . . . IF JN="" IF SSN=0 WRITE " BGCOLOR="_YWHITE
	. . . . . IF JN'=""         WRITE " BGCOLOR=BLUE"
	. . . . . WRITE ">"
	. . . . . WRITE "<FONT SIZE=1>"
	. . . . . IF JN=1 DO
	. . . . . . WRITE YCR,"<A "
	. . . . . . WRITE "TITLE="_""""_$TRANSLATE($PIECE(POS1,Y,1),"""")_$CHAR(10)_"Tour: "_YTOUR_" "_$$^WWWTEXT(187)_": "_$$^WWWTIME($PIECE(POS1,Y,100))_""""   ;TOURNUMMER UND UHRZEIT   ;And 
	. . . . . . WRITE " HREF="
	. . . . . . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YKEY="_AUF_","_POS_"&YFUNCT="_MONAT
	. . . . . . SET YBACK="INAUFBANZ,"
	. . . . . . DO ^WWWCGI
	. . . . . . WRITE ">"
	. . . . . ;
	. . . . . ;WRITE "&nbsp;"
	. . . . . IF JN=1 WRITE YCR,"X"
	. . . . . IF SSN=1 IF JN'=1 WRITE "-"        ;WRITE "&nbsp;"
	. . . . . IF SSN=0 IF JN'=1 WRITE "&nbsp;"   ;WRITE "&nbsp;&nbsp;"
	. . . . . ;WRITE "&nbsp;"
	. . . . . IF JN=1 WRITE "</A>"
	. . . . . WRITE "</FONT></TD>"
	. . . . ;
	. . . . WRITE "</TR>"
	
	WRITE "</TABLE>"
	QUIT
	
INAUFTOW    ;WOCHEN ÜBERSICHT ;weekly summary 
	;SET WOCHE=$GET(%(YQUERY,"YFUNCT"))
	;IF WOCHE="" DO  ;WOCHE DER AUFTRAGSPOSITION
	;. SET WOCHE=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,76)
	;. IF WOCHE>10000 SET ^INTOUR(YM,WOCHE,1)=""  ;MÖGLICHES TOURDATUM
	;
	;IF WOCHE<10000 SET WOCHE=+$HOROLOG ;table-mat
	
	SET WOCHE=DATE
	SET WOCHEM=WOCHE-7
	SET WOCHEP=WOCHE+7
	WRITE "<FONT FACE=ARIAL>"
	
	;IF SPRACHE="DE" DO
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=1&YFUNCT="_WOCHEM
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"wochem.gif"_""""_" BORDER=0 TITLE='Woche zur&uuml;ck'></A>"
	;. ;
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=1&YFUNCT="_WOCHEP
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"wochep.gif"_""""_" BORDER=0 TITLE='Woche vor'></A>"
	;
	;IF SPRACHE'="DE" DO
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=1&YFUNCT="_WOCHEM
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"mweek.gif"_""""_" BORDER=0 TITLE='week back'></A>"
	;. ;
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=1&YFUNCT="_WOCHEP
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"pweek.gif"_""""_" BORDER=0 TITLE='next week '></A>"
	
	SET MONG=WOCHE-(WOCHE+3#7)   ;MONTAG VON DEISE WOCHE ;Monday week 
	WRITE "<b>"
	WRITE "&nbsp;&nbsp;&nbsp;"
	WRITE $$^WWWTEXT(32100)_": "_$EXTRACT($$^WWWWEEK(MONG),1,2)_"."_$$^WWWTEXT(31001)_" ("_$$^WWWTEXT(31002)_" "_$$^WWWDATE(MONG)_" "_$$^WWWTEXT(31003)_" "_$$^WWWDATE(MONG+6)_")"
	; z.B.  Auslieferungsplan: 28.kw (vom 09.07.2001 bis 15.07.2001) ;e.g. To 
	WRITE "&nbsp;"  
	WRITE "</b>"
	
	;IF $GET(YKEY)'="" DO  ;TRACKING
	;. NEW AUF,POS,TRACK,TRACK1,VERSAND,URL
	;. SET AUF=$PIECE(YKEY,",",1)
	;. SET ^WWW126(YM,"INAUF",YBED,1,1)=AUF
	;. SET POS=$PIECE(YKEY,",",2)
	;. IF AUF'="" IF POS'="" DO
	;. . SET TRACK=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,104)  ;TRACKING NUMMER
	;. . IF TRACK'="" DO
	;. . . SET VERSAND=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,95)  ;VERSENDER
	;. . . IF VERSAND'="" DO
	;. . . . SET URL=$PIECE($GET(^INSPED(YM,VERSAND,1)),Y,27)  ;TRACKING URL
	;. . . . I URL'="" D
	;. . . . . SET URL=URL_TRACK
	;. . . . . WRITE "&nbsp;"
	;. . . . . WRITE YCR,"<A HREF="
	;. . . . . WRITE URL
	;. . . . . WRITE " TARGET=TEILE22"							;bEC;24116;06.08.03; NEUES FENSTER STARTEN
	;. . . . . WRITE ">"
	;. . . . . WRITE "<IMG SRC="_""""_YGIF_"tracking-b.gif"_""""_" BORDER=0 TITLE='"_$$^WWWTEXT(33559)_"' height=25></A>"		;33559 - tracking
	;. . . . ;
	;. . . . ;AUFKLEBER
	;. . . . SET URL=$PIECE($GET(^INSPED(YM,VERSAND,1)),Y,28)  ;AUFKLEBER URL	;bEC;24116;06.08.03;AUFKLEBER EINGEFÜGT
	;. . . . I URL'="" D
	;. . . . . SET URL=URL_TRACK
	;. . . . . WRITE "&nbsp;"
	;. . . . . WRITE YCR,"<A HREF="
	;. . . . . WRITE URL
	;. . . . . WRITE " TARGET=TEILE22"							
	;. . . . . WRITE ">"
	;. . . . . WRITE "<IMG SRC="_""""_YGIF_"barcodes.gif"_""""_" BORDER=0 TITLE='"_$$^WWWTEXT(32605)_"' height=25></A>"			;32605  - Aufkleber drucken 
	
	DO LINK ;LINK FÜR TRAKING UND VERSANDAUFKLEBER BEC;06.08.03;24116;IN EIGENES LABEL
	DO START100^WWWTAB 
	WRITE "<TR>"
	WRITE "<TH BGCOLOR="_YDARKGRAY_" ALIGN=LEFT WIDTH=150>"
	WRITE "<FONT SIZE=1>&nbsp;</FONT>"
	WRITE "</TH>"
	
	FOR TAGW=0:1:6 DO
	. WRITE YCR
	. WRITE "<TH BGCOLOR="_YDARKGRAY_" ALIGN=LEFT>"
	. WRITE "<FONT SIZE=1>"        
	. SET A1=$$^WWWTEXT(30022)
	. WRITE "<B>"_$PIECE(A1,",",1+TAGW)_"</B>"_"<BR>"
	. WRITE $$^WWWDATE(MONG+TAGW)          
	. WRITE "</FONT></TH>"
	WRITE "</TR>"
	
	SET YDATV=MONG  ;SUCHEN AB MONTAG ;seek Confirm. Monday 
	FOR YDAT=YDATV:1:(YDATV+6) DO
	. NEW YKEY
	. SET YTOUR=""
	. FOR  SET YTOUR=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR)) QUIT:YTOUR=""  DO
	. . SET AUF=""
	. . FOR  SET AUF=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR,AUF)) QUIT:AUF=""  DO
	. . . SET POS=""
	. . . FOR  SET POS=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR,AUF,POS)) QUIT:POS=""  DO
	. . . . SET POS1=$GET(^INAUFP(YM,AUF,POS,1))
	. . . . SET AUF1=$GET(^INAUF(YM,AUF,1))
	. . . . WRITE YCR
	. . . . SET LITM=$PIECE(AUF1,Y,19)
	. . . . WRITE "<TR>"
	. . . . WRITE "<TD NOWRAP ALIGN=TOP"
	. . . . IF $PIECE(POS1,Y,92)="" IF LITM'="" IF LITM<$HOROLOG WRITE " BGCOLOR=RED"  ;NOCH NICHT AUSGELIEFERT ABER VERGANGENTEIT!! ;yet Not yet 
	. . . . IF $PIECE(POS1,Y,92)="" IF $PIECE(POS1,Y,76)'="" IF LITM'="" IF LITM'<$HOROLOG IF LITM<$PIECE(POS1,Y,76) WRITE " BGCOLOR=YELLOW"  ;KUNDE WOLLTE FRUEHER ;customer 
	. . . . IF +LITM=+$HOROLOG WRITE " BGCOLOR=YELLOW"
	. . . . WRITE ">"
	. . . . WRITE "<FONT SIZE=2>"
	. . . . WRITE "<A TITLE="_""""
	. . . . ;WRITE $$^WWWTEXT(32041)_" "
	. . . . ;SET POSX="" FOR  SET POSX=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR,AUF,POSX)) QUIT:POSX'=""  WRITE POSX_" "
	. . . . ;WRITE $CHAR(10)
	. . . . IF LITM'="" IF LITM<$HOROLOG WRITE $$^WWWTEXT(32063)_" "_$$^WWWDATE(LITM)_$CHAR(10)  ;ACHTUNG TERMIN! ;estimation 
	. . . . IF LITM="" WRITE $$^WWWTEXT(32063)_" ??.??.????"_$CHAR(10)  ;ACHTUNG TERMIN! ;estimation 
	. . . . IF $PIECE(AUF1,Y,2)=1 WRITE $PIECE($GET(^WWW101(0,"AUFTRAGSART",SPRACHE,1,1)),Y,1)  ;EIGENAUFTRAG
	. . . . IF +$PIECE(AUF1,Y,2)=0 IF $PIECE(AUF1,Y,1)'="" WRITE $PIECE($GET(^INKUNDE(YM,$PIECE(AUF1,Y,1),1)),Y,8)
	. . . . WRITE $CHAR(10)_$PIECE(POS1,Y,1)  ;POSITION
	. . . . WRITE """"
	. . . . WRITE " HREF="_YAKTION_"EP=WWWFORM&YFORM=INAUFP&YKEY="_AUF_","_POS_"&YFKEY="_AUF_"&YBACK=INAUFBANZ,INAUFTO,&YFUNCT="_WOCHE
	. . . . DO ^WWWCGI
	. . . . WRITE ">"
	. . . . WRITE AUF_"-"_POS
	. . . . WRITE "</A>"
	. . . . WRITE "</FONT>"
	. . . . WRITE "</TD>"
	. . . . ;
	. . . . FOR TAG=0:1:6 DO
	. . . . . WRITE YCR
	. . . . . WRITE "<TD ALIGN=LEFT WIDTH=26"
	. . . . . SET SSN=0
	. . . . . SET YDATE=MONG+TAG
	. . . . . IF YDATE'="" IF $DATA(^TERMIN9(0,"DE",YDATE,1)) WRITE " BGCOLOR=MISTYROSE" SET SSN=1   ;FEIERTAG ;holiday 
	. . . . . SET JN=""
	. . . . . IF YDAT=YDATE SET JN=1  ;DATUM DER AUSLIEFERUNG ;Date the handover 
	. . . . . IF JN="" IF $$^WWWDAY(YDATE)>5 WRITE " BGCOLOR=MISTYROSE" SET SSN=1  ;SONN UND FEIERTAG ;And holiday 
	. . . . . IF JN="" IF SSN=0 WRITE " BGCOLOR="_YWHITE
	. . . . . IF JN'="" WRITE " BGCOLOR=BLUE"
	. . . . . WRITE ">"
	. . . . . WRITE "<FONT SIZE=1>"
	. . . . . IF JN=1 DO
	. . . . . . WRITE "<A "
	. . . . . . WRITE "TITLE="_""""_$PIECE(POS1,Y,1)_$CHAR(10)_"Tour: "_YTOUR_" "_$$^WWWTEXT(187)_": "_$$^WWWTIME($PIECE(POS1,Y,100))_""""   ;TOURNUMMER UND UHRZEIT   ;And 
	. . . . . . WRITE " HREF="
	. . . . . . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YKEY="_AUF_","_POS_"&YFUNCT="_WOCHE
	. . . . . . SET YBACK="INAUFBANZ,"
	. . . . . . DO ^WWWCGI
	. . . . . . WRITE ">"
	. . . . . ;
	. . . . . WRITE "&nbsp;"
	. . . . . IF JN=1 WRITE "X"
	. . . . . IF SSN=1 IF JN'=1 WRITE "-" WRITE "&nbsp;"
	. . . . . IF SSN=0 IF JN'=1 WRITE "&nbsp;&nbsp;"
	. . . . . WRITE "&nbsp;"
	. . . . . IF JN=1 WRITE "</A>"
	. . . . . WRITE "</FONT></TD>"
	. . . . ;
	. . . . WRITE "</TR>"
	
	WRITE "</TABLE>"
	QUIT
	
	
INAUFTOT    ;TAG ÜBERSICHT ;TAG summary 
	;SET TAG=$GET(%(YQUERY,"YFUNCT"))
	;IF TAG="" DO  ;TAG DER AUFTRAGSPOSITION
	;. SET TAG=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,76)
	;. IF TAG>10000 SET ^INTOUR(YM,TAG,1)=""  ;MÖGLICHES TOURDATUM
	;
	;IF TAG<10000 SET TAG=+$HOROLOG ;table-mat 
	
	SET TAG=DATE
	SET TAGM=TAG-1
	SET TAGP=TAG+1
	WRITE "<FONT FACE=ARIAL>"
	
	;IF SPRACHE="DE" DO
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=2&YFUNCT="_TAGM
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"gestern.gif"_""""_" BORDER=0 TITLE='TAG zur&uuml;ck'></A>"
	;. ;
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=2&YFUNCT="_TAGP
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"morgen.gif"_""""_" BORDER=0 TITLE='TAG vor'></A>"
	;
	;IF SPRACHE'="DE" DO
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=2&YFUNCT="_TAGM
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"mday.gif"_""""_" BORDER=0 TITLE='day back'></A>"
	;. ;
	;. WRITE "<A HREF="
	;. WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YFUNCT1=2&YFUNCT="_TAGP
	;. DO ^WWWCGI
	;. WRITE ">"
	;. WRITE YCR,"<IMG SRC="_""""_YGIF_"pday.gif"_""""_" BORDER=0 TITLE='next day'></A>"
	
	WRITE "<b>"
	WRITE "&nbsp;&nbsp;&nbsp;"
	WRITE $$^WWWTEXT(32100)_": "_$$^WWWDATE(TAG)_" "_$PIECE($$^WWWTEXT(30022),",",$$^WWWDAY(TAG))
	; z.B.  Auslieferungsplan: 15.07.2001  Freitag ;e.g. Friday 
	WRITE "&nbsp;"  
	WRITE "</b>"    
	
	;IF $GET(YKEY)'="" DO  ;TRACKING
	;. NEW AUF,POS,TRACK,TRACK1,VERSAND,URL
	;. SET AUF=$PIECE(YKEY,",",1)
	;. SET ^WWW126(YM,"INAUF",YBED,1,1)=AUF
	;. SET POS=$PIECE(YKEY,",",2)
	;. IF AUF'="" IF POS'="" DO
	;. . SET TRACK=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,104)  ;TRACKING NUMMER
	;. . IF TRACK'="" DO
	;. . . SET VERSAND=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,95)  ;VERSENDER
	;. . . IF VERSAND'="" DO
	;. . . . SET URL=$PIECE($GET(^INSPED(YM,VERSAND,1)),Y,27)  ;TRACKING URL
	;. . . . I URL'="" D
	;. . . . . SET URL=URL_TRACK
	;. . . . . WRITE "<A HREF="
	;. . . . . WRITE URL
	;. . . . . WRITE ">"
	;. . . . . WRITE YCR,"<IMG SRC="_""""_YGIF_"tracking-b.gif"_""""_" BORDER=0 TITLE='tracking'></A>"
	
	DO LINK ;LINK FÜR TRAKING UND VERSANDAUFKLEBER BEC;06.08.03;24116;IN EIGENES LABEL
	DO START100^WWWTAB 
	WRITE "<TR>"
	WRITE "<TH BGCOLOR="_YDARKGRAY_" ALIGN=LEFT WIDTH=150>"
	WRITE "<FONT SIZE=1>&nbsp;</FONT>"
	WRITE "</TH>"
	
	FOR UHR=0:1:23 DO
	. WRITE YCR
	. WRITE "<TH BGCOLOR="_YDARKGRAY_" ALIGN=LEFT>"
	. WRITE "<FONT SIZE=1>"
	. IF UHR<10  WRITE "0"_UHR_":00" 
	. IF UHR'<10 WRITE UHR_":00"           
	. WRITE "</FONT></TH>"
	WRITE "</TR>"
	
	SET YDAT=TAG  ;SUCHEN TAG ;seek TAG 
	DO
	. NEW YKEY
	. SET YTOUR=""
	. FOR  SET YTOUR=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR)) QUIT:YTOUR=""  DO
	. . SET AUF=""
	. . FOR  SET AUF=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR,AUF)) QUIT:AUF=""  DO
	. . . SET POS=""
	. . . FOR  SET POS=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR,AUF,POS)) QUIT:POS=""  DO
	. . . . SET POS1=$GET(^INAUFP(YM,AUF,POS,1))
	. . . . SET AUF1=$GET(^INAUF(YM,AUF,1))
	. . . . WRITE YCR
	. . . . SET LITM=$PIECE(AUF1,Y,19)
	. . . . WRITE "<TR>"
	. . . . WRITE "<TD NOWRAP ALIGN=TOP"
	. . . . IF $PIECE(POS1,Y,92)="" IF LITM'="" IF LITM<$HOROLOG WRITE " BGCOLOR=RED"  ;NOCH NICHT AUSGELIEFERT ABER VERGANGENTEIT!! ;yet Not yet 
	. . . . IF $PIECE(POS1,Y,92)="" IF $PIECE(POS1,Y,76)'="" IF LITM'="" IF LITM'<$HOROLOG IF LITM<$PIECE(POS1,Y,76) WRITE " BGCOLOR=YELLOW"  ;KUNDE WOLLTE FRUEHER ;customer 
	. . . . IF +LITM=+$HOROLOG WRITE " BGCOLOR=YELLOW"
	. . . . WRITE ">"
	. . . . WRITE "<FONT SIZE=2>"
	. . . . WRITE "<A TITLE="_""""
	. . . . ;WRITE $$^WWWTEXT(32041)_" "
	. . . . ;SET POSX="" FOR  SET POSX=$ORDER(^INAUFPs(YM,2,$$^WWWUMLAU(YDAT,1),YTOUR,AUF,POSX)) QUIT:POSX'=""  WRITE POSX_" "
	. . . . ;WRITE $CHAR(10)
	. . . . IF LITM'="" IF LITM<$HOROLOG WRITE $$^WWWTEXT(32063)_" "_$$^WWWDATE(LITM)_$CHAR(10)  ;ACHTUNG TERMIN! ;estimation 
	. . . . IF LITM="" WRITE $$^WWWTEXT(32063)_" ??.??.????"_$CHAR(10)  ;ACHTUNG TERMIN! ;estimation 
	. . . . IF $PIECE(AUF1,Y,2)=1 WRITE $PIECE($GET(^WWW101(0,"AUFTRAGSART",SPRACHE,1,1)),Y,1)  ;EIGENAUFTRAG
	. . . . IF +$PIECE(AUF1,Y,2)=0 IF $PIECE(AUF1,Y,1)'="" WRITE $PIECE($GET(^INKUNDE(YM,$PIECE(AUF1,Y,1),1)),Y,8)
	. . . . WRITE $CHAR(10)_$PIECE(POS1,Y,1)  ;POSITION
	. . . . WRITE """"
	. . . . WRITE " HREF="_YAKTION_"EP=WWWFORM&YFORM=INAUFP&YKEY="_AUF_","_POS_"&YFKEY="_AUF_"&YBACK=INAUFBANZ,INAUFTO,&YFUNCT="_TAG
	. . . . DO ^WWWCGI
	. . . . WRITE ">"
	. . . . WRITE AUF_"-"_POS
	. . . . WRITE "</A>"
	. . . . WRITE "</FONT>"
	. . . . WRITE "</TD>"
	. . . . ;
	. . . . FOR UHR=100:1:123 DO
	. . . . . WRITE YCR
	. . . . . WRITE "<TD ALIGN=LEFT WIDTH=26"
	. . . . . SET JN=""
	. . . . . SET YUHR=$EXTRACT($$^WWWTIME($PIECE(POS1,Y,100)),1,2)
	. . . . . IF YUHR=$EXTRACT(UHR,2,3) SET JN=1  ;UHRZEIT DER AUSLIEFERUNG ;the handover 
	. . . . . ;IF JN="" IF $$^WWWDAY(YDATE)>5 WRITE " BGCOLOR=MISTYROSE" SET SSN=1  ;SONN UND FEIERTAG
	. . . . . IF JN=""  WRITE " BGCOLOR="_YWHITE
	. . . . . IF JN'="" WRITE " BGCOLOR=BLUE"
	. . . . . WRITE ">"
	. . . . . WRITE "<FONT SIZE=1>"
	. . . . . IF JN=1 DO
	. . . . . . WRITE "<A "
	. . . . . . WRITE "TITLE="_""""_$PIECE(POS1,Y,1)_$CHAR(10)_"Tour: "_YTOUR_" "_$$^WWWTEXT(187)_": "_$$^WWWTIME($PIECE(POS1,Y,100))_""""   ;TOURNUMMER UND UHRZEIT   ;And 
	. . . . . . WRITE " HREF="
	. . . . . . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YKEY="_AUF_","_POS_"&YFUNCT="_TAG
	. . . . . . SET YBACK="INAUFBANZ,"
	. . . . . . DO ^WWWCGI
	. . . . . . WRITE ">"
	. . . . . ;
	. . . . . WRITE "&nbsp;"
	. . . . . IF JN=1 WRITE "X"
	. . . . . IF JN'=1 WRITE "&nbsp;&nbsp;"
	. . . . . WRITE "&nbsp;"
	. . . . . IF JN=1 WRITE "</A>"
	. . . . . WRITE "</FONT></TD>"
	. . . . ;
	. . . . WRITE "</TR>"
	
	WRITE "</TABLE>"
	QUIT
	
	
LINK ;LINK FÜR TRAKING UND VERSANDAUFKLEBER ;to And 
	IF $GET(YKEY)'="" DO  ;TRACKING
	. NEW AUF,POS,TRACK,TRACK1,VERSAND,URL
	. SET AUF=$PIECE(YKEY,",",1)
	. SET ^WWW126(YM,"INAUF",YBED,1,1)=AUF
	. SET POS=$PIECE(YKEY,",",2)
	. IF AUF'="" IF POS'="" DO
	. . SET TRACK=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,104)  ;TRACKING NUMMER ;numeral 
	. . IF TRACK'="" DO
	. . . SET VERSAND=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,95)  ;VERSENDER
	. . . IF VERSAND'="" DO
	. . . . SET URL=$PIECE($GET(^INSPED(YM,VERSAND,1)),Y,27)  ;TRACKING URL
	. . . . IF URL'="" DO
	. . . . . SET URL=URL_TRACK
	. . . . . WRITE "&nbsp;"
	. . . . . WRITE YCR,"<A HREF="
	. . . . . WRITE URL
	. . . . . WRITE " TARGET=TEILE22"							;bEC;24116;06.08.03; NEUES FENSTER STARTEN
	. . . . . WRITE ">"
	. . . . . WRITE "<IMG SRC="_""""_YGIF_"tracking-b.gif"_""""_" BORDER=0 TITLE='"_$$^WWWTEXT(33559)_"' height=25></A>"		;33559 - tracking
	. . ;
	. . SET VERSAND=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,95)  ;VERSENDER
	. . DO
	. . . IF $GET(VERSAND)'="" DO
	. . . . ;AUFKLEBER ERSCHEINT AUCH WENN KEINE TRACKING NUMBER NOTWENDIG IST ;sticker too when no needful 
	. . . . SET URL=$PIECE($GET(^INSPED(YM,VERSAND,1)),Y,28)  ;AUFKLEBER URL	;bEC;24116;06.08.03;AUFKLEBER EINGEFÜGT
	. . . . IF URL'="" DO
	. . . . . ;SET URL=URL_TRACK ;table-mat 
	. . . . . WRITE "&nbsp;"
	. . . . . WRITE YCR,"<A HREF="
	. . . . . WRITE URL
	. . . . . WRITE " TARGET=TEILE22"							
	. . . . . WRITE ">"
	. . . . . WRITE "<IMG SRC="_""""_YGIF_"preis.gif"_""""_" BORDER=0 TITLE='"_$$^WWWTEXT(32605)_"' height=25></A>"			;32605  - Aufkleber drucken  ;Label print 
	
	QUIT
]]></Routine>
</Export>