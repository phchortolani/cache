<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INMASCHLAST" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INMASCHLAST ;INMASCHLAST;FIS;MASCHINENAUSLASTUNG SPEICHERN;22.03.2003
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		MASCHINENAUSLASTUNG SPEICHERN
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FIS	22.03.2003
	;|
	;\------------------------------------------------------------------/
	;
	NEW POSX,POS1X,AUFX,AUF1X,TEILX,SUCH,ANZFPL,ARBZEIT,ARBTAGE
	LOCK +^INMASCHLAST(YM):1 QUIT:'$T YOK  ;DATENSATZ IN BEARBEITUNG ;data record within adaptation 
	KILL ^INMASCHLAST(YM)  ;LÖSCHEN ALTE DATEN ;Delete 
	;MANDANDENVORGABEN
	SET ANZFPL=1  ;ANZAHL FERTIGUNGSPLÄTZE ;Number 
	;SET ARBZEIT=$PIECE($GET(^INVORG(YM,YM,1)),Y,16)  ;ARBEITSZEIT AUS MANDANTENVORGABE
	;IF ARBZEIT="" SET ARBZEIT=8  ;STUNDEN
	;SET ARBZEIT=ARBZEIT*3600  ;IN SEKUNDEN ;table-mat within 
	;SET ARBTAGE=$PIECE($GET(^INVORG(YM,YM,1)),Y,17)  ;ARBEITSTAGE AUS MANDANTENVORGABE
	;IF ARBTAGE="" SET ARBTAGE=5
	;AUFTRAG ;mandate  ;order 
	SET AUFX="" FOR  SET AUFX=$ORDER(^INAUF1(YM,AUFX),-1) QUIT:AUFX=""  DO  ;OFFENE AUFTRÄGE
	. SET AUF1X=$GET(^INAUF(YM,AUFX,1))
	. QUIT:$PIECE(AUF1X,Y,2)=2  ;LIEFERANTENBESTELLUNG
	. ;
	. ;AUFTRAGSPOSITION
	. SET POSX="" FOR  SET POSX=$ORDER(^INAUFP(YM,AUFX,POSX)) QUIT:POSX=""  DO
	. . SET POS1X=$GET(^INAUFP(YM,AUFX,POSX,1))  ;AUFTRAGSPOSITION
	. . ;
	. . IF +$PIECE(POS1X,Y,7)'=4 IF +$PIECE(POS1X,Y,7)'=3 QUIT  ;BESTELL ODER LAGERWARE ;Or 
	. . IF '$DATA(^INAUFPXL(YM,AUFX,POSX)) QUIT  ;LEISTUNGEN OHNE TEILE = KEINE PRODUKTION ;LEISTUNGEN without no production 
	. . IF +$PIECE(POS1X,Y,60)=1 QUIT  ;ABGESCHLOSSENE POSITION
	. . IF +$PIECE(POS1X,Y,90)=1 QUIT  ;AUSLIEFERUNGSFÄHIG
	. . IF +$PIECE(POS1X,Y,164)'=0 QUIT  ;FERTIGGESTELLT
	. . IF +$PIECE(POS1X,Y,9)=1 QUIT  ;STORNO POSITION
	. . DO DAUER
	. . ;
	. . ;UNTERTEILE
	. . SET POS1X=""
	. . SET SUCH="^INAUFPXL("_""""_YM_""""_","_""""_AUFX_""""_","_POSX_")"
	. . FOR  DO  QUIT:SUCH=""
	. . . SET SUCH=$QUERY(@SUCH)
	. . . IF $TRANSLATE($PIECE(SUCH,",",2),"""")'=AUFX SET SUCH="" QUIT  ;21.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. . . ;IF $PIECE(SUCH,",",2)'=AUXF SET SUCH="" QUIT  ;21.06.04;FAN;25794; 
	. . . IF $PIECE(SUCH,",",3)=POSX DO
	. . . . SET TEILX=$PIECE(SUCH,",",4,99)
	. . . . SET TEILX=$TRANSLATE(TEILX,",)","..")
	. . . . SET POS1X=@SUCH
	. . . . ;
	. . . . IF $DATA(@SUCH)=11 IF +$PIECE(POS1X,Y,7)'=3 QUIT  ;KEINE EIGENFERTIGUNG ;no 
	. . . . IF +$PIECE(POS1X,Y,90)=1 QUIT  ;AUSLIEFERUNGSFÄHIG
	. . . . IF +$PIECE(POS1X,Y,164)'=0 QUIT  ;FERTIGGESTELLT
	. . . . DO DAUER
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	LOCK -^INMASCHLAST(YM)
	QUIT
	
DAUER ;
	NEW DAUER,MASCH,PLATZ,TAG,LOS
	SET TAG=$PIECE(POS1X,Y,168)  ;FERTIGUNGSBEGINN
	QUIT:TAG=""  ;KEIN TERMIN ;no 
	;PRÜFUNG OB FERTIGUNG BEREITS BEGONNEN HAT ;quiz whether yet 
	IF $PIECE(POS1X,Y,165)'="" IF $DATA(^INPROSTEMP0(YM,$PIECE(POS1X,Y,165))) DO  ;FERTIGUNGSAUFTRAG
	. NEW STEMP
	. SET STEMP=$ORDER(^INPROSTEMP0(YM,$PIECE(POS1X,Y,165),""),1)
	. SET TAG=$PIECE($GET(^INPROSTEMP0(YM,$PIECE(POS1X,Y,165),STEMP,1)),Y,14)  ;DATUM FERTIGUNGSSTART ;Date 
	. QUIT
	;FESTLEGUNG DER FERTIGUNGSZEIT ;the 
	SET DAUER=$PIECE(POS1X,Y,45)  ;AUSFÜHRUNGSZEIT ;execution time 
	IF $PIECE(POS1X,Y,166)'="" SET DAUER=$PIECE(POS1X,Y,166)  ;DAUER DER FERTIGUNG ;permanence the 
	;LOSGRÖSSE
	SET LOS=$PIECE(POS1X,Y,72)
	IF +LOS<1 SET LOS=999999999
	;ERMITTELN DER MASCHINENAUSLASTUNG ;find the 
	;-----------------------------------------------------------------------------------
	SET MASCH=$PIECE(POS1X,Y,57)
	IF MASCH'="" DO
	. NEW RUEST,RUHE,DAUERALT
	. SET RUEST=+$PIECE(POS1X,Y,70)*ANZFPL*(1+(($PIECE(POS1X,Y,39)/ANZFPL)-1\LOS))  ;RÜSTZEIT JE LOSGRÖSSE ;setup time once 
	. SET RUHE=+$PIECE($GET(^INMASCH(YM,MASCH,1)),Y,29)  ;RUHEZEIT AUS VORGABE MASCHINEN-STAMMDATEN ;out of default 
	. IF RUHE'=0 SET RUHE=RUHE*ANZFPL*(1+(($PIECE(POS1X,Y,39)/ANZFPL)-1\LOS)) ;RUHEZEIT JE LOSGRÖSSE ;once 
	. SET DAUER=DAUER+RUEST+RUHE
	. QUIT
	;ERMITTELN DER FERTIGUNGSPLATZ-AUSLASTUNG ;find the 
	;-----------------------------------------------------------------------------------
	SET PLATZ=$PIECE(POS1X,Y,61)  ;FERTIGUNGSPLATZ
	IF PLATZ'="" DO
	. NEW BEWEG,DAUERALT
	. SET BEWEG=+$PIECE($GET(^INPRONEST(YM,PLATZ,1)),Y,4)      ;WARENBEWEGUNGSZEIT AUS VORGABE FERTIGUNGSPLATZ ;out of default 
	. IF BEWEG'=0 SET BEWEG=BEWEG*ANZFPL*(1+(($PIECE(POS1X,Y,39)/ANZFPL-1)\LOS))  ;BEWEGUNGSZEIT JE LOSGRÖSSE ;once 
	. SET DAUER=DAUER+BEWEG
	. QUIT
	;SPEICHERN DER AUSLASTUNGSZEITEN JE MASCHINE / TAG ;Save the once machine TAG 
	;-------------------------------------------------
	;SET TAG=TAG-1 ;table-mat 
	DO  ;FOR  QUIT:DAUER'>ARBZEIT  DO
	. ;SET TAG=TAG+1 ;table-mat 
	. ;SET DAUER=DAUER-ARBZEIT ;table-mat 
	. ;
	. DO SPEI(TAG,DAUER)
	. QUIT
	QUIT
	
SPEI(DAT,DAUER)
	;SPEICHERN DER AUSLASTUNGSZEITEN PRO TAG ;Save the within TAG 
	SET DAT=$GET(DAT)
	QUIT:DAT=""
	SET DAUER=$GET(DAUER)
	QUIT:DAUER=""
	;=================================================
	;MASCHINENAUSLASTUNG
	;-------------------------------------------------
	IF MASCH'="" DO
	. NEW DAUER0
	. SET DAUER0=DAUER
	. ;
	. ;MASCHINE BEREITS IM EINSATZ ;machine yet 
	. ;IF $DATA(^INMASCHLAST(YM,"M",MASCH,DAT)) DO
	. ;.NEW DAUERALT
	. ;.SET DAUERALT=$PIECE($GET(^INMASCHLAST(YM,"M",DAT,MASCH,"SUMME",1)),Y,1)
	. ;.SET DAUER0=DAUER0+DAUERALT
	. ;.QUIT
	. ;
	. ;SPEICHERN MASCHINENAUSLASTUNG PRO TAG ;Save within TAG 
	. SET ^INMASCHLAST(YM,"M",DAT,MASCH,AUFX_"."_POSX_"."_$GET(TEILX),1)=DAUER0  ;BELEGUNGSZEIT MASCHINE ;machine 
	. QUIT
	;FERTIGUNGSPLATZ-AUSLASTUNG
	;-------------------------------------------------
	IF PLATZ'="" DO
	. NEW DAUER0
	. SET DAUER0=DAUER
	. ;
	. ;FERTIGUNGSPLATZ BEREITS BELEGT ;yet furry 
	. ;IF $DATA(^INMASCHLAST(YM,"F",PLATZ,DAT)) DO
	. ;.NEW DAUERALT
	. ;.SET DAUERALT=$PIECE($GET(^INMASCHLAST(YM,"F",PLATZ,DAT,1)),Y,1)
	. ;.SET DAUER0=DAUER0+DAUERALT
	. ;.QUIT
	. ;
	. ;SPEICHERN FERTIGUNGSPLATZ-AUSLASTUNG PRO TAG ;Save within TAG 
	. SET ^INMASCHLAST(YM,"F",DAT,PLATZ,AUFX_"."_POSX_"."_$GET(TEILX),1)=DAUER0 ;BELEGUNGSZEIT FERTIGUNGSPLATZ
	. QUIT
	QUIT
]]></Routine>
</Export>