<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWPROUNDO" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWPROUNDO ;WWWPROUNDO;DT;PROTOKOLLDATEI ZURÜCKBUCHEN;7.6.2003
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		PROTOKOLLDATEI ZURÜCKBUCHEN
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	7.6.2003
	;|
	;\------------------------------------------------------------------/
	;
	WRITE "<FONT FACE=ARIAL>"
	WRITE "<FONT SIZE=1>"
	IF VORG(1)="" DO ^WWWINFO($$^WWWTEXT(32310)) QUIT  ;KEINE AUSWAHL GETROFFEN ;no Selection 
	IF VORG(2)="" SET VORG(2)=+$HOROLOG-1
	IF VORG(3)="" SET VORG(3)=+$HOROLOG-1
	SET YDATEI=VORG(1)
	IF '$DATA(^WWW001(0,YDATEI)) DO ^WWWINFO($$^WWWTEXT(32292)) QUIT  ;BITTE PRÜFEN ;please sift 
	KILL ^WWWSOR(YUSER)  ;LÖSCHEN ZWISCHENDATEI ;Delete 
	;BEARBEITEN ÜBERSCHRIFT ;superscription 
	;DATUM;UHRZEIT;BEDIENER;KEY;ALT/NEU
	SET UES(1)=$$^WWWTEXT(124)_Y_$$^WWWTEXT(187)_Y_$$^WWWTEXT(232)_Y_$$^WWWTEXT(184)_Y_$$^WWWTEXT(129)_"/"_$$^WWWTEXT(130)_Y
	DO DRUCK   ;WERTE DRUCKEN ;print 
	DO STOP^WWWTAB  ;ENDE TABELLE ;termination tabulation 
	KILL ^WWWSOR(YUSER)  ;LÖSCHEN ZWISCHENDATEI ;Delete 
	QUIT
	
DRUCK ;
	DO ^WWWBACK
	DO UPUEB  ;DRUCKEN ÜBERSCHRIFT ;print superscription 
	;AUSWERTUNG DRUCKEN ;print 
	NEW BED,UHR,DATUM,KEY,ALT,NEU,ART,YDATUM,YDDSATZ,ANZM,YFORM,YVOR
	SET ANZM=0
	SET YDDSATZ=0
	SET DATUMX=VORG(2)-1 FOR  SET DATUMX=$ORDER(^WWWPRO(YM,YDATEI,DATUMX)) QUIT:DATUMX=""  QUIT:DATUMX>VORG(3)  DO
	. SET UHRX="" FOR  SET UHRX=$ORDER(^WWWPRO(YM,YDATEI,DATUMX,UHRX)) QUIT:UHRX=""  DO
	. . IF DATUMX=+$HOROLOG IF $GET(URH)'="" QUIT:URH+600>$PIECE($HOROLOG,",",2)  ;GLEICHER TAG ;same TAG 
	. . SET BEDX="" FOR  SET BEDX=$ORDER(^WWWPRO(YM,YDATEI,DATUMX,UHRX,BEDX)) QUIT:BEDX=""  DO
	. . . SET KEYX="" FOR  SET KEYX=$ORDER(^WWWPRO(YM,YDATEI,DATUMX,UHRX,BEDX,KEYX)) QUIT:KEYX=""  DO
	. . . . SET ALT=$GET(^WWWPRO(YM,YDATEI,DATUMX,UHRX,BEDX,KEYX,0,1))
	. . . . SET NEU=$GET(^WWWPRO(YM,YDATEI,DATUMX,UHRX,BEDX,KEYX,1,1))
	. . . . SET DATUM=DATUMX
	. . . . SET UHR=UHRX
	. . . . S BED=BEDX
	. . . . S KEY=KEYX
	. . . . ;IF ALT'="" DO ^WWWSPEI(YDATEI,KEYX,ALT)  ;ALTERDATENSATZ
	. . . . ;IF ALT="" DO ^WWWKILL(YDATEI,KEYX)  ;LÖSCHEN 
	. . . . IF NEU'="" DO ^WWWSPEI(YDATEI,KEYX,NEU,1)  ;ALTERDATENSATZ
	. . . . IF NEU="" DO ^WWWKILL(YDATEI,KEYX)  ;LÖSCHEN  ;Delete 
	. . . . WRITE !
	. . . . WRITE YCR
	. . . . SET ANZM=ANZM+1
	. . . . DO NL^WWWTAB
	. . . . DO NF^WWWTAB
	. . . . WRITE $$^WWWDATE(DATUM)
	. . . . DO ZW^WWWTAB
	. . . . WRITE $$^WWWTIME(UHR)
	. . . . DO ZW^WWWTAB
	. . . . WRITE $PIECE($GET(^WWW013(0,BED,1)),Y,1)  ;BEDIENER
	. . . . DO ZW^WWWTAB
	. . . . WRITE KEY   ;SCHLÜSSEL ;wrench 
	. . . . DO ZW^WWWTAB
	. . . . WRITE $$^WWWTEXT(129)  ;ALT ;stale 
	. . . . ;SET YLFN="" FOR  SET YLFN=$ORDER(^WWW003(0,YDATEI,YLFN)) QUIT:YLFN=""  DO
	. . . . . DO ZW^WWWTAB
	. . . . . SET YINHALT=$PIECE(ALT,Y,YLFN)
	. . . . . IF YINHALT'=$PIECE(NEU,Y,YLFN) WRITE "<FONT COLOR=RED>"
	. . . . . ;IF YINHALT'="" DO DATEN^WWWSEAR3 WRITE YINHALT
	. . . . . IF YINHALT'="" SET YINHALT=$$^WWWFORMAT(YDATEI,"D",YLFN,YINHALT) WRITE $TRANSLATE(YINHALT,"<>"_"""","()´")
	. . . . . IF YINHALT="" WRITE "&nbsp;"
	. . . . . QUIT
	. . . . DO EF^WWWTAB
	. . . . DO EL^WWWTAB
	. . . . ; AB HIER NEUER DATENSATZ ;Confirm. here is data record 
	. . . . WRITE !
	. . . . WRITE YCR
	. . . . DO NL^WWWTAB
	. . . . DO NF^WWWTAB
	. . . . WRITE "&nbsp;"
	. . . . DO ZW^WWWTAB
	. . . . WRITE "&nbsp;"
	. . . . DO ZW^WWWTAB
	. . . . WRITE "&nbsp;"
	. . . . DO ZW^WWWTAB
	. . . . WRITE "&nbsp;"
	. . . . DO ZW^WWWTAB
	. . . . WRITE $$^WWWTEXT(130)  ;neu ;recent 
	. . . . ;SET YLFN="" FOR  SET YLFN=$ORDER(^WWW003(0,YDATEI,YLFN)) QUIT:YLFN=""  DO
	. . . . . DO ZW^WWWTAB
	. . . . . SET YINHALT=$PIECE(NEU,Y,YLFN)
	. . . . . IF YINHALT'=$PIECE(ALT,Y,YLFN) WRITE "<FONT COLOR=RED>"
	. . . . . ;IF YINHALT'="" DO DATEN^WWWSEAR3 WRITE YINHALT
	. . . . . IF YINHALT'="" S YINHALT=$$^WWWFORMAT(YDATEI,"D",YLFN,YINHALT) WRITE $TRANSLATE(YINHALT,"<>"_"""","()´")
	. . . . . IF YINHALT="" WRITE "&nbsp;"
	. . . . . QUIT
	. . . . DO EF^WWWTAB
	. . . . DO EL^WWWTAB
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	IF ANZM=0 DO
	. NEW YLFN
	. SET YDDSATZ=YDDSATZ+1
	. WRITE "<TD NOWRAP VALIGN=TOP COLSPAN=4"
	. IF $GET(YDDSATZ)'="" DO 
	. . IF $GET(YDDSATZ)#2=1 WRITE " BGCOLOR="_YWHITE
	. . IF $GET(YDDSATZ)#2=0 WRITE " BGCOLOR="_YGRAY
	. . QUIT
	. WRITE ">"
	. WRITE "<FONT SIZE=1>"
	. WRITE $$^WWWTEXT(46)_"&nbsp;"  ;KEINE DATEN VOHANDEN
	. DO NF^WWWTAB
	. WRITE "&nbsp;"
	. DO EF^WWWTAB
	. SET YLFN="" FOR  SET YLFN=$ORDER(^WWW003(0,YDATEI,YLFN)) QUIT:YLFN=""  DO
	. . DO NF^WWWTAB
	. . WRITE "&nbsp;"
	. . DO EF^WWWTAB
	. . QUIT
	. DO EL^WWWTAB
	. QUIT
	QUIT
	
UPUEB ;ÜBERSCHRIFT ;superscription 
	WRITE "<CENTER>"
	WRITE "<FONT SIZE=3>"
	DO START00^WWWTAB
	DO NL^WWWTAB
	DO NHWO^WWWTAB
	WRITE $$^WWWTEXT(123)_" "_YDATEI
	WRITE "<BR>"
	WRITE $$^WWWDATE(VORG(2))_" - "_$$^WWWDATE(VORG(3))
	DO EH^WWWTAB
	DO EL^WWWTAB
	DO STOP^WWWTAB
	WRITE "<BR>"
	WRITE "</CENTER>"
	WRITE "</FONT>"
	DO START100^WWWTAB  ;STARTEN DER ÜBERSCHRIFT ;launching the superscription 
	DO NL^WWWTAB
	FOR I=1:1 QUIT:$PIECE(UES(1),Y,I,99)=""  DO NHW^WWWTAB WRITE $PIECE(UES(1),Y,I) DO EH^WWWTAB
	;SET YLFN="" FOR  SET YLFN=$ORDER(^WWW003(0,YDATEI,YLFN)) QUIT:YLFN=""  DO
	. DO NHW^WWWTAB
	. WRITE $EXTRACT($PIECE(^WWW003(0,YDATEI,YLFN,1),Y,1),1,20)
	. DO EH^WWWTAB
	. QUIT
	DO EL^WWWTAB
	QUIT
	
MANU ; MANUELLER UNDO ZURÜCKHOLEN DER DATEN AUS ^WWWLAST UNKILL ALTE VERSION ; TYBD; 20,02,2004
	; AUFRUF D MANU^WWWPROUNDO
	DO ^WWWVAR
	WRITE !,"File: "
	READ YDATEI
	QUIT:YDATEI=""
	write !,"Key : "
	READ YKEY
	QUIT:YKEY=""
	WRITE !
	SET YLAST=$ORDER(^WWWLAST(YM,YDATEI,YKEY,""),-1)
	SET YFELD=$GET(^WWWLAST(YM,YDATEI,YKEY,YLAST,1))
	WRITE YKEY,"=",YFELD
	WRITE !,"Save y/n: "
	READ SAVE
	IF SAVE="Y"!(SAVE="y") DO
	. NEW YFORM,YVOR
	. SET YOK=$$^WWWSPEI(YDATEI,YKEY,YFELD,1)
	. WRITE " ",YOK
	. QUIT
	WRITE !
	QUIT
]]></Routine>
</Export>