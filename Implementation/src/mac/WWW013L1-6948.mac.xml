<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWW013L1" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWW013L1
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		DRUCKEN LOHNLISTE
	;		print wages sheet 
	;
	; Inputs : 
	;
	;
	; ByRef :
	;	VORG(1)		
	;	VORG(2)		
	;	VORG(3)		BETRIEB                   ; location
	;	VORG(4)		MITARBEITER KOMBI         ; employee list
	;	VORG(5)		KEINE PAUSENKORREKTUR     ; boolean
	;
	; Returns :
	;
	;
	; History :
	; 16-Nov-2007	GRF		Doco; quits
	; 02.11.1999	DT		Created
	;-------------------------------------------------------------------------------
	; GGF IN WWW013ZG ÄNDERN !!! ;within alter 
	NEW STUNDEN,MINUTEN,TOTALZ,SEKUNDEN,EINHEIT,ZUSCHLAG,PARA,STDSATZ,BETRIEB,VON,BIS,UES,TAB,SOLLSTD,MIT,BETR,UHRZ,GTAG1,GTAG2
	NEW FUN,BBB,VVV,PAUSE,TAGREST,REINHEIT,RSTUNDEN,LEER
	
	IF VORG(1)="" DO ^WWWINFO($$^WWWTEXT(32942)) QUIT   ;VON DATUM ;Date     ; "Not Proceeded! Please Check Your Edit!"
	IF VORG(2)="" DO ^WWWINFO($$^WWWTEXT(32942)) QUIT   ;VON DATUM ;Date 
	SET VORG(4)=$TRANSLATE(VORG(4),";",",")
	IF VORG(3)="" FOR  SET VORG(3)=$ORDER(^WWW0121(0,VORG(3))) QUIT:VORG(3)=""  DO ST  ;BETRIEB
	QUIT:VORG(3)=""
	SET VORG(5)=+$GET(VORG(5))
	SET UCI=$ZUTIL(5) ;NAMESPACE
	IF UCI="INTRAPREND" IF YBED="FAN" SET UCI="INTRAPREND-GMBH"
	
ST ;JE NACH BETRIEB ;once within location 
	SET VON     = VORG(1)
	SET BIS     = VORG(2)
	SET BETRIEB = VORG(3)
	
	KILL ^WWWSOR(YUSER)
	
	DO 
	. SET $PIECE(UES(1),Y,1)=$$^WWWTEXT(32667)  ;TAG   ;FAN;11.03.04;25320
	. SET $PIECE(UES(1),Y,2)=$$^WWWTEXT(124)    ;DATUM ;Date
	. SET $PIECE(UES(1),Y,3)=$$^WWWTEXT(125)    ;BEMERKUNG ;remark 
	. SET $PIECE(UES(1),Y,4)=$$^WWWTEXT(68)     ;von ;from 
	. SET $PIECE(UES(1),Y,5)=$$^WWWTEXT(69)     ;bis  ;To 
	. SET $PIECE(UES(1),Y,6)=$$^WWWTEXT(32254)  ;Zeit ;time 
	. IF YFORM="WWW013LZEIT" QUIT               ;LOHN NICHT DRUCKEN ;FAN;11.03.04;25320
	. SET $PIECE(UES(1),Y,7)=$$^WWWTEXT(33198)  ;LOHN ;reward 
	. SET $PIECE(UES(1),Y,8)=$$^WWWTEXT(32863)  ;Std.Satz
	. SET $PIECE(UES(1),Y,9)=$$^WWWTEXT(32009)  ;Betrag ;Amount  ;Amount Amount 
	
	DO SORT
	DO DRUCK
	DO STOP^WWWTAB
	QUIT
	
SORT ;SUCHEN DER ;seek the 
	SET SOLLSTD=0
	KILL ^WWWSOR(YUSER)
	FOR TAG=VON:1:BIS DO
	. ;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	. ;SET MIT=""
	. ;FOR  SET MIT=$ORDER(^TERMIN(YM,MIT)) QUIT:MIT=""  DO  ;URLAUB
	. . IF VORG(4)'="" QUIT:'$FIND(","_VORG(4)_",",","_MIT_",")  ;FALSCHER MITARBEITER
	. . SET BETR=$PIECE($PIECE($GET(^|UCI|WWW013(0,MIT,1)),Y,44),",",1)
	. . IF $FIND(","_$TRANSLATE(BETRIEB,";",",")_",",","_BETR_",") IF $PIECE($GET(^|UCI|TERMIN(YM,MIT,TAG,0,1)),Y,1)'="" SET ^WWWSOR(YUSER,BETRIEB,MIT,TAG)=""  WRITE "TERMIN "_MIT_" "_$$^WWWDATE(TAG)_"<BR>"
	. ;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	. SET MIT=""
	. FOR  SET MIT=$ORDER(^|UCI|WWW013Z(YM,BETRIEB,TAG,MIT)) QUIT:MIT=""  DO   ;ZEITERFASSUNG
	. . IF VORG(4)'="" QUIT:'$FIND(","_VORG(4)_",",","_MIT_",")  ;FALSCHER MITARBEITER
	. . ;S BETR=$P($P($G(^|UCI|WWW013(0,MIT,1)),Y,44),",",1)
	. . ;I BETR=BETRIEB S ^WWWSOR(YUSER,BETRIEB,MIT,TAG)=""
	. . SET ^WWWSOR(YUSER,BETRIEB,MIT,TAG)=""
	. . ;W "WWW013Z "_MIT_" "_$$^WWWDATE(TAG)_"<BR>"
	
	. ;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	. ;SET MIT=""
	. ;FOR  SET MIT=$ORDER(^|UCI|WWW013V(YM,MIT)) QUIT:MIT=""  DO   ;ZEITERBERICHTIGUNG
	. . IF $PIECE($GET(^|UCI|WWW013V(YM,MIT,TAG,1)),Y,2)="" IF $PIECE($GET(^|UCI|WWW013V(YM,MIT,TAG,1)),Y,3)="" IF $PIECE($GET(^|UCI|WWW013V(YM,MIT,TAG,1)),Y,5)="" QUIT   ;KEINE ZEITBERICHTIGUNG ;no 
	. . IF VORG(4)'="" QUIT:'$FIND(","_VORG(4)_",",","_MIT_",")  ;FALSCHER MITARBEITER
	. . SET BETR=$PIECE($PIECE($GET(^|UCI|WWW013(0,MIT,1)),Y,44),",",1)
	. . IF BETR=BETRIEB SET ^WWWSOR(YUSER,BETRIEB,MIT,TAG)=""
	. ;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	
	QUIT
	
DRUCK ;
	IF '$DATA(^WWWSOR(YUSER,BETRIEB)) DO ^WWWINFO($$^WWWTEXT(119))  QUIT
	DO ^WWWBACK
	NEW YZEILE
	DO   ;AUSWERTUNG JA MITARBEITER ;yes 
	. SET MIT="" FOR  SET MIT=$ORDER(^WWWSOR(YUSER,BETRIEB,MIT)) QUIT:MIT=""  DO
	. . SET SOLLSTD=0
	. . SET TOTALZ=0
	. . SET TOTALG=0
	. . DO UPUEB
	. . SET PARA=$GET(^|UCI|WWW013(0,MIT,1))
	. . ;FOR TAG=VON:1:BIS DO
	. . . ;IF $DATA(^|UCI|WWW013V(YM,MIT,TAG,1)) SET SOLLSTD=SOLLSTD+$PIECE(^(1),Y,1)            ;FAN;11.03.04;DIESE DATEI IST LEER
	. . . ;QUIT
	. . SET TAG="" FOR  SET TAG=$ORDER(^WWWSOR(YUSER,BETRIEB,MIT,TAG)) QUIT:TAG=""  DO
	. . . IF TAG=+$HOROLOG DO                             ;---HEUTE JETZT ALS END ZEIT 
	. . . . SET HUHR=$PIECE($HOROLOG,",",2)  ; JETZT UHRZEIT ;presently 
	. . . . SET ^|UCI|WWW013Z(YM,BETRIEB,TAG,MIT,HUHR,0,1)=""
	. . . ;
	. . . DO NL^WWWTAB
	. . . DO NF^WWWTAB
	. . . SET A1=$$^WWWTEXT(30022) WRITE $PIECE(A1,",",$$^WWWDAY(TAG))  ;TAG
	. . . DO ZW^WWWTAB
	. . . WRITE $$^WWWDATE(TAG)
	. . . DO ZW^WWWTAB
	. . . SET GTAG1=0   ;GESAMTER ZEIT ;time 
	. . . SET GTAG2=0   ;GESAMTER BETRAG ;Sum 
	. . . SET TAGREST=0  ;REST BEI PAUSEN ;residue next to 
	. . . SET VVV=0
	. . . SET LFUN=""
	. . . IF '$DATA(^|UCI|WWW013V(YM,MIT,TAG)) SET UHRZ="" FOR YZEILE=1:1 SET UHRZ=$ORDER(^|UCI|WWW013Z(YM,BETRIEB,TAG,MIT,UHRZ)) QUIT:UHRZ=""  DO
	. . . . SET FUN=$ORDER(^|UCI|WWW013Z(YM,BETRIEB,TAG,MIT,UHRZ,""))
	. . . . QUIT:FUN>1  ;KEINE AUSWERTUNG DER LEISTUNGEN ;no the LEISTUNGEN 
	. . . . IF UHRZ=$ORDER(^|UCI|WWW013Z(YM,BETRIEB,TAG,MIT,"")) IF FUN'=1 QUIT  ;START MIT CHECKOUT ;take-off by means of 
	. . . . QUIT:LFUN=FUN  ;WIEDERHLOUNG VON CHECKIN/OUT
	. . . . SET LFUN=FUN
	. . . . IF UHRZ=0 S UHRZ=1  ;FIS;14.01.0527148
	. . . . IF YZEILE>2 IF FUN=1 DO
	. . . . . DO NL^WWWTAB
	. . . . . DO NF^WWWTAB
	. . . . . WRITE "&nbsp;"
	. . . . . DO ZW^WWWTAB
	. . . . . WRITE "&nbsp;"
	. . . . . DO ZW^WWWTAB
	. . . . ;
	. . . . IF FUN=1 DO  ;ANFANG ARBEIT ;outset work 
	. . . . . SET UHR=UHRZ
	. . . . . SET PAUSE=0
	. . . . . DO VON  ;ERRECHNEN PAUSE ;calculate pause 
	. . . . . ;SET VVV=UHRZ
	. . . . . SET VVV=UHR  ;FIS;14.01.05; KORRIGIERTE UHRZEIT (KULANZ)
	. . . . . IF +PAUSE'=0 DO
	. . . . . . IF +$PIECE(PARA,Y,90)'=0 QUIT  ;FIS;18.01.05
	. . . . . . WRITE $$^WWWTEXT(32540)," "
	. . . . . . WRITE PAUSE\60," ",$$^WWWTEXT(34058)    ;"Pause Min."
	. . . . . ;
	. . . . . WRITE "&nbsp;"
	. . . . . DO ZWR^WWWTAB
	. . . . . WRITE $$^WWWTIME(UHR)
	. . . . ;
	. . . . IF FUN=0 IF +VVV'=0 DO  ;ENDE ARBEIT ;termination work 
	. . . . . DO ZWR^WWWTAB
	. . . . . IF TAG=+$HOROLOG IF ^|UCI|WWW013Z(YM,BETRIEB,TAG,MIT,UHRZ,0,1)="" WRITE "<U>"
	. . . . . WRITE $$^WWWTIME(UHRZ)
	. . . . . IF TAG=+$HOROLOG IF ^|UCI|WWW013Z(YM,BETRIEB,TAG,MIT,UHRZ,0,1)="" WRITE "</U>"
	. . . . . SET BBB=UHRZ
	. . . . . QUIT:BBB<VVV   ;FEHLER ;shortcoming 
	. . . . . QUIT:BBB=VVV   ;FEHLER ;shortcoming 
	. . . . . DO BIS
	. . . . . WRITE "&nbsp;"
	. . . . . DO ZWR^WWWTAB
	. . . . . WRITE $$^WWWTIME(SEKUNDEN)
	. . . . . WRITE "&nbsp;"
	. . . . . IF YFORM'="WWW013LZEIT" DO    ;LOHN NICHT DRUCKEN ;FAN;11.03.04;25320
	. . . . . . DO ZWR^WWWTAB
	. . . . . . WRITE "&nbsp;"
	. . . . . . DO ZWR^WWWTAB
	. . . . . . WRITE $$^WWWZAHL(STDSATZ,5,2,YWHR)
	. . . . . . WRITE "&nbsp;"
	. . . . . ;
	. . . . . SET REINHEIT=SEKUNDEN\EINHEIT
	. . . . . SET RSTUNDE=(REINHEIT*EINHEIT)/60/60
	. . . . . SET BETRAG=$JUSTIFY(STDSATZ*RSTUNDE,0,2)
	. . . . . SET GTAG1=GTAG1+SEKUNDEN  ;GESAMT TAG ZEIT ;total TAG time 
	. . . . . SET TOTALZ=TOTALZ+SEKUNDEN  ;GESAMTER ZEITRAUM
	. . . . . IF YFORM'="WWW013LZEIT" DO    ;LOHN NICHT DRUCKEN ;FAN;11.03.04;25320
	. . . . . . DO ZWR^WWWTAB
	. . . . . . WRITE $$^WWWZAHL(BETRAG,8,2,YWHR)
	. . . . . . WRITE "&nbsp;"
	. . . . . ;
	. . . . . SET GTAG2=GTAG2+BETRAG  ;GESAMT TAG BETRAG ;total TAG Sum 
	. . . . . SET TOTALG=TOTALG+BETRAG  ;GESAMTER ZEITRAUM
	. . . . . DO EF^WWWTAB
	. . . ;
	. . . IF TAG=+$HOROLOG DO                             ;---HEUTE JETZT ALS END ZEIT 
	. . . . KILL ^|UCI|WWW013Z(YM,BETRIEB,TAG,MIT,HUHR,0,1)
	. . . ;
	. . . IF +$PIECE(PARA,Y,90)'=0 DO  ;PFLICHTPAUSE;FIS;14.01.05
	. . . . QUIT:GTAG1'>21600  ;NUR WENN MIN. 6 STD GEARBEITET
	. . . . DO NL^WWWTAB
	. . . . DO NF^WWWTAB
	. . . . WRITE "&nbsp;"
	. . . . DO ZWR^WWWTAB
	. . . . WRITE "&nbsp;"
	. . . . DO ZW^WWWTAB
	. . . . WRITE $$^WWWFELDNAME("WWW013","D",90)  ;PFLICHTPAUSE
	. . . . DO ZWR^WWWTAB
	. . . . WRITE "&nbsp;"
	. . . . DO ZW^WWWTAB
	. . . . WRITE "&nbsp;"
	. . . . DO ZWR^WWWTAB
	. . . . WRITE "-"_$$^WWWTIME($PIECE(PARA,Y,90))
	. . . . SET TOTALZ=TOTALZ-$PIECE(PARA,Y,90)
	. . . . SET GTAG1=GTAG1-$PIECE(PARA,Y,90)
	. . . . SET REINHEIT=$PIECE(PARA,Y,90)\EINHEIT
	. . . . SET RSTUNDE=(REINHEIT*EINHEIT)/60/60
	. . . . SET BETRAG=$JUSTIFY(STDSATZ*RSTUNDE,0,2)
	. . . . SET GTAG2=GTAG2-BETRAG  ;GESAMT TAG BETRAG ;total TAG Sum 
	. . . . SET TOTALG=TOTALG-BETRAG  ;GESAMTER ZEITRAUM
	. . . . WRITE "&nbsp;"
	. . . . IF YFORM'="WWW013LZEIT" DO    ;LOHN NICHT DRUCKEN ;FAN;11.03.04;25320DO
	. . . . . DO ZWR^WWWTAB
	. . . . . WRITE "&nbsp;"
	. . . . . DO ZWR^WWWTAB
	. . . . . WRITE "&nbsp;"
	. . . . . DO ZWR^WWWTAB
	. . . . . WRITE $$^WWWZAHL(BETRAG*-1,8,2,YWHR)
	. . . . . WRITE "&nbsp;"
	. . . ;
	. . . DO NL^WWWTAB
	. . . DO NF^WWWTAB
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE $$^WWWTIME(GTAG1)
	. . . WRITE "&nbsp;"
	. . . IF YFORM'="WWW013LZEIT" DO    ;LOHN NICHT DRUCKEN ;FAN;11.03.04;25320DO
	. . . . DO ZWR^WWWTAB
	. . . . WRITE "&nbsp;"
	. . . . DO ZWR^WWWTAB
	. . . . WRITE "&nbsp;"
	. . . . DO ZWR^WWWTAB
	. . . . WRITE $$^WWWZAHL(GTAG2,8,2,YWHR)
	. . . . WRITE "&nbsp;"
	. . . ;
	. . . DO EF^WWWTAB
	. . ;
	. . DO NL^WWWTAB
	. . DO NF^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZWR^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZW^WWWTAB
	. . WRITE $$^WWWTEXT(32181)   ;"Gesamt"
	. . DO ZWR^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZW^WWWTAB
	. . WRITE "&nbsp;"
	. . DO ZW^WWWTAB
	. . WRITE $$^WWWTIME(TOTALZ)
	. . WRITE "&nbsp;"
	. . IF YFORM'="WWW013LZEIT" DO    ;LOHN NICHT DRUCKEN ;FAN;11.03.04;25320DO
	. . . DO ZWR^WWWTAB
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE "&nbsp;"
	. . . DO ZWR^WWWTAB
	. . . WRITE $$^WWWZAHL(TOTALG,8,2,YWHR)
	. . . WRITE "&nbsp;"
	. . ;
	. . DO STOP^WWWTAB
	. . WRITE "<BR>"
	. . DO     ;---------------------------------------------------------SOLLSTUNDEN
	. . . NEW MIT1,WTAG,KAL,SSW,TAGG,STT,TAG
	. . . SET SOLLSTD=0
	. . . SET MIT1=$GET(^|UCI|WWW013(0,MIT,1))
	. . . SET WTAG=$TRANSLATE($PIECE(MIT1,Y,77),";",",")    ;WOCHENTAG
	. . . ;W $$^WWWFELDNAME("WWW013","D",77)_":  "_WTAG_"<BR>"
	. . . QUIT:WTAG=""
	. . . SET KAL=$PIECE(MIT1,Y,120)    ;KALENDERVORGABE
	. . . SET SSW=$PIECE(MIT1,Y,78)     ;SOLLSTUNDE PRO WOCHE ;within week 
	. . . ;W $$^WWWFELDNAME("WWW013","D",78)_":  "_SSW_"<BR>"
	. . . QUIT:SSW=""
	. . . SET TAGG=$LENGTH(WTAG,",")   ;WIEVIEL TAG INSGESAMT PRO WOCHE ;how much TAG together within week 
	. . . ;W "WIEVIEL TAG INSGESAMT PRO WOCHE="_TAGG_"<BR>"
	. . . SET STT=SSW/TAGG          ;WIEVIEL STUNDEN DRUCHSCHNITTLICH PRO TAG ;how much procrastinate within TAG 
	. . . ;W "WIEVIEL STUNDEN DRUCHSCHNITTLICH PRO TAGE="_STT_"<BR>"
	. . . FOR TAG=VON:1:BIS DO       
	. . . . IF $FIND(WTAG,$$^WWWDAY(TAG)) SET SOLLSTD=SOLLSTD+STT     ;ARBEITSTAG-----SOLLSTAND+WIEVIEL STUNDEN DRUCHSCHNITTLICH PRO TAG
	. . . . QUIT:KAL=""
	. . . . QUIT:'$DATA(^|UCI|WWWCAL1(0,KAL,TAG,1))
	. . . . DO
	. . . . . ;WRITE $$^WWWDATE(TAG)_"---"_$$^WWWDAY(TAG)_"<BR>"
	. . . . . SET GET=$LENGTH($TRANSLATE($PIECE($GET(^|UCI|WWWKALENDER(0,KAL,1)),Y,2),";",","),",")        ;WENN VOLL ARBEIT, WIELTAG PRO WOCHE
	. . . . . SET SOLLSTD=SOLLSTD-(1/GET*SSW)       ; Z.B.  5 TAG PROWOCHE; SOLLSTUNDE PROWOCHE IST 10;  1/5*10=2  ;DAS HEIßT FÜR JEDE FREITAG IST SOLLSTUNDEN -2 STUNDE
	. . . ;
	. . . WRITE "<BR><B>  "_$$^WWWTEXT(33806)              ; "Working Hours"
	. . . IF VON'="" WRITE " ("_$$^WWWDATE(VON)
	. . . IF BIS'="" WRITE " -- "_$$^WWWDATE(BIS)_")"
	. . . WRITE " :  "_SOLLSTD_" "_$$^WWWTEXT(3187)_"<B>"  ; "Hours"
	. . ;
	. . DO FF^WWWW()  ;FORMFEED
	
	QUIT
	
UPUEB ;UEBERTRAG
	WRITE YCR
	WRITE "<B>"
	WRITE $PIECE($GET(^|UCI|WWW013(0,MIT,1)),Y,1)
	WRITE "</B>"
	WRITE YCR
	DO START^WWWTAB
	DO NL^WWWTAB
	FOR I=1:1 QUIT:$PIECE(UES(1),Y,I)=""  DO NH^WWWTAB WRITE $PIECE(UES(1),Y,I) DO EH^WWWTAB
	DO EL^WWWTAB
	QUIT
	
VON ;RECHNEN VON ;have faith in 
	DO PARA
	SET PAUSE=0
	SET UHR1=$ORDER(^|UCI|WWW013Z(YM,BETRIEB,TAG,MIT,UHR),-1)
	IF UHR1'="" SET PAUSE=UHR-UHR1  ;PAUSE ;recess
	;IF +$PIECE(PARA,Y,90)'=0 IF +$PIECE(PARA,Y,90)>PAUSE SET PAUSE=$PIECE(PARA,Y,90)  ;FIS;14.01.05;27148
	IF PAUSE>3900!(UHR=$ORDER(^|UCI|WWW013Z(YM,BETRIEB,TAG,MIT,""))) DO  QUIT  ;ANFANG D. TAGES ;outset 
	. SET UHRSTART=UHR
	. SET SREST=UHRSTART#$PIECE(PARA,Y,83)
	. SET SZEIT=UHRSTART\$PIECE(PARA,Y,83)
	. SET SZEIT=SZEIT+1
	. IF (SREST-$PIECE(PARA,Y,84)-1)<1 SET SZEIT=SZEIT-1
	. SET UHR=SZEIT*$PIECE(PARA,Y,83)
	. SET PAUSE=0
	
	IF VORG(5)'=1 IF PAUSE>300 DO  QUIT
	. IF +$PIECE(PARA,Y,90)=0 DO
	. . ;IF PAUSE>2100 SET UHR=UHR1-(TAGREST*60)+3540,PAUSE=3600,TAGREST=0 QUIT
	. . ;IF PAUSE>2100 SET UHR=UHR1-TAGREST+3600,PAUSE=3600,TAGREST=0 QUIT  ;FIS;18.01.05
	. . ;SET UHR=UHR1-TAGREST+1740,PAUSE=1800,TAGREST=0 QUIT
	. . ;SET UHR=UHR1-TAGREST+1800,PAUSE=1800,TAGREST=0 QUIT  ;FIS;18.01.05
	. . IF PAUSE>2100 SET UHR=UHR1+3600,PAUSE=3600,TAGREST=0 QUIT  ;FIS;28.01.05;27148
	. . SET UHR=UHR1+1800,PAUSE=1800,TAGREST=0  ;FIS;28.01.05;27148
	
	SET PAUSE=0
	QUIT
	
BIS ;ERRECHNEN ARBEITSZEIT UND STDSATZ ;working hours And 
	DO PARA
	SET SEKARB=(BBB-VVV)  ;SEKUNDEN GEARBEITET
	SET SEKARB=SEKARB+TAGREST SET TAGREST=0  ;WENN VORHER EIN REST BLIEB ;when pre- uni- residue 
	SET SSF=0   ;SONN und Feiertag ;and holiday 
	;IF $DATA(^|UCI|TERMIN9(0,"DE",TAG,1)) SET SSN=1  ;feiertag
	IF $$^WWWCALDAY(TAG,,1)=2 SET SSN=1  ;feiertag
	IF $$^WWWDAY(TAG)=7 SET SSF=1  ;SONNTAG ;Sunday 
	IF SSF=1 SET STDSATZ=STDSATZ+(STDSATZ/100*ZUSCHLAG)
	SET GREST=SEKARB#EINHEIT
	SET GZEIT=SEKARB\EINHEIT
	IF (GREST+$PIECE(PARA,Y,85))>EINHEIT SET GZEIT=GZEIT+1
	SET SEKUNDEN=GZEIT*EINHEIT
	SET TAGREST=SEKARB-SEKUNDEN
	QUIT
	
PARA ;VORGABEN
	SET ZUSCHLAG=$PIECE(PARA,Y,76)    ;SONN UND F. ZUSCHLAG ;And surcharge 
	SET STDSATZ=$PIECE(PARA,Y,75)      ;LOHN ;reward 
	SET EINHEIT=$PIECE(PARA,Y,86)   ;ABRECHNUNGSEINHEIT
	IF +EINHEIT=0 SET EINHEIT=60  ;eine MINUTE ;one minute 
	IF $PIECE(PARA,Y,83)="" SET $PIECE(PARA,Y,83)=1  ;ANFANG JEDE minute ;outset 
	IF $PIECE(PARA,Y,84)="" SET $PIECE(PARA,Y,84)=0  ;KULANZ
	IF $PIECE(PARA,Y,85)="" SET $PIECE(PARA,Y,85)=0  ;ENDEKULANZ
	;IF +STDSATZ=0 SET STDSATZ=10 ;table-mat 
	QUIT
	
	; vvvvvv DISABLED BLOCK vvvvvv
	IF $PIECE(PARA,Y,85)="" SET $PIECE(PARA,Y,85)=0  ;ENDEKULANZ
	;IF +STDSATZ=0 SET STDSATZ=10 ;table-mat 
	QUIT
	
]]></Routine>
</Export>