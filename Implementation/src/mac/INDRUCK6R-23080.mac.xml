<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDRUCK6R" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INDRUCK6R ;INDRUCK6R;DT;DRUCKEN POSITION RELIESE;19.02.2002
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		DRUCKEN POSITION RELIESE
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	19.02.2002
	;|
	;\------------------------------------------------------------------/
	;
	;VON ^INDRUCK6
	;DRUCKEN DER POSITION RELIESE ;print the 
	QUIT:$PIECE(YBELEG1,Y,187)=1  ;POSITIONEN NICHT DRUCKEN ;Not print 
	SET YEKK=$GET(^INAUFPK(YM,YAUFTRAG,POS,1))  ;EK KONDITION ;Planned Cost 
	IF +$PIECE(YBELEG1,Y,42)=0 IF +$PIECE(YBELEG1,Y,44)=0 IF +$PIECE(YBELEG1,Y,46)=0 IF +$PIECE(YBELEG1,Y,48)=0 IF +$PIECE(YBELEG1,Y,50)=0 IF +$PIECE(YBELEG1,Y,52)=0 IF +$PIECE(YBELEG1,Y,54)=0 IF +$PIECE(YBELEG1,Y,56)=0 IF +$PIECE(YBELEG1,Y,58)=0 QUIT  ;KEINE POSITIONEN AUSGEGEN ;no 
	SET REL="" FOR  SET REL=$ORDER(^INAUFPREL(YM,YAUFTRAG,POS,REL)) QUIT:REL=""  DO
	. SET REL1=$GET(^INAUFPREL(YM,YAUFTRAG,POS,REL,1))    ;GANZ DATENSATZ ;wholly data record 
	. SET BLANKS=0   ;ZUSATZBLANKS WEGEN HTML TAG ;quibble HTML TAG 
	. IF REL=$ORDER(^INAUFPREL(YM,YAUFTRAG,POS,"")) DO
	. . SET A=YSPE
	. . DO SPE^INDRUCK
	. . QUIT
	. SET A=YSPE
	. ;RELEASE NR
	. SET YA(1)=$PIECE(YBELEG1,Y,40)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,41)   ;SPALTE ;rift 
	. IF YA(2)="" SET YA(2)=0
	. ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . SET YA(3)=$JUSTIFY(POS,2,0)_""_REL  ;JUSTIERT   Z.B.--->  2.4
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . QUIT
	. ;
	. ;MENGE ;quantum  ;quantity 
	. SET YA(1)=$PIECE(YBELEG1,Y,54)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,55)+BLANKS   ;SPALTE ;rift 
	. IF +YA(2)=+BLANKS SET YA(2)=22
	. IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . SET YA(3)=$PIECE(REL1,Y,1) 
	. . IF +$PIECE(YEKK,Y,41)'=0 SET $PIECE(REL1,Y,1)=+$J($PIECE(REL1,Y,1)*$PIECE(YEKK,Y,41),0,2)  ;TYBD;9.5.2003
	. . IF $FIND($PIECE(REL1,Y,1),".") SET YA(3)=$$^WWWZAHL($PIECE(REL1,Y,1),4,$LENGTH($PIECE($PIECE(REL1,Y,1),".",2)))
	. . IF '$FIND($PIECE(REL1,Y,1),",") IF '$FIND($PIECE(REL1,Y,1),".") SET YA(3)=$$^WWWZAHL($PIECE(REL1,Y,1),4,0)
	. . IF $PIECE(YBELEG1,Y,44)=1 DO  ;ANZEIGEN MENGENEINHEIT ;display 
	. . . QUIT:$PIECE(POS1,Y,40)=""
	. . . SET YA(3)=YA(3)_" "_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(POS1,Y,40),1)),Y,1)
	. . . QUIT
	. . SET UAN="",UAUS=""
	. . IF $PIECE(YBELEG1,Y,142)=1 SET UAN="<B>",UAUS="</B>" SET BLANKS=BLANKS+7
	. . IF $PIECE(YBELEG1,Y,142)=2 SET UAN="<U>",UAUS="</U>" SET BLANKS=BLANKS+7
	. . SET A=$EXTRACT(A,1,YA(2))_UAN_YA(3)_UAUS_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . QUIT
	. ;
	. ;SET YPROZM=+$PIECE($GET(^INVORG(YM,YM,1)),Y,21)
	. ;PREISE
	. SET YA(1)=$PIECE(YBELEG1,Y,56)  ;DRUCK 0/1 ;printing 
	. SET YA(2)=$PIECE(YBELEG1,Y,57)+BLANKS   ;SPALTE ;rift 
	. IF +YA(2)=+BLANKS SET YA(2)=50
	. DO  ;IF YA(1)=1 DO  ;ANZEIGEN ;display 
	. . NEW PREIS
	. . ;EINZELPREIS
	. . SET PREIS=+$PIECE(REL1,Y,30)
	. . IF +$PIECE(REL1,Y,1)'=0 SET PREIS=PREIS/$PIECE(REL1,Y,1)
	. . QUIT:+PREIS=0
	. . SET YA(3)=$$^WWWZAHL(PREIS,10,2,YWHR)
	. . DO
	. . . NEW EURO
	. . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . . QUIT
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . ;GESAMTPREIS
	. . SET YA(2)=$PIECE(YBELEG1,Y,59)+BLANKS   ;SPALTE ;rift 
	. . IF +YA(2)=+BLANKS SET YA(2)=63
	. . SET PREIS=+$PIECE(REL1,Y,30)
	. . QUIT:+PREIS=0
	. . SET YA(3)=$$^WWWZAHL(PREIS,10,2,YWHR)
	. . DO
	. . . NEW EURO
	. . . SET EURO=$LENGTH(A,"&#8364;")-1
	. . . IF EURO>0 SET YA(2)=YA(2)+(EURO*6)
	. . . QUIT
	. . SET A=$EXTRACT(A,1,YA(2))_YA(3)_$EXTRACT(A,YA(2)+1+$LENGTH(YA(3)),132)   ;EINSETZEN ;stow 
	. . QUIT
	. ;
	. IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. ;
	. ;
	. SET A=YSPE
	. ;LIEFERANSCHRIFT AUF BESTELLUNG ;upon sales order 
	. DO
	. . NEW ADR,ADR2,YN
	. . SET ADR=""
	. . ;
	. . IF $PIECE(REL1,Y,3)'="" IF $TRANSLATE($PIECE(REL1,Y,4,16),Y)="" FOR YI=4,6,7,10,12,14,16 SET $PIECE(REL1,Y,YI)=$PIECE($GET(^INKUNDE(YM,$PIECE(REL1,Y,3),1)),Y,YI)  ;WENN NICHT VORHANDEN, DANN NEU
	. . IF $PIECE(REL1,Y,29)'="" IF $TRANSLATE($PIECE(REL1,Y,4,16),Y)="" DO
	. . . FOR YI="4.2","6.3","10.4","12.6","14.17","16.8" DO
	. . . . SET YI(1)=$PIECE(YI,".",1)
	. . . . SET YI(2)=$PIECE(YI,".",2)
	. . . . SET $PIECE(REL1,Y,YI(1))=$PIECE($GET(^WWW0121(0,YM,$PIECE(REL1,Y,3),1)),Y,YI(2))  ;WENN NICHT VORHANDEN, DANN NEU
	. . . . QUIT
	. . . QUIT
	. . ;
	. . IF $PIECE(REL1,Y,4)="" IF $PIECE(REL1,Y,6)="" IF $PIECE(REL1,Y,7)="" IF $PIECE(REL1,Y,10)="" IF $PIECE(REL1,Y,10)="" QUIT
	. . FOR YI=4,6,7,10,12,14,16,17,20,21,22,24 SET $PIECE(ADR,Y,YI)=$PIECE(REL1,Y,YI)
	. . QUIT:$TRANSLATE(ADR,Y)=""
	. . SET YA(3)=$$^INADRES(ADR,0,1)
	. . IF $PIECE(YBELEG1,Y,87)'="" SET YA(3)=$PIECE(YBELEG1,Y,87)_"|"_YA(3)
	. . ;SET YA(3)=""
	. . ;;IF $PIECE(ADR,Y,3)'="" SET YA(3)=$PIECE($GET(^INPARA(YM,"ANREDE",SPRACHE,$PIECE(ADR,Y,3),1)),Y,1)  ;ANREDE
	. . ;;IF YA(3)'="" SET YA(3)=YA(3)_"|"
	. . ;IF $TRANSLATE($PIECE(ADR,Y,4)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,4)_"|"  ;NAME1
	. . ;IF $TRANSLATE($PIECE(ADR,Y,6)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,6)_"|"  ;NAME2
	. . ;IF $TRANSLATE($PIECE(ADR,Y,7)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,7)_"|"  ;NAME3
	. . ;;IF $TRANSLATE($PIECE(ADR,Y,92)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,92)_"|"  ;BELEGEMPFÄNGER
	. . ;IF $TRANSLATE($PIECE(ADR,Y,10)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,10)_"|"  ;STRASSE
	. . ;;IF $TRANSLATE(YA(3),"| ")'="" SET YA(3)=YA(3)_"|"
	. . ;IF $PIECE($GET(^INVORG(YM,YM,1)),Y,50)'=1 IF $TRANSLATE($PIECE(ADR,Y,12)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,12)_" "  ;PLZ VOR ORT
	. . ;IF $TRANSLATE($PIECE(ADR,Y,16)," ")'="" SET YA(3)=YA(3)_$PIECE(ADR,Y,16)  ;ORT
	. . ;IF $PIECE($GET(^INVORG(YM,YM,1)),Y,50)=1 IF $TRANSLATE($PIECE(ADR,Y,12)," ")'="" SET YA(3)=YA(3)_" "_$PIECE(ADR,Y,12)  ;PLZ NACH ORT
	. . IF $TRANSLATE($PIECE(ADR,Y,17)," ")'="" DO  ;LAND (NUR WENN NICHT WIE LIEFERANT) ;rural when Not such as 
	. . . NEW AUSLAND
	. . . SET AUSLAND=0
	. . . IF $PIECE(YADRES,Y,17)="" QUIT
	. . . IF $PIECE(YADRES,Y,17)'=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,17) SET AUSLAND=1  ;AUSLAND ;foreign country 
	. . . IF $PIECE(YADRES,Y,17)'=$PIECE(ADR,Y,17) SET AUSLAND=1  ;AUSLAND ;foreign country 
	. . . QUIT:AUSLAND=0
	. . . SET YA(3)=YA(3)_$PIECE($GET(^WWW100(0,"LAND",SPRACHE,$PIECE(ADR,Y,17),1)),Y,1)_"|"
	. . . QUIT
	. . ;SET YA(3)=YA(3)_"|"
	. . IF $PIECE(REL1,Y,2)'="" SET YA(3)=YA(3)_$$^WWWTEXT(32168)_": "_$$^WWWDATE($PIECE(REL1,Y,2))_"|"     ;TERMIN
	. . IF $PIECE(REL1,Y,35)'="" SET YA(3)=YA(3)_$$^WWWTEXT(32847)_": "_$PIECE(REL1,Y,35)_"|"     ;REFERENZ ;reference 
	. . IF $PIECE(REL1,Y,31)'="" SET YA(3)=YA(3)_$$^WWWTEXT(32880)_": "_$PIECE(REL1,Y,31)_"|"     ;QUOTE NR ;underwriting share 
	. . IF $EXTRACT($PIECE(REL1,Y,40))="|" SET $PIECE(REL1,Y,40)=$EXTRACT($PIECE(REL1,Y,40),2,9999)
	. . IF $EXTRACT($PIECE(REL1,Y,40))=$CHAR(10) SET $PIECE(REL1,Y,40)=$EXTRACT($PIECE(REL1,Y,40),2,9999)
	. . IF $EXTRACT($PIECE(REL1,Y,40))=$CHAR(13) SET $PIECE(REL1,Y,40)=$EXTRACT($PIECE(REL1,Y,40),2,9999)
	. . IF $PIECE(REL1,Y,40)'="" SET YA(3)=YA(3)_$TRANSLATE($PIECE(REL1,Y,40),$CHAR(10,13),"|")     ;BEMERKUNGEN
	. . IF $TRANSLATE(YA(3),"| ")="" QUIT
	. . SET YA(1)=1  ;$PIECE(YBELEG1,Y,86)   ;DRUCK 0/1  AUSFÜHRUNG
	. . SET YA(2)=$PIECE(YBELEG1,Y,49)+5   ;SPALTE ;rift 
	. . IF YA(2)="" SET YA(2)=14+5
	. . IF YA(1)=1 DO  ;ANZEIGEN ;give notice  ;display 
	. . . NEW TEXT,TEXT1
	. . . QUIT:$TRANSLATE(YA(3),"| ")=""
	. . . SET TEXT=""
	. . . SET TEXT=TEXT_YA(3)_"| "  ;ABSTAND ;offset 
	. . . FOR YA(88)=1:1 SET TEXT1=$PIECE(TEXT,"|",YA(88)) QUIT:$TRANSLATE($PIECE(TEXT,"|",YA(88),999),"|")=""  DO
	. . . . SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . FOR YA(33)=1:1 QUIT:$PIECE(TEXT1," ",YA(33),999)=""  DO  SET A=A_$PIECE(TEXT1," ",YA(33))_" "   
	. . . . . ;IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YA(33)),1,26))>$PIECE(YBELEG1,Y,73) DO SPE^INDRUCK SET A=$EXTRACT(YSPE,1,YA(2))
	. . . . . QUIT
	. . . . IF $TRANSLATE(A," ")'="" DO SPE^INDRUCK
	. . . . IF $TRANSLATE(A," ")="" IF YA(33)=1 DO SPE^INDRUCK
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
]]></Routine>
</Export>