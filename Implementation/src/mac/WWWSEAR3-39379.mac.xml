<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWSEAR3" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWSEAR3
#include COMSYS
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		SUCHANZEIGE
	;
	; Inputs : 
	;
	;
	; ByRef :
	;	YSUCH
	;	YFORM
	;	YDATEI
	;	YSUCH1		objWWW123	FORMULAR; DATEI; SORTKEY; VORGABEKEY|VORGABEDATEN; ANZEIGE KEY;
	;							ANZEIGEFELD; STD SORT; ANZEIGE ERGEBNIS; ORIENTIERUNG; ANZAHL ANZEIGEN;
	;							FIXKEY; FELDER MIT SUMMENBILDUNG; WELCHEN KEY UEBERGEBEN; ; ; Header
	;
	;	YNOSORT		=ANZEIGE OHNE SORTIER MÖGLICHKEIT ;without possibility 
	;
	; Returns :
	;
	;
	; History :
	; 03-May-2007	GRF		SR15509: Doco; brace format; quits; boolean macros
	; 30-May-2005	RobertW	SR12056: Attempt at Performance Increase
	; 26.10.1999	DT		(C) BY DITMAR TYBUSSEK
	;-------------------------------------------------------------------------------
	NEW YADDS,YLFN,YA,YI,YSRI,YBEV,YSUCH3,TELYES,YDDSATZ,datei,YFARBCODE
	
	SET TELYES=+$PIECE($GET(^WWW012(0,YM,1)),Y,92)  ;MIT TELEFONANWAHL =1 ;by means of 
	SET YSUCH3=$GET(YSUCH)   ;LFD SUCHFUNKTION FÜR LÄNGE DER ANZEIGE DER EINZELFELDER ;to longitude the Show the 
	IF $GET(YFORM)=""  IF $PIECE($GET(YSUCH1),Y,1)'="" SET YFORM =$PIECE($GET(YSUCH1),Y,1)  ;TYBD;26.06.2003
	IF $GET(YDATEI)="" IF $PIECE($GET(YSUCH1),Y,2)'="" SET YDATEI=$PIECE($GET(YSUCH1),Y,2)
	IF YSUCH3="" SET YSUCH3=$ORDER(^WWW1232(0,YFORM,""))
	
	QUIT:$GET(YDATEI)=""   ;FINDEN BERECHTIGUNG ;find 
	
	IF $PIECE($GET(YVOR),Y,7)="" DO ^WWWFORMX  ;VORGABEN WWW120,WWW012
	SET YMAXKEY=+$ORDER(^WWW002(0,YDATEI,""),-1)
	IF '$DATA(YBER) DO
	. SET YBEV=^WWW013(0,YBED,1)
	. IF $GET(YM)="" SET YM=$PIECE(YBEV,Y,5)
	. IF YM="" SET YM=0
	. SET YBER=$PIECE(YBEV,Y,3)
	
	IF $PIECE($GET(YSUCH1),Y,20)'="" DO
	. WRITE YCR,"&nbsp;"
	. write "<FONT SIZE=2><B>"
	. DO
	. . IF $EXTRACT($PIECE($GET(YSUCH1),Y,20),1,2)="::" WRITE $EXTRACT($PIECE(YSUCH1,Y,20),3,99) QUIT
	. . WRITE $$^WWWTEXT($PIECE($GET(YSUCH1),Y,20))  ;POSITIONEN OHNE ERFASSTE ER ;without him 
	. ;
	. WRITE "</B></FONT>",YCR
	
	IF $PIECE($GET(YSUCH1),Y,21)=$$$YES {
		DO ^WWWFRAME(2)
	} else {
		DO ^WWWFRAME(0)
	}
	
	;IF YBEDBER=1 WRITE YCR,YCR,"<!-- ************************* SUCHERGEBNIS KOPF (WWWSEAR3)************************* -->",YCR,YCR
	DO KOPF   ;ÜBERSCHRIFT ;superscription 
	;IF YBEDBER=1 WRITE YCR,YCR,"<!-- ************************* SUCHERGEBNIS DATEN (WWWSEAR3)************************* -->",YCR,YCR
	
	DO ANZEIGE   ;DATENANZEGE
	IF $PIECE(YSUCH1,Y,12)'="" DO SUMME^WWWSEAR5  ;SUMMENZEILE
	WRITE YCR
	DO ^WWWFRAME(1)
	;W YCR,$G(YDDSATZ) ;ANZAHL DER DATENSÄTZE
	QUIT
	
KOPF ;ANZEIGEN KOPFLEISTE ;display 
	;-------------------------------------------------------------------------------
	;
	; Params:
	;
	; ByRefs:
	;
	; Returns:
	;
	; History:
	; 03-May-2007	GRF		SR15509: Doco; brace format; quits; boolean macros;
	; 						named references; close </FONT>
	; 05-Sep-2006	HEBERB	SRBR014194: No grid header when fieldname "_BLANK"
	;-------------------------------------------------------------------------------
	NEW YPRIMFIRST
	
	SET YPRIMFIRST=0
	WRITE YCR,"<TR>"
	
	;PRIMÄRSCHÜSSEL
	SET YLFN=""
	FOR  SET YLFN=$ORDER(^WWW002(0,YDATEI,YLFN)) QUIT:YLFN=""  DO
	. IF YFOART=3 QUIT:$ORDER(^WWW002(0,YDATEI,YLFN))=""        ;FÜR GRID ;to 
	. IF $PIECE(YSUCH1,Y,5)="" IF $PIECE(YSUCH1,Y,6)'="" QUIT   ;KEINE KEY WEIL NICHT AUSGEWÄHT ;no KEY since Not 
	. IF $PIECE(YSUCH1,Y,5)'="" IF $ORDER(^WWW002(0,YDATEI,YLFN))'="" QUIT:'$FIND(","_$TRANSLATE($PIECE(YSUCH1,Y,5),";",",")_",",","_YLFN_",")   ;NICHT AUSGEWÄHLT
	. WRITE "<TH NOWRAP ALIGN=LEFT"
	. IF $PIECE(YVOR,Y,83)=""  WRITE " BGCOLOR="_YDARKGRAY
	. IF $PIECE(YVOR,Y,83)'="" WRITE " class=""header"""        ;FIS;CUSTOMER CSS STYLESHEET;08.12.04;26564
	. WRITE ">"
	. IF $PIECE(YVOR,Y,7)'=""  WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	. DO
	. . NEW YTEXT  ;TYB;10.07.2002 ; CUSTOMIZING MIT NAME IN HEADER
	. . SET YTEXT=""
	. . IF YDATEI=$GET(YFORM) SET YTEXT=$$^WWWUML($$^WWWFELDNAME(YFORM,"P",YLFN),1)
	. . IF YTEXT="" IF $DATA(^WWW0021(0,YDATEI,YLFN,SPRACHE,1)) SET YTEXT=$$^WWWUML($PIECE($GET(^WWW0021(0,YDATEI,YLFN,SPRACHE,1)),Y,1),1)   ;TYBD;4,10,2004; QUIT ENTFERNT
	. . IF YTEXT="" SET YTEXT=$$^WWWUML($PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,2),1)
	. . IF YSUCH3'="" IF $GET(YFORM)'="" IF +$PIECE($GET(^WWW1231(0,YFORM,YSUCH3,YLFN,1)),Y,2)'=0 DO   ;LÄNGENBEGRENZUNG ;TYBD;27,7,2004
	. . . SET YTEXT=$EXTRACT($GET(YTEXT),1,+$PIECE($GET(^WWW1231(0,YFORM,YSUCH3,YLFN,1)),Y,2))
	. . ;
	. . WRITE YTEXT
	. . ;IF $DATA(^WWW0021(0,YDATEI,YLFN,SPRACHE,1)) WRITE $$^WWWUML($PIECE($GET(^WWW0021(0,YDATEI,YLFN,SPRACHE,1)),Y,1),1) QUIT
	. . ;WRITE $$^WWWUML($PIECE($GET(^WWW002(0,YDATEI,YLFN,1)),Y,2),1)
	. ;
	. IF YPRIMFIRST=0 DO  ;SORT
	. . QUIT:$GET(YNOSORT)=1   ;UNTERSORT AUSSCHALTEN ;eliminate 
	. . ;
	. . WRITE "<A"
	. . WRITE " TITLE="""_$$^WWWTEXT(65)_""""              ;SORTIERUNG ;sorting 
	. . WRITE " HREF="""
	. . WRITE YAKTION_"EP=WWWSEAR&amp;YFORM="_YFORM_"&amp;YSORT=&amp;YFUNCT=3&amp;YORIENT=1&amp;YANZAHL="_$GET(YANZAHL)_"&amp;YSUCH="_$GET(YSUCH)_"&amp;YAUSWAHL=&amp;YVORGABE=&amp;YLFN=3"
	. . DO ^WWWCGI
	. . WRITE """> "
	. . WRITE "<IMG SRC="""_YGIF_"scrup.gif"" BORDER=0>"
	. . WRITE "</A>"                                       ;ENDE SORT ;termination 
	. ;
	. IF YPRIMFIRST=0 DO
	. . QUIT:$GET(YNOSORT)=1   ;UNTERSORT AUSSCHALTEN ;eliminate 
	. . WRITE "<A"
	. . WRITE " TITLE="""_$$^WWWTEXT(65)_""""              ;SORTIERUNG ;sorting 
	. . WRITE " HREF="""
	. . WRITE YAKTION_"EP=WWWSEAR&amp;YFORM="_YFORM_"&amp;YSORT=&amp;YFUNCT=3&amp;YORIENT=0&amp;YANZAHL="_$GET(YANZAHL)_"&amp;YSUCH="_$GET(YSUCH)_"&amp;YAUSWAHL=&amp;YVORGABE="
	. . DO ^WWWCGI
	. . WRITE """> "
	. . WRITE "<IMG SRC="""_YGIF_"scrdown.gif"" BORDER=0>"
	. . WRITE "</A>"                                       ;ENDE SORT ;termination 
	. ;
	. SET YPRIMFIRST=1
	. if $piece(YVOR,Y,7)'="" write "</FONT>"            ; SR15509
	. WRITE YCR,"</TH>"
	
	;KEIN PRIMÄRSCHLÜSSEL ;no 
	IF '$DATA(^WWW002(0,YDATEI)) {            ; SR15509
		WRITE "<TH NOWRAP ALIGN=LEFT BGCOLOR="_YDARKGRAY_">"
		IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
		WRITE "#"
		if $piece(YVOR,Y,7)'="" write "</FONT>"            ; SR15509
		WRITE "</TH>",YCR
	}
	
	;WENN OHNE VORGABE ;when without default 
	IF $TRANSLATE($PIECE(YSUCH1,Y,16),",; 0-""")'="" SET $PIECE(YSUCH1,Y,6)=$PIECE(YSUCH1,Y,16)  ;SORTIERUNG UMDEREHEN
	IF $PIECE(YSUCH1,Y,6)="" IF YFOART'=3 SET YLFN="" FOR YANLZ=1:1 SET YLFN=$ORDER(^WWW003(0,YDATEI,YLFN)) QUIT:YLFN=""  DO
	. NEW YSORTX,strYTEXT,strAccessList     ; SR15509
	. ;IF +YBER'=1 IF YBER'="" IF $PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,14)'="" IF $PIECE(^(1),Y,14)'=99 IF '$FIND(","_$TRANSLATE($PIECE(^(1),Y,14),";",",")_",",","_YBER_",") QUIT
	. IF +YBER'=1 IF YBER'="" set strAccessList=$piece($get(^WWW003(0,YDATEI,YLFN,1)),Y,14) if (strAccessList'="")&&(strAccessList'=99)&&'$find(","_$translate(strAccessList,";",",")_",",","_YBER_",") quit  ; SR15509 naked ref
	. IF $PIECE(YSUCH1,Y,6)=""  QUIT:YANLZ>8
	. IF $PIECE(YSUCH1,Y,6)'="" QUIT:'$FIND(","_$TRANSLATE($PIECE(YSUCH1,Y,6),";",",")_",",","_YLFN_",")
	. WRITE "<TH NOWRAP ALIGN=LEFT"
	. IF $PIECE(YVOR,Y,83)=""  WRITE " BGCOLOR="_YDARKGRAY
	. IF $PIECE(YVOR,Y,83)'="" WRITE " class=""header"""  ;FIS;CUSTOMER CSS STYLESHEET;08.12.04;26564
	. WRITE ">"
	. IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	. SET YSORTX=+$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,6)
	. DO
	. . NEW YTEXT
	. . IF YDATEI=$GET(YFORM) SET YTEXT=$$^WWWFELDNAME(YFORM,"D",YLFN) IF YTEXT'="" DO  QUIT  ;TYB;10.07.2002 ; CUSTOMIZING MIT NAME IN HEADER
	. . . IF $FIND(YTEXT,"_BLANK")'=0 WRITE "&nbsp;" DO  QUIT	// BR014194
	. . . WRITE YTEXT
	. . . ;IF $FIND($$^WWWUPER(YTEXT),"TELEFON")  SET YTELE(YLFN)=1
	. . . ;IF $FIND($$^WWWUPER(YTEXT),"TELEPHON") SET YTELE(YLFN)=1
	. . . set strYTEXT=$zconvert(YTEXT,"U")
	. . . IF $FIND(strYTEXT,"TELEFON")  SET YTELE(YLFN)=1
	. . . IF $FIND(strYTEXT,"TELEPHON") SET YTELE(YLFN)=1
	. . ;
	. . IF $DATA(^WWW0031(0,YDATEI,YLFN,SPRACHE,1)) DO  QUIT
	. . . SET YTEXT=$$^WWWUML($PIECE($GET(^WWW0031(0,YDATEI,YLFN,SPRACHE,1)),Y,1),1)
	. . . WRITE YTEXT
	. . . ;IF $FIND($$^WWWUPER(YTEXT),"TELEFON")  SET YTELE(YLFN)=1
	. . . ;IF $FIND($$^WWWUPER(YTEXT),"TELEPHON") SET YTELE(YLFN)=1
	. . . set strYTEXT=$zconvert(YTEXT,"U")
	. . . IF $FIND(strYTEXT,"TELEFON")  SET YTELE(YLFN)=1
	. . . IF $FIND(strYTEXT,"TELEPHON") SET YTELE(YLFN)=1
	. . ;
	. . SET YTEXT=$$^WWWUML($PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,2),1)
	. . WRITE YTEXT
	. . ;IF $FIND($$^WWWUPER(YTEXT),"TELEFON")  SET YTELE(YLFN)=1
	. . ;IF $FIND($$^WWWUPER(YTEXT),"TELEPHON") SET YTELE(YLFN)=1
	. . set strYTEXT=$zconvert(YTEXT,"U")
	. . IF $FIND(strYTEXT,"TELEFON")  SET YTELE(YLFN)=1
	. . IF $FIND(strYTEXT,"TELEPHON") SET YTELE(YLFN)=1
	. . SET datei(YANLZ)=$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,3)=10
	. ;
	. IF +YSORTX'=0 IF $PIECE(YSORTX,".",2)<2 DO  ;SORT
	. . QUIT:$GET(YNOSORT)=1   ;UNTERSORT AUSSCHALTEN ;eliminate 
	. . WRITE "<A"
	. . WRITE " TITLE="""_$$^WWWTEXT(65)_""""              ;SORTIERUNG ;sorting 
	. . WRITE " HREF="""
	. . WRITE YAKTION_"EP=WWWSEAR&amp;YFORM="_YFORM_"&amp;YSORT="_$PIECE(YSORTX,".",1)_"&amp;YFUNCT=&amp;YORIENT=1&amp;YANZAHL="_$GET(YANZAHL)_"&amp;YSUCH="_$GET(YSUCH)_"&amp;YAUSWAHL=&amp;YVORGABE="
	. . DO ^WWWCGI
	. . WRITE """> "
	. . WRITE "<IMG SRC="""_YGIF_"scrup.gif"" BORDER=0>"
	. . WRITE "</A>"                                       ;ENDE SORT ;termination 
	. ;
	. IF +YSORTX'=0 IF $PIECE(YSORTX,".",2)<2 DO  ;SORT
	. . QUIT:$GET(YNOSORT)=1   ;UNTERSORT AUSSCHALTEN ;eliminate 
	. . WRITE "<A"
	. . WRITE " TITLE="""_$$^WWWTEXT(65)_""""              ;SORTIERUNG ;sorting 
	. . WRITE " HREF="""
	. . WRITE YAKTION_"EP=WWWSEAR&amp;YFORM="_YFORM_"&amp;YSORT="_$PIECE(YSORTX,".",1)_"&amp;YFUNCT=&amp;YORIENT=0&amp;YANZAHL="_$GET(YANZAHL)_"&amp;YSUCH="_$GET(YSUCH)_"&amp;YAUSWAHL=&amp;YVORGABE="
	. . DO ^WWWCGI
	. . WRITE """> "
	. . WRITE "<IMG SRC="""_YGIF_"scrdown.gif"" BORDER=0>"
	. . WRITE "</A>"                                       ;ENDE SORT ;termination 
	. ;
	. if $piece(YVOR,Y,7)'="" write "</FONT>"              ; SR15509
	. WRITE "</TH>",YCR
	
	;WENN MIT VORGABE ;when by means of default 
	IF $PIECE(YSUCH1,Y,6)'="" IF YFOART'=3 DO
	. SET $PIECE(YSUCH1,Y,6)=$TRANSLATE($PIECE(YSUCH1,Y,6),";",",")
	. FOR YANLZ=1:1 SET YLFN=$PIECE($PIECE(YSUCH1,Y,6),",",YANLZ) QUIT:YLFN=""  DO
	. . NEW SORTX,strYTEXT,strAccessList     ; SR15509
	. . ;IF +YBER'=1 IF YBER'="" IF $PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,14)'="" IF $PIECE(^(1),Y,14)'=99 IF '$FIND(","_$TRANSLATE($PIECE(^(1),Y,14),";",",")_",",","_YBER_",") QUIT
	. . IF +YBER'=1 IF YBER'="" set strAccessList=$piece($get(^WWW003(0,YDATEI,YLFN,1)),Y,14) if (strAccessList'="")&&(strAccessList'=99)&&'$find(","_$translate(strAccessList,";",",")_",",","_YBER_",") quit  ; SR15509 naked ref
	. . ;
	. . WRITE "<TH NOWRAP ALIGN=LEFT"
	. . IF $PIECE(YVOR,Y,83)=""  WRITE " BGCOLOR="_YDARKGRAY
	. . IF $PIECE(YVOR,Y,83)'="" WRITE " class=""header"""  ;FIS;CUSTOMER CSS STYLESHEET;08.12.04;26564
	. . WRITE ">"
	. . IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	. . SET YSORTX=+$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,6)
	. . DO
	. . . NEW YTEXT
	. . . IF YDATEI=$GET(YFORM) SET YTEXT=$$^WWWFELDNAME(YFORM,"D",YLFN) IF YTEXT'="" DO  QUIT  ;TYB;10.07.2002 ; CUSTOMIZING MIT NAME IN HEADER
	. . . . IF YSUCH3'="" IF $PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,4)'="" SET YTEXT=$$^WWWTEXT($PIECE(^WWW1232(0,YFORM,YSUCH3,YLFN,1),Y,4))   ; SR15509 naked ref
	. . . . IF YSUCH3'="" IF +$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2)'=0 DO   ;LÄNGENBEGRENZUNG
	. . . . . SET YTEXT=$EXTRACT(YTEXT,1,+$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2))
	. . . . ;
	. . . . IF '$FIND(YTEXT,"m2") IF '$FIND(YTEXT,"m3") WRITE YTEXT
	. . . . IF $FIND(YTEXT,"m2") WRITE $PIECE(YTEXT,"m2",1)_"m<sup>"_2_"</sup>"_$PIECE(YTEXT,"m2",2,99)
	. . . . IF $FIND(YNAME,"m3") WRITE $PIECE(YTEXT,"m3",1)_"m<sup>"_3_"</sup>"_$PIECE(YTEXT,"m3",2,99)
	. . . . ;IF $FIND($$^WWWUPER(YTEXT),"TELEFON") SET YTELE(YLFN)=1
	. . . . ;IF $FIND($$^WWWUPER(YTEXT),"TELEPHON") SET YTELE(YLFN)=1
	. . . . set strYTEXT=$zconvert(YTEXT,"U")
	. . . . IF $FIND(strYTEXT,"TELEFON")  SET YTELE(YLFN)=1
	. . . . IF $FIND(strYTEXT,"TELEPHON") SET YTELE(YLFN)=1
	. . . ;
	. . . IF $DATA(^WWW0031(0,YDATEI,YLFN,SPRACHE,1)) DO  QUIT
	. . . . SET YTEXT=$$^WWWUML($PIECE($GET(^WWW0031(0,YDATEI,YLFN,SPRACHE,1)),Y,1),1)
	. . . . IF YSUCH3'="" IF $PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,4)'="" SET YTEXT=$$^WWWTEXT($PIECE(^(1),Y,4))
	. . . . IF YSUCH3'="" IF +$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2)'=0 DO   ;LÄNGENBEGRENZUNG
	. . . . . SET YTEXT=$EXTRACT(YTEXT,1,+$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2))
	. . . . ;
	. . . . IF '$FIND(YTEXT,"m2") IF '$FIND(YTEXT,"m3") WRITE YTEXT
	. . . . IF $FIND(YTEXT,"m2") WRITE $PIECE(YTEXT,"m2",1)_"m<sup>"_2_"</sup>"_$PIECE(YTEXT,"m2",2,99)
	. . . . IF $FIND(YNAME,"m3") WRITE $PIECE(YTEXT,"m3",1)_"m<sup>"_3_"</sup>"_$PIECE(YTEXT,"m3",2,99)
	. . . . ;IF $FIND($$^WWWUPER(YTEXT),"TELEFON")  SET YTELE(YLFN)=1
	. . . . ;IF $FIND($$^WWWUPER(YTEXT),"TELEPHON") SET YTELE(YLFN)=1
	. . . . set strYTEXT=$zconvert(YTEXT,"U")
	. . . . IF $FIND(strYTEXT,"TELEFON")  SET YTELE(YLFN)=1
	. . . . IF $FIND(strYTEXT,"TELEPHON") SET YTELE(YLFN)=1
	. . . ;
	. . . SET YTEXT=$$^WWWUML($PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,2),1)
	. . . IF YSUCH3'="" IF $PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,4)'="" SET YTEXT=$$^WWWTEXT($PIECE(^WWW1232(0,YFORM,YSUCH3,YLFN,1),Y,4))   ; SR15509 naked ref
	. . . IF YSUCH3'="" IF +$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2)'=0 DO   ;LÄNGENBEGRENZUNG
	. . . . SET YTEXT=$EXTRACT(YTEXT,1,+$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2))
	. . . ;
	. . . IF '$FIND(YTEXT,"m2") IF '$FIND(YTEXT,"m3") WRITE YTEXT
	. . . IF $FIND(YTEXT,"m2") WRITE $PIECE(YTEXT,"m2",1)_"m<sup>"_2_"</sup>"_$PIECE(YTEXT,"m2",2,99)
	. . . IF $FIND(YNAME,"m3") WRITE $PIECE(YTEXT,"m3",1)_"m<sup>"_3_"</sup>"_$PIECE(YTEXT,"m3",2,99)
	. . . ;IF $FIND($$^WWWUPER(YTEXT),"TELEFON") SET YTELE(YLFN)=1
	. . . ;IF $FIND($$^WWWUPER(YTEXT),"TELEPHON") SET YTELE(YLFN)=1
	. . . set strYTEXT=$zconvert(YTEXT,"U")
	. . . IF $FIND(strYTEXT,"TELEFON")  SET YTELE(YLFN)=1
	. . . IF $FIND(strYTEXT,"TELEPHON") SET YTELE(YLFN)=1
	. . . SET datei(YANLZ)=$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,3)=10
	. . ;
	. . IF +YSORTX'=0 IF $PIECE(YSORTX,".",2)<2 DO  ;SORT
	. . . QUIT:$GET(YNOSORT)=1   ;UNTERSORT AUSSCHALTEN ;eliminate 
	. . . WRITE "<A"
	. . . WRITE " TITLE="""_$$^WWWTEXT(65)_""""            ;SORTIERUNG ;sorting 
	. . . WRITE " HREF="""
	. . . WRITE YAKTION_"EP=WWWSEAR&amp;YFORM="_YFORM_"&amp;YSORT="_$PIECE(YSORTX,".",1)_"&amp;YFUNCT=&amp;YORIENT=1&amp;YANZAHL="_$GET(YANZAHL)_"&amp;YSUCH="_$GET(YSUCH)_"&amp;YAUSWAHL=&amp;YVORGABE="
	. . . DO ^WWWCGI
	. . . WRITE """> "
	. . . WRITE "<IMG SRC="""_YGIF_"scrup.gif"" BORDER=0>"
	. . . WRITE "</A>"                                     ;ENDE SORT ;termination 
	. . ;
	. . IF +YSORTX'=0 IF $PIECE(YSORTX,".",2)<2 DO  ;SORT
	. . . QUIT:$GET(YNOSORT)=1   ;UNTERSORT AUSSCHALTEN ;eliminate 
	. . . WRITE "<A"
	. . . WRITE " TITLE="""_$$^WWWTEXT(65)_""""            ;SORTIERUNG ;sorting 
	. . . WRITE " HREF="""
	. . . WRITE YAKTION_"EP=WWWSEAR&amp;YFORM="_YFORM_"&amp;YSORT="_$PIECE(YSORTX,".",1)_"&amp;YFUNCT=&amp;YORIENT=0&amp;YANZAHL="_$GET(YANZAHL)_"&amp;YSUCH="_$GET(YSUCH)_"&amp;YAUSWAHL=&amp;YVORGABE="
	. . . DO ^WWWCGI
	. . . WRITE """> "
	. . . WRITE "<IMG SRC="""_YGIF_"scrdown.gif"" BORDER=0>"
	. . . WRITE "</A>"                                     ;ENDE SORT ;termination 
	. . ;
	. . if $piece(YVOR,Y,7)'="" write "</FONT>"            ; SR15509
	. . WRITE "</TH>",YCR
	
	WRITE "</TR>",YCR
	QUIT
	
ANZEIGE
	;-------------------------------------------------------------------------------
	; Display single record
	;
	; Params:
	;
	; Returns:
	;
	; History:
	; 09-Oct-2007	shobby	SRBR014744: Don't keep checking if there are no call out methods.
	; 09-Oct-2007	shobby	SRBR014744: Pass the class that is being used to populate the list in to the DataAccess call
	; 26-Feb-2007	JW		SR15452: Rewrote. Added data access check. Added param to ANZEIGE1
	;-------------------------------------------------------------------------------
	NEW YKEYY,YKEY,YSEITE,strExec,intCounter,blnCheck
	
	SET YSEITE=1  		;Ziel darf nicht aktuelle Seite sein, da vieleicht nicht vorhanden
	SET YDDSATZ=0
	
	;YHEADONLY=1=NO DATARECORDS ONLY HEADER
	IF $GET(YHEADONLY)'=1 {
		set strExec = $$$WWW001DataAccess($get(^WWW001(0,YDATEI,1)))
		set blnCheck=$$$YES
		$$$Order3(^WWWSOR,YUSER,"KEY",intCounter)
			$$$Order4(^WWWSOR,YUSER,"KEY",intCounter,YKEYY)
				if blnCheck&&'$$DataAccess^WWWFieldValidation(strExec,YKEYY,$get(LASTUSEDFORM),,,,YDATEI,.blnCheck) {	;BR014744 //SR15452 - LASTUSEDFORM is the best option here.
					kill ^WWWSOR(YUSER,"KEY",intCounter,YKEYY)		// So still get blank lines
				} else {
					DO ANZEIGE1($$$NO)
				}
			$$$End
		$$$End
	}
	/* SR15452 - rewritten above.
	IF $GET(YHEADONLY)'=1 SET YA(2)="" FOR  SET YA(2)=$ORDER(^WWWSOR(YUSER,"KEY",YA(2))) QUIT:YA(2)=""  DO
	. SET YKEYY="" FOR  SET YKEYY=$ORDER(^WWWSOR(YUSER,"KEY",YA(2),YKEYY)) QUIT:YKEYY=""  DO ANZEIGE1
	*/
	;
	IF '$DATA(^WWWSOR(YUSER,"KEY"))!(YDDSATZ<$GET(YANZAHL)) DO
	. NEW YBLANKLINE
	. SET YBLANKLINE(1)=$GET(YANZAHL)
	. IF $GET(YANZAHL)<5 SET YBLANKLINE(1)=5  ;TYBD;VORGABE AUS SUCHFELD ;default out of 
	. IF $GET(YANZAHL)>30 SET YBLANKLINE(1)=30  ;TYBD ; VORGABE AUS SPEICHERUNG
	. SET YBLANKLINE=$GET(YDDSATZ)
	. IF $PIECE($GET(^WWW012(0,YM,1)),Y,144)=1  SET YBLANKLINE(1)=YBLANKLINE  ;NICHT ANZEIGEN;TYBD;8,09,2003;24248
	. FOR YBLANKLINE=YBLANKLINE:1:YBLANKLINE(1) SET YKEYY="" DO ANZEIGE1($$$YES)	//SR15452
	
	KILL ^WWWSOR(YUSER,"KEY")
	QUIT
	
ANZEIGE1(pblnBlank)
	;-------------------------------------------------------------------------------
	; History:
	; 06-Jan-2011	GRF		SR17579: Use explicit tag
	; 03-May-2007	GRF		SR15509: Doco; quits; close </FONT>
	; 24-Apr-2007	HeberB	BR014432: show ID when no text provided
	; 13-Apr-2007	HeberB	BR014432: Show ID if requested
	; 06-Mar-2007	JW		SR15452: Added param. Don't format if blank.
	; 22-Dec-2005	RPW		SR13899: New schluessel
	; 23-Nov-2005	JW		SR13195: New YFELD, as had undesired results
    ; 28-Oct-2005	JW		SR13074: Exchange Rate type
	;-------------------------------------------------------------------------------
	new YFELD,SCHLUESSEL,blnHide ; BR014432
	
	SET YKEY=YKEYY
	IF YFOART=3 SET $PIECE(YKEY,",",YMAXKEY)=""  ;BEI GRID OHNE LETZTEN KEY ;next to without KEY 
	SET YDDSATZ=YDDSATZ+1                        ;HINTERGRUNDFARBE
	WRITE "<TR>"
	
	SET YLFN=""
	FOR  SET YLFN=$ORDER(^WWW002(0,YDATEI,YLFN)) QUIT:YLFN=""  DO
	. IF YFOART=3 QUIT:$ORDER(^WWW002(0,YDATEI,YLFN))=""
	. IF $PIECE(YSUCH1,Y,5)=""  IF $PIECE(YSUCH1,Y,6)'="" QUIT   ;KEINE KEY WEIL NICHT AUSGEWÄHT ;no KEY since Not 
	. IF $PIECE(YSUCH1,Y,5)'="" IF $ORDER(^WWW002(0,YDATEI,YLFN))'="" QUIT:'$FIND(","_$TRANSLATE($PIECE(YSUCH1,Y,5),";",",")_",",","_YLFN_",")
	. ;
	. WRITE "<TD VALIGN=TOP NOWRAP"
	. IF $PIECE(YVOR,Y,83)=""  IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. IF $PIECE(YVOR,Y,83)=""  IF YDDSATZ#2=0 WRITE " BGCOLOR="_YGRAY
	. IF $PIECE(YVOR,Y,83)'="" IF YDDSATZ#2=1 WRITE " class=""white"""  ;FIS;CUSTOMER CSS STYLESHEET;08.12.04;26564
	. IF $PIECE(YVOR,Y,83)'="" IF YDDSATZ#2=0 WRITE " class=""gray"""  ;FIS;CUSTOMER CSS STYLESHEET;08.12.04;26564
	. WRITE ">"
	. WRITE "<DIV>"
	. IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	. SET YINHALT=$PIECE(YKEY,",",YLFN)
	. IF YINHALT'="" IF $FIND(YINHALT,".htm")!($FIND(YINHALT,".HTM")) DO
	. . WRITE "<A HREF="""
	. . IF $FIND(YINHALT,"C:") WRITE "file://"
	. . WRITE YINHALT_""">"
	. ;
	. IF '$FIND(YINHALT,".htm") IF '$FIND(YINHALT,".HTM") DO
	. . WRITE "<A"
	. . IF $GET(YBITSEARCH)=1 WRITE " TARGET="""_YTARGET_""""  ;FIS;BITSEARCH;23909;14.12.03
	. . IF $PIECE(YSUCH1,Y,8)'=0 DO 
	. . . IF $GET(YTOOLTIP)=""  WRITE " TITLE="""_$$^WWWTEXT(374)_""""  ;DATENSATZ AUSWÄHLEN ;data record pick out 
	. . . IF $GET(YTOOLTIP)'="" WRITE " TITLE="""_YTOOLTIP_""""          ;DATENSATZ AUSWÄHLEN ;data record pick out 
	. . ;
	. . WRITE " HREF="""
	. . ;
	. . IF $GET(YWSAVE)'="" DO   ;AUTOMATISCHER SAVE;TYBD;20,10,2003;24142
	. . . NEW YKEY,YFORM
	. . . SET YFORM=$PIECE(YWSAVE,Y,1)
	. . . SET YKEY=$PIECE(YWSAVE,Y,2)
	. . . WRITE "JavaScript:" 
	. . . WRITE "retval=EventValue('"_YUCI_"','"_YUSER_"','"_YFORM_"','FIX','Y"_YFORM_"','','9');"
	. . . WRITE "window.location='"
	. . . SET YCONF3="';"
	. . ;
	. . IF $PIECE(YSUCH1,Y,8)'=0 DO 
	. . . WRITE YAKTION_"EP=WWWFORM&amp;YFORM="_YFORM
	. . . IF $GET(YTIMEFORM)=1 WRITE "t"               ;zeitabhängige erfassungsformular
	. . . WRITE "&amp;YSEITE="_YSEITE
	. . . DO ^WWWCGI
	. . ;
	. . IF $PIECE(YSUCH1,Y,8)=0 WRITE "#"
	. . IF $GET(YWSAVE)'="" WRITE "';"                 ;ENDE 
	. . WRITE """"
	. . WRITE ">"
	. ;
	. SET YINHALT =$$^WWWFORMAT(YDATEI,"P",YLFN,YINHALT,1)  ;FORMAT DES PRIMÄRSCHLÜSSELS
	. SET YINHALTK=$$^WWWFORMAT(YDATEI,"P",YLFN,YINHALT,2)  ;FORMAT DES PRIMÄRSCHLÜSSELS
	. IF YSUCH3'="" IF +$PIECE($GET(^WWW1231(0,YFORM,YSUCH3,YLFN,1)),Y,2)'=0 DO   ;LÄNGENBEGRENZUNG 
	. . SET YINHALT=$EXTRACT($GET(YINHALT),1,+$PIECE($GET(^WWW1231(0,YFORM,YSUCH3,YLFN,1)),Y,2))
	. ;
	. ;BR014432
	. ;WRITE $$^WWWUML($EXTRACT(YINHALT,1,30))
	. set blnHide = +$$$WWW012HideRelationClassIDs($get(^WWW012(0,YM,1)))
	. ;BR014432
	. ;if 'blnHide do
	. if 'blnHide || (blnHide && ($GET(YINHALTK)="")) do
	. . WRITE $$^WWWUML($EXTRACT(YINHALT,1,30))
	. IF YINHALT=" " WRITE "[space]"
	. IF $TRANSLATE(YINHALT," ")="" WRITE "&nbsp;"  ;TYBD;23,7,2004;WENN "  " Dann falsche anzeige
	. ;BR014432
	. ;IF $GET(YINHALTK)'="" IF YINHALTK'=YINHALT WRITE " ("_$$^WWWUML(YINHALTK)_")"
	. IF $GET(YINHALTK)'="" IF YINHALTK'=YINHALT WRITE $select(blnHide:$$^WWWUML(YINHALTK),1:" ("_$$^WWWUML(YINHALTK)_")")
	. IF YINHALT'="" IF $FIND(YINHALT,".GIF")!($FIND(YINHALT,".gif")) SET URL=YINHALT DO THUMP
	. IF $GET(YTIMEFORM)=1 DO  ;WENN ZEITABHÄNGIGE ERFASSUNG ;when logging 
	. . IF YLFN=YMAXKEY DO
	. . . WRITE " "
	. . . IF $PIECE(YKEY,",",YMAXKEY+1)'="" DO
	. . . . WRITE $$^WWWTEXT(293)," "
	. . . . WRITE $$^WWWDATE($PIECE(YKEY,",",YMAXKEY+1))
	. ;
	. WRITE "</A>"
	. WRITE "</DIV>"
	. WRITE "</TD>",YCR
	
	
	IF '$DATA(^WWW002(0,YDATEI)) {            ; SR15509
		WRITE "<TD VALIGN=TOP NOWRAP"
		IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
		IF YDDSATZ#2=0 WRITE " BGCOLOR="_YGRAY
		WRITE ">"
		WRITE "<DIV>"
		IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
		WRITE $PIECE($GET(YKEY),",",1)
		if $piece(YVOR,Y,7)'="" write "</FONT>"            ; SR15509
		WRITE "</DIV>"
		WRITE "</TD>",YCR
	}
	
	
	;ZUSAMMENBAUEN DES SCHLÜSSELS
	SET YFELD=""
	IF YDATEI'="" DO
	. SET YDATA=$GET(^WWW001(0,YDATEI,1))
	. SET MAXYKEY=+$ORDER(^WWW002(0,YDATEI,""),-1)
	. IF MAXYKEY=0 SET MAXYKEY=1
	. SET ERSTFELD=$ORDER(^WWW003(0,YDATEI,""))
	. SET FELDKEY=""
	. IF ERSTFELD'="" SET FELDKEY=$PIECE(^WWW003(0,YDATEI,ERSTFELD,1),Y,11) ;FUER MIT ODER OHNE ,1) ZUM SCHLUESSEL
	. IF MAXYKEY'=0 DO
	. . SET Q=0
	. . IF $GET(YTIMEFORM)'=1 SET SCHLUESSEL="^"_YDATEI_"("_$$^WWWYM(YDATEI,1)  ;TYBD:01.11.01
	. . IF $GET(YTIMEFORM)=1  SET SCHLUESSEL="^"_YDATEI_"t("_$$^WWWYM(YDATEI,1) SET MAXYKEY=MAXYKEY+1  ;TYBD:01.11.01
	. . FOR I=1:1:MAXYKEY SET XYKEY=$TRANSLATE($PIECE(YKEY,",",I),"""") SET SCHLUESSEL=SCHLUESSEL_""""_XYKEY_"""" SET:I<MAXYKEY SCHLUESSEL=SCHLUESSEL_"," IF XYKEY="" SET Q=1
	. . IF $PIECE(YDATA,Y,8)=4  SET SCHLUESSEL=SCHLUESSEL_$SELECT(FELDKEY'="":","_FELDKEY,1:"")_")"
	. . IF $PIECE(YDATA,Y,8)'=4 SET SCHLUESSEL=SCHLUESSEL_",1)"
	. . IF Q=0 DO
	. . . SET YFELD=$$^WWWSETL(SCHLUESSEL)
	
	;WENN OHNE VORGABE ;when without default 
	IF $TRANSLATE($PIECE(YSUCH1,Y,16),",; 0-""")'="" SET $PIECE(YSUCH1,Y,6)=$PIECE(YSUCH1,Y,16)   ;SORTIERUNG UMDEREHEN
	IF $PIECE(YSUCH1,Y,6)="" IF YFOART'=3 SET YLFN="" FOR YANLZ=1:1 SET YLFN=$ORDER(^WWW003(0,YDATEI,YLFN)) QUIT:YLFN=""  DO
	. new strAccessList     ; SR15509
	.;IF +YBER'=1 IF YBER'="" IF $PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,14)'="" IF $PIECE(^(1),Y,14)'=99 IF '$FIND(","_$TRANSLATE($PIECE(^(1),Y,14),";",",")_",",","_YBER_",") QUIT
	. IF +YBER'=1 IF YBER'="" set strAccessList=$piece($get(^WWW003(0,YDATEI,YLFN,1)),Y,14) if (strAccessList'="")&&(strAccessList'=99)&&'$find(","_$translate(strAccessList,";",",")_",",","_YBER_",") quit  ; SR15509 naked ref
	. IF $PIECE(YSUCH1,Y,6)=""  QUIT:YANLZ>8
	. IF $PIECE(YSUCH1,Y,6)'="" QUIT:'$FIND(","_$TRANSLATE($PIECE(YSUCH1,Y,6),";",",")_",",","_YLFN_",")
	. SET YINHALT=$PIECE(YFELD,Y,YLFN)
	. SET YINHALT=$$^WWWFORMAT(YDATEI,"D",YLFN,YINHALT,3)    ;FIS;25.03.03;23255;ANZEIGE MIT FARBE
	. SET YTYP=$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,3)
	. SET YFARBCODE=$PIECE(YINHALT,Y,2)
	. SET YINHALT=$PIECE(YINHALT,Y,1)
	. WRITE "<TD VALIGN=TOP"
	. ;IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. ;IF YDDSATZ#2=0 WRITE " BGCOLOR="_YGRAY
	. DO
	. . IF YFARBCODE'="" WRITE " BGCOLOR="""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,YFARBCODE,1)),Y,1)_"""" QUIT
	. . ;IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . ;IF YDDSATZ#2=0 WRITE " BGCOLOR="_YGRAY
	. . IF $PIECE(YVOR,Y,83)=""  IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . IF $PIECE(YVOR,Y,83)=""  IF YDDSATZ#2=0 WRITE " BGCOLOR="_YGRAY
	. . IF $PIECE(YVOR,Y,83)'="" IF YDDSATZ#2=1 WRITE " class=""white"""  ;FIS;CUSTOMER CSS STYLESHEET;08.12.04;26564
	. . IF $PIECE(YVOR,Y,83)'="" IF YDDSATZ#2=0 WRITE " class=""gray"""   ;FIS;CUSTOMER CSS STYLESHEET;08.12.04;26564
	. ;
	. IF YTYP=4||(YTYP=8)||(YTYP=12)||(YTYP=18) WRITE " ALIGN=RIGHT"		//SR13074
	. IF $GET(YTELE(YLFN))=1 WRITE " ALIGN=RIGHT"
	. WRITE " NOWRAP>"
	. WRITE "<DIV>"
	. IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	. IF $PIECE(YSUCH1,Y,12)'="" IF $FIND(","_$TRANSLATE($PIECE(YSUCH1,Y,12),";",",")_",",","_YLFN_",") DO
	. . SET YADDS(YLFN)=$$GetInternal^WWWTR(8,$TRANSLATE(YINHALT," "))+$GET(YADDS(YLFN))
	. ;
	. IF $ORDER(^WWW003(0,YDATEI,YLFN))="" IF $PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,3)=3 SET YINHALT=$PIECE(YFELD,Y,YLFN,9999)  ;TEXT
	. DO   ;I YLFN<3 D
	. . IF $FIND(YINHALT,".htm")!($FIND(YINHALT,".HTM")) QUIT
	. . WRITE "<A"
	. . IF $GET(YBITSEARCH)=1 WRITE " TARGET="""_YTARGET_""""  ;FIS;BITSEARCH;23909;14.12.03
	. . IF $GET(YTOOLTIP)=""  WRITE " TITLE="""_$$^WWWTEXT(374)_""""   ;DATENSATZ AUSWÄHLEN ;data record pick out 
	. . IF $GET(YTOOLTIP)'="" WRITE " TITLE="""_YTOOLTIP_""""   ;DATENSATZ AUSWÄHLEN ;data record pick out 
	. . WRITE " HREF="""
	. . ;
	. . IF $GET(YWSAVE)'="" DO   ;AUTOMATISCHER SAVE;TYBD;20,10,2003;24142
	. . . NEW YKEY,YFORM
	. . . SET YFORM=$PIECE(YWSAVE,Y,1)
	. . . SET YKEY=$PIECE(YWSAVE,Y,2)
	. . . WRITE "JavaScript:" 
	. . . WRITE "retval=EventValue('"_YUCI_"','"_YUSER_"','"_YFORM_"','FIX','Y"_YFORM_"','','9');"
	. . . WRITE "window.location='"
	. . . SET YCONF3="';"
	. . ;
	. . WRITE YAKTION_"EP=WWWFORM&amp;YFORM="_YFORM
	. . IF $GET(YTIMEFORM)=1 WRITE "t"  ;zeitabhängige erfassungsformular
	. . WRITE "&amp;YSEITE="_YSEITE
	. . IF $GET(YBUTTON)'="" ;W "&YOPEN=OLD"
	. . DO ^WWWCGI
	. . IF $GET(YWSAVE)'="" WRITE "';"  ;ENDE
	. . ;
	. . WRITE """>"
	. ;
	. IF $LENGTH(YINHALT)<30 IF YINHALT'="" IF $FIND(YINHALT,".htm")!($FIND(YINHALT,".HTM")) DO
	. . WRITE "<A HREF="""_YINHALT_""">"
	. ;
	. IF YINHALT="" SET datei(YANLZ)=0
	. IF +$GET(datei(YANLZ))'=0 DO  ;WENN GIF ODER DOKUMENT IN ANZEIGE ;when Or paper within Show 
	. . SET YURL=""  ;$PIECE($GET(^WWW012(0,YM,1)),Y,44)  ;FIS;22903;15.04.03
	. . SET OPT="HEIGHT=500,WIDTH=750,SCROLLBARS=YES,RESIZEABLE=YES"
	. . IF '$FIND(YINHALT,"//") SET YINHALT=YGIF1_YINHALT
	. . SET URL=YURL_YINHALT
	. . WRITE "<INPUT TYPE=BUTTON NAME='B"_YKEY_"' onClick='var menue=window.open("""_URL_""",""DOK"","""_OPT_""");menue.focus();' VALUE='"
	. ;
	. ; SR15509 naked ref vvv
	. ;IF YLFN=1 IF YDATEI="WWW001" IF SPRACHE'="DE" IF $PIECE(YKEY,",",1)'="" IF $DATA(^WWW0011(0,$PIECE(YKEY,",",1),SPRACHE,1)) SET YINHALT=$PIECE(^(1),Y,1)
	. ;IF YLFN=1 IF YDATEI="WWW120" IF SPRACHE'="DE" IF $PIECE(YKEY,",",1)'="" IF $DATA(^WWW1201(0,$PIECE(YKEY,",",1),SPRACHE,1)) SET YINHALT=$PIECE(^(1),Y,1)
	. IF YLFN=1 IF SPRACHE'="DE" IF $PIECE(YKEY,",",1)'="" do
	. . IF YDATEI="WWW001" IF $DATA(^WWW0011(0,$PIECE(YKEY,",",1),SPRACHE,1)) SET YINHALT=$PIECE(^WWW0011(0,$PIECE(YKEY,",",1),SPRACHE,1),Y,1)
	. . IF YDATEI="WWW120" IF $DATA(^WWW1201(0,$PIECE(YKEY,",",1),SPRACHE,1)) SET YINHALT=$PIECE(^WWW1201(0,$PIECE(YKEY,",",1),SPRACHE,1),Y,1)
	. ;
	. ;SET YINHALT=$$^WWWFORMAT(YDATEI,"D",YLFN,YINHALT,0)  ;FORMAT DER DATEN  -> SIEHE OBEN
	. NEW YCUT
	. SET YCUT=40
	. IF YSUCH3'="" DO
	. . IF +$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2)'=0 DO   ;LÄNGENBEGRENZUNG 
	. . . SET YCUT=+$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2)
	. . .;SET YINHALT=$EXTRACT(YINHALT,1,+$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2))
	. ;
	. ;IF YINHALT="" SET YINHALT="&nbsp;"
	. IF $TRANSLATE(YINHALT," ")="" WRITE "&nbsp;"  ;TYBD;23,7,2004;WENN "  " Dann falsche anzeige
	. IF +$GET(datei(YANLZ))'=0 SET YINHALT=$PIECE(YINHALT,"/",$LENGTH(YINHALT,"/"))
	. WRITE $$^WWWUML($EXTRACT(YINHALT,1,YCUT))
	. IF YSUCH3'="" DO  ;EXECUTE INNERHALB DER ANZEIGE ;EXECUTE inside the Show 
	. . IF $PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,3)'="" DO
	. . . XECUTE $PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,3)
	. ;
	. IF +$GET(datei(YANLZ))'=0 DO
	. . WRITE "'>"
	. .;IF "-GIF-JPEG-JPG-"[("-"_$PIECE($$^WWWUPER(YINHALT),".",2)_"_") SET URL=YINHALT DO THUMP
	. . IF "-GIF-JPEG-JPG-"[("-"_$PIECE($$$UPPER(YINHALT),".",2)_"_") SET URL=YINHALT DO THUMP
	. ;
	. IF YINHALT'="" IF $FIND(YINHALT,".GIF")||$FIND(YINHALT,".gif") SET URL=YINHALT DO THUMP
	. IF YINHALT'="" IF (YLFN=1)||$FIND(YINHALT,".htm")||$FIND(YINHALT,".HTM") DO
	. . WRITE "</A>"
	. ;
	. IF $EXTRACT(YINHALT)'="@" IF $FIND(YINHALT,"@") IF '$FIND(YINHALT," ") DO   ;ANZEIGE DES MAILBUTTONS ;Show 
	. . WRITE "&nbsp;"
	. . WRITE "<A HREF="""
	. . WRITE "mailto:"
	. . WRITE YINHALT
	. . WRITE """"
	. . WRITE ">"
	. . WRITE YCR,"<IMG SRC="""_YGIF_"mail.gif"" ALIGN=TEXTTOP TITLE=""mail"" border=0 width=18 height=18>"
	. . WRITE "</A>"
	. ;
	. IF $GET(TELYES)=1 IF $GET(YTELE(YLFN))=1 IF +YINHALT'=0 DO  ;TELEFON BUTTON;TYBD;6,12,2004
	. . NEW FILE
	. . WRITE "&nbsp;"
	. . IF $EXTRACT(YINHALT)="0" SET YINHALT="+49 "_$EXTRACT(YINHALT,2,999)  ;DE
	. . WRITE "<A HREF=""CALLTO://"_$TRANSLATE(YINHALT,"()-.#*_  &/!?")_""""
	. . WRITE ">"
	. . WRITE YCR,"<IMG SRC="""_YGIF_"verbind.gif"" ALIGN=TEXTTOP TITLE=""Telefon"" border=0 width=18 height=18>"
	. . WRITE "</A>"
	. ;
	. ; vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	. ;IF $GET(TELYES)=1 IF $GET(YTELE(YLFN))=1 IF +YINHALT'=0 DO    ;ANZEIGE DES TELEFONBUTTONS ;Show 
	. . NEW FILE
	. . WRITE "&nbsp;"
	. . SET FILE="ftp://"_$PIECE($GET(^WWW012(0,YM,1)),Y,46)
	. . SET FILE=FILE_"T"_$EXTRACT(+$TRANSLATE(YINHALT,"()-.+#*_  &/!?"),$LENGTH(+$TRANSLATE(YINHALT,"()-.+#*_  &/!?"))-3,$LENGTH(+$TRANSLATE(YINHALT,"()-.+#*_  &/!?")))_".BAT"
	. . WRITE "<A HREF="""_FILE_""""
	. . WRITE $TRANSLATE(YINHALT,"()-.+#*_  &/!?")_"')"
	. . DO ^WWWTELE($TRANSLATE(YINHALT,"()-.+#*_  &/!?"))
	. . WRITE ">"
	. . WRITE YCR,"<IMG SRC="""_YGIF_"verbind.gif"" ALIGN=TEXTTOP TITLE=""Telefon"" border=0 width=18 height=18>"
	. . WRITE "</A>"
	. ; ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	. ;
	. WRITE "</DIV>"
	. WRITE "</TD>",YCR
	
	;WENN MIT VORGABE ;when by means of default 
	IF $PIECE(YSUCH1,Y,6)'="" IF YFOART'=3 DO
	. SET $PIECE(YSUCH1,Y,6)=$TRANSLATE($PIECE(YSUCH1,Y,6),";",",")
	. FOR YANLZ=1:1 SET YLFN=$PIECE($PIECE(YSUCH1,Y,6),",",YANLZ) QUIT:YLFN=""  DO
	. . new strAccessList     ; SR15509
	. .;IF +YBER'=1 IF YBER'="" IF $PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,14)'="" IF $PIECE(^(1),Y,14)'=99 IF '$FIND(","_$TRANSLATE($PIECE(^(1),Y,14),";",",")_",",","_YBER_",") QUIT
	. . IF +YBER'=1 IF YBER'="" set strAccessList=$piece($get(^WWW003(0,YDATEI,YLFN,1)),Y,14) if (strAccessList'="")&&(strAccessList'=99)&&'$find(","_$translate(strAccessList,";",",")_",",","_YBER_",") quit  ; SR15509 naked ref
	. . SET YTYP=$PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,3)
	. . SET YINHALT=$PIECE(YFELD,Y,YLFN)
	. . SET:'pblnBlank YINHALT=$$^WWWFORMAT(YDATEI,"D",YLFN,YINHALT,3)  ;SR15452
	. . SET YFARBCODE=$PIECE(YINHALT,Y,2)
	. . SET YINHALT  =$PIECE(YINHALT,Y,1)
	. . WRITE "<TD VALIGN=TOP"
	. . ;IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . ;IF YDDSATZ#2=0 WRITE " BGCOLOR="_YGRAY
	. . DO
	. . . IF YFARBCODE'="" WRITE " BGCOLOR="""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,YFARBCODE,1)),Y,1)_"""" QUIT
	. . . ;IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . . ;IF YDDSATZ#2=0 WRITE " BGCOLOR="_YGRAY
	. . . IF $PIECE(YVOR,Y,83)=""  IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . . IF $PIECE(YVOR,Y,83)=""  IF YDDSATZ#2=0 WRITE " BGCOLOR="_YGRAY
	. . . IF $PIECE(YVOR,Y,83)'="" IF YDDSATZ#2=1 WRITE " class=""white"""  ;F]]><![CDATA[IS;CUSTOMER CSS STYLESHEET;08.12.04;26564
	. . . IF $PIECE(YVOR,Y,83)'="" IF YDDSATZ#2=0 WRITE " class=""gray"""  ;FIS;CUSTOMER CSS STYLESHEET;08.12.04;26564
	. . ;
	. . IF (YTYP=4)||(YTYP=8)||(YTYP=12)||(YTYP=18)||($GET(YTELE(YLFN))=1) WRITE " ALIGN=RIGHT"		//SR13074
	. . IF $FIND(YINHALT,"@") IF $PIECE(YINHALT," ",2)="" IF '$FIND(YINHALT,"@net") WRITE " ALIGN=RIGHT"   ;TYBD;14.05.2003; KEIN " " WENN @ NUR DANN MAIL
	. . WRITE " NOWRAP>"
	. . WRITE "<DIV>"
	. . ;
	. . IF $PIECE(YVOR,Y,7)'="" WRITE "<FONT SIZE="""_$PIECE(YVOR,Y,7)_""">"
	. . IF $PIECE(YSUCH1,Y,12)'="" IF $FIND(","_$TRANSLATE($PIECE(YSUCH1,Y,12),";",",")_",",","_YLFN_",") DO
	. . . SET YADDS(YLFN)=$$GetInternal^WWWTR(8,$TRANSLATE(YINHALT," "))+$GET(YADDS(YLFN))
	. . ;
	. . IF $ORDER(^WWW003(0,YDATEI,YLFN))="" IF $PIECE($GET(^WWW003(0,YDATEI,YLFN,1)),Y,3)=3 SET YINHALT=$PIECE(YFELD,Y,YLFN,9999)  ;TEXT
	. . DO  ;I YLFN<3 D      ;?IMMER LINK ERSTELLEN
	. . . IF $FIND(YINHALT,".htm")!($FIND(YINHALT,".HTM")) QUIT
	. . . WRITE "<A"
	. . . IF $PIECE(YSUCH1,Y,8)'=0 DO 
	. . . . IF $GET(YTOOLTIP)=""  WRITE " TITLE="""_$$^WWWTEXT(374)_""""   ;DATENSATZ AUSWÄHLEN ;data record pick out 
	. . . . IF $GET(YTOOLTIP)'="" WRITE " TITLE="""_YTOOLTIP_""""          ;DATENSATZ AUSWÄHLEN ;data record pick out 
	. . . ;
	. . . IF $GET(YBITSEARCH)=1 WRITE " TARGET="""_YTARGET_""""            ;FIS;BITSEARCH;23909;14.12.03
	. . . WRITE " HREF="""
	. . . ;
	. . . IF $GET(YWSAVE)'="" DO   ;AUTOMATISCHER SAVE;TYBD;20,10,2003;24142
	. . . . NEW YKEY,YFORM
	. . . . SET YFORM=$PIECE(YWSAVE,Y,1)
	. . . . SET YKEY =$PIECE(YWSAVE,Y,2)
	. . . . WRITE "JavaScript:" 
	. . . . WRITE "retval=EventValue('"_YUCI_"','"_YUSER_"','"_YFORM_"','FIX','Y"_YFORM_"','','9');"
	. . . . WRITE "window.location='"
	. . . . SET YCONF3="';"
	. . . ;
	. . . IF $PIECE(YSUCH1,Y,8)'=0 DO 
	. . . . WRITE YAKTION_"EP=WWWFORM&amp;YFORM="_YFORM
	. . . . IF $GET(YTIMEFORM)=1 WRITE "t"  ;zeitabhängige erfassungsformular
	. . . . WRITE "&amp;YSEITE="_YSEITE
	. . . . IF $GET(YBUTTON)'="" ;W "&YOPEN=OLD"
	. . . . DO ^WWWCGI
	. . . ;
	. . . IF $PIECE(YSUCH1,Y,8)=0 WRITE "#" 
	. . . IF $GET(YWSAVE)'="" WRITE "';"  ;ENDE 
	. . . WRITE """"
	. . . WRITE ">"
	. . ;
	. . IF $LENGTH(YINHALT)<30 IF YINHALT'="" IF $FIND(YINHALT,".htm")||$FIND(YINHALT,".HTM") DO
	. . . WRITE "<A HREF="""_YINHALT_""">"
	. . ;
	. . IF YINHALT="" SET datei(YANLZ)=0
	. . IF +$GET(datei(YANLZ))'=0 DO  ;ANZEIGE VON GIF UND DOKUMENTEN ;Show And 
	. . . SET YURL=""  ;$PIECE($GET(^WWW012(0,YM,1)),Y,44)  ;FIS;22903;15.04.03
	. . . SET OPT="HEIGHT=500,WIDTH=750,SCROLLBARS=YES,RESIZEABLE=YES"
	. . . IF '$FIND(YINHALT,"//") SET YINHALT=YGIF1_YINHALT
	. . . SET URL=YURL_YINHALT
	. . . WRITE YCR,"<INPUT TYPE=BUTTON NAME='B"_YKEY_"' onClick='var menue=window.open("""_URL_""",""DOK"","""_OPT_""");menue.focus();' VALUE='"
	. . ;
	. . ; SR15509 naked ref vvv
	. .;IF YLFN=1 IF YDATEI="WWW001" IF SPRACHE'="DE" IF $PIECE(YKEY,",",1)'="" IF $DATA(^WWW0011(0,$PIECE(YKEY,",",1),SPRACHE,1)) SET YINHALT=$PIECE(^(1),Y,1)
	. .;IF YLFN=1 IF YDATEI="WWW120" IF SPRACHE'="DE" IF $PIECE(YKEY,",",1)'="" IF $DATA(^WWW1201(0,$PIECE(YKEY,",",1),SPRACHE,1)) SET YINHALT=$PIECE(^(1),Y,1)
	. . IF YLFN=1 IF SPRACHE'="DE" IF $PIECE(YKEY,",",1)'="" do
	. . . IF YDATEI="WWW001" IF $DATA(^WWW0011(0,$PIECE(YKEY,",",1),SPRACHE,1)) SET YINHALT=$PIECE(^WWW0011(0,$PIECE(YKEY,",",1),SPRACHE,1),Y,1)
	. . . IF YDATEI="WWW120" IF $DATA(^WWW1201(0,$PIECE(YKEY,",",1),SPRACHE,1)) SET YINHALT=$PIECE(^WWW1201(0,$PIECE(YKEY,",",1),SPRACHE,1),Y,1)
	. . ;
	. . ;S YINHALT=$$^WWWFORMAT(YDATEI,"D",YLFN,YINHALT,0)  ;FORMAT DER DATEN  -> SIEHE OBEN
	. . NEW YCUT
	. . SET YCUT=40
	. . IF YSUCH3'="" IF +$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2)'=0 DO   ;LÄNGENBEGRENZUNG 
	. . . SET YCUT=+$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2)
	. . . SET YINHALT=$EXTRACT(YINHALT,1,+$PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,2))
	. . 
	. . ;IF YINHALT="" SET YINHALT="&nbsp;"
	. . IF $TRANSLATE(YINHALT," ")="" WRITE "&nbsp;"  ;TYBD;23,7,2004;WENN "  " Dann falsche anzeige
	. . IF +$GET(datei(YANLZ))'=0 SET YINHALT=$PIECE(YINHALT,"/",$LENGTH(YINHALT,"/"))
	. . ;
	. . WRITE $TRANSLATE($$^WWWUML($EXTRACT(YINHALT,1,YCUT)),"|")
	. . ;
	. . IF YSUCH3'="" DO  ;EXECUTE INNERHALB DER ANZEIGE ;EXECUTE inside the Show 
	. . . IF $PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,3)'="" DO
	. . . . XECUTE $PIECE($GET(^WWW1232(0,YFORM,YSUCH3,YLFN,1)),Y,3)
	. . ;
	. . IF +$GET(datei(YANLZ))'=0 DO
	. . . WRITE "'>"
	. . . ;IF "-GIF-JPEG-JPG-"[("-"_$PIECE($$^WWWUPER(YINHALT),".",2)_"_") SET URL=YINHALT DO THUMP
	. . . IF "-GIF-JPEG-JPG-"[("-"_$PIECE($zconvert(YINHALT,"U"),".",2)_"_") SET URL=YINHALT DO THUMP
	. . ;
	. . IF YINHALT'="" IF $FIND(YINHALT,".GIF")!($FIND(YINHALT,".gif")) SET URL=YINHALT DO THUMP
	. . IF YINHALT'="" IF YLFN=1!($FIND(YINHALT,".htm"))!($FIND(YINHALT,".HTM")) DO
	. . . WRITE "</A>"
	. . ;
	. . IF $EXTRACT(YINHALT)'="@" IF $FIND(YINHALT,"@") IF '$FIND(YINHALT," ") DO
	. . . WRITE "&nbsp;"
	. . . WRITE "<A HREF="""
	. . . WRITE "mailto:"
	. . . WRITE YINHALT
	. . . WRITE """"
	. . . WRITE ">"
	. . . WRITE YCR,"<IMG SRC="""_YGIF_"mail.gif"" ALIGN=TEXTTOP TITLE=""mail"" border=0 width=18 height=18>"
	. . . WRITE "</A>"
	. . ;
	. . IF $GET(TELYES)=1 IF $GET(YTELE(YLFN))=1 IF +YINHALT'=0 DO  ;TELEFON BUTTON;TYBD;6,12,2004
	. . . NEW FILE
	. . . WRITE "&nbsp;"
	. . . IF $EXTRACT(YINHALT)="0" SET YINHALT="+49 "_$EXTRACT(YINHALT,2,999)  ;DE
	. . . WRITE "<A HREF=""CALLTO://"_$TRANSLATE(YINHALT,"()-.#*_  &/!?")_""""
	. . . WRITE ">"
	. . . WRITE YCR,"<IMG SRC="""_YGIF_"verbind.gif"" ALIGN=TEXTTOP TITLE=""Telefon"" border=0 width=18 height=18>"
	. . . WRITE "</A>"
	. . ;
	. . ; vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	. . ;IF $GET(TELYES)=1 IF $GET(YTELE(YLFN))=1 IF +YINHALT'=0 DO  ;TELEFON BUTTON
	. . . NEW FILE
	. . . WRITE "&nbsp;"
	. . . SET FILE="ftp://"_$PIECE($GET(^WWW012(0,YM,1)),Y,46)
	. . . SET FILE=FILE_"T"_$EXTRACT(+$TRANSLATE(YINHALT,"()-.+#*_  &/!?"),$LENGTH(+$TRANSLATE(YINHALT,"()-.+#*_  &/!?"))-3,$LENGTH(+$TRANSLATE(YINHALT,"()-.+#*_  &/!?")))_".BAT"
	. . . WRITE "<A HREF="""_FILE_""""
	. . . WRITE $TRANSLATE(YINHALT,"()-.#*_  &/!?")_"')"
	. . . DO ^WWWTELE($TRANSLATE(YINHALT,"()-.#*_  &/!?"))
	. . . WRITE ">"
	. . . WRITE YCR,"<IMG SRC="""_YGIF_"verbind.gif"" ALIGN=TEXTTOP TITLE=""Telefon"" border=0 width=18 height=18>"
	. . . WRITE "</A>"
	. . ; ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	. . ;
	. . WRITE "</DIV>"
	. . WRITE "</TD>",YCR
	
	WRITE "</TR>",YCR
	QUIT
	
KEY ;FORMAT KEY  ACHTUNG EINSPRUNG zb aus ^WWWFORM4   (EINSPRUNG MIT YDATEI,YLFN,YINHALT)
	SET YINHALT =$$^WWWFORMAT(YDATEI,"P",YLFN,YINHALT,0)
	SET YINHALTK=$$^WWWFORMAT(YDATEI,"P",YLFN,YINHALT,2)
	QUIT
	
DATEN ;FORMAT DATEN  ACHTUNG EINSPRUNG VON AUSSEN  (YDATEI,LFN,YINHALT)
	SET YINHALT=$$^WWWFORMAT(YDATEI,"D",YLFN,YINHALT,0)
	QUIT
	
FORMAT ;
	QUIT:YINHALT=""
	SET YINHALT=$$GetLiteral^WWWTR(YTYP,YINHALT)
	;I YTYP=8!(YTYP=12) S YINHALT=$E("              ",1,(12-$L(YINHALT)))_YINHALT Q
	IF YTYP=8 IF $GET(YWHR)'="" SET YINHALT=YINHALT_" "_$$^WWWWHR(YWHR)   ;WÄHRUNG ANZEIGEN ;money standard display 
	IF YTYP=5 SET YINHALT=$EXTRACT("*****************",1,$LENGTH(YINHALT)) QUIT
	IF YTYP=3 SET YINHALT=$EXTRACT($PIECE(YINHALT,"|",1),1,200) SET:$EXTRACT(YINHALT,200)'="" YINHALT=YINHALT_"..." QUIT
	QUIT
	
THUMP ;BILD ;portrait 
	NEW YSATZ,YBBN,YQ,PATH
	
	QUIT:'$DATA(URL)
	QUIT:URL=""
	SET YQ=0
	QUIT:$FIND(URL,";")
	
	IF '$FIND(URL,"/")  DO
	. IF $GET(YFORM)'="" IF $GET(YLFN)'="" DO  QUIT:YQ=1   ;WENN ANDERES VERZEICHNIS ;when tabulation 
	. . SET YBBN=$ORDER(^WWW122s(0,4,YLFN,YFORM,""))
	. . IF YBBN'="" DO
	. . . SET YSATZ=$GET(^WWW122(0,YFORM,YBBN,1))
	. . . SET PATH=$PIECE(YSATZ,Y,57)
	. . . IF PATH="YGIF"  SET URL=YGIF_YINHALT  SET YQ=1 QUIT
	. . . IF PATH="YGIF1" SET URL=YGIF1_YINHALT SET YQ=1 QUIT
	. . . IF PATH'="" DO  QUIT
	. . . . IF $FIND(PATH,"##") DO
	. . . . . SET PATH=$PIECE(PATH,"##",1)_$PIECE($TRANSLATE($PIECE($GET(^WWW012(0,YM,1)),Y,1),"-,+#/\()[]")," ",1)_$PIECE(PATH,"##",2)
	. . . . ;
	. . . . SET URL=PATH_URL
	. . . . SET YQ=1
	. ;
	. ;I $E(YFORM,1,4)="INLP" S URL=YGIF_URL Q  ;TYBD;TEST LAGERPLATZ
	. SET:$EXTRACT(YFORM,1,3)'="WWW" URL=YGIF1_URL
	. SET:$EXTRACT(YFORM,1,3)="WWW" URL=YGIF_URL
	    
	IF '$FIND(URL,".GIF") IF '$FIND(URL,".gif") DO
	. WRITE "<A onClick='return doLink(this)' HREF='JavaScript:document.WWW.B"_YKEY_".click();'>"
	
	WRITE YCR,"<IMG SRC="""_$PIECE(URL," ",1)_""" BORDER=1 WIDTH="""_60_""" ALIGN=RIGHT TITLE="""_$PIECE(YINHALT,".",1)_""" border=0>"
	WRITE "</A>"
	QUIT
	
]]></Routine>
</Export>