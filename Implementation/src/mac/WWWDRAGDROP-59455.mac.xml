<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWDRAGDROP" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
#include COMSYS
	
WWWDRAGDROP(CHART,START,STOP)
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		DRAG AND DROP VON WINDOW KOMPONENTEN
	;
	; Inputs : 
	;	CHART		
	;	START		
	;	STOP		
	;
	; ByRef :
	;	YAUSWAHL
	;	YPRINTMODE
	;	YPARA
	;
	; Returns :
	;
	;
	; History :
	; 03-Jun-2010	GRF		SR17146: call "DD.MM.YYYY" wrapper for WWWDATE1
	; 04-Apr-2008	GM		SRBR014923: Changed $$^WWWTEXT() to $$$Text() for
	; 							language texts (53) and (54) 
	; 24-Aug-2006	GRF		Doco; quits
	; 30.06.2003	FIS
	;-------------------------------------------------------------------------------
	;ÜBERSICHT DRAG DROP ROUTIONEN ! ;summary 
	;WWWDRAGDROP(CHART,START,STOP)          DRAG AND DROP VON WINDOW KOMPONENTEN
	;WWWDRAGDROP1(POSITION,OBJEKT)          AUSFÜHREN OBJEKTVERSCHIEBUNG
	;WWWDRAGDROP2(YFUNCTION,OBJEKT)         AUSFÜHREN SPEICHER EVENT
	;WWWDRAGDROP3(YFUNCTION,OBJEKT)         AUSFÜHREN RECHTS CLICK EVENT
	;WWWDRAGDROP4()                         BEARBEITEN RETURNVALUE BEI DATENVERÄNDERUNG ;next to 
	;WWWDRAGDROP5(YFUNC,YKEY)               AKTUALISIEREN HISTOGRAMM
	;WWWDRAGDROP6                           AUSWAHLFENSTER DRAG AND DROP FORM ;shape 
	;WWWDRAGDROP7                           BUTTONLINE DRAG AND DROP FORMULAR ;form 
	;WWWDRAGDROP8(START,STOP,TERMIN,INOUT)	 KORRIGIEREN FEIERTAGE UND WOCHENENDE
	;WWWDRAGDROP9                           SETUPFENSTER
	;WWWDRAGDROP10                          DARSTELLEN DRAG AND DROP ELEMENTE ;impersonate 
	;WWWDRAGDROP11(YINNER,YELEMENT)         BEARBEITUNGSFENSTER
	;WWWDRAGDROP12(YINHALT,YVAR)            DRAG AND DROP VON SPEICHERN SZENARIEN
	;WWWDRAGDROP13(YINHALT,YVAR)            DRAG AND DROP VON LADEN SZENARIEN
	;WWWDRAGDROP14(YINHALT,YVAR)            DRAG AND DROP VON SPEICHERN VON SETUPEINSTELLUNGEN
	;WWWDRAGDROP15(YINHALT,YVAR)            DRAG AND DROP VON LÖSCHEN SETUPEINSTELLUNGEN
	;WWWDRAGDROP16(YINHALT,YVAR)            SZENARIO BEENDEN
	;WWWDRAGDROP17                          AUSWAHLFENSTER SZENARIO LADEN / SPEICHERN ;charge Save 
	;WWWDRAGDROP18                          AUSWAHLFENSTER FÜR ANZEIGEFILTER ;to 
	;WWWDRAGDROP19                          SHOW DIAGRAMM
	;WWWDRAGDROP20(YINHALT,YVAR)            DRAG AND DROP VON löschen seznario
	;WWWDRAGDROP21                          BLÄTTERFUNKTION
	;-------------------------------------------------------------------------------
	
	set YAUSWAHL   = $get(YAUSWAHL)
	set YPRINTMODE = $get(YPRINTMODE)
	if ($get(YPARA)'="") && $find(YPARA,"-") {
		if $get(START)="" set START = $piece(YPARA,"-",1)
		if $get(STOP)=""  set STOP  = $piece(YPARA,"-",2)
	}
	
	IF $GET(CHART)'="" KILL ^WWWDRAGDROPF(0,CHART,YBED)  ;LÖSCHEN FILTEREINSTELLUNGEN;FIS;25696;27.05.04
	IF $GET(YPRINTMODE)=1 DO CHART($GET(CHART),$GET(START),$GET(STOP)) QUIT  ;OHNE FRAME ! ;FIS;02.01.04 ;without 
	
	NEW FRAMESIZE,LFN
	SET FRAMESIZE=57
	;SET LFN=""
	;FOR  SET LFN=$ORDER(^WWW124(YM,CHART,SPRACHE,LFN)) QUIT:LFN=""  DO  QUIT:FRAMESIZE'=57
	;.IF $PIECE($GET(^WWW124(YM,CHART,SPRACHE,LFN,1)),Y,2)=1 SET FRAMESIZE=88  ;2. BUTTONZEILE
	
	SET LFN = ""
	FOR  SET LFN = $ORDER(^WWW124(0,CHART,SPRACHE,LFN)) QUIT:LFN=""  DO  QUIT:FRAMESIZE'=57
	. IF $PIECE($GET(^WWW124(0,CHART,SPRACHE,LFN,1)),Y,2)=1 SET FRAMESIZE=88  ;2. BUTTONZEILE   ;BEC;25866;07.06.04;DA ZENTRALE DATEI
	
	WRITE YCR,"<HTML>"
	WRITE YCR,"<TITLE>"_YKOPF_"</TITLE>"  ;INTRASTAT-MELDUNG
	WRITE YCR,"<frameset rows="_""""_FRAMESIZE_",*"_""""_" BORDER=0 FRAMEBORDER=0 FRAMESPACING=0>"
	WRITE YCR,"<frame SRC="_""""_YAKTION_"EP=WWWMANU&amp;YFORM="_YFORM_"&amp;YEXEC=DO|KOPF^WWWDRAGDROP('"_$GET(CHART)_"','"_$GET(START)_"','"_$GET(STOP)_"')&amp;YAUSWAHL="_YAUSWAHL
	DO ^WWWCGI
	WRITE """"_" NAME="_""""_"head"_""""_" SCROLLING=no noresize>"
	WRITE YCR,"<frame SRC="_""""_YAKTION_"EP=WWWMANU&amp;YFORM="_YFORM_"&amp;YEXEC=*DO|CHART^WWWDRAGDROP('"_$GET(CHART)_"','"_$GET(START)_"','"_$GET(STOP)_"')&amp;YAUSWAHL="_YAUSWAHL
	DO ^WWWCGI
	WRITE """"_" NAME="_""""_"chart"_""""_" SCROLLING=auto noresize>"
	WRITE YCR,"</frameset>"
	WRITE YCR,"</HTML>"
	QUIT
	
	
KOPF(CHART,START,STOP)
	NEW YHTMFORM,YNOEVENTKEY
	
	SET YKOPF = $PIECE($GET(^WWW120(0,YFORM,1)),Y,1)
	IF $DATA(^WWW1201(0,YFORM,SPRACHE,1)) SET YKOPF=$PIECE(^(1),Y,1)
	SET YHTMFORM="WWW"
	WRITE YCR,YCR,"<FORM NAME="_""""_$GET(YHTMFORM)_""""_">"
	SET YNOEVENTKEY=1
	DO ^WWWFORM8
	DO EVENT^WWWFORM  ;CSP HYPEREVENT
	DO ^WWWKOPF(YKOPF)
	DO ^WWWDRAGDROP7  ;BUTTONLINE
	WRITE YCR,"</FORM>"
	SET YNOFOOT=1
	WRITE YCR
	QUIT
	
	
CHART(CHART,START,STOP,PLUSMIN,VONBIS)
	;-------------------------------------------------------------------------------
	; Inputs : 
	;	CHART   = GANTT CHART (FORM)
	;	START   = AB DATUM ;take-off Confirm. Date 
	;	STOP    = BIS DATUM  -> Z.ZT. KEINE FUKTION !! ;until Date no 
	;	PLUSMIN = VOR / ZURÜCK IN ZEITSKALA ;pre- back within 
	;	VONBIS  = BLÄTTERFUNKTION (Z.B. ANZEIGE 1-10 VON 100) ;Show 
	;-------------------------------------------------------------------------------
	
	;+++++++++++++++++++++++++++++++++++++++
	;	YFELD		objWWWDRAGDROPD
	;	YVOR		objWWW012
	;+++++++++++++++++++++++++++++++++++++++
	
	NEW ROWS,COLUMNS,PIXEL,HEADLAENG,HEADSIZE,LENGTH,MON,WEEK,DAY,UHR,YTIMEFORM,CHART1,COLORDARK,COLORLIGHT,SORT
	NEW LINE,LEFTX,HISTSIZE,KEY,HEADER,ARBSTUNDEN,SIZE,FONTSIZE,TERMIN,DAUER,COLOR,DAUERX,LFN,YZA,YA,YZASIZE,DAUER2
	NEW BUTTONLINE,YZAMAX,STUNDE,KEY2,SKEY,ARBBEGINN,YNOEVENTKEY,LINEAL,YKOPF,SORT2,YSETUP,RICHT,YZAMAX,READONLY
	NEW ZNR,ZNSTART,ZNSTOP,NEULADEN,DATLFN,CAL,LINK
	
	;HOLEN WERTE ;send for 
	;-----------
	SET CHART=$GET(CHART)
	IF CHART="" SET CHART=$ORDER(^WWWDRAGDROP(0,""))
	SET CHART1=$$VORG(CHART)   ;VORGABEN CHART
	SET $PIECE(CHART1,Y,45)=1  ;IMMER IN NEUEM FENSTER ;constantly within window 
	SET PIXEL=+$PIECE(CHART1,Y,1)  ;FELDGRÖSSE IN PIXEL ;within 
	IF PIXEL=0 SET PIXEL=17
	
	;FELDER IM HEADER LAUT USER SETUP ;noisy 
	SET YSETUP=""
	SET YZA=0
	SET YZAMAX=0
	SET YNUM=""
	FOR  SET YNUM=$ORDER(^WWWDRAGDROPD(0,CHART,YNUM)) QUIT:YNUM=""  DO
	. SET YFELD = $GET(^WWWDRAGDROPD(0,CHART,YNUM,1))
	. DO
	. . IF $PIECE(YFELD,Y,20)=1 IF $DATA(^WWWDRAGDROPDU(0,CHART,YBED,1)) DO  QUIT
	. . . SET $PIECE(YSETUP,Y,YNUM)=$PIECE(^(1),Y,YNUM) 
	. . ;
	. . SET $PIECE(YSETUP,Y,YNUM)=$PIECE(YFELD,Y,5)
	. ;
	. IF $PIECE(YSETUP,Y,YNUM)=1 DO
	. . SET YZA=YZA+1  ;ANZAHL FELDER ;Number 
	. . IF +$PIECE(YFELD,Y,16)'>0 SET $PIECE(YFELD,Y,16)=4*PIXEL  ;DFLT.
	. . SET $PIECE(YFELD,Y,16)=($PIECE(YFELD,Y,16)\PIXEL)*PIXEL
	. . SET YZAMAX=YZAMAX+$PIECE(YFELD,Y,16)
	
	;ERMITTELN START UND STOP ;find take-off And 
	SET START = $GET(START)  ;STARTDATUM
	SET STOP  = $GET(STOP)  ;STOPDATUM
	IF START="" SET START = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YSTARTDATE",1))  ;AUS ZWISCHENDATEI ;out of 
	SET START=$PIECE(START,".",1)   ;WENN KALENDERWOCHE ;when calendar week 
	IF START="" SET START=+$HOROLOG
	IF +$PIECE(CHART1,Y,31)=0 SET $PIECE(CHART1,Y,31)=5
	IF +$GET(PLUSMIN)=1 DO  ;ZURÜCK ;retro-  ;back 
	. SET START = START-$PIECE(CHART1,Y,31)
	. SET STOP  = START+$PIECE(CHART1,Y,31)   ;ANZAHL TAGE AUS VORGABE ;Number out of default 
	
	IF +$GET(PLUSMIN)=2 DO  ;VOR ;pre- 
	. SET START = START+$PIECE(CHART1,Y,31)
	. SET STOP  = START+$PIECE(CHART1,Y,31)   ;ANZAHL TAGE AUS VORGABE ;Number out of default 
	
	IF STOP="" SET STOP = START+$PIECE(CHART1,Y,31)   ;ANZAHL TAGE AUS VORGABE ;Number out of default 
	SET CAL=$PIECE(CHART1,Y,36)  ;KALENDERVORGABE
	IF CAL="" SET CAL=$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,54)  ;DFLT. KALENDER BETRIEB ;calendar location 
	IF $PIECE(CHART1,Y,37)=1 IF +$PIECE(CHART1,Y,5)=1 DO  ;NUR ARBEITSTAGE ANZEIGEN ;only display 
	. IF +$GET(PLUSMIN)'=0 FOR  QUIT:$$^WWWCALDAY(START,CAL)=0  SET START=START-1
	. IF +$GET(PLUSMIN)=0  FOR  QUIT:$$^WWWCALDAY(START,CAL)=0  SET START=START+1
	
	IF ($PIECE(CHART1,Y,21)="") || ($PIECE(CHART1,Y,22)="") WRITE $$^WWWTEXT(46) QUIT  ; "No Data Available" 
	;SET YKOPF=$PIECE($GET(^WWW120(YM,YFORM,1)),Y,1)  ;FORMULARNAME
	SET YKOPF=$PIECE($GET(^WWW120(0,YFORM,1)),Y,1)  ;FORMULARNAME    ;BEC;25866;07.06.04;DA ZENTRALE DATEI
	IF $DATA(^WWW1201(0,YFORM,SPRACHE,1)) SET YKOPF=$PIECE(^(1),Y,1)
	SET READONLY=+$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YREADONLY",1))  ;DATEN NUR ANZEIGEN ;only display 
	SET NORELOAD=+$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YNORELOAD",1))  ;DATEN NICHT NEU AUFBEREITEN ;Not recent 
	IF $GET(YPRINTMODE)=1 SET READONLY=1,NORELOAD=1
	
	;BLÄTTERFUNKTION
	SET ZNSTART=1
	IF $GET(VONBIS)'="" IF $PIECE(CHART1,Y,60)=1 DO
	. IF $PIECE(CHART1,Y,61)=1 SET NORELOAD=1  ;DATEN NICHT NEU LADEN ;Not recent charge 
	. SET ZNSTART=+$EXTRACT(VONBIS,4,99)
	. IF $EXTRACT(VONBIS,1,3)="PLU" SET ZNSTART=(ZNSTART+(5*$PIECE(CHART1,Y,58)))
	. IF $EXTRACT(VONBIS,1,3)="MIN" SET ZNSTART=(ZNSTART-(5*$PIECE(CHART1,Y,58)))
	. IF $EXTRACT(VONBIS,1,3)="OLD" SET ZNSTART=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","ZNSTART",1))
	. IF ZNSTART<1 SET ZNSTART=1
	
	SET ZNSTOP=ZNSTART+$PIECE(CHART1,Y,58)-1
	
	;ANZEIGEWERTE
	SET ROWS      = 0  ;ANZAHL ZEILEN ;Number 
	SET COLUMNS   = 0  ;ANZAHL SPALTEN ;Number split 
	SET HEADLAENG = 0
	IF YZAMAX'=0 SET HEADLAENG=$JUSTIFY(YZAMAX/PIXEL,0,0)
	SET HEADSIZE  = 0
	SET MON       =+$PIECE(CHART1,Y,3)
	SET WEK       =+$PIECE(CHART1,Y,4)
	SET DAY       =+$PIECE(CHART1,Y,5)
	SET UHR       =+$PIECE(CHART1,Y,6)
	SET HISTSIZE  =+$PIECE(CHART1,Y,23)
	SET HISTCOLOR = $PIECE(CHART1,Y,25)
	IF HISTCOLOR'="" SET HISTCOLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,HISTCOLOR,1)),Y,1)
	IF HISTCOLOR=""  SET HISTCOLOR="blue"
	SET FONTSIZE=+$PIECE(CHART1,Y,32)  ;SCHRIFTGRÖßE IN PIXEL ;within 
	IF FONTSIZE=0 SET FONTSIZE=8
	SET BUTTONLINE=0  ;ZEILE ÜBER TABELLE ;via tabulation 
	IF $PIECE(CHART1,Y,60)=1 IF $GET(YPRINTMODE)'=1 SET BUTTONLINE=(((FONTSIZE+2)*4)+5)  ;PLATZ FÜR BLÄTTERFUNKTION ;square to 
	SET YAUSWAHL=$GET(YAUSWAHL)
	SET YHTMFORM="WWW"
	SET COLORDARK=$PIECE($GET(^WWW012(0,YM,1)),Y,15)
	IF COLORDARK'=""                           SET COLORDARK=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLORDARK,1)),Y,1)
	IF (COLORDARK="")!($PIECE(CHART1,Y,7)'=1)  SET COLORDARK="black"
	SET COLORLIGHT=$PIECE($GET(^WWW012(0,YM,1)),Y,14)
	IF COLORLIGHT'=""                          SET COLORLIGHT=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLORLIGHT,1)),Y,1)
	IF (COLORLIGHT="")!($PIECE(CHART1,Y,7)'=1) SET COLORLIGHT="black"
	
	DO  ;VORAUSWAHL UND SORTIERUNG ;And sorting 
	. NEW SORTFELD
	. SET SORTFELD=$PIECE(CHART1,Y,40)  ;FELD FÜR SORTIERUNG ;field to sorting 
	. IF $EXTRACT(YAUSWAHL)="*" DO
	. . IF $EXTRACT(YAUSWAHL,2,99)="" DO  QUIT
	. . . KILL ^WWWDRAGDROPF(0,CHART,YBED)  ;LÖSCHEN FILTEREINSTELLUNGEN ;Delete 
	. . . SET YAUSWAHL=""
	. . ;
	. . SET SORTFELD=$PIECE(YAUSWAHL,"*",2)
	. . SET YAUSWAHL=$PIECE(YAUSWAHL,"*",3,99)
	. ;
	. IF SORTFELD="" DO
	. . NEW YNUM
	. . SET YNUM=""
	. . FOR  SET YNUM=$ORDER(^WWWDRAGDROPD(0,CHART,YNUM)) QUIT:YNUM=""  DO  QUIT:SORTFELD'=""
	. . . IF $PIECE($GET(^WWWDRAGDROPD(0,CHART,YNUM,1)),Y,12)=1 SET SORTFELD=YNUM
	. ;
	. IF +SORTFELD=0 SET SORTFELD=1
	. SET $PIECE(CHART1,Y,40)=SORTFELD
	. ;SET $PIECE(^WWWDRAGDROP(0,CHART,1),Y,40)=SORTFELD  ;SPEICHERN SORTIERFELD
	. IF $DATA(^WWWDRAGDROPU(0,CHART,YBED,1)) SET $PIECE(^(1),Y,40)=SORTFELD QUIT  ;ÜBERTRAGEN IN USERDATEI ;transport within 
	. NEW FELDER,LFN,SATZ
	. SET FELDER=$TRANSLATE($PIECE(CHART1,Y,47),",",";")
	. SET SATZ=""
	. FOR LFN=1:1 QUIT:$PIECE(FELDER,";",LFN,99)=""  DO
	. . SET $PIECE(SATZ,Y,$PIECE(FELDER,";",LFN))=$PIECE(CHART1,Y,$PIECE(FELDER,";",LFN))
	. ;
	. IF SATZ'="" SET ^WWWDRAGDROPU(0,CHART,YBED,1)=SATZ  ;NEUAUFBAU USERDATEI
	
	;LÖSCHEN ALTE DATEN UND SPEICHERN NEUE WERTE ;Delete And Save 
	;-------------------------------------------
	IF NORELOAD'=1 KILL ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V")
	KILL ^WWWSOR(YUSER)
	SET ^WWWSOR(YUSER,"START")=START
	SET ^WWWSOR(YUSER,"STOP")=STOP
	SET ^WWWSOR(YUSER,"AUSWAHL")=$GET(YAUSWAHL)
	SET ^WWWSOR(YUSER,"CHART")=$GET(CHART)
	IF $PIECE(CHART1,Y,37)=1 IF +$PIECE(CHART1,Y,5)=1 DO
	. FOR YI=START:1:STOP IF $$^WWWCALDAY(YI,CAL)'=0 SET ^WWWSOR(YUSER,"FEIERTAG",YI,1)=""
	. MERGE ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","FEIERTAG")=^WWWSOR(YUSER,"FEIERTAG")
	
	;STARTEN HTML-SEITE ;launching 
	;------------------
	WRITE YCR,"<html>"
	WRITE YCR,"<head>"
	WRITE YCR,"<title>"_$GET(YKOPF)_"</title>"
	WRITE YCR,"<style type='text/css'>"
	WRITE YCR,"<!--"
	WRITE YCR,"  body, td, th {font-family:'Arial','SansSerif';}"
	WRITE YCR,"  a {text-decoration:none}"
	WRITE YCR,"  a:hover{color:blue; text-decoration:underline;}"
	WRITE YCR,"  a:active {color:blue}"
	WRITE YCR,"//-->"
	WRITE YCR,"</style>"
	WRITE YCR,"</head>"
	WRITE YCR,"<body bgcolor="_YSILVER_" texttop=0 topmargin=0 leftmargin=0 rightmargin=0"
	
	NEW YVOR
	SET YVOR=$GET(^WWW012(0,YM,1))
	IF $PIECE(YVOR,Y,12)'=""  DO
	. WRITE YCR," TEXT="_""""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE(YVOR,Y,12),1)),Y,1)_""""
	. WRITE YCR," LINK="_""""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE(YVOR,Y,12),1)),Y,1)_""""
	. WRITE YCR," ALINK="_""""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE(YVOR,Y,12),1)),Y,1)_""""
	. WRITE YCR," VLINK="_""""_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,$PIECE(YVOR,Y,12),1)),Y,1)_""""
	
	WRITE YCR," onload="_""""
	IF $GET(YPRINTMODE)=1  WRITE YCR,"document.getElementById('loadinfo').style.visibility='hidden'; window.print();"
	IF $GET(YPRINTMODE)'=1 WRITE YCR,"draginit();"
	WRITE """"_">"
	
	;JAVA-SCRIPT
	;-----------
	DO ^WWWDRAGDROPJ
	
	;STARTEN ANZEIGE ;launching Show 
	;---------------
	WRITE YCR,"<DIV"
	WRITE " style="_""""
	WRITE " position:absolute;"
	WRITE " height:100%;"
	WRITE " width:100%;"
	WRITE " background-color:"_YSILVER_";"
	WRITE " border:none;"
	WRITE """"
	WRITE ">"
	WRITE "<FORM NAME="_""""_YHTMFORM_""""_">"
	
	;LADE FENSTER ;loading window 
	WRITE YCR,"<DIV id="_""""_"loadinfo"_""""
	WRITE YCR," style="_""""
	WRITE " position:absolute;"
	WRITE " border:2px solid;"
	WRITE " border-Bottom-Color:"_COLORLIGHT_";"
	WRITE " border-Right-Color:"_COLORLIGHT_";"
	WRITE " border-Top-Color:"_COLORDARK_";"
	WRITE " border-Left-Color:"_COLORDARK_";"
	WRITE " background-color:"_YSILVER_";"
	WRITE " top:200;"
	WRITE " left:300;"
	WRITE " width:250;"
	WRITE " height:65;"
	WRITE " overflow:visible;"
	WRITE " font-family:arial; font-size:12px; font-weight:bold;"
	WRITE " text-align:center;"
	WRITE " white-space:nowrap;"
	WRITE " color:"_YRED_";"
	WRITE " padding:5;"
	WRITE " z-index:10000;"
	WRITE """"
	WRITE YCR," onClick="_""""_"this.style.visibility='hidden';"_""""
	WRITE ">"
	WRITE YCR,"<fieldset style="_""""_"height:100%; width:100%;"_""""_">"
	WRITE "<br>&nbsp;"
	WRITE $$^WWWTEXT(33582)  ;"DATEN WERDEN GELADEN"
	WRITE "&nbsp;"
	WRITE YCR,"</fieldset>"
	WRITE YCR,"</DIV>"
	$$$StartScript()
	;WRITE YCR,"<script type="_""""_"text/javascript"_""""_">"
	;WRITE YCR,"<!--"
	WRITE YCR," loadinfo();"     ;div positionieren
	;WRITE YCR,"//-->"
	;WRITE YCR,"</script>"
	$$$EndScript()
	
	;DATEN AUFBEREITEN
	;-----------------
	IF NORELOAD'=1 DO  ;NUR WENN NEUER START UND NICHT SIMULATION ;only when take-off And Not simulation 
	. NEW YAUSWAHL,YPARA,VORG
	. IF $PIECE(CHART1,Y,10)'="" XECUTE $PIECE(CHART1,Y,10)  ;EXECUTE ZUR DATENAUFBEREITUNG ;EXECUTE data preparation 
	
	;DATEN VORSORTIERUNG UND ANZAHL ZEILEN ERMITTELN ;And Number find 
	;-----------------------------------------------
	DO
	. NEW SORTFELD,SORT,SORTAUSW,KEY2,SORT2,YFILTER,SATZ2
	. SET SORTFELD=$PIECE(CHART1,Y,40)  ;FELD FÜR SORTIERUNG ;field to sorting 
	. QUIT:+SORTFELD=0
	. SET CHARTD1=$GET(^WWWDRAGDROPD(0,CHART,SORTFELD,1))
	. SET SORTAUSW=+$PIECE(CHARTD1,Y,13)        ;AUSWAHL NUR WENN DATEN ;Selection only when 
	. IF $PIECE(CHARTD1,Y,9)="" SET SORTAUSW=1  ;KEINE RELATIONSDATEI=NUR VORHANDENE DATEN ;no 
	. SET LINEAL=+$PIECE(CHARTD1,Y,18)          ;ANZEIGE SUMMENBALKEN ;Show 
	. ;
	. ;IF NORELOAD=1 DO  QUIT  ;RÜCKHOLEN ALTE DATEN
	. . SET SORT=""
	. . FOR  SET SORT=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT)) QUIT:SORT=""  DO
	. . . SET SORT2=""
	. . . FOR  SET SORT2=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT,SORT2)) QUIT:SORT2=""  DO
	. . . . SET KEY=""
	. . . . FOR  SET KEY=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT,SORT2,KEY)) QUIT:KEY=""  DO
	. . . . . SET SATZ2=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",KEY,1))  ;BEARBEITETER SATZ ;typesetting 
	. . . . . IF SATZ2="" SET SATZ2=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT,SORT2,KEY,1))  ;UNBEARBEITET
	. . . . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT,SORT2,KEY,1)=SATZ2
	. . . . . SET ROWS=ROWS+1  ;ZEILEN ZÄHLEN
	. . . . . SET KEY2=""
	. . . . . FOR  SET KEY2=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENn",KEY,KEY2)) QUIT:KEY2=""  DO
	. . . . . . SET SATZ2=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",KEY_"%s%"_KEY2,1))  ;BEARBEITETER SATZ ;typesetting 
	. . . . . . IF SATZ2="" SET SATZ2=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENn",KEY,KEY2,1))  ;UNBEARBEITET
	. . . . . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENn",KEY,KEY2,1)=SATZ2
	. . ;
	. . SET DATLFN(1) = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATLFN1",1))
	. . SET DATLFN(2) = $GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATLFN2",1))
	. . IF $PIECE(CHART1,Y,61)=1 DO  ;RÜCKHOLEN DIAGRAMMLINIE
	. . . SET ^WWWSOR(YUSER,"DATA1",1)=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATA1",1))
	. . . SET ^WWWSOR(YUSER,"DATA1KEY",1)=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATA1KEY",1))
	. ;
	. SET KEY2 = ""
	. SET KEY  = ""
	. FOR  SET KEY = $ORDER(^WWWSOR(YUSER,"DATEN",KEY)) QUIT:KEY=""  DO
	. . SET SATZ = $GET(^WWWSOR(YUSER,"DATEN",KEY,1))  ;WENN OHNE MEHRFACHKEY ;when without 
	. . IF SATZ'="" SET KEY2 = KEY
	. . DO:KEY2=KEY  IF KEY2="" FOR  SET KEY2=$ORDER(^WWWSOR(YUSER,"DATEN",KEY,KEY2))  QUIT:KEY2=""  SET SATZ="" DO
	. . . IF SATZ="" SET SATZ=^WWWSOR(YUSER,"DATEN",KEY,KEY2,1)
	. . . IF $PIECE(SATZ,Y,$PIECE(CHART1,Y,21))="" QUIT  ;START FERTIGUNGSTERMIN ;take-off 
	. . . IF $PIECE(SATZ,Y,$PIECE(CHART1,Y,22))="" QUIT  ;DAUER ;permanence within 
	. . . SET SORT=$PIECE(SATZ,Y,SORTFELD)
	. . . IF SORT="" SET SORT=" "
	. . . IF $PIECE(CHART1,Y,38)=1 IF SORTAUSW=1 DO  ;AUFBAU GRUPPEN MIT DATEN ;by means of 
	. . . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","AUSWAHL",SORT,1)=""
	. . . ;
	. . . IF $PIECE(CHARTD1,Y,19)'="" DO  ;EXECUTE VOR ANZEIGE FELDINHALT ;EXECUTE pre- Show 
	. . . . NEW YEXEC,YINHALT
	. . . . SET YINHALT=SORT
	. . . . SET YEXEC=$PIECE(CHARTD1,Y,19)
	. . . . DO
	. . . . . NEW (YEXEC,YINHALT,SPRACHE,LANGUAGE,Y,YUCI,YM,YBED,YUSER,YFORM,YDATEI,YLOCATION)
	. . . . . XECUTE YEXEC
	. . . . ;
	. . . . SET SORT=YINHALT
	. . . ;
	. . . SET DATLFN(1)=+$GET(DATLFN(1))+1  ;DATENSÄTZE GESAMT ;total
	. . . IF $GET(YAUSWAHL)'="" QUIT:'$FIND(";"_YAUSWAHL_";",";"_SORT_";")  ;NICHT ALLE ANZEIGEN
	. . . SET YFILTER=0  ;KEIN FILTER ;no strainer 
	. . . IF $DATA(^WWWDRAGDROPF(0,CHART,YBED)) DO  QUIT:YFILTER=1
	. . . . NEW YNUM,YSUCH,YFILTER1,YWERT
	. . . . SET YNUM=""
	. . . . FOR  SET YNUM=$ORDER(^WWWDRAGDROPF(0,CHART,YBED,YNUM)) QUIT:YNUM=""  DO  QUIT:YFILTER=1
	. . . . . SET YSUCH=$PIECE($GET(^WWWDRAGDROPF(0,CHART,YBED,YNUM,1)),Y,1)
	. . . . . IF YSUCH="" QUIT  ;KEINE DATEN ;no 
	. . . . . SET YWERT=$PIECE(SATZ,Y,YNUM)
	. . . . . IF YWERT="" SET YWERT=" "
	. . . . . IF $FIND(";"_YSUCH_";",";"_YWERT_";") QUIT
	. . . . . SET YFILTER=1  ;KEINE ANZEIGE ;no Show 
	. . . . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENx",KEY,1)=SATZ  ;GEFILTERTE DATEN
	. . . ;
	. . . SET SORT2=""  ;VORSORTIERUNG
	. . . IF $PIECE(CHARTD1,Y,21)=1 IF $PIECE(CHART1,Y,46)'="" SET SORT2=$PIECE(SATZ,Y,$PIECE(CHART1,Y,46))
	. . . IF SORT2="" SET SORT2=" "
	. . . IF (KEY=KEY2)!(KEY2=0)  SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT2,SORT,KEY,1)=SATZ  ;HAUPTSATZ
	. . . IF KEY'=KEY2 IF KEY2'=0 SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENn",KEY,KEY2,1)=SATZ  ;SPLITTING
	. . . SET DATLFN(2)=+$GET(DATLFN(2))+1  ;ANGEZEIGTE DATENSÄTZE
	. . . ;
	. . . IF +$PIECE(CHART1,Y,58)'=0 QUIT:ROWS'<$PIECE(CHART1,Y,58)
	. . . SET ROWS=ROWS+1  ;ZEILEN ZÄHLEN
	. ;
	. IF $PIECE(CHART1,Y,38)=1 IF SORTAUSW'=1 DO  ;AUFBAU ALLER GRUPPEN ;everyone 
	. . NEW YFELD,YDATEI,YDATEI1,RELK,RELF,YI,LFN
	. . QUIT:$PIECE(CHART1,Y,40)=""
	. . SET YFELD=$GET(^WWWDRAGDROPD(0,CHART,$PIECE(CHART1,Y,40),1))  ;SORTIER-DATENFELD
	. . IF $PIECE(YFELD,Y,9)'="" DO  ;RELATIONSDATEI VORHANDEN ;on hand 
	. . . SET YDATEI=$PIECE(YFELD,Y,9)
	. . . SET RELK=$PIECE(YFELD,Y,10)  ;RELATIONS PRIMÄRSCHLÜSSEL
	. . . IF RELK'="" FOR YI=1:1  QUIT:$PIECE(RELK,",",YI)=""  IF '$FIND($PIECE(RELK,",",YI),"""") SET $PIECE(RELK,",",YI)=""""_@$PIECE(RELK,",",YI)_""""
	. . . SET RELF=+$PIECE(YFELD,Y,11)  ;ANZEIGE FELD ;Show field 
	. . . IF RELF=0 SET RELF=1
	. . . SET YDATEI1="^"_YDATEI_"("_""""_$$^WWWYM(YDATEI)_""""
	. . . IF RELK'="" FOR YI=1:1  QUIT:$PIECE(RELK,",",YI)=""  SET YDATEI1=YDATEI1_","_""""_$TRANSLATE($PIECE(RELK,",",YI),"""")_""""
	. . . SET YDATEI1=YDATEI1_",LFN)"
	. . . SET LFN=""
	. . . FOR  SET LFN=$ORDER(@YDATEI1) QUIT:LFN=""  DO
	. . . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","AUSWAHL",LFN,1)=""
	. . . ;
	. . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","AUSWAHL"," ",1)=""  ;OHNE ;without 
	
	IF +ROWS=0 DO  ;IF +ROWS<10 DO  //KEINE DATEN VORHANDEN;FIS;19.07.04;26118
	. NEW YI,SORT
	. SET SORT=$CHAR(255)
	. IF $PIECE(CHART1,Y,40)'="" IF $PIECE($GET(^WWWDRAGDROPD(0,CHART,$PIECE(CHART1,Y,40),1)),Y,22)=1 SET SORT=" "
	. FOR YI=ROWS:1:10 SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT,SORT,YI,1)=""
	
	DO SCRIPT^WWWTOOLTIP
	IF $PIECE(CHART1,Y,60)=1 IF $GET(YPRINTMODE)'=1 DO ^WWWDRAGDROP21  ;BLÄTTERFUNKTION
	
	;AUFBAU TABELLEN-STRUKTUR
	;---------------------------------------------------------------------------
	WRITE YCR,"<table border=0 cellspacing=0 cellpadding=0"
	DO FARBE^WWWTAB
	WRITE ">"
	DO TIMESCALE  ;HEADER
	DO GRID       ;TABLE
	IF $PIECE(CHART1,Y,24)=1 IF HISTSIZE>0 DO HISTOGRAMM  ;HISTOGRAMM
	WRITE YCR,"</table>"
	
	;EINFÜGEN DATEN/ELEMENTE ;interpolate 
	;---------------------------------------------------------------------------
	WRITE "<input type="_""""_"hidden"_""""_" name="_""""_"OPENELEM"_""""_" value="_""""_""""_">"  ;OFFENES ELEMENT MERKEN ;medium 
	WRITE "<input type="_""""_"hidden"_""""_" name="_""""_"YAUSWAHL"_""""_" value="_""""_$GET(YAUSWAHL)_""""_">"  ;EINGESCHRÄNKTER DATENSATZ ;data record 
	IF $GET(ARBSTUNDEN)<1 SET ARBSTUNDEN=8
	SET LINE=HEADSIZE
	SET KEY2=""
	SET RICHT=1
	SET ZNR=0
	IF $PIECE(CHART1,Y,40)'="" IF $PIECE($GET(^WWWDRAGDROPD(0,CHART,$PIECE(CHART1,Y,40),1)),Y,22)=1 SET RICHT=-1
	SET SORT2=""
	FOR  SET SORT2=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT2),RICHT) QUIT:SORT2=""  DO
	. SET SORT=""
	. FOR  SET SORT=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT2,SORT),RICHT) QUIT:SORT=""  DO
	. . SET KEY=""
	. . FOR  SET KEY=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT2,SORT,KEY)) QUIT:KEY=""  DO
	. . . SET SATZ=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT2,SORT,KEY,1))
	. . . SET ZNR=ZNR+1
	. . . IF ZNSTART>ZNR QUIT
	. . . IF ZNSTOP<ZNR  QUIT
	. . . ;
	. . . DO ^WWWDRAGDROP10  ;HAUPTSATZ
	. . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",KEY,1)=SATZ  ;NACHHER ;afterward 
	. . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",KEY,2)=SATZ  ;VORHER ;pre- 
	. . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","X-REF",KEY,1)=(LINE-HEADSIZE)_"X"_((TERMIN*TIMESIZE)+STUNDE)_"X"_(DAUER-1)  ;ZEILE X SPLATE X LAENGE ;X X 
	. . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","X-REF",KEY,2)=(LINE-HEADSIZE)_"X"_((TERMIN*TIMESIZE)+STUNDE)_"X"_(DAUER-1)  ;ZEILE X SPLATE X LAENGE ;X X 
	. . . IF LINEAL=1 SET ^WWWSOR(YUSER,"LINEAL","WERTE",(LINE-HEADSIZE),1)=((TERMIN*TIMESIZE)+STUNDE)_"X"_(((TERMIN*TIMESIZE)+STUNDE)+(DAUER-1))_Y_KEY
	. . . DO
	. . . . IF +$PIECE(CHART1,Y,54)'=0 IF $PIECE(SATZ,Y,$PIECE(CHART1,Y,54))=1 QUIT
	. . . . IF +$PIECE(CHART1,Y,64)'=0 DO  QUIT  ;DATENFELD FÜR SUMMENBILDUNG ;data item to 
	. . . . . FOR LREF=((TERMIN*TIMESIZE)+STUNDE):1:(((TERMIN*TIMESIZE)+STUNDE)+DAUER-1) SET ^WWWSOR(YUSER,"Y-REF",LREF)=$GET(^WWWSOR(YUSER,"Y-REF",LREF))+$PIECE(SATZ,Y,$PIECE(CHART1,Y,64))  ;HISTOGRAMM SUMMEN ;purr 
	. . . . ;
	. . . . FOR LREF=((TERMIN*TIMESIZE)+STUNDE):1:(((TERMIN*TIMESIZE)+STUNDE)+DAUER-1) SET ^WWWSOR(YUSER,"Y-REF",LREF)=$GET(^WWWSOR(YUSER,"Y-REF",LREF))+1  ;HISTOGRAMM SUMMEN ;purr 
	. . . ;
	. . . ;SPLITTING
	. . . IF $DATA(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENn",KEY)) DO
	. . . . NEW SATZ,KEY2
	. . . . SET KEY2=""
	. . . . FOR  SET KEY2=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENn",KEY,KEY2))  QUIT:KEY2=""  DO
	. . . . . SET SATZ=$GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENn",KEY,KEY2,1))
	. . . . . QUIT:SATZ=""
	. . . . . DO ^WWWDRAGDROP10  ;SPLITTING
	. . . . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",KEY_"%s%"_KEY2,1)=SATZ  ;NACHHER ;afterward 
	. . . . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATEN",KEY_"%s%"_KEY2,2)=SATZ  ;VORHER ;pre- 
	. . . . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","X-REF",KEY_"%s%"_KEY2,1)=(LINE-HEADSIZE)_"X"_((TERMIN*TIMESIZE)+STUNDE)_"X"_(DAUER-1)  ;ZEILE X SPLATE X LAENGE ;X X 
	. . . . . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","X-REF",KEY_"%s%"_KEY2,2)=(LINE-HEADSIZE)_"X"_((TERMIN*TIMESIZE)+STUNDE)_"X"_(DAUER-1)  ;ZEILE X SPLATE X LAENGE ;X X 
	. . . . . IF LINEAL=1 SET ^WWWSOR(YUSER,"LINEAL","WERTE",(LINE-HEADSIZE+(KEY2/1000)),1)=((TERMIN*TIMESIZE)+STUNDE)_"X"_(((TERMIN*TIMESIZE)+STUNDE)+(DAUER-1))_Y_KEY_"%s%"_KEY2
	. . . . . DO
	. . . . . . IF +$PIECE(CHART1,Y,54)'=0 IF $PIECE(SATZ,Y,$PIECE(CHART1,Y,54))=1 QUIT
	. . . . . . IF +$PIECE(CHART1,Y,64)'=0 DO  QUIT  ;DATENFELD FÜR SUMMENBILDUNG ;data item to 
	. . . . . . . FOR LREF=((TERMIN*TIMESIZE)+STUNDE):1:(((TERMIN*TIMESIZE)+STUNDE)+DAUER-1) SET ^WWWSOR(YUSER,"Y-REF",LREF)=$GET(^WWWSOR(YUSER,"Y-REF",LREF))+$PIECE(SATZ,Y,$PIECE(CHART1,Y,64))  ;HISTOGRAMM SUMMEN ;purr 
	. . . . . . ;
	. . . . . . FOR LREF=((TERMIN*TIMESIZE)+STUNDE):1:(((TERMIN*TIMESIZE)+STUNDE)+DAUER-1) SET ^WWWSOR(YUSER,"Y-REF",LREF)=$GET(^WWWSOR(YUSER,"Y-REF",LREF))+1  ;HISTOGRAMM SUMMEN
	. . . ;
	. . . SET LINE=LINE+1
	
	;KEINE DATEN ZUR ANZEIGE ;no Show 
	IF '$DATA(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs"))!(ROWS=0) IF HEADLAENG>0 DO
	. WRITE YCR,"<DIV id="_""""_"desc"_"edit"_0_""""  ;edit muss bleiben ! ;stay over 
	. WRITE " style="_""""
	. WRITE " position:absolute;"
	. ;WRITE " top:"_(((LINE-1)*PIXEL)+BUTTONLINE)_";"
	. WRITE " top:"_(((LINE-11)*PIXEL)+BUTTONLINE)_";"  ;FIS;19.07.04;26118
	. WRITE " left:"_1_";"
	. WRITE " height:"_PIXEL_";"
	. WRITE " width:"_((HEADLAENG*PIXEL)-1)_";"
	. WRITE " text-align:left;"
	. WRITE " font:9pt arial;"
	. WRITE " white-space:nowrap;"
	. WRITE " z-index:10;"
	. WRITE """"
	. WRITE ">"
	. WRITE YCR,"<TABLE style="_""""_"table-layout:fixed;"_""""_" BORDER=0 CELLSPACING=0 CELLPADDING=0><TR>"
	. WRITE YCR,"<TD nowrap"
	. WRITE " style="_""""
	. WRITE " text-align:left;"
	. WRITE " vertical-align:bottom;"
	. WRITE " font-family:arial;"
	. WRITE " font-size:"_FONTSIZE_"pt;"
	. WRITE " border-right:1px solid "_COLORLIGHT_";"
	. WRITE " border-left:1px solid "_COLORDARK_";"
	. WRITE " width:"_((HEADLAENG*PIXEL)-1)_";"
	. WRITE " height:"_(PIXEL-2)_";"
	. WRITE " z-index:10;"
	. WRITE " overflow:hidden;"
	. WRITE " white-space:nowrap;"
	. WRITE """"_">"
	. WRITE "&nbsp;"
	. WRITE "<font color="_YRED_"><B>"
	. WRITE $$^WWWTEXT(46)  ;KEINE DATEN ;no 
	. WRITE "</B></FONT>"
	. WRITE YCR,"</TD>"
	. WRITE YCR,"</TR>"
	. WRITE YCR,"</TABLE>"
	. WRITE YCR,"</DIV>"
	
	;LINEAL/SUMMENBALKEN EINFÜGEN ;interpolate 
	;----------------------------
	IF LINEAL=1 DO
	. NEW LINROW,ELEM,LEFT,RIGHT,LENGTH,ZEILE,LASTRIGHT,COLOR,LENGL,LENGR,KEYS
	. SET LASTRIGHT=0
	. SET LINROW=""
	. FOR  SET LINROW=$ORDER(^WWWSOR(YUSER,"LINEAL","ZEILE",LINROW)) QUIT:LINROW=""  DO
	. . SET ZEILE(1)=LINROW  ;VON ZEILE
	. . SET ZEILE(2)=$ORDER(^WWWSOR(YUSER,"LINEAL","ZEILE",ZEILE(1)))-1  ;BIS ZEILE ;until 
	. . IF ZEILE(2)<0 SET ZEILE(2)=LINE  ;MAX. ZEILE
	. . SET LEFT=""
	. . SET RIGHT=""
	. . SET KEYS=""
	. . SET ZEILE(0)=$ORDER(^WWWSOR(YUSER,"LINEAL","WERTE",ZEILE(1)),-1)
	. . FOR  SET ZEILE(0)=$ORDER(^WWWSOR(YUSER,"LINEAL","WERTE",ZEILE(0))) QUIT:ZEILE(0)=""  QUIT:$PIECE(ZEILE(0),".",1)>ZEILE(2)  DO
	. . . SET WERTE=$GET(^WWWSOR(YUSER,"LINEAL","WERTE",ZEILE(0),1))
	. . . IF (LEFT="")  || ($PIECE(WERTE,"X",1)<LEFT)  SET LEFT  = +$PIECE(WERTE,"X",1)
	. . . IF (RIGHT="") || ($PIECE(WERTE,"X",2)>RIGHT) SET RIGHT = +$PIECE(WERTE,"X",2)
	. . . SET KEYS=KEYS_$PIECE(WERTE,Y,2)_";"
	. . ;
	. . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","LINEAL",ZEILE(1),1) = ZEILE(2)_"X"_LEFT_"X"_RIGHT_Y_KEYS
	. . ;
	. . IF RIGHT>(COLUMNS-HEADLAENG-1) SET RIGHT=(COLUMNS-HEADLAENG-1)
	. . IF RIGHT<LEFT QUIT
	. . SET LENGTH=((RIGHT+1)-LEFT)
	. . SET LENL=(LENGTH\2)  ;LINKE SEITE DFLT. ;left-hand side 
	. . SET COLOR(0)=""
	. . SET COLOR(9)=""
	. . SET COLOR=""
	. . IF $PIECE(CHART1,Y,40)'=0 SET COLOR=$GET(^WWWDRAGDROPD(0,CHART,$PIECE(CHART1,Y,40),1))
	. . IF $PIECE(COLOR,Y,23)'="" SET COLOR(0)=$PIECE(COLOR,Y,23)
	. . IF $PIECE(COLOR,Y,24)'="" SET COLOR(9)=$PIECE(COLOR,Y,24)
	. . IF COLOR(0)'="" SET COLOR(0)=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR(0),1)),Y,1)
	. . IF COLOR(9)'="" SET COLOR(9)=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR(9),1)),Y,1)
	. . IF COLOR(0)=""  SET COLOR(0)="limegreen"
	. . IF COLOR(9)=""  SET COLOR(9)=COLOR(0)
	. . SET COLOR(1)=COLOR(0)
	. . SET COLOR(2)=COLOR(0)
	. . IF LASTRIGHT'=0 IF LASTRIGHT>LEFT SET COLOR(1)=COLOR(9) SET LENL=(LASTRIGHT-LEFT+1)  ;LINKE SEITE ;left-hand side 
	. . IF LASTRIGHT>RIGHT                SET COLOR(2)=COLOR(9) SET LENL=(LENGTH\2)          ;LINKE SEITE DFLT. ;left-hand side 
	. . SET LASTRIGHT=RIGHT
	. . SET LENR=(LENGTH-LENL)  ;RECHTE SEITE ;right-hand side 
	. . ;
	. . WRITE YCR,"<DIV id="_""""_"lineal"_ZEILE(1)_"""" 
	. . WRITE " style="_""""
	. . WRITE " position:absolute;"
	. . WRITE " top:"_(((ZEILE(1)*PIXEL)+(HEADSIZE*PIXEL)+BUTTONLINE)-2)_";"
	. . WRITE " left:"_(((LEFT*PIXEL)+(HEADLAENG*PIXEL))-3)_";"
	. . WRITE " height:"_PIXEL_";"
	. . WRITE " width:"_((LENGTH*PIXEL)+6)_";"
	. . WRITE " text-align:left;"
	. . WRITE " font:9pt arial;"
	. . WRITE " white-space:nowrap;"
	. . WRITE " z-index:1;"
	. . WRITE """"
	. . WRITE ">"
	. . ;
	. . WRITE YCR,"<table border=0 cellspacing=0 cellpadding=0 width=100% height=100%>"
	. . WRITE YCR,"<tr><td align=left id="_""""_"linleft"_ZEILE(1)_"""" 
	. . WRITE " style="_""""
	. . WRITE " border-top:5px solid "_COLOR(1)_";"
	. . WRITE " width:"_((LENL*PIXEL)+3)_";"
	. . WRITE """"
	. . WRITE ">"
	. . WRITE YCR,"<img src="_""""_YGIF_"scrdown.gif"_""""_" style="_""""_"vertical-align:top;"_""""_">"
	. . ;
	. . WRITE YCR,"</td><td align=right id="_""""_"linright"_ZEILE(1)_"""" 
	. . WRITE " style="_""""
	. . WRITE " border-top:5px solid "_COLOR(2)_";"
	. . WRITE " width:"_((LENR*PIXEL)+3)_";"
	. . WRITE """"
	. . WRITE ">"
	. . WRITE YCR,"<img src="_""""_YGIF_"scrdown.gif"_""""_" style="_""""_"vertical-align:top;"_""""_">"
	. . WRITE YCR,"</td></tr></table>"
	. . WRITE YCR,"</DIV>"
	
	;BALKENDIAGRAMM
	;--------------
	IF $PIECE(CHART1,Y,24)=1 IF HISTSIZE>0 DO
	. NEW DATA,PLEFT,PTOP,HEIGHT,WIDTH,LNUM,CNUM,DATA1,RCOLOR,RCOLOR2,TEMPDATA,TEMPD,JUST,WERT
	. NEW YKEY1T,YKEY1
	. SET DATA1=""      ;REFERENZLINIE
	. SET DATA=""
	. SET JUST=0
	. SET LEFTX=""
	. FOR  SET LEFTX=$ORDER(^WWWSOR(YUSER,"Y-REF",LEFTX)) QUIT:LEFTX=""  DO
	. . ;QUIT:LEFTX>1000       ;ZUR SICHERHEIT WEGEN ENDLOSSCHLEIFE
	. . QUIT:LEFTX>COLUMNS     ;ZUR SICHERHEIT WEGEN ENDLOSSCHLEIFE ;self-assurance quibble 
	. . SET WERT=$GET(^WWWSOR(YUSER,"Y-REF",LEFTX))
	. . SET $PIECE(DATA,Y,LEFTX+1)=WERT
	. ;
	. SET PTOP   = ((LINE*PIXEL)-1+BUTTONLINE)  ;POSITION TOP
	. SET PLEFT  = (HEADLAENG*PIXEL)  ;POSITION LEFT
	. SET HEIGHT = (HISTSIZE*PIXEL)   ;HEIGHT IN PIXEL ;within 
	. SET WIDTH  = (((COLUMNS*PIXEL)-(HEADLAENG*PIXEL))-1)  ;WIDTH IN PIXEL ;within 
	. SET LNUM   = 0                  ;DYN. AUFBAUEN ;construct 
	. SET CNUM   = COLUMNS-HEADLAENG  ;NUMBER OF FIELDS
	. SET LNUM   = LINE-HEADSIZE      ;NUMBER OF LINES
	. IF +$PIECE(CHART1,Y,64)'=0 DO   ;GRÖSSTEN WERT ERMITTELN WENN DYN. AUFBAU ;worthy find when 
	. . NEW YI
	. . SET LNUM=0
	. . FOR YI=1:1:CNUM IF +$PIECE(DATA,Y,YI)>LNUM SET LNUM=$PIECE(DATA,Y,YI)
	. ;
	. ;SET DATA1=$GET(^WWWSOR(YUSER,"DATA1",1))
	. SET TEMPDATA = $GET(^WWWSOR(YUSER,"DATA1",1))
	. SET YKEY1T   = $GET(^WWWSOR(YUSER,"DATA1KEY",1)) 
	. NEW YI,YII
	. FOR YII=1:1 QUIT:$PIECE(TEMPDATA,Y,YII,9999)=""  DO    ;SETZTEN DER REFERENZLINIE PRO TAG ;the within TAG 
	. . FOR YI=1:1:TIMESIZE DO
	. . . IF +TIMESIZE'=0 IF $PIECE(TEMPDATA,Y,YII)'="X" SET DATA1=$GET(DATA1)_($PIECE(TEMPDATA,Y,YII)/TIMESIZE)_Y
	. . . IF +TIMESIZE=0!($PIECE(TEMPDATA,Y,YII)="X") SET DATA1=$GET(DATA1)_$PIECE(TEMPDATA,Y,YII)_Y
	. . . SET YKEY1=$GET(YKEY1)_$PIECE(YKEY1T,Y,YII)_Y
	. ;
	. SET RCOLOR=""
	. IF $PIECE(CHART1,]]><![CDATA[Y,26)'="" DO  ;FARBE REFENZLINE ;tincture 
	. . SET RCOLOR=$PIECE(CHART1,Y,26)
	. . IF RCOLOR'="" SET RCOLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,RCOLOR,1)),Y,1)
	. ;
	. IF RCOLOR="" SET RCOLOR="red"
	. SET RCOLOR2=""
	. IF $PIECE(CHART1,Y,27)'="" DO  ;FARBE BOXES BELOW THE REFERENZ LINE ;tincture reference 
	. . SET RCOLOR2=$PIECE(CHART1,Y,27)
	. . IF RCOLOR2'="" SET RCOLOR2=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,RCOLOR2,1)),Y,1)
	. ;
	. IF RCOLOR2="" SET RCOLOR2="red"
	. NEW RLINK,NAMES
	. ;SET NAMES=$PIECE(CHART1,Y,51)_Y_$PIECE(CHART1,Y,52)_Y_$PIECE(CHART1,Y,53)_Y_$PIECE(CHART1,Y,54)_Y_$PIECE(CHART1,Y,55)
	. SET NAMES=$$^WWWTEXT($PIECE(CHART1,Y,51))  ;LEGENDE HISTOGRAMM ;legend 
	. SET NAMES=NAMES_Y_$$^WWWFELDNAME("WWWDRAGDROP","D",25)  ;AUSLASTUNG
	. SET NAMES=NAMES_Y_$$^WWWFELDNAME("WWWDRAGDROP","D",26)  ;KAPAZITÄT ;potentiality 
	. SET NAMES=NAMES_Y_$$^WWWFELDNAME("WWWDRAGDROP","D",27)  ;ÜBERLASTUNG
	. SET NAMES=NAMES_Y_$$^WWWFELDNAME("WWWDRAGDROP","D",26)_" "_$$^WWWTEXT(33634)  ;KAPAZITÄT (ÜBER SKALA) ;potentiality 
	. SET RLINK=$PIECE(CHART1,Y,50)     ;LINK ÄNDERN REFERENZLINIE ;alter 
	. IF $GET(YPRINTMODE)=1 SET RLINK=""
	. DO ^WWWDIAGRAMM(PTOP,PLEFT,HEIGHT,WIDTH,LNUM,CNUM,DATA,DATA1,HISTCOLOR,RCOLOR,RCOLOR2,,,RLINK,NAMES,$PIECE(CHART1,Y,56),$PIECE(CHART1,Y,57),$GET(TIMESIZE),$GET(YKEY1))
	. SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DIAGR-HEIGHT",1)=HEIGHT
	. SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DIAGR-WIDTH",1)=WIDTH
	. SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DIAGR-LNUM",1)=LNUM
	. SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DIAGR-CNUM",1)=CNUM
	. SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DIAGR-DATA",1)=DATA
	. SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DIAGR-DATA",2)=DATA
	. SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DIAGR-REFLINE",1)=DATA1
	. IF $PIECE(CHART1,Y,61)=1 DO  ;MERKEN FÜR RELOAD ;to 
	. . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATA1",1)=$GET(^WWWSOR(YUSER,"DATA1",1))
	. . SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATA1KEY",1)=$GET(^WWWSOR(YUSER,"DATA1KEY",1))
	
	WRITE "</FORM>"
	WRITE "</DIV>"
	SET YNOEVENTKEY=1
	DO ^WWWFORM8
	DO EVENT^WWWFORM  ;CSP HYPEREVENT
	
	;SPEICHERN FÜR HYPEREVENT ;Save to 
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","CHART",1)      = CHART
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","PIXEL",1)      = PIXEL
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","HEADLAENG",1)  = HEADLAENG
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","HEADSIZE",1)   = HEADSIZE
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","BUTTONLINE",1) = BUTTONLINE
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","TIMESIZE",1)   = TIMESIZE
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","ROWS",1)       = ROWS
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","COLUMNS",1)    = COLUMNS
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","TIMESCALE",1)  = START
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","ARBSTUNDEN",1) = ARBSTUNDEN
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","ARBBEGINN",1)  = ARBBEGINN
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","YSTARTDATE",1) = START
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATLFN1",1)    = $GET(DATLFN(1))
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATLFN2",1)    = $GET(DATLFN(2))
	SET ^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","ZNSTART",1)    = ZNSTART
	KILL ^WWWSOR(YUSER)
	WRITE YCR,"</BODY>"
	WRITE "</HTML>"
	QUIT
	
TIMESCALE	;ZEITSKALA
	NEW YI,YII,YDDCOL,YDDROW,WEEK,MONAT,JAHR,MONTHDAYS,WEEKDAYS,DATE1,DATE,TIME,YVORG,ENDE,DAUER,YA,MAXDAYS
	
	;+++++++++++++++++++++++++++++++++++++++
	;	VORG		objINVORG
	;	D16			$$$INVORGWorkingHoursPerDay()
	;	D152		$$$INVORGWorkStart()
	;	D153		$$$INVORGWorkEnd()
	;+++++++++++++++++++++++++++++++++++++++
	
	SET (YDDROW,YDDCOL)=0
	SET YII=0
	SET HEADSIZE=(MON+WEK+DAY+UHR)
	SET TIMESIZE=1
	DO
	. SET YVORG=$GET(^INVORG(YM,YM,1))
	. SET ARBBEGINN = $PIECE(YVORG,Y,152)    ;ARBEITSBEGINN AUS ALLG. ABLAUFPARAMETERN ;out of 
	. SET ENDE      = $PIECE(YVORG,Y,153)    ;ARBEITSENDE  AUS ALLG. ABLAUFPARAMETERN ;out of 
	. ;
	. SET TIMESIZE=0
	. IF +ARBBEGINN'=0 IF +ENDE'=0 SET TIMESIZE=((ENDE-ARBBEGINN)/60/60)
	. IF +TIMESIZE=0 SET TIMESIZE=$PIECE(YVORG,Y,16)  ;ARBEITSZEIT AUS MANDANTENVORGABE ;working hours out of 
	. IF +TIMESIZE=0 SET TIMESIZE=8                   ;STUNDEN ;delay 
	. ;
	. IF +ARBBEGINN'=0 IF +ENDE=0  SET ENDE=ARBBEGINN+TIMESIZE
	. IF +ARBBEGINN=0  IF +ENDE'=0 SET ARBBEGINN=ENDE-TIMESIZE
	. IF +ARBBEGINN=0 SET ARBBEGINN=$$^WWWTIME1("08:00")
	. IF +ENDE=0 SET ENDE=ARBBEGINN+TIMESIZE
	
	SET ARBSTUNDEN=TIMESIZE
	IF UHR'=1 SET TIMESIZE=1
	FOR YI="MON","WEK","DAY","UHR" DO
	. QUIT:@YI=0  ;NICHT ANZEIGEN ;Not display 
	. SET YII=YII+1
	. WRITE YCR,"<tr>"
	. ;
	. ;DESCRIPTION
	. IF HEADLAENG>0 DO
	. . WRITE YCR,"<td align=middle valign=middle"
	. . WRITE " BGCOLOR="_YSILVER
	. . WRITE " COLSPAN="_HEADLAENG
	. . WRITE ">"
	. . WRITE YCR,"<div valign=middle"
	. . WRITE " style="_""""
	. . WRITE " height:"_PIXEL_"px;"
	. . WRITE " width:"_(PIXEL*HEADLAENG)_"px;"
	. . WRITE " text-align:middle;"
	. . WRITE " font:"_FONTSIZE_"pt arial;"
	. . ;WRITE " font-weight:bold;"
	. . WRITE " border-left:1px solid;"
	. . WRITE " border-right:1px solid;"
	. . IF YII=1 WRITE " border-top:1px solid;"
	. . IF YII=(MON+WEK+DAY+UHR-1) WRITE " border-bottom:1px solid;"
	. . WRITE " border-Bottom-Color:"_COLORLIGHT_";"
	. . WRITE " border-Right-Color:"_COLORLIGHT_";"
	. . WRITE " border-Top-Color:"_COLORDARK_";"
	. . WRITE " border-Left-Color:"_COLORDARK_";"
	. . WRITE " overflow:hidden;"
	. . WRITE """"_">"
	. . IF YII=1 IF (MON+WEK+DAY+UHR)>1 DO
	. . . IF (MON+WEK+DAY+UHR)>3  WRITE YCR,"<B>"_YKOPF_"</B>"
	. . . IF (MON+WEK+DAY+UHR)'>3 WRITE "<B>"_$$^WWWDATE(START)_" - "_$$^WWWDATE(STOP)_"</B>"  ;VON - BIS ;until 
	. . ;
	. . IF YII=2 IF (MON+WEK+DAY+UHR)>2 DO
	. . . ;IF (MON+WEK+DAY+UHR)>3 WRITE "&nbsp;&nbsp;"_$$^WWWTEXT(31002)_" "_$$^WWWDATE(START)_" "_$$^WWWTEXT(69)_" "_$$^WWWDATE(STOP) QUIT  ;VON - BIS  ;BR014923
	. . . IF (MON+WEK+DAY+UHR)>3 WRITE "&nbsp;&nbsp;"_$$^WWWTEXT(31002)_" "_$$^WWWDATE(START)_" "_$$$Text($listbuild("54",$$^WWWDATE(STOP))) QUIT  ;VON - BIS  ;BR014923  ;$lb("54",""): To %1
	. . . IF $PIECE(CHART1,Y,60)=1 QUIT  ;TEXT IN BLÄTTERFUNKTION ;Text within 
	. . . ;WRITE $$^WWWTEXT(33629)_": "_+$GET(DATLFN(2))_" "_$$^WWWTEXT(68)_" "_+$GET(DATLFN(1))  ;ANGEZEIGTE DATENSÄTZE n VON nn ;substitute product   ;BR014923
	. . . WRITE $$^WWWTEXT(33629)_": "_+$GET(DATLFN(2))_" "_$$$Text($listbuild("53",+$GET(DATLFN(1))))  ;ANGEZEIGTE DATENSÄTZE n VON nn ;substitute product   ;BR014923  ;$lb("53",""): From %1
	. . ;
	. . IF YII=3 IF (MON+WEK+DAY+UHR)>3 DO
	. . . IF $PIECE(CHART1,Y,60)=1 QUIT  ;TEXT IN BLÄTTERFUNKTION ;Text within 
	. . . ;WRITE $$^WWWTEXT(33629)_": "_+$GET(DATLFN(2))_" "_$$^WWWTEXT(68)_" "_+$GET(DATLFN(1))  ;ANGEZEIGTE DATENSÄTZE n VON nn ;substitute product   ;BR014923
	. . . WRITE $$^WWWTEXT(33629)_": "_+$GET(DATLFN(2))_" "_$$$Text($listbuild("53",+$GET(DATLFN(1))))  ;ANGEZEIGTE DATENSÄTZE n VON nn ;substitute product   ;BR014923  ;$lb("53",""): From %1
	. . . IF YAUSWAHL'="" WRITE " ("_$$^WWWTEXT(33631)_")" QUIT  ;EINGESCHRÄNKTE AUSWAHL ;Selection 
	. . . IF $DATA(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENx")) WRITE " <font color="_YRED_">("_$$^WWWTEXT(33628)_")</font>"  ;GEFILTERT DATEN
	. . ;
	. . IF YII=(MON+WEK+DAY+UHR) DO
	. . . ;NEW YNUM,YFELD
	. . . ;SET YZA=0 ;table-mat 
	. . . ;SET YNUM="" FOR  SET YNUM=$ORDER(^WWWDRAGDROPD(0,CHART,YNUM)) QUIT:YNUM=""  DO
	. . . ;. ;SET YFELD=$GET(^WWWDRAGDROPD(0,CHART,YNUM,1))
	. . . ;. ;IF $PIECE(YFELD,Y,5)=1 SET YZA=YZA+1
	. . . ;. I $P(YSETUP,Y,YNUM)=1 S YZA=YZA+1
	. . . QUIT:YZA=0
	. . . ;SET YZAMAX=(HEADLAENG*PIXEL)  ;MAX HEADER BREITE ;table-mat width 
	. . . WRITE YCR,"<TABLE style="_""""_"table-layout:fixed;"_""""_" BORDER=0 CELLSPACING=0 CELLPADDING=0><TR>"
	. . . SET YA=0
	. . . SET YNUM=""
	. . . FOR  SET YNUM=$ORDER(^WWWDRAGDROPD(0,CHART,YNUM)) QUIT:YNUM=""  DO
	. . . . SET YFELD=$GET(^WWWDRAGDROPD(0,CHART,YNUM,1))
	. . . . ;IF $PIECE(YFELD,Y,5)'=1 QUIT
	. . . . IF $PIECE(YSETUP,Y,YNUM)'=1 QUIT
	. . . . SET YA=YA+1
	. . . . SET YZASIZE=$PIECE(YFELD,Y,16)  ;FELDBREITE
	. . . . IF +YZASIZE=0 SET YZASIZE=4*PIXEL  ;DFLT. BREITE ;width 
	. . . . ;IF +YZASIZE=0 SET YZASIZE=$JUSTIFY((HEADLAENG*PIXEL)/YZA,0,0)  ;DFLT. BREITE
	. . . . SET YZASIZE=(YZASIZE\PIXEL)*PIXEL
	. . . . IF YA=YZA SET YZASIZE=YZAMAX  ;RESTBREITE
	. . . . SET YZAMAX=YZAMAX-YZASIZE  ;RESTL. BREITE ;width 
	. . . . IF YZAMAX<0 QUIT
	. . . . WRITE YCR,"<TD"
	. . . . WRITE " BGCOLOR="_YDARKGRAY
	. . . . WRITE " style="_""""
	. . . . WRITE " text-align:left;"
	. . . . WRITE " vertical-align:middle;"
	. . . . WRITE " font:"_FONTSIZE_"pt arial;"
	. . . . ;WRITE " font-weight:bold;"
	. . . . IF YNUM=$PIECE(CHART1,Y,40) DO
	. . . . . ;NEW BGCOLOR
	. . . . . ;SET BGCOLOR=$PIECE($GET(^WWW012(0,YM,1)),Y,14)
	. . . . . ;IF BGCOLOR'="" SET BGCOLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,BGCOLOR,1)),Y,1)
	. . . . . ;IF BGCOLOR="" SET BGCOLOR="gray"
	. . . . . ;WRITE " background-color:"_BGCOLOR_";"
	. . . . . WRITE " font-weight:bold;"
	. . . . ;
	. . . . WRITE " border-top:1px solid "_COLORDARK_";"
	. . . . WRITE " border-bottom:1px solid "_COLORLIGHT_";"
	. . . . IF YA<YZA WRITE " border-right:1px solid "_COLORLIGHT_";"
	. . . . IF YA>1 WRITE " border-left:1px solid "_COLORDARK_";"
	. . . . WRITE " width:"_YZASIZE_";"
	. . . . ;WRITE " height:"_(PIXEL-1)_";"
	. . . . WRITE " height:"_PIXEL_";"
	. . . . WRITE """"_">"
	. . . . WRITE "&nbsp;"
	. . . . DO
	. . . . . NEW HEADER
	. . . . . SET HEADER=$PIECE(YFELD,Y,1)
	. . . . . IF $PIECE($GET(^WWW1221(0,CHART,YNUM,SPRACHE,1)),Y,1)'="" SET HEADER=$PIECE(^(1),Y,1)
	. . . . . ;IF +$PIECE(YFELD,Y,1)'=0 IF $DATA(^WWW009(0,SPRACHE,+$PIECE(YFELD,Y,1))) SET HEADER=$$^WWWTEXT($PIECE($PIECE(YFELD,Y,1),";",1))
	. . . . . ;IF $EXTRACT($PIECE(YFELD,Y,1),1,3)="$$^" XECUTE "SET HEADER="_$PIECE($PIECE(YFELD,Y,1),";",1)
	. . . . . QUIT:HEADER=""
	. . . . . IF $PIECE(CHART1,Y,38)=1 IF $PIECE(YFELD,Y,12)=1 IF $GET(YPRINTMODE)'=1 DO  ;SORTIERFELD
	. . . . . . WRITE "<A HREF="_""""_YAKTION_"EP=WWWMANU1&amp;YEXEC=DO|CHART^WWWDRAGDROP('"_CHART_"','"_START_"','"_STOP_"')&amp;YFORM="_YFORM_"&amp;YAUSWAHL="_"*"_YNUM
	. . . . . . NEW YFORM,YKEY
	. . . . . . DO ^WWWCGI
	. . . . . . WRITE """"_">"
	. . . . . ;
	. . . . . WRITE $$^WWWTRANSLATE(HEADER," ","&nbsp;")
	. . . . . IF $PIECE(CHART1,Y,38)=1 IF $PIECE(YFELD,Y,12)=1 WRITE "</A>"
	. . . . ;
	. . . . WRITE YCR,"</TD>"
	. . . ; 
	. . . WRITE YCR,"</TR>"
	. . . WRITE YCR,"</TABLE>"
	. . ;
	. . WRITE YCR,"</div>"
	. . WRITE YCR,"</td>"
	. ;
	. IF YI="MON" DO
	. . SET COLUMNS   = 0
	. . SET DATE      = START
	. . SET MONAT     = ""
	. . SET MONTHDAYS = 30
	. . FOR  QUIT:DATE>STOP  DO  SET DATE=DATE+MONTHDAYS
	. . . IF $$^WWWMONTH(DATE)'=MONAT DO
	. . . . SET MONAT = $$^WWWMONTH(DATE)
	. . . . SET JAHR  = $$^WWWYEAR(DATE)
	. . . . IF $$^WWWMONTH(STOP)=$$^WWWMONTH(START) IF $$^WWWYEAR(STOP)=$$^WWWYEAR(START) SET MONTHDAYS=(STOP-START+1) QUIT
	. . . . IF $$^WWWMONTH(STOP)=MONAT              IF $$^WWWYEAR(STOP)=JAHR              SET MONTHDAYS=(STOP-$$DMY^WWWDATE1("01."_MONAT_"."_JAHR)+1) QUIT   ; SR17146
	. . . . SET MONTHDAYS=$$^WWWMONTHDAYS(DATE)-(DATE-$$DMY^WWWDATE1("01."_MONAT_"."_JAHR))   ; SR17146
	. . . ;
	. . . SET MAXDAYS=MONTHDAYS
	. . . IF $PIECE(CHART1,Y,37)=1 DO
	. . . . FOR YI=0:1:MONTHDAYS-1  IF $DATA(^WWWSOR(YUSER,"FEIERTAG",(DATE+YI))) SET MAXDAYS=MAXDAYS-1
	. . . ;
	. . . IF MAXDAYS<1 QUIT  ;KEIN TAG MEHR ZUM ANZEIGEN ;no TAG more display 
	. . . WRITE YCR,"<td align=middle valign=middle"
	. . . WRITE " BGCOLOR="_YDARKGRAY
	. . . WRITE " COLSPAN="_(MAXDAYS*TIMESIZE)
	. . . WRITE ">"
	. . . WRITE YCR,"<div valign=middle"
	. . . WRITE " style="_""""_" height:"_PIXEL_"px;"
	. . . WRITE " width:"_(PIXEL*MAXDAYS*TIMESIZE)_"px; text-align:middle;"
	. . . WRITE " border:1px solid;"
	. . . WRITE " border-Bottom-Color:"_COLORLIGHT_";"
	. . . WRITE " border-Right-Color:"_COLORLIGHT_";"
	. . . WRITE " border-Top-Color:"_COLORDARK_";"
	. . . WRITE " border-Left-Color:"_COLORDARK_";"
	. . . WRITE " font:"_FONTSIZE_"pt arial;"
	. . . WRITE " overflow:hidden;"
	. . . WRITE """"_">"
	. . . IF (MAXDAYS*TIMESIZE*PIXEL)>50 DO
	. . . . WRITE YCR,$PIECE($$^WWWTEXT(30023),",",MONAT)
	. . . . WRITE " "_JAHR
	. . . ;
	. . . WRITE YCR,"</div>"
	. . . WRITE YCR,"</td>"
	. . . SET COLUMNS=COLUMNS+(MAXDAYS*TIMESIZE)
	. ;
	. IF YI="WEK" DO
	. . SET DATE=START
	. . SET WEEK=""
	. . SET COLUMNS=0
	. . FOR  QUIT:DATE>STOP  DO  SET DATE=DATE+WEEKDAYS
	. . . DO
	. . . . ;IF WEEK'="" SET WEEKDAYS=7 IF (DATE+WEEKDAYS)<STOP QUIT
	. . . . SET WEEK=$$^WWWWEEK(DATE,4)
	. . . . SET DATE1=DATE
	. . . . SET WEEKDAYS=0
	. . . . FOR  QUIT:$$^WWWWEEK(DATE1,4)'=WEEK  QUIT:DATE1>STOP  SET WEEKDAYS=WEEKDAYS+1 SET DATE1=DATE1+1
	. . . ;
	. . . SET MAXDAYS=WEEKDAYS
	. . . IF $PIECE(CHART1,Y,37)=1 DO
	. . . . FOR YI=0:1:WEEKDAYS-1  IF $DATA(^WWWSOR(YUSER,"FEIERTAG",(DATE+YI))) SET MAXDAYS=MAXDAYS-1
	. . . ;
	. . . IF MAXDAYS<1 QUIT  ;KEIN TAG MEHR ZUM ANZEIGEN ;no TAG more display 
	. . . WRITE YCR,"<td align=middle valign=middle"
	. . . WRITE " BGCOLOR="_YGRAY
	. . . WRITE " COLSPAN="_(MAXDAYS*TIMESIZE)
	. . . WRITE ">"
	. . . WRITE YCR,"<div valign=middle"
	. . . WRITE " style="_""""_" height:"_PIXEL_"px;"
	. . . WRITE " width:"_(PIXEL*MAXDAYS*TIMESIZE)_"px; text-align:middle;"
	. . . WRITE " border:1px solid;"
	. . . WRITE " border-Bottom-Color:"_COLORLIGHT_";"
	. . . WRITE " border-Right-Color:"_COLORLIGHT_";"
	. . . WRITE " border-Top-Color:"_COLORDARK_";"
	. . . WRITE " border-Left-Color:"_COLORDARK_";"
	. . . WRITE " overflow:hidden;"
	. . . WRITE " font:"_FONTSIZE_"pt arial;"
	. . . WRITE """"_">"
	. . . IF (MAXDAYS*TIMESIZE)>2 WRITE YCR,$$^WWWTEXT(385)_" "  ;KW ;week 
	. . . WRITE YCR,$$^WWWWEEK(DATE,4)
	. . . WRITE YCR,"</div>"
	. . . WRITE YCR,"</td>"
	. . . SET COLUMNS=COLUMNS+(MAXDAYS*TIMESIZE)
	. ;
	. IF YI="DAY" DO  ;DAY SCALE
	. . SET DATE=START
	. . SET COLUMNS=0
	. . FOR  QUIT:DATE>STOP  DO  SET DATE=DATE+1
	. . . IF $PIECE(CHART1,Y,37)=1 IF $DATA(^WWWSOR(YUSER,"FEIERTAG",DATE)) QUIT
	. . . WRITE YCR,"<td align=middle valign=middle"
	. . . DO
	. . . . IF $PIECE(CHART1,Y,37)'=1 IF $$^WWWCALDAY(DATE,CAL)'=0 WRITE " BGCOLOR="_"MISTYROSE" QUIT
	. . . . WRITE " BGCOLOR="_YWHITE
	. . . ;
	. . . IF TIMESIZE>1 WRITE " COLSPAN="_TIMESIZE
	. . . WRITE ">"
	. . . WRITE YCR,"<div valign=middle"
	. . . WRITE " style="_""""_" height:"_PIXEL_"px;"
	. . . WRITE " width:"_(PIXEL*TIMESIZE)_"px; text-align:middle;"
	. . . WRITE " border:1px solid;"
	. . . WRITE " border-Bottom-Color:"_COLORLIGHT_";"
	. . . WRITE " border-Right-Color:"_COLORLIGHT_";"
	. . . WRITE " border-Top-Color:"_COLORDARK_";"
	. . . WRITE " border-Left-Color:"_COLORDARK_";"
	. . . WRITE " overflow:hidden;"
	. . . WRITE " font:"_FONTSIZE_"pt arial;"
	. . . WRITE """"_">"
	. . . IF TIMESIZE'>5 WRITE YCR,$PIECE($$^WWWDATE(DATE,"DE"),".",1)
	. . . ;IF TIMESIZE>5 WRITE YCR,$PIECE($$^WWWTEXT(30022),",",$$^WWWDAY(DATE))_", "_$PIECE($$^WWWDATE(DATE,"DE"),".",1)_"."   ;24873;05.01.03;SHOW DATE WITH DATEFUNCTION
	. . . IF TIMESIZE>5 WRITE YCR,$$^WWWDATEFULL(DATE,1)
	. . . WRITE YCR,"</div>"
	. . . WRITE YCR,"</td>"
	. . . SET COLUMNS=COLUMNS+1
	. ;
	. IF YI="UHR" DO  ;TIME SCALE
	. . SET DATE=START
	. . SET COLUMNS=0
	. . FOR  QUIT:DATE>STOP  DO  SET DATE=DATE+1
	. . . IF $PIECE(CHART1,Y,37)=1 IF $DATA(^WWWSOR(YUSER,"FEIERTAG",DATE)) QUIT
	. . . FOR TIME=1:1:TIMESIZE DO
	. . . . WRITE YCR,"<td align=middle valign=middle"
	. . . . WRITE " BGCOLOR="_"LIGHTGOLDENRODYELLOW"
	. . . . WRITE ">"
	. . . . WRITE YCR,"<div valign=middle"
	. . . . WRITE " style="_""""_" height:"_PIXEL_"px;"
	. . . . WRITE " width:"_PIXEL_"px; text-align:middle;"
	. . . . WRITE " border:1px solid;"
	. . . . WRITE " border-Bottom-Color:"_COLORLIGHT_";"
	. . . . WRITE " border-Right-Color:"_COLORLIGHT_";"
	. . . . WRITE " border-Top-Color:"_COLORDARK_";"
	. . . . WRITE " border-Left-Color:"_COLORDARK_";"
	. . . . WRITE " overflow:hidden;"
	. . . . WRITE " font:"_FONTSIZE_"pt arial;"
	. . . . WRITE """"_">"
	. . . . WRITE YCR,(TIME+$$^WWWTIME(ARBBEGINN)-1)
	. . . . WRITE YCR,"</div>"
	. . . . WRITE YCR,"</td>"
	. . . . SET COLUMNS=COLUMNS+1
	. ;
	. WRITE YCR,"</tr>"
	
	SET COLUMNS=COLUMNS+HEADLAENG
	QUIT
	
GRID	;AUFBAU TABELLEN-RASTER
	NEW YDDROW,YDDCOL,SORT,NEXTSORT,KEY,YI,LASTSORT,YLIN,SORT2
	
	SET (YDDROW,YDDCOL)=0
	SET YI(1)=0
	SET LASTSORT=""
	SET RICHT=1
	SET ZNR=0
	IF $PIECE(CHART1,Y,40)'="" IF $PIECE($GET(^WWWDRAGDROPD(0,CHART,$PIECE(CHART1,Y,40),1)),Y,22)=1 SET RICHT=-1
	SET SORT2=""
	FOR  SET SORT2=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT2),RICHT) QUIT:SORT2=""  DO
	. SET SORT=""
	. FOR  SET SORT=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT2,SORT),RICHT) QUIT:SORT=""  DO
	. . SET KEY=""
	. . FOR  SET KEY=$ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT2,SORT,KEY)) QUIT:KEY=""  DO
	. . . SET ZNR=ZNR+1
	. . . IF ZNSTART>ZNR QUIT
	. . . IF ZNSTOP<ZNR  QUIT
	. . . ;
	. . . SET YI(1)=YI(1)+1
	. . . SET YI(3)=0  ;INNERHALB EINER GRUPPE ;inside unit group 
	. . . IF $ORDER(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs",SORT2,SORT,KEY))="" SET YI(3)=1  ;DANACH FOLGT NEUE GRUPPE ;thereafter group 
	. . . IF YI(1)=ROWS SET YI(3)=0  ;LETZTE ZEILE ;last 
	. . . ;
	. . . IF LINEAL=1 IF LASTSORT=""!(LASTSORT'=SORT) SET ^WWWSOR(YUSER,"LINEAL","ZEILE",(YI(1)-1),1)=""  ;LINEALANFANG
	. . . SET LASTSORT=SORT
	. . . ;
	. . . WRITE YCR,"<tr id="_""""_"row"_YI(1)_""""
	. . . WRITE ">"
	. . . SET YDDROW=YDDROW+1
	. . . FOR YI(2)=1:1:COLUMNS DO
	. . . . WRITE YCR,"<td id="_""""_"col"_YI(1)_"-"_YI(2)_""""_" align=middle valign=middle"
	. . . . IF YDDROW#2=1 WRITE " BGCOLOR="_YWHITE
	. . . . IF YDDROW#2=0 WRITE " BGCOLOR="_YGRAY
	. . . . WRITE ">"
	. . . . WRITE YCR,"<div id="_""""_"elem"_YI(1)_"-"_YI(2)_""""_" align=middle valign=middle"
	. . . . WRITE " style="_""""_"width:"_PIXEL_"px; height:"_PIXEL_"px;"
	. . . . IF YI(2)=1              WRITE " border-left:1px solid "_COLORDARK_";"
	. . . . IF YI(2)=HEADLAENG      WRITE " border-right:1px solid "_COLORLIGHT_";"
	. . . . IF YI(2)>HEADLAENG      WRITE " border-right:1px dotted "_YDARKGRAY_";"
	. . . . IF YI(2)=COLUMNS        WRITE " border-right:1px solid "_COLORLIGHT_";"
	. . . . IF $PIECE(CHART1,Y,7)=1 WRITE " border-top:1px solid "_COLORDARK_";"
	. . . . IF $PIECE(CHART1,Y,39)'=1 IF $PIECE(CHART1,Y,7)=1             WRITE " border-bottom:1px solid "_COLORLIGHT_";"
	. . . . IF $PIECE(CHART1,Y,39)=1  IF $PIECE(CHART1,Y,7)=1 IF YI(3)'=1 WRITE " border-bottom:1px solid "_COLORLIGHT_";"
	. . . . IF $PIECE(CHART1,Y,39)=1                          IF YI(3)=1  WRITE " border-bottom:2px solid black;"
	. . . . WRITE """"_">"
	. . . . WRITE YCR,"<FONT SIZE=1></FONT>"  ;ZEILE NICHT LÖSCHEN ! ;Not Delete 
	. . . . WRITE YCR,"</div>"
	. . . . WRITE YCR,"</td>"
	. . . ;
	. . . WRITE YCR,"</tr>"
	
	IF '$DATA(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"V","DATENs")) DO  ;KEINE ANZEIGE = LEERZEILE ;no Show blank line 
	. SET HEADSIZE=HEADSIZE+1
	. WRITE YCR,"<tr id="_""""_"row"_0_""""
	. WRITE ">"
	. FOR YI(2)=1:1:COLUMNS DO
	. . WRITE YCR,"<td id="_""""_"col"_0_"-"_0_""""_" align=LEFT NOWRAP"
	. . ;WRITE " BGCOLOR="_YWHITE
	. . WRITE " BGCOLOR="_YGRAY
	. . WRITE ">"
	. . WRITE YCR,"<div id="_""""_"elem"_0_"-"_0_""""_" align=middle valign=middle"
	. . WRITE " style="_""""_"width:"_PIXEL_"px; height:"_PIXEL_"px;"
	. . IF YI(2)=1              WRITE " border-left:1px solid "_COLORDARK_";"
	. . IF YI(2)=HEADLAENG      WRITE " border-right:1px solid "_COLORLIGHT_";"
	. . IF YI(2)>HEADLAENG      WRITE " border-right:1px dotted "_YDARKGRAY_";"
	. . IF YI(2)=COLUMNS        WRITE " border-right:1px solid "_COLORLIGHT_";"
	. . IF $PIECE(CHART1,Y,7)=1 WRITE " border-top:1px solid "_COLORDARK_";"
	. . IF $PIECE(CHART1,Y,39)'=1 IF $PIECE(CHART1,Y,7)=1 WRITE " border-bottom:1px solid "_COLORLIGHT_";"
	. . IF $PIECE(CHART1,Y,39)=1  IF $PIECE(CHART1,Y,7)=1 WRITE " border-bottom:1px solid "_COLORLIGHT_";"
	. . WRITE """"_">"
	. . WRITE YCR,"<FONT SIZE=1>"
	. . ;IF YI(2)=1 WRITE $$^WWWTEXT(46)
	. . WRITE "</FONT>"
	. . WRITE YCR,"</div>"
	. . WRITE YCR,"</td>"
	. ;
	. WRITE YCR,"</tr>"
	
	QUIT
	
HISTOGRAMM	;SUMMEN HISTOGRAMM ;purr 
	NEW YI,YII,YDDCOL,YDDROW,WEEK,MONAT,JAHR,MONTHDAYS,WEEKDAYS,DATE1,DATE,TIME,BEGINN,ENDE,DAUER
	
	SET (YDDROW,YDDCOL)=0
	SET YII=0
	FOR YI=1:1:HISTSIZE DO
	. SET YII=YII+1
	. WRITE YCR,"<tr>"
	. ;
	. ;DESCRIPTION
	. IF HEADLAENG>0 DO
	. . WRITE YCR,"<td align=middle valign=middle"
	. . WRITE " BGCOLOR="_YDARKGRAY
	. . WRITE " COLSPAN="_HEADLAENG
	. . WRITE ">"
	. . WRITE YCR,"<div valign=middle"
	. . WRITE " style="_""""
	. . WRITE " height:"_PIXEL_"px;"
	. . WRITE " width:"_(PIXEL*HEADLAENG)_"px;"
	. . WRITE " text-align:left;"
	. . WRITE " border-left:1px solid "_COLORDARK_";"
	. . WRITE " border-right:1px solid "_COLORLIGHT_";"
	. . IF YII=1        WRITE " border-top:1px solid "_COLORDARK_";"
	. . IF YII=HISTSIZE WRITE " border-bottom:1px solid; "_COLORLIGHT_";"
	. . WRITE " overflow:hidden;"
	. . WRITE " z-index:0;"
	. . WRITE " font:"_FONTSIZE_"pt arial;"
	. . WRITE """"_">"
	. . WRITE "&nbsp;"
	. . WRITE YCR,"</div>"
	. . WRITE YCR,"</td>"
	. ;
	. FOR YI(2)=1:1:(COLUMNS-HEADLAENG) DO
	. . WRITE YCR,"<td align=middle valign=middle"
	. . WRITE " BGCOLOR="_YWHITE
	. . ;IF TIMESIZE>1 WRITE " COLSPAN="_TIMESIZE
	. . WRITE ">"
	. . WRITE YCR,"<div valign=middle"
	. . WRITE " style="_""""_" height:"_PIXEL_"px;"
	. . WRITE " width:"_PIXEL_"px; text-align:middle;"
	. . IF YII=1   WRITE " border-top:1px solid "_COLORDARK_";"
	. . IF YI(2)=1 WRITE " border-left:1px solid "_COLORDARK_";"
	. . WRITE " border-right:1px dotted "_YDARKGRAY_";"
	. . IF YI(2)=(COLUMNS-HEADLAENG) WRITE " border-right:1px solid "_COLORLIGHT_";"
	. . IF YII=HISTSIZE WRITE " border-bottom:1px solid "_COLORLIGHT_";"
	. . WRITE " overflow:hidden;"
	. . WRITE " font:"_FONTSIZE_"pt arial;"
	. . WRITE """"_">"
	. . ;WRITE YCR,"<FONT SIZE=1 FACE=ARIAL>"
	. . ;WRITE YCR,"</FONT>"
	. . WRITE YCR,"</div>"
	. . WRITE YCR,"</td>"
	. ;
	. WRITE YCR,"</tr>"
	
	QUIT
	
VORG(CHART)	  ;HOLEN BENUTZERSPEZIFISCHE VORGABEN ;send for 
	NEW CHART1,YI,SATZ,FELDER
	
	;+++++++++++++++++++++++++++++++++++++++
	;	CHART1		obj^WWWDRAGDROP
	;	SATZ		obj^WWWDRAGDROPU
	;+++++++++++++++++++++++++++++++++++++++
	
	SET CHART1 = $GET(^WWWDRAGDROP(0,CHART,1))
	IF '$FIND(";"_$PIECE(CHART1,Y,47)_";",";40;") SET $PIECE(CHART1,Y,47)=$PIECE(CHART1,Y,47)_";"_40  ;AUSWAHL IMMER AUS USERDATEI LADEN
	IF $PIECE(CHART1,Y,47)'="" DO
	. SET SATZ=$GET(^WWWDRAGDROPU(0,CHART,YBED,1))  ;MITARBEITERVORGABEN
	. IF SATZ="" QUIT
	. SET FELDER=$TRANSLATE($PIECE(CHART1,Y,47),",",";")
	. FOR YI=1:1 QUIT:$PIECE(FELDER,";",YI,99)=""  DO
	. . IF $PIECE(SATZ,Y,$PIECE(FELDER,";",YI))="" QUIT
	. . SET $PIECE(CHART1,Y,$PIECE(FELDER,";",YI))=$PIECE(SATZ,Y,$PIECE(FELDER,";",YI))
	
	IF +$PIECE(CHART1,Y,58)=0 SET $PIECE(CHART1,Y,58)=100  ;MAX. ANZEIGE ;Show 
	QUIT CHART1
	
]]></Routine>
</Export>