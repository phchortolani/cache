<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INKUNDEANFRANG" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INKUNDEANFRANG(YKEY)    ;INKUNDEANFRANG;ULM;ANGEBOT AUS KUNDENANFRAGE;29.08.2002  ;
	;
#include COMSYS   // SR14746
 
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		ANGEBOT AUS KUNDENANFRAGE
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	; 21-SEP-2006 FAN SR14746 Sales statistics incorrect
	;| ULM	29.08.2002  
	;|
	;\------------------------------------------------------------------/
	;
	;AUFRUF AUS FORMULAR INKUNDEANFRANG BZW. ;out of form resp. 
	;AUFRUF AUS ROUTINE  INANGNEU1 ;out of routine 
	NEW SATZ
	SET YKEY=$GET(YKEY)  ;ANFRAGENUMMER
	QUIT:YKEY=""
	SET YFELD=$GET(^INKUNDEANFR(YM,YKEY,1))
	QUIT:YFELD=""
	SET YANGEBOT=$$^WWWNEXT("INANG")  ;NEUE ANGEBOTSNUMMER
	;SET $P(^INKUNDEANFR(YM,YKEY,1),Y,22)=1  // SR14746
	DO
	. NEW SATZ
	. SET SATZ=$GET(^INKUNDEANFR(YM,YKEY,1))
	. SET $PIECE(SATZ,Y,22)=1  // SR14746
	. SET strStatus=$$$Save("INKUNDEANFR",YKEY,SATZ,$$$YES)     // SR14746
	SET YFELD(1)=""
	IF $PIECE(YFELD,Y,5)'="" DO  ;HOLEN DER ADRESSDATEN      ;send for the 
	. ;AUS KUNDENADRESSEN ;out of 
	. IF $DATA(^INKUNDE(YM,$PIECE(YFELD,Y,5))) DO
	. . SET YFELD(1)=$GET(^INKUNDE(YM,$PIECE(YFELD,Y,5),1))
	. . QUIT
	. ;AUS WERBEADRESSEN ;out of 
	. IF $DATA(^INWERBEADR(YM,$PIECE(YFELD,Y,5))) IF '$DATA(^INKUNDE(YM,$PIECE(YFELD,Y,5))) DO
	. . SET YFELD(1)=$GET(^INWERBEADR(YM,$PIECE(YFELD,Y,5),1))
	. . QUIT
	. QUIT
	;ÜBERTRAGEN DER ANFRAGEDATEN IN ANGEBOT ;transport the within proposition 
	IF YFELD'="" DO  ;
	. NEW SATZ
	. SET $PIECE(SATZ,Y,1)=$PIECE(YFELD,Y,5)  ;KUNDENNUMMER
	. SET $PIECE(SATZ,Y,4)=+$H
	. SET $PIECE(SATZ,Y,144)=YKEY  ;ANFRAGENUMMER
	. IF $PIECE(YFELD,Y,45)'="" SET $PIECE(SATZ,Y,232)=$$^WWWDATE($PIECE(YFELD,Y,45))  ;ANFRAGE VOM
	. SET $PIECE(SATZ,Y,231)=$PIECE(YFELD,Y,13)  ;ANFRAGENUMMER DES KUNDEN
	. SET $PIECE(SATZ,Y,10)=$P($PIECE(YFELD,Y,12),",",1)  ;ANSPRECHPARTNER EINKAUF - TELEFONNUMMER
	. SET $PIECE(SATZ,Y,8)=$PIECE(YFELD,Y,47)  ;PROJEKTTEILEBEZEICHNUNG
	. SET $PIECE(SATZ,Y,240)=$PIECE(YFELD,Y,14)  ;PROJEKTZEICHNUNGSNUMMER
	. SET $PIECE(SATZ,Y,241)=$PIECE(YFELD,Y,49)  ;PROJEKTINDEXSTAND
	. SET $PIECE(SATZ,Y,6)=YLOCATION  ;VORBELEGUNG BETRIEB
	. SET $PIECE(SATZ,Y,14)=YBED  ;ZUSTÄNDIGER MITARBEITER
	. IF $P(YFELD,Y,16)'="" SET $P(SATZ,Y,14)=$P(YFELD,Y,16)  ;WENN ZUSTÄNDIGER MITARBEITER IM ANGEBOT AUSGEWÄHLT ;when proposition select 
	. IF $PIECE(YFELD,Y,45)'="" SET $PIECE(SATZ,Y,106)=$$^WWWTEXT(33134)_": "_YKEY_", "_$$^WWWTEXT(33135)_": "_$$^WWWDATE($PIECE(YFELD,Y,45))  ;BETREFF: ANFRAGE-NR, ANFRAGE VOM
	. IF $PIECE(YFELD,Y,5)'="" SET $PIECE(SATZ,Y,15)=+$PIECE(YFELD(1),Y,15)  ;BELEGVERSAND VIA
	. IF $PIECE($GET(^INVORG(YM,YM,1)),Y,25)'="" SET $PIECE(SATZ,Y,202)=(+$H+(+$PIECE($GET(^INVORG(YM,YM,1)),Y,25)))  ;ANGEBOT GÜLTIG BIS ;proposition valuable until 
	. IF $PIECE(YFELD(1),Y,56)'="" SET $PIECE(SATZ,Y,56)=$PIECE(YFELD(1),Y,56)  ;STANDARDKONDITION
	. IF $PIECE(YFELD(1),Y,57)'="" SET $PIECE(SATZ,Y,57)=$PIECE(YFELD(1),Y,57)  ;SONDERKONDITION
	. SET $PIECE(SATZ,Y,41)=+$H  ;ERFASSUNGSDATUM
	. SET $PIECE(SATZ,Y,42)=YBED  ;ERFASSUNGSMITARBEITER
	. SET $P(SATZ,Y,248)=1  ;DEFAULT - AUTOMATISCHE NACHFRAGE GENERIEREN ;request 
	. ;
	. IF YANGEBOT'="" DO  ;SPEICHERN NEUES ANGEBOT ;Save something new proposition 
	. . NEW YFORM,YVOR
	. . DO ^WWWSPEI("INANG",YANGEBOT,SATZ,1)
	. . SET ^INANG1(YM,YANGEBOT,1)=""
	. . ;
	. . ;
	. . DO  ;ANLEGEN PRODUKTHISTORIE ;put onto 
	. . . NEW YFORM,YVOR,SATZ1
	. . . SET $P(SATZ1,Y,2)=YKEY  ;ANFRAGENUMMER
	. . . SET $PIECE(SATZ1,Y,3)=$PIECE(YFELD,Y,5)  ;KUNDENNUMMER
	. . . IF $PIECE(YFELD,Y,45)'="" SET $PIECE(SATZ1,Y,4)=$$^WWWDATE($PIECE(YFELD,Y,45))  ;ANFRAGE VOM
	. . . SET $PIECE(SATZ1,Y,5)=$PIECE(YFELD,Y,47)  ;PROJEKTTEILEBEZEICHNUNG
	. . . SET $PIECE(SATZ1,Y,6)=$PIECE(YFELD,Y,14)  ;PROJEKTZEICHNUNGSNUMMER
	. . . SET $PIECE(SATZ1,Y,7)=$PIECE(YFELD,Y,49)  ;PROJEKTINDEXSTAND
	. . . SET $PIECE(SATZ1,Y,8)=$PIECE($PIECE(YFELD,Y,12),",",1)  ;ANSPRECHPARTNER EINKAUF - TELEFONNUMMER
	. . . SET $PIECE(SATZ1,Y,9)=$PIECE($PIECE(YFELD,Y,46),",",1)  ;ANSPRECHPARTNER EINKAUF - TELEFONNUMMER
	. . . SET $PIECE(SATZ1,Y,12)=+$H  ;ANGEBOTSDATUM
	. . . SET $PIECE(SATZ1,Y,15)=$PIECE(YFELD,Y,13)  ;ANFRAGENUMMER DES KUNDEN
	. . . SET $PIECE(SATZ1,Y,20)=$PIECE(YFELD,Y,14)  ;BEARBEITER
	. . . SET $PIECE(SATZ1,Y,52)=$PIECE(YFELD,Y,21)  ;ANFRAGEBEREICH
	. . . DO ^WWWSPEI("INGOEPRODHIST",YANGEBOT,SATZ1)
	. . . QUIT
	. . ;
	. . ;ANLEGEN EINER DEFAULTPOSITION IN INANGGOEP ;put onto unit within 
	. . DO
	. . . NEW POS,SATZ1,YFORM,YVOR
	. . . SET POS=1
	. . . SET $PIECE(SATZ1,Y,18)="DEFAULT"  ;POSITIONSBEZEICHNUNG ALS PFLICHTFELD IM CUSTOMIZING ;when 
	. . . SET $PIECE(SATZ1,Y,67)=+$H
	. . . SET $P(SATZ1,Y,68)=YBED
	. . . IF $PIECE(YFELD,Y,47)'="" SET $PIECE(SATZ1,Y,18)=$PIECE(YFELD,Y,47)
	. . . DO ^WWWSPEI("INANGGOEP",YANGEBOT_","_POS,SATZ1,1)
	. . . QUIT
	. . QUIT
	. QUIT
	;SETZEN DER ANGEBOTSADRESSEN IN INANGA ;typeset the within 
	IF YFELD(1)'="" DO
	. NEW SATZ
	. SET $PIECE(SATZ,Y,3)=$PIECE(YFELD(1),Y,3)  ;ANREDE ;salutation 
	. SET $PIECE(SATZ,Y,4)=$PIECE(YFELD(1),Y,4)  ;NAME1 
	. SET $PIECE(SATZ,Y,6)=$P(YFELD(1),Y,6)  ;NAME2
	. SET $PIECE(SATZ,Y,7)=$PIECE(YFELD(1),Y,7)  ;NAME3
	. SET $PIECE(SATZ,Y,10)=$PIECE(YFELD(1),Y,10)  ;STRASSE
	. SET $PIECE(SATZ,Y,11)=$PIECE(YFELD(1),Y,11)  ;POSTFACH
	. SET $PIECE(SATZ,Y,12)=$PIECE(YFELD(1),Y,12)  ;PLZ(STRASSE)
	. SET $PIECE(SATZ,Y,13)=$PIECE(YFELD(1),Y,13)  ;PLZ(POSTFACH)
	. ;SET $PIECE(SATZ,Y,15)=+$P(YFELD(1),Y,15)  ;BELEGVERSAND VIA; LEER WEIL IM ANGEBOT
	. SET $PIECE(SATZ,Y,16)=$PIECE(YFELD(1),Y,16)  ;ORTSBEZEICHNUNG
	. SET $PIECE(SATZ,Y,17)=$PIECE(YFELD(1),Y,17)  ;LAND ;rural 
	. SET $PIECE(SATZ,Y,19)=$PIECE(YFELD(1),Y,19)  ;BRIEFANREDE
	. SET $PIECE(SATZ,Y,20)=$PIECE(YFELD(1),Y,20)  ;TELEFON
	. SET $PIECE(SATZ,Y,21)=$PIECE(YFELD(1),Y,21)  ;TELEFON PRIVAT ;private 
	. SET $PIECE(SATZ,Y,22)=$PIECE(YFELD(1),Y,22)  ;TELEFAX
	. SET $PIECE(SATZ,Y,24)=$PIECE(YFELD(1),Y,24)  ;E-MAIL
	. SET $PIECE(SATZ,Y,62)=+$H  ;ERFASSSUNGSDATUM
	. SET $PIECE(SATZ,Y,63)=YBED  ;ERFASSUNGSMITARBEITER
	. SET $PIECE(SATZ,Y,92)=$PIECE(YFELD,Y,12)_"/ "_$PIECE(YFELD,Y,46)  ;ANSPRECHPARTNER EINKAUF/TECHNIK
	. IF $PIECE(SATZ,Y,92)="" SET $PIECE(SATZ,Y,92)=$PIECE(YFELD(1),Y,92)  ;AUSKUNDENSTAMM, WENN NICHT IM ANFRAGE
	. DO ^WWWSPEI("INANGA",YANGEBOT_","_1,SATZ,1)
	. QUIT
	;LINK ZUM NEUEN ANGEBOT ;proposition 
	DO
	. NEW YLINK
	. DO  ;LINK
	. . NEW YFORM,YKEY,YI,YBACK
	. . SET YFORM="INANGGOE"
	. . SET YBACK="INKUNDEANFR,"
	. . SET YLINK=""
	. . SET YI=YAKTION_"EP=WWWFORM&YFORM=INANGGOE&YKEY="_YANGEBOT  ;_"&YBACK=INKUNDEANFR,"
	. . DO VAR^WWWCGI
	. . SET YLINK=YI
	. . QUIT
	. DO ^WWWINFO($$^WWWTEXT(33136)_" ("_YANGEBOT_")",0,YLINK)  ;Neues angelegtes Angebot ;something new Offer 
	. QUIT
	QUIT
]]></Routine>
</Export>