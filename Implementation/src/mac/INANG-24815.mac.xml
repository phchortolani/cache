<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INANG" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INANG
#include COMSYS
#include INConst
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		ANZEIGE ARTIKEL ZUR ANGEBOTSERSTELLUNG
	;
	; ANZEIGE DER ARTIKEL ZUR AUSWAHL
	; DIE AUSWAHL DES ARTIKELS ERFOLGT, WENN EINE MENGE EINGETRAGEN WIRD
	;
	; WENN EINE MENGE AUSGEWÄHLT WURDE SPEICHERN DER ARTIKEL IN EINER POSITION
	;
	; GGF. IN ^INAUF ÄNDERN
	;------------------------------------------------------------------
	;		INDICATE ARTICLES FOR OFFER GENERATION
	;
	; show the item SELECTION
	; THE SELECTION OF THE ARTICLE TAKES PLACE, IF A QUANTITY IS REGISTERED
	; 
	; IF A QUANTITY WAS SELECTED save the item IN A line
	; if necessary change in ^INAUF
	;------------------------------------------------------------------
	; 
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 02-Nov-2010	shobby	SR17599: Removed call to INARTHIST
	; 11-Jul-2007	GRF		SR15558: Doco
	; 30-Aug-2006	GRF		SR12027: Identify INARTK fields; objINVORG; quits;
	; 						reuse ART and POSP1(1) rather than extracting pieces;
	; 						idxSupplier for index loop; naked references;
	; 						simplify table text; $$^WWWUMLAU not required.
	; 14-Oct-2005	Frank	SR13505 : Creating another offer item with the same
	; 						item number is now possible. The warning message is
	; 						still being shown.
	; 24-Jun-2005	GRF		Removed redundant tests for LIEF'=""; simplify long lists
	; 						of field numbers
	; 30-May-2005	RobertW	SR12056: Attempt at Performance Increase
	; 27.10.2000	DT
	;-------------------------------------------------------------------------------
	;	SATZ		objINANGP
	;	YFELD		objINANGP
	;-------------------------------------------------------------------------------
	;SET KUNDE=$GET(KUNDE)  ;AUSGESCHALTET DA NEU AUS DATENSATZ;FIS;12.12.03
	SET %("VAR","YKEY")  = $PIECE($TRANSLATE(YKEY,""""),",",1)
	SET %("VAR","YFKEY") = $PIECE($TRANSLATE(YFKEY,""""),",",1)
	
	SET YANGEBOT=$PIECE($TRANSLATE(YKEY,""""),",",1)
	IF YANGEBOT=""                   QUIT  ;KEIN ANGEBOT ;no quote 
	IF '$DATA(^INANG(YM,YANGEBOT,1)) QUIT  ;KEIN ANGEBOT ;no quote 
	
	SET ARTIKEL=""  ;AUS ARTIKELANLAGE ;out of 
	
	SET KUNDE=""
	IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=0 SET KUNDE=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,1)
	
	; initialise variables AFTER YKEY and YFKEY used
	new ANG,ANGDAT,ANGMG,ANZM,ART,ART1,GUELTIG,GUEDAT,MENGE,NAME
	new objINVORG,POSP,POPSP1,Q,SATZ,SUCH
	new WAGR,YA,YKEY,YFKEY,YMNG,YPOS,YPOSMANU,YPREISFIX,YVOR
	
	set objINVORG = $get(^INVORG(YM,YM,1))          ; 30-Aug-2006
	
	;IF YANGEBOT'="" DO   ;DURCH ANGEBOTSERFASSUNG!?
	;. SET YA=$PIECE($GET(^INANG1(YM,YANGEBOT,1)),Y,1)  ;ANGEBOTSHINWEIS (EIGEN/LIEFERANT/KUNDENNAME)
	;. IF YA'="" SET $PIECE(^INANG(YM,YANGEBOT,1),Y,13)=YA
	
	IF $FIND($EXTRACT(YAUSWAHL,2,99),"#") DO  ;SCHNELLERFASSUNG MIT + UND #;TYBD;12,10,2004;
	. QUIT:$PIECE($EXTRACT(YAUSWAHL,2,99),"#",1)=""
	. QUIT:+$PIECE($EXTRACT(YAUSWAHL,2,99),"#",2)=0
	. SET YPOSMANU=+$PIECE($EXTRACT(YAUSWAHL,2,99),"#",2)
	. SET YAUSWAHL=$EXTRACT(YAUSWAHL)_$PIECE($EXTRACT(YAUSWAHL,2,99),"#",1)
	
	IF $FIND($EXTRACT(YAUSWAHL,2,99),"+") DO  ;SCHNELLERFASSUNG MIT + ;by means of 
	. QUIT:$PIECE($EXTRACT(YAUSWAHL,2,99),"+",1)=""
	. IF $ORDER(^INARTs(YM,3,$$^WWWUMLAU($PIECE($EXTRACT(YAUSWAHL,2,99),"+",1),1),""))'="" SET $PIECE(YAUSWAHL,"+",1)="#"_$ORDER(^INARTs(YM,3,$$^WWWUMLAU($PIECE($EXTRACT(YAUSWAHL,2,99),"+",1),1),""))
	. QUIT:'$DATA(^INART(YM,$PIECE($EXTRACT(YAUSWAHL,2,99),"+",1)))
	. QUIT:+$PIECE($EXTRACT(YAUSWAHL,2,99),"+",2)=0
	. SET YMNG="YMNG" FOR  SET YMNG=$ORDER(%(YQUERY,YMNG)) QUIT:$EXTRACT(YMNG,1,4)'="YMNG"  KILL %(YQUERY,YMNG)  ;LÖSCHEN DER ALTEN EINTRÄGE ;Delete the 
	. SET %(YQUERY,"YMNG"_$PIECE($EXTRACT(YAUSWAHL,2,99),"+",1))=$PIECE($EXTRACT(YAUSWAHL,2,99),"+",2)
	. SET %(YQUERY,"YGM"_$PIECE($EXTRACT(YAUSWAHL,2,99),"+",1))=$PIECE($EXTRACT(YAUSWAHL,2,99),"+",3)
	. SET YAUSWAHL=""  ;KEINE SUCHE MEHR ;no search more 
	
	IF $GET(%(YQUERY,"ITEMS"))'="" DO  ;SONDERFELDER AUS WWW2 ;out of 
	. SET %(YQUERY,"YMNG"_$GET(%(YQUERY,"ITEMS")))=$GET(%(YQUERY,"ITEMSQ"))
	. SET %(YQUERY,"YGM"_$GET(%(YQUERY,"ITEMSG")))=$GET(%(YQUERY,"ITEMSGQ"))
	
	DO ^INKUNDESALDO(KUNDE)     ;FAN;SALDO INFO ANZEIGEN AB;06.07.04;26045
	
	;ARTIKELAUSWAHL / ANLEGEN DER POSITIONEN ;put onto the 
	SET YMNG="YMNG"
	FOR  SET YMNG=$ORDER(%(YQUERY,YMNG)) QUIT:$EXTRACT(YMNG,1,4)'="YMNG"  DO   ;ALLE MENGENFELDER LESEN ;read 
	. NEW YFORM
	. SET YFORM="INANGP"  ;POSITIONEN
	. QUIT:$TRANSLATE($GET(%(YQUERY,YMNG)),",. ")=""        ;KEINE MENGE EINGETRAGEN ;no quantity regd. 
	. FOR YPOS=1:1 QUIT:'$DATA(^INANGP(YM,YANGEBOT,YPOS))   ;NÄCHSTE POSITIONSNUMMER ;next 
	. IF +$GET(YPOSMANU)'=0 SET YPOS=YPOSMANU               ;TYBD;12,10,2004
	. IF YPOS="" SET YPOS=1
	. IF $DATA(^INANGP(YM,YANGEBOT,YPOS)) SET YPOS=$$^WWWNEXT1("INANGP",YANGEBOT,2)
	. ;
	. ;PRUEFEN FALSCHE POSITION (DOPPEL SAVE ODER RELOAD)
	. SET Q     = 0
	. SET YFERT = 0
	. SET POSP=""
	. FOR  SET POSP=$ORDER(^INANGP(YM,YANGEBOT,POSP)) QUIT:POSP=""  DO  QUIT:Q=1
	. . SET POSP1 = $GET(^INANGP(YM,YANGEBOT,POSP,1))
	. . SET ART   = $EXTRACT(YMNG,5,99)         ;ARTIKEL ;item 
	. . SET POSP1(1) = $PIECE(POSP1,Y,4)        ;ARTIKEL ;item from quote
	. . ;
	. . ;NUR EIN FERTIGUNGSARTIKEL BEI EIGENFERTIGUNG;ULM, 16.10.2002    ; 30-Aug-2006
	. . IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=1 DO
	. . . IF ($PIECE($GET(^INART(YM,POSP1(1),1)),Y,26)=3) || ($PIECE($GET(^INART(YM,POSP1(1),1)),Y,26)=0) DO
	. . . . IF ($PIECE($GET(^INART(YM,ART,1)),Y,26)=3) || ($PIECE($GET(^INART(YM,ART,1)),Y,26)=0) DO
	. . . . . ;EIGENFERTIGUNGSAUFTRAG, EIGENFERTIGUNGSARTIKEL, KEINE UNTERTEILE (WERKZEUGE-GOEBEL)
	. . . . . ;	D109	$$$INVORGOnlyOneProductiononceOrde() 
	. . . . . IF $DATA(^INARTT(YM,ART,1)) IF $$$INVORGOnlyOneProductiononceOrde(objINVORG)=$$$YES SET YFERT=1
	. . ;
	. . QUIT:ART'=POSP1(1)                    ;ARTIKEL NICHT GLEICH ;item Not without delay 
	. . QUIT:+$PIECE(POSP1,Y,22)'=+$HOROLOG   ;ANDERER TAG ;other TAG 
	. . NEW TRAKT 
	. . SET TRAKT=$PIECE(POSP1,Y,21)          ;transaktionsnummer
	. . QUIT:+TRAKT=0
	. . IF YUSER'=$PIECE(TRAKT,"/",2) QUIT    ;ANDERER USER ;other 
	. . IF YTRAKT'>(TRAKT+2) DO
	. . .; SET Q=1 ;SR13505  ;DOPPELSAVE FALSCH  (DURCH RELOAD) ;wrong 
	. . . ;WRITE "<script language=""JavaScript"" type='text/javascript'>alert('"_$$^WWWTEXT(33909,,1)_"');</script>"  ;möglicherweise bereits angelegt
	. . . $$$StartScript()
	. . . WRITE "alert('"_$$^WWWTEXT(33909,,1)_"');"  ;möglicherweise bereits angelegt
	. . . $$$EndScript()
	. ;
	. ;PRUEFEN OB ARTIKEL IN BEARBEITUNG IST;25779;FIS;17.06.04
	. IF Q'=1 DO
	. . NEW JOBNR
	. . SET JOBNR=""
	. . FOR  SET JOBNR=$ORDER(^INARTJOB(YM,JOBNR)) QUIT:JOBNR=""  DO  QUIT:Q=1  ;PRÜFEN ARTIKELAUFBEREITUNG IM HINTERGRUND ;sift foil 
	. . . SET JOBTYPE=$GET(^INARTJOB(YM,JOBNR,1))
	. . . IF JOBTYPE'="" IF $FIND(JOBTYPE,"INART") DO
	. . . . SET Q=1
	. . . . ;DO MSG^WWW013MSG(YBED,$$^WWWTEXT(33720),)   ;NICHT MÖGLICH, DA ARTIKELAUFBEREITUNG (INARTXL,INARTNEU,...) IM HINTERGRUND
	. . . . WRITE "<script language=""JavaScript"" type='text/javascript'>alert('"_$$^WWWTEXT(33720,,1)_"');</script>"  ;NICHT MÖGLICH, DA ARTIKELAUFBEREITUNG (INARTXL,INARTNEU,...) IM HINTERGRUND
	. . . . $$$StartScript()
	. . . . WRITE "alert('"_$$^WWWTEXT(33720,,1)_"');"  ;NICHT MÖGLICH, DA ARTIKELAUFBEREITUNG (INARTXL,INARTNEU,...) IM HINTERGRUND
	. . . . $$$EndScript()
	. ;
	. QUIT:Q=1
	. IF YFERT=1 WRITE "<FONT COLOR="_YRED_">"_$$^WWWTEXT(33223) QUIT
	. ;
	. SET MENGE=+$TRANSLATE($GET(%(YQUERY,YMNG)),",",".")  ;ZAHLENFORMAT
	. SET ART=$EXTRACT(YMNG,5,99)  ;ARTIKELNUMMER BESTANDTEIL DER YMNG VARIABEL ;ingredient the 
	. QUIT:ART=""
	. QUIT:'$DATA(^INART(YM,ART,1))  ;ARTIKEL NICHT VORHANDEN ;item Not on hand 
	. SET SATZ1=$GET(^INART(YM,ART,1))  ;ARTIKELDATEN
	. SET SATZ=""
	. IF $PIECE(SATZ1,Y,26)=5  QUIT  ;PHANTOMARTIKEL
	. IF $PIECE(SATZ1,Y,26)=7  QUIT  ;KONFIGURATIONSARTIKEL
	. ;
	. ;ULM: 16.10.2002 - ERWEITERUNG UM _FREE-FELDER ;amplification to 
	. ;FOR YA=1,2,3,10,14,15,16,17,26,30,31,32,33,36,37,38,40,41,42,43,44,45,47,48,49,50,53,54,55,57,58,59,62,66,68,70,71,73,74,75,126,130,131,132,134,136,158,166,171,172,178,179,180,181,182,183,184,185,191,192,208 SET $PIECE(SATZ,Y,YA)=$PIECE(SATZ1,Y,YA)   ;DATEN AUS ARTIKEL ÜBERTRAGEN
	. ;FOR YA=1,2,3,10,12,14,15,16,17,26,30,31,32,33,36,37,38,40,41,42,43,44,45,47,48,49,50,53,54,55,56,57,58,59,62,66,68,70,71,73,74,75,126,130,131,132,134,136,138,158,166,171,172,191,192,210,211,208,273,274,275,276:1:300,301,309,336:1:345 SET $PIECE(SATZ,Y,YA)=$PIECE(SATZ1,Y,YA)    ;DATEN AUS ARTIKEL ÜBERTRAGEN;TYBD;7,10,2003;24370;;BEC;24591;FELD 210,211 ERGÄNTZT
	. ;FOR YA=1,2,3,10,12,14,15,16,17,26,30,31,32,33,36,37,38,40,41,42,43,44,45,47,48,49,50,53,54,55,56,57,58,59,62,66,68,70,71,73,74,75,126,130,131,132,134,136,138,158,166,171,172,191,192,210,211,208,273,274,275,276:1:300,301,309,336:1:345,356,381 SET $PIECE(SATZ,Y,YA)=$PIECE(SATZ1,Y,YA)    ;ERGÄNTZT 356;BEC;25600;12.05.04
	. FOR YA=1,2,3,10,12,14:1:17,26,30:1:33,36:1:38,40:1:45,47:1:50,53:1:59,62,66,68,70,71,73:1:75,126,130:1:132,134,136,138,158,166,171,172,191,192,210,211,208,273:1:301,309,336:1:345,356,381 DO
	. . SET $PIECE(SATZ,Y,YA)=$PIECE(SATZ1,Y,YA)    ;ERGÄNTZT 356;BEC;25600;12.05.04
	. FOR YA=178:1:181 IF $PIECE(SATZ1,Y,YA)=1   SET $PIECE(^INANG1(YM,YANGEBOT,1),Y,YA)=1  ;NEU BERECHNEN ;recent calculate 
	. FOR YA=182:1:185 IF +$PIECE(SATZ1,Y,YA)'=0 SET $PIECE(^INANG1(YM,YANGEBOT,1),Y,YA)=$PIECE(SATZ1,Y,YA),$PIECE(^INANG(YM,YANGEBOT,1),Y,YA)=$PIECE(SATZ1,Y,YA)   ;ÜBERTRAGEN PAUSCHALEBETRÄGE IN ZWISCHESPEICHER ;transport within 
	. ;
	. ;SET EINHEIT=""
	. ;IF $PIECE(SATZ,Y,40)'="" SET EINHEIT=$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(SATZ,Y,40),1)),Y,1)
	. IF $PIECE(SATZ1,Y,46)'="" SET $PIECE(SATZ,Y,40)=$PIECE(SATZ1,Y,46)  ;ANDERE VERKANGSEINHEIT ALS EINHEIT ;when unity 
	. SET $PIECE(SATZ,Y,5) =MENGE
	. SET $PIECE(SATZ,Y,39)=MENGE
	. SET $PIECE(SATZ,Y,4) =ART
	. ;SET $PIECE(SATZ,Y,47)=$P(SATZ,Y,47)*MENGE  ;+$P(SATZ,Y,71)  ;PREISVORGABE
	. SET $PIECE(SATZ,Y,47)=$PIECE(SATZ,Y,47)*(MENGE/$$^INQTYUNIT(ART))    ;+$P(SATZ,Y,71)  ;HERSTELLKOSTEN+RUESTPREIS  ;FIS;PREISEINHEIT;28.02.05;27123
	. ;IF +$PIECE(EINHEIT,"/",2)=0 SET $PIECE(SATZ,Y,47)=$PIECE(SATZ,Y,47)*MENGE  ;+$P(SATZ,Y,71)  ;HERSTELLKOSTEN+RUESTPREIS
	. ;IF +$PIECE(EINHEIT,"/",2)'=0 SET $PIECE(SATZ,Y,47)=$PIECE(SATZ,Y,47)*(MENGE/$PIECE(EINHEIT,"/",2))  ;+$P(SATZ,Y,71)  ;HERSTELLKOSTEN+RUESTPREIS
	. SET $PIECE(SATZ,Y,74)=$PIECE(SATZ,Y,74)*$$^INPROLOS(ART,MENGE)   ;WERKZEUGKOSTEN 
	. SET $PIECE(SATZ,Y,75)=$PIECE(SATZ,Y,75)*$$^INPROLOS(ART,MENGE)   ;SONSTIGEKOSTEN 
	. ;
	. ;POSITIONSGRUPPE AUS VORHERIGER POS ÜBERNEHMEN ;out of assume 
	. ;IF YPOS>1 DO
	. ;.NEW POSX
	. ;.SET POSX=$ORDER(^INANGP(YM,YANGEBOT,YPOS),-1)
	. ;.IF POSX=""!(POSX=YPOS) QUIT
	. ;.SET $PIECE(SATZ,Y,247)=$PIECE($GET(^INANGP(YM,YANGEBOT,POSX,1)),Y,247)
	. ;
	. ;POSITIONSGRUPPE AUS VORHERIGER POS ÜBERNEHMEN ;out of assume 
	. IF YPOS>1 DO
	. . NEW POSX,YQ,ARTX,ARTXX
	. . SET POSX=$ORDER(^INANGP(YM,YANGEBOT,YPOS),-1)
	. . IF (POSX="")||(POSX=YPOS) QUIT
	. . IF $PIECE($GET(^INANGP(YM,YANGEBOT,POSX,1)),Y,26)=7 QUIT  ;NICHT WENN KONFIGURATIONSARTIKEL;FIS;23996;18.07.03
	. . SET YQ=0
	. . SET ARTX=$PIECE($GET(^INANGP(YM,YANGEBOT,POSX,1)),Y,4)
	. . IF ARTX'="" IF $PIECE($GET(^INART(YM,ARTX,1)),Y,26)=7 QUIT  ;NICHT WENN KONFIGURATIONSARTIKEL;FIS ;Not when 
	. . IF ARTX'="" IF $DATA(^INARTTs(YM,1,ARTX)) DO
	. . . SET ARTXX=$ORDER(^INARTTs(YM,1,ARTX,""))
	. . . IF ARTXX'="" IF $PIECE($GET(^INART(YM,ARTXX,1)),Y,26)=7 SET YQ=1  ;NICHT WENN KONFIGURATIONSARTIKEL;FIS ;Not when 
	. . ;
	. . QUIT:YQ=1
	. . SET $PIECE(SATZ,Y,247)=$PIECE($GET(^INANGP(YM,YANGEBOT,POSX,1)),Y,247)
	. ;
	. ;POSITIONSGRUPPE AUS ARTIKELKONFIGURATION ;out of 
	. IF $DATA(%(YQUERY,"YPOSGRUP"_ART)) DO  ;FIS;01.04.03;23155;KONFIGURATIONSARTIKEL
	. . NEW GRP
	. . SET GRP=$GET(%(YQUERY,"YPOSGRUP"_ART))
	. . IF GRP'="" SET GRP=GRP_" "_$PIECE($GET(^INART(YM,GRP,1)),Y,1)
	. . SET $PIECE(SATZ,Y,247)=GRP
	. ;
	. DO   ;WEM;24892;28.01.2004;RAHMENVERTRAGSNUMMER SETZEN
	. . SET ADR=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,1)
	. . IF ADR="" SET ADR=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,12)
	. . QUIT:ADR=""
	. . IF '$DATA(^INRAHMEN(YM,ADR)) IF '$DATA(^INRAHMENK(YM,ADR)) QUIT
	. . NEW RV 
	. . SET RV=$$^INARTRAHMEN(ADR,1)
	. . SET $PIECE(SATZ,Y,320)=$GET(^WWWSOR(YUSER,"RAHMEN",ART))
	. . KILL ^WWWSOR(YUSER,"RAHMEN")
	. ;
	. IF $EXTRACT($GET(%(YQUERY,"YSERI"_ART)))="+" SET %(YQUERY,"YSERI"_ART)=$$^WWWNEXT("SERIENNR")   ;SERIENNUMMER NEU ;recent 
	. IF $GET(%(YQUERY,"YSERI"_ART))'="" SET $PIECE(SATZ,Y,56)=$GET(%(YQUERY,"YSERI"_ART))   ;SERIENNUMMER
	. IF +$GET(%(YQUERY,"YALTN"_ART))'=0 SET $PIECE(SATZ,Y,11)=1   ;ALTERNATIVE ANGEBOTSPOSITION ;option 
	. ;
	. SET KATALOG=0  ;1=KATALOGARTIKEL DANN IMMER BESTELLEN!! ;constantly 
	. ;IF $$^WWWUPER($TRANSLATE($PIECE(SATZ1,Y,1,14),Y_",.- 1234567890_#'+*`?=)(/&%$§!"))="KATALOGARTIKEL" SET KATALOG=1   ;SET $PIECE(SATZ,Y,1)=""
	. ;IF $$^WWWUPER($TRANSLATE($PIECE(SATZ1,Y,1,14),Y_",.- 1234567890_#'+*`?=)(/&%$§!"))="CATALOGITEM"    SET KATALOG=1   ;SET $PIECE(SATZ,Y,1)=""
	. IF $zconvert($TRANSLATE($PIECE(SATZ1,Y,1,14),Y_",.- 1234567890_#'+*`?=)(/&%$§!"),"U")="KATALOGARTIKEL" SET KATALOG=1 ;SET $PIECE(SATZ,Y,1)=""
	. IF $zconvert($TRANSLATE($PIECE(SATZ1,Y,1,14),Y_",.- 1234567890_#'+*`?=)(/&%$§!"),"U")="CATALOGITEM"    SET KATALOG=1 ;SET $PIECE(SATZ,Y,1)=""
	. ;
	. IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=0 DO   ;KUNDENAUFTRAG;FIS;09.07.04;25940
	. . SET $PIECE(SATZ,Y,360)=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,1)  ;KUNDENNUMMER
	. ;
	. IF ($PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=2)||(KATALOG=1) SET $PIECE(SATZ,Y,7)=1  ;BESTELLEN BEI  ANFRAGE ;book next to 
	. DO  ;PRUEFEN PREISE
	. . SET $PIECE(SATZ,Y,12)=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,12)  ;BEI LIEFERANT ;next to supplier 
	. . NEW LIEF
	. . SET LIEF=$PIECE(SATZ,Y,12)   ;KONDITIONEN FÜR BESTELLUNG ;terms of payment to sales order 
	. . IF LIEF="" SET LIEF=$ORDER(^INARTK(YM,ART,""))
	. . QUIT:LIEF=""   ;KEIN LIEFERANT BEKANNT ;no supplier
	. . ; Removed tests for LIEF'="" in next 2 lines - redundant;GRF
	. . SET ^INANGPK(YM,YANGEBOT,YPOS,1)=$GET(^INARTK(YM,ART,LIEF,1))
	. . IF '$DATA(^INARTK(YM,ART,LIEF,1)) DO               ;KONDITION AUS LIEFERANTENSTAMM ;out of 
	. . . NEW KOND,KOND1
	. . . SET KOND=$PIECE($GET(^INLIEF(YM,LIEF,1)),Y,56)   ;LIEFERANTENKONDITION
	. . . QUIT:KOND=""
	. . . SET KOND1=$GET(^INKOND(YM,KOND,1))
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,7) =$PIECE(KOND1,Y,3)   ;SKONTO
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,9) =$PIECE(KOND1,Y,2)   ;TAGE
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,10)=$PIECE(KOND1,Y,4)   ;NETTO
	. . ;
	. . NEW WG,YI
	. . SET WG=$PIECE($GET(^INART(YM,ART,1)),Y,30)  ;WARENGRUPPE
	. . ;
	. . IF WG'="" IF '$DATA(^INARTK(YM,ART,LIEF)) IF $DATA(^INLIEFK(YM,LIEF,WG,1)) DO   ;KONDITION  AUS LIEFERANT 
	. . . SET KOND1=$GET(^INLIEFK(YM,LIEF,WG,1))
	. . . FOR YI=2:1:6,51:1:53 SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,YI)=$PIECE(KOND1,Y,YI)   ;RABATTE
	. . . SET KOND=$PIECE(KOND1,Y,7)
	. . . QUIT:KOND=""
	. . . SET KOND1=$GET(^INKOND(YM,KOND,1))
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,7) =$PIECE(KOND1,Y,3)  ;SKONTO
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,9) =$PIECE(KOND1,Y,2)  ;TAGE
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,10)=$PIECE(KOND1,Y,4)  ;NETTO
	. . ;
	. . IF LIEF'="" IF $GET(KUNDE)'="" DO
	. . . ;VK=EK INKL. ÜBERNAHME DER RABATTE;FIS;29.02.05;27351
	. . . ;	D202		$$$INVORGSaleCost()
	. . . ;	D213		$$$INVORGApplyInvDiscountsToOrder()
	. . . IF ($$$INVORGSaleCost(objINVORG)=$$$YES) && ($$$INVORGApplyInvDiscountsToOrder(objINVORG)=$$$YES) DO
	. . . . SET KOND1=$GET(^INAUFPK(YM,YANGEBOT,YPOS,1))
	. . . . QUIT:KOND1=""
	. . . . SET YPREISFIX=$PIECE(KOND1,Y,47)  ;FIXER VERKAUFSPREIS
	. . . . FOR YI=2:1:6,51:1:53 DO
	. . . . . IF +$PIECE(KOND1,Y,2)'=0  SET $PIECE(SATZ,Y,122)=$PIECE(KOND1,Y,2)   ;RABATT 1
	. . . . . IF +$PIECE(KOND1,Y,3)'=0  SET $PIECE(SATZ,Y,128)=$PIECE(KOND1,Y,3)   ;RABATT 2
	. . . . . IF +$PIECE(KOND1,Y,4)'=0  SET $PIECE(SATZ,Y,212)=$PIECE(KOND1,Y,4)   ;RABATT 3 ;TYBD;19.2,2005;27277;GEM
	. . . . . IF +$PIECE(KOND1,Y,5)'=0  SET $PIECE(SATZ,Y,214)=$PIECE(KOND1,Y,5)   ;AUF/ABSCHLAG % ;TYBD;19.2,2005;27277;GEM
	. . . . . IF +$PIECE(KOND1,Y,6)'=0  SET $PIECE(SATZ,Y,211)=$PIECE(KOND1,Y,6)   ;AUF/ABSCHLAG BETRAG
	. . . . . IF $PIECE(KOND1,Y,51)'="" SET $PIECE(SATZ,Y,125)=$PIECE(KOND1,Y,51)  ;TEXT RABATT 1
	. . . . . IF $PIECE(KOND1,Y,52)'="" SET $PIECE(SATZ,Y,129)=$PIECE(KOND1,Y,52)  ;TEXT RABATT 2
	. . . . . IF $PIECE(KOND1,Y,53)'="" SET $PIECE(SATZ,Y,213)=$PIECE(KOND1,Y,53)  ;TEXT RABATT 3  ;FIS;28.02.05
	. . . ;
	. . . NEW KUNDELIEF,RAHMEN,RAHMEN1,WG
	. . . SET KUNDELIEF=$GET(^INKUNDELIEF(YM,KUNDE,LIEF,1))
	. . . QUIT:KUNDELIEF=""
	. . . SET RAHMEN=$PIECE(KUNDELIEF,Y,34)
	. . . QUIT:RAHMEN=""
	. . . ;
	. . . ; vvvvv replace          30-Aug-2006
	. . . ;SET RAHMEN1=""
	. . . ;SET WG=$PIECE($GET(^INARTK(YM,ART,LIEF,1)),Y,80)
	. . . ;IF $DATA(^INRAHMENGROUP(YM,LIEF,RAHMEN,0,1)) SET RAHMEN1=^(1)
	. . . ;IF WG'="" IF $DATA(^INRAHMENGROUP(YM,LIEF,RAHMEN,WG,1)) SET RAHMEN1=^(1)
	. . . ;IF RAHMEN1="" DO
	. . . ;. SET RAHMEN(1)=$ORDER(^INRAHMENGROUP(YM,LIEF,RAHMEN,"")) 
	. . . ;. IF RAHMEN(1)'="" IF $DATA(^INRAHMENGROUP(YM,LIEF,RAHMEN,RAHMEN(1),1)) SET RAHMEN1=^(1)
	. . . ; vvvvv with
	. . . SET RAHMEN1=""
	. . . SET WG=$$$INARTKSuppliersCatalogGroup($GET(^INARTK(YM,ART,LIEF,1)))
	. . . IF WG=""  SET RAHMEN1 = $get(^INRAHMENGROUP(YM,LIEF,RAHMEN,0,1))
	. . . IF WG'="" SET RAHMEN1 = $get(^INRAHMENGROUP(YM,LIEF,RAHMEN,WG,1))
	. . . IF RAHMEN1="" DO
	. . . . SET RAHMEN(1) = $ORDER(^INRAHMENGROUP(YM,LIEF,RAHMEN,"")) 
	. . . . IF RAHMEN(1)'="" SET RAHMEN1 = $get(^INRAHMENGROUP(YM,LIEF,RAHMEN,RAHMEN(1),1))
	. . . ; ^^^^^
	. . . QUIT:RAHMEN1=""
	. . . ;
	. . . FOR YI=2:1:6,51:1:53 IF $PIECE(RAHMEN1,Y,YI)'="" SET $PIECE(^INAUFPK(YM,YANGEBOT,YPOS,1),Y,YI)=$PIECE(RAHMEN1,Y,YI)   ;RABATTE
	. . . IF $$$INVORGSaleCost(objINVORG)=$$$YES DO  ;EK=VK;TYBD;2,1,2005
	. . . . IF +$PIECE(RAHMEN1,Y,2)'=0  SET $PIECE(SATZ,Y,122)=$PIECE(RAHMEN1,Y,2)   ;RABATT 1
	. . . . IF +$PIECE(RAHMEN1,Y,3)'=0  SET $PIECE(SATZ,Y,128)=$PIECE(RAHMEN1,Y,3)   ;RABATT 2
	. . . . IF +$PIECE(RAHMEN1,Y,4)'=0  SET $PIECE(SATZ,Y,212)=$PIECE(RAHMEN1,Y,4)   ;RABATT 3 ;TYBD;19.2,2005;27277;GEM
	. . . . IF +$PIECE(RAHMEN1,Y,5)'=0  SET $PIECE(SATZ,Y,214)=$PIECE(RAHMEN1,Y,5)   ;AUF/ABSCHLAG % ;TYBD;19.2,2005;27277;GEM
	. . . . IF +$PIECE(RAHMEN1,Y,6)'=0  SET $PIECE(SATZ,Y,211)=$PIECE(RAHMEN1,Y,6)   ;AUF/ABSCHLAG BETRAG
	. . . . IF $PIECE(RAHMEN1,Y,51)'="" SET $PIECE(SATZ,Y,125)=$PIECE(RAHMEN1,Y,51)  ;TEXT RABATT 1
	. . . . IF $PIECE(RAHMEN1,Y,52)'="" SET $PIECE(SATZ,Y,129)=$PIECE(RAHMEN1,Y,52)  ;TEXT RABATT 2
	. . . . IF $PIECE(RAHMEN1,Y,53)'="" SET $PIECE(SATZ,Y,213)=$PIECE(RAHMEN1,Y,53)  ;TEXT RABATT 3
	. . . ;
	. . . SET KOND=$PIECE(RAHMEN1,Y,7)
	. . . QUIT:KOND=""
	. . . SET KOND1=$GET(^INKOND(YM,KOND,1))
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,7)=$PIECE(KOND1,Y,3)  ;SKONTO
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,9)=$PIECE(KOND1,Y,2)  ;TAGE
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,10)=$PIECE(KOND1,Y,4) ;NETTO
	. . ;
	. . IF LIEF'="" IF $GET(KUNDE)="" IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=2 DO
	. . . NEW RAHMEN,RAHMEN1,WG
	. . . SET RAHMEN=$ORDER(^INRAHMENGROUP(YM,LIEF,""),-1)
	. . . QUIT:RAHMEN=""
	. . . ;
	. . . ; vvvvv replace          30-Aug-2006
	. . . ;SET RAHMEN1=""
	. . . ;SET WG=$PIECE($GET(^INARTK(YM,ART,LIEF,1)),Y,80)
	. . . ;IF $DATA(^INRAHMENGROUP(YM,LIEF,RAHMEN,0,1)) SET RAHMEN1=^(1)
	. . . ;IF WG'="" IF $DATA(^INRAHMENGROUP(YM,LIEF,RAHMEN,WG,1)) SET RAHMEN1=^(1)
	. . . ;IF RAHMEN1="" DO
	. . . ;. SET RAHMEN(1)=$ORDER(^INRAHMENGROUP(YM,LIEF,RAHMEN,"")) 
	. . . ;. IF RAHMEN(1)'="" IF $DATA(^INRAHMENGROUP(YM,LIEF,RAHMEN,RAHMEN(1),1)) SET RAHMEN1=^(1)
	. . . ; vvvvv with
	. . . SET RAHMEN1=""
	. . . SET WG=$$$INARTKSuppliersCatalogGroup($GET(^INARTK(YM,ART,LIEF,1)))
	. . . IF WG=""  SET RAHMEN1 = $get(^INRAHMENGROUP(YM,LIEF,RAHMEN,0,1))
	. . . IF WG'="" SET RAHMEN1 = $get(^INRAHMENGROUP(YM,LIEF,RAHMEN,WG,1))
	. . . IF RAHMEN1="" DO
	. . . . SET RAHMEN(1) = $ORDER(^INRAHMENGROUP(YM,LIEF,RAHMEN,"")) 
	. . . . IF RAHMEN(1)'="" SET RAHMEN1 = $get(^INRAHMENGROUP(YM,LIEF,RAHMEN,RAHMEN(1),1))
	. . . ; ^^^^^
	. . . QUIT:RAHMEN1=""
	. . . ;
	. . . FOR YI=2:1:6,51:1:53 IF +$PIECE(RAHMEN1,Y,YI)'="" SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,YI)=$PIECE(RAHMEN1,Y,YI)   ;RABATTE
	. . . SET KOND=$PIECE(RAHMEN1,Y,7)
	. . . QUIT:KOND=""
	. . . SET KOND1=$GET(^INKOND(YM,KOND,1))
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,7)=$PIECE(KOND1,Y,3)    ;SKONTO
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,9)=$PIECE(KOND1,Y,2)    ;TAGE
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,10)=$PIECE(KOND1,Y,4)   ;NETTO
	. . ;
	. . IF LIEF'="" IF ART'="" IF $DATA(^INARTKR(YM,ART,LIEF)) DO   ;MENGENRABATTE EINKAUF
	. . . NEW RABATT,RABATT1
	. . . SET RABATT1=""
	. . . SET RABATT1=$GET(^INARTKR(YM,ART,LIEF,+MENGE,1))  ;GENAUE MENGEN ;shuffle 
	. . . IF RABATT1'="" SET RABATT=+MENGE
	. . . IF RABATT1=""  SET RABATT=$ORDER(^INARTKR(YM,ART,LIEF,+MENGE),-1)  ;VORIGE STUFE ;step 
	. . . IF RABATT'=""  SET RABATT1=$GET(^INARTKR(YM,ART,LIEF,RABATT,1))
	. . . QUIT:RABATT1=""  ;KEIN RABATT ;no deduction 
	. . . IF $PIECE(RABATT1,Y,2)'="" QUIT:$PIECE(RABATT1,Y,2)>$HOROLOG   ;AB GÜLTIG ;Confirm. valuable 
	. . . IF $PIECE(RABATT1,Y,3)'="" QUIT:$PIECE(RABATT1,Y,3)<$HOROLOG   ;BIS GÜLTIG ;until valuable 
	. . . IF +$PIECE(RABATT1,Y,1)'=0 SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,4)=$PIECE(RABATT1,Y,1)  ;3.RABATT=MENGENRABATT
	. . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,53)=$$^WWWTEXT(32223)  ;3.RABATT=MENGENRABATT
	. . . IF +$PIECE(RABATT1,Y,4)'=0 SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,12)=$PIECE(RABATT1,Y,4)  ;WENN BETRAG ALS RABATT ;when Sum when deduction 
	. . ;
	. . IF $GET(%(YQUERY,"YGM"_ART))'="" DO  ;FIS;18.08.04;26293 ;25.08.04;26316 MIT FREMDWÄHRUNG
	. . . NEW PRICE,WHR,WHRF,NKOMMA
	. . . SET PRICE=$$^WWWTR(1,12,$PIECE($GET(%(YQUERY,"YGM"_ART)),"@",1))  ;UNIT PRICE
	. . . SET WHRF =$$^WWWTR(1,12,$PIECE($GET(%(YQUERY,"YGM"_ART)),"@",2))  ;EXCHANGE RATE ;instalment 
	. . . SET WHR=""
	. . . IF LIEF'="" SET WHR=$PIECE($GET(^INLIEF(YM,LIEF,1)),Y,51)
	. . . SET NKOMMA=$PIECE($GET(^INANGPK(YM,YANGEBOT,YPOS,1)),Y,25)
	. . . IF (+NKOMMA=0) || (NKOMMA>9) SET NKOMMA=2
	. . . IF WHR="" DO  ;OHNE FREMDWÄHRUNG ;without 
	. . . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,12)=$JUSTIFY(PRICE,0,NKOMMA)
	. . . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,47)=$JUSTIFY(PRICE,0,NKOMMA)
	. . . ;
	. . . IF WHR'="" DO  ;MIT FREMDWÄHRUNG ;by means of 
	. . . . ;IF WHRF="" SET WHRF=$PIECE(RABATT1,Y,78)
	. . . . IF WHRF="" SET WHRF=$PIECE($GET(^WWWWAE(0,WHR,1)),Y,5)
	. . . . IF WHRF="" SET WHRF=1
	. . . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,68)=$JUSTIFY(PRICE,0,NKOMMA)
	. . . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,12)=$JUSTIFY((PRICE*WHRF),0,NKOMMA)
	. . . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,47)=$JUSTIFY((PRICE*WHRF),0,NKOMMA)
	. . . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,78)=WHRF
	. . . . SET $PIECE(^INANGPK(YM,YANGEBOT,YPOS,1),Y,79)=+$HOROLOG
	. . . ;
	. . . SET %(YQUERY,"YGM"_ART)=""
	. . ;
	. . SET YFELD=$GET(^INANGPK(YM,YANGEBOT,YPOS,1))
	. . SET $PIECE(YFELD,Y,47)=$PIECE(YFELD,Y,12)   ;EINZELEK IN SELBSTKOSTENFELD ;within 
	. . SET $PIECE(YFELD,Y,16)=MENGE  ;STANDARDMENGE
	. . IF +$PIECE(YFELD,Y,41)'=0 SET $PIECE(YFELD,Y,16)=+$justify(MENGE*$PIECE(YFELD,Y,41),0,2)  ;UMRECNUNGSFAKTOR ;TYBD;9.5.2003
	. . SET $PIECE(YFELD,Y,12)=$PIECE(YFELD,Y,47)*$PIECE(YFELD,Y,16)/$$^INQTYUNIT(ART)  ;MENGE * PREIS ;quantity price 
	. . SET $PIECE(YFELD,Y,13)=$$^INNETTO(YFELD)  ;NETTOPREIS ERRECHNE
	. . SET ^INANGPK(YM,YANGEBOT,YPOS,1)=YFELD  ;SPEICHERN PREISE ;Save 
	. ;
	. IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=1 DO   ;EIGENANGEBOT ZU FERTIGUNG ;within 
	. . SET $PIECE(SATZ,Y,7)=3    ;FERTIGEN
	. ;
	. IF $PIECE(SATZ,Y,26)=2 DO   ;DIENSTLEISTUNG
	. . SET $PIECE(SATZ,Y,7)=4    ;WENN LEISTUNG DANN DIENSTLEISTUNG UND LEISTUNGSFÄHIG ;when performance And efficient 
	. . SET $PIECE(SATZ,Y,90)=1   ;WARE AUSLIEFERUNGSFÄHIG ;wares 
	. ;
	. IF $PIECE(SATZ,Y,26)=3 DO   ;EIGENBAU
	. . SET $PIECE(SATZ,Y,7)=3    ;WENN EIGENFERTIGUNG DANN EIGENFERTIGUNG ;when 
	. ;
	. IF $PIECE(SATZ,Y,26)=6 DO   ;PAUSCHALELEISUNG
	. . SET $PIECE(SATZ,Y,7)=4
	. . SET $PIECE(SATZ,Y,90)=1   ;WARE AUSLIEFERUNGSFÄHIG ;wares 
	. ;
	. IF $PIECE(SATZ,Y,26)=4 DO   ;KLEINTEILE
	. . SET $PIECE(SATZ,Y,7)=2    ;KLEINTEILE AUS LAGER ;out of stock location 
	. . SET $PIECE(SATZ,Y,90)=1   ;WARE AUSLIEFERUNGSFÄHIG ;wares 
	. ;
	. SET $PIECE(SATZ,Y,22)=$HOROLOG   ;ERFASST
	. SET $PIECE(SATZ,Y,21)=$GET(YTRAKT)_"/"_YUSER   ;TRANSAKTIONSNUMMER UND USER ;And 
	. SET $PIECE(SATZ,Y,23)=YBED   ;ERFASST
	. SET $PIECE(SATZ,Y,24)=""     ;ÄNDERUNG  ;alteration 
	. SET $PIECE(SATZ,Y,25)=""     ;MITARB
	. ;
	. ;SET $PIECE(SATZ,Y,116)=$PIECE(SATZ1,Y,86)  ;AUFSCHLAG
	. ;SET $PIECE(SATZ,Y,118)=$PIECE(SATZ1,Y,88)  ;VK
	. ;SET $PIECE(SATZ,Y,120)=$PIECE(SATZ1,Y,90)  ;PREISKZ
	. ;SET $PIECE(SATZ,Y,124)=$PIECE(SATZ1,Y,92)  ; PROV
	. ;
	. ;IF KUNDE'="" IF $DATA(^INKUNDEP(YM,KUNDE,ART)) DO   ;KUNDENPREISE
	. ;. NEW KUNDEP,ABDATUM
	. ;. SET ABDATUM=$ORDER(^INKUNDEP(YM,KUNDE,ART,+$H+1),-1)   ;TYBD;12.04.2003;ABDATUM
	. ;. QUIT:ABDATUM<10000
	. ;. SET KUNDEP=^INKUNDEP(YM,KUNDE,ART,ABDATUM,1)
	. ;. SET $PIECE(KUNDEP,Y,2)=ABDATUM
	. ;. IF $PIECE(KUNDEP,Y,2)'="" QUIT:$PIECE(KUNDEP,Y,2)>$HOROLOG   ;AB GÜLTIG
	. ;. IF $PIECE(KUNDEP,Y,3)'="" QUIT:$PIECE(KUNDEP,Y,3)<$HOROLOG   ;BIS GÜLTIG
	. ;. IF +$PIECE(KUNDEP,Y,1)'=0 SET $PIECE(SATZ,Y,118)=$PIECE(KUNDEP,Y,1)  ;KUNDENPREIS VORGEBEN
	. ;
	. DO  ;FIS;03.06.03;23477;PREISE AUS INSALESPRICE
	. . SET $PIECE(SATZ,Y,116)=$PIECE(SATZ1,Y,86)  ;AUFSCHLAG ;overcharge 
	. . SET $PIECE(SATZ,Y,120)=$PIECE(SATZ1,Y,90)  ;PREISKZ
	. . IF $GET(KUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,221)'="" SET $PIECE(SATZ,Y,120)=$PIECE(^(1),Y,221)    ;PREISKZ DES KUNDEN;FIS;24405;04.11.03
	. . IF $GET(KUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,73)'="" SET $PIECE(^INANG(YM,YANGEBOT,1),Y,210)=$PIECE(^(1),Y,73) SET $PIECE(^INANG(YM,YANGEBOT,1),Y,303)=1   ;SPEZIALZUSCHLAG FÜR KUNDE;TYBD;27,11,2004;26791;
	. . ;IF $GET(KUNDE)'="" IF $PIECE(SATZ,Y,12)'="" IF $PIECE($GET(^INKUNDELIEF(YM,KUNDE,$PIECE(SATZ,Y,12),1)),Y,31)'="" SET $PIECE(^INANG(YM,YANGEBOT,1),Y,210)=$PIECE(^(1),Y,31) SET $PIECE(^INANG(YM,YANGEBOT,1),Y,303)=1  ;SPEZIALZUSCHLAG FÜR KUNDE;TYBD;27,11,2004;26791;
	. . ;IF $GET(KUNDE)'="" IF $PIECE(SATZ,Y,12)'="" IF $PIECE($GET(^INKUNDELIEF(YM,KUNDE,$PIECE(SATZ,Y,12),1)),Y,32)=1 SET $PIECE(^INANG(YM,YANGEBOT,1),Y,210)="" SET $PIECE(^INANG(YM,YANGEBOT,1),Y,303)=""  ;SPEZIALZUSCHLAG FÜR KUNDE NICHT BERECHNEN;TYBD;27,11,2004;26791;
	. . IF $GET(KUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,228)=1 SET $PIECE(^INANG(YM,YANGEBOT,1),Y,215)=$PIECE(^(1),Y,228) SET $PIECE(^INANG(YM,YANGEBOT,1),Y,228)=$PIECE(^(1),Y,228)   ;LIEFERANSCHRIFT IST KUNDE;TYBD;3,12,2004;26930
	. . SET $PIECE(SATZ,Y,124)=$PIECE(SATZ1,Y,92)  ;PROV
	. . IF +$GET(YPREISFIX)'=0 SET $PIECE(SATZ,Y,118)=YPREISFIX QUIT  ;FIXER VK AUS VK=EK INKL. RABATTE;FIS;01.03.05;27351
	. . SET $PIECE(SATZ,Y,118)=$JUSTIFY($$^INSALESPRICE($PIECE(SATZ,Y,4),,$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,6),$PIECE(SATZ,Y,120),KUNDE,+$HOROLOG),0,$$^WWWDECIMALLEN("INANGP",118))  ;TYBD;17,11,2004;26328;NK
	. ;
	. ;IF $PIECE(SATZ,Y,19)="" SET $PIECE(SATZ,Y,19)=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,19)  ;LIEFERTERMIN
	. ;
	. ;HISTORY
	. DO
	. . NEW BETRIEB
	. . SET BETRIEB=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,6)
	. . IF BETRIEB="" SET BETRIEB=$GET(YLOCATION)
	. . ;SR17599 DO ^INARTHIST(ART,$$^WWWTEXT(32506)_" "_YANGEBOT_"-"_YPOS,BETRIEB)  ;Neue Angebotsposition ;Offer item 
	. ;
	. IF KUNDE'="" IF $DATA(^INKUNDE(YM,KUNDE,1)) DO   ;KUNDENRABATTE
	. . NEW KUNDE1
	. . SET KUNDE1=^INKUNDE(YM,KUNDE,1)
	. . SET $PIECE(SATZ,Y,121)=$PIECE(KUNDE1,Y,71)  ;KUNDENRABATT VORGEBEN ;purport 
	. . IF +$PIECE(KUNDE1,Y,70)'=0 SET $PIECE(SATZ,Y,122)=$PIECE(KUNDE1,Y,70)  ;POSITIONSRABATT VORGEBEN TYBD;2,1,2005 ;purport 
	. ;
	. SET WAGR=$PIECE(SATZ1,Y,30)
	. IF WAGR'="" IF KUNDE'="" IF $DATA(^INKUNDEK(YM,KUNDE,WAGR,1)) DO   ;WARENGRUPPEN KUNDENKONDITIONEN
	. . NEW KUNDEK
	. . SET KUNDEK=^INKUNDEK(YM,KUNDE,WAGR,1)
	. . ;KUNDENKONDITION WARENGRUPPE;26932;TYBD;4,12,2004
	. . SET $PIECE(SATZ,Y,384)=$PIECE(KUNDEK,Y,26)  ;KUNDENKONTO
	. . SET $PIECE(SATZ,Y,385)=$PIECE(KUNDEK,Y,27)  ;KUNDENKOSTENSTELLE
	. . ;
	. . IF $PIECE(KUNDEK,Y,11)'="" QUIT:$PIECE(KUNDEK,Y,11)<$HOROLOG   ;BIS GÜLTIG ;until valuable 
	. . SET $PIECE(SATZ,Y,121)=$PIECE(KUNDEK,Y,2)  ;WARENGRUPPEN RABATT ;deduction 
	. ;
	. IF $GET(KUNDE)'="" IF $PIECE(SATZ,Y,12)'="" DO
	. . NEW KUNDELIEF
	. . SET KUNDELIEF=$GET(^INKUNDELIEF(YM,KUNDE,$PIECE(SATZ,Y,12),1))
	. . IF $PIECE(KUNDELIEF,Y,26)'="" SET $PIECE(SATZ,Y,384)=$PIECE(KUNDELIEF,Y,26)  ;KUNDENKONTO
	. . IF $PIECE(KUNDELIEF,Y,27)'="" SET $PIECE(SATZ,Y,385)=$PIECE(KUNDELIEF,Y,27)  ;KUNDENKOSTENSTELLE
	. . IF $PIECE(KUNDELIEF,Y,31)'="" SET $PIECE(^INANG(YM,YANGEBOT,1),Y,210)=$PIECE(KUNDELIEF,Y,31) SET $PIECE(^INANG(YM,YANGEBOT,1),Y,303)=1  ;SPEZIALZUSCHLAG FÜR KUNDE;TYBD;27,11,2004;26791;
	. . IF $PIECE(KUNDELIEF,Y,32)=1   SET $PIECE(^INANG(YM,YANGEBOT,1),Y,210)="" SET $PIECE(^INANG(YM,YANGEBOT,1),Y,303)=""  ;SPEZIALZUSCHLAG FÜR KUNDE NICHT BERECHNEN;TYBD;27,11,2004;26791;
	. ;	
	. IF KUNDE'="" DO    ;KOSTENSTELLE KUNDEN ANSPRECHPARTNER;TYBD;4,1,2005
	. . NEW YPARTN,YNAME
	. . IF $PIECE(^INANG(YM,YANGEBOT,1),Y,305)'="" SET YPARTN=$PIECE(^(1),Y,305) DO
	. . . SET YNAME=$PIECE(YPARTN," ",3)
	. . . IF YNAME="" SET YNAME=$PIECE(YPARTN," ",2)
	. . . IF YNAME="" SET YNAME=$PIECE(YPARTN," ",1)
	. . . QUIT:YNAME=""
	. . . SET YPARTN=$ORDER(^INPARTNs(YM,1,$$^WWWUMLAU(YNAME,1),KUNDE,""))
	. . . QUIT:YPARTN=""
	. . . IF $PIECE($GET(^INPARTN(YM,KUNDE,YPARTN,1)),Y,61)'="" SET $PIECE(SATZ,Y,385)=$PIECE(^(1),Y,61)
	. ;
	. IF ART'="" IF $DATA(^INARTR(YM,ART)) DO   ;MENGENRABATTE  FAN 14.01.2002 ;buff 
	. . NEW RABATT,RABATT1,AB,BIS,PMENGE
	. . SET PMENGE=+MENGE
	. . IF PMENGE<0 SET PMENGE=PMENGE*(-1)       ;WENN GUTSCHRIFT  ;when 
	. . SET YGM=+$TRANSLATE($GET(%(YQUERY,"YGM"_ART)),",",".")  ;ZAHLENFORMAT
	. . IF YGM<0 SET YGM=YGM*(-1)
	. . IF PMENGE>YGM SET YGM=PMENGE
	. . SET RABATT1=""
	. . SET RABATT=""
	. . FOR  SET RABATT=$ORDER(^INARTR(YM,ART,RABATT)) QUIT:YGM<RABATT  QUIT:RABATT=""  DO
	. . . SET AB=""
	. . . FOR  SET AB=$ORDER(^INARTR(YM,ART,RABATT,AB))  QUIT:AB>$HOROLOG  QUIT:AB=""  DO
	. . . . SET RABATT1=$GET(^INARTR(YM,ART,RABATT,AB,1))
	. . . . QUIT:RABATT1=""
	. . . . IF $PIECE(RABATT1,Y,3)'="" IF $PIECE(RABATT1,Y,3)<$HOROLOG  SET RABATT1="" QUIT        ;BIS DATUM ;until Date 
	. . ;
	. . QUIT:RABATT1=""
	. . IF +$PIECE(RABATT1,Y,1)=0 IF +$PIECE(RABATT1,Y,4)=0 QUIT
	. . IF +$PIECE(RABATT1,Y,1)'=0 SET $PIECE(SATZ,Y,128)=$PIECE(RABATT1,Y,1)  ;POSITIONSRABATT
	. . SET $PIECE(SATZ,Y,129)=$$^WWWTEXT(32223)  ;3.RABATT=MENGENRABATT
	. . IF +$PIECE(RABATT1,Y,1)=0 IF +$PIECE(RABATT1,Y,4)'=0 SET $PIECE(SATZ,Y,118)=$PIECE(RABATT1,Y,4)  ;WENN BETRAG ALS RABATT ;when Sum when deduction 
	. ;
	. SET $PIECE(SATZ,Y,119)=$JUSTIFY($PIECE(SATZ,Y,118)*MENGE/$$^INQTYUNIT(ART),0,$$^WWWDECIMALLEN("INANGP",119))  ;TYBD;17,11,2004;26328;NK  ;VK*MENGE       
	. SET $PIECE(SATZ,Y,199)=1        ;NEU ANLAGEN KEINE PREIS NEU RECHNEN     FAN 15.01,2002
	. SET YM1=""
	. SET YM2=""
	. SET KEY=YANGEBOT_","_YPOS
	. SET OK=$$^WWWSPEI("INANGP",KEY,SATZ,1)   ;SPEICHERN DATENSATZ ;Save data record 
	. ;DO ^INANGPKNEU(YANGEBOT,YPOS,1)  ;TYBD;27007;29,12,2004;RABATTE RECHNEN;RAUS 2,1,2005
	. ;
	. ;ANLEGEN ZUSATZARTIKEL  (OHNE UNTERTEILE) ;put onto 
	. IF $DATA(^INARTZUS(YM,ART)) DO
	. . KILL ^WWWSOR("ARTZ",YUSER,"ARTZ")
	. . NEW ARTZ,MENGEP,MENGEZ,PREISZ,YPOSZ,WHZ,KEY,SOR,ARTZ1,MENSATZ,ANZ,KUNDETEXT
	. . SET SOR=1
	. . IF +MENGE<0 SET SOR=-1
	. . SET ARTZ=""
	. . FOR  SET ARTZ=$ORDER(^INARTZUS(YM,ART,ARTZ)) QUIT:ARTZ=""  DO
	. . . SET ARTZ1=$GET(^INARTZUS(YM,ART,ARTZ,1))
	. . . IF $PIECE(ARTZ1,Y,2)'=1 QUIT  ;KEINE AUTOMATISCHE ANLAGE ;no layout 
	. . . IF +$PIECE(ARTZ1,Y,8)'=0 IF $PIECE(ARTZ1,Y,8)>$HOROLOG QUIT  ;GÜLTIG VON  ;FIS:10.10.2003 ;valuable 
	. . . IF +$PIECE(ARTZ1,Y,9)'=0 IF $PIECE(ARTZ1,Y,9)<$HOROLOG QUIT  ;GÜLTIG BIS  ;FIS:10.10.2003 ;valuable until 
	. . . SET KUNDETEXT=$PIECE(ARTZ1,Y,10)       ;alternativer Kundentext   ;FAN;13.04.04;25518
	. . . SET MENGEZ=$PIECE(ARTZ1,Y,5)  ;MENGE  ;FAN;04.03.04;25200
	. . . SET PREISZ=""  ;VK ;Sale 
	. . . IF $DATA(^INARTZUS1(YM,ART,ARTZ)) DO  ;VERKAUFSSTAFFEL
	. . . . SET MENGEP=MENGE*SOR
	. . . . IF '$DATA(^INARTZUS1(YM,ART,ARTZ,MENGEP)) SET MENGEP=$ORDER(^INARTZUS1(YM,ART,ARTZ,MENGEP),-1)
	. . . . QUIT:MENGEP=""
	. . . . SET MENSATZ=$GET(^INARTZUS1(YM,ART,ARTZ,MENGEP]]><![CDATA[,1))
	. . . . QUIT:MENSATZ=""
	. . . . IF +$PIECE(MENSATZ,Y,3)'=0 QUIT:$PIECE(MENSATZ,Y,3)>$HOROLOG  ;GÜLTIG VON  ;ULM:16.10.2002 ;valuable 
	. . . . IF +$PIECE(MENSATZ,Y,4)'=0 QUIT:$PIECE(MENSATZ,Y,4)<$HOROLOG  ;GÜLTIG BIS  ;ULM:16.10.2002 ;valuable until 
	. . . . SET MENGEZ=$PIECE(MENSATZ,Y,1)
	. . . . IF +$PIECE(MENSATZ,Y,5)=1 SET MENGEZ=+MENGE*MENGEZ  ;ULM 01.11.2002
	. . . . SET PREISZ=$PIECE(MENSATZ,Y,2)
	. . . ;
	. . . ;IF +MENGEZ=0 SET MENGEZ=1  ;MINDESTENS 1 STÜCK  ,KANN AUCH 0 SEIN, 
	. . . IF MENGEZ="" SET MENGEZ=0
	. . . SET MENGEZ=MENGEZ*SOR
	. . . SET ANZ=$PIECE(ARTZ1,Y,7)
	. . . IF ANZ="" SET ANZ=999
	. . . SET ^WWWSOR("ARTZ",YUSER,"ARTZ",ANZ,ARTZ)=MENGEZ_Y_PREISZ_Y_KUNDETEXT          ;FAN; REINFOLG; FAN;04.03.04;25218
	. . ;
	. . SET ANZ=""
	. . FOR  SET ANZ=$ORDER(^WWWSOR("ARTZ",YUSER,"ARTZ",ANZ)) QUIT:ANZ=""  DO
	. . . SET ARTZ=""
	. . . FOR  SET ARTZ=$ORDER(^WWWSOR("ARTZ",YUSER,"ARTZ",ANZ,ARTZ)) QUIT:ARTZ=""  DO
	. . . . SET MENGEZ    = $PIECE($GET(^WWWSOR("ARTZ",YUSER,"ARTZ",ANZ,ARTZ)),Y,1)
	. . . . SET PREISZ    = $PIECE($GET(^WWWSOR("ARTZ",YUSER,"ARTZ",ANZ,ARTZ)),Y,2)
	. . . . SET KUNDETEXT = $PIECE($GET(^WWWSOR("ARTZ",YUSER,"ARTZ",ANZ,ARTZ)),Y,3)   ;alternativer Kundentext   ;FAN;13.04.04;25518
	. . . . SET YPOSZ     = $$^INANGPOS(YANGEBOT,ARTZ,MENGEZ,PREISZ,KUNDETEXT)        ;ANLEGEN POSITION ;put onto 
	. . ;
	. . KILL ^WWWSOR("ARTZ",YUSER,"ARTZ")
	. ;
	. IF $GET(KUNDE)'=""  DO
	. . NEW KUNDELIEF,LIEF
	. . SET LIEF=$PIECE(SATZ,Y,12)
	. . IF LIEF="" SET LIEF=$ORDER(^INARTK(YM,ART,""))
	. . ;QUIT:LIEF=""
	. . SET KUNDELIEF=""
	. . IF LIEF'="" SET KUNDELIEF=$GET(^INKUNDELIEF(YM,KUNDE,LIEF,1))
	. . IF $PIECE(KUNDELIEF,Y,30)="" IF $PIECE(KUNDELIEF,Y,32)=1 QUIT  ;NICHT BERECHNEN WENN NICHT EXTRA EIN ARTIKEL ANGEGEBEN IST. WENN NUR IM KUNDENSTAMM ERFASST DANN KEINE;TYBD;3,1,2004
	. . IF $PIECE(KUNDELIEF,Y,30)="" SET $PIECE(KUNDELIEF,Y,30)=$PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,227)  ;TYBD;29,12,2004
	. . QUIT:KUNDELIEF=""
	. . IF $PIECE(KUNDELIEF,Y,30)'="" DO  ;EXTRA POSITION ANLEGEN
	. . . NEW PREIS,BEZ,PROZ,POS
	. . . DO EH1^INBRUTTONETTO                  ; Updates SATZ ByRef
	. . . SET BEZ=$PIECE($GET(^INART(YM,$PIECE(KUNDELIEF,Y,30),1)),Y,1)
	. . . SET PROZ=$TRANSLATE($REVERSE($PIECE($REVERSE($PIECE(BEZ,"%",1))," ",1)),",",".")
	. . . SET PREIS=$JUSTIFY(($PIECE(SATZ,Y,123))/100*PROZ,0,2)
	. . . IF +PROZ=0 SET PREIS=""
	. . . SET POS=$$^INAUFPOS(YANGEBOT,$PIECE(KUNDELIEF,Y,30),1,4,PREIS)  ;ANLEGEN POSITION ;put onto
	. . . IF +POS'=0 DO  ;VERBINDUNG ZUR URSPRUNGSPOSITION IN BESTELLREFERENZ SPEICHERN;FIS;02.03.05;27043
	. . . . NEW YFORM,YVOR,YOK,YFELD
	. . . . SET YFELD=$GET(^INANGP(YM,YANGEBOT,POS,1))
	. . . . SET $PIECE(YFELD,Y,256)="#"_YPOS
	. . . . SET YOK=$$^WWWSPEI("INANGP",YANGEBOT_","_POS,YFELD,1)
	. ;
	. IF YANGEBOT'="" DO 
	. . MERGE ^INANGPSP(YM,YANGEBOT,YPOS)=^INARTSP(YM,ART)  ;ARTIKELSPRACHE IN POSITIONEN ;within 
	. . MERGE ^INANGPXL(YM,YANGEBOT,YPOS)=^INARTXL(YM,ART)  ;KOPIEREN DES ARTIKELTEILEBAUMES
	. . SET ^INANGPXL(YM,YANGEBOT,YPOS)=SATZ
	. . DO ^INANGPXLDEL  ;LÖSCHEN UNTERTEILE VON BESTELLWARE AUS INANGPXL ;Delete out of 
	. . DO ^INANGTEILE   ;TEILESTRUKTUR
	. . DO ^INANGHKNEU(YANGEBOT,YPOS,1)  ;NEURECHNEN HERSTELLKOSTEN;21.12.04;FIS;26268 (IM HINTERGRUND)
	. ;
	. DO
	. . NEW HK,NEU
	. . SET NEU=$PIECE($GET(^INANGP(YM,YANGEBOT,YPOS,1)),Y,199)
	. . SET $PIECE(^INANGP(YM,YANGEBOT,YPOS,1),Y,199)=""  ;ERSTMALIG IMMER RECHNEN
	. . SET HK=+$$^INANGKOST(YANGEBOT,YPOS)
	. . SET $PIECE(^INANGP(YM,YANGEBOT,YPOS,1),Y,199)=NEU
	. . IF HK'=0 SET $PIECE(^INANGP(YM,YANGEBOT,YPOS,1),Y,47)=HK   ;NEURECHNEN POSITIONS-EK
	. ;
	. SET NETTO=$$^INANGPNETTO(YANGEBOT,YPOS)
	. ;IF '$DATA(^INANGPT(YM,YANGEBOT,YPOS)) DO  ;ERRECHNEN GEWICHT WENN KEINE TEILE;FIS;02.07.04;25762;FIS;21.09.04;26400;GEWICHT NICHT RECHNEN
	. IF '$DATA(^INANGPT(YM,YANGEBOT,YPOS))!($PIECE($GET(^INART(YM,ART,1)),Y,255)=1) DO  ;FIS;21.09.04;26400;GEWICHT NICHT AUS TEILEN RECHNEN
	. . SET $PIECE(^INANGP(YM,YANGEBOT,YPOS,1),Y,43)=$PIECE(SATZ,Y,43)*MENGE  ;GEWICHT ;wt. 
	
	QUIT:YANGEBOT=""                      ;KEIN ANGEBOT ;no quote 
	SET VORG(1)=$EXTRACT(YAUSWAHL,2,99)   ;SUCHVORGABE VOLLTEXT ODER NUMMER ;full text Or numeral 
	
	;+++++++++++++++++++++++++++++++++++++++
	;COPY EINER BEREITS BESTEHENDEN POSITION üBERNAHME ANGEBOT ;unit yet quote 
	;   Get SATZ as objINANGP to save as INANGP
	;+++++++++++++++++++++++++++++++++++++++
	
	SET YQ=0
	IF $PIECE(VORG(1),"-",1)'="" IF $PIECE(VORG(1),"-",2)'="" DO
	. QUIT:'$DATA(^INANG(YM,$PIECE(VORG(1),"-",1)))  ;NICHT VORHANDENES ANGEBOT;TYBD;5,7,2005;26034
	. IF $PIECE(VORG(1),"-",2)'=0 QUIT:'$DATA(^INANGP(YM,$PIECE(VORG(1),"-",1),$PIECE(VORG(1),"-",2)))
	. NEW YI,YA,SATZ,KEY,YFORM,YANGX,YPOSX
	. SET YANGX=$PIECE(VORG(1),"-",1)
	. QUIT:YANGEBOT=YANGX
	. SET YPOSX=$PIECE(VORG(1),"-",2)
	. IF YPOSX=0 IF $PIECE($GET(^INANG(YM,YANGX,1)),Y,71)'=0 DO  ;FIS;26306;23.08.04;KOPIEREN GESAMTRABATT
	. . SET $PIECE(YFELD,Y,71)=$PIECE($GET(^INANG(YM,YANGX,1)),Y,71)
	. . SET $PIECE(^INANG(YM,YANGEBOT,1),Y,71)=$PIECE(YFELD,Y,71)
	. ;
	. MERGE ^INANGPARA(YM,YANGEBOT)=^INANGPARA(YM,YANGX)  ;POSITIONSGRUPPEN ÜBERNEHMEN ;assume 
	. ;
	. DO  IF YPOSX=0 FOR  SET YPOSX=$ORDER(^INANGP(YM,YANGX,YPOSX)) QUIT:YPOSX=""  DO  ;EINZEL UND ALLE WENN =0  ;And when 
	. . QUIT:YPOSX=0  
	. . SET YFORM="INANGP"
	. . SET SATZ=$GET(^INANGP(YM,YANGX,YPOSX,1))
	. . QUIT:SATZ=""
	. . FOR YPOS=1:1 QUIT:'$DATA(^INANGP(YM,YANGEBOT,YPOS))   ;NÄCHSTE POSITIONSNUMMER  ;next 
	. . IF YPOS="" SET YPOS=1
	. . IF $DATA(^INANGP(YM,YANGEBOT,YPOS)) SET YPOS=$$^WWWNEXT1("INANGP",YANGEBOT,2)
	. . SET KEY=YANGEBOT_","_YPOS
	. . ;FOR YI=7,19,9,11,22,23,24,25,51,52,56,60,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,109,127,134,136,140,141,145,146,148,160,163,164,165,166,168,169,170 SET $PIECE(SATZ,Y,YI)=""  ;LÖSCHEN BEWEGUNGSDATEN;TYBD;12.06.2003;23194;RABATTE NICHT LÖSCHEN
	. . FOR YI=7,9,11,19,22,23,24,25,51,52,56,60,76:1:105,109,127,134,136,140,141,145,146,148,160,163:1:166,168:1:170 DO
	. . . SET $PIECE(SATZ,Y,YI)=""  ;LÖSCHEN BEWEGUNGSDATEN;TYBD;12.06.2003;23194;RABATTE NICHT LÖSCHEN
	. . IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=2 SET $PIECE(SATZ,Y,12)=$PIECE(^(1),Y,12)        ;FAN 30.10.2001    ;buff 
	. . SET $PIECE(SATZ,Y,199)=1        ;NEU ANLAGEN KEINE PREIS NEU RECHNEN     FAN 15.01,2002
	. . IF $PIECE(SATZ,Y,26)=2 SET $PIECE(SATZ,Y,7)=4 SET $PIECE(SATZ,Y,90)=1  ;DIENSTLEISTUNG;TYBD;19,08,2003
	. . IF $PIECE(SATZ,Y,26)=6 SET $PIECE(SATZ,Y,7)=4 SET $PIECE(SATZ,Y,90)=1  ;DIENSTLEISTUNG;TYBD;19,08,2003
	. . ;IF $PIECE(SATZ,Y,26)=4 SET $PIECE(SATZ,Y,7)=2 SET $PIECE(SATZ,Y,90)=1  ;KLEINTEILE LAGER;TYBD;19,08,2003
	. . SET OK=$$^WWWSPEI("INANGP",KEY,SATZ,1)   ;SPEICHERN DATENSATZ ;Save data record 
	. . MERGE ^INANGPSP(YM,YANGEBOT,YPOS)=^INANGPSP(YM,YANGX,YPOSX)  ;ARTIKELSPRACHE 
	. . MERGE ^INANGPXL(YM,YANGEBOT,YPOS)=^INANGPXL(YM,YANGX,YPOSX)  ;TEILE
	. . DO TEILE  ;TEILEAUFBAU
	. . SET YQ=1
	. ;
	. DO ^INANGANZ(YANGEBOT)
	
	QUIT:YQ=1
	
	;+++++++++++++++++++++++++++++++++++++++
	;COPY EINER BEREITS BESTEHENDEN AUFTRAGSPOSITION üBERNAHME ANGEBOT;TYBD;5,7,2005;26034
	;   Get SATZ as objINAUFP to save as INANGP
	;+++++++++++++++++++++++++++++++++++++++
	
	IF $PIECE(VORG(1),"-",1)'="" IF $PIECE(VORG(1),"-",2)'="" DO
	. QUIT:'$DATA(^INAUF(YM,$PIECE(VORG(1),"-",1)))  ;NICHT VORHANDENER AUFTRAG;TYBD;5,7,2005;26034
	. IF $PIECE(VORG(1),"-",2)'=0 QUIT:'$DATA(^INAUFP(YM,$PIECE(VORG(1),"-",1),$PIECE(VORG(1),"-",2)))
	. NEW YI,YA,SATZ,KEY,YFORM,YANGX,YPOSX
	. SET YANGX=$PIECE(VORG(1),"-",1)
	. QUIT:YANGEBOT=YANGX
	. SET YPOSX=$PIECE(VORG(1),"-",2)
	. MERGE ^INANGPARA(YM,YANGEBOT)=^INAUFPARA(YM,YANGX)  ;POSITIONSGRUPPEN ÜBERNEHMEN ;assume 
	. DO  IF YPOSX=0 FOR  SET YPOSX=$ORDER(^INAUFP(YM,YANGX,YPOSX)) QUIT:YPOSX=""  DO  ;EINZEL UND ALLE WENN =0  ;And when 
	. . QUIT:YPOSX=0  
	. . SET YFORM="INANGP"
	. . SET SATZ=$GET(^INAUFP(YM,YANGX,YPOSX,1))
	. . QUIT:SATZ=""
	. . FOR YPOS=1:1 QUIT:'$DATA(^INANGP(YM,YANGEBOT,YPOS))   ;NÄCHSTE POSITIONSNUMMER  ;next 
	. . IF YPOS="" SET YPOS=1
	. . IF $DATA(^INANGP(YM,YANGEBOT,YPOS)) SET YPOS=$$^WWWNEXT1("INANGP",YANGEBOT,2)
	. . SET KEY=YANGEBOT_","_YPOS
	. . ;FOR YI=7,19,9,11,22,23,24,25,51,52,56,60,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,109,127,134,136,140,141,145,146,148,160,163,164,165,166,168,169,170 SET $PIECE(SATZ,Y,YI)=""  ;LÖSCHEN BEWEGUNGSDATEN;TYBD;12.06.2003;23194;RABATTE NICHT LÖSCHEN
	. . FOR YI=7,9,11,19,22,23,24,25,51,52,56,60,76:1:105,109,127,134,136,140,141,145,146,148,160,163:1:166,168,169,170 DO
	. . . SET $PIECE(SATZ,Y,YI)=""  ;LÖSCHEN BEWEGUNGSDATEN;TYBD;12.06.2003;23194;RABATTE NICHT LÖSCHEN
	. . IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=2 SET $PIECE(SATZ,Y,12)=$PIECE(^(1),Y,12)        ;FAN 30.10.2001    ;buff 
	. . SET $PIECE(SATZ,Y,199)=1        ;NEU ANLAGEN KEINE PREIS NEU RECHNEN     FAN 15.01,2002
	. . IF $PIECE(SATZ,Y,26)=2 SET $PIECE(SATZ,Y,7)=4 SET $PIECE(SATZ,Y,90)=1  ;DIENSTLEISTUNG;TYBD;19,08,2003
	. . IF $PIECE(SATZ,Y,26)=6 SET $PIECE(SATZ,Y,7)=4 SET $PIECE(SATZ,Y,90)=1  ;DIENSTLEISTUNG;TYBD;19,08,2003
	. . ;IF $PIECE(SATZ,Y,26)=4 SET $PIECE(SATZ,Y,7)=2 SET $PIECE(SATZ,Y,90)=1  ;KLEINTEILE LAGER;TYBD;19,08,2003
	. . SET OK=$$^WWWSPEI("INANGP",KEY,SATZ,1)   ;SPEICHERN DATENSATZ ;Save data record 
	. . MERGE ^INANGPSP(YM,YANGEBOT,YPOS)=^INAUFPSP(YM,YANGX,YPOSX)  ;ARTIKELSPRACHE
	. . MERGE ^INANGPXL(YM,YANGEBOT,YPOS)=^INAUFPXL(YM,YANGX,YPOSX)  ;TEILE
	. . DO TEILE  ;TEILEAUFBAU
	. . SET YQ=1
	. ;
	. DO ^INANGANZ(YANGEBOT)
	
	QUIT:YQ=1
	
	;HINWEIS AUF RAHMENVERTRÄGE ;upon 
	IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,1)'="" DO
	. NEW LYPOINT
	. QUIT:$GET(YSEITE)>1
	. SET KD=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,1)
	. ;LOYALTY
	. SET LYPOINT=$PIECE($GET(^INKUNDE(YM,KD,1)),Y,185)
	. IF +LYPOINT'=0 WRITE $$^WWWTEXT(33593)_": "_LYPOINT WRITE "<BR>"  ;LOYALTYPIONTS VORHANDEN ! ;on hand 
	. ;
	. SET YA=""
	. IF $$^INARTRAHMEN(KD)'="" SET YA="*R"  ;FIS;04.06.03;22826;ERWEITERUNG RAHMENVERTRÄGE
	. IF YA'="" DO
	. . WRITE YCR
	. . IF YFORM'="INANGGOE" DO
	. . . WRITE "<A HREF="""
	. . . WRITE "JavaScript:{" 
	. . . WRITE YCR," retval = EventValue('"_YUCI_"','"_YUSER_"','"_YFORM_"','FIX"_$GET(YKEY)_"','Y"_YFORM_"M104','"_YA_"','2','NOVALUE');"  ;AUSWAHL SETZTEN
	. . . WRITE " document."_YHTMFORM_".Y"_YFORM_"M104.value='"_YA_"';"  ;AUCH ANZEIGEN
	. . . WRITE " SAVENOW(); }"
	. . . WRITE """"
	. . . WRITE ">"
	. . . WRITE YCR,"<IMG SRC="""_YGIF_"allevertr.gif"" TITLE="""_$$^WWWTEXT(33440)_""" ALIGN=ABSBOTTOM BORDER=0 border=0>"  ;suchen ;seek 
	. . . WRITE "</A>"
	. . ;
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO
	. . . NEW YFORM,YBACK
	. . . WRITE "<A HREF="""_YAKTION_"EP=WWWMANU&YEXEC=D|^INRAHMEN('"_KD_"')&YFORM=INRAHMEN1&YBACK=INANG,"
	. . . ;WRITE "<A HREF="""_YAKTION_"EP=WWWFORM&YFORM=INRAHMENK&YKEY="_KD_"&YBACK=INANG,"
	. . . DO ^WWWCGI
	. . . WRITE """"
	. . . WRITE " TITLE="""_$$^WWWTEXT(374)_""""
	. . . WRITE ">"
	. . . WRITE "<FONT COLOR="""_YRED_""">"
	. . . WRITE $$^WWWTEXT(32565)_"<BR>"  ;KUNDENRAHMENVERTRAG VORHANDEN ! ;on hand 
	. . . WRITE "</FONT>"
	. . . WRITE "</A>"
	
	IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,12)'="" DO
	. QUIT:$GET(YSEITE)>1
	. SET YA=""
	. SET LF=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,12)
	. IF $$^INARTRAHMEN(LF)'="" SET YA="*R"  ;FIS;04.06.03;22826;ERWEITERUNG RAHMENVERTRÄGE
	. IF YA'="" DO
	. . WRITE YCR
	. . DO
	. . . WRITE "<A HREF="""
	. . . WRITE "JavaScript:{" 
	. . . WRITE YCR," retval = EventValue('"_YUCI_"','"_YUSER_"','"_YFORM_"','FIX"_$GET(YKEY)_"','YINANGM104','"_YA_"','2','NOVALUE');"  ;AUSWAHL SETZTEN
	. . . WRITE " document."_YHTMFORM_".YINANGM104.value='"_YA_"';"  ;AUCH ANZEIGEN
	. . . WRITE " SAVENOW(); }"
	. . . WRITE """"
	. . . WRITE ">"
	. . . WRITE YCR,"<IMG SRC="""_YGIF_"allevertr.gif"" TITLE="""_$$^WWWTEXT(33440)_""" ALIGN=ABSBOTTOM BORDER=0 border=0>"  ;suchen ;seek 
	. . . WRITE "</A>"
	. . ;
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO
	. . . NEW YFORM,YBACK
	. . . WRITE "<A HREF="""_YAKTION_"EP=WWWMANU&YEXEC=D|^INRAHMEN('"_LF_"')&YFORM=INRAHMEN1&YBACK=INANG,"
	. . . ;WRITE "<A HREF="""_YAKTION_"EP=WWWFORM&YFORM=INRAHMEN&YKEY="_LF_"&YBACK=INANG,"
	. . . DO ^WWWCGI
	. . . WRITE """"
	. . . WRITE " TITLE="""_$$^WWWTEXT(374)_""""
	. . . WRITE ">"
	. . . WRITE "<FONT COLOR="""_YRED_""">"
	. . . WRITE $$^WWWTEXT(32566)_"<BR>"  ;LIEFERANTENRAHMENVERTRAG VORHANDEN ! ;on hand 
	. . . WRITE "</FONT>"
	. . . WRITE "</A>"
	
	;GESAMTBETRAG ANZEIGEN ;display 
	IF VORG(1)="" IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=0  DO   ;GESAMTBETRAG, WENN BERECHTIGUNG
	. NEW GESAMT,YI,POS1,YLLIEF
	. SET GESAMT=0
	. SET GESAMT(0)=0
	. SET YI=""
	. FOR  SET YI=$ORDER(^INANGP(YM,YANGEBOT,YI)) QUIT:YI=""  DO  ;DUCHSUCHEN DER POSITIONEN ;the 
	. . SET POS1=$GET(^INANGP(YM,YANGEBOT,YI,1))
	. . IF +$PIECE(POS1,Y,9)=1 QUIT  ;STORNO POSITION
	. . ;IF +$PIECE(POS1,Y,60)=1 QUIT  ;POSITION ERLEDIGT
	. . SET GESAMT=GESAMT+$PIECE(POS1,Y,123)  ;GESAMTPREIS DER POSITION mit RABATT ;the by means of deduction 
	. . DO  ;ERMITTELN MWST AUS POSITIONEN ;find Tax out of 
	. . . NEW PREIS,YADRES,MWST
	. . . SET MWST=$PIECE(POS1,Y,36)
	. . . IF MWST="" SET MWST=1
	. . . IF KUNDE'="" DO
	. . . . SET YADRES=""  ;ANSCHRIFTEN
	. . . . IF KUNDE'="" SET YADRES=$GET(^INKUNDE(YM,KUNDE,1))  ;KUNDENNUMMER FÜR ANSCHRIFT ;to 
	. . . . DO  ;MWST NACH PLZ USA ;Tax within ZIP 
	. . . . . NEW PLZ
	. . . . . SET PLZ=$PIECE(YADRES,Y,12)
	. . . . . QUIT:PLZ=""
	. . . . . ;IF $DATA(^INPLZ(YM,PLZ,1)) IF $PIECE(^(1),Y,11)'="" SET MWST=$PIECE(^(1),Y,11)
	. . . . . IF $DATA(^INPLZ(0,PLZ,1)) IF $PIECE(^(1),Y,11)'="" SET MWST=$PIECE(^(1),Y,11)       ;BEC;25866;07.06.04;DA ZENTRALE DATEI
	. . . . ;  
	. . . . IF $PIECE(YADRES,Y,17)'="" IF $PIECE(YADRES,Y,17)'=$GET(YCOUNTRY)        SET MWST=0  ;KEIN DEUTSCHLAND ;no Germany 
	. . . . IF $PIECE(YADRES,Y,50)'="" IF '$FIND($PIECE(YADRES,Y,50),$GET(YCOUNTRY)) SET MWST=0  ;STEUERID AUSLAND ;foreign country 
	. . . . IF $PIECE(YADRES,Y,54)'="" IF $PIECE(YADRES,Y,54)'=1                     SET MWST=0  ;KEINE STEUER ;no tax 
	. . . . IF $PIECE(YADRES,Y,55)'="" IF $PIECE(YADRES,Y,55)'<$HOROLOG             SET MWST=0  ;KEINE STEUER BIS ZUM ;no tax until 
	. . . ;
	. . . QUIT:+MWST=0
	. . . SET PREIS=$PIECE(POS1,Y,123)
	. . . SET MWST=+$PIECE($GET(^WWW101(0,"MWST",SPRACHE,MWST,1)),Y,1)
	. . . SET GESAMT(0)=GESAMT(0)+$JUSTIFY(PREIS/100*MWST,0,2)  ;GESAMTE MEST
	. . ;
	. . IF $PIECE(POS1,Y,7)=1  DO   ;WENN BESTELLUNG PRÜFUNG AUF MINDESTBESTELLWERT ;when sales order quiz upon 
	. . . SET YLLIEF=$PIECE(POS1,Y,12)
	. . . IF YLLIEF'="" DO
	. . . . SET YLLIEF(YLLIEF)=$GET(YLLIEF(YLLIEF))+$PIECE(POS1,Y,47)  ;SELBSTKOSTEN = EK  SPEICHERN ZUR PRÜFUNG DER MINDESBESELLWERTE ;total production costs Planned Cost Save quiz the 
	. ;
	. ;	D22		$$$INVORGOrderProcessingWithSalesP()
	. IF $$^WWWACCESS("",$$$INVORGOrderProcessingWithSalesP(objINVORG))=$$$YES DO   ;KEINE BERECHTIGUNG ;no 
	. . IF +GESAMT'=0 WRITE YCR WRITE $$^WWWTEXT(31410)  ;Gesamtpreis ;Total Price  ;Total Price Total 
	. . IF +GESAMT'=0 WRITE " ",$$^WWWZAHL(GESAMT,0,2,YWHR)_" "_$$^WWWTEXT(32675)
	. . IF +GESAMT(0)'=0 WRITE " &nbsp;&nbsp;("_$$^WWWZAHL(GESAMT+GESAMT(0),0,2,YWHR)_" "_$$^WWWTEXT(32676)_")"
	. ;
	. IF $GET(KUNDE)'="" DO  ;MINDESTBESTELLWERT DES kunde
	. . QUIT:+$PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,44)=0   ;KEINE MINDESTBESTELLMENGE ;no 
	. . QUIT:$PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,44)'>GESAMT  ;UNTERSCHRITTENE MINDESSTWERT
	. . WRITE YCR
	. . WRITE "<BR>"
	. . WRITE "<FONT COLOR="_YRED_">"
	. . WRITE $$^WWWTEXT(33851)," ",KUNDE," ("_$$^WWWZAHL($PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,44),0,2,YWHR)_")"
	. . WRITE "</FONT>"
	. ;
	. SET YLLIEF=""
	. FOR  SET YLLIEF=$ORDER(YLLIEF(YLLIEF)) QUIT:YLLIEF=""  DO
	. . QUIT:YLLIEF(YLLIEF)'>0  ;ZU KLEIN ;within wee 
	. . QUIT:+$PIECE($GET(^INLIEF(YM,YLLIEF,1)),Y,44)=0   ;KEINE MINDESTBESTELLMENGE ;no 
	. . QUIT:$PIECE($GET(^INLIEF(YM,YLLIEF,1)),Y,44)'>YLLIEF(YLLIEF)  ;UNTERSCHRITTENE MINDESSTWERT
	. . WRITE YCR
	. . WRITE "<BR>"
	. . WRITE $$^WWWTEXT(32200)," ",YLLIEF," ("_$$^WWWZAHL($PIECE($GET(^INLIEF(YM,YLLIEF,1)),Y,44),0,2)_")"
	
	;AUSWAHL DER ARTIKEL ;Selection the item 
	;
	; Text vor Auflistung ;Text pre- 
	IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,60)=1 {
		; ANGEBOT GESCHLOSSEN DA RECHNUNG GEDRUCKT     ;quote
		WRITE YCR,"<BR><FONT COLOR="_YRED_">"_$$^WWWTEXT(32098)_"</FONT><BR>"
	
	} elseif $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,92)'="" {
		; ANGEBOT GESCHLOSSEN DA LIEFERSCHEIN GEDRUCKT ;quote packing slip 
		WRITE YCR,"<BR><FONT COLOR="_YRED_">"_$$^WWWTEXT(32154)_"</FONT><BR>"
	}
	;-------------------------------------------
	;MANUELLE SUCHFUNKTION DER ARTIKELPOSITIONEN ;the 
	IF YSEITE<2 IF VORG(1)="" DO ^INANGANZ(YANGEBOT)
	IF YSEITE>1 WRITE "<BR>"
	;-------------------------------------------
	IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,60)=1 QUIT  ;ANGEBOT GESCHLOSSEN DA RECHNUNG GEDRUCKT ;quote
	
	DO SEARCH
	QUIT:VORG(1)=""         ;KEINE AUSWAHL ;no Selection 
	
	DO ^INANGANZ(YANGEBOT)  ;MANUELLE SUCHFUNKTION DER ARTIKELPOSITIONEN
	QUIT
	
SEARCH	;SUCHFENSTER;FIS;04.07.03;23902
	NEW BESTBETR,idxSupplier,objINVORG  ;AUSLIEFERUNGSBETRIEB WELCHE FILIALE ;who affiliate 
	
	set objINVORG = $get(^INVORG(YM,YM,1))          ; 30-Aug-2006
	
	SET BESTBETR=""
	IF KUNDE'="" DO
	. SET BESTBETR(1)=$ORDER(^INKUNDELOC(YM,KUNDE,"")) 
	. IF BESTBETR(1)'="" SET BESTBETR=$PIECE($GET(^INKUNDELOC(YM,KUNDE,BESTBETR(1),1)),Y,1)
	
	;	D163		$$$INVORGItemSearchWithoutVersionM()
	IF $$$INVORGItemSearchWithoutVersionM(objINVORG)'=$$$YES DO   ;MATRIX;FIS;24893;09.01.04;PARAMETER
	. QUIT:VORG(1)=""
	. NEW ARTX,TRENN
	. SET TRENN="-"
	. SET ARTX=$ORDER(^INART(YM,VORG(1)_"-"))
	. IF '$FIND(ARTX,"-") SET ARTX=""
	. IF ARTX="" SET ARTX=$ORDER(^INART(YM,VORG(1)_".")) SET TRENN="." 
	. QUIT:ARTX=""
	. ;QUIT:'$FIND($TRANSLATE(ARTX,".","-"),$TRANSLATE(VORG(1),".","-")_"-")
	. QUIT:$EXTRACT(ARTX,1,$LENGTH(VORG(1))+1)'=(VORG(1)_TRENN)
	. SET ART1=$GET(^INART(YM,ARTX,1))
	. KILL ^WWWSOR(YUSER,"ARTIKEL")
	. ;IF $PIECE(ART1,Y,26)=5  QUIT  ;PHANTOMARTIKEL 
	. ;EIGENAUFTRAG
	. IF $PIECE(YFELD,Y,2)=1 IF $PIECE(ART1,Y,26)'=5 IF $PIECE(ART1,Y,26)'=0 IF $PIECE(ART1,Y,26)'=3 IF $PIECE(ART1,Y,26)'=2 QUIT  ;NUR LEISTUNGEN UND EIGENFERTIGUNG BEI INNTERNEM AUFTRAG ;only LEISTUNGEN And next to mandate 
	. ;
	. ;LIEFERANTEN BESTELLUNG ;sales order 
	. IF $PIECE(YFELD,Y,2)=2 IF $PIECE(ART1,Y,26)'=5 IF $PIECE(ART1,Y,26)'=0 IF $PIECE(ART1,Y,26)'=1 IF $PIECE(ART1,Y,26)'=4 QUIT  ;NUR BESTELLUNG UND KLEINTEILE BER BESTELLUNGEN  ;only sales order And 
	. ;
	. ;IF $F($TR(ARTX,".","-"),$TR(VORG(1),".","-")_"-") DO  ;MATRIX VORHANDEN
	. IF $EXTRACT(ARTX,1,$LENGTH(VORG(1))+1)=(VORG(1)_TRENN) DO
	. . NEW YOK
	. . SET YOK=$$^INAUFMATRIX(VORG(1),"INANG",YANGEBOT,BESTBETR)
	. . QUIT:YOK'=1  ;NICHT OK ;Not 
	. . SET VORG(1)=""
	. . KILL ^WWWSOR(YUSER,"ARTIKEL")
	. . IF $GET(NOLIST)=1 QUIT
	. . ;-------------------------------------------
	. . ;MANUELLE SUCHFUNKTION DER ARTIKELPOSITIONEN ;the 
	. . DO ^INANGANZ(YANGEBOT)
	
	QUIT:VORG(1)=""   ;KEINE AUSWAHL ;no Selection 
	
	;--------------------------------
	SET YDDSATZ=0   ;VARIABELE ZUR HELL DUNKELSCHALTUNG ;bright 
	WRITE YCR
	IF VORG(1)'="" WRITE "&nbsp;"_$$^WWWTEXT(148)_": "_VORG(1)   ;SUCHE NACH
	
	SET KUNDE=""
	IF $GET(YANGEBOT)'="" SET KUNDE=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,1)   ;KUNDE DES ANGEBOTES ;customer
	
	KILL ^WWWSOR(YUSER,"ARTIKEL")
	
	;KOPF ZEILE ;heading
	DO ^WWWFRAME(2)          ;TABLE AN
	WRITE "<TR>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT WIDTH=10%"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32025)  ;MENGE MENGENEINHEIT ;quantity 
	WRITE " "
	;WRITE $$^WWWTEXT(32036)  ;BESTELLEN
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT WIDTH=10%"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32024)  ;ARTIKEL ;item 
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT WIDTH=20%"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32026)  ;BEZEICHNUNG ;notation 
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32027)  ;AUSFÜHRUNG ;execution 
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT WIDTH=10%"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(31409)  ;EINZELPREIS
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT WIDTH=10%"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32020)  ;Bestand ;Quantity
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT WIDTH=10%"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32021)  ;Anzahl ANGEBOTE ;Number 
	WRITE "</TH>"
	
	WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP align=LEFT ALIGN=LEFT WIDTH=10%"
	WRITE " BGCOLOR="_YDARKGRAY
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	WRITE $$^WWWTEXT(32022)  ;letzter lieferant ;last provider 
	WRITE "</TH>"
	
	WRITE "</TR>",YCR
	
	SET ANZM=0
	
	;STRATEGIE MUSTERANGEBOTE ;strategy 
	IF $EXTRACT(VORG(1))="#" SET NAME=$$^WWWUMLAU($EXTRACT(VORG(1),2,99),1) IF $LENGTH(NAME)>1 DO
	. NEW NAME1,ANG,ANG1
	. SET NAME1=$EXTRACT(NAME,1,$LENGTH(NAME)-1)
	. ;
	. ;  NAME already in index form - don't need to repeat ; 30-Aug-2006
	. ;FOR  SET NAME1=$ORDER(^INANGs(YM,14,$$^WWWUMLAU(NAME1,1))) QUIT:NAME1=""  QUIT:$EXTRACT(NAME1,1,$LENGTH(NAME))'=NAME  DO  QUIT:ANZM>100
	. ;
	. FOR  SET NAME1=$ORDER(^INANGs(YM,14,NAME1)) QUIT:NAME1=""  QUIT:$EXTRACT(NAME1,1,$LENGTH(NAME))'=NAME  DO  QUIT:ANZM>100
	. . SET ANG=""
	. . ;FOR  SET ANG=$ORDER(^INANGs(YM,14,$$^WWWUMLAU(NAME1,1),ANG)) QUIT:ANG=""  DO  QUIT:ANZM>100
	. . FOR  SET ANG=$ORDER(^INANGs(YM,14,NAME1,ANG)) QUIT:ANG=""  DO  QUIT:ANZM>100
	. . . SET ANG1=$GET(^INANG(YM,ANG,1)) DO
	. . . . SET ANZM=ANZM+1
	. . . . WRITE "<TR>"
	. . . . WRITE YCR
	. . . . SET YDDSATZ=YDDSATZ+1
	. . . . WRITE "<TD NOWRAP VALIGN=MIDDLE" WRITE:YDDSATZ#2=1 " BGCOLOR="_YWHITE WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. . . . WRITE "<TD NOWRAP VALIGN=MIDDLE" WRITE:YDDSATZ#2=1 " BGCOLOR="_YWHITE WRITE "><FONT SIZE=2>"_$PIECE($GET(^INANGP(YM,ANG,1,1)),Y,4)_"&nbsp;</TD>"
	. . . . WRITE "<TD NOWRAP VALIGN=MIDDLE" WRITE:YDDSATZ#2=1 " BGCOLOR="_YWHITE WRITE "><FONT SIZE=2>"_ANG_"-"_1_" "_$PIECE(ANG1,Y,8)_"</TD>"  ;POSITION
	. . . . WRITE "<TD NOWRAP VALIGN=MIDDLE" WRITE:YDDSATZ#2=1 " BGCOLOR="_YWHITE WRITE "><FONT SIZE=2>"_$PIECE($GET(^INANGP(YM,ANG,1,1)),Y,1)_"&nbsp;</TD>"  ;KOMMISSION
	. . . . WRITE "<TD NOWRAP VALIGN=MIDDLE" WRITE:YDDSATZ#2=1 " BGCOLOR="_YWHITE WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. . . . WRITE "<TD NOWRAP VALIGN=MIDDLE" WRITE:YDDSATZ#2=1 " BGCOLOR="_YWHITE WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. . . . WRITE "<TD NOWRAP VALIGN=MIDDLE" WRITE:YDDSATZ#2=1 " BGCOLOR="_YWHITE WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. . . . WRITE "<TD NOWRAP VALIGN=MIDDLE" WRITE:YDDSATZ#2=1 " BGCOLOR="_YWHITE WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. . . . WRITE "</TR>"
	
	;SONDER, ALLE ARTIKEL DES LIEFERANTEN
	IF VORG(1)="#" IF $PIECE(YFELD,Y,2)=2 IF $PIECE(YFELD,Y,12)'="" DO
	. set idxSupplier = $$^WWWUMLAU($PIECE(YFELD,Y,12),1)
	. SET ART=""
	. FOR  SET ART=$ORDER(^INARTKs(YM,1,idxSupplier,ART)) QUIT:ART=""  DO  QUIT:ANZM>50
	. . SET ART1=$GET(^INART(YM,ART,1))
	. . DO ANZ
	
	;SONDER, ALLE ARTIKEL MIT RAHMENVERTRAG
	IF $extract(VORG(1),1,2)="*R" DO
	. SET VORG(1)=""
	. SET ADR=$PIECE(YFELD,Y,1)                          ;KUNDE ;customer 
	. IF $PIECE(YFELD,Y,2)=2 SET ADR=$PIECE(YFELD,Y,12)  ;LIEFERANT ;supplier 
	. SET ART=$$^INARTRAHMEN(ADR,1)                      ;ZWISCHENSPEICHERUNG ARTIKEL ;spooling item 
	. SET ART=""
	. FOR  SET ART=$ORDER(^WWWSOR(YUSER,"RAHMEN",ART)) QUIT:ART=""  DO  QUIT:ANZM>50
	. . SET ART1=$GET(^INART(YM,ART,1))
	. . DO ANZ
	. KILL ^WWWSOR(YUSER,"RAHMEN")
	
	;	D212		$$$INVORGUseItemSuperIndex()
	IF $$$INVORGUseItemSuperIndex(objINVORG)'=$$$YES DO  ;TYBD;SEARCH IN BITMAPS;15,3,2005;27167
	. ;STRATEGIE 1 ARTIKELNUMMER ;strategy 
	. IF $EXTRACT(VORG(1))'="#" IF $EXTRACT(VORG(1))'="*" IF VORG(1)'="" IF $DATA(^INART(YM,VORG(1))) SET ART=VORG(1) DO
	. . SET ART1=$GET(^INART(YM,ART,1))
	. . DO ANZ
	. ;
	. ;STRATEGIE 2 BEZEICHNUNG GENAU ;strategy notation truly 
	. IF $EXTRACT(VORG(1))'="#" IF VORG(1)'="" IF $EXTRACT(VORG(1))'="*" SET NAME=$$^WWWUMLAU(VORG(1),1) IF NAME'="" IF $DATA(^INARTs(YM,1,NAME)) DO
	. . SET ART=""
	. . FOR  SET ART=$ORDER(^INARTs(YM,1,NAME,ART)) QUIT:ART=""  DO  QUIT:ANZM>50      ;SSOK
	. . . SET ART1=$GET(^INART(YM,ART,1))
	. . . DO ANZ
	. ;
	. ;STRATEGIE 2 EAN GENAU ;strategy UPC truly 
	. IF $EXTRACT(VORG(1))'="#" IF ANZM=0 IF VORG(1)'="" IF $EXTRACT(VORG(1))'="*" SET NAME=$$^WWWUMLAU(VORG(1),1) IF NAME'="" IF $DATA(^INARTs(YM,3,NAME)) DO
	. . SET ART=""
	. . FOR  SET ART=$ORDER(^INARTs(YM,3,NAME,ART)) QUIT:ART=""  DO  QUIT:ANZM>50      ;SSOK
	. . . SET ART1=$GET(^INART(YM,ART,1))
	. . . DO ANZ
	. ;
	. ;STRATEGIE 3 BEZEICHNUNG UNGENAU ;strategy notation inexact 
	. IF $EXTRACT(VORG(1))'="#" IF ANZM<10 IF VORG(1)'="" IF $EXTRACT(VORG(1))'="*" SET NAME=$$^WWWUMLAU(VORG(1),1) IF NAME'="" FOR  SET NAME=$ORDER(^INARTs(YM,1,NAME)) QUIT:NAME=""  QUIT:'$FIND(NAME,$$^WWWUMLAU(VORG(1),1))  DO  QUIT:ANZM>50
	. . SET ART=""
	. . FOR  SET ART=$ORDER(^INARTs(YM,1,NAME,ART)) QUIT:ART=""  DO  QUIT:ANZM>50      ;SSOK
	. . . SET ART1=$GET(^INART(YM,ART,1))
	. . . DO ANZ
	. ;
	. ;STRATEGIE 4 SUCHEN ARTIKELNUMMERN ;strategy seek 
	. ;IF $EXTRACT(VORG(1))'="#" IF ANZM<10 IF +VORG(1)'=0 FOR I=0:1:4 DO  QUIT:ANZM>50
	. IF $EXTRACT(VORG(1))'="#" IF ANZM<10 FOR I=0:1:4 DO  QUIT:ANZM>50  ;FIS;17.08.04;26292;ALPHAN. ARTIKELNUMMERN
	. . SET ART=VORG(1)_$EXTRACT("00000000",1,I)
	. . IF ART'=VORG(1) IF $DATA(^INART(YM,ART,1)) SET ART1=$GET(^INART(YM,ART,1)) DO ANZ
	. . FOR  SET ART=$ORDER(^INART(YM,ART)) QUIT:ART=""  QUIT:'$FIND(ART,VORG(1))  DO  QUIT:ANZM>50
	. . . SET ART1=$GET(^INART(YM,ART,1))
	. . . IF VORG(1)'=ART DO ANZ
	. ;
	. ;STRATEGIE 4B SUCHEN ARTIKELNUMMERN;FÜR TONY INSTALLATION UL ARTIKEL NUMMER 6851B WIRD NICHT GEFUNDEN BEI 6851 ;strategy seek to item numeral Not next to 
	. IF $EXTRACT(VORG(1))'="#" IF ANZM<10 IF +VORG(1)'=0 FOR I=1 DO  QUIT:ANZM>50
	. . SET ART=VORG(1)_$EXTRACT("     ",1,I)
	. . IF ART'=VORG(1) IF $DATA(^INART(YM,ART,1)) SET ART1=$GET(^INART(YM,ART,1)) DO ANZ
	. . FOR  SET ART=$ORDER(^INART(YM,ART)) QUIT:ART=""  QUIT:'$FIND(ART,VORG(1))  DO  QUIT:ANZM>50
	. . . SET ART1=$GET(^INART(YM,ART,1))
	. . . IF VORG(1)'=ART DO ANZ
	. ;
	. ;STRATEGIE 5 SUCHEN VOLLTEXT MODELL ;strategy seek full text 
	. IF $EXTRACT(VORG(1))'="#" IF ANZM=0 IF VORG(1)'="" IF $EXTRACT(VORG(1))'="*" SET NAME="" FOR  SET NAME=$ORDER(^INARTs(YM,1,NAME)) QUIT:NAME=""  IF $FIND(NAME,$$^WWWUMLAU(VORG(1),1)) DO  QUIT:ANZM>50
	. . SET ART=""
	. . FOR  SET ART=$ORDER(^INARTs(YM,1,NAME,ART)) QUIT:ART=""  DO  QUIT:ANZM>50      ;SSOK
	. . . SET ART1=$GET(^INART(YM,ART,1))
	. . . DO ANZ
	. ;
	. ;STRATEGIE 6 SUCHEN VOLLTEXT ARTIKEL ;strategy seek full text item 
	. IF $EXTRACT(VORG(1))'="#" IF ANZM=0 IF $EXTRACT(VORG(1))="*" SET VORG(1)=$$^WWWUMLAU($EXTRACT(VORG(1),2,99),1) SET NAME="" FOR  SET NAME=$ORDER(^INARTs(YM,1,NAME)) QUIT:NAME=""  DO  QUIT:ANZM>50
	. . SET ART=""
	. . FOR  SET ART=$ORDER(^INARTs(YM,1,NAME,ART)) QUIT:ART=""  DO  QUIT:ANZM>50      ;SSOK
	. . . SET ART1=$GET(^INART(YM,ART,1))
	. . . IF VORG(1)="" DO ANZ QUIT                           ;NUR *=ALLES ;only 
	. . . IF $FIND($$^WWWUMLAU(ART1_Y_ART,1),VORG(1)) DO ANZ  ;NUR BESTIMMTE ;only 
	
	;BITMAPSUCHE
	IF $$$INVORGUseItemSuperIndex(objINVORG)=$$$YES DO  ;TYBD;SEARCH IN BITMAPS;15,3,2005;27167
	. NEW YFORM,YOK,SEL
	. SET YFORM="INART"
	. KILL ^WWWSOR(YUSER,"KEY")
	. KILL ^WWWSOR(YUSER,"SEL")
	. SET YOK=$$^WWWBITSEARCH(VORG(1),"INART")
	. SET ART=""
	. FOR  SET ART=$ORDER(^WWWSOR(YUSER,"SEL",ART)) QUIT:ART=""  DO  QUIT:ANZM>50    ;BITSUCHE
	. . SET ART1=$GET(^INART(YM,ART,1))
	. . DO ANZ 
	. ;
	. KILL ^WWWSOR(YUSER,"KEY")
	. KILL ^WWWSOR(YUSER,"SEL")
	
	
	;STRATEGIE 7 SUCHEN ALTERNATIVE ARTIKELSUCHE ;strategy seek option 
	IF $EXTRACT(VORG(1))'="#" IF ANZM<10 DO    ;TYBD;25563;17,4,2004
	. SET ART=""
	. FOR  SET ART=$ORDER(^INARTXCHs(YM,1,$$^WWWUMLAU(VORG(1),1),ART)) QUIT:ART=""  DO  QUIT:ANZM>50    ;SSOK
	. . SET ART1=$GET(^INART(YM,ART,1))
	. . DO ANZ  
	
	IF ANZM=0 DO   ;KEIN DATENSATZ GEFUNDEN ;no data record 
	. WRITE "<TR>"
	. SET YDDSATZ=YDDSATZ+1
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. ;
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. ;
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. ;
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. ;
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. ;
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. ;
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. ;
	. WRITE "<TD NOWRAP VALIGN=TOP"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE "><FONT SIZE=2>&nbsp;</TD>"
	. ;
	. WRITE "</TR>",YCR
	
	DO ^WWWFRAME(1)   ;TABLE AUS ;out of 
	WRITE YCR
	IF ANZM=0  WRITE "<FONT COLOR="_YRED_"><B>&nbsp;"_$$^WWWTEXT(32953)_"</B></FONT><BR>" WRITE YCR   ;KEINE ARTIKEL GEFUNDEN
	IF ANZM>49 WRITE "<B>"_$$^WWWTEXT(32111)_"</B>"  ;Weitere Artikel vorhanden.... Suche einschränken!
	
	WRITE "<BR>"
	
	KILL ^WWWSOR(YUSER,"ARTIKEL")
	
	;;-------------------------------------------
	;;MANUELLE SUCHFUNKTION DER ARTIKELPOSITIONEN ;the 
	;DO ^INANGANZ(YANGEBOT)
	;;-------------------------------------------
	QUIT
	
ANZ ;
	new objINVORG
	
	QUIT:$DATA(^WWWSOR(YUSER,"ARTIKEL",ART))
	SET ^WWWSOR(YUSER,"ARTIKEL",ART)=""
	
	set objINVORG = $get(^INVORG(YM,YM,1))          ; 30-Aug-2006
	
	;anzeige suchergebnis auswahl der Menge ;Selection who Quantity 
	IF $PIECE(ART1,Y,26)=5  QUIT  ;PHANTOMARTIKEL 
	
	;EIGENANGEBOT
	IF $PIECE(YFELD,Y,2)=1 IF $PIECE(ART1,Y,26)'=0 IF $PIECE(ART1,Y,26)'=3 IF $PIECE(ART1,Y,26)'=2 QUIT  ;NUR LEISTUNGEN UND EIGENFERTIGUNG BEI INNTERNEM ANGEBOT ;only LEISTUNGEN And next to quote 
	
	;LIEFERANTEN BESTELLUNG ;sales order 
	IF $PIECE(YFELD,Y,2)=2 IF $PIECE(ART1,Y,26)'=0 IF $PIECE(ART1,Y,26)'=1 IF $PIECE(ART1,Y,26)'=4 QUIT  ;NUR BESTELLUNG UND KLEINTEILE BER BESTELLUNGEN  ;only sales order And 
	
	IF $GET(NOLIST)=1  IF $PIECE(ART1,Y,26)=7 QUIT  ;FIS;29.07.03;24061;KEINE KONFIGURATIONSARTIKEL IN SEPARATEM FENSTER
	
	SET ANZM=ANZM+1
	WRITE "<TR>"
	WRITE YCR
	SET YDDSATZ=YDDSATZ+1
	
	;MENGE ;quantity 
	WRITE "<TD NOWRAP VALIGN=MIDDLE"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	
	;MENGENAUSWAHL
	IF $PIECE(ART1,Y,26)'=7 DO
	. WRITE $$^WWWTEXT(31407)_" <BR>"      ;MENGE ;quantity 
	. WRITE "<INPUT NAME=YMNG"_ART_" SIZE=10 MAXLENGTH=10 TYPE=float VALUE="""""
	. WRITE " TABINDEX=ART style=""padding-top:0 ;padding-bottom:0"" style=""text-align:right"""
	. ;WRITE " onChange='submit();'"
	. WRITE "  onFocus='select();'"
	. IF $GET(YHTMFORM)="WWW2" WRITE " onBlur='retval = EventValue("""_YUCI_""","""_YUSER_""","""_YFORM_""",""FIX"_$GET(YKEY)_""","""",this.value,""0"",""YMNG"_ART_""");'"
	. ;IF $GET(YHTMFORM)="WWW2" WRITE " onBlur='document.WWW.ITEMS.value="""_ART_""";document.WWW.ITEMSQ.value=this.value;'"
	. WRITE ">"
	
	IF $PIECE(ART1,Y,26)=7 DO  ;FIS;01.04.03;23155;KONFIGURATIONSARTIKEL
	. NEW YKEY
	. WRITE "<A HREF="""_YAKTION_"EP=WWWMANU1&YEXEC=D|CALL^INKONFIG('"_ART_"')&YKEY="_YANGEBOT  ;LINK SETZEN ;typeset 
	. DO ^WWWCGI
	. WRITE """"
	. WRITE " TARGET=""TEILEFRAME2"""
	. WRITE ">"
	. WRITE "<img src="""_YGIF_"menu.gif""border=0 WIDTH=22 HEIGHT=22 TITLE="""_$$^WWWTEXT(33360)_"""></A>"  ;ARTIKEL KONFIGURIEREN ;item configure 
	. WRITE "&nbsp;"_$$^WWWTEXT(33360)  ;ARTIKEL KONFIGURIEREN
	. WRITE YCR
	
	SET GUELTIG=1
	SET GUEDAT=$PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,19)  ;LIEFERTERMIN ;time of delivery 
	IF GUEDAT="" SET GUEDAT=+$HOROLOG
	IF $PIECE(ART1,Y,201)'="" IF +$PIECE(ART1,Y,201)>GUEDAT SET GUELTIG=0  ;GÜLTIGKEITSDATUM NOCH NICHT ERREICHT ;yet Not 
	IF $PIECE(ART1,Y,202)'="" IF +$PIECE(ART1,Y,202)<GUEDAT SET GUELTIG=0  ;GÜLTIGKEITSDATUM ÜBERSCHRITTEN
	
	IF $PIECE(ART1,Y,30)'="" IF $GET(KUNDE)'="" IF $PIECE($GET(^INKUNDEK(YM,KUNDE,$PIECE(ART1,Y,30),1)),Y,25)=1 SET $PIECE(ART1,Y,66)=4 ;SET GUELTIG=0 ;TYBD;9,12,2004;WARENGRUPPE NICHT FÜR DEN KUNDEN
	
	;ARTIKELSPERRE
	IF GUELTIG=1 IF $PIECE(ART1,Y,66)'="" IF $PIECE(ART1,Y,66)'=0 DO  ;BEC;25.0]]><![CDATA[3.03;23362;ARTIKELSPERRE
	. NEW COLOR
	. SET COLOR=$PIECE($GET(^WWW101(0,"SPERRE",SPRACHE,$PIECE(ART1,Y,66),1)),Y,2)
	. IF COLOR'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR,1)),Y,1)
	. IF COLOR=""  SET COLOR=YRED  ;ARTIKEL  BEC:05.03.03 ;item 
	. WRITE "<FONT COLOR="""_COLOR_""">"
	
	IF GUELTIG=0 WRITE "<FONT COLOR="""_YRED_""">"
	WRITE "&nbsp;"
	
	;MENGENEINHEIT
	IF $PIECE(ART1,Y,26)'=7 DO
	. IF +$PIECE(ART1,Y,46)=0 SET $PIECE(ART1,Y,46)=+$PIECE(ART1,Y,40)  ;VERKAUFSEINHEIT=MENGENEINHEIT
	. IF +$PIECE(ART1,Y,46)=0 SET $PIECE(ART1,Y,46)=1  ;STUECK
	. IF '$DATA(^WWW101(0,"EINHEIT",SPRACHE,+$PIECE(ART1,Y,46),1)) SET $PIECE(ART1,Y,46)=1  ;STUECK
	. IF +$PIECE(ART1,Y,46)'=0 WRITE $PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,+$PIECE(ART1,Y,46),1)),Y,1)  ;EINHEIT ;unity 
	. ;		D164		$$$INVORGExtraOKButtonLineItemCrea()
	. IF $$$INVORGExtraOKButtonLineItemCrea(objINVORG)=$$$YES DO  ;MIT EXTRA OK BUTTON ;by means of extra 
	. . WRITE "<A onClick='return doLink(this)' HREF=""JavaScript:SAVENOW();"">"_YCR		//SR13195
	. . WRITE "<IMG SRC="""_YGIF_"ok.gif"" ALIGN=RIGHT TITLE=ok border=0></A>"
	
	//IF +$PIECE(ART1,Y,66)'=0 DO  ;AUSLAUF ODER GESPERRTER ARTIKEL ;runout Or item 
	. //WRITE "<BR>"
	. //WRITE $PIECE($GET(^WWW101(0,"SPERRE",SPRACHE,$PIECE(ART1,Y,66),1)),Y,1)
	
	IF GUELTIG=0 DO  ;ARTIKELGÜLTIGKEIT PRÜFEN ! ;sift 
	. WRITE "<BR>"
	. WRITE $$^WWWTEXT(32541)
	
	WRITE "&nbsp;"
	
	IF $DATA(^INARTR(YM,ART)) DO   ;WENN ARTIKEL RABATTSTAFFEL HAT, GESAMTMENGE EINTRAGEN UM PREISE ZU ÄNDEREN. FAN 26.11.01
	. WRITE "<BR>"
	. DO
	. . NEW YKEY,YBACK
	. . WRITE "<A HREF="""_YAKTION_"EP=WWWFORM&YFORM=INARTR&YKEY="_ART
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TITLE="""_$$^WWWTEXT(32772)_""""      ;GESAMTMENGE FÜR ARTIKELRABATTSTAFFEL BERECHNUNG ;to 
	. . WRITE " TARGET=TEILEFRAME2"
	. . WRITE ">"
	. . WRITE YCR
	. ;
	. WRITE $$^WWWTEXT(32214)_"... <BR>"     ;AUFTRAG GESAMTMENGE ;mandate 
	. ;WRITE $$^WWWTEXT(32223)_" "_$$^WWWTEXT(31407)_": <BR>"     ;MENGERABATT GESAMTMENGE
	. WRITE "</A>"
	. WRITE "<INPUT NAME=YGM"_ART_" SIZE=10 MAXLENGTH=200 TYPE=TEXT VALUE="""""
	. WRITE " TABINDEX=ART style=""padding-top:0 ;padding-bottom:0"" style=""text-align:right"""
	. WRITE "  onFocus='select();'"
	. IF $GET(YHTMFORM)="WWW2" WRITE " onBlur='retval = EventValue("""_YUCI_""","""_YUSER_""","""_YFORM_""",""FIX"_$GET(YKEY)_""","""",this.value,""0"",""YGM"_ART_""");'"
	. ;IF $GET(YHTMFORM)="WWW2" WRITE " onBlur='document.WWW.ITEMSG.value="""_ART_""";document.WWW.ITEMSGQ.value=this.value;'"
	. WRITE ">"
	. WRITE "&nbsp;"
	. ;MENGENEINHEIT
	. IF +$PIECE(ART1,Y,46)=0 SET $PIECE(ART1,Y,46)=+$PIECE(ART1,Y,40)  ;VERKAUFSEINHEIT=MENGENEINHEIT
	. IF +$PIECE(ART1,Y,46)=0 SET $PIECE(ART1,Y,46)=1  ;STUECK
	. IF '$DATA(^WWW101(0,"EINHEIT",SPRACHE,+$PIECE(ART1,Y,46),1)) SET $PIECE(ART1,Y,46)=1  ;STUECK
	. IF +$PIECE(ART1,Y,46)'=0 WRITE $PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,+$PIECE(ART1,Y,46),1)),Y,1)  ;EINHEIT ;unity 
	
	IF $PIECE(ART1,Y,138)'="" do  ;TYBD;21,4,2001
	. WRITE "<br>"
	. WRITE $$^WWWTEXT(33852)_" "_$PIECE(ART1,Y,138)_" "  ;PREISEINHEIT ;TYBD;21,4,2004
	
	IF $PIECE($GET(^INDRPITEM(YM,YLOCATION,ART,1)),Y,24)'="" do  ;TYBD;21,4,2001
	. WRITE "<br>"
	. WRITE $$^WWWTEXT(33853)_" = "_$PIECE($GET(^INDRPITEM(YM,YLOCATION,ART,1)),Y,24)_" "  ;standard bestellmenge ;TYBD;21,4,2004
	
	IF $DATA(^INARTPACK(YM,ART)) DO   ;TYBD;17,4,2004;25565;PACKUNGSEINHEITEN ANZEIGEN
	. NEW PACK
	. SET PACK(1)="" FOR  SET PACK(1)=$ORDER(^INARTPACK(YM,ART,PACK(1))) QUIT:PACK(1)=""  DO
	. . SET PACK(2)=$GET(^INARTPACK(YM,ART,PACK(1),1))
	. . IF PACK(2)'="" DO
	. . . WRITE "<BR>"
	. . . WRITE "1 "
	. . . WRITE $PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,PACK(1),1)),Y,1)
	. . . WRITE " = "
	. . . WRITE $PIECE(PACK(2),Y,1)
	. . . IF $PIECE(PACK(2),Y,2)'="" WRITE " "_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(PACK(2),Y,2),1)),Y,1)
	
	;IF $PIECE(ART1,Y,26)=3 IF $PIECE(ART1,Y,56)=1 DO   ;WENN EIGENPRODUKTION UND SERIENNUMMER DANN FRAGE NACH SERIENNUMMER
	;.WRITE "<BR>"
	;.WRITE "SN:" 
	;.WRITE "<INPUT NAME=YSERI"_ART_" SIZE=10 MAXLENGTH=20 TYPE=TEXT VALUE=""+"""
	;.WRITE " TABINDEX=ART style=""padding-top:0 ;padding-bottom:0"" style=""text-align:left"""
	;.WRITE "  onFocus='select();'"
	;.WRITE ">"
	
	IF $PIECE(ART1,Y,26)'=7 DO   ;ALTERNATIVARTIKEL BEI ANGEBOTEN ;next to 
	. WRITE YCR
	. WRITE "<BR>"
	. WRITE $$^WWWTEXT(32179)
	. WRITE "<INPUT TYPE=""CHECKBOX"" NAME=""YALTN"_ART_""" VALUE="""""
	. WRITE ">"
	
	WRITE "</TD>"
	WRITE YCR
	
	;ARTIKEL NUMMER ;item numeral 
	WRITE "<TD NOWRAP ALIGN=LEFT VALIGN=MIDDLE"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF GUELTIG=1 IF $PIECE(ART1,Y,66)'="" IF $PIECE(ART1,Y,66)'=0 DO  ;BEC;25.03.03;23362;ARTIKELSPERRE
	. NEW COLOR
	. SET COLOR=$PIECE($GET(^WWW101(0,"SPERRE",SPRACHE,$PIECE(ART1,Y,66),1)),Y,2)
	. IF COLOR'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR,1)),Y,1)
	. IF COLOR=""  SET COLOR=YRED  ;ARTIKEL  BEC:05.03.03 ;item 
	. WRITE "<FONT COLOR="""_COLOR_""">"
	
	IF GUELTIG=0 WRITE "<FONT COLOR="""_YRED_""">"
	
	;ZUSATZARTIKEL VERKAUF ;sale 
	WRITE "<A"
	WRITE " TITLE="""
	DO
	. NEW YI
	. QUIT:'$DATA(^INARTZUS(YM,ART))
	. WRITE $$^WWWTEXT(32182)   ;ZUSATZARTIKEL
	. SET YI="" FOR  SET YI=$ORDER(^INARTZUS(YM,ART,YI)) QUIT:YI=""  DO
	. . WRITE $CHAR(13)
	. . WRITE "("_YI_") "_$PIECE($GET(^INART(YM,YI,1)),Y,1)_" / "_$PIECE($GET(^INARTZUS(YM,ART,YI)),Y,1)
	
	WRITE """"
	WRITE " HREF=""#"">"
	WRITE ART
	WRITE "</A>"
	
	;-----------------------------------------------ZEICHNUNG
	IF +ART=ART IF +YANGEBOT=YANGEBOT DO
	. IF $DATA(^INARTMAP(YM,ART,1)) DO  ;BILDMAP VORHANDEN ;on hand 
	. . NEW YBACK
	. . QUIT:$PIECE($GET(^(1)),Y,1)=""
	. . QUIT:'$DATA(^INARTMAP1(YM,ART))
	. . WRITE "&nbsp;"
	. . WRITE "<INPUT TYPE=BUTTON NAME='Button' onClick='var menue=window.open("
	. . ;"http://172.16.0.11/bin/zeichnung.gif"
	. . WRITE """"_YAKTION_"EP=WWWMANU&YFORM=INARTMAP&YEXEC=D|^INARTMAPZ("_ART_","_YANGEBOT_",1)"
	. . DO ^WWWCGI
	. . WRITE """,""DOK"",""HEIGHT=600,WIDTH=600,SCROLLBARS=YES,RESIZEABLE=YES"");menue.focus();' VALUE=''>"
	
	DO   ;BILD ;portrait 
	. IF $PIECE(ART1,Y,54)'="" DO  ;BILD VORHANDEN ;portrait on hand 
	. . NEW YINHALT,OPT,URL,strYINHALT,strYGIF1
	. . SET YINHALT=YGIF1_$PIECE(ART1,Y,54)
	. . IF $FIND(YINHALT,"\") DO   ;WENN GLEICHES VERZEICHNIS ABER MIT \ ;when same tabulation yet by means of 
	. . . SET YINHALT=$TRANSLATE(YINHALT,"\","/")
	. . . ;IF $FIND($$^WWWLOW(YINHALT),$$^WWWLOW(YGIF1)) SET YINHALT=YGIF1_$PIECE($$^WWWLOW(YINHALT),$$^WWWLOW(YGIF1),2,999) QUIT
	. . . set strYINHALT=$zconvert(YINHALT,"L")
	. . . set strYGIF1=$zconvert(YGIF1,"L")
	. . . IF $FIND(strYINHALT,strYGIF1) SET YINHALT=YGIF1_$PIECE(strYINHALT,strYGIF1,2,999) QUIT
	. . ;
	. . WRITE YCR
	. . SET YURL=""  ;$PIECE($GET(^WWW012(0,YM,1)),Y,44)  ;FIS;22903;15.04.03
	. . SET OPT="HEIGHT=300,WIDTH=300,SCROLLBARS=YES,RESIZEABLE=YES"
	. . SET URL=""_YURL_YINHALT
	. . WRITE "<INPUT TYPE=BUTTON NAME='B"_ART_"' onClick='var menue=window.open("""_URL_""",""DOK"","""_OPT_""");menue.focus();' VALUE='"
	. . WRITE "'>"
	
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;BEZEICHNUNG ;notation 
	WRITE "<TD NOWRAP VALIGN=MIDDLE"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF GUELTIG=1 IF $PIECE(ART1,Y,66)'="" IF $PIECE(ART1,Y,66)'=0 DO  ;BEC;25.03.03;23362;ARTIKELSPERRE
	. NEW COLOR
	. SET COLOR=$PIECE($GET(^WWW101(0,"SPERRE",SPRACHE,$PIECE(ART1,Y,66),1)),Y,2)
	. IF COLOR'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR,1)),Y,1)
	. IF COLOR=""  SET COLOR=YRED  ;ARTIKEL  BEC:05.03.03 ;item 
	. WRITE "<FONT COLOR="""_COLOR_""">"
	
	IF GUELTIG=0 WRITE "<FONT COLOR="""_YRED_""">"
	WRITE $PIECE(ART1,Y,1)
	WRITE "&nbsp;"
	
	DO  ;ZUSATZARTIKEL
	. NEW YI
	. QUIT:'$DATA(^INARTZUS(YM,ART))
	. WRITE "<BR>"
	. WRITE YCR
	. WRITE "<B>"
	. WRITE $$^WWWTEXT(32182)_":"   ;ZUSATZARTIKEL
	. WRITE "</B>"
	. SET YI=""
	. FOR  SET YI=$ORDER(^INARTZUS(YM,ART,YI)) QUIT:YI=""  DO
	. . new MENGE,EINHEIT
	. . SET MENGE=$PIECE($GET(^INARTZUS(YM,ART,YI,1)),Y,5)
	. . IF MENGE="" SET MENGE=1
	. . IF +MENGE<0 SET MENGE=(-1)*MENGE
	. . SET EINHEIT=""
	. . IF $PIECE($GET(^INART(YM,YI,1)),Y,40)'="" SET EINHEIT=$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE($GET(^INART(YM,YI,1)),Y,40),1)),Y,1)
	. . WRITE "<BR>",YCR
	. . WRITE "<A"
	. . WRITE " TITLE="""_$$^WWWTEXT(31407)_": "_MENGE_" "_EINHEIT_$CHAR(13)_$$^WWWTEXT(32020)_": "_$$^INARTMENGE(YI,,BESTBETR)_" "_EINHEIT_"""" 
	. . WRITE " HREF=""#"""
	. . WRITE ">"
	. . WRITE ""_YI_" "_$PIECE($GET(^INART(YM,YI,1)),Y,1) ;$PIECE($GET(^INARTZUS(YM,ART,YI)),Y,1)
	. . WRITE "</A>"
	
	DO  ;loyalty points ; tybd ;12,09,2003
	. NEW YI
	. QUIT:+$PIECE(ART1,Y,334)=0  ;KEINE PUNKTE ;no 
	. WRITE "<BR>"
	. WRITE YCR
	. WRITE "<B>"
	. WRITE $$^WWWTEXT(33593)_": "_+$PIECE(ART1,Y,334)   ;PUNKTE
	. WRITE "</B>"
	
	DO  ;ALTERNATIVARTIKEL
	. NEW YI
	. QUIT:'$DATA(^INARTA(YM,ART))
	. WRITE "<BR>"
	. WRITE YCR
	. WRITE "<B>"
	. WRITE $$^WWWTEXT(32033)_":"   ;ZUSATZARTIKEL
	. WRITE "</B>"
	. SET YI=""
	. FOR  SET YI=$ORDER(^INARTA(YM,ART,YI)) QUIT:YI=""  DO
	. . WRITE "<BR>",YCR
	. . WRITE "<A"
	. . IF $PIECE($GET(^INART(YM,YI,1)),Y,40)'="" WRITE " TITLE="""_$$^WWWTEXT(32020)_": "_$$^INARTMENGE(YI,,BESTBETR)_" "_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE($GET(^INART(YM,YI,1)),Y,40),1)),Y,1)_"""" 
	. . WRITE " HREF=""#"""
	. . WRITE ">"
	. . WRITE ""_YI_" "_$PIECE($GET(^INART(YM,YI,1)),Y,1) ;$PIECE($GET(^INARTZUS(YM,ART,YI)),Y,1)
	. . WRITE "</A>"
	
	;UNERLAUBTE ZUSATZARTIKEL BEC 07.03.03
	DO 
	. NEW UNART,UNART1,POS,POS1
	. QUIT:YANGEBOT=""
	. SET UNART=""
	. SET POS=""
	. FOR  SET POS=$ORDER(^INANGP(YM,YANGEBOT,POS)) QUIT:POS=""  DO
	. . SET POS1=$GET(^INANGP(YM,YANGEBOT,POS,1))
	. . QUIT:POS1=""
	. . QUIT:ART=""
	. . IF $DATA(^INARTKONTRA(YM,ART,$PIECE(POS1,Y,4),1))  DO
	. . . QUIT:$FIND(UNART,$PIECE(POS1,Y,4))
	. . . WRITE "<FONT COLOR="""_YRED_""">"
	. . . SET UNART1=$GET(^INARTKONTRA(YM,ART,$PIECE(POS1,Y,4),1))
	. . . IF UNART="" WRITE "<BR>"_$$^WWWTEXT(33317)_"</FONT>"    ;UNERLAUBTE ZUSATZARTIKEL
	. . . ;
	. . . WRITE "<A"
	. . . WRITE " TITLE="""_$TRANSLATE($EXTRACT($PIECE(UNART1,Y,2),0,1000),"|",YCR)
	. . . IF $LENGTH($TRANSLATE($PIECE(UNART1,Y,2),"|",YCR))>1000 WRITE ".. "
	. . . WRITE """"
	. . . WRITE " HREF=""#"""
	. . . WRITE ">"
	. . . WRITE "<FONT COLOR="""_YRED_""">"
	. . . WRITE "<BR>"_$PIECE(POS1,Y,4)," ",$PIECE(POS1,Y,1)
	. . . SET UNART=$GET(UNART)_Y_$PIECE(POS1,Y,4)
	. . . WRITE "</FONT>"
	. . . WRITE "</A>"
	
	WRITE "</TD>",YCR
	
	;AUSFÜHRUNG ;execution 
	WRITE "<TD VALIGN=MIDDLE"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF GUELTIG=1 IF $PIECE(ART1,Y,66)'="" IF $PIECE(ART1,Y,66)'=0 DO  ;BEC;25.03.03;23362;ARTIKELSPERRE
	. NEW COLOR
	. SET COLOR=$PIECE($GET(^WWW101(0,"SPERRE",SPRACHE,$PIECE(ART1,Y,66),1)),Y,2)
	. IF COLOR'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR,1)),Y,1)
	. IF COLOR=""  SET COLOR=YRED  ;ARTIKEL  BEC:05.03.03 ;item 
	. WRITE "<FONT COLOR="""_COLOR_""">"
	
	IF GUELTIG=0 WRITE "<FONT COLOR="""_YRED_""">"
	WRITE $EXTRACT($TRANSLATE($PIECE(ART1,Y,14),"|"," "),1,30)
	IF $LENGTH($PIECE(ART1,Y,14))>30 WRITE "..."
	WRITE "&nbsp;"
	IF $DATA(^INARTT(YM,ART)) DO  ;ARTIKELTEILE
	. IF $PIECE(ART1,Y,14)'="" WRITE "<BR>"
	. WRITE $$^WWWTEXT(32014)  ;ARTIKELTEILEDATEI VORHANDEN ;on hand 
	
	WRITE "</TD>",YCR
	
	;PREIS ;price 
	WRITE "<TD NOWRAP ALIGN=RIGHT VALIGN=MIDDLE"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF GUELTIG=1 IF $PIECE(ART1,Y,66)'="" IF $PIECE(ART1,Y,66)'=0 DO  ;BEC;25.03.03;23362;ARTIKELSPERRE
	. NEW COLOR
	. SET COLOR=$PIECE($GET(^WWW101(0,"SPERRE",SPRACHE,$PIECE(ART1,Y,66),1)),Y,2)
	. IF COLOR'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR,1)),Y,1)
	. IF COLOR=""  SET COLOR=YRED  ;ARTIKEL  BEC:05.03.03 ;item 
	. WRITE "<FONT COLOR="""_COLOR_""">"
	
	IF GUELTIG=0 WRITE "<FONT COLOR="""_YRED_""">"
	
	DO
	. NEW LIEF,VALID   ;TYBD;14,11,2004;VALID UNTIL;26779;
	. SET LIEF=""
	. IF $PIECE($GET(^INAUF1(YM,YANGEBOT,1)),Y,2)=2 SET LIEF=$PIECE($GET(^INAUF(YM,YANGEBOT,1)),Y,12)
	. IF LIEF="" SET LIEF=$ORDER(^INARTK(YM,ART,""))
	. QUIT:LIEF=""
	. ;	D14		$$$INARTKPriceValidUntil()
	. SET VALID=$$$INARTKPriceValidUntil($GET(^INARTK(YM,ART,LIEF,1)))
	. QUIT:VALID=""
	. IF VALID<$HOROLOG DO
	. . WRITE "<FONT COLOR="""_YRED_""">"
	. . WRITE "->"_$$^WWWDATE(VALID),"<BR>"
	
	;IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=0 DO  ;PREIS BEI KUNDENANGEBOT
	;. IF KUNDE'="" IF $DATA(^INKUNDEP(YM,KUNDE,ART)) DO   ;KUNDENPREISE
	;. . NEW KUNDEP,ABDATUM
	;. . SET ABDATUM=$ORDER(^INKUNDEP(YM,KUNDE,ART,+$H+1),-1)   ;TYBD;12.04.2003;ABDATUM
	;. . QUIT:ABDATUM<10000
	;. . SET KUNDEP=^INKUNDEP(YM,KUNDE,ART,ABDATUM,1)
	;. . SET $PIECE(KUNDEP,Y,2)=ABDATUM
	;. . IF $PIECE(KUNDEP,Y,2)'="" QUIT:$PIECE(KUNDEP,Y,2)>$HOROLOG   ;AB GÜLTIG
	;. . IF $PIECE(KUNDEP,Y,3)'="" QUIT:$PIECE(KUNDEP,Y,3)<$HOROLOG   ;BIS GÜLTIG
	;. . IF +$PIECE(KUNDEP,Y,1)'=0 SET $PIECE(ART1,Y,88)=$PIECE(KUNDEP,Y,1)  ;KUNDENPREIS VORGEBEN
	
	IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=0 DO  ;PREIS BEI KUNDENANGEBOT ;price next to 
	. SET $PIECE(ART1,Y,88)=$$^INSALESPRICE(ART,,YLOCATION,$PIECE(ART1,Y,90),KUNDE,+$HOROLOG)  ;VERKAUFSPREIS  ;FIS;23477;03.06.03
	
	IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)'=0 DO  ;PREIS BEI BESTELLUNG = EK ;price next to sales order Planned Cost 
	. SET $PIECE(ART1,Y,88)=$$^INARTKOST(ART,1)   ;EINKAUFSPREIS
	
	IF $PIECE(ART1,Y,26)'=7 WRITE $$^WWWZAHL($PIECE(ART1,Y,88),10,2,YWHR)   ;ERSTER PREIS  ;FIS;01.04.03;23155;KONFIGURATIONSARTIKEL=KEIN PREIS
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;BESTANDSMENGE
	WRITE "<TD VALIGN=MIDDLE ALIGN=RIGHT "
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF GUELTIG=1 IF $PIECE(ART1,Y,66)'="" IF $PIECE(ART1,Y,66)'=0 DO  ;BEC;25.03.03;23362;ARTIKELSPERRE
	. NEW COLOR
	. SET COLOR=$PIECE($GET(^WWW101(0,"SPERRE",SPRACHE,$PIECE(ART1,Y,66),1)),Y,2)
	. IF COLOR'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR,1)),Y,1)
	. IF COLOR=""  SET COLOR=YRED  ;ARTIKEL  BEC:05.03.03 ;item 
	. WRITE "<FONT COLOR="""_COLOR_""">"
	
	IF GUELTIG=0 WRITE "<FONT COLOR="""_YRED_""">"
	SET MENGE=$$^INARTMENGE(ART)
	IF +MENGE'=0 DO
	. WRITE "<A HREF=""#"""
	. WRITE " TITLE="""_$$^WWWTEXT(33690)  ;Projeted Available Balance
	. ;		D70		$$$INVORGDRPActivated()
	. IF $$$INVORGDRPActivated(objINVORG)=$$$YES WRITE ": "_$$^INATP1(ART,,,,1)  ;ATP MENGE;FIS;01.12.03;24599
	. WRITE """"
	. WRITE ">"
	. WRITE MENGE
	. WRITE "</A>"
	
	;I '$D(^INARTT(YM,ART)) W $$^WWWTEXT(32019)   ;KEINE TEILE
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;MENGE AUFTRÄGE ;quantity
	WRITE "<TD VALIGN=MIDDLE ALIGN=RIGHT"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF GUELTIG=1 IF $PIECE(ART1,Y,66)'="" IF $PIECE(ART1,Y,66)'=0 DO  ;BEC;25.03.03;23362;ARTIKELSPERRE
	. NEW COLOR
	. SET COLOR=$PIECE($GET(^WWW101(0,"SPERRE",SPRACHE,$PIECE(ART1,Y,66),1)),Y,2)
	. IF COLOR'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR,1)),Y,1)
	. IF COLOR=""  SET COLOR=YRED                ;ARTIKEL  BEC:05.03.03 ;item 
	. WRITE "<FONT COLOR="""_COLOR_""">"
	
	IF GUELTIG=0 WRITE "<FONT COLOR="""_YRED_""">"
	SET MENGE=$$^INARTANG(ART)
	IF +MENGE'=0 WRITE MENGE
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;LETZTER LIEFERANT ;last supplier 
	WRITE "<TD NOWRAP VALIGN=MIDDLE ALIGN=LEFT"
	IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	IF GUELTIG=1 IF $PIECE(ART1,Y,66)'="" IF $PIECE(ART1,Y,66)'=0 DO  ;BEC;25.03.03;23362;ARTIKELSPERRE
	. NEW COLOR
	. SET COLOR=$PIECE($GET(^WWW101(0,"SPERRE",SPRACHE,$PIECE(ART1,Y,66),1)),Y,2)
	. IF COLOR'="" SET COLOR=$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR,1)),Y,1)
	. IF COLOR=""  SET COLOR=YRED                ;ARTIKEL  BEC:05.03.03 ;item 
	. WRITE "<FONT COLOR="""_COLOR_""">"
	
	IF GUELTIG=0 WRITE "<FONT COLOR="""_YRED_""">"
	SET LIEF=$$^INARTLIEF(ART)
	IF $PIECE($GET(^INANG(YM,YANGEBOT,1)),Y,2)=2 SET LIEF=$PIECE(^(1),Y,12)  ;LIEFERANT BEI LF-ANFRAGE;FIS;23.03.04;25398
	IF LIEF'="" WRITE $PIECE($GET(^INLIEF(YM,LIEF,1)),Y,8)
	IF LIEF'="" IF $DATA(^INARTK(YM,ART,LIEF)) DO  ;ARTIKEL-LIEFERANTEN-PREIS;FIS;23.03.04;25398
	. NEW KOND
	. SET KOND=$GET(^INARTK(YM,ART,LIEF,1))
	. IF $PIECE(KOND,Y,12)'="" WRITE "<BR>"_$$^WWWFELDNAME("INARTK","D",12)_": "_$$^WWWZAHL($PIECE(KOND,Y,12),0,2,YWHR)  ;PREIS VEREINBARUNG ;price 
	. IF $PIECE(KOND,Y,18)'="" WRITE "<BR> ("_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(KOND,Y,18),1)),Y,1)_")"
	
	WRITE "&nbsp;"
	WRITE "</TD>"
	
	WRITE "</TR>",YCR
	QUIT
	
TEILE ;AUFBAUEN DER TEILE ;construct the 
	NEW SUCH,YYI,SUCH1
	
	SET SUCH="^INANGPXL("""_YM_""","""_YANGEBOT_""","_YPOS_")"
	FOR  DO  QUIT:SUCH=""
	. SET SUCH=$QUERY(@SUCH)
	. IF $TRANSLATE($PIECE(SUCH,",",2),"""")'=YANGEBOT SET SUCH="" QUIT  ;21.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. ;IF $PIECE(SUCH,",",2)'=YANGEBOT SET SUCH="" QUIT  ;21.06.04;FAN;25794; WENN alphanumerischen Auftragsnummern SOLL DATEN AUCH AUFBAUEN.
	. IF $PIECE(SUCH,",",3)=YPOS DO
	. . SET SUCH1=@SUCH
	. . SET SUCH(1)=$PIECE($PIECE(SUCH,")",1),",",4,99)
	. . SET SUCH(0)=$LENGTH(SUCH(1),",")  ;ANZAHL DER ,
	. . ;
	. . ;BERECHNEN DER BENÖTIGTEN MENGE ;calculate the quantity 
	. . SET SUCH(3)=$PIECE(SATZ,Y,5)  ;BASISMENGE
	. . SET SUCH("M",+SUCH(0))=$PIECE(SUCH1,Y,5)
	. . FOR YYI=1:1:SUCH(0) IF +$GET(SUCH("M",YYI))'=0 SET SUCH(3)=SUCH(3)*$GET(SUCH("M",YYI))
	. . SET $PIECE(SUCH1,Y,39)=SUCH(3)   ;MENGE FÜR PRODUKTION ;quantity to production 
	. . ;
	. . SET SUCH(2)=""
	. . FOR YYI=1:1:SUCH(0) SET SUCH(2)=SUCH(2)_$PIECE(SUCH(1),",",YYI)_"."
	. . SET ^INANGPT(YM,YANGEBOT,YPOS,SUCH(2),1)=SUCH1
	. . SET @SUCH=SUCH1
	
	QUIT
	
HIDDEN ;NEU HIDDENFELDER ;recent 
	QUIT:$GET(YHTMFORM)'="WWW2"
	
	WRITE YCR,"<INPUT TYPE=HIDDEN NAME=""ITEMS"" VALUE="""">"
	WRITE YCR,"<INPUT TYPE=HIDDEN NAME=""ITEMSQ"" VALUE="""">"
	WRITE YCR,"<INPUT TYPE=HIDDEN NAME=""ITEMSG"" VALUE="""">"
	WRITE YCR,"<INPUT TYPE=HIDDEN NAME=""ITEMSGQ"" VALUE="""">"
	QUIT
	
]]></Routine>
</Export>