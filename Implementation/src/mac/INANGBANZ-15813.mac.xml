<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INANGBANZ" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INANGBANZ ;INANGBANZ;DT;ANZEIGE OFFENER ANGEBOTE;14.01.2000
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		ANZEIGE OFFENER ANGEBOTE
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| 02-Sep-2005	JW		SR12966: INUSER is not shared
	;| DT	14.01.2000
	;|
	;\------------------------------------------------------------------/
	;
	;ANZEIGE DER OFFENEN ANGEBOTE ;Show the 
	NEW VONNR,BISNR,AUF,AUF1,LYDDANZ,DAT,AUFENDE,YKEY,YFKEY,NAMESORT,TOTAL,KREDITOK,GLITM,LIEFERF,NAMESORT,POK,ALLESOK,UNTER,DATE,MINDAUFSCHLAG,KREDITLIMIT,KUNDE
	KILL ^WWWSOR(YUSER)
	DO VAR         ;VARIABLE HOLEN ;send for 
	DO SORT        ;SORTIERUNG ;sorting 
	DO DRUCKZAHL   ;ANZAHL,SEITE ANZEIGEN
	DO ^INANGBANZ2(1)
	DO DRUCK       ;DRUCK TABEL ;printing 
	DO BLANK
	DO LETZTZEIL
	KILL ^WWWSOR(YUSER)
	QUIT
	
VAR ;
	;$P(INUSER(0,YBED,1)),Y,1):YAUSWAHL
	;$P(INUSER(0,YBED,1)),Y,9):ANZAHL
	;$P(INUSER(0,YBED,1)),Y,10):YSORTBY
	;$P(INUSER(0,YBED,1)),Y,11):YNAMESORT
	;$P(INUSER(0,YBED,1)),Y,12):YSEITE
	SET YAZ=10     ;ANZEIGE SEITE ZB. YAZ=2; 1 2 > YAZ=5: 1 2 3 4 5 >--------------------------YAZ
	;SORTIERUNG PFEIL--- VON --- 1.TH   2.ZAHLANDER^INANGBANZ---------------------------------YSOTBY
	SET YSORTBY=$GET(%(YQUERY,"YSORTBY"))  ;1= NORMAL , -1 = AB
	IF YSORTBY="" DO
	. SET YSORTBY=$PIECE($GET(^INUSER(YM,YBED,1)),Y,10)
	. IF $EXTRACT(YSORTBY,1,9)="INANGBANZ" SET YSORTBY=$EXTRACT(YSORTBY,10,25) QUIT
	. SET YSORTBY=-1
	. QUIT
	SET $PIECE(^INUSER(YM,YBED,1),Y,10)="INANGBANZ"_YSORTBY
	;NAMESORT ---- VON --- 1.ZAHLANDER^INANGBANZ-----------------------------------------------YNAMESORT
	SET YNAMESORT=$GET(%(YQUERY,"YNAMESORT"))  ;1= NORMAL , -1 = AB
	IF YNAMESORT="" DO
	. SET YNAMESORT=$PIECE($GET(^INUSER(YM,YBED,1)),Y,11)
	. IF $EXTRACT(YNAMESORT,1,9)="INANGBANZ" SET YNAMESORT=$EXTRACT(YNAMESORT,10,25) QUIT
	. SET YNAMESORT=0
	. QUIT
	SET $PIECE(^INUSER(YM,YBED,1),Y,11)="INANGBANZ"_YNAMESORT
	;WIEVIEL WIRD ANGEZEIGT aktueller Anzeige Anzahl-------------------------------------------ANZAHL
	;ANZAHL ÜBERTRAGEN----VON----1.^INAUFBANZ2   2.ZAHLANDER^INAUFBANZ
	SET ANZAHL=$PIECE(^INUSER(YM,YBED,1),Y,9)  
	IF '$F(ANZAHL,"INANGBANZ") SET ANZAHL=50
	IF $E(ANZAHL,1,9)="INANGBANZ" SET ANZAHL=+$E(ANZAHL,10,25)      ;
	IF +ANZAHL=0 SET ANZAHL=50 SET $PIECE(^INUSER(YM,YBED,1),Y,9)="INANGBANZ"_50
	IF +ANZAHL<0 SET ANZAHL=ANZAHL*(-1)
	IF ANZAHL<1 SET ANZAHL=50
	SET YLEAUF=$PIECE($GET(^WWW126(YM,"INANG",YBED,1,1)),Y,1)  ;LETZTE ANGEBOTSNUMMER----------YLEAUF
	;VON BIS----------------------------------------------------------------------------------YVONNR,YBISNR
	SET YVONNR=""
	SET YBISNR=""
	SET VONBIS=$GET(%(YQUERY,"YVONBIS")) IF VONBIS'="" DO
	. SET YVONNR=$PIECE(VONBIS,",",1)
	. SET YBISNR=$PIECE(VONBIS,",",2)
	. QUIT
	;SEITE ÄNDER------------------------------------------------------------------------------YSEITE
	SET YSEITE=$GET(%(YQUERY,"YSEITE"))  
	IF YSEITE="" DO
	. SET YSEITE=$PIECE($GET(^INUSER(YM,YBED,1)),Y,12)
	. IF $EXTRACT(YSEITE,1,9)="INANGBANZ" SET YSEITE=$EXTRACT(YSEITE,10,25) QUIT
	. SET YSEITE=1
	. QUIT
	SET $PIECE(^INUSER(YM,YBED,1),Y,12)="INANGBANZ"_YSEITE
	;ANFANGEN ZAHL RECHNEN DURCH YSEITE UND YAZ--Z.B.  1 11 ODER 21----------------------------YA
	IF YSEITE#YAZ=0 SET YA=(YSEITE\YAZ-1)*YAZ+1
	IF YSEITE#YAZ'=0 SET YA=YSEITE\YAZ*YAZ+1
	;WAS WIRD ANGEZEIGT---VON---ALLE-----------------------------------------------------------YAUSWAHL
	SET YAUSWAHL=$GET(%(YQUERY,"YAUSWAHL"))  ;WAS WIRD ANGEZEIGT ;whatsoever 
	IF YAUSWAHL="" DO   ;LETZTE AUSWAHL ;last Selection 
	. SET YAUSWAHL=$PIECE($GET(^INUSER(YM,YBED,1)),Y,1)
	. IF $EXTRACT(YAUSWAHL,1,9)="INANGBANZ" SET YAUSWAHL=$EXTRACT(YAUSWAHL,10,25) QUIT
	. SET YAUSWAHL=5
	. QUIT
	IF +YAUSWAHL=0!(YAUSWAHL=3) IF $$^WWWACCESS("",$PIECE($GET(^INVORG(YM,YM,1)),Y,35))'=1 SET YAUSWAHL=5    ;KEINE BERECHTIGUNG ;no 
	;0=KUNDEN
	;2=LIEFERANTENANFRAGEN
	;3=ALLE
	;4=NUR REKLA/ERSATZTEILE (ALLE MIT FILTER) ;by means of 
	;5=MY OFFER
	;*/KUNDENNUMMER (NUR AKTUELLE ANGEBOTE)
	;*+KUNDENNUMMER  ;ALLE ANGEBOTE DIE NICHT AUFTRAG GEWORDEN IST,INNERHALT DIASE ZEITRAUM;03.05.2004;FAN;25425; FORECAST
	;*!ARTIKELNUMMER (NUR AKTUELLE ANGEBOTE) 
	IF YAUSWAHL="" SET YAUSWAHL=0
	SET $PIECE(^INUSER(YM,YBED,1),Y,1)="INANGBANZ"_YAUSWAHL
	SET MINDAUFSCHLAG=+$PIECE($GET(^INVORG(YM,YM,1)),Y,11)  ;MINDESAUFSCHLAG DER ERREICHT WERDEN SOLL ;the will 
	SET KREDITLIMIT=+$PIECE($GET(^INVORG(YM,YM,1)),Y,4)  ;AUSLIEFERUNG NUR MIT KREDITLIMIT DES KUNDEN ;handover only by means of 
	SET YDDSATZ=0
	QUIT
	
SORT    ;SORTIERUNG       ;sorting 
	SET ANZM=0
	;SUCHEN OFFENE ANGEBOTE SORT NACH NUMMER ;seek within numeral 
	IF +YNAMESORT=0 IF $EXTRACT(YAUSWAHL)'="*" DO
	. SET AUF="" FOR  SET AUF=$ORDER(^INANG1(YM,AUF),YSORTBY) QUIT:AUF=""  DO
	. . SET AUF1=$GET(^INANG(YM,AUF,1))
	. . IF YAUSWAHL'=5 IF YAUSWAHL<3 QUIT:+$PIECE(AUF1,Y,2)'=+YAUSWAHL
	. . IF YAUSWAHL=5 QUIT:$PIECE(AUF1,Y,14)'=YBED  ;NICHT RICHTIGER ANGEBOT ;Not proposition 
	. . IF YAUSWAHL=4 Q:$P(AUF1,Y,169)'=1
	. . SET ^WWWSOR(YUSER,0,999999,AUF)=""
	. . SET ANZM=ANZM+1
	. . QUIT
	. QUIT
	;SUCHEN OFFENE ANGEBOTE SORT NACH NAME ;seek within Name 
	IF +YNAMESORT=1 IF $EXTRACT(YAUSWAHL)'="*" DO
	. NEW NAME
	. KILL ^WWWSOR(YUSER,1)
	. SET AUF="" FOR  SET AUF=$ORDER(^INANG1(YM,AUF)) QUIT:AUF=""  DO
	. . SET NAME=$PIECE($GET(^INANG(YM,AUF,1)),Y,13)
	. . IF NAME="" SET NAME=$PIECE($GET(^INANG1(YM,AUF,1)),Y,1)
	. . SET NAME=$$^WWWUMLAU(NAME,1)
	. . IF NAME="" SET NAME=" "
	. . SET ^WWWSOR(YUSER,1,NAME,AUF)=""  ;VORSORTIERUNG NACH NAME ;within Name 
	. . SET ANZM=ANZM+1
	. . QUIT
	. QUIT
	;SUCHEN OFFENE ANGEBOTE SORT NACH DATUM ;seek within Date 
	IF +YNAMESORT=2 IF $EXTRACT(YAUSWAHL)'="*" DO
	. NEW DATUMS
	. KILL ^WWWSOR(YUSER,1)
	. SET AUF="" FOR  SET AUF=$ORDER(^INANG1(YM,AUF)) QUIT:AUF=""  DO
	. . SET DATUMS=+$PIECE($GET(^INANG(YM,AUF,1)),Y,4)
	. . IF DATUMS="" SET DATUMS=" "
	. . SET ^WWWSOR(YUSER,2,DATUMS,AUF)=""  ;VORSORTIERUNG NACH DATUM ;within Date 
	. . SET ANZM=ANZM+1
	. . QUIT
	. QUIT
	IF $EXTRACT(YAUSWAHL,1,2)="*/" DO  ;SUCHEN ANGEBOTSBESTAND EINES KUNDEN ;seek 
	. QUIT:$EXTRACT(YAUSWAHL,3,99)=""
	. SET YAUSWAHL1=$EXTRACT(YAUSWAHL,3,99)
	. SET YAUSWAHL=""
	. SET AUF="" FOR  SET AUF=$ORDER(^INANG1(YM,AUF)) QUIT:AUF=""  DO
	. . SET AUF1=$GET(^INANG(YM,AUF,1))
	. . Q:$PIECE(AUF1,Y,1)'=YAUSWAHL1 
	. . SET ^WWWSOR(YUSER,YNAMESORT,999999,AUF)=""       ;SORTIERUNG NACH NUMMER ;sorting within numeral 
	. . SET ANZM=ANZM+1
	. . QUIT 
	. QUIT
	IF $EXTRACT(YAUSWAHL,1,2)="*+" DO  ;;ALLE ANGEBOTE DIE NICHT AUFTRAG GEWORDEN IST,INNERHALT DIASE ZEITRAUM;03.05.2004;FAN;25425; FORECAST
	. QUIT:$EXTRACT(YAUSWAHL,3,99)=""
	. NEW KUNDE
	. SET YAUSWAHL1=$EXTRACT(YAUSWAHL,3,99)
	. SET YAUSWAHL=""
	. SET KUNDE=$$^WWWUMLAU(YAUSWAHL1,1)
	. SET VONDATUM=$GET(%(YQUERY,"YVONDATUM"))
	. SET BISDATUM=$GET(%(YQUERY,"YBISDATUM"))
	. IF BISDATUM="" SET BISDATUM=$ORDER(^INANGs(YM,1,KUNDE,""),-1)
	. SET DAT=""
	. IF VONDATUM'="" SET DAT=$ORDER(^INANGs(YM,1,KUNDE,VONDATUM),-1)
	. FOR  SET DAT=$ORDER(^INANGs(YM,1,KUNDE,DAT)) QUIT:DAT]]BISDATUM  QUIT:DAT=""  DO
	. . SET AUFENDE="" FOR  SET AUFENDE=$ORDER(^INANGs(YM,1,KUNDE,DAT,AUFENDE)) QUIT:AUFENDE=""  DO
	. . . SET ANG="" FOR  SET ANG=$ORDER(^INANGs(YM,1,KUNDE,DAT,AUFENDE,ANG)) QUIT:ANG=""  DO
	. . . . ;QUIT:$PIECE($GET(^INANG(YM,ANG,1)),Y,78)'=""   ;AUFTRAG GEWORDEN ZÄHLE NICHT MIT ;AUSGESCHALTET;24.09.04;FIS;26409
	. . . . SET ^WWWSOR(YUSER,YNAMESORT,999999,ANG)=""       ;SORTIERUNG NACH NUMMER ;sorting within numeral 
	. . . . SET ANZM=ANZM+1
	. . . . QUIT 
	. . . QUIT
	. . QUIT
	. QUIT
	IF $EXTRACT(YAUSWAHL,1,2)="*!" DO  ;SUCHEN ANGEBOTSBESTAND EINES ARTIKELS ;seek 
	. QUIT:$EXTRACT(YAUSWAHL,3,99)=""
	. IF $GET(%(YQUERY,"YSEITE"))="" SET YSEITE=1 SET YA=1
	. SET YAUSWAHL1=$EXTRACT(YAUSWAHL,3,99)
	. SET YAUSWAHL=""
	. SET AUF="" FOR  SET AUF=$ORDER(^INANG1(YM,AUF)) QUIT:AUF=""  DO   ;OFFENER ANGEBOTE
	. . IF YAUSWAHL1'="" FOR POK=" ",0 DO  
	. . . SET POS="" FOR  SET POS=$ORDER(^INANGPs(YM,5,$$^WWWUMLAU(POK,1),$$^WWWUMLAU(YAUSWAHL1,1),AUF,POS)) QUIT:POS=""  DO   ;POSITIONENS SUCHE ;search 
	. . . . SET AUF1=$GET(^INANG(YM,AUF,1)) 
	. . . . SET ^WWWSOR(YUSER,YNAMESORT,999999,AUF)=""       ;SORTIERUNG NACH NUMMER ;sorting within numeral 
	. . . . SET ANZM=ANZM+1
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	;IF $EXTRACT(YAUSWAHL,1,2)="#&" DO  ;SUCHEN ALLE ANGEBOTE EINES KUNDEN
	. QUIT:$EXTRACT(YAUSWAHL,3,99)=""
	. IF $GET(%(YQUERY,"YSEITE"))="" SET YSEITE=1 SET YA=1
	. SET YAUSWAHL1=YAUSWAHL
	. SET YAUSWAHL=""
	. SET KUNDE=$EXTRACT(YAUSWAHL1,3,99)
	. SET DAT="" FOR  SET DAT=$ORDER(^INANGs(YM,1,$$^WWWUMLAU(KUNDE,1),DAT),YSORTBY) QUIT:DAT=""  DO
	. . SET AUFENDE="" FOR  SET AUFENDE=$ORDER(^INANGs(YM,1,$$^WWWUMLAU(KUNDE,1),DAT,AUFENDE),YSORTBY) QUIT:AUFENDE=""  DO
	. . . SET AUF="" FOR  SET AUF=$ORDER(^INANGs(YM,1,$$^WWWUMLAU(KUNDE,1),DAT,AUFENDE,AUF),YSORTBY) QUIT:AUF=""  DO
	. . . . SET AUF1=$GET(^INANG(YM,AUF,1))
	. . . . DO ^INANGBANZ1
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	;IF $EXTRACT(YAUSWAHL,1,2)="#*" DO  ;SUCHEN ANFRAGEBESTAND EINES LIEFERANTEN
	. QUIT:$EXTRACT(YAUSWAHL,3,99)=""
	. IF $GET(%(YQUERY,"YSEITE"))="" SET YSEITE=1 SET YA=1
	. SET YAUSWAHL1=YAUSWAHL
	. SET YAUSWAHL=""
	. SET AUF="" FOR  SET AUF=$ORDER(^INANG1(YM,AUF),YSORTBY) QUIT:AUF=""  DO
	. . SET AUF1=$GET(^INANG(YM,AUF,1))
	. . QUIT:$PIECE(AUF1,Y,12)'=$EXTRACT(YAUSWAHL1,3,99)  ;NICHT RICHTIGER ANGEBOT ;Not proposition 
	. . DO ^INANGBANZ1
	. . QUIT
	. QUIT
	;--------------------------------------------------------------------------------------
	SET YNR=1
	SET YVAR="" FOR  SET YVAR=$ORDER(^WWWSOR(YUSER,YNAMESORT,YVAR),YSORTBY) QUIT:YVAR=""  DO
	. SET AUF="" FOR  SET AUF=$ORDER(^WWWSOR(YUSER,YNAMESORT,YVAR,AUF),YSORTBY)  QUIT:AUF=""  DO
	. . SET ^WWWSOR(YUSER,888,YNR)=AUF
	. . SET YNR=YNR+1
	. . QUIT
	. QUIT
	QUIT
	
DRUCKZAHL ;ZAHL RECHNEN ;numeral have faith in 
	WRITE YCR,YCR,"<!-- ****************************ZAHL RECHNEN*************  -->"
	DO ^WWWFRAME(0)  ;TABLE AN  ;upon 
	WRITE "<TR>"
	WRITE "<TD ALIGN=LEFT VALIGN=TOP>"
	IF $$^WWWACCESS("",$PIECE($GET(^INVORG(YM,YM,1)),Y,35))=1 DO
	. WRITE YCR,"<FONT SIZE=2><B>"_$$^WWWTEXT(32178)_": "_"</B></FONT>"      ;SUCHEN ;seek 
	. WRITE YCR,"<INPUT NAME="_"YSUCH SIZE=10 MAXLENGTH=20 TYPE=float VALUE="_""""_""""
	. WRITE " TABINDEX=ART style="_""""_"padding-top:0 ;padding-bottom:0"_""""_" style="_""""_"text-align:left"_""""
	. WRITE " onChange='SAVENOW();'"
	. WRITE ">"
	. WRITE YCR,"&nbsp;&nbsp;&nbsp;" 
	. QUIT
	DO
	. WRITE "<A "
	. WRITE " TITLE="_""""_$$^WWWTEXT(32904)_": "_ANZM_""""
	. WRITE " HREF="_""""_"#"_""""_">"
	. QUIT
	WRITE YCR,"<FONT SIZE=2><B>"_$$^WWWTEXT(32906)_": "_"</B></FONT>"      ;ANZAHL pro seite ;Number within 
	W "</A>"
	WRITE YCR,"<INPUT NAME="_"YANZAHL SIZE=5 MAXLENGTH=5 TYPE=float VALUE="_""""_ANZAHL_""""
	WRITE YCR," TABINDEX=ART style="_""""_"padding-top:0 ;padding-bottom:0"_""""_" style="_""""_"text-align:right"_""""
	WRITE " onChange='SAVENOW();'"
	WRITE "  onFocus='select();'"
	WRITE ">"
	;DO
	. WRITE YCR,"&nbsp;&nbsp;&nbsp;" 
	. WRITE YCR,"<FONT SIZE=2><B>"_$$^WWWTEXT(32904)_": "_"</B></FONT>"      ;SUMME ;sum 
	. WRITE YCR,"<FONT SIZE=2>"_ANZM_" "_"</FONT>"      ;SUMME ;sum 
	. QUIT
	DO
	. WRITE "<INPUT TYPE="_""""_"IMAGE"_""""
	. WRITE " SRC="_""""_YGIF_"ok.gif"_""""_" "_"WIDTH=1"
	. WRITE " onClick='SAVENOW();'"
	. WRITE """"_" border=0>" ; SPEICHERN ;Save 
	. QUIT
	WRITE YCR,"&nbsp;&nbsp;&nbsp;" 
	IF YA'=1 DO
	. NEW VON,BIS
	. SET VON=(YA-YAZ-1)*ANZAHL+1
	. SET BIS=VON+ANZAHL
	. WRITE YCR,"<A"
	. WRITE " TITLE="_""""_$P($$^WWWTEXT(302)," ",1)_""""  ;VORHERIGER
	. WRITE " HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INANGBANZ&YVONBIS="_VON_","_BIS_"&YSEITE="_(YA-YAZ)_"&YANZAHL="_ANZAHL_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL_"&YNAMESORT="_YNAMESORT
	. DO ^WWWCGI
	. WRITE """"_" >"
	. WRITE YCR,"<FONT SIZE=2><B>"_"&lt;&nbsp;"_"</B></FONT>"      ;SEITE
	. WRITE "</A>"
	. QUIT
	IF YA=1 DO
	. WRITE YCR,"<FONT SIZE=2><B>"_"&nbsp;&nbsp;&nbsp;"_"</B></FONT>"      ;SEITE
	. QUIT
	SET SEITE=1
	IF ANZAHL>0 IF ANZM#ANZAHL'=0 SET SEITE=ANZM\ANZAHL+1     ;15\10+1=2
	IF ANZAHL>0 IF ANZM#ANZAHL=0 SET SEITE=ANZM\ANZAHL        ;20\10=2
	SET BISNR=""
	SET YNR=""
	SET YVON=""
	SET YBIS=""
	FOR YI=YA:1:SEITE DO
	. Q:YI>(YA+YAZ-1)
	. SET ANZ=1
	. IF YI=1 SET VONNR=""
	. IF YI'=1 SET VONNR=(YI-1)*ANZAHL+1 QUIT:VONNR="" 
	. SET YNR=VONNR  FOR  SET YNR=$ORDER(^WWWSOR(YUSER,888,YNR)) QUIT:YNR=""  QUIT:ANZ=ANZAHL  DO
	. . SET ANZ=ANZ+1
	. . SET BISNR=YNR
	. . QUIT
	. IF BISNR<VONNR SET BISNR=VONNR    ;FÜR NUR EINE ZEILE ;to only one 
	. DO
	. . WRITE "&nbsp;" 
	. . IF YI=1 SET VONNR=$ORDER(^WWWSOR(YUSER,888,"")) IF VONNR'="" SET YVON=$GET(^WWWSOR(YUSER,888,VONNR))
	. . IF YI'=1 IF VONNR'="" SET YVON=$GET(^WWWSOR(YUSER,888,VONNR))
	. . IF YI=1 IF $ORDER(^WWWSOR(YUSER,888,BISNR))'="" SET BISNR=$ORDER(^WWWSOR(YUSER,888,BISNR)) IF BISNR'="" SET YBIS=$GET(^WWWSOR(YUSER,888,BISNR))
	. . IF YI=1 IF $ORDER(^WWWSOR(YUSER,888,BISNR))=""  IF BISNR'="" SET YBIS=$GET(^WWWSOR(YUSER,888,BISNR))
	. . IF YI'=1 IF BISNR'="" SET YBIS=$GET(^WWWSOR(YUSER,888,BISNR))
	. . ;
	. . IF $GET(YNAMESORT)=0 DO
	. . . NEW YFORM,YKEY 
	. . . WRITE YCR,"<A"
	. . . WRITE " TITLE="_""""_YVON_"--"_YBIS_""""
	. . . WRITE " HREF="_""""
	. . . WRITE YAKTION_"EP=WWWFORM&YFORM=INANGBANZ&YVONBIS="_VONNR_","_BISNR_"&YSEITE="_YI_"&YANZAHL="_ANZAHL_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL_"&YNAMESORT="_YNAMESORT
	. . . DO ^WWWCGI
	. . . WRITE """"_" >"
	. . . QUIT
	. . IF $GET(YNAMESORT)=1 DO
	. . . SET VONNAME=" "
	. . . SET BISNAME=" "
	. . . IF YVON'="" SET VONNAME=$PIECE($GET(^INANG(YM,YVON,1)),Y,13)
	. . . IF YBIS'="" SET BISNAME=$PIECE($GET(^INANG(YM,YBIS,1)),Y,13)
	. . . NEW YFORM,YKEY 
	. . . WRITE YCR,"<A"
	. . . WRITE " TITLE="_""""_VONNAME_"--"_BISNAME_""""
	. . . WRITE " HREF="_""""
	. . . WRITE YAKTION_"EP=WWWFORM&YFORM=INANGBANZ&YVONBIS="_VONNR_","_BISNR_"&YSEITE="_YI_"&YANZAHL="_ANZAHL_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL_"&YNAMESORT="_YNAMESORT
	. . . DO ^WWWCGI
	. . . WRITE """"_" >"
	. . . QUIT
	. . IF $GET(YNAMESORT)=2 DO
	. . . SET VONDATUM=" "
	. . . SET BISDATUM=" "
	. . . IF YVON'="" SET VONDATUM=$PIECE($GET(^INANG(YM,YVON,1)),Y,4) IF VONDATUM'="" SET VONDATUM=$$^WWWDATE(VONDATUM)
	. . . IF YBIS'="" SET BISDATUM=$PIECE($GET(^INANG(YM,YBIS,1)),Y,4) IF BISDATUM'="" SET BISDATUM=$$^WWWDATE(BISDATUM)
	. . . NEW YFORM,YKEY 
	. . . WRITE YCR,"<A"
	. . . WRITE " TITLE="_""""_VONDATUM_"--"_BISDATUM_""""
	. . . WRITE " HREF="_""""
	. . . WRITE YAKTION_"EP=WWWFORM&YFORM=INANGBANZ&YVONBIS="_VONNR_","_BISNR_"&YSEITE="_YI_"&YANZAHL="_ANZAHL_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL_"&YNAMESORT="_YNAMESORT
	. . . DO ^WWWCGI
	. . . WRITE """"_" >"
	. . . QUIT
	. . . WRITE YCR
	. . . Q
	. . IF YSEITE=YI WRITE "<B><U>"
	. . WRITE "<FONT SIZE=2>"_YI_"</FONT>"
	. . IF YSEITE=YI WRITE "</U></B>"
	. . WRITE YCR,"</A>"
	. . QUIT
	. QUIT
	IF (YA+YAZ)'>SEITE DO
	. NEW BIS
	. SET BIS=BISNR+ANZAHL
	. IF '$D(^WWWSOR(YUSER,888,BIS)) SET BIS=$O(^WWWSOR(YUSER,888,""),-1)
	. WRITE YCR,"<A"
	. WRITE " TITLE="_""""_$P($$^WWWTEXT(303)," ",1)_""""  ;NÄCHSTER
	. WRITE " HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INANGBANZ&YVONBIS="_(BISNR+1)_","_BIS_"&YSEITE="_(YA+YAZ)_"&YANZAHL="_ANZAHL_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL_"&YNAMESORT="_YNAMESORT
	. DO ^WWWCGI
	. WRITE """"_" >"
	. WRITE YCR,"<FONT SIZE=2><B>"_"&nbsp;&gt;"_"</B></FONT>"      ;SEITE    ">"
	. WRITE "</A>"
	. QUIT
	WRITE "</TD>"
	WRITE YCR
	WRITE "</TR>"
	DO ^WWWFRAME(1)   ;TABLE AUS ;out of 
	QUIT
	NEW POS,POS1,WH,BE,AB,LIE,TOUR,YI,RECHN,FIBU,NAME,YZ,COLOR,YZEIGE,BLACK,RED,BLUE,GRAY
	WRITE YCR,YCR,YCR
	
DRUCK ;----------------------------KOPF-------------------------------------------------
	;WRITE "$G(YVONNR)"_$GET(YVONNR)
	;WRITE "$G(YBISNR)"_$GET(YBISNR)
	IF $GET(YVONNR)'="" IF $GET(YBISNR)'="" DO
	. SET YVONNR=$ORDER(^WWWSOR(YUSER,888,YVONNR),-1)
	. SET YNR=YVONNR FOR  SET YNR=$ORDER(^WWWSOR(YUSER,888,YNR)) QUIT:YNR>YBISNR  QUIT:YNR=""  DO
	. . SET AUF=$GET(^WWWSOR(YUSER,888,YNR))
	. . SET AUF1=$GET(^INANG(YM,AUF,1))
	. . DO ^INANGBANZ1
	. . QUIT
	. QUIT
	IF $GET(YVONNR)="" IF $G(YBISNR)="" IF YSEITE=1 DO
	. SET ANZ=0
	. SET YNR="" FOR  SET YNR=$ORDER(^WWWSOR(YUSER,888,YNR))  Q:ANZ=ANZAHL  QUIT:YNR=""  DO
	. . SET AUF=$G(^WWWSOR(YUSER,888,YNR))
	. . SET AUF1=$G(^INANG(YM,AUF,1))
	. . DO ^INANGBANZ1
	. . SET ANZ=ANZ+1
	. . QUIT
	. QUIT
	IF $GET(YVONNR)="" IF $GET(YBISNR)="" IF YSEITE'=1 DO
	. SET YVONNR=(YSEITE-1)*ANZAHL QUIT:YVONNR="" 
	. SET YBISNR=YVONNR+ANZAHL
	. IF '$DATA(^WWWSOR(YUSER,888,YBISNR)) SET YBISNR=$ORDER(^WWWSOR(YUSER,888,""),-1)
	. SET YNR=YVONNR FOR  SET YNR=$ORDER(^WWWSOR(YUSER,888,YNR)) QUIT:YNR>YBISNR  QUIT:YNR=""  DO
	. . SET AUF=$GET(^WWWSOR(YUSER,888,YNR))
	. . SET AUF1=$GET(^INANG(YM,AUF,1))
	. . DO ^INANGBANZ1
	. . QUIT
	. QUIT
	QUIT
	
LETZTZEIL 
	DO  ;IF ANZM=0 DO
	. N YI
	. WRITE "<TR>"
	. SET YDDSATZ=YDDSATZ+1
	. FOR YI=1:1:10 DO
	. . WRITE "<TD NOWRAP VALIGN=TOP"
	. . IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . WRITE ">"
	. . WRITE "<FONT SIZE=2>"
	. . WRITE "&nbsp;"
	. . WRITE "</TD>"
	. . WRITE YCR
	. . QUIT
	. WRITE "<TD NOWRAP VALIGN=TOP ALIGN=RIGHT"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE ">"
	. WRITE "<FONT SIZE=2>"
	. I +$G(TOTAL)'=0 W $$^WWWZAHL(TOTAL,0,2)
	. WRITE "&nbsp;"
	. WRITE "</TD>"
	. WRITE "</TR>"
	. QUIT
	DO ^WWWFRAME(1)   ;TABLE AUS ;out of 
	QUIT
	;--------------------------------------------------------------------------------------
	
BLANK ;LEERZEILEN
	IF YDDSATZ<($GET(ANZAHL)-1) DO
	. NEW YBLANKLINE,ANZAHL1
	. SET ANZAHL1=ANZAHL
	. IF ANZAHL1>20 SET ANZAHL1=20
	. SET YBLANKLINE=$GET(YDDSATZ)
	. FOR YBLANKLINE=YBLANKLINE:1:($GET(ANZAHL1)-1) DO
	. . ;
	. . WRITE "<TR>"
	. . SET YDDSATZ=YDDSATZ+1
	. . FOR YI=1:1:11 DO
	. . . WRITE "<TD NOWRAP VALIGN=TOP"
	. . . IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . . WRITE ">"
	. . . WRITE "<FONT SIZE=2>"
	. . . WRITE "&nbsp;"
	. . . WRITE "</TD>"
	. . . WRITE YCR
	. . . QUIT
	. . WRITE YCR
	. . QUIT
	. QUIT
	QUIT
	
ANGEBOT  ;NUR KUNDENANGEBOTE  (EH AUSSEN) ;only 
	SET %(YQUERY,"YAUSWAHL")=0
	SET %(YQUERY,"YSEITE")=1
	SET %(YQUERY,"YSORTBY")=-1
	SET %(YQUERY,"YNAMESORT")=0
	SET %(YQUERY,"YFORM")="INANGBANZ"
	SET %("VAR","YFORM")="INANGBANZ"
	SET YFORM="INANGBANZ"
	DO ^WWWFORM
	QUIT
	
LIEFER ;ALLE ANFRAGEN (EH AUSSEN) ;ask 
	SET %(YQUERY,"YAUSWAHL")=2
	SET %(YQUERY,"YSEITE")=1
	SET %(YQUERY,"YSORTBY")=-1
	SET %(YQUERY,"YNAMESORT")=0
	SET %(YQUERY,"YFORM")="INANGBANZ"
	SET %("VAR","YFORM")="INANGBANZ"
	SET YFORM="INANGBANZ"
	DO ^WWWFORM
	QUIT
	
EIGENOLF   ;ALLE ANGEBOTE  (EH AUSSEN)
	SET %(YQUERY,"YAUSWAHL")=3
	SET %(YQUERY,"YSEITE")=1
	SET %(YQUERY,"YSORTBY")=-1
	SET %(YQUERY,"YNAMESORT")=0
	SET %(YQUERY,"YFORM")="INANGBANZ"
	SET %("VAR","YFORM")="INANGBANZ"
	SET YFORM="INANGBANZ"
	DO ^WWWFORM
	QUIT
	
REKLA ;ALLE REKLA/ERSATZTEILE ANGEBOTE  (EH AUSSEN)
	SET %(YQUERY,"YAUSWAHL")=4
	SET %(YQUERY,"YSEITE")=1
	SET %(YQUERY,"YSORTBY")=-1
	SET %(YQUERY,"YNAMESORT")=0
	SET %(YQUERY,"YFORM")="INANGBANZ"
	SET %("VAR","YFORM")="INANGBANZ"
	SET YFORM="INANGBANZ"
	DO ^WWWFORM
	QUIT
	
MY ;ALLE ANGEBOTE DES MITARBEITERS
	SET %(YQUERY,"YAUSWAHL")=5
	SET %(YQUERY,"YSEITE")=1
	SET %(YQUERY,"YSORTBY")=-1
	SET %(YQUERY,"YNAMESORT")=0
	SET %(YQUERY,"YFORM")="INANGBANZ"
	SET %("VAR","YFORM")="INANGBANZ"
	SET YFORM="INANGBANZ"
	DO ^WWWFORM
	QUIT
	
ZAHLANDER
	IF $G(%(YQUERY,"YSUCH"))="" DO  
	. SET %(YQUERY,"YAUSWAHL")=$G(YAUSWAHL)   
	. SET %(YQUERY,"YSORTBY")=$G(YSORTBY)     
	. SET %(YQUERY,"YNAMESORT")=$G(YNAMESORT)
	. SET %(YQUERY,"YFORM")="INANGBANZ"
	. SET %("VAR","YFORM")="INANGBANZ"
	. SET YFORM="INANGBANZ"
	. SET $PIECE(^INUSER(YM,YBED,1),Y,9)="INANGBANZ"_$GET(%(YQUERY,"YANZAHL"))
	. DO ^WWWFORM
	. QUIT
	IF $GET(%(YQUERY,"YSUCH"))'="" DO
	. SET YKEY=%(YQUERY,"YSUCH")
	. IF $DATA(^INANG(YM,YKEY,1)) DO
	. . SET %(YQUERY,"YFORM")="INANG"
	. . SET %("VAR","YFORM")="INANG"
	. . SET %(YQUERY,"YKEY")=YKEY
	. . SET %("VAR","YKEY")=YKEY
	. . SET YFORM="INANG"
	. . SET %(YQUERY,"YBACK")="INANGBANZ,"
	. . SET %("VAR","YBACK")="INANGBANZ,"
	. . SET YBACK="INANGBANZ,"
	. . DO ^WWWFORM
	. . QUIT
	. IF '$DATA(^INANG(YM,YKEY,1)) DO
	. . SET %(YQUERY,"YFORM")="INANGNEU"
	. . SET %("VAR","YFORM")="INANGNEU"
	. . SET YFORM="INANGNEU"
	. . SET %(YQUERY,"YBACK")="INANGBANZ,"
	. . SET %("VAR","YBACK")="INANGBANZ,"
	. . SET YBACK="INANGBANZ,"
	. . DO ^WWWFORM
	. . QUIT
	. QUIT
	QUIT
]]></Routine>
</Export>