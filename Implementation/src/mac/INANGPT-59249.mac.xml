<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INANGPT" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INANGPT ;INANGPT;DT;ZURUECKSPEICHERN DER ÄNDERUNGEN/LÖSCHNUNG DER BAUMSTRUKTUR ANGEBOTE;29.09.2000
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		ZURUECKSPEICHERN DER ÄNDERUNGEN/LÖSCHNUNG DER BAUMSTRUKTUR ANGEBOTE
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	29.09.2000
	;|
	;\------------------------------------------------------------------/
	;
	
SET ;SPEICHERN DATEN ;Save 
	NEW YI,ANG,POS,TEILE,DATEI
	QUIT:$GET(YKEY)=""
	QUIT:$GET(YFELD)=""
	SET ANG=$PIECE(YKEY,",",1)
	QUIT:ANG=""
	SET POS=$PIECE(YKEY,",",2)
	QUIT:POS=""
	SET ^WWW126(YM,"INANGP",YBED,1,1)=ANG
	SET ^WWW126(YM,"INANGP",YBED,2,1)=POS
	SET TEILE=$PIECE(YKEY,",",3)
	IF $PIECE(YFELD,Y,57)'="" DO  ;MASCHINE ;machine 
	. QUIT:$PIECE(YFELD,Y,61)'=""   ;SCHON BELEGT ;yet furry 
	. IF $PIECE($GET(^INMASCH(YM,$PIECE(YFELD,Y,57),1)),Y,9)'="" DO  ;FERTIGUNGSNEST
	. . SET $PIECE(YFELD,Y,61)=$PIECE($GET(^INMASCH(YM,$PIECE(YFELD,Y,57),1)),Y,9)  ;VORGABE   ;default 
	. . QUIT
	. QUIT
	IF $PIECE(YFELD,Y,40)=2!($PIECE(YFELD,Y,40)=10)!($PIECE(YFELD,Y,40)=11) SET $PIECE(YFELD,Y,47)=$$^INARTKOSTT($PIECE(YFELD,Y,4),$PIECE(YFELD,Y,5),$PIECE(YFELD,Y,45),$PIECE(YFELD,Y,43))  ;NEUE PREIS ERRECHNUNG INKL VERSCHNITT ;prize 
	;RUESTZEIT NUR BEI LEISTUNGEN GÜLTIG;FIS;25.05.04;25780
	IF +$PIECE(YFELD,Y,70)'=0 IF $PIECE(YFELD,Y,40)'=2 IF $PIECE(YFELD,Y,40)'=10 IF $PIECE(YFELD,Y,40)'=11 DO
	. NEW PRUEF
	. SET PRUEF="^INANGPXL("_""""_YM_""""_","_""""_ANG_""""_","_POS
	. FOR YI=1:1 QUIT:$PIECE(TEILE,".",YI)=""  SET PRUEF=PRUEF_","_$PIECE(TEILE,".",YI)
	. SET PRUEF=PRUEF_")"
	. IF $DATA(@PRUEF)'=11 SET $PIECE(YFELD,Y,70)=""
	. QUIT
	DO ^WWWSPEI("INANGPT",YKEY,YFELD,1)
	SET DATEI="^INANGPXL("_""""_YM_""""_","_""""_ANG_""""_","_POS
	FOR YI=1:1 QUIT:$PIECE(TEILE,".",YI)=""  SET DATEI=DATEI_","_$PIECE(TEILE,".",YI)
	SET DATEI=DATEI_")"
	SET @(DATEI)=YFELD  ;SPEICHERN DATEN ;Save 
	//ÄNDERUNG DER RÜSTZEIT;FIS;25917;15.07.04
	IF $PIECE(YFELD,Y,45)'=$PIECE($GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"D",2)),Y,45) DO
	. NEW YANGEBOT,YPOS
	. SET YANGEBOT=ANG
	. SET YPOS=POS
	. DO ^INANGTEILE
	. QUIT
	DO  ;NEURECHNEN HERSTELLKOSTEN;FIS;13.09.04;26268
	. NEW EXTRA,WERKZEUG
	. SET EXTRA=$PIECE($GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"D",2)),Y,74)
	. SET WERKZEUG=$PIECE($GET(^WWWDATEN(YM,+$HOROLOG,YUSER,YFORM,"D",2)),Y,75)
	. IF +$PIECE(YFELD,Y,74)=+EXTRA IF +$PIECE(YFELD,Y,75)=+WERKZEUG QUIT
	. ;DO ^INANGHKNEU(AUF,POS)
	. SET $PIECE(YFELD,Y,47)=$PIECE(YFELD,Y,47)-(EXTRA*$$^INPROLOS($PIECE(YFELD,Y,4),$PIECE(YFELD,Y,5)))-(WERKZEUG*$$^INPROLOS($PIECE(YFELD,Y,4),$PIECE(YFELD,Y,5)))
	. SET $PIECE(YFELD,Y,47)=$PIECE(YFELD,Y,47)+($PIECE(YFELD,Y,74)*$$^INPROLOS($PIECE(YFELD,Y,4),$PIECE(YFELD,Y,5)))+($PIECE(YFELD,Y,75)*$$^INPROLOS($PIECE(YFELD,Y,4),$PIECE(YFELD,Y,5)))
	. SET $PIECE(YFELD,Y,47)=$JUSTIFY($PIECE(YFELD,Y,47),0,2)
	. SET $PIECE(@DATEI,Y,47)=$PIECE(YFELD,Y,47)
	. SET $PIECE(^INANGPT(YM,ANG,POS,TEILE,1),Y,47)=$PIECE(YFELD,Y,47)  ;RÜCKSICHERN DES HAUPTTEILS TEILE
	. QUIT
	QUIT
	
KILL ;LÖSCHEN DATEN   ;Delete 
	NEW YI,ANG,POS,TEILE,DATEI
	QUIT:$GET(YKEY)=""
	QUIT:$GET(YFELD)=""
	SET ANG=$PIECE(YKEY,",",1)
	QUIT:ANG=""
	SET POS=$PIECE(YKEY,",",2)
	QUIT:POS=""
	SET TEILE=$PIECE(YKEY,",",3)
	SET DATEI="^INANGPXL("_""""_YM_""""_","_""""_ANG_""""_","_POS
	FOR YI=1:1 QUIT:$PIECE(TEILE,".",YI)=""  SET DATEI=DATEI_","_$PIECE(TEILE,".",YI)
	SET DATEI=DATEI_")"
	KILL @(DATEI)  ;LÖSCHEN DATEN TEILESTUKTUR ;Delete 
	KILL ^INANGPT(YM,ANG,POS,TEILE)  ;ZWISCHENDATEI
	QUIT
]]></Routine>
</Export>