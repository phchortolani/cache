<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INLISTKOPF" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INLISTKOPF      ;INLISTKOPF;FAN-FIS;ERSTELLEN VON DECKBLATT FÜR STATISTIKEN;17.01.2001
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		FAN-FIS
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|  9-Sep-2005	JW		Only call WWWUMLAU once (idxForm)
	;|
	;| 	ERSTELLEN VON DECKBLATT FÜR STATISTIKEN
	;|
	;\------------------------------------------------------------------/
	;
	DO ^WWWLISTKOPF
	QUIT
	;ABFRAGE DES AKTUELLEN FORMULARS (YFORM) NACH DATENSÄTZEN (AUSWAHLFELDERN), UM DIE EINGABEN
	;DES BENUTZERS AUF EIN STATISTIK-DECKBLATT ZU DRUCKEN. ;upon uni- within 
	;FORMATUMWANDLUNG ERFOLGT IN ^WWWTR
	;/CHECK FORM (YFORM) TO GET THE INPUT FIELDS WITH THEIR VALUES TO DISPLAY IN A HEADER BOX ;shape within 
	;/CHANGE FORMAT TO DISPLAY IN WWWTR ;format within 
	NEW LFN,YVAR,YI,YINHALT,YNAME,YQ,YFELD,YTYP,YVARIN,ZEILE,SPALTE,TPOS,idxForm
	QUIT:'$DATA(^WWW122(0,YFORM))
	DO ^WWWFRAME(0)  ;ANFANG ;outset 
	WRITE YCR,"<TR>"
	WRITE YCR,"<TD ALIGN=CENTER VALIGN=TOP BGCOLOR="_YGRAY_">"
	;DRUCKEN ÜBERSCHRIFTEN  /PRINT HEADER
	;WRITE "<CENTER>"
	DO START1000^WWWTAB
	DO NL^WWWTAB
	DO NHWO^WWWTAB
	WRITE "<FONT SIZE=3>"
	WRITE "<B>"
	WRITE "<NOBR>"
	WRITE YKOPF
	; ÜBERSCHRIFT1: STATISTIK-NAME  /NAME OF FORM ;shape 
	WRITE "</NOBR>"
	WRITE "</B>"
	DO EH^WWWTAB
	DO EL^WWWTAB
	DO STOP^WWWTAB
	WRITE "<BR><BR>"
	;DO START00^WWWTAB
	;DO NL^WWWTAB
	;DO NF^WWWTAB
	;DO ZW^WWWTAB
	;WRITE "<FONT SIZE=3>"
	;WRITE "<B>"
	;WRITE $$^WWWTEXT(47)_"<FONT SIZE=1>"_"&nbsp;"_"&nbsp;"_"&nbsp;"_"["_YBED_", "_$$^WWWDATE($HOROLOG)_", "_$$^WWWTIME($HOROLOG)_"]"_"</FONT>"
	; ÜBERSCHRIFT2:           AUSWAHL_    [ BEDIENER,  DATUM,   UHRZEIT]
	;WRITE "</B>"
	;WRITE "<FONT SIZE=3>"
	;WRITE "<BR><BR>"
	;DO STOP^WWWTAB
	;DO FS^WWWTAB($$^WWWDATE($H))
	WRITE "<TABLE BORDER=0 WIDTH=60%><TR><TD>"
	DO FS^WWWTAB()
	;SCHREIBEN TABELLENANFANG  /START TABLE ;write 
	WRITE YCR
	;WRITE "<CENTER>"
	WRITE "<TABLE BORDER=0 WIDTH=100% CELLSPACING=5 BGCOLOR="_YGRAY_">"
	;SUCHEN DATENFELDER DES AKTUELLEN FORMULARS /SEARCH FOR DATAFIELD IN THE FORM ;seek within shape 
	SET (ZEILE,SPALTE,TPOS)=""
	set idxForm = $$^WWWUMLAU(YFORM,1)	// JW
	SET ZEILE="" FOR  SET ZEILE=$ORDER(^WWW122s(0,3,idxForm,ZEILE)) QUIT:ZEILE=""  DO
	. SET SPALTE="" FOR  SET SPALTE=$ORDER(^WWW122s(0,3,idxForm,ZEILE,SPALTE)) QUIT:SPALTE=""  DO
	. . SET TPOS="" FOR  SET TPOS=$ORDER(^WWW122s(0,3,idxForm,ZEILE,SPALTE,TPOS)) QUIT:TPOS=""  DO
	. . . SET LFN="" FOR  SET LFN=$ORDER(^WWW122s(0,3,idxForm,ZEILE,SPALTE,TPOS,YFORM,LFN)) QUIT:LFN=""  DO
	. . . . SET YNAME=""
	. . . . SET YFELD=$GET(^WWW122(0,YFORM,LFN,1))  ;DATENFELD /DATA FIELD ;data item 
	. . . . SET YNAME=$PIECE(YFELD,Y,12)
	. . . . IF $DATA(^WWW1221(0,YFORM,LFN,SPRACHE,1)) SET YNAME=$PIECE(^(1),Y,1)  ;FELDNAME IN SPRACHE / NAME IN ;within Language Name within 
	. . . . ;SET YNAME=$$^WWWFELDNAME(YFORM,"D",LFN)  ;FELDNAME /NAME
	. . . . SET YVAR=$PIECE(YFELD,Y,21)  ;VORGABE VARIABLE ( VORG() )  /VARIABLE NAME ;default Name 
	. . . . SET YTYP=$PIECE(YFELD,Y,5)  ;FELDTYP
	. . . . SET YVARIN=""
	. . . . IF YVAR'="" SET YVARIN=$TRANSLATE(@YVAR,";",",")  ;INHALT DER VORG-VARIABLE /VARIABLE VALUE
	. . . . ;
	. . . . DO NL^WWWTAB
	. . . . DO ZWR^WWWTAB
	. . . . WRITE "<FONT SIZE=2>"
	. . . . WRITE YNAME_" : "  ;SCHREIBEN FELDNAME /WRITE FIELDNAME
	. . . . DO ZWL^WWWTAB
	. . . . ;
	. . . . FOR YI=1:1 SET YINHALT=$PIECE(YVARIN,",",YI) QUIT:$PIECE(YVARIN,",",YI,999)=""  DO  ;SCHLEIFE FÜR MULTI-FELDER /LOOP FOR MULTIPLE FIELD (SELECT) ;to 
	. . . . . SET YQ=0
	. . . . . IF YINHALT'="" DO   ;UMWANDLUNG PARAMETER-NUMMER IN PARAMETER-NAME AUS FORMULAR /CHANGE PARAMETER INTO PARAMETER-TEXT ;within out of form parameter 
	. . . . . . IF $DATA(^WWW1251(0,YFORM,LFN,YINHALT,1)) DO
	. . . . . . . SET YINHALT=$PIECE(^(1),Y,1)
	. . . . . . . SET YQ=1
	. . . . . . . QUIT
	. . . . . . QUIT
	. . . . . ;
	. . . . . IF YQ=0 DO  ;UMWANDLUNG PARAMETER-NUMMER IN PARAMETER-NAME AUS RELATIONSDATEI /CHANGE PARAMETER INTO TEXT OUT OF RELATION CLASS ;within out of parameter Text 
	. . . . . . NEW YDAT,YKE,YFE,YSAT,YSPR,YDATA
	. . . . . . SET YDAT=$PIECE(YFELD,Y,32)   ;RELATIONS-DATEI / RELATION CLASS (I.E. WWW101)
	. . . . . . QUIT:YDAT=""
	. . . . . . SET YKE=$PIECE(YFELD,Y,33)    ;RELATION-PRIMÄRSCHLÜSSEL / KEY OF RELATION CLASS (I.E. "PARAMETER",SPRACHE)
	. . . . . . IF YKE'="" IF $EXTRACT(YKE)'="""" IF '$FIND(YKE,",")  QUIT:'$DATA(@(YKE))  QUIT:$GET(@(YKE))=""  ;CHECK VALIDATION OF KEY
	. . . . . . SET YFE=+$PIECE(YFELD,Y,34)   ;RELATIONS DATENFELD NR.  /DATAFIELD NO. ;data item 
	. . . . . . IF +YFE=0 SET YFE=1           ;WENN KEINE AUSGEWÄHLT DANN 1 / DFLT. IS 1 ;when no select 
	. . . . . . SET YSPR=$PIECE($GET(^WWW001(0,YDAT,1)),Y,7)  ;SPRACHENDATEI FÜR RELATION  / CHECK FOR LANGUAGE RELATION (IF AVAILABLE) ;to 
	. . . . . . IF YSPR'="" SET YDAT=YSPR,YFE=1  ;USE LANGUAGE RELATION
	. . . . . . SET YSAT="^"_YDAT_"("_$$^WWWYM(YDAT,1)  ;YSAT=^RELATIONS-DATEI(YM            /BUILD DATA REFERENCE: ^ROUTINE(YM
	. . . . . . SET YDATA=$GET(^WWW001(0,YDAT,1))   ;ÜBER OBJEKT KLASSE GANZ DATENFELD       /CLASS NAME ;via thing groovy wholly data item Name 
	. . . . . . IF YKE'="" SET YSAT=YSAT_YKE_","    
	. . . . . . ;WENN RELATION-PRIMÄSCHLÜSSEL NICHT "",DANN YSAT=^RELATIONS-DATEI(YM,PRIMÄSCHLÜSSEL, /MOVE ON BUILDING REFERENCE:
	. . . . . . SET YSAT=YSAT_""""_$TRANSLATE(YINHALT,"""")_""""                            ;PUT IN QUOTES ;within 
	. . . . . . IF YSPR'="" SET YSAT=YSAT_",SPRACHE"      ;YSAT=^RELATIONS-DATEI(YM,PRIMÄSCHLÜSSEL,SPRACHE /MOVE ON BUILDING REFERENCE:
	. . . . . . IF $PIECE(YDATA,Y,8)'=4 SET YSAT=YSAT_",1)"  ;YSAT=^RELATIONS-DATEI(YM,PRIMÄSCHLÜSSEL,SPRACHE,1)  /MOVE ON BUILDING REFERENCE:
	. . . . . . ;ALTERNATIVE DATENSPEICHERUNG PRÜFUNG   ;option quiz 
	. . . . . . IF $PIECE(YDATA,Y,8)=4 SET YSAT=YSAT_")"  ;ALTERNATE SAVE METHOD
	. . . . . . SET YSAT(1)=$PIECE($$^WWWSETL(YSAT),Y,YFE)   ;READ DATA
	. . . . . . IF $EXTRACT(YKE)="""" IF YSAT(1)'="" SET YINHALT=$EXTRACT($TRANSLATE(YSAT(1),"|"," "),1,30) SET YQ=1 QUIT  ;CHANGE PARAMETER INTO '(PARAMETER) TEXT'
	. . . . . . IF YSAT(1)'="" SET YINHALT="("_YINHALT_") "_$EXTRACT($TRANSLATE(YSAT(1),"|"," "),1,30) SET YQ=1  ;CHANGE PARAMETER INTO 'TEXT'
	. . . . . . QUIT
	. . . . . IF YQ=0 SET YINHALT=$$^WWWTR(0,YTYP,YINHALT)  ;CHANGE INTO FORMAT FOR DISPLAY
	. . . . . IF YTYP=2 IF YINHALT=1!(YINHALT=0) SET YINHALT=$PIECE($GET(^WWW100(0,"JA/NEIN",SPRACHE,YINHALT,1)),Y,1)  ;CHANGE INTO FORMAT FOR YES/NO FIELD
	. . . . . ;
	. . . . . WRITE "<FONT SIZE=2>"
	. . . . . WRITE "&nbsp;"_YINHALT  ;SCHREIBEN FELDINHALT (WENN PARAMETER DANN PARAMETERNAME)  / PRINT PARAMETER/TEXT
	. . . . . WRITE "<BR>"
	. . . . . QUIT
	. . . . QUIT
	. . . DO EF^WWWTAB
	. . . DO EL^WWWTAB
	. . . QUIT
	. . QUIT
	. QUIT
	DO STOP^WWWTAB
	;WRITE "</CENTER>"
	DO FSE^WWWTAB
	WRITE YCR,"</TD></TR></TABLE>"
	;WRITE "</CENTER>"
	WRITE YCR,"<BR>"
	WRITE YCR,"</TD></TR>"
	WRITE YCR,"</TABLE>"
	DO ^WWWFRAME(1)
	IF $GET(NOLINE)'=1 DO FF^WWWW()  ;KOPF NUR AUF NEUER SEITE DRUCKEN, WENN NOLINE NICHT 1  ;FORMFEED
	QUIT
]]></Routine>
</Export>