<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWWPARAEXPL" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWWPARAEXPL   ;WWWPARAEXPL;FIS;SUCHANZEIGE MIT DATEISTRUKTUR;02.06.2003
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		SUCHANZEIGE MIT DATEISTRUKTUR
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FIS	02.06.2003
	;|
	;\------------------------------------------------------------------/
	;
	NEW (%request,%session,%KEY,%,%ZCS,%CGIEVAR)
	DO ^WWWVAR  ;VORGABEN SETZEN ;typeset 
	SET YLFDAT=$GET(%(YQUERY,"YLFDAT"))  ;LAUFENDE NR DATENSATZ ;data record 
	SET YLFFORM=$GET(%(YQUERY,"YLFFORM"))  ;LAUFENDE NR FORMULAR ;form 
	SET YLFDATX=YLFDAT
	SET YLFDAT=$REVERSE($EXTRACT(YLFDAT,2,99))
	FOR YI=1:1  QUIT:$EXTRACT(YLFDAT,YI,99)=""  QUIT:$EXTRACT(YLFDAT,YI)?1N=0  SET YLFN=$EXTRACT(YLFDAT,1,YI)
	SET YLFN=$REVERSE($G(YLFN))
	IF YLFFORM="" SET YLFFORM=YLFN
	SET YART=$EXTRACT(YLFDAT,YI)
	IF YART'="M" IF YART'="P" IF YART'="D" QUIT
	SET YFORM=$REVERSE($EXTRACT(YLFDAT,YI+1,99))
	IF YFORM'="" IF $PIECE($GET(^WWW120(0,YFORM,1)),Y,123)=1 SET YHTMFORM="WWW2"
	SET YDATEI1=""  ;KLASSE ;groovy 
	SET YDVOR=""   ;KLASSENDEFINITION
	SET YSATZ=""   ;FORMULARDEFINITION
	IF YART="P" DO  ;PRIMAERSCHLUESSEL
	. SET YDATEI1=$PIECE($GET(^WWW120(0,YFORM,1)),Y,11)  ;RELATIONSDATEI
	. SET YDVOR=$GET(^WWW002(0,YDATEI1,YLFN,1))  ;VORGABEN AUS DATEIDEV ;out of 
	. SET YSATZ=$GET(^WWW121(0,YFORM,YLFFORM,1))  ;VORGABEN AUS FORMULAR ;out of form 
	. QUIT
	IF YART="D" DO  ;DATENFELD ;data item 
	. SET YDATEI1=$PIECE($GET(^WWW120(0,YFORM,1)),Y,11)
	. SET YDVOR=$GET(^WWW003(0,YDATEI1,YLFN,1))  ;DATEN AUS FELDDEV ;out of 
	. SET YSATZ=$GET(^WWW122(0,YFORM,YLFFORM,1))  ;DATEN AUS FORMULAR ;out of form 
	. QUIT
	IF YART="M" DO  ;MANUELLES FORMULAR ;form 
	. SET YSATZ=$GET(^WWW122(0,YFORM,YLFN,1))  ;DATEN AUS FORMULAR ;out of form 
	. QUIT
	SET YDATEI=$P(YDVOR,Y,8)  ;RELATIONSDATEI
	IF YDATEI="" SET YDATEI=$P(YSATZ,Y,32)
	SET YFIX=$P(YDVOR,Y,9)  ;FIXKEY
	IF YFIX="" SET YFIX=$P(YSATZ,Y,33)
	SET YRECORD=$P($P(YDVOR,Y,10),",",1)  ;ANZEIFEN DATENFELDER
	IF YRECORD="" SET YRECORD=$P($P(YSATZ,Y,34),",",1)
	IF YRECORD="" SET YRECORD=1
	SET YRECORD=$TR(YRECORD,";",",")
	SET YHEADER=$$^WWWFELDNAME(YFORM,YART,YLFN)  ;FELDNAME
	SET YKEYNUM=""
	SET YOFFSET=""
	FOR YI=1:1  QUIT:$P(YFIX,",",YI,99)=""  DO
	. IF $F($P(YFIX,",",YI),"""") SET $P(YFIX,",",YI)=$TR($P(YFIX,",",YI),"""") QUIT
	. SET $P(YFIX,",",YI)=@$P(YFIX,",",YI)
	. QUIT
	;SET YFIX=YM_","_YFIX
	;AUFBAU ZWISCHENDATEI
	;LOCK +^WWWPARAEXPL(YM,YDATEI):0 IF $T KILL ^WWWPARAEXPL(YM,YDATEI)
	;IF '$D(^WWWPARAEXPL(YM,YDATEI)) DO
	KILL ^WWWPARAEXPL(YM,YUSER)
	DO
	. SET TRENN="."
	. SET STRUCT=$GET(%(YQUERY,"YPARA"))
	. IF STRUCT'="" DO
	. . SET TRENN=$P($G(^WWWSTRUKTUR(0,YM,STRUCT,1)),Y,3)  ;0
	. . IF TRENN'="" SET TRENN=$E($P($G(^WWW100(0,"STRUKTUR",SPRACHE,TRENN,1)),Y,1),3)  ;XX.XX.XX
	. . QUIT
	. IF TRENN="" SET TRENN="."
	. ;SET SUCH="^"_YDATEI_"("_""""_YM_""""
	. SET SUCH="^"_YDATEI_"("_""""_$$^WWWYM(YDATEI)_""""  ;FIS;03.09.04
	. ;SET SAVE="^WWWPARAEXPL("_""""_YM_""""_","_""""_YDATEI_""""
	. SET SAVE="^WWWPARAEXPL("_""""_YM_""""_","_""""_YUSER_""""
	. IF YFIX'="" FOR YI=1:1:10 QUIT:$PIECE(YFIX,",",YI,99)=""  DO   ;FESTE VORGABE  ZUM SUCHSUBSCRIPT ;default 
	. . SET SUCH=SUCH_","_""""_$PIECE(YFIX,",",YI)_""""
	. . SET SAVE=SAVE_","_""""_$PIECE(YFIX,",",YI)_""""
	. . QUIT
	. SET SUCH=SUCH_")"
	. SET LENGTH=$QL(SUCH)
	. FOR  DO  QUIT:SUCH=""
	. . SET SUCH=$Q(@SUCH)
	. . IF $TR($P(SUCH,",",2,LENGTH),"""")'=$TR(YFIX,"""") SET SUCH=""  QUIT
	. . SET SAVE(1)=SAVE
	. . SET KEY="" FOR YI=1:1 SET KEY=$PIECE($TR($P(SUCH,",",LENGTH+1),""""),TRENN,YI) QUIT:KEY=""  QUIT:KEY=")"  DO
	. . . SET SAVE(1)=SAVE(1)_","_""""_KEY_""""
	. . . QUIT
	. . SET SAVE(1)=SAVE(1)_")"
	. . SET @SAVE(1)=$P(@SUCH,Y,$P(YRECORD,",",1))_Y_$TR($P(SUCH,",",LENGTH+1),"""")
	. . QUIT
	. QUIT
	;&FILE=DATEI DIE ANGEZEIGT WIRD (STANDARD=WWWEXPLORE) ;who 
	;&FIX=FESTER ERSTER KEY (NUR WENN &FILE) ;premier KEY when 
	;&RECORD=FELDER DIE ANGEZEIGT WERDEN SOLLEN (STANDARD=1) ;who will should 
	;&OFFSET=STRUKTUR (WIRD GEBILDET)
	;&HEAD=TEXT FÃœR HEADER ;to 
	SET %(YQUERY,"TARGET")=$GET(YTARGET)  ;TARGET DER AUSGABE ;the expenses 
	SET %(YQUERY,"FILE")="WWWPARAEXPL"
	;SET %(YQUERY,"FIX")=YM_","_YDATEI_","_YFIX
	SET %(YQUERY,"FIX")=YM_","_YUSER_","_YFIX
	SET %(YQUERY,"RECORD")=YRECORD  ;FELDER, DIE ANGEZEIGT WERDEN (1,2,3,4)
	SET %(YQUERY,"YUCI")=$G(YUCI)  ;NAMESPACE
	SET %(YQUERY,"HEAD")=YHEADER
	SET %(YQUERY,"YKEY")=YKEY
	SET %(YQUERY,"YTRAKT")=YTRAKT
	SET %(YQUERY,"YBACK")=YBACK
	SET %(YQUERY,"FORM")=YFORM   ;ERFASSEN  ;Edit 
	SET %(YQUERY,"YFORM")=YFORM   ;ERFASSEN BETRIEB ;Edit location 
	;SET %(YQUERY,"OFFSET")=YM_","_YDATEI_","_YFIX   ;ANZEIGE AB SUBSCRIPT
	SET %(YQUERY,"OFFSET")=YM_","_YUSER_","_YFIX   ;ANZEIGE AB SUBSCRIPT ;Show Confirm. 
	;SET %(YQUERY,"YBILD")="www"   ;ANZEIGE AB SUBSCRIPT
	;&YLFDAT="_"Y"_YFORM_YART_YLFN_"&YLFORM="_$G(YBBN)
	MERGE %KEY=%(YQUERY)
	DO ^WWWPARAM
	QUIT
]]></Routine>
</Export>