<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INDRUCKXML3" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INDRUCKXML3 ;INDRUCKXML3;DT;DRUCKEN HINWEIS(ZEICHEN,SEITE..)XML;19.06.2002
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		DRUCKEN HINWEIS(ZEICHEN,SEITE..)XML
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	19.06.2002
	;|
	;\------------------------------------------------------------------/
	;
	NEW VERSAND,POS,POS1
	IF YSEITE'=1 IF $PIECE(YBELEG1,Y,11)'=1 QUIT   ;ANSCHRIFT AUCH AUF FOLGESEITEN? ;too upon 
	SET POS1=""
	SET POS=$ORDER(YAUFTRAG(""))
	IF POS'="" SET POS1=$GET(^INAUFP(YM,YAUFTRAG,POS,1))
	IF $PIECE(YBELEG1,Y,15)="" SET $PIECE(YBELEG1,Y,15)=40
	DO XML^INDRUCK(,,,"DATE",$$^WWWDATE(YDATE))
	SET YI(1)=$TRANSLATE($PIECE(YBELEG1,Y,17),";",",")   ;WELCHE HINWEISE DATUM USW.
	FOR YI=1:1 SET YI(2)=$PIECE(YI(1),",",YI) QUIT:YI(2)=""  DO
	. SET YI(4)=$PIECE($GET(^WWW101(0,"BETREFF",SPRACHE,YI(2),1)),Y,1)  ;TEXT FÜR DRUCK ;Text to printing 
	. IF YBELEG=1 SET YI(4)=$PIECE($GET(^WWW101(0,"BETREFF1",SPRACHE,YI(2),1)),Y,1)  ;TEXT FÜR DRUCK DER ANGEBOTE ;Text to printing the 
	. SET YI(5)=""
	. IF YI(2)=0 DO  ;ORT, DATUM
	. . SET YI(5)=$PIECE($GET(^WWW0121(0,YM,YBETRIEB,1)),Y,8)   ;ORT DES BETRIEBES ;village 
	. . IF YI(5)'="" SET YI(5)=YI(5)_", "   ;BEC;08.09.04;DATUM ERGÄNTZT ;Date 
	. . SET YI(5)=YI(5)_$$^WWWDATE(YDATE)   ;DATUM ;Date  ;Date Date 
	. . QUIT
	. IF YI(2)=1 SET YI(5)=YBED  ;UNSER ZEICHEN ;we sign 
	. IF YI(2)=2 IF YBELEG'=9 SET YI(5)=$PIECE($GET(^WWW013(0,YBED,1)),Y,31)  ;TELEFON MITARBEITER
	. IF YI(2)=3 IF YBELEG'=9 SET YI(5)=$PIECE($GET(YAUFTRAG1),Y,30)  ;VERKÄUFER ;salesman 
	. IF YI(2)=4 IF YBELEG'=9 IF $PIECE($GET(YAUFTRAG1),Y,30)'="" SET YI(5)=$PIECE($GET(^WWW013(0,$PIECE($GET(YAUFTRAG1),Y,30),1)),Y,31)  ;TELEFON VERKAUF ;sale 
	. IF YI(2)=6 SET YI(5)=YAUFTRAG  ;AUFTRAGSNUMMER
	. IF YBELEG=9 IF YI(2)>6 QUIT  ;WARENBEREITSTELLUNGSSCHEIN NUR BIS HIER ! ;only until here is 
	. IF YI(2)=7 DO
	. . IF $PIECE($GET(YAUFTRAG1),Y,10)="" QUIT
	. . IF '$FIND($PIECE($GET(YAUFTRAG1),Y,10)," ") SET YI(5)=$PIECE($GET(YAUFTRAG1),Y,10) QUIT  ;AUFTRAG ERTEILT VON ;order 
	. . ;IF $LENGTH($PIECE($GET(YAUFTRAG1),Y,10))'>15 SET YI(5)=$PIECE($GET(YAUFTRAG1),Y,10) QUIT  ;AUFTRAG ERTEILT VON ;order 
	. . IF $LENGTH($PIECE($GET(YAUFTRAG1),Y,10))'>30 SET YI(5)=$PIECE($GET(YAUFTRAG1),Y,10) QUIT  ;BEC;26875;30.11.04;MORE CHAR.
	. . ;SET YI(5)=$REVERSE($PIECE($REVERSE($PIECE($GET(YAUFTRAG1),Y,10))," ",1))  ;AUFTRAG ERTEILT VON
	. . IF $LENGTH($PIECE($GET(YAUFTRAG1),Y,10)," ")>1 SET YI(5)=$PIECE($PIECE($GET(YAUFTRAG1),Y,10)," ",1)_" "_$REVERSE($PIECE($REVERSE($PIECE($GET(YAUFTRAG1),Y,10))," ",1))  ;BEC;21.07.04;25867
	. . ;IF $LENGTH(YI(5))>15 SET YI(5)=$EXTRACT(YI(5),1,14)_"."      ;BEC;21.07.04;25867
	. . IF $LENGTH(YI(5))>30 SET YI(5)=$EXTRACT(YI(5),1,30)_"."      ;BEC;26875;30.11.04;MORE CHAR.
	. . QUIT
	. IF YI(2)=8 SET YI(5)=$$^WWWDATE($PIECE($GET(YAUFTRAG1),Y,4))  ;AUFTRAGSDATUM
	. IF YI(2)=9 SET YI(5)=$G(YKUNDE) IF $G(YKUNDE)'="" IF $PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,226)'="" SET YI(5)=YI(5)_"/"_$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,226) ;KUNDENNUMMER / EIGENE NUMMER BEIM LIEFERANT;TYBD;26972;13,12,2004
	. IF YI(2)=10 IF $PIECE($GET(YAUFTRAG1),Y,19)="" QUIT  ;KEIN LIEFERTERMIN ;no time of delivery 
	. IF YI(2)=10 IF $PIECE(YBELEG1,Y,36)'=1 SET YI(5)=$$^WWWDATE($PIECE($GET(YAUFTRAG1),Y,19))  ;LIEFERTERMIN ;time of delivery 
	. IF YI(2)=10 IF $PIECE(YBELEG1,Y,36)=1 SET YI(5)=$$^WWWWEEK($PIECE($GET(YAUFTRAG1),Y,19),1)  ;LIEFERTERMIN WOCHE ;time of delivery week 
	. IF YI(2)=11 SET YI(5)=$PIECE(YADRES,Y,30)  ;KUNDENNUMMER LIEFERANT ;supplier 
	. IF YI(2)=12 SET YI(5)=YSEITE  ;SEITE ;side 
	. IF YI(2)=15 SET YI(5)=$GET(YLIEFER)  ;LIEFERANTENNUMMER
	. ;IF YI(2)=16 IF $PIECE(YAUFTRAG1,Y,7)'="" SET YI(5)=$PIECE(YAUFTRAG1,Y,7)  ;ANGEBOTSNUMMER;BEC;25571;19.04.04
	. IF YI(2)=16 IF YBELEG'=1!(YBELEG'=10) IF $PIECE(YAUFTRAG1,Y,7)'="" SET YI(5)=$PIECE(YAUFTRAG1,Y,7)  ;ANGEBOTSNUMMER;BEC;25571;19.04.04
	. IF YI(2)=16 IF YBELEG=1!(YBELEG=10) SET YI(5)=YAUFTRAG       ;ANGEBOTSNUMMER
	. IF YI(2)=17 IF $PIECE(POS1,Y,100)'="" SET YI(5)=$$^WWWTIME($PIECE(POS1,Y,100))   ;AUSLIEFERUNGSUHRZEIT
	. IF YI(2)=18 IF YVERBAND'="" SET YI(5)=YVERBAND_"/"_$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,2)   ;ZENTRALREG.-NR.
	. IF YBELEG'=1 IF YI(2)=13 DO  SET YI(5)=VERSAND  ;VERSANDART
	. . NEW YPOS
	. . SET VERSAND=""
	. . SET YPOS=$ORDER(YAUFTRAG(""))
	. . IF YPOS="" SET YPOS=$ORDER(^INAUFP(YM,YAUFTRAG,""))
	. . IF YPOS'="" SET VERSAND=$PIECE($GET(^INAUFP(YM,YAUFTRAG,YPOS,1)),Y,95)  ;VERSANDART AUS TOUR ;out of voyage 
	. . IF VERSAND="" SET VERSAND=$PIECE(YAUFTRAG1,Y,16)  ;AUS AUFTRAG ;out of order 
	. . QUIT
	. IF YBELEG'=1 IF YI(2)=14 DO  SET YI(5)=$$^WWWDATE(LIEFTERM)  ;LIEFERDATUM
	. . NEW YPOS
	. . SET LIEFTERM=""
	. . SET YPOS=$ORDER(YAUFTRAG(""))
	. . IF YPOS="" SET YPOS=$ORDER(^INAUFP(YM,YAUFTRAG,""))
	. . IF YPOS'="" SET LIEFTERM=$PIECE($GET(^INAUFP(YM,YAUFTRAG,YPOS,1)),Y,76)  ;LIEFERDATUM
	. . QUIT
	. IF YI(2)=21 DO  ;STEUERNUMMER;FIS;24855;23.12.03
	. . NEW STNR
	. . SET STNR=$PIECE($GET(^INFIBPAR(0,YM,YLOCATION,1)),Y,40)
	. . IF STNR'="" SET YI(5)=STNR
	. . QUIT
	. IF YI(2)=22 SET YI(5)=$PIECE($GET(YAUFTRAG1),Y,302)  ;KUNDENBESTELLNUMMER
	. IF YI(2)=23 SET YI(5)=$PIECE($GET(YAUFTRAG1),Y,300)  ;EXTERNE BESTELLNUMMER
	. IF YI(2)=24 DO  ;UST ID NUMMER;FIS;24855;23.12.03
	. . NEW STNR
	. . SET STNR=$PIECE($GET(^INFIBPAR(0,YM,YLOCATION,1)),Y,20)
	. . IF STNR'="" SET YI(5)=STNR
	. . QUIT
	. QUIT:YI(5)=""  ;KEIN EINTRAG ;no 
	. ;DO XML^INDRUCK(,,,YI(4),YI(5))  ;SPEICHERN
	. DO XML^INDRUCK(,,,"BETREFF"_YI(2),YI(5))  ;SPEICHERN ;Save 
	. QUIT
	QUIT
]]></Routine>
</Export>