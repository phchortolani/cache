<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

<title>Alphalinc Software Development Environment - implementation - Export Hooks</title><style>
	.code
	{
	font-weight: normal;
	font-size: 10pt;
	font-family: Courier, Monospaced;
	}
</style></head>




<body style="font-family: Arial,Helvetica,sans-serif; font-size: 11pt;">

<p><font size="2"><a href="../index.html">[Documentation Home]</a>
	<a href="index.html">[ASDE implementation home]</a></font></p>
<h2>Alphalinc Software Development Environment - Old Export Hooks</h2>

<p>This is the list of all Export Hooks that <b> were used</b> in Alphalinc to automatically
	export all code and metadata (@NM forms, help, language, etc) as regular file system objects.
</p>

<p><b>Please observe</b> that this page is kept only for documental purposes! If you want to see the current hooks, please
go to the <a href="sourceControlHooks.html">Source Control Hooks page</a>.
</p>

<center><b>Be aware that the information in this document may not be valid anymore.</b></center>
<hr />

<p>In order to prevent accidentally overwriting of those files, a copy
is kept at the configuration/original-hooks/ folder. To migrate an
existing namespace to a new source control repository read the <a href="../overview/namespace-migration.html">namespace migration document</a>.
</p>

<h3>Studio Hooks</h3>
<p>Studio Hooks are responsible for exporting to the file system the current artifact in Studio when the
user Saves it. The final destination and the external file name are generated by the system.

</p><ol>
	<li><a href="http://localhost:1972/apps/documatic/%CSP.Documatic.cls?APP=1&amp;CLASSNAME=SourceControl.AlphalincBase">
		SourceControl.AlphalincBase.cls</a> - this is the base class for all SourceControl classes (common stuff, utilities)</li>

	<li><a href="http://localhost:1972/apps/documatic/%CSP.Documatic.cls?APP=1&amp;CLASSNAME=SourceControl.Exporter">
SourceControl.Exporter.cls</a> - this class knows how to export all Alphalinc artifacts. Calls to its Methods
		are deployed everywhere in the system, including @NM forms and some routines called by forms. For @NM forms,
		The export methods also call WWWCOFAExportAndImport.MAC</li>

	<li><a href="http://localhost:1972/apps/documatic/%CSP.Documatic.cls?APP=1&amp;CLASSNAME=SourceControl.Importer">
		SourceControl.Importer.cls</a> - this class handles the transfering from the external files to Caché. Most of its Methods are
		autonomous, expect for a call to ImportMetadata^WWWCOFAExportAndImport</li>

	<li><a href="http://localhost:1972/apps/documatic/%CSP.Documatic.cls?APP=1&amp;CLASSNAME=SourceControl.StudioHook">
	SourceControl.StudioHook.cls</a> - this class is called whenever the user saves or deletes a file whitin studio</li>

	<li><a href="http://localhost:1972/apps/documatic/%CSP.Documatic.cls?APP=1&amp;CLASSNAME=SourceControl.StudioHook">
	SourceControl.Hashtable.cls</a> - this is a helper class. Object Oriented Cache doesn't allow direct access to globals
	inside methods.</li>

	<li><a href="http://localhost:1972/apps/documatic/%CSP.Documatic.cls?APP=1&amp;CLASSNAME=SourceControl.XMLReader">
	SourceControl.XMLReader.cls</a> - the internal XMLReader that comes with Intersystems Cachè has a very critical bug.
	it strips leading and trailing whitespaces (blanks,tabs, line feeds) from every block of class code. this leads to
	many syntax errors. The SourceControl.XMLReader.cls is almost a copy of Caché's implementation, except that it
	initializes the parser telling it to <b>preserve</b> whitespaces.</li>

<li><a href="http://localhost:1972/apps/documatic/%CSP.Documatic.cls?APP=1&amp;CLASSNAME=SourceControl.XMLFileFilter.cls">
	SourceControl.XMLFileFilter.cls</a>
- this class reads a XML file and strips all the timestamps and
checksums that are generated automatically by the Cache API. The
timestamps are regenerated by Cache at every save operation and the
checksums are changed because of that. Those changes are incpmpatible
with source control because it appears as conflicts every time. The
Cache API saves the file as build/XXX.tmp then
SourceControl.XMLFileFilter.cls filter it and saves it to
src/cls/xxxx.cls.xml. </li>

</ol>

<h3>@Net Manager Hooks</h3>

<p><b>Main routine for @NM import/export</b></p>
<table border="1">
	<tbody><tr>
		<td>WWWCOFAExportAndImport.MAC
		</td>

		<td>All export and import routines are used. Most
		export routines were refactored to call ExportNMXXXX, which receives parameters.
		</td>
	</tr>
</tbody></table>

<p><b>Forms</b></p>
<table border="1">
	<tbody><tr>
		<td>Form:
		</td>
		<td> WWW120
		</td>

		<td>Execute After Saving Data Records: "D ^WWW120"
		</td>
	</tr>

	<tr>
		<td>Routine:</td>
		<td>WWW120.MAC </td>

		<td>Added call to ##class(SourceControl.Exporter).ExportNMForm(YKEY)
		</td>
	</tr>
</tbody></table>

<p><b>@NM Classes</b></p>
<table border="1">
	<tbody><tr>
		<td>Form:
		</td>
		<td>WWW001
		</td>

		<td>Execute After Saving Data Records: "d OnAterSave^WWW001(YKEY)"
		</td>
	</tr>

	<tr>
		<td>Routine:</td>
		<td>WWW001.MAC </td>

		<td>Added call to ##class(SourceControl.Exporter).ExportNMForm(YKEY)
		</td>
	</tr>

	<tr>
		<td>Routine:</td>
		<td>WWW001OO.MAC</td>

		<td>NM Class creation and compilation - Refactored the "COMPILE" routine to call "CompileNMClass",
			which is also called from ##class(SourceControl.Import).CompileAllImportedFiles(). (it is used only
			when a user wants to. There is no calls been done to that method now, because NM Classes are not
			compiled anymore during an import.
		</td>
	</tr>

	<tr>
		<td>Routine:</td>
		<td>WWW001OO.MAC</td>

		<td> The following code was added to the end of routine CREATE^WWW001OO.MAC. It is meant to be called
			whenever a user clicks on compile button or calls CREATE or CREATEALL.
			<p class="code">
			//Export the related Cache class to the file system if the creation was successful<br />
			if (SUCCESS) {<br />
			do ##class(SourceControl.Exporter).ExportClassByNMClass(iCLASS)<br />
			}<br />
			</p>


		</td>
	</tr>

</tbody></table>

<p><b>@NM Menus</b></p>
<table border="1">
	<tbody><tr>
		<td>Form:
		</td>
		<td>WWW004
		</td>

		<td>Execute After Saving Data Records: "D ^WWW004" (unchanged)
		</td>
	</tr>

	<tr>
		<td>Routine:</td>
		<td>WWW004.MAC </td>

		<td>Added "do ##class(SourceControl.Exporter).ExportNMMenu(menuName)"
		</td>
	</tr>
</tbody></table>

<p><b>@NM Language text and language related artifacts</b>. This includes
all screens where the user might cutomize or change anything related to the text of forms. The
usual behavior is to call the export method for the form name whenever some attribute is added, changed or deleted.</p>
<table border="1">
	<tbody><tr>
		<td>Form:
		</td>
		<td><a href="../../configuration/original-hooks/globals/nm/forms/WWW1201-2340.form">WWW1201</a> (form description)
		</td>

		<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion

		</td>
		<td>When
		the user saves or deletes records using this form, the form named $piece(YKEY,",",1) is exported.
		"D ##class(SourceControl.Exporter).ExportNMForm($piece(YKEY,",",1))"
		</td>
	</tr>

	<tr>
		<td>Form:
		</td>
		<td><a href="../../configuration/original-hooks/globals/nm/forms/WWW124-10029.form">WWW124</a> (buttons)
		</td>

		<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion

		</td>
		<td>do OnAfterSave^WWW124(YKEY,YFELD) (unchanged) <br /> do OnAfterDelete^WWW124(YKEY) (unchanged)
		</td>
	</tr>

<tr>
		<td>Routine
		</td>
		<td>WWW124.MAC (buttons)
		</td>

		<td>OnAfterSave^WWW124<br />
		OnAfterDelete^WWW124(pYKEY)
		</td>
		<td>Added call to ##class(SourceControl.Exporter).ExportNMForm($piece(YKEY,",",1)) (both hooks)
		</td>
	</tr>

<tr>
		<td>Form
		</td>
		<td>WWW124D (button customization)
		</td>

		<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion
		</td>
		<td>Added call to ##class(SourceControl.Exporter).ExportNMForm($piece(YKEY,",",1)) (both hooks)
		</td>
</tr>

<tr>
		<td>Form
		</td>
		<td>WWW1203 (tabs)
		</td>

		<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion
		</td>
		<td>Added call to ##class(SourceControl.Exporter).ExportNMForm($piece(YKEY,",",1)) (both hooks)
		</td>
</tr>

<tr>
		<td>Form
		</td>
		<td>WWW1203D (tabs customization)
		</td>

		<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion
		</td>
		<td>Added call to ##class(SourceControl.Exporter).ExportNMForm($piece(YKEY,",",1)) (both hooks).
It was also necessary to add the "WWW1203D" form name to the list of exported customizations in WWWCOFAEImportAndExport.MAC.
		</td>
</tr>

<tr>
		<td>Form
		</td>
		<td>WWW100 (system parameters)
		</td>

		<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion
		</td>
		<td>do ##class(SourceControl.Exporter).ExportNMSysParameters($piece(YKEY,",",1)) <br />
		(This method export as a file if there is aything left in ^WWW100(0,code), otherwise it deletes the external file)
		</td>
</tr>

<tr>
		<td>Form
		</td>
		<td>WWW101 (application parameters)
		</td>

		<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion
		</td>
		<td>do ##class(SourceControl.Exporter).ExportNMAppParameters($piece(YKEY,",",1)) <br />
		(This method export as a file if there is aything left in ^WWW101(0,code), otherwise it deletes the external file)
		The routine Generate^WWWConst must still be called in SourceControl.Importer, <a href="../todo.html">see todo list.</a>
		</td>
</tr>

<tr>
		<td>Form
		</td>
		<td>WWW009 - (Edit language Texts)
		</td>

		<td>Execute After Saving Data Records<br />

		</td>
		<td>do ##class(SourceControl.Exporter).ExportNMLanguageText($piece(YKEY,",",2)) <br />
		(In this case YKEY=[language,prefixCode] so we need the second field. The external file is not deleted
		when the code is empty, <a href="../todo.html">see todo list.</a>).
		</td>
</tr>

<tr>
		<td>Form
		</td>
		<td>INPARA - (user parameters)
		</td>

		<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion
		</td>
		<td>do ##class(SourceControl.Exporter).ExportNMUserParameters($piece(YKEY,",",1)) <br />
		(In this case YKEY=[code,language,0] so we need the first field. The external file is  deleted
		when the code is empty)
		</td>
</tr>

<tr>
		<td>Form
		</td>
		<td>WWWLNG - translation screen
		</td>

		<td><p>This
is a rather tricky screen, because not only it changes the @NM
dictionary (^WWWDIC) but it also changes any one of a number of @NM
artifacts, depending on what the user has clicked on the form WWW120. </p>
		<p>We place some hooks in the routine WWWLNG1 in two places:
			</p><ol>
				<li>Default WWWLNG1.MAC routine (the one that begins)
				</li> <br />

				<li>Save^WWWLNG1(SCHLUE,TEXT) - SCHULE is the complete global reference
					that is being altered by WWWLNG1.
				</li>

			</ol>
		
		</td>
		<td>	<ol>
				<li> WWWLNG1.MAC - standard call to
					"do ##class(SourceControl.Exporter).ExportNMDictionary(VON,NACH)" after we are sure
					the "to" (NACH) and "from" (VON) languages are not empty.
				</li> <br />

				<li>Save^WWWLNG1(SCHLUE,TEXT) - call to
					"do ##class(SourceControl.Exporter).ExportNMArtifactByGlobal(SCHLUE)"

					<b>This method was tested with references to WWW120 WWW004 WWW001 WWW002 WWW003 WWW1203 WWW101 WWW100 WWW124 WWW127. </b> It might be necessary to add more.
				</li>

			</ol>

		</td>
</tr>

<tr>
	<td>Form
	</td>
	<td>COMHelp - Help Text
	</td>

	<td>Execute After Saving Data Records<br />

	</td>
	<td>added "do ##class(SourceControl.Exporter).ExportNMForm($piece(YKEY,",",1)) <br />
			(In this case YKEY=[FormName,language] so we need the first field)
	</td>
</tr>


<tr>
	<td>Form
	</td>
	<td>WWW1211 - Edit Option Text
	</td>

	<td>Execute After Saving Data Records<br />

	</td>
	<td>added "do ##class(SourceControl.Exporter).ExportNMForm($piece(YKEY,",",1)) <br />
			(In this case YKEY=[FormName,number,language] so we need the first field)
		</td>
</tr>

<tr>
	<td>Form
	</td>
	<td>WWW120D - Customize Form Name
	</td>

	<td>Execute After Saving Data Records<br />
	Execute After Data Record Deletion

	</td>
	<td>added "do ##class(SourceControl.Exporter).ExportNMForm($piece(YKEY,",",1)) <br />
	(In this case YKEY=[FormName,number] so we need the first field)
	The same method call is added to the other hook (delete) because we need to re-export the
	form to show that it doesn't have that part of content anymore.
	</td>
</tr>

<tr>
	<td>Form
	</td>
	<td>WWW0011 - Class Description
	</td>

	<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion

	</td>
	<td>added "do ##class(SourceControl.Exporter).ExportNMClass($piece(YKEY,",",1)) <br />
			(In this case YKEY=[ClassName,number] so we need the first field)
			The same method call is added to the other hook (delete) because we need to re-export the
			class to show that it doesn't have that part of content anymore.
	</td>
</tr>

<tr>
	<td>Form
	</td>
	<td>WWW0021 - Class PK (primary key language text)
	</td>

	<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion

	</td>
	<td>added "do ##class(SourceControl.Exporter).ExportNMClass($piece(YKEY,",",1)) <br />
			(In this case YKEY=[ClassName,number,language] so we need the first field)
			The same method call is added to the other hook (delete) because we need to re-export the
			class to show that it doesn't have that part of content anymore.
	</td>
</tr>

<tr>
	<td>Form
	</td>
	<td>WWW0031 - Class Field (data item language text)
	</td>

	<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion

	</td>
	<td>added "do ##class(SourceControl.Exporter).ExportNMClass($piece(YKEY,",",1)) <br />
			(In this case YKEY=[ClassName,number,language] so we need the first field)
			The same method call is added to the other hook (delete) because we need to re-export the
			class to show that it doesn't have that part of content anymore.
	</td>
</tr>

<tr>
	<td>Form
	</td>
	<td>WWW0031 - Class Field (data item language text)
	</td>

	<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion

	</td>
	<td>added do ##class(SourceControl.Exporter).ExportNMMenu($piece(YKEY,",",1)) <br />
			(In this case YKEY=[MenuName,menuItem,language] so we need the first field)
			The same method call is added to the other hook (delete) because we need to re-export the
			menu to show that it doesn't have that part of content anymore.
	</td>
</tr>

<tr>
	<td>Form
	</td>
	<td>WWW00411 - Main Menu Translation
	</td>

	<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion

	</td>
	<td>added do ##class(SourceControl.Exporter).ExportNMMenu($piece(YKEY,",",1)) <br />
			(In this case YKEY=[MainMenuName,language] so we need the first field)
			The same method call is added to the other hook (delete) because we need to re-export the
			menu to show that it doesn't have that part of content anymore.
	</td>
</tr>

<tr>
	<td>Form
	</td>
	<td>WWW121D1 -  Customize Form Field (PK)
	</td>

	<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion

	</td>
	<td>added do ##class(SourceControl.Exporter).ExportNMForm($piece(YKEY,",",1)) <br />
			(In this case YKEY=[FormName,itemNumber, number, language] so we need the first field)
			The same method call is added to the other hook (delete) because we need to re-export the
			menu to show that it doesn't have that part of content anymore.
	</td>
</tr>

<tr>
	<td>Form
	</td>
	<td>WWW122D1 - Customize Form Field
	</td>

	<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion

	</td>
	<td>added do ##class(SourceControl.Exporter).ExportNMForm($piece(YKEY,",",1)) <br />
			(In this case YKEY=[FormName,itemNumber, number, language] so we need the first field)
			The same method call is added to the other hook (delete) because we need to re-export the
			menu to show that it doesn't have that part of content anymore.
		</td>
	</tr>

	<tr>
		<td>Form
		</td>
		<td>WWW003Calc - Calculated field translations
		</td>

		<td>Execute After Saving Data Records<br />
			Execute After Data Record Deletion

		</td>
		<td>added do ##class(SourceControl.Exporter).ExportNMClass($piece(YKEY,",",1)) <br />
				(In this case YKEY=[className,filedNumber] so we need the first field)
				The same method call is added to the other hook (delete) because we need to re-export
				the menu to show that it doesn't have that part of content anymore.
		</td>
	</tr>

<tr>
	<td>Form
	</td>
	<td>WWW003CalcLang - Calculated field definition
	</td>

	<td>Execute After Saving Data Records<br />
		Execute After Data Record Deletion

	</td>
	<td>added do ##class(SourceControl.Exporter).ExportNMClass($piece(YKEY,",",1)) <br />
			(In this case YKEY=[className,filedNumber] so we need the first field)
			The same method call is added to the other hook (delete) because we need to re-export
			the menu to show that it doesn't have that part of content anymore.
	</td>
</tr>

</tbody></table>




<p><b>Notice:</b> The matadata resulting from <i>INDRPPARA</i> is not versioned because it is something that
	each client has its ow definitions (print chraracteristics for reports).

	<!-- Start footer for all pages (just change the file to make it easier to have modifications) -->
	<br /><br /><br /><br />
	</p><hr />
	<span style="font-size: 9pt;">
		<p>This document is the file projectDirectory/Implementation/<b>docs/system/sourceControlHooks.html</b><br />
			Please feel free to make corrections and commit it to the repository.
		</p>
	</span>
	<!-- End footer -->

</body></html>