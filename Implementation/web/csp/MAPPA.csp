<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-br">
<script language="Cache" runat="server">
    do ^WWWVAR
	set YUSER = $get(%session.Data("YUSER"))
    set YBED = $get(%session.Data("YBED"))
    set YM = $get(%session.Data("YM"))
    set YLOCATION = $get(%session.Data("YLOCATION"))
    set OPENWINDOW = $get(%session.Data("OPEN_NEW_WINDOW"))
    set ABREDIRETO = $get(%session.Data("YABREDIRETO"))
    if OPENWINDOW=1{
	    kill %session.Data("OPEN_NEW_WINDOW")
	    kill %session.Data("MAPPA_paciente")
    }
    set codPaciente = $get(%session.Data("MAPPA_paciente"))
    ;set codPaciente = 557
    ;
    if YUSER=""{
		set YUSER = $get(%request.Data("YUSER", 1))
	    set YBED = $get(%request.Data("YBED",1))
	    set YM = $get(%request.Data("YM",1))
	    set YLOCATION = $get(%request.Data("YLOCATION",1))
	    set ABREDIRETO = $get(%request.Data("YABREDIRETO",1))
    }

    ;
    ;set codPaciente = 553
    ;
    set bird = $$getBirdID^VARCSPUtils(YBED,YUSER)
    set token = $piece(bird,"~",1)
    set userBird = $piece(bird,"~",2)
	;
    set PortCache = $get(%request.CgiEnvs("SERVER_PORT"))
    set PageURL = $get(%request.CgiEnvs("CACHE_URL"))
    set PageName = %request.PageName
    set app = %request.Application
    set host = %request.CgiEnvs("HTTP_HOST")
    set url = "http://"_host_app
	set param="EP=1&YBED="_YBED_"&YUSER="_YUSER_"&YLOCATION="_YLOCATION
	set paramEncrypt = $piece(##class(COM.fwk.ui.csp.CSPUtil).encrypt(param),"id_key=",2)
    set URLPreparacao = "VAR.CSP.MAPPA.cls"
    set URLPreparacao1 = "VAR.CSP.MAPPA1.cls"
    set URLPreparacaoDash 	= "VAR.CSP.MAPPADashboard.cls"
   
    set URLLogin = "COMLogin.cls"
    set URLLink = "www.cls"
    set nomeLocal = YLOCATION_" - "_$$SQLGetLocationName^VARSQL(YLOCATION)
	
    //Verifica se a sessão
    set status = $$VerifySession^VARCSPUtils(YBED, YUSER, url)
    // bgColor ->  Cor de Fundo do Formulário
    set temaC = $get(^VARPEPPremiumOpc(YBED,"tema"))
    if temaC="" set temaC=1
    set tema=2
    if temaC=1 set tema=3
    ;
    set linhaTempo = $get(^VARPEPPremiumOpc(YBED,"linhaTempo"))
    set opcoes = $get(^VARPEPPremiumOpc(YBED,"opcoes"))
    set layout = $get(^VARPEPPremiumOpc(YBED,"layout"))+1
    set layout=2
    ;set layout=1
    set opcoes=0
    set linhaTempo = 1
    ;
    set fontSize = "14"
    set fontSize = "11" ; Teste de layout
    ;set tema=3
    if tema=1{
	    set estiloDev 		= YGIF_"global/plugins/extreme19.2.4/css/dx.light.css"
	    set corFonteInicial = "#fff"
	    set corFundoInicial = "#fff"
	    set corFonte 		= "#fff"
	    set corFonteTitulos = "#fff"
	    set corFonteLabel 	= "#007Baa"
	    set corBordasMenu 	= "#007Baa"
	    set corOpcoesFonteLabel = "#fff"
	    set corFonteCaixas 	= "#007Baa"
	    set tabColorFonte 	= "#007Baa"
	    set tabColorFonteSel = "#fff"
	    set corRodape 		= "#007B99"
	    set corT1 			= "#007Baa"
	    set corT2 			= "#007Bcc"
	    set corFonteButton 	= "#333"
	    ;
	    set corSubT = "#007Bcc"
	    set corSubTShadow = "#555"
	    set corSubT1 = "#007Bcc"
	    set corHeader="#eee"
	    set corBordaDeta = "#007Bcc"
	    set corFonteHeader="#007Baa"
	    set corMenu = "rgb(240, 240, 240)"
	    set corMenuTratamento = "rgb(210, 210, 210)"
	    set bgColor = "rgb(255, 255, 255)"
	    set bgColorGrid = "rgb(255, 255, 255)"
	    set bgColorOpcoes = "#007Bcc"
	    set corSecundaria = "rgb(250, 250, 250)"
	    
	    set corTextGeral = "rgb(250, 250, 250)"
	    set corTerciaria = "rgb(250, 250, 250)"
	    set corSelectBoxSel = "rgb(200, 200, 200)"
	    set corFundoText = "rgb(255, 255, 255)"
	    set bgImagem = "url("_YGIF_"PEP/premium/estetoscopio_fundo.jpg)"
	    set sombra1 = "#aaa"
	    set sombra2 = "#ccc"
	    set corAlerta = "rgb(230,0,0)"
	    set corAlertaFonte = "#fff"
	    set bordaTile = "#007Baa"
	    set tabColor = "#ddd"
	    set tabColorBorda = "#fff"
	    set corSubGrupo = "#eeeeee"
	    set corSubGrupo2 = "#ffffff"
	    set corPopup2 = "#eee"
	    set corPopupBorda = "#ccc"
	    set corFonteEstadiamento = "red"
	    set corIconsAlert = "red"
	    set corFonteEstadiamentoReal = "red"
	    set corFonteGraficoTrat = "#007Baa"
	    set corAbaSelecionada = "#007Baa"
	    set corScroll = ""
	    set corBotao1 = ""
	    set corBotao2 = ""
	    set corBotao3 = ""
	    set corBordaTexto = ""
	    set corLinha = "#007Baa"
	    set corLinhaFraca = "#007Baa"
	    set corFundoImagens="#007Baa"
	    set corBordaImagens="#007Baa"
	    set corFonteBotao = "#fff"
	    set corHints = "red"
	    set corEstadiamentoFonte = "#007Baa"
	    set corLoadPanel = "rgba(0,0,0,0.1)"
	    set detalheImagemBorda = "2px solid yellow"
	    set botaoSelecionado = "2px solid red"
	    set corHeaderRight = "#007Baa"
	    set caixaMarcada = "green"
	    set caixaDesmarcada = "red"
	    set caixaDesabilitada = "rgb(128,128,128)"
	    set caixaDefault = "rgb(128,128,128)"
	    set corDestaque1 = "#ccc"
	    set corDestaque2 = "#ddd"
	    set corDestaqueLegenda = "#007Baa"
    }
    if tema=2 {
	    set corBotoesPOP = "#fff"
	    set corFonteInicial = "#64daff"
	    set corFundoInicial = "linear-gradient(180deg,#333,#000)"
	    set corFundoBtnInicial = "linear-gradient(180deg,#1e1e1e,#000000)"
	    set corFundoBtnInicial2 = "linear-gradient(180deg,#5e5e5e,#2e2e2e)"
	    set corFundoBtnInicial3 = "linear-gradient(180deg,#5e5e5e,#2e2e2e)"
	    set corFonteButtonInicial = "#dedede"
	    set corFonteButtonInicial1 = "#fff"
		;
	    set corIconeEstadiado = "#0ef30e"
	    set corIconePreEstadiado = "yellow"
	    set corIconeNaoEstadiado = "yellow"
	    set corIconeEstadiadoAlerta = "#f33f3f"
	    set corIconeEstadiamentoDisabled = "rgb(150, 150, 150)"
	    set colorRangeFinal = "#fff"
	    set corAtendimento = "#a2dada"
	    set corConduta = "#b091e8"
	    set corTratamento = "#56e878"
	    set corFundoBotoes = "#1e1e1e"
	    set estiloDev = YGIF_"global/plugins/extreme19.2.4/css/dx.dark.css"
	    set corFonte = "#64daff"
	    set corFonteTitulos = "white"
	    set corFonteLabel = "#e5e9ff"
	    set corBordasMenu 	= "#505050"
	    set corBordasHeader = "#cfcfcf"
	    set corOpcoesFonteLabel = "#64daff"
	    set corFonteCaixas = "#64daff"
	    set corFonteLabelDadosGerais = "#64daff" 
	    set tabColorFonteSel = "#64daff"
	    set tabColorFonte = "#64daff"
	    set corRodape = "#000"
	    set corSelectBox="#000"
	    set corT1 = "#000"
	    set corT2 = "#000"
	    set corFonteButton = "#dedede"
	    set corSubT = "#000"
	    set corSubTShadow = "#000"
	    set corSubT1 = "#111"
	    set corHeader="#000"
	    set corBordaDeta = "#000"
	    set corFonteHeader="#fff"
	    set bgColor = "rgb(40, 40, 40)"
	    set bgColorGrid = "rgb(70, 70, 70)"
	    set bgColorOpcoes = "rgb(40, 40, 40)"
	    set corTextGeral = "rgb(60, 60, 60)"
	    set corSecundaria = "rgb(70, 70, 70)"
	    set corBotaoSelecionado = "rgb(70, 70, 70)"
	    set corTerciaria = "rgb(15, 15, 15)"
	    set corSelectBoxSel = "rgb(15, 15, 15)"
	    set corMenu = "rgb(20, 20, 20)"
	    set corMenuTratamento = "rgb(5, 5, 5)"
	    set corFundoText = "rgb(120, 120, 120)"
	    set bgImagem = ""
	    set sombra1 = "0 3px 6px rgba(0,0,0,.86),0 3px 6px rgba(0,0,0,.93)!important"
	    set sombra2 = "rgb(0, 0, 0)"
	    set sombra3 = "0 2px 4px rgba(0,0,0,.86),0 2px 4px rgba(0,0,0,.93)!important"
	    set corAlerta = "rgb(200,0,0)"
	    set corAlertaFonte = "#fff"
	    set bordaTile = "#000"
	    set tabColor = "#666"
	    set tabColorBorda = "#000"
	    set corSubGrupo = "#111111"
	    set corSubGrupo2 = corSecundaria
	    set corPopup2 = "#333"
	    set corPopupBorda = "#333"
	    set corFonteEstadiamento = "white"
	    ;
	    set corCicloConcluido = "#6ff78f"
	    set corCicloAtual = "white"
	    set corCicloPendente = "gray"
	    set corCicloPendenteText = "white"
		;	    
	    set corFonteEstadiamentoAlerta = "yellow"
	    set corIconsAlert = "#64daff"
	    set corFonteEstadiamentoReal = "white"
	    set corFonteGraficoTrat = "white"
	    set corAbaSelecionada = "white"
	    set corScroll = "rgba(150, 150, 150,1)"
	    set corBotao1 = "rgb(30, 30, 30)"
	    set corBotao2 = "rgb(40, 40, 40)"
	    set corBotao3 = "rgb(50, 50, 50)"
	    set corBordaTexto = "white"
	    set corLinha = "#eee"
	    set corLinhaFraca = "rgb(0,116,132)"
	    set bordaTile = ""
	    set corFundoImagens="rgb(60, 60, 60)"
	    set corFonteImagens=corFonte
	    set corBordaImagens="rgb(40, 40, 40)"
	    set corFonteBotao = "#ffffff"
	    set corHints = "white"
	    set corEstadiamentoFonte = "#fff"
	    set corLoadPanel = "rgba(0,0,0,0.3)"
	    set detalheImagemBorda = "1px solid #fff"
	    set botaoSelecionado = "1px solid #fff"
	    set corHeaderRight = "rgb(30, 30, 30)"
	    set caixaMarcada = "rgb(100,255,100)"
	    set caixaDesmarcada = "rgb(255,100,100)"
	    set caixaDesabilitada = "rgb(128,128,128)"
	    set caixaDefault = "rgb(255,255,255)"
	    set corDestaque1 = "#111"
	    set corDestaque2 = "#222"
	    set corDestaqueLegenda = "#333"
	}
    if tema=3{
	    set corBotoesPOP = "#007Baa"
	    set corFonteInicial = "#007Baa"
	    set corFundoInicial = "linear-gradient(180deg,#fff,#eee)"
	    set corFundoBtnInicial = "linear-gradient(180deg,#007Baa,#02648a)"
	    set corFundoBtnInicial2 = "linear-gradient(180deg,#0abbff,#0995cc)"
	    set corFundoBtnInicial3 = "linear-gradient(180deg,#00B259,#008442)"
	    set corFonteButtonInicial = "#fff"
	    set corFonteButtonInicial1 = "#fff"
	    set corIconeEstadiado = "#089408"
	    set corIconePreEstadiado = "#ffc107"
	    set corIconeNaoEstadiado = "#ffc107"
	    set corIconeEstadiadoAlerta = "#f33f3f"
	    set corIconeEstadiamentoDisabled = "gray"
	    set colorRangeFinal = "#bebebe"
	    set corAtendimento = "#007bff"
	    set corConduta = "#8a66c7"
	    set corTratamento = "#4dcc6b"
	    set corFundoBotoes = "#fefefe"
	    set estiloDev 		= YGIF_"global/plugins/extreme19.2.4/css/dx.light.css"
	    set corFonte 		= "#6c757d"
	    set corFonteTitulos = "#6c757d"
	    set corFonteLabel 	= "#007Baa"
	    set corBordasMenu 	= "#aaa"
	    set corBordasHeader = "#bebebe"
	    set corOpcoesFonteLabel = "#fff"
	    set corFonteCaixas 	= "#007Baa"
	    set tabColorFonte 	= "#007Baa"
	    set tabColorFonteSel = "#fff"
	    set corRodape 		= "#007B99"
	    set corSelectBox="#fff"
	    set corT1 			= "#007Baa"
	    set corT2 			= "#f8f9fa"
	    set corFonteButton 	= "#6c757d"
	    ;
	    set corSubT = "#fff"
	    set corSubTShadow = "#555"
	    set corSubT1 = "#007Bcc"
	    set corHeader="#eee"
	    set corBordaDeta = "#007Bcc"
	    set corFonteHeader="#007Baa"
	    set corMenu = "#f8f9fa"
	    set corMenuTratamento = "#f8f9fa"
	    set bgColor = "#f8f9fa"
	    set bgColorGrid = "#f8f9fa"
	    set bgColorOpcoes = "#007Bcc"
	    set corSecundaria = "#f8f9fa"
	    set corBotaoSelecionado = "#efefef"
	    set corTextGeral = "#f8f9fa"
	    set corTerciaria = "#f8f9fa"
	    set corSelectBoxSel = "rgb(200, 200, 200)"
	    set corFundoText = "#fff"
	    set bgImagem = "url("_YGIF_"PEP/premium/estetoscopio_fundo.jpg)"
	    set sombra1 = "0 2px 3px rgba(0,0,0,.2),0 2px 3px rgba(0,0,0,.3)!important"
	    set sombra2 = "#ccc"
	    set corAlerta = "rgb(230,0,0)"
	    set corAlertaFonte = "#fff"
	    set bordaTile = "#007Baa"
	    set tabColor = "#fff"
	    set tabColorBorda = "#aaa"
	    set corSubGrupo = "#eeeeee"
	    set corSubGrupo2 = "#ffffff"
	    set corPopup2 = "#eee"
	    set corPopupBorda = "#ccc"
	    set corFonteEstadiamento = "#6c757d"
	    set corFonteEstadiamentoAlerta = "#007Baa"
	    set corIconsAlert = "red"
	    set corFonteEstadiamentoReal = "#007Baa"
	    set corFonteGraficoTrat = "#007Baa"
	    set corAbaSelecionada = "#007Baa"
	    set corScroll = ""
	    set corBotao1 = ""
	    set corBotao2 = ""
	    set corBotao3 = ""
	    set corBordaTexto = ""
	    set corLinha = "#007Baa"
	    set corLinhaFraca = "#007Baa"
	    set corFundoImagens="#fff"
	    set corFonteImagens="#007Baa"
	    set corBordaImagens="#007Baa"
	    set corFonteBotao = "#fff"
	    set corHints = "#dc3545"
	    set corEstadiamentoFonte = "#007Baa"
	    set corLoadPanel = "rgba(0,0,0,0.1)"
	    set detalheImagemBorda = "1px solid red"
	    set botaoSelecionado = "2px solid #dc3545"
	    set corHeaderRight = "#007Baa"
	    set caixaMarcada = "green"
	    set caixaDesmarcada = "#dc3545"
	    set caixaDesabilitada = "rgb(128,128,128)"
	    set caixaDefault = "rgb(128,128,128)"
	    set corDestaque1 = "#eee"
	    set corDestaque2 = "#ddd"
	    set corDestaqueLegenda = "#007Baa"
	    ;
	    set corCicloConcluido = "#06b72f"
	    set corCicloAtual = "#007Baa"
	    set corCicloPendente = "gray"
	    set corCicloPendenteText = "gray"
		;	    
    }
	if layout=1{
	    set corAtendimento = ""
	    set corConduta = ""
	    set corTratamento = ""
	}
	
</script>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>MAPPA -  Medical Analytics Platform for Precision Assistance</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href=" #(YGIF)#global/plugins/bootstrap/css/bootstrap.min.css">

    <!-- Custom Elements -->
    <link href=" #(YGIF)#global/css/components-rounded.css" rel="stylesheet" id="style_components" type="text/css" />
    <link href=" #(YGIF)#global/css/plugins.css" rel="stylesheet" type="text/css" />
    <link href=" #(YGIF)#global/css/layout.css" rel="stylesheet" type="text/css" />
    <link href=" #(YGIF)#global/css/themes/light.css" rel="stylesheet" type="text/css" id="style_color" />
    <link href=" #(YGIF)#global/css/custom.min.css" rel="stylesheet" type="text/css" />


    <link type="text/css" rel="stylesheet" href="#(YGIF)#fonts/googlesans/googlesans.css">

    <!-- DevExtreme themes -->
    <link rel="stylesheet" type="text/css" href=" #(YGIF)#global/plugins/extreme19.2.4/css/dx.common.css" />
    <link rel="stylesheet" type="text/css" href="#(estiloDev)#" />

	  <!-- Font Awesome -->
  	<link rel="stylesheet" href="#(YGIF)#global/plugins/AdminLTE-3.0.5/plugins/fontawesome-free/css/all.min.css">

    <csp:include page="MAPPAEstilos.csp">

</head>
    <script type="text/javascript">
    	var MAPPALEAN = 0
    	var token = "#(token)#"
    	var abreDireto = "#(ABREDIRETO)#"
    	var tema = "#(tema)#"
    	var layout = "#(layout)#"
    	var ultimoId = ""
    	var idRetorno = ""
        var status = '#(status)#';
        var URLLogin = '#(URLLogin)#';
        var ygif = '#(YGIF)#'

        if (status == 0) {
            alert('Usuário não está logado ou a sessão expirou.')
            window.location.replace(URLLogin)
        }
        
    </script>
<body style="overflow: hidden">
	<input id='cdPaciente' name='paciente' type='hidden' value='#(codPaciente)#'>
	<div id="toolbar" class="headerPaciente"></div>
	<div id='contextMenuContainer'></div>
	<div id="divFormDadosGerais" style='position:absolute;top:48px;z-index:989;'></div>
	<div id="divFormDadosGeraisIcone" style='position:absolute;top:48px;z-index:988;visible:hidden;' onMouseOver="minimizarPainelDadosGeraisMouse(1);"></div>
	<div id="divFormLinhaTempo" style='position:absolute;top:50px;left:341px;'></div>
	<div id="divFormAtendimentoClinicoAcc" style='position:absolute;left:341px;'></div>
	<div id="divFormAtendimentoClinico" style='position:absolute;left:341px;z-index:990;border: 0px solid red;' onMouseOver="minimizarPainelDiagMouse(1);"></div>
	<div id="divFormAtendimentoClinicoRelatorios" style='position:absolute;left:341px;'></div>
	<div id="divFormAtendimentoClinicoSugestao" style='position:absolute;left:341px;'></div>
	<div id="divFormOpcoesGerais" style='position:absolute;top:-10px;'></div>
	<div id="divFormEscolhaFicha" style='position:absolute;left:341px;'></div>
	<div id="openPesquisa" style='position:relative;z-index:991;'></div>
	<div id="openPesquisaSub" style='position:relative;z-index:992;'></div>
	<div id="openPesquisa2" style='position:relative;z-index:993;'></div>
	<div id="openPesquisa3" style='position:relative;z-index:994;'></div>
	<div id="openHistorico" style='position:relative;z-index:995;'></div>
 	<div id="loadpanel" style='position:relative;z-index:30000;'></div>
	<div id="dvDialog" style='position:relative;z-index:997;'></div>    
	<div id="dvEvolucao" style='position:relative;z-index:5000;'>
		<div id="dvEvolucaoTitulo">
			<div id="dvEvolucaoTitulo1" onClick='exibirEvolucao(1);'>Evolução</div>
			<div id="dvEvolucaoTitulo4" onClick='abreHistorico(1);'>
				<i title='Exibir passagens anteriores do paciente' class='fas fa-book-medical'></i>
			</div>
			<div id="dvEvolucaoTitulo2" onClick='exibirEvolucao(2);'>
				<i title='Maximizar' class='far fa-window-maximize'></i>
			</div>
			<div id="dvEvolucaoTitulo3" onClick='exibirEvolucao(3);'>
				<i title='Fixar' class='fas fa-arrows-alt-v'></i>
			</div>
		</div>
		<div id="dvEvolucaoConteudo"></div>
	</div>    
	<div id="dvConfirmaDataExame"></div>    
	<div id="dvExamesMedicos"></div>    
    <div id="ttip" class='tooltips'></div>
    <div id="ttipComboLabSegui"></div>
    <div id="ttipComboLabDiag"></div>
    <div id="ttipComboImg"></div>
	<!--<div id="dvPopoverDiag"><span id="spPopoverDiagExibir"></span></div>-->
	<div id="openDashboard" style='position:relative;z-index:20001;'></div>
	<div id="openDashboardAdd" style='position:relative;z-index:20002;'></div>
	<div id="openResultadosEvolutivos" style='position:relative;z-index:500;'></div>
	<div id="openResultadosEvolutivosGraf" style='position:relative;z-index:500;'></div>
	<div id="openExportacao" style='position:relative;z-index:500;'></div>
	<div id="dvDialogResultado" style='position:relative;z-index:500;'></div>
	<div id="dvAddResultado" style='position:relative;z-index:500;'></div>
	<div id="popup"></div>
	<div id="dvAddOcorrenciaTratamento" style='position:relative;z-index:500;'></div>
	<div id="dvAddIntercorrencia" style='position:relative;z-index:500;'></div>
	<div id="dvAnexos" style='position:relative;z-index:500;'></div>    
    <div id="dvListaAnexos" style='position:relative;z-index:500;'></div>    
    
    <!-- REQUIRED JS SCRIPTS -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src=" #(YGIF)#global/plugins/extreme19.2.4/js/jquery.min.js"></script>

	<script src=" #(YGIF)#global/plugins/bootstrap-3.3.7/js/bootstrap.min.js"></script>


	<!-- Bootstrap 4 -->
	<script src="#(YGIF)#global/plugins/AdminLTE-3.0.5/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!-- AdminLTE App -->
	<script src="#(YGIF)#global/plugins/AdminLTE-3.0.5/dist/js/adminlte.min.js"></script>

	<!-- JSZip library -->
	<script type="text/javascript" src=" #(YGIF)#global/plugins/extreme19.2.4/js/jszip.min.js"></script>

    <!-- A DevExtreme library -->
    <script type="text/javascript" src=" #(YGIF)#global/plugins/extreme19.2.4/js/dx.all.js"></script>
    
    <!-- DevExtreme-Intl module -->
    <script type="text/javascript" src=" #(YGIF)#global/plugins/extreme19.2.4/js/localization/dx.messages.pt.js"></script>
    
    <script src=' #(YGIF)#global/plugins/d3/d3.v3.min.js'></script>

		<script src="#(YGIF)#global/plugins/Highcharts-7.1.0/code/highcharts.js"></script>
		<script src="#(YGIF)#global/plugins/Highcharts-7.1.0/code/highcharts-more.js"></script>
		<script src="#(YGIF)#global/plugins/Highcharts-7.1.0/code/modules/solid-gauge.js"></script>
		<script src="#(YGIF)#global/plugins/Highcharts-7.1.0/code/modules/exporting.js"></script>
		<script src="#(YGIF)#global/plugins/Highcharts-7.1.0/code/modules/export-data.js"></script>
		<!--<script src="#(YGIF)#global/plugins/Highcharts-7.1.0/code/modules/highstock.js"></script>-->

	<csp:include page="MAPPAPrimario.csp">
	<csp:include page="MAPPA1.csp">
	<csp:include page="MAPPADashboard.csp">

    <!--Definições globais e criação de funcionalidades encapsuladas-->
    <script type="text/javascript">
    	//Deixando variáveis disponíveis no cliente
    	var painelAnteriorArray = []
    	var painelAnterior = ""
    	var vetorRadio = {}
    	var horaInicio = ""
    	var confirmaData = -1
    	var confirmaSomas = -1
    	var fichaHist = ""
    	var dataPEPHist = ""
        var limparfl=0
        var tempoPanel = ""
        var estadiamentoPossivel = 0
        var sairMenu = 1
        var linhaTempo = '#(linhaTempo)#'
        var ficha	 = ""
        var fichaSeq = 1
        var exibirTodos = 0
        var exibirInativos = 0
        var meuMenu = ""
        var arrayAtendimentoClinico = []
        var arrayAtendimentoClinicoDestaque = []
        var opcoesSimNao = 0
        var meuIDMenu = ""
        var alterarMult = 1
        var naoSalvar = 0
        var alteraCheck = 0
        var vetorDatas = []
        var CategoriaAnt = ""
        var agoraLinhaTempo =  ""
        var urlPreparacao = '#(URLPreparacao)#';
        var urlPreparacao1 = '#(URLPreparacao1)#';
        var urlPreparacaoDash = '#(URLPreparacaoDash)#';
        var urlLink = '#(URLLink)#';
        var YGIF = '#(YGIF)#';
        var YBED = '#(YBED)#';
        var YUSER = '#(YUSER)#';
        var YLOCATION = '#(YLOCATION)#';
        var nomeLocal = '#(nomeLocal)#';
		var codPaciente = ""
		var codPacienteValor = ""
		var sexoPaciente = ""
		var codCID = ""
		var tamanhoToolBar = 46
		var painelAtual = "";
		var xSubId = "";
		var xFormulario = "";
		var xTabbed = "";
		var xFlVoltar = "";		
		var painelIndexAtual = -1
		var cancelaSelecao = 0
		var bordaYesNo = "border:1px solid yellow"
		var ygif = '#(YGIF)#'
		var dxFormulario = ""
		var corT1 = '#(corT1)#'
		var corFonte = '#(corFonte)#';
		var corFonteLabel = '#(corFonteLabel)#';
		var corAlerta = '#(corAlerta)#'
		var corAlertaFonte = '#(corAlertaFonte)#'
		var corSecundaria = '#(corSecundaria)#'
		var corBotaoSelecionado = '#(corBotaoSelecionado)#'
		var corHeader = '#(corHeader)#'
		var corBordaDeta = '#(corBordaDeta)#'
		var corTerciaria = '#(corTerciaria)#'
		var corLinha = '#(corLinha)#'
		var corFonteCaixas = '#(corFonteCaixas)#'
		var caixaMarcada = "#(caixaMarcada)#"
	    var caixaDesmarcada = "#(caixaDesmarcada)#"
		var caixaDesabilitada = "#(caixaDesabilitada)#"
		var caixaDefault = "#(caixaDefault)#"
		var sombra1 = "#(sombra1)#"
		var corHints = "#(corHints)#"
		var colorRangeFinal = "#(colorRangeFinal)#"
		var dados = ""
		var retornoPainel = ""
		var dataPEP = ""
		var conteudoSearch = "";
		///
		var opcaoMenu = 1;
		var opcaoMenuResumo = 1;
		var opcaoEvolucao = 1;
		var xId = "";
		var xSubId = "";
		var xWstilo = "";
		var xFlVoltar = "";
		///
		var codRegimeAtual = ""
		var cicloRegimeAtual = ""

		///
		// Prepara o formulário

		$.ajaxSetup({
		  headers : {   
		    'id_key' : '#(paramEncrypt)#'
		  }
		});

		funcaoAnexoBula = function (container, options) { 
			if (options.data.anexo!=undefined){
				conteudo = "<div class='custom-item'><i class='fas fa-paperclip' style='cursor:pointer' title='Abrir Anexo' onclick=window.open('"+options.data.anexo+"')></i></div>";
				container.append(
					$("<div style='text-align: center;' />")
						.html(conteudo)
						.appendTo(container)
				);
			}
		}

		var prepareSearchInputs = (function () {
			preparaToolBar()
			preparaDadosGerais()
			preparaOpcoesGerais()
			loadPanel.hide();
        });
		
	    function carregaHorario(){
		    if (codPacienteValor==""||codPacienteValor==null){
			    $("#relogio").html("")
			    return
		    }
			var d = new Date();
			var agora = d.getTime();
			var segundos =  Math.round((agora-horaInicio)/1000)
			var minutos = Math.trunc(segundos/60)
			if (minutos<10){
				minutos = "0"+minutos
			}
			segundos = segundos%60
			if (segundos<10){
				segundos = "0"+segundos
			}
			color = ""
			if (minutos>=15){
				color = "orange"
			}
			if (minutos>=20){
				color = "red"
			}
			var horario = minutos+":"+segundos
		    $("#relogio").html("<font style='font-size:11px' color="+color+">"+(color==""?"":"<b>")+"Tempo:\n<font style='font-size:14px'>"+horario)
		    setTimeout("carregaHorario()",1000)
	    }

		function imprimir(tipo,titulo,opcao){
			if (!codPacienteValor){
				DevExpress.ui.notify("Informe o paciente", "warning", 4000);
				return
			}
			var fRemoverImprimirData = 0
			if (tipo == 2 || tipo == 3) {
				fRemoverImprimirData = pesquisaExamesSub.getEditor("removeDataHoraImpRequisicao").option("value");
			}
			fichatemp = ficha
			var result = DevExpress.ui.dialog.confirm("Confirma a impressão?", "Imprimir "+ titulo);
		    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
		    result.done(function(dialogResult) {
		        if (!dialogResult){
			        return
				}
				
				loadPanel.show();
				$.get(urlPreparacao,{
	                method			:"getImpressoes",
	                tipoImpressao 	: tipo,
	                codPaciente		: codPacienteValor,
	                codCID			: codCID,
			        ficha 			: fichatemp,
			        fichaSeq		: fichaSeq,
	                dataPEP			: dataPEP,
	                layout			: layout,
	                fRemoverImprimirData: fRemoverImprimirData,
	                opcao			: opcao
	            },function(retorno){
		            eval(retorno)
		            loadPanel.hide();
		            //loadPanel.option("message","Carregando...")
					return
		            if (retorno!=""){
						window.location.assign(retorno);
		            }else{
			            DevExpress.ui.notify("Não foi possível realizar a assinatura do documento!", "warning", 4000);
		            }
		            loadPanel.hide();

		            return
		            var b64 = btoa(retorno);
					$.getJSON(urlPreparacao,{
		                method			:"enviaAssinatura",
		                file 			: b64
					},function(ret){
						if (ret.status!=0){
							window.open(ret.result)
						}else{
							DevExpress.ui.notify("Não foi possível realizar a assinatura do documento!", "warning", 4000);
						}
						loadPanel.hide();
					})
	            })				
		    });					    
		}

		
		function preparaToolBar(){
		 	toolBar = $("#toolbar").dxForm({
			 	height		: "115px", //84
				scrollingEnabled:false,
			    onContentReady		: function(e){
		          //e.element.dxScrollable("instance").option("useNative", false);  
		          //e.element.dxScrollable("instance").option("showScrollbar","always");
			    },			        
				screenByWidth: function() {
		            return "lg";
		        },
		        items: [{
					template: function() {
                    	return $("<div id='dadosPaciente' class='toolbar-label' style='width:100%;border:0px solid red;'><b>MAPPA -  Medical Analytics Platform for Precision Assistance</div>");
                	}
                }]
		    }).dxForm("instance")
		}
		
		function recarregaTema(valorTema){
	        $.getJSON(urlPreparacao,{
	        	method	: "setToggle",
	        	painel	: "tema",
	        	exibir	: valorTema,
	        	paciente : $("#cdPaciente").val()
	       	},function(){
				location.reload()
		    })			

			
		}
		function verificaBirdID(){
			$.getJSON(urlPreparacao,{
				method:"verificaBirdID"
			},function(ret){
				if (ret==2){
					return
				}
				if (ret==0){
					autenticacaoBirdID()
				}else{
					sairBirdID()
				}
			})
		}
		function sairBirdID(){
			var result = DevExpress.ui.dialog.confirm("Deseja sair do BirdID?", "Sair do BirdID?");
		    result.done(function(dialogResult) {
		        if (!dialogResult){
			        return
				}
                $.getJSON(urlPreparacao, {method: "revokeBirdID"},function(){DevExpress.ui.notify("Desconectado do BirdID com sucesso!", "success", 4000);})
		    });					    
		}
		
		function preparaDadosGerais(){
			//
			dadosGerais = $("#divFormDadosGerais").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
		        visible: true,
		        width:220,
			    items: [{
			        cssClass: "dadosGerais menuPrincipal2 menuPrincipalDadosGerais closeBorder"+layout,
			        template: "<div id='linhaDadosGerais'></div>"
		        }]
	        }).dxForm("instance")

			dadosGeraisIcone = $("#divFormDadosGeraisIcone").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
		        visible: true,
		        width:50,
			    items: [{
			        cssClass: "dadosGerais menuPrincipal2 menuPrincipalDadosGerais closeBorder"+layout,
			        template: "<div id='linhaDadosGeraisIcone'></div>"
		        }]
	        }).dxForm("instance")
			
			formularioDadosGerais = $("#linhaDadosGerais").dxForm({
				scrollingEnabled:true,
				width: "218px",
			    onContentReady		: function(e){
		          e.element.dxScrollable("instance").option("direction", "vertical");  
		          e.element.dxScrollable("instance").option("useNative", false);  
			    },			        
				screenByWidth: function(width) {
		            return "lg";
		        },
				//activeStateEnabled:true,
				items: [{
					cssClass: "headerLPaciente"+layout+" p-5 mb-2 allBorder"+layout,
					template: "<div style='width: 100%;border: 0px solid red;text-align:left;' id='divDadosGeraisConsultaIcone'>"+
							  	"<i title='Minimizar o Painel' class='fas fa-angle-right' onClick='minimizarPainelDadosGerais(3);' style='cursor:pointer;'></i>"+
							  "</div>"+
							  "<div id='divDadosGeraisConsulta'></div>"
				},{
					cssClass: "headerLPaciente"+layout+" underline",
					colCount: 1,
					itemType	: "group",
					items:[{
						cssClass: "headerSub",
						template: "<div id='lbDiagnostico'>Diagnóstico</div>"
					}]
				},{
					cssClass: "linhaDadosGerais"+layout+" p-5 mb-5 closeBorder"+layout,
					template: "<div id='linhaDadosGeraisDiagnostico'></div>"
				},{
					cssClass: "headerLPaciente"+layout+" underline",
					colCount: 1,
					itemType	: "group",
					items:[{
						cssClass: "headerSub",
						template: "<div id='lbEstadiamento'>Estadiamento</div>"
					}]
				},{
					cssClass: "linhaDadosGerais"+layout+" p-5 mb-2 closeBorder"+layout,
					template: "<div id='linhaDadosGeraisEsta'></div>"
				},
				
				{
					cssClass: "headerLPaciente"+layout+" underline classRiscoTromboseTit",
					colCount: 1,
					itemType	: "group",
					items:[{
						cssClass: "headerSub",
						template: "<div id='lbRiscoTrombose'>Risco de Trombose</div>"
					}]
				},{
					cssClass: "linhaDadosGerais"+layout+" p-5 mb-5 closeBorder"+layout+" classRiscoTromboseCont",
					template: "<div id='linhaDadosGeraisRiscoTrombose' style='border:0px solid red;'></div>"
				},
				
				{
					cssClass: "headerLPaciente"+layout+" underline",
					colCount: 1,
					visible: 0,
					itemType	: "group",
					items:[{
						cssClass: "headerSub",
						template: "<div id=descBotoes>Prontuário, receituário e exames</div>"
					}]
				},{
					visible: 0,
					cssClass: "linhaDadosGerais"+layout+" menuPrincipal2 mb-2 closeBorder"+layout,
					template: "<div id='linhaDadosGeraisExib'></div>"
				},{
					cssClass: "headerLPaciente"+layout+" underline",
					colCount: 1,
					visible: 0,
					itemType	: "group",
					items:[{
						cssClass: "headerSub",
						template: "<div>Relatórios</div>"
					}]
				},{
					visible: 0,
					cssClass: "linhaDadosGerais"+layout+" menuPrincipal2 closeBorder"+layout, //linhaDadosGerais"+layout+" mb-2 closeBorder",
					template: "<div id='linhaDadosGeraisImpr'></div>"
				}]
			}).dxForm("instance")
			//
			formularioDadosGeraisIcone = $("#linhaDadosGeraisIcone").dxForm({
				scrollingEnabled:true,
				width: "48px",
			    onContentReady		: function(e){
		          e.element.dxScrollable("instance").option("direction", "vertical");  
		          e.element.dxScrollable("instance").option("useNative", false);  
			    },			        
				screenByWidth: function(width) {
		            return "lg";
		        },
				//activeStateEnabled:true,
				items: [{
					cssClass: "headerLPaciente"+layout+" underline",
					colCount: 1,
					itemType	: "group",
					items:[{
						cssClass: "headerSub",
						template: "<div style='width: 100%;border: 0px solid red;text-align:left;' title='Expandir o Painel'><i class='fas fa-angle-left' style='cursor:pointer;'></i></div>"
					}]
				},{
					cssClass: "linhaDadosGerais"+layout+" menuPrincipal2 closeBorder"+layout, //linhaDadosGerais"+layout+" mb-2 closeBorder",
					template: "<div id='linhaDadosGeraisImprIcone'></div>"
				}]
			}).dxForm("instance")
			//
			dadosGeraisConsulta = $("#divDadosGeraisConsulta").dxForm({
				width: "200px",
					screenByWidth: function(width) {
			            return "lg";
			        },
			        items: [{
				        cssClass: "dadosGerais",
				        template: "<div class='headerSub2 align-right'><span id='linhaDadosGeraisConsultaCab' class='dx-field-item-label-text'></span></div><div id='linhaDadosGeraisConsulta'></div>"
			        }]
	        }).dxForm("instance")
	        
   			formularioDadosGeraisConsulta = $("#linhaDadosGeraisConsulta").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
		        colCount:3,
				items: [{
					colSpan		: 3,
	                cssClass	: "headerSub2",
                    dataField	: "ficha",
					label		: {
						text	: "Consulta"
					},
	                editorOptions: {
    	                width	: 135,
    	                height:"27px",
        	            readOnly: false,
	            	    buttons: [{
		                    name: "search",
		                    location: "after",
		                    options: {
		                        stylingMode: "text",
		                        icon: "far fa-calendar-alt",
					            hint: "Visualizar Histórico de Consultas",
					            width	: 30,
					            onClick: function() {
						            abreLinhaTempo()
					            }
		                    }
	                	}]
	                }
				},{
					cssClass	: "PEPRETRO",
                    itemType	: "button",
					horizontalAlignment: "center",
					buttonOptions : {
			            icon: "fas fa-history",
			            text: "Retr.",
			            height:"27px",
			            hint: "Consulta Retrospectiva",
			            onClick: function() {
				            consultaRetrospectiva()
			            }
	                }
	             },{
					cssClass	: "PEPRETRO",
                    itemType	: "button",
					horizontalAlignment: "center",
					buttonOptions : {
			            icon: "fas fa-times-circle",
			            text: "Encerrar",
			            hint: "Encerrar consulta",
			            height:27,
			            onClick: function() {
							var result = DevExpress.ui.dialog.confirm("Deseja encerrar a consulta?", "Encerrar a consulta");
						    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
						    result.done(function(dialogResult) {
						        if (!dialogResult){
							        return
								}
				                encerrarConsulta()
						    });					    
			            }
	                }
	             },{
					cssClass	: "PEPRETRO",
                    itemType	: "button",
					horizontalAlignment: "center",
					buttonOptions : {
			            icon: "fas fa-sign-out-alt",
			            text: "Sair",
			            hint: "Sair do MAPPA",
			            height:27,
			            onClick: function() {
			        		var result = DevExpress.ui.dialog.confirm("Deseja sair do MAPPA?", "Sair do MAPPA?");
						    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
						    result.done(function(dialogResult) {
						        if (!dialogResult){
							        return
								}
								if (abreDireto){
									window.top.location.href="#($$getLoginPage^WWWLogin())#"
									return
								}
								window.close()
						    })
			            }
	                }
	             }]
   			}).dxForm("instance")			
			//
			
			$("#dadosPaciente").html(
				"<div id='dadosPacienteTitulo'>"+
					"<div id='dadosPacienteTituloTexto'>&nbsp;</div>"+
					"<div id='dadosPacienteTituloMenu'></div>"+
					"<div id='dadosPacienteTituloPesquisar'>"+
						"<div id='dadosPacienteTituloPesquisarCampo'></div>"+
					"</div>"+
				"</div>" +
				"<div id='dadosPacienteDados' style='padding-left: 5px!important;padding-right: 5px!important;'></div>"
			);
			
			$("#dadosPacienteTituloPesquisarCampo").dxTextBox({
		        height:"26px",
            	placeholder: "Pesquisar...",
            	buttons: [{
                    name: "search",
                    location: "after",
                    options: {
                        stylingMode: "text",
                        icon: "search",
						onClick: function() {
							conteudoSearch = $("#dadosPacienteTituloPesquisarCampo").dxTextBox("instance").option("value");
							if (conteudoSearch == "" || conteudoSearch.lenght < 4) {
								DevExpress.ui.notify("Informe o campo pesquisar com mais de 3 caracteres.", "warning", 4000);
								return
							}
							$("#dadosPacienteTituloPesquisarCampo").dxTextBox("instance").option("value","");
							if (codCID == "C91.1") {
								abrePainel(20281,"","colorAtendimentoMenu");
							}
							if (codCID == "C90.0") {
								abrePainel(48524,"","colorAtendimentoMenu");
							}
                        }
                    }
            	}]
			});
			
			$("#dadosPacienteTituloMenu").dxMenu({
				dataSource: [{
				    name: "Solicitações",
				    items: [
				    	{id: "1.1", name: "Prontuário Primário", icon: "fas fa-notes-medical"},
				    	{id: "1.2", name: "Receituário", icon: "fas fa-pills"},
				    	{id: "1.3", name: "Pedido de Exames", icon: "fas fa-vial"},
					]
				}, {
				    name: "Relatórios",
				    items: [
				    	{id: "2.1", name: "Consulta", icon: "fas fa-notes-medical"},
				    	{id: "2.2", name: "Diagnóstico", icon: "fas fa-laptop-medical"},
				    	{id: "2.3", name: "Tratamento", icon: "fas fa-bong"},
				    	{id: "2.4", name: "Atestado", icon: "fas fa-file-medical"},
				    	{id: "2.5", name: "Analytics", icon: "fas fa-tachometer-alt"},
					  	{id: "2.7", name: "Exportar MAPPA", icon: "far fa-file-excel"},
					]
				}, {
				    id: "3.0", name: "Anexos",
				}],
				hideSubmenuOnMouseLeave: true,
				displayExpr: "name",
				cssClass: "cssMenuPrinc",
				onItemClick: function (data) {
					if (data.itemData.id == "1.1") abrePEPPrimario();
					if (data.itemData.id == "1.2") abrePrescricao("");
					if (data.itemData.id == "1.3") abreExamesMedicos();
					if (data.itemData.id == "2.1") imprimir(8,"Consulta");
					if (data.itemData.id == "2.2") imprimir(0,"Diagnóstico");
					if (data.itemData.id == "2.3") abreDadosTratamento(9,"Tratamento");
					if (data.itemData.id == "2.4") imprimir(6,"Atestado");
					if (data.itemData.id == "2.5") montaDashboard("",1);
					if (data.itemData.id == "2.6") montaResultadosEvolutivos();
					if (data.itemData.id == "2.7") exportarMAPPA();
					if (data.itemData.id == "3.0") abreAnexos();
				}
			});
			
			formularioDadosPaciente = $("#dadosPacienteDados").dxForm({
			    alignItemLabels	: true,
			    alignItemLabelsInAllGroups : true,
				screenByWidth: function() {
		            return "lg";
		        },
		        colCount: 6,
				items: [{
		            dataField	: "codPaciente",
		            visible		: false,
		            editorOptions : {
						onValueChanged: function(e) {
							carregarPaciente(e.value)
						},
		            }
	            },{
                    cssClass	: "headerSub2",
                    dataField	: "paciente",
		            //template	: "<div id='nomePaciente' style='height:17px;width:80px;padding-top:5px;font-size:14px;'></div>",
		            editorType	: "dxTextBox",
		            editorOptions: {
                        width: "270px",
                        height:"27px",
				        inputAttr: {
				            id: "dvDescPaciente",
				            class : "campoPaciente"
				        },
		            	maxLength:1,
	                	buttons: [{
		                    name: "search",
		                    location: "after",
		                    options: {
		                        stylingMode: "text",
		                        icon: "search",
		                        onClick: function() {
			                        abrePesquisaPacientes()
		                        }
		                    }
	                	},{
		                    name: "edit",
		                    location: "after",
		                    options: {
			                    //type: "default",
		                        stylingMode: "text",
		                        icon: "fas fa-edit",
		                        onClick: function() {
			                        editAlturaPeso()
		                        }
		                    }
	                	}]
	                }
	            },{
                    cssClass	: "headerSub2",
                    dataField	: "idade",
                    template	: "<div id='idade' style='height:17px;padding-top:5px;font-size:14px;min-width:65px;'></div>",
                    label		: {
						text	: "Idade"
					},
                },{
                    cssClass	: "headerSub2",
                    dataField: "CID",
					label		: {
						text	: "Diagnóst."
					},
					visible:false,
	                editorOptions: {
	                    width:"80px",
	                    height:"27px",
        	            readOnly: true
            	    }
                }, {
                    cssClass	: "headerSub2",
                    dataField: "inicioTrat",
                    template	: "<div id='inicioTrat' style='height:17px;padding-top:5px;font-size:14px;'></div>",
					label		: {
						text	: "Início do Tratamento"
					},
                }, {
	                cssClass	: "headerSub2",
                    dataField: "ultimoAtend",
					template	: "<div id='ultimoAtend' style='height:17px;padding-top:5px;font-size:14px;'></div>",
					label		: {
						text	: "Último Atendimento"
					},
				}, {
	                cssClass	: "headerSub2",
					template	: "<div id='relogio' style='height:17px;padding-top:5px;font-size:14px;min-width:100px'></div>",
				}, {
	                cssClass	: "headerSub2 align-r pr-2",
					template	: "<div id='dvOpcoes' style='cursor:pointer;font-size:20px;min-width:10px;position:relative;top:5px;'><i class='fas fa-user' onclick='abrePainelUsuario()'></i></div>",
					//template	: "<div style='font-size:10px;min-width:100px;'>Tema Claro&nbsp;<input id='tema' name='tema' type='checkbox' onclick='recarregaTema()' #($select(+temaC=1:"checked",1:""))#></input></div>",
				},{
					colSpan:6,
                    //template	: "<div class='dvResumo' style='height:33px;overflow:hidden;text-overflow:ellipsis;white-space: nowrap;width:500px;'><div class='headerSub2'>Resumo clínico: <span class='bodyResumo'></span></div></div>"
                    template	: "<div class='bodyResumo'></div>"
                }]
			}).dxForm("instance")
			//
			formularioDadosGeraisExib = $("#linhaDadosGeraisExib").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
			    scrollingEnabled	: false,
				items: [{
					template	: "<div id='boxAtendimentoMenuBotoes'></div>"
				}]
			}).dxForm("instance")

			formularioDadosGeraisImpr = $("#linhaDadosGeraisImpr").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
			    scrollingEnabled	: false,
				items: [{
					template	: "<div id='boxAtendimentoMenuRelatorios'></div>"
		         }]
			}).dxForm("instance")

			formularioDadosGeraisImprIcone = $("#linhaDadosGeraisImprIcone").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
			    scrollingEnabled	: false,
				items: [{
					template	: "<div id='boxAtendimentoMenuRelatoriosIcone'></div>"
		         }]
			}).dxForm("instance")

			formularioDadosGeraisDiagnostico = $("#linhaDadosGeraisDiagnostico").dxForm({
				width: "190px",
				screenByWidth: function(width) {
		            return "lg";
		        },
				items: [{
	                template: "<div id='divDiagnostico'></div>"
	            }]
			}).dxForm("instance")

			formularioDadosGeraisEsta = $("#linhaDadosGeraisEsta").dxForm({
				width: "190px",
				screenByWidth: function(width) {
		            return "lg";
		        },
				items: [{
	                template: "<div id='divEstadiamento'></div>"
	            }]
			}).dxForm("instance")

			formularioDadosGeraisRiscoTrombose = $("#linhaDadosGeraisRiscoTrombose").dxForm({
				width: "190px",
				screenByWidth: function(width) {
		            return "lg";
		        },
				items: [{
	                template: "<div id='divRiscoTrombose' style='border:0px solid blue;'></div>"
	            }]
			}).dxForm("instance")


			preparaEvolucao();
			
		}
		
		function exibirEvolucao(pOpcao) {
			if (pOpcao == 1 && (opcaoEvolucao == 2 || opcaoEvolucao == 3)) {
				return;
			}
			;
			if (opcaoEvolucao == 1) {
				$.getJSON(urlPreparacao,{method	:"getEvolucao", codPaciente: codPacienteValor,
		        dataPEP: dataPEP, codCID: codCID, ficha: ficha},function(objRetorno){
					objEvolucaoConteudo = $("#dvEvolucaoConteudo").dxForm("instance");
					objEvolucaoConteudo.getEditor("evolucaoMedUso").option({"value": (objRetorno.evolucaoMedUso != "" ? objRetorno.evolucaoMedUso.split(";") : ""), readOnly: objRetorno.nedita});
					objEvolucaoConteudo.getEditor("evolucaoEvolucao").option({"value": objRetorno.evolucaoEvolucao, readOnly: objRetorno.nedita});
					objEvolucaoConteudo.getEditor("evolucaoExameFisico").option({"value": objRetorno.evolucaoExameFisico, readOnly: objRetorno.nedita});
					objEvolucaoConteudo.getEditor("evolucaoImpressaoDiagnostica").option({"value": objRetorno.evolucaoImpressaoDiagnostica, readOnly: objRetorno.nedita});
					objEvolucaoConteudo.getEditor("evolucaoConduta").option({"value": objRetorno.evolucaoConduta, readOnly: objRetorno.nedita});
					exibirEvolucaoTela(pOpcao)
			    })
				return;
			}
			exibirEvolucaoTela(pOpcao)
		}
			
		function exibirEvolucaoTela(pOpcao) {
			;
			if (opcaoEvolucao == 1) {
				if (pOpcao == 3) {
				    setTimeout(function () {
				    	$("#dvEvolucaoConteudo").dxForm("instance").option("height", heightJanela-130)
				    	$("#dvEvolucaoTitulo2").html("<i title='Minimizar' class='far fa-window-minimize'></i>");
				    	$("#dvEvolucaoTitulo3").html("<i title='Maximizar' class='fas fa-expand-alt'></i>");
				    	$("#dvEvolucao").css({top:0,left:widthJanela-220,visibility:"visible",width:220,height:heightJanela-83});
				    	$("#dvEvolucao").css({zIndex:20006});
						if (opcaoMenuResumo == 2) {
							setTimeout(function () {minimizarPainelDadosGerais(3);},5);
						}
				    },20);
				    opcaoEvolucao = 3;
				}else{
				    setTimeout(function () {
				    	$("#dvEvolucaoConteudo").dxForm("instance").option("height", "460px")
				    	$("#dvEvolucaoTitulo2").html("<i title='Minimizar' class='far fa-window-minimize'></i>");
				    	$("#dvEvolucaoTitulo3").html("<i title='Fixar' class='fas fa-arrows-alt-v'></i>");
				    	$("#dvEvolucao").css({top:heightJanela-585,left:widthJanela-500,visibility:"visible",width:500,height:500});
						$("#dvEvolucao").css({zIndex:20006});
				    },20);
				    opcaoEvolucao = 2;
				}
			}else if (opcaoEvolucao == 3) {
				if (pOpcao == 3) {
				    setTimeout(function () {
				    	$("#dvEvolucaoConteudo").dxForm("instance").option("height", "460px")
				    	$("#dvEvolucaoTitulo2").html("<i title='Minimizar' class='far fa-window-minimize'></i>");
				    	$("#dvEvolucaoTitulo3").html("<i title='Fixar' class='fas fa-arrows-alt-v'></i>");
				    	$("#dvEvolucao").css({top:heightJanela-585,left:widthJanela-500,visibility:"visible",width:500,height:500});
						$("#dvEvolucao").css({zIndex:20006});
				    },20);
				    opcaoEvolucao = 2;
				}else{
				    setTimeout(function () {
				    	$("#dvEvolucaoTitulo2").html("<i title='Maximizar' class='far fa-window-maximize'></i>");
				    	$("#dvEvolucaoTitulo3").html("<i title='Fixar' class='fas fa-arrows-alt-v'></i>");
				    	$("#dvEvolucao").css({top:heightJanela-141,left:widthJanela-220,visibility:"visible",width:220,height:26});
						$("#dvEvolucao").css({zIndex:1000});
				    },20);
				    opcaoEvolucao = 1;
				}
			}else{
				if (pOpcao == 3) {
				    setTimeout(function () {
				    	$("#dvEvolucaoConteudo").dxForm("instance").option("height", heightJanela-130)
				    	$("#dvEvolucaoTitulo2").html("<i title='Minimizar' class='far fa-window-minimize'></i>");
				    	$("#dvEvolucaoTitulo3").html("<i title='Maximizar' class='fas fa-expand-alt'></i>");
				    	$("#dvEvolucao").css({top:0,left:widthJanela-220,visibility:"visible",width:220,height:heightJanela-83});
						$("#dvEvolucao").css({zIndex:20006});
						if (opcaoMenuResumo == 2) {
							setTimeout(function () {minimizarPainelDadosGerais(3);},5);
						}
				    },20);
				    opcaoEvolucao = 3;
				}else{
				    setTimeout(function () {
				    	$("#dvEvolucaoTitulo2").html("<i title='Maximizar' class='far fa-window-maximize'></i>");
				    	$("#dvEvolucaoTitulo3").html("<i title='Fixar' class='fas fa-arrows-alt-v'></i>");
				    	$("#dvEvolucao").css({top:heightJanela-141,left:widthJanela-220,visibility:"visible",width:220,height:26});
						$("#dvEvolucao").css({zIndex:1000});
				    },20);
				    opcaoEvolucao = 1;
				}
			}
		}
		
		function preparaEvolucao() {
			$("#dvEvolucaoConteudo").dxForm({
				screenByWidth: function(width) { return "lg"; },
		        width				: "100%",
		        height				: "460px",
			    scrollingEnabled	: true,
				labelLocation: "top",
				showColonAfterLabel: true,
				onFieldDataChanged	: function(obj){
					if (naoSalvar){ return }
					campo = obj.dataField
					if (codCID == "C90.0") {
						if (campo=="evolucaoMedUso") campo=48250;
						if (campo=="evolucaoEvolucao") campo=47433;
						if (campo=="evolucaoExameFisico") campo=48249;
						if (campo=="evolucaoImpressaoDiagnostica") campo=48254;
						if (campo=="evolucaoConduta") campo=47443;
					}else{
						if (campo=="evolucaoMedUso") campo=2005;
						if (campo=="evolucaoEvolucao") campo=1963;
						if (campo=="evolucaoExameFisico") campo=1908;
						if (campo=="evolucaoImpressaoDiagnostica") campo=2006;
						if (campo=="evolucaoConduta") campo=1964;
					}
					if (codPacienteValor != "") {
						$.getJSON(urlPreparacao,{method: "salvaPainel",codPaciente: codPacienteValor,
						dataField: campo, valor: JSON.stringify(obj.value), codCID: codCID, ficha: ficha, 
						fichaSeq: fichaSeq, dataPEP: dataPEP});
					}
		   		},				
		        items: [{
					label: { text: "Medicamentos em Uso" },
					cssClass: "labelDetalhes",
			        dataField: "evolucaoMedUso",
					editorType: "dxTagBox",
					editorOptions: {
						dataSource: new DevExpress.data.DataSource({
				            store: new DevExpress.data.CustomStore({
				            byKey: function(args) {
				                return $.getJSON(urlPreparacao,{
					            	method	:"listaMedicamentos",
				                    codigo	: args
				                });
				            },
				            load: function(args) {
				                return $.getJSON(urlPreparacao,{
					            	method	:"listaMedicamentos",
									searchValue:args.searchValue,
									filter:JSON.stringify(args.filter),
				                	skip:args.skip,
				                	take:args.take,
									
				                },function(rs){});
				                }
				            })
				        }),
					    valueExpr: "CodMedicamento",
						displayExpr: "DescMedicamento",
						searchEnabled: 1
					}
		        },{
					label: {
						text: "Evolução"
					},
					cssClass: "labelDetalhes",
			        dataField: "evolucaoEvolucao",
					editorType: "dxTextArea",
					editorOptions: {
						height: 120,
					}
		        },{
					label: {
						text: "Exame Físico"
					},
					cssClass: "labelDetalhes",
			        dataField: "evolucaoExameFisico",
					editorType: "dxTextArea",
					editorOptions: {
						height: 120,
					}
		        },{
					label: {
						text: "Impressão Diagnostica"
					},
					cssClass: "labelDetalhes",
			        dataField: "evolucaoImpressaoDiagnostica",
					editorType: "dxTextArea",
					editorOptions: {
						height: 120,
					}
		        },{
					label: {
						text: "Conduta"
					},
					cssClass: "labelDetalhes",
			        dataField: "evolucaoConduta",
					editorType: "dxTextArea",
					editorOptions: {
						height: 120,
					}
		        }]			                			
			});
		}
		
		function consultaRetrospectiva(){
	        if (codPacienteValor==""){
		        DevExpress.ui.notify("Informe o paciente", "warning", 4000);
		        return
	        }
		    if ($("#openPesquisaSub").html()!=""){
		    	pesquisaExamesSub.dispose()
		    	openPesquisaSub.dispose()
		    }
		    $("#openPesquisaSub").removeClass("Layout"+layout)
   			$("#openPesquisaSub").css({"position":"relative","zIndex":992}).html("<div id='pesquisaExamesSub'></div>")
			//
            $.getJSON(urlPreparacao,{
                method	:"getConsultaRetrospectiva",
                paciente: codPacienteValor,
	        	ficha	: ficha
            },function(retorno){
		    	pesquisaExamesSub = $("#pesquisaExamesSub").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
			    	onContentReady: function(){
	    				openPesquisaSub = $("#openPesquisaSub").dxPopup({
					        width: '420px',
					        height: '200px',
					        showTitle: true,
					        visible: true,
					        dragEnabled: false,
					        closeOnOutsideClick: false,
							toolbarItems: [{
								location:"before",
								toolbar :"top",
								html: "Confirmar Consulta Retrospectiva?"
							},{
								widget: "dxButton",
								location:"before",
								toolbar:"bottom",
								options: { 
									width	: "130px",
									type	: "default",
									icon	: "close",
			            			text	: "Fechar", 
			            			onClick : function(){
			                			openPesquisaSub.hide()
			                		}
								}
							},{
								widget: "dxButton",
								location:"after",
								toolbar:"bottom",
								options: { 
									width	: "130px",
									type	: "default",
									icon	: "check",
			            			text	: "Confirmar", 
			            			onClick : function(){
				            			confirmaConsultaRetrospectiva()
			                		}
								}
							}],			        
	    				}).dxPopup("instance")
				    },
			    	formData	: retorno.formData,
			    	items :[{
				    	dataField: "data",
			            label:{
				            text: "Data da consulta retrospectiva",
				          	alignment: "right"  
			            },
				    	editorType  : "dxDateBox",
				    	editorOptions: {
							type : "date",
							showClearButton : false,
							useMaskBehavior : true,
							openOnFieldClick : false,
							showDropDownButton : true,
							showClearButton : true,
							max : retorno.max,
				    	}
				    }]
		    	}).dxForm("instance")
            })
            
		}

		function abreLinhaTempo(){
	        if (codPacienteValor==""){
		        DevExpress.ui.notify("Informe o paciente", "warning", 4000);
		        return
	        }
		    if ($("#openPesquisaSub").html()!=""){
		    	pesquisaExamesSub.dispose()
		    	openPesquisaSub.dispose()
		    }
		    $("#openPesquisaSub").removeClass("Layout"+layout)
   			$("#openPesquisaSub").css({"position":"relative","zIndex":992}).html("<div id='pesquisaExamesSub'></div>")
			//
	    	pesquisaExamesSub = $("#pesquisaExamesSub").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
		    	onContentReady: function(){
    				openPesquisaSub = $("#openPesquisaSub").dxPopup({
				        width: '810px',
				        height: '500px',
				        showTitle: true,
				        visible: true,
				        dragEnabled: false,
				        closeOnOutsideClick: false,
				        onHiding: function(){
					        return
					        if (fichaHist!=""&&fichaHist!=formularioDadosGeraisConsulta.option("formData").ficha){
	                    		ficha	= fichaHist
	                    		dataPEP = dataPEPHist
	                    		fichaHist=""
	                    		loadPanel.show()
	                    		$.ajaxSetup({async: false});
			       	            setTimeout(function () { 
							        formularioDadosGeraisExib.updateData("ficha",ficha)
					                atualizaTempo()
					                $.ajaxSetup({async: true});
			        		    }, 5);
					        }
					    },
						toolbarItems: [{
							location:"before",
							toolbar :"top",
							html: "Linha do Tempo"
						},{
							widget: "dxButton",
							location:"before",
							toolbar:"bottom",
							options: { 
								width	: "130px",
								type	: "default",
								icon	: "close",
		            			text	: "Fechar", 
		            			onClick : function(){
		                			openPesquisaSub.hide()
		                		}
							}
						},{
							widget: "dxButton",
							location:"after",
							toolbar:"bottom",
							options: { 
								disabled:true,
								width	: "180px",
								type	: "default",
								icon	: "fas fa-edit",
		            			text	: "Retificar Consulta", 
		            			onClick : function(){
		                			editarPassagem()
		                		}
							}
						},{
							widget: "dxButton",
							location:"after",
							toolbar:"bottom",
							options: { 
								disabled:true,
								width	: "180px",
								type	: "default",
								icon	: "fas fa-toggle-on",
		            			text	: "Inativar Consulta", 
		            			onClick : function(){
		                			ativaDesativaPassagem()
		                		}
							}
						}],			        
    				}).dxPopup("instance")
			    },
		    	items 		: [{
			    	template: "<div id='linhaTempoF'></div>"
			    }]
	    	}).dxForm("instance")
	    	$("#linhaTempoF").dxDataGrid({
		        height		: "360px",
				dataSource: new DevExpress.data.DataSource({
					store: new DevExpress.data.CustomStore({
			            load: function(args) {
		                    return $.getJSON(urlPreparacao,{
		    	            	method		:"getHistoricoV2",
            					paciente	: codPacienteValor,
            					codCID		: codCID,
            					exibirInativos	: exibirInativos
			                });
		                }
		            })
		        }),	        
    			columns:[{
    				dataField : "Consulta",
    				caption   : "Consulta",
    				width	  : "110px",
    				sortIndex : 1,
    				sortOrder : "desc"
    			},{
    				dataField : "Atendimento",
    				caption   : "Atendimento",
    				dataType  : "date",
    				width	  : "170px",
    				sortIndex : 0,
    				sortOrder : "desc"
    				
    			},{
    				dataField : "Situacao",
    				caption   : "Situação"
    			},{
	    			dataField	: "Acao",
	    			caption		: "Ação",
	    			alignment	: "center",
	    			width	  	: "80px",
					cellTemplate: function(container, options) {
						container.append("<i class='text-success fa fa-search' title='Abrir Consulta' style='cursor:pointer' />")
					
            		}
            	}],
				sorting:{mode:'multiple'},
        		allowColumnResizing	: true,
				cellHintEnabled		: true,
				filterRow: { visible: false },
				hoverStateEnabled: true,
				headerFilter: {
					visible:false
				},		
				filterRow:{
					visible:false
				},
				groupPanel: {
					visible: false
				},
				paging: { enabled: false },
				showBorders: true,
				showRowLines: true,
				columnChooser: {
					enabled: false
				},
				scrolling:{
					showScrollbar: 'always',
					useNative : false
				},
				rowAlternationEnabled: true,
				wordWrapEnabled:true,
	    		selection: { mode: "single" },
	    		onCellDblClick : function(obj){
					fichaHist = obj.key.Consulta
					dataPEPHist = obj.key.valorOriginal
					abreConsulta()
		    	},
	    		onCellClick: function(obj){
		    		if (obj.columnIndex==3){
						fichaHist = obj.key.Consulta
						dataPEPHist = obj.key.valorOriginal
						abreConsulta()
		    		}
		    	},
				onSelectionChanged: function(selectedItems) {
					dataPEPHist = selectedItems.selectedRowKeys[0].valorOriginal
					fichaHist = selectedItems.selectedRowKeys[0].Consulta
					$("#openPesquisaSub").dxPopup("instance").option("toolbarItems[4].options.disabled",false)
			        if (selectedItems.selectedRowKeys[0].Inativa==1){
				        $("#openPesquisaSub").dxPopup("instance").option("toolbarItems[2].options.disabled",true)
				        $("#openPesquisaSub").dxPopup("instance").option("toolbarItems[4].options.disabled",true)
			        }else{
				       	$("#openPesquisaSub").dxPopup("instance").option("toolbarItems[2].options.disabled",false)
				       	$("#openPesquisaSub").dxPopup("instance").option("toolbarItems[4].options.disabled",false)
			        }
				},
				onToolbarPreparing: function(e) {
					e.toolbarOptions.items.unshift({
						location: "after",
						widget: "dxCheckBox",
						options: {
							text: "Exibir Consultas Inativas",
							hint: "Exibir Consultas Inativas",
							onValueChanged: function(e) {
								exibirInativos = e.value==true?1:0
								$("#linhaTempoF").dxDataGrid("instance").getDataSource().reload()
							}
						}
					})
				}				
					

			    })
            
		}


		function abreConsulta(){
			if (fichaHist!=""){
		    	ficha	= fichaHist
	    		dataPEP = dataPEPHist
	    		fichaHist=""
	    		loadPanel.show()
	    		$.ajaxSetup({async: false});
	            setTimeout(function () { 
			        formularioDadosGeraisConsulta.updateData("ficha",ficha)
			        formularioDadosGeraisExib.updateData("ficha",ficha)
	                atualizaTempo()
	                resizeMe()
	                $.ajaxSetup({async: true});
			    }, 5);
			}
	        openPesquisaSub.hide()

		}
		
		function editarPassagem(){
			if (fichaHist==""){
				fichaHist = ficha
			}
			var result = DevExpress.ui.dialog.confirm("Deseja <font color=orange>RETIFICAR</font> a consulta "+fichaHist+"?</b>","Confirma Edição de Consulta?");
		    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
		    result.done(function(dialogResult) {
		        if (!dialogResult){
			        return
				}
		        $.getJSON(urlPreparacao,{
		            method		 : "retificaConsulta",
		            paciente	 : codPacienteValor,
		            codCID		 : codCID,
	                ficha		 : fichaHist
		        },function(retorno){
		        	DevExpress.ui.notify(retorno.mensagem, retorno.tipo, 4000);
			        if (retorno.status==0){
			        	return
			        }
			        fichaHist = retorno.ficha
			        abreConsulta()
		        })					
		    })
		}

		function carregaDetalheRegime(codRegime){
		    if ($("#openHistorico").html()!=""){
		    	formHistorico.dispose()
		    	openHistorico.dispose()
		    }
		    $("#openHistorico").css({"position":"relative","z-index":"20010"}).html("<div id='headerHistorico' class='header1' style='height:30px'></div><div id='formHistorico'></div><br><br><div class='header1'>Referências:</div><div id='formReferencias'></div>")
			openHistorico = $("#openHistorico").dxPopup({
		        width: '95%',
		        height: '90%',
		        showTitle: true,
		        title: "Detalhes do Regime",
		        visible: true,
		        dragEnabled: false,
		        closeOnOutsideClick: false,
				toolbarItems: [{
					location:"before",
					toolbar :"top",
				},{
					widget: "dxButton",
					location:"before",
					toolbar:"bottom",
					options: { 
						width	: "130px",
						type	: "default",
						icon	: "close",
            			text	: "Fechar", 
            			onClick : function(){
                			openHistorico.hide()
                		}
					}
				}],			        
			}).dxPopup("instance")			
			listaDetalheRegime(codRegime)
		}

		function abrePainelUsuario(){
		    if ($("#openPesquisa").html()!=""){
		    	pesquisaExames.dispose()
		    	openPesquisa.dispose()
		    }
		    $("#openPesquisa").removeClass("Layout"+layout)
   			$("#openPesquisa").removeClass("colorAtendimentoMenu")
   			$("#openPesquisa").removeClass("colorCondutaMenu")
   			$("#openPesquisa").removeClass("colorTratamentoMenu")
			$("#openPesquisa").css({"position":"relative","zIndex":995}).html("<div id='pesquisaExames'></div>")
			openPesquisa = $("#openPesquisa").dxPopup({
		        width: '500px',
		        height: '300px',
		        showTitle: true,
		        title: "Painel do Usuário",
		        visible: true,
		        dragEnabled: true,
		        closeOnOutsideClick: false,
				toolbarItems: [
				{
					location:"before",
					toolbar :"top",
				},{
					widget: "dxButton",
					location:"before",
					toolbar:"bottom",
					options: { 
						width	: "140px",
						type	: "default",
						icon	: "close",
            			text	: "Fechar", 
            			onClick : function(){
                			openPesquisa.hide()
                		}
					}
				},{
					widget: "dxButton",
					location:"center",
					toolbar:"bottom",
					options: { 
						width	: "140px",
						type	: "default",
						icon	: "fas fa-file-video",
            			text	: "Tutorial", 
            			onClick : function(){
                			abreTutorial()
                		}
					}
				},{
					widget: "dxButton",
					location:"after",
					toolbar:"bottom",
					options: { 
						width	: "140px",
						type	: "default",
						icon	: "fas fa-key",
            			text	: "Alterar Senha", 
            			onClick : function(){
                			alterarSenha()
                		}
					}
				}]		        
			}).dxPopup("instance")
			$.getJSON(urlPreparacao,{
				method: "recNomeMedico"
			},function(retorno){
				pesquisaExames = $("#pesquisaExames").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
			        width:"100%",
			        items: [{
				       template	: "<div style='font-size:14px;color:"+corFonte+"'>Olá, "+retorno.nomeMedico+"</div>",
			        },{
				       template	:" <div style='font-size:14px;color:"+corFonte+"'>Deseja mudar o tema do MAPPA? <input type='radio' onclick=recarregaTema(1) #($select(+temaC=1:"checked",1:""))#>&nbsp;&nbsp;Tema Claro</input>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='radio' onclick=recarregaTema(2) #($select(+temaC=2:"checked",1:""))#>&nbsp;&nbsp;Tema Escuro</input></div>"
			        },{
				      template	: "<div style='font-size:14px;color:"+corFonte+"'><br>Precisa de ajuda?<br><br> - Manual do sistema MAPPA: <a href='#' onclick=window.open('"+ygif+"MAPPA/Manual_MAPPA_.pdf','manual'); style='color:"+corFonte+"'><b><i>Manual</i></b></a><br> - E-mail de suporte: <a href='mailto:suporte@logplanning.com.br' style='color:"+corFonte+"'><b><i>suporte@logplanning.com.br</i></b></a></div>",
			        }]
				}).dxForm("instance")
				loadPanel.hide();
			})
			
		}

		function alterarSenha(){
		    if ($("#openPesquisaSub").html()!=""){
		    	pesquisaExamesSub.dispose()
		    	openPesquisaSub.dispose()
		    }
			$("#openPesquisaSub").css({"position":"relative","zIndex":992}).html("<div id='pesquisaExamesSub'></div>")
			openPesquisaSub = $("#openPesquisaSub").dxPopup({
		        width: '450px',
		        height: '300px',
		        showTitle: true,
		        title: "Alterar Senha de Acesso",
		        visible: true,
		        dragEnabled: true,
		        closeOnOutsideClick: false,
				toolbarItems: [
				{
					location:"before",
					toolbar :"top",
				},{
					widget: "dxButton",
					location:"before",
					toolbar:"bottom",
					options: { 
						width	: "130px",
						type	: "default",
						icon	: "close",
            			text	: "Fechar", 
            			onClick : function(){
                			openPesquisaSub.hide()
                		}
					}
				},{
					widget: "dxButton",
					location:"after",
					toolbar:"bottom",
					options: { 
						width	: "160px",
						type	: "default",
						icon	: "check",
            			text	: "Confirmar Senha", 
            			onClick : function(){
	            			if (!pesquisaExamesSub.validate().isValid){
						        DevExpress.ui.notify("Há campos pendentes", "warning", 4000);
						        return
	            			}
	            			if (pesquisaExamesSub.option("formData").NovaSenha!=pesquisaExamesSub.option("formData").ConfirmarNovaAtual){
						        DevExpress.ui.notify("O campo 'Confirmar nova senha' é diferente do campo 'Nova Senha'", "warning", 4000);
						        return
	            			}
							$.getJSON(urlPreparacao,{
								method		:"salvaSenha",
								dados		: JSON.stringify(pesquisaExamesSub.option("formData"))
							},function(retorno){
								if (retorno.status==0){
									DevExpress.ui.notify(retorno.mensagem, "warning", 4000);
									return
								}
								DevExpress.ui.notify("Senha alterada com sucesso!", "success", 4000);
								openPesquisaSub.hide()
							})
                		}
					}
				}]		        
			}).dxPopup("instance")
			pesquisaExamesSub = $("#pesquisaExamesSub").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
		        width:"100%",
		        items: [{
			        dataField	: "SenhaAtual",
   				 	validationRules: [{
				        type: "required",
				    }],		         
			        editorOptions: {
				         mode: 'password',
			        }
		        },{
			        dataField	: "NovaSenha",
   				 	validationRules: [{
				        type: "required",
				    }],		         
			        editorOptions: {
				         mode: 'password',
			        }
		        },{
			        dataField	: "ConfirmarNovaAtual",
   				 	validationRules: [{
				        type: "required",
				    }],		         
			        editorOptions: {
				         mode: 'password',
			        }
		        },]
			}).dxForm("instance")
			loadPanel.hide();
			
		}

		function abreTutorial(){
		    if ($("#openPesquisaSub").html()!=""){
		    	pesquisaExamesSub.dispose()
		    	openPesquisaSub.dispose()
		    }
			$("#openPesquisaSub").css({"position":"relative","zIndex":992}).html("<div id='pesquisaExamesSub'></div>")
			openPesquisaSub = $("#openPesquisaSub").dxPopup({
		        width: '90%',
		        height: '600px',
		        showTitle: true,
		        title: "Tutorial",
		        visible: true,
		        dragEnabled: true,
		        closeOnOutsideClick: false,
		        onHiding: function(a){
			        $("#divVideo").remove()
		        },
				toolbarItems: [
				{
					location:"before",
					toolbar :"top",
				},{
					widget: "dxButton",
					location:"before",
					toolbar:"bottom",
					options: { 
						width	: "130px",
						type	: "default",
						icon	: "close",
            			text	: "Fechar", 
            			onClick : function(){
                			openPesquisaSub.hide()
                		}
					}
				}/*,{
					widget: "dxButton",
					location:"after",
					toolbar:"bottom",
					options: { 
						elementAttr: {
							class:'botoesVideos'
						},
						width	: "250px",
						type	: "default",
						icon	: "fas fa-file-video",
            			text	: "1. Inclusão de Paciente", 
            			onClick : function(){
	            			$("#divVideo").html("<video width='100%' height='450px' controls autobuffer autoplay><source id='srcVideo' src='"+ygif+"MAPPA/Parte 1 - Mappa Inclusao de Paciente_v2.mp4' type='video/mp4'>Your browser does not support the video tag.</video>")
                		}
					}
				}*/,{
					widget: "dxButton",
					location:"after",
					toolbar:"bottom",
					options: { 
						elementAttr: {
							class:'botoesVideos'
						},
						width	: "250px",
						type	: "default",
						icon	: "fas fa-file-video",
            			text	: "1. Tela Central", 
            			onClick : function(){
	            			$("#divVideo").html("<video width='100%' height='450px' controls autobuffer autoplay><source id='srcVideo' src='"+ygif+"MAPPA/Parte 2 - Mappa Tela central_v1.mp4' type='video/mp4'>Your browser does not support the video tag.</video>")
                		}
					}
				},{
					widget: "dxButton",
					location:"after",
					toolbar:"bottom",
					options: { 
						elementAttr: {
							class:'botoesVideos'
						},
						width	: "250px",
						type	: "default",
						icon	: "fas fa-file-video",
            			text	: "2. Exames e Estadiamento", 
            			onClick : function(){
	            			$("#divVideo").html("<video width='100%' height='450px' controls autobuffer autoplay><source id='srcVideo' src='"+ygif+"MAPPA/Parte 3 - Mappa inclusao de exames e estadiamento_v1.mp4' type='video/mp4'>Your browser does not support the video tag.</video>")
                		}
					}
				},{
					widget: "dxButton",
					location:"after",
					toolbar:"bottom",
					options: { 
						elementAttr: {
							class:'botoesVideos'
						},
						width	: "250px",
						type	: "default",
						icon	: "fas fa-file-video",
            			text	: "3. Tratamento", 
            			onClick : function(a){
	            			$("#divVideo").html("<video width='100%' height='450px' controls autobuffer autoplay><source id='srcVideo' src='"+ygif+"MAPPA/Parte 4 - Mappa tratamento_v1.mp4' type='video/mp4'>Your browser does not support the video tag.</video>")
                		}
					}
				}]		        
			}).dxPopup("instance")
			pesquisaExamesSub = $("#pesquisaExamesSub").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
		        width:"100%",
		        items: [{
			        template	: "<div id='divVideo'><video width='100%' height='450px' controls autobuffer autoplay><source id='srcVideo' src='"+ygif+"MAPPA/Parte 2 - Mappa Tela central_v1.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div>"
		        }]
			}).dxForm("instance")
			loadPanel.hide();
			
		}
		
		function listaDetalheRegime(codRegime){
		    selectedCampo = 0
			$.get(urlPreparacao,{
				method		:"listaDetalheRegime",
				codCID		: codCID,
				codRegime	: codRegime
			},function(retorno){
				eval("retorno = "+retorno);
				$("#headerHistorico").html(retorno.titulo)
				formHistorico = $("#formHistorico").dxDataGrid({
					dataSource	: retorno.dataGrid,
					columns		: retorno.columns,
					sorting:{mode:'none'},
	        		allowColumnResizing	: true,
					cellHintEnabled		: true,
					filterRow: { visible: false },
					hoverStateEnabled: true,
					headerFilter: {
						visible:false
					},		
					filterRow:{
						visible:false
					},
					groupPanel: {
						visible: false
					},
					width: "99%",
					height: "50%",
					paging: { enabled: false },
					showBorders: true,
					showRowLines: true,
					columnChooser: {
						enabled: false
					},
					scrolling:{
						showScrollbar: 'always',
						useNative : false
					},
					rowAlternationEnabled: true,
					wordWrapEnabled:true
				}).dxDataGrid("instance")

				$("#alertasTratamento").html("<div class='header1'>Precauções:</div>teste<br><br><div class='header1'>Principais toxicidades:</div>teste")
				$("#formReferencias").dxDataGrid({
					dataSource	: retorno.dataGridReferencias,
					columns		: [{
						dataField : "Estudo",
						width		: "20%"
					},{
						dataField : "Referência"
					},{
						dataField : "Link",
						cellTemplate: function (container, options) { 
							if (options.data.Link!=undefined){
								conteudo = "<div class='custom-item'><a href=# title='Abrir Link' onclick=window.open('"+options.data.Link+"')>Link</a></div>";
								container.append(
									$("<div style='text-align: center;' />")
										.html(conteudo)
										.appendTo(container)
								);
							}
						},
						width		: "80px"
					}],
					sorting:{mode:'none'},
	        		allowColumnResizing	: true,
					cellHintEnabled		: true,
					filterRow: { visible: false },
					hoverStateEnabled: true,
					headerFilter: {
						visible:false
					},		
					filterRow:{
						visible:false
					},
					groupPanel: {
						visible: false
					},
					width: "99%",
					height: "30%",
					paging: { enabled: false },
					showBorders: true,
					showRowLines: true,
					columnChooser: {
						enabled: false
					},
					scrolling:{
						showScrollbar: 'always',
						useNative : false
					},
					rowAlternationEnabled: true,
					wordWrapEnabled:true
				}).dxDataGrid("instance")


			});
		    
		}
		
			function abreExamesMedicos(){
				$("#dvExamesMedicos").dxPopup({
					visible: true,
					title: "Exames Médicos",
					width: 500,
					height:  220,
					position: {
						my: "center",
						at: "center",
						of: window
					},
					toolbarItems: [{
						location:"before",
						toolbar :"top",
					},{
						widget: "dxButton",
						location:"before",
						toolbar:"bottom",
						options: { 
							width	: "130px",
							type	: "default",
							icon	: "close",
	            			text	: "Fechar", 
	            			onClick : function(){
		            			$("#dvExamesMedicos").dxPopup("instance").hide()
	                		}
						}
					}],				
					dragEnabled: true,
					contentTemplate: function(e) {
						conteudoDialog = $("<div id='dvExamesMedicosDialog'></div>")
						e.append(conteudoDialog);
					},
					onContentReady : function(){
						$("#dvExamesMedicosDialog").dxForm({
							screenByWidth: function(width) {
					            return "lg";
					        },
					        colCount: 2,
							items:[{
			                    itemType	: "button",
								horizontalAlignment: "center",
								buttonOptions : {
						            icon: "fas fa-vial",
						            text: "Solicitar Exames Médicos",
						            width: 210,
						            onClick: function() {
							            abreExames(0)
							            $("#dvExamesMedicos").dxPopup("instance").hide()
						            }
								}
							},{
			                    itemType	: "button",
								horizontalAlignment: "center",
								buttonOptions : {
						            icon: "fa fa-file",
						            text: "Abrir Resultados de Exames",
						            width: 210,
						            onClick: function() {
							            carregaResultados()
							            $("#dvExamesMedicos").dxPopup("instance").hide()
						            }
								}
							},{
								//carregaResultados()
			                    itemType	: "button",
								horizontalAlignment: "center",
								buttonOptions : {
						            icon: "fa fa-upload",
						            text: "Realizar Upload de Exames",
						            width: 210,
						            onClick: function() {
							            window.open("VARUploadArquivoMAPPA.csp?paciente="+codPacienteValor+"&YBED="+YBED+"&tema="+($("#tema").prop("checked")==true?1:0),"uploadArquivo","width=550,height=400,"+
										"scrollbars=0,resizable=0,menubar=0,location=0,top=0,left=100")
						            }
								}
							},{
			                    itemType	: "button",
								horizontalAlignment: "center",
								buttonOptions : {
						            icon: "fa fa-search",
						            text: "Consultar Upload de Exames",
						            width: 210,
						            onClick: function() {
							            abreListaArquivos()
							            $("#dvExamesMedicos").dxPopup("instance").hide()
						            }
								}
							}]					
						})
					}
				});
			}

		function ativaDesativaPassagem(){
			if (fichaHist==""){
				fichaHist = ficha
			}
			if ($("#openPesquisaSub").dxPopup("instance").option("toolbarItems[4].options.text")=="Ativar Consulta"){
				var result = DevExpress.ui.dialog.confirm("Deseja <font color=yellow>ATIVAR</font> a consulta "+fichaHist+"?</b>","Confirma Ativação de Consulta?");
				inativo=0
			}else{
				var result = DevExpress.ui.dialog.confirm("Deseja <font color=red>INATIVAR</font> a consulta "+fichaHist+"?</b>","Confirma Inativação de Consulta?");
				inativo=1
			}
		    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
		    result.done(function(dialogResult) {
		        if (!dialogResult){
			        return
				}
		        $.getJSON(urlPreparacao,{
		            method		 : "ativaInativaConsulta",
		            paciente	 : codPacienteValor,
		            codCID		 : codCID,
	                ficha		 : fichaHist
		        },function(retorno){
			        DevExpress.ui.notify(retorno.mensagem, retorno.tipo, 4000);
			        if (inativo==1){
				        if (retorno.isUltima==1){
	        	        	carregarPaciente("")
				        	abrePesquisaPacientes()
				        	fichaHist=""
				        }else{
					        fichaHist = retorno.UltimaFicha
					        abreConsulta()
				        }
			        }else{
				        abreConsulta()
			        }
		        })					
		    })				
		}
		
		function confirmaConsultaRetrospectiva(){
			if (pesquisaExamesSub.option("formData").data==""||(pesquisaExamesSub.option("formData").data==null)){
				var result = DevExpress.ui.dialog.confirm("Confirma a alteração desta consulta para <b>consulta normal?</b>","Confirma remoção de consulta retrospectiva");
			}else{
				var result = DevExpress.ui.dialog.confirm("Confirma a alteração desta consulta para <b>consulta retrospectiva?</b>","Confirma consulta retrospectiva");
			}
		    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
		    result.done(function(dialogResult) {
		        if (!dialogResult){
			        return
				}
				$.ajaxSetup({async: true});
				loadPanel.show();
		        $.getJSON(urlPreparacao,{
		            method		 : "setConsultaRetrospectiva",
		            paciente	 : codPacienteValor,
		            cid			 : codCID,
	                ficha		 : ficha,
	                dataConsulta : JSON.stringify(pesquisaExamesSub.option("formData").data)
		        },function(retorno){
		        	DevExpress.ui.notify(retorno.mensagem, retorno.tipo, 4000);
		        	if (retorno.status==1){
			        	carregaFicha()
		        		openPesquisaSub.hide()
		        	}
		        	$.ajaxSetup({async: true});
		        	loadPanel.hide();
			    });
		    });					    
		}

		function encerrarConsulta(){
	        $.getJSON(urlPreparacao,{
	            method		: "encerrarConsulta",
	            codPaciente	: codPacienteValor,
                dataPEP		: dataPEP,
                ficha 		: ficha,
                codCID		: codCID,
	        },function(retorno){
	        	DevExpress.ui.notify(retorno.mensagem, retorno.tipo, 4000);
	        	carregarPaciente("")
	        	//abrePesquisaPacientes()
	        	abreTelaInicial()
		    });
		}

		function preparaOpcoesGerais(){
			opcoesGerais = $("#divFormOpcoesGerais").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
		        width:284,
		        items: [{
			        cssClass: "dadosGerais",
			        template: "<div id='linhaOpcoesGerais'></div>"
		        }]
	        }).dxForm("instance")
			
			formularioOpcoesGerais = $("#linhaOpcoesGerais").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
	            items: [{
	                itemType: "group",
	                items: [{
						cssClass: "opcoesGeraisForm",
		            	template: "<div id='linhaOpcoesGeraisExib'></div>"
	                }]
	            }]
			}).dxForm("instance")
			
			formularioOpcoesGeraisExib = $("#linhaOpcoesGeraisExib").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
				items: [{
					colCount	: 2,
					itemType: "group",
					items:[{
						template: "<div id='botaoOcultaOpcoesGerais' class='opcoesGerais' style='position:absolute;left:10px;top:19px;'><i class='dx-icon dx-icon-close' style='font-size:18px;cursor:pointer;' title='Fechar Janela Lateral' style='cursor:pointer' onclick='toggleOpcoes()'></i></div>"
					},{
						cssClass: "headerRight",
						template: "&nbsp;"
					}]
				},{
					itemType: "group",
	               	
					items:[{
						itemType: "button",
						cssClass: "btnDestaque",
						buttonOptions : {
				            icon: "fas fa-notes-medical",
				            text: "Prontuário Primário",
				            width:250,
				            height:80,
				            onClick: function() {
				                abrePEPPrimario()
				            }
						}
					}]
				},{
					cssClass: "semBordas",
					template: "<hr class='hrClass'><hr class='hrClass'>"
				},{
					itemType: "group",
	               	caption:"Atestado Médico",
					items: [{
						cssClass: "opcoesGeraisForm1",
						itemType: "button",
						buttonOptions : {
				            icon: "fas fa-file-medical",
				            text: "Atestado Médico",
				            width:250,
				            onClick: function() {
				                imprimir(6,"Atestado Médico")
				            }
						}
					}]
				},{
					itemType: "group",
	               	caption:"Pedidos Médicos",
					items: [{
						cssClass: "opcoesGeraisForm1",
						itemType: "button",
						buttonOptions : {
				            icon: "fas fa-pills",
				            text: "Prescrição/Receituário",
				            width:250,
				            onClick: function() {
				                abrePrescricao("")
				            }
						}
					},{
						cssClass: "opcoesGeraisForm1",
						itemType: "button",
						buttonOptions : {
				            icon: "fas fa-vial",
				            text: "Pedido de Exames",
				            width:250,
				            onClick: function() {
				                abreExames(0)
				            }
						}
					}]	
				}]
			}).dxForm("instance")
		}
		
		

		function insereLinhas(caminho,campo,tituloCampo){
			ret = dxFormulario.itemOption(caminho).items
			ret.push("")
			scrollTop = dxFormulario._scrollable.scrollTop()
            dxFormulario.itemOption(caminho, "items", getLinesOptions(ret,campo,tituloCampo));
            dxFormulario.repaint()
            dxFormulario._scrollable.scrollBy(scrollTop+20)
		}

		function insereLinhasDoencas(caminho,campo,numerodecampo){
			loadPanel.show();
			$.ajaxSetup({async: false});
			setTimeout(function(){ 
				naoSalvar = 1
				ret = dxFormulario.itemOption(caminho).items
				tamanho = ret.length/numerodecampo
				tamanho = tamanho + 1
				ret.push("")
				scrollTop = dxFormulario._scrollable.scrollTop()
	            dxFormulario.itemOption(caminho, "items", getLinesOptionsDoencas(ret,tamanho,campo,numerodecampo));
	            dxFormulario.repaint()
	            dxFormulario._scrollable.scrollBy(scrollTop)
				loadPanel.hide();
				naoSalvar = 0
				$.ajaxSetup({async: true});
			},10);
		}

		function insereLinhasExame3Campos(caminho,campo,numerodecampo){
			loadPanel.show();
			$.ajaxSetup({async: false});
			setTimeout(function(){ 
				naoSalvar = 1
				ret = dxFormulario.itemOption(caminho).items
				tamanho = ret.length/numerodecampo
				tamanho = tamanho + 1
				ret.push("")
				scrollTop = dxFormulario._scrollable.scrollTop()
	            dxFormulario.itemOption(caminho, "items", getLinesOptionsExame3Campos(ret,tamanho,campo,numerodecampo));
	            dxFormulario.repaint()
	            dxFormulario._scrollable.scrollBy(scrollTop)
				loadPanel.hide();
				naoSalvar = 0
				$.ajaxSetup({async: true});
			},10);
		}

		function insereLinhasTextoTexto(caminho,campo,numerodecampo){
			loadPanel.show();
			$.ajaxSetup({async: false});
			setTimeout(function(){ 
				naoSalvar = 1
				ret = dxFormulario.itemOption(caminho).items
				tamanho = ret.length/numerodecampo
				tamanho = tamanho + 1
				ret.push("")
				scrollTop = dxFormulario._scrollable.scrollTop()
	            dxFormulario.itemOption(caminho, "items", getLinesOptionsTextoTexto(ret,tamanho,campo,numerodecampo));
	            dxFormulario.repaint()
	            dxFormulario._scrollable.scrollBy(scrollTop)
				loadPanel.hide();
				naoSalvar = 0
				$.ajaxSetup({async: true});
			},10);
		}

		function insereLinhasExames(caminho,campo){
			ret = dxFormulario.itemOption(caminho).items
			tamanho = ret.length/2
			ret.push("")
			tamanho = tamanho + 1
            dxFormulario.itemOption(caminho, "items", getLinesOptionsExames(tamanho,campo));

		}
		
		dataSourceExames = 	new DevExpress.data.DataSource({
	            store: new DevExpress.data.CustomStore({
                byKey: function(args) {
                    return $.getJSON(urlPreparacao,{
    	            	method	:"listaExames",
    	            	tipo	: 1,
	                    codigo	: args
	                });
                },
	            load: function(args) {
                    return $.getJSON(urlPreparacao,{
    	            	method	:"listaExames",
    	            	tipo	: 1,
						searchValue:args.searchValue,
                    	skip:args.skip,
                    	take:args.take,
	                });
	                }
	            })
	        })		        

		dataSourceArea = 	new DevExpress.data.DataSource({
	            store: new DevExpress.data.CustomStore({
                byKey: function(args) {
                    return $.getJSON(urlPreparacao,{
    	            	method	:"listaArea",
    	            	tipo	: 1,
	                    codigo	: args
	                });
                },
	            load: function(args) {
                    return $.getJSON(urlPreparacao,{
    	            	method	:"listaExames",
    	            	tipo	: 1,
						searchValue:args.searchValue,
                    	skip:args.skip,
                    	take:args.take,
	                });
	                }
	            })
	        })		        

		dataSourceCID = new DevExpress.data.DataSource({
            store: new DevExpress.data.CustomStore({
            byKey: function(args) {
                return $.getJSON(urlPreparacao,{
                    method:"getCID",
                    codigo: args
                });
            },
            load: function(args) {
                return $.getJSON(urlPreparacao,{
                    method:"getCID",
                	usuario: YBED,
                	skip:args.skip,
                	take:args.take,
                	filter:JSON.stringify(args.filter),
                	searchValue:args.searchValue
                });
                }
            })
        })

		dataSourceFamiliar = new DevExpress.data.DataSource({
            store: new DevExpress.data.CustomStore({
	            loadMode: "raw",
	            load: function(args) {
	                return $.getJSON(urlPreparacao,{
	                    method:"getFamiliar"
	                });
                }
            })
        })
		
		dataSourceMedicamentos = new DevExpress.data.DataSource({
            store: new DevExpress.data.CustomStore({
            byKey: function(args) {
                return $.getJSON(urlPreparacao,{
	            	method	:"listaMedicamentos",
                    codigo	: args
                });
            },
            load: function(args) {
                return $.getJSON(urlPreparacao,{
	            	method	:"listaMedicamentos",
					searchValue:args.searchValue,
					filter:JSON.stringify(args.filter),
                	skip:args.skip,
                	take:args.take,
					
                });
                }
            })
        })
				
		dataSourceTratCompl = new DevExpress.data.DataSource({
	        store: new DevExpress.data.CustomStore({
				loadMode: "raw",   
	            load: function(args) {
	                return $.getJSON(urlPreparacao1,{
		            	method: "getRegimeComplementar",
						codCID: codCID,
	                },function(rs){});
	            },
	        }),
	        group: "Grupo"
	    });				
				
		function abreSubOpcoes(sequencia){
			/*loadPanel.show();
			setTimeout(function(){ 
				$.ajaxSetup({async: false});
				tabbed = $("#detalhesTabs").length
				abrePainelSub(sequencia,'','',tabbed)
				loadPanel.hide();
				$.ajaxSetup({async: true});
			},100)
			return*/
			loadPanel.show();
			setTimeout(function(){ 
				$.ajaxSetup({async: false});
				$.get(urlPreparacao,{
				        method		: "recPainel",
				        codPaciente	: codPacienteValor,
				        codPainel	: sequencia,
				        dataPEP		: dataPEP,
				        codCID		: codCID,
				        ficha 		: ficha,
				        fichaSeq	: fichaSeq,
				        layout		: layout,
				        codIDMenu	: meuIDMenu
				    },function(retorno){
					    eval("retornoPainel = "+retorno);
					    $("#dvSelecaoAbaixo").empty()
					    $("#dvSelecaoAbaixo").html("<div id=dvSelecaoAbaixoSub></div>")
				        $("#dvSelecaoAbaixoSub").dxForm({
							screenByWidth: function(width) {
					            return "lg";
					        },
					        activeStateEnabled	: true,
					        formData			: retornoPainel.formulDados,
					        width				: "100%",
						    scrollingEnabled	: true,
						    focusStateEnabled	: true,
						    onContentReady		: function(e){
					        	e.element.dxScrollable("instance").option("useNative", false);  
					        	e.element.dxScrollable("instance").option("showScrollbar","always");
							    $(".subGrupos.invisivel").each(function(){
									$(this).hide()
								})
							    corrigeLayout()
							    loadPanel.hide();
							    $.ajaxSetup({async: true});
						    },
						    alignItemLabels	: true,
						    alignItemLabelsInAllGroups : true,
					        items				: [{
						        itemType	: "group",
						        colCount	: 1,
						        cssClass	: "formularios"+layout,
						        items		: retornoPainel.formul,
					        }],
		   					onFieldDataChanged	: function(obj){
			   					if (naoSalvar){
				   					return
			   					}
			   					if (alterarMult==0) {
				   					alterarMult = 1
				   					return
			   					}
			   					campo = obj.dataField
			   					if (obj.dataField.indexOf("mult-")>=0){
				   					if (obj.value==undefined){
					   					return
				   					}
			   						separado = obj.dataField.split("_")
			   						separadGroup = separado[0].split("-")[1];
					   				for (var xi=0;xi<=10;xi++){
				   						for (var i=0;i<=4;i++){
					   						if (typeof dxFormulario.getEditor("mult-"+xi+"_"+i+"_"+separado[2])=="undefined"){
						   						continue
					   						}
					   						if (i!=separado[1]||xi!=separadGroup) {
						   						alterarMult = 0
					   							dxFormulario.getEditor("mult-"+xi+"_"+i+"_"+separado[2]).option("value","")
					   						}
				   						}
			   						}
			   						campo = separado[2]
			   						alterarMult = 1
			   					}
			   					if (obj.value!=""){
									if (obj.value==true) obj.value=1
									if (obj.value==false) obj.value=0
			   					}
			   					if (obj.value==null) {
				   					obj.value = ""
			   					}
								$.getJSON(urlPreparacao,{
							        method		: "salvaPainel",
							        codPaciente	: codPacienteValor,
							        dataField	: campo,
							        valor		: JSON.stringify(obj.value),
							        codCID		: codCID,
							        ficha 		: ficha,
							        fichaSeq	: fichaSeq,
							        dataPEP		: dataPEP
							    },function(retorno){
								    if (retorno.alerta){
									   DevExpress.ui.notify(retorno.alerta, "warning", 4000);
									   obj.value="" 
									   return
								    }
								    refreshDataSourceAreas(campo)
									atualizaRespostaPai(obj,"dvSelecaoAbaixoSub")
								    recuperaEstadiamento(codPacienteValor)
								})
		   					}

					    }).dxForm("instance")
				    })
			},100)

		}            
		
		function refreshDataSourceAreas(campo){
			$.getJSON(urlPreparacao,{
		        method		: "getDataSourceArea",
		        codPaciente	: codPacienteValor,
		        codCID		: codCID,
		        ficha 		: ficha,
		        dataField	: campo,
		    },function(retorno){
			    select = dxFormulario.getEditor("SelecaoImagem")
			    select.option("dataSource",montaDataSource(retorno))
		    })
		}
			        
		function getLinesOptions(linha,campo,tituloCampo) {
	        var options = [];
	        for (var i = 0; i < linha.length; i++){
	            options.push(generateNewLineOptions(i,campo,tituloCampo));
	        }
	        return options;
	    }

		function getLinesOptionsDoencas(obj,tamanho,campo,numerodecampo) {
	        var options = [];
	        for (var i = 0; i < tamanho; i++){
		        for (var coluna=1;coluna<=numerodecampo;coluna++){
		            options.push(generateNewLineOptionsDoencas(i,campo,coluna,obj[coluna-1]));
		        }
	        }
	        return options;
	    }

		function getLinesOptionsExame3Campos(obj,tamanho,campo,numerodecampo) {
	        var options = [];
	        for (var i = 0; i < tamanho; i++){
		        for (var coluna=1;coluna<=numerodecampo;coluna++){
		            options.push(generateNewLineOptionsExame3Campos(i,campo,coluna,obj[coluna-1]));
		        }
	        }
	        return options;
	    }

		function getLinesOptionsTextoTexto(obj,tamanho,campo,numerodecampo) {
	        var options = [];
	        for (var i = 0; i < tamanho; i++){
		        for (var coluna=1;coluna<=numerodecampo;coluna++){
		            options.push(generateNewLineOptionsTextoTexto(i,campo,coluna,obj[coluna-1]));
		        }
	        }
	        return options;
	    }

		function getLinesOptionsExames(tamanho,campo) {
	        var options = [];
	        for (var i = 0; i < tamanho; i++){
	            options.push(generateNewLineOptionsExames(i,campo,1));
	            options.push(generateNewLineOptionsExames(i,campo,2));
	        }
	        return options;
	    }

		
		function generateNewLineOptions(index,campo,tituloCampo) {
	        return {
		        cssClass : "labelDetalhes",
	            dataField: campo+"^"+index,
	            label:{
		            text: tituloCampo+" "+(index+1),
		          	alignment: "right"  
	            },
	            editorType: "dxTextBox",
	            /*editorOptions: {
	                buttons: [{
	                    name: "trash",
	                    location: "after",
	                    options: {
	                        stylingMode: "text",
	                        icon: "trash",
	                        onClick: function() {
	                            //employee.Phones.splice(index, 1);
	                            //form.itemOption("phones-container.phones", "items", getPhonesOptions(employee.Phones));
	                        }
	                    }
	                }]
	            }*/
	        }
	    }

		function generateNewLineOptionsDoencas(index,campo,tipo,obj) {
	        return {
		        cssClass 	 : obj.cssClass,
		        dataField	 : obj.dataField.split("^")[0]+"^"+index+"^"+obj.dataField.split("^")[2],
	            colSpan		 : obj.colSpan,
	            label		 : obj.label,
	            editorType	 : obj.editorType,
	            editorOptions: obj.editorOptions,
	        }
	    }

		function generateNewLineOptionsExame3Campos(index,campo,tipo,obj) {
	        return {
		        cssClass 	 : obj.cssClass,
		        dataField	 : obj.dataField.split("^")[0]+"^"+index+"^"+obj.dataField.split("^")[2],
	            colSpan		 : obj.colSpan,
	            label		 : obj.label,
	            editorType	 : obj.editorType,
	            editorOptions: obj.editorOptions,
	        }
	    }

		function generateNewLineOptionsTextoTexto(index,campo,tipo,obj) {
	        return {
		        cssClass 	 : obj.cssClass,
		        dataField	 : obj.dataField.split("^")[0]+"^"+index+"^"+obj.dataField.split("^")[2],
	            colSpan		 : obj.colSpan,
	            label		 : obj.label,
	            editorType	 : obj.editorType,
	            editorOptions: obj.editorOptions,
	        }
	    }

		function generateNewLineOptionsExames(index,campo,tipo) {
			if (tipo==1){
		        return {
			        cssClass : "labelDetalhesExames1",
		            dataField: campo+"^"+index+"^1",
		            colSpan: 3,
		            label:{
			            text: "Exame "+(index+1),
			          	alignment: "right"  
		            },
		            editorType: "dxSelectBox",
		            editorOptions: {
						acceptCustomValue: true,
						onCustomItemCreating: function(e) { 
							if(!e.customItem) { 
								e.customItem = {CodExame:e.text.toUpperCase(),DescExame:e.text.toUpperCase()};
							} 
						},						            
			            dataSource : dataSourceExames,
	    		        valueExpr: "CodExame", 
						displayExpr: "DescExame",
						searchEnabled: true,
		            }
		        }
			}else{
		        return {
			        cssClass : "labelDetalhesExames2",
		            dataField: campo+"^"+index+"^2",
		            colSpan: 3,
		            label:{
			            text: "Resultado",
			          	alignment: "right"  
		            },
		            editorType: "dxTextBox"
		        }
		   }
	    }

		function consReferencia(pCodEst){
			if (codCID == "C90.0") {
				if (pCodEst == 1) {
					window.open("https://www.ncbi.nlm.nih.gov/pubmed/15809451");
				}else{
					window.open("https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4846284/");	
				}
			}
			if (codCID == "C91.1") {
				if (pCodEst == 1) {
					window.open("https://pubmed.ncbi.nlm.nih.gov/1139039/");
					window.open("https://pubmed.ncbi.nlm.nih.gov/25461996/");
				}else if (pCodEst == 2) {
					window.open("https://pubmed.ncbi.nlm.nih.gov/890666/");
					window.open("https://pubmed.ncbi.nlm.nih.gov/25461996/");
				}else{
					window.open("https://pubmed.ncbi.nlm.nih.gov/27185642/");	
				}
			}
		}

		function consReferenciaDiagnostico(pSequencia){
			if (pSequencia == 2 && codCID == "C90.0") {
				window.open("https://www.nature.com/articles/leu2009174#citeas/");	
				window.open("https://www.myeloma.org/resource-library/international-myeloma-working-group-imwg-molecular-classification-multiple-myeloma");	
				window.open("https://www.nature.com/articles/s41408-020-00359-2");	
			}else if (pSequencia == 3) {
				window.open("https://www.nature.com/articles/s41408-020-00359-2");	
			}else if (pSequencia == 5) {
				window.open("http://www.myelomafrailtyscorecalculator.net/");	
			}
		}

		function consReferenciaRiscoTrombose(pTipo){
			if (codCID == "C90.0") {
				if (pTipo == 1) {
					window.open("https://pubmed.ncbi.nlm.nih.gov/31379000/");
					window.open("https://pubmed.ncbi.nlm.nih.gov/33997961/");
				}else{
					window.open("https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7808759/");	
				}
			}
		}


        function recuperaEstadiamento(codPaciente){
	        if (codPaciente==""||codPaciente==null){
		        return
	        }
	        carregaLinhaTratamento(codPaciente)
			$.getJSON(urlPreparacao,{
		        method		: "recEstadiamento",
		        paciente	: codPaciente,
		        codCID		: codCID,
		        ficha 		: ficha,
		        fichaSeq	: fichaSeq,
		        dataPEP		: dataPEP,
		        layout		: layout
		    },function(retorno){
			    if (retorno.form==""){
				    retorno.form = [{colSpan:10,template:"Sem Estadiamento Cadastrado"}]
			    }
		    	$(".bodyResumo").html("<span style='cursor: pointer;' onClick='editarResumoClinico();'><span class='headerSub2'>Resumo clínico:</span> <i class='fas fa-edit'></i> "+retorno.resumo+"</span>")
		    	$(".bodyResumo").attr("title",retorno.resumo.replace("<b>","").replace("</b>",""))
			    descBT = "Estadiar"
			    if (retorno.horaEst!="Estadiamento"){
				    descBT = "Estadiar"
			    }
			    $("#lbEstadiamento").html(retorno.horaEst)
			    if (retorno.form.length>0){
				    	item = {}
				    	item.colSpan= 10
				    	item.itemType= "button"
				    	item.dataField = "btReestadiamento"
           				item.horizontalAlignment= "center"
           				if (retorno.estadiamentoPossivel==2){
	           				estiloEstad = "corDisabled"
           				}else if (retorno.estadiamentoPossivel==1){
           					estiloEstad = ""
           				}else{
	           				estiloEstad = "corAlerta"
           				}
           				item.cssClass= "btnDestaque "+estiloEstad
						buttonOptions = {}
						buttonOptions.height = 30
           				buttonOptions.elementAttr = {
	           				id : "btReestadiamento"
           				}
           				if (retorno.estadiamentoPossivel==1||(retorno.estadiamentoPossivel==2)){
			            	buttonOptions.icon	= "fas fas fa-check"
           				}else{
           					buttonOptions.icon	= "fas fa-exclamation-triangle"
           				}
			            buttonOptions.text	= descBT
			            if (retorno.estadiamentoPossivel==1){
				            buttonOptions.onClick = function() {
					        	loadPanel.show();
						        $.getJSON(urlPreparacao,{
						            method		: "estadiarPaciente",
						            paciente	: codPacienteValor,
					                dataPEP		: dataPEP,
					                codCID		: codCID,
					                ficha		: ficha
						        },function(retorno){
							        mensagem = retorno.mensagem
							        tipo = retorno.tipo
						        	DevExpress.ui.notify(mensagem, tipo, 4000);
						        	recuperaEstadiamento(codPacienteValor)
						        	loadPanel.hide();
							    });
				            }
			            }else{
				            buttonOptions.onClick = function() {
					            var texto = "Há campos pendentes para a realização do estadiamento"
					            var type = "error"
					            if (retorno.estadiamentoPossivel==2){
						            var texto = "Não há alterações para realizar o estadiamento"
						            var type  = "warning"
					            }
					            DevExpress.ui.notify(texto, type, 4000);
				            }
			            }
						item.buttonOptions = buttonOptions
			            retorno.form.push(item)
			    }
				$("#divEstadiamento").dxForm({
					width: "200px",
					screenByWidth: function(width) {
			            return "lg";
			        },
			        onContentReady: function(){
					    $(".estadiamentoInfoI").each(function(){
						    meuId = $(this).attr("meuId")
						    texto = $(this).attr("texto")
						    nomeEst = $(this).attr("nomeEst")
							$(this).append("<div id='tooltipEstadionamento_"+meuId+"' class='tooltips'></div>")
						 	$("#tooltipEstadionamento_"+meuId).dxTooltip({
						        target: "#esta_"+meuId+",#AlertaAst_"+meuId,
						        elementAttr : {
							        texto	: texto,
							        nomeEst	: nomeEst,
							        meuId	: meuId
						        },
						        cornerRadius: 15,
						        position :"right",
						        showEvent: "mouseenter",
						        hideEvent: "mouseleave",
						        closeOnOutsideClick: true,
								contentTemplate: function(data) {
						            xMeuId  = $(this)[0]._options.elementAttr.meuId
						            texto	= $(this)[0]._options.elementAttr.texto
						            desc	= $(this)[0]._options.elementAttr.nomeEst
						            //console.log(texto)
						            //console.log(desc)
						            var pendentes = ""
									pendentes = "<table class='tbToolTipEsta'>"+
													"<tr><td colspan=3><b>"+desc+"</b></td></tr>"+
													"<tr><td>"+texto+"</td></tr>";
                                    if (codCID == "C90.0") {
	                                	pendentes +="<tr><td colspan=3><hr></td></tr>";
	                                	pendentes +="<tr><td colspan=3><b>Referência:</b></td></tr>";
	                                	if (xMeuId == 1) {
		                                	pendentes +="<tr><td colspan=3> - Greipp PR et al. International staging system for multiple myeloma. J Clin Oncol. 2005;23:3412-3420</td></tr>";
	                                	}else{
		                                	pendentes +="<tr><td colspan=3> - Palumbo A, et al. Revised International Staging System for Multiple Myeloma: A Report From International<br>Myeloma Working Group. J Clin Oncol. 2015 Sep 10;33(26):2863-9.</td></tr>";
	                                	}
						            }
                                    if (codCID == "C91.1") {
	                                	pendentes +="<tr><td colspan=3><hr></td></tr>";
	                                	pendentes +="<tr><td colspan=3><b>Referência:</b></td></tr>";
	                                	if (xMeuId == 1) {
		                                	pendentes +="<tr><td colspan=3> - Blood. 1975 Aug;46(2):219 - 234.</td></tr>";
		                                	pendentes +="<tr><td colspan=3> - JAMA. 2014 Dec 3;312(21):2265 - 2276. doi: 10.1001/jama.2014.14553.</td></tr>";
	                                	}else if (xMeuId == 2) {
		                                	pendentes +="<tr><td colspan=3> - Cancer. 1977 Aug;40(2):855-864. doi: 10.1002/1097-0142(197708)40:2<855::aid-cncr2820400239>3.0.co;2-1.</td></tr>";
		                                	pendentes +="<tr><td colspan=3> - JAMA. 2014 Dec 3;312(21):2265-76. doi: 10.1001/jama.2014.14553.</td></tr>";
	                                	}else{
		                                	pendentes +="<tr><td colspan=3> - Lancet Oncol. 2016 Jun;17(6):779-790. doi: 10.1016/S1470-2045(16)30029-8. Epub 2016 May 13.</td></tr>";
	                                	}
						            }
                                    pendentes +="</table>"
						            data.html(
						            	pendentes
						            );
						        }		
						    });
						})
       	        	},
					colCount	: 10,
					formData	: retorno.dados,
					items		: [{
						itemType	: "group",
						colCount	: 10,
						colSpan		: 10,
						items		: retorno.form
					}]
				})

				$("#lbDiagnostico").html("Diagnóstico "+retorno.diagnosticoDtHr)
				$("#divDiagnostico").dxForm({
					width: "200px",
					screenByWidth: function(width) {
			            return "lg";
			        },
					colCount	: 10,
					formData	: retorno.dados,
					items		: [{
						colSpan		: 10,
						visible		: retorno.diagnostico==""?false:true,
						template	: retorno.diagnostico
					}/*,{
						colSpan		: 10,
						visible		: retorno.textoDuplLinfo==""?false:true,
						template	: retorno.textoDuplLinfo
					}*/,{
				    	colSpan: 10,
				    	itemType: "button",
				    	dataField: "btCalcDiagnostico",
           				horizontalAlignment: "center",
           				cssClass: "btnDestaque "+estiloEstad,
						buttonOptions: {
							height: 30,
   	        				elementAttr: {
	           					id: "btCalcDiagnostico"
           					},
           					icon: "fas fas fa-check",
			            	text: "Calcular",
			            	onClick: function() {
					        	calculaDiagnostico();
						    }
						}
						
					}]
				})

				$("#lbRiscoTrombose").html("Risco de Trombose "+retorno.riscoTromboseDtHr)
				$("#divRiscoTrombose").dxForm({
					width: "200px",
					visible: (codCID == "C90.0" ? 1 : 0),
					screenByWidth: function(width) {
			            return "lg";
			        },
					colCount	: 10,
					//formData	: retorno.dados,
					items		: [{
						colSpan		: 10,
						visible		: retorno.riscoTrombose==""?false:true,
						template	: retorno.riscoTrombose
					},{
				    	colSpan: 10,
				    	itemType: "button",
				    	dataField: "btCalcRiscoTrombose",
           				horizontalAlignment: "center",
           				cssClass: "btnDestaque "+estiloEstad,
						buttonOptions: {
							height: 30,
   	        				elementAttr: {
	           					id: "btCalcRiscoTrombose"
           					},
           					icon: "fas fas fa-check",
			            	text: "Calcular",
			            	onClick: function() {
					        	calculaRiscoTrombose();
						    }
						}
						
					}]
				})

				//recuperaEstadiamentoBotao(codPacienteValor)
		    })

	    }

        function recuperaEstadiamentoBotao(codPaciente){
	        return
			$.getJSON(urlPreparacao,{
		        method		: "recEstadiamento",
		        paciente	: codPaciente,
		        codCID		: codCID,
		        ficha 		: ficha,
		        fichaSeq	: fichaSeq,
		        dataPEP		: dataPEP,
		        layout		: layout,
		        opcao		: 2
		    },function(retorno){
			    if (retorno.toolEstagio==""){
				    $("#tooltipEstadionamentoBT").remove()
			    }
			    if (retorno.estadiamentoPossivel==1){
				    estadiamentoPossivel = 1
				    var formularioEsta = $("#divEstadiamento").dxForm("instance") //.getEditor("btReestadiamento");
				    formularioEsta.itemOption("btReestadiamento","cssClass","btnDestaque")
				    formularioEsta.getEditor("btReestadiamento").option("icon","fas fa-check")
			    }else{
				    estadiamentoPossivel = 0
				    var formularioEsta = $("#divEstadiamento").dxForm("instance") //.getEditor("btReestadiamento");
				    formularioEsta.itemOption("btReestadiamento","cssClass","btnDestaque corAlerta")
				    formularioEsta.getEditor("btReestadiamento").option("icon","fas fa-exclamation-triangle")
			    }
				if ($("#tooltipEstadionamentoBT").html()==undefined){
					$("body").append("<div id='tooltipEstadionamentoBT' class='tooltips'></div>")
				}
				if (retorno.toolEstagio==""||retorno.toolEstagio==null) {
					retorno.toolEstagio="Estadiamento Possivel"
				}
			 	$("#tooltipEstadionamentoBT").dxTooltip({
			        target: "#btReestadiamento",
			        elementAttr : {
				        texto	: retorno.toolEstagio,
				        estPoss	: retorno.estadiamentoPossivel

			        },
			        cornerRadius: 15,
			        position :"right",
			        showEvent: "mouseenter",
			        hideEvent: "mouseleave",
			        closeOnOutsideClick: true,
					contentTemplate: function(data) {
			            texto	= $(this)[0]._options.elementAttr.texto
			            var pendentes = ""
			            if (texto!=""){
			            	pendentes = "<table class='tbToolTipEsta'><tr><td>"+
			            	texto+"</td></tr>"
			            	"</table>"
			            }
			            data.html(
			            	pendentes
			            );
			        }		
			    });
			    //editor.option("disabled",true)
		    })
	    }
	    
		function preparaLinhaTempo(){
			formularioLinhaTempoPai = $("#divFormLinhaTempo").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
			    width: function(){
					return window.innerWidth - dadosGerais.option("width")+8;
				},
                items: [{
		            cssClass: "linhaTempoBG",
	            	template: "<div id='linhaTempoForm'></div>"
	            }]
	        }).dxForm("instance")
			//
			formularioLinhaTempo = $("#linhaTempoForm").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
				//activeStateEnabled:true,
				height: layout==2?100:105,
			    width: "100%",
	            items: [{
	                itemType: "group",
	                items: [{
						cssClass: "headerLT"+layout+" colorTratamento colorBGTratamento100",
						itemType: "group",
						colCount: 100,
						items : [{
							colSpan: 99,
							cssClass: "headerSub colorFTratamento",
							///template: "<div onclick='toggleLinhaTempo()' style='cursor:pointer;'>Linha do Tempo<font id='dvLinhaTempoDesc'></font></div>"
							template: "<div onclick='toggleLinhaTempo()' style='height:20px;cursor:pointer;overflow:hidden;'>Linha do Tratamento<font id='dvLinhaTempoDesc'></font></div>"
						},{
							cssClass: "headerSub colorFTratamento",
							template: "<i id='buttonHideLT' onclick='toggleLinhaTempo()' style='font-size:20px;top:2px;left:4px;position:relative;cursor:pointer;' class='fa "+(layout==1?'fa-chevron-up':'fa-chevron-down')+" title='Exibir Linha do Tratamento'>"
						}]
					},{
						cssClass: "linhaTempoForm"+layout+" colorBGTratamento",
		            	template: "<div id='scrollview'><div id='linhaTempoChart' class='pb-10_"+layout+"'></div></div>"
	                }]
	            }]
	        }).dxForm("instance")
	        //
		}
		function preparaPainelAcc(){
			if (typeof formAtendimentoClinicoAcc!="undefined"){
				formAtendimentoClinicoAcc.expandItem(0)
			}
			var itensAcc = [,{
		        	title:"Diagnóstico e Seguimento",
		        	id:"divFormAtendimentoClinico"
		        },{
			        visible : true,
			        title:"Conduta e Tratamento",
			        id:"divFormAtendimentoClinicoSugestao",
			    }]
		     formAtendimentoClinicoAcc = $("#divFormAtendimentoClinicoAcc").dxAccordion({
			    repaintChangesOnly	: true,
			    deferRendering		: false,
			    activeStateEnabled	: false,
		        items: itensAcc,
		        itemTitleTemplate: function(itemData, itemIndex, itemElement){
			        itemElement.append("<div id='Title"+itemData.id+"' class='headFicha colorAtendimento colorBGAtendimento100'>"+itemData.title+"</div>");
			    },
		        itemTemplate: function (itemData, itemIndex, itemElement) {
					
					
					itemElement.append("<div id='"+itemData.id+"'>"+itemData.id+"</div>");
					if (itemData.id=="divFormAtendimentoClinico"){
						preparaAtendimentoClinico()
					}
					if (itemData.id=="divFormAtendimentoClinicoSugestao"){
						preparaSugestaoTerapeutica()
						carregaAtendimentoClinico(codPacienteValor,1)
					}
		        }
		    }).dxAccordion("instance");
		    
		}
	    
	    function preparaAtendimentoClinico(){
		    
			formularioAtendimentoClinico = $("#divFormAtendimentoClinico").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
		            items: [{
			            cssClass: "atendimentoBG"+layout,
		                itemType: "group",
		                items: [{
			            	template: "<div id='atendimentoClinico'></div>"
		                }]
		            }]
	        }).dxForm("instance")
				
			if (layout==1){
				atendimentoClinico = $("#atendimentoClinico").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
					items: [{
						visible: layout==1?false:true,
						cssClass: "headerL"+layout,
						colCount: 1,
						itemType	: "group",
						items:[{
							cssClass: "headerSub",
							template: "<div id='boxAtendimentoTitle'>Ficha Diagnóstico</div>"
						}]
					},{
						cssClass: "atendimentoClinico",
						itemType: "group",
						items:[{
							template: "<div id='formBox'></div>"
						}]
					}]
				}).dxForm("instance")

				formBox = $("#formBox").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
					scrollingEnabled	: true,
					items: [{
						itemType: "group",
						items:[{
							template: "<div id='boxAtendimento'></div>"
						}]
					}]
				}).dxForm("instance")

				
				boxAtendimento = $("#boxAtendimento").dxTileView({
					items: arrayAtendimentoClinico,
					height: "100%",
					itemMargin: 16,
					baseItemHeight:137,
					baseItemWidth:137,
				    width: "100%",
				    showScrollbar:true,
					direction: "vertical",
					noDataText: codPacienteValor==""?"":"Diagnóstico do paciente sem workflow de atendimento clínico cadastrado",
					itemTemplate: function (itemData, itemIndex, itemElement) {
			            align = "center"
			            botao="<i class='fa fa-arrow-right' style='color:#ffffff;'>"
			            trash="<i class='fas fa-trash-alt' style='color:#ffffff;' title='Excluir os dados preenchidos' onclick=limparfl=1;limparCampos('"+itemData.ID+"')>"
			            return "<div class='boxTile' id='idBoxTile"+itemData.ID+"' onclick=(limparfl==1?limparfl=0:abrePainel('"+itemData.ID+"','',0))><p>"+itemData.Caption+"</p>"+
			            	   "<div class='rodapeGauge' id='gauge_"+itemData.ID+"'></div>"+
			            	   //"<div class='rodape' style='width:100%;text-align:"+align+";padding:5px'>"+trash+"&nbsp;&nbsp;"+botao+"</div>"+
			            	   "<div class='rodape' style='width:100%;text-align:"+align+";padding:5px'>"+botao+"</div>"+
			            	   "</div>"
			        },
			    }).dxTileView("instance");
			    
			}else{
				formularioAtendimentoClinicoDetalhes = $("#divFormAtendimentoClinicoSugestao").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
		            items: [{
			            cssClass: "atendimentoBG",
		                itemType: "group",
		                items: [{
			            	template: "<div id='pesquisaExamesPre'></div>"
		                }]
		            }]
		        }).dxForm("instance")

				pesquisaExamesPre = $("#pesquisaExamesPre").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
					items: [{
						cssClass: "atendimentoClinicoDeta",
						template: function(){
							return "<div id='atendimentoClinicoDeta'></div>"
						}
					}]
				}).dxForm("instance")
				
				atendimentoClinicoDeta = $("#atendimentoClinicoDeta").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
				    scrollingEnabled	: true,
				}).dxForm("instance")
				
				atendimentoClinico = $("#atendimentoClinico").dxForm({
					scrollingEnabled	: true,
				    onContentReady		: function(e){
			          e.element.dxScrollable("instance").option("direction", "vertical");  
			          e.element.dxScrollable("instance").option("useNative", false);  
			          
				    },			        
					screenByWidth: function(width) {
			            return "lg";
			        },
					items: [{
						cssClass: "headerLMenu"+layout+" headFicha colorAtendimento colorBGAtendimento100",
						colCount: 1,
						itemType	: "group",
						items:[{
							cssClass: "headerSub colorFAtendimento",
							template: "<div id='boxAtendimentoTitle'>Ficha Diagnóstico</div>"
						}]
					},{
						cssClass: "menuClinico colorBGAtendimento",
						template: function(){
							return "<div id='boxAtendimentoMenu' style='z-index:10000000'></div>"
						}
					},{
						cssClass: "espacoMenu"
					},{
						cssClass: "headerLMenu"+layout+" headConduta colorConduta colorBGConduta100",
						colCount: 1,
						itemType	: "group",
						items:[{
							cssClass: "headerSub colorFConduta",
							template: "<div id='boxAtendimentoTitleTratamento' conteudo='Conduta e Tratamento'>Conduta e Tratamento</div>"
						}]
					},{
						cssClass: "menuClinicoTratamento colorBGConduta",
						template: function(){
							return "<div id='boxAtendimentoMenuTratamento' style='z-index:10000000'></div>"
						}
					}]
				}).dxForm("instance")
				
				return				
			}
		}

	    function preparaSugestaoTerapeutica(){
			formularioAtendimentoClinicoDestaque = $("#divFormAtendimentoClinicoSugestao").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
					//activeStateEnabled:true,
				    width: function(){
						return window.innerWidth - dadosGerais.option("width")+8+(opcaoMenuResumo==2?170:0);
					},
		            items: [{
			            cssClass: "atendimentoClinicoTratamento",
		                itemType: "group",
		                items: [{
			            	template: "<div id='atendimentoClinicoDestaque'></div>"
		                }]
		            }]
	        }).dxForm("instance")

			atendimentoClinicoDestaque = $("#atendimentoClinicoDestaque").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
				items: [{
					itemType: "group",
					items:[{
						template: "<div id='boxAtendimentoDestaque'></div>"
					}]
				}]
			}).dxForm("instance")
			
			boxAtendimentoDestaque = $("#boxAtendimentoDestaque").dxTileView({
				items: arrayAtendimentoClinicoDestaque,
				height:"1000px",
				itemMargin: 16,
				baseItemHeight:137,
				baseItemWidth:137,
			    width: "100%",
			    showScrollbar:true,
				direction: "vertical",
				noDataText: codPacienteValor==""?"":"Diagnóstico do paciente sem workflow de atendimento clínico cadastrado",
				itemTemplate: function (itemData, itemIndex, itemElement) {
		            align = "center"
		            botao="<i class='fa fa-arrow-right' style='color:#ffffff;'>"
		            return "<div class='boxTile' id='idBoxTile"+itemData.ID+"' onclick=abrePainel('"+itemData.ID+"','',0)><p>"+itemData.Caption+"</p>"+
		            	   "<div class='rodapeGauge' id='gauge_"+itemData.ID+"'></div>"+
		            	   "<div class='rodape' style='width:100%;text-align:"+align+";padding:5px'>"+botao+"</div></div>"
		        },
		    }).dxTileView("instance");	
			
		}

	    function preparaRelatorios(){
			formularioAtendimentoClinicoDestaque = $("#divFormAtendimentoClinicoRelatorios").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
					//activeStateEnabled:true,
				    width: function(){
						return window.innerWidth - dadosGerais.option("width")+8;
					},
		            items: [{
			            cssClass: "atendimentoClinico",
		                itemType: "group",
		                items: [{
			            	template: "<div id='atendimentoClinicoRelatorios'></div>"
		                }]
		            }]
	        }).dxForm("instance")

			atendimentoClinicoDestaque = $("#atendimentoClinicoRelatorios").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
				items: [{
					itemType: "group",
					items:[{
						template: "<div id='formBoxDestaqueRelatorios'></div>"
					}]
				}]
			}).dxForm("instance")

			formBoxDestaqueRelatorios = $("#formBoxDestaqueRelatorios").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
				scrollingEnabled	: true,
				height:"1000px",
				items: [{
					itemType: "group",
					items:[{
						template: "<div id='boxAtendimentoDestaqueRelatorios'></div>"
					}]
				}]
			}).dxForm("instance")
			
		}
	    
    
	    function recuperaArvore(arvore,id){
		    var achou = ""
		    for (var i=0;i<=arvore.length-1;i++){
			    if (arvore[i].ID==id){
				    filho = i
				    achou = 1
			    }
			    if (!achou&&arvore[i].items){
				    achou = recuperaArvore(arvore[i].items,id)
				    if (achou){
					    vetor.push(i)
				    }
			    }
		    }
			return achou
	    }

	    function recuperaArvore2(arvore,id){
		    var achou = ""
		    for (var i=0;i<=arvore.length-1;i++){
			    if (arvore[i].ID==id){
				    filho = i
				    achou = 1
				    if (arvore[i].items){
					    for (var j=0;j<arvore[i].items.length;j++){
						    vetorFilhos.push(j)
					    }
				    }
			    }
			    if (!achou&&arvore[i].items){
				    achou = recuperaArvore2(arvore[i].items,id)
				    if (achou){
					    vetor.push(i)
				    }
			    }
		    }
			return achou
	    }
	    
		function menusTemplate(a){
			if (a.Tipo==15||a.Tipo==19){
				retorno = "<div class='btMenu' id='"+a.ID+"' caption='"+a.Caption+"' icon='"+a.icon+"'></div>"
			}else if (a.Tipo==18){
				retorno = "<div class='btMenu btFlat' id='bt"+a.ID+"' caption='"+a.Caption+"' icon='"+a.icon+"'></div>"
			}else if (a.Predecessor==""){
				retorno = "<div id='gauge_"+a.ID+"' style='position:absolute;'></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+a.Caption+"&nbsp;&nbsp;&nbsp;&nbsp;"
			}else if (a.Tipo==4){
				if ($("#icone"+a.ID).length>0){
					return
				}
				cor = caixaDefault
				if (a.valor1!="") cor = caixaMarcada
				retorno = "<span class='dx-menu-item-text'><i id='icone"+a.ID+"' style='color:"+cor+"' class='far fa-clipboard' id='"+a.ID+"' edita='"+a.Edita+"' type=textbox></i>&nbsp;"+a.Caption+"</span>"
			}else{
				cor = caixaDesabilitada
				icone = "far fa-circle"
				if (a.valor1=="0"){
					cor = caixaDesmarcada
					icone = "far fa-times-circle"
				}
				if (a.valor1=="1"){
					cor = caixaMarcada
					icone = "far fa-check-circle"
				}
				if (!a.Edita){
					cor = caixaDesabilitada
				}
				retorno = "<span class='dx-menu-item-text'><i style='color:"+cor+"' class='"+icone+"' id='"+a.ID+"' edita='"+a.Edita+"' type=checkbox onclick='seleciona(this)'></i>&nbsp;"+a.Caption+"</span>"
			}
			if (a.items) retorno += "<span class='dx-menu-item-popout-container'><div class='dx-menu-item-popout'></div></span>"
			if (a.Predecessor==""){
				//retorno += "<span class='dx-menu-item-popout-container'><i class='fas fa-trash-alt' style='color:#ffffff;position:relative;left:25px;' title='Excluir os dados preenchidos' onclick=limparfl=1;limparCampos('"+a.ID+"')></span>"
			}
			return retorno
		}
		
		function abreTexto(obj){
			if ($("#dvTexto").html()!=undefined){
				$("#dvTexto").remove()
			}
			var myDialog = DevExpress.ui.dialog.custom({
		        width: "450",
		        title: obj.Caption,
		        messageHtml: "<div id='dvTexto'></div>",
		        buttons: [{
		            text: "Confirmar",
		            onClick: function(e) {
		                return { buttonText: e.component.option("text") }
		            }
		        },{
		            text: "Fechar",
		            onClick: function(e) {
		                return { buttonText: "" }
		            }
		        }, 
		        // ...
		        ]
		    });
		    myDialog.show().done(function(dialogResult) {
		        if (dialogResult.buttonText){
					$.getJSON(urlPreparacao,{
				        method		: "salvaPainel",
				        codPaciente	: codPacienteValor,
				        dataField	: obj.ID,
				        valor		: $("#dvTexto").dxTextArea("instance").option("value"),
				        codCID		: codCID,
				        ficha 		: ficha,
				        fichaSeq	: fichaSeq,
				        dataPEP		: dataPEP
				    },function(retorno){
					    recuperaEstadiamento(codPacienteValor)
					    //recuperaEstadiamentoBotao(codPacienteValor)
					    $("#icone"+obj.ID).css("color",caixaMarcada)
						vetor = []
						vetorFilhos = []
						filho = ""
						arvore = boxAtendimentoMenu.option("items")
						caminho = recuperaArvore2(arvore,obj.ID)
						string=""
						for (var j =vetor.length-1;j>=0;j--){
						   if (string!=""){
							   string = string+"."
						   }
						   string = string+"items["+vetor[j]+"]"
						}
						stringF = string+".items["+filho+"].valor1"
						boxAtendimentoMenu.option(stringF,$("#dvTexto").dxTextArea("instance").option("value"));
						carregaGauges()		
					    
					})
		        }
		    });
		    $("#dvTexto").dxTextArea({
				height:100,
				width:400,
				value: obj.valor1
			})
		}
		
	    function seleciona(obj){
		    alteraCheck = 1
	    }
		function abrePainel(id,subId,estilo,flVoltar){
	        //console.log(id+"|"+subId+"|"+estilo+"|"+flVoltar)
			xId = id;
			xSubId = subId;
			xWstilo = estilo;
			xFlVoltar = flVoltar;
	        if (codPacienteValor==""){
		        DevExpress.ui.notify("Informe o paciente", "warning", 4000);
		        return
	        }
	        if (id == "Dashboard") {
			    //montaDashboard(codPacienteValor);
				return;
	        }
			opcoesSimNao = 0
			loadPanel.show();
			setTimeout(function(){ 
				$.ajaxSetup({async: false});
				if (painelAnterior!=painelAtual){
					painelAnteriorArray.push(painelAtual)
				}
				painelAnterior = painelAtual
				$.get(urlPreparacao,{
			        method		: "recPainel",
			        codPaciente	: codPacienteValor,
			        codPainel	: id,
			        codOpcaoPainel	: subId,
			        dataPEP		: dataPEP,
			        codCID		: codCID,
			        ficha 		: ficha,
			        fichaSeq	: fichaSeq,
			        layout		: layout,
			        codIDMenu	: meuIDMenu,
			        conteudoSearch: conteudoSearch
			    },function(retorno){
				    conteudoSearch = "";
				    painelIndexAtual = -1
				    if ($("#detalhesTabs").html()!=undefined){
				    	painelIndexAtual = $("#detalhesTabs").dxTabs("instance").option("selectedIndex")
				    }
				    if (retorno.indexOf("~")>-1){
					    eval(retorno.split("~")[1])
					    retorno = retorno.split("~")[0]
				    }
				    eval("retornoPainel = "+retorno);
				    //console.log(retornoPainel)
				    var rBloCondTera = retornoPainel.rBloCondTera;
				    if (retornoPainel.achou==0){
					    painelAnteriorArray.pop()
					    if (painelAtual==id){
						    openPesquisa.hide()
					    }
					    $.ajaxSetup({async: true});
					    loadPanel.hide();
					    return
				    }
					if (layout==2){
						carregaGauges()
						//boxAtendimentoMenu.repaint()
					}			    
				    painelAtual = id
				     idRetorno = retornoPainel.pai
				     if (layout==1){
						 popupOptions = {
							shading:true,
							maxHeight:"600px",
							maxWidth:"1000px",
					        width: "90%",
					        height: "90%",
					        showTitle: true,
					        visible: true,
					        onShown: function(a){
								titulo = openPesquisa.option("toolbarItems[0].html")
								openPesquisa.option("toolbarItems[0].html"," ")
								openPesquisa.option("toolbarItems[0].html",titulo)
						    },
					        onHiding: function(a){
						        if (!fechaPanel){
						        	a.cancel = true
						        	verificaRegrasPainel(id,subId,"fechar")
						            return
						        }
		   				        var meuId = id
						        //atualizaGauge(codPacienteValor,meuId)
						        carregaGauges()
						        recuperaEstadiamento(codPacienteValor)	
						    },
					        dragEnabled: true,
					        closeOnOutsideClick: false,
							toolbarItems: [{
								location:"before",
								toolbar :"top",
							},{
								widget: "dxButtonGroup",
								location:"after",
								toolbar :"top",
								options: { 
									items:[{
										icon: "fas fa-book-medical",
										hint: "Exibir passagens anteriores do paciente"
									},{
										icon: "fas fa-eraser",
										hint: "Limpar dados preenchidos"
									}],
		                			onItemClick : function(obj){
			                			if (obj.itemIndex==0){
			                				abreHistorico()
			                			}
			                			if (obj.itemIndex==1){
			                				limparCampos("")
			                			}
			                		}
								}
							},{
								widget: "dxButton",
								location:"before",
								toolbar:"bottom",
								options: { 
									width	: "130px",
									type	: "default",
									icon	: "close",
		                			text	: "Sair", 
		                			onClick : function(){
			                			voltar = painelAnteriorArray.pop()
			                			painelAtual = painelAnteriorArray[painelAnteriorArray.length-1]
			                			painelAnterior = painelAnteriorArray[painelAnteriorArray.length-1]
			                			verificaRegrasPainel(voltar,"","","",1)
			                			painelAnteriorArray.pop()
			                		}
								}
							},{
								widget: "dxButton",
								location:"after",
								toolbar:"bottom",
								options: { 
									visible	: false,
									width	: "130px",
									type	: "default",
									icon	: "check",
		                			text	: "Ok", 
		                			onClick : function(){
										if (painelAtual==1290){
											sairMenu = 1
				                			verificaRegrasPainel("")
				                			return
			                			}
	   								    if (opcoesSimNao<2){
										    openPesquisa.hide()
										    return
									    }

			                			verificaRegrasPainel(idRetorno)
			                		}
								}
							}],			        
					    }		
				     }else{
						 popupOptions = {
							shading:false,
					        width: "100%",
					        height: "100%",
					        position: {
						        of:$("#pesquisaExamesPre")
					        },
					        showTitle: true,
					        visible: true,
					        onShown: function(a){
								titulo = openPesquisa.option("toolbarItems[0].html")
								openPesquisa.option("toolbarItems[0].html"," ")
								openPesquisa.option("toolbarItems[0].html",titulo)
								$(".dx-popup-wrapper > .dx-overlay-content").css({"border-radius":"0px","border-color": corBordaDeta})
						    },
					        onHiding: function(a){
						        if (!fechaPanel){
						        	a.cancel = true
						        	verificaRegrasPainel(painelAtual,subId,"fechar")
						            return
						        }
						        //atualizaGauge(codPacienteValor,meuId)
						        carregaGauges()	
						        recuperaEstadiamento(codPacienteValor)	
						        if (fechaPanel){
			   				        var meuId = id
							        fechaPanel = false	
							        painelAtual = ""	        
							        return
						        }
						        return
								if (sairMenu){
							    	fechaPanel = true
							    	painelAtual = ""
									carregaGauges()		
							    	openPesquisa.hide()
							    	return
								}
								if (painelAtual==meuIDMenu){
									$.getJSON(urlPreparacao,{
								        method		: "recPainelIrmao",
								        paciente	: codPacienteValor,
								        idPainel	: painelAtual,
								        codCID		: codCID,
								        ficha 		: ficha,
								        fichaSeq	: fichaSeq,
								        dataPEP		: dataPEP
								    },function(retorno){
								    	if (retorno.sequencia){
					        				meuID = retorno.sequencia
						        			meuIDMenu = retorno.sequencia
									    	abrePainel(meuID,"")
								    	}else{
									    	fechaPanel = true
											carregaGauges()		
									    	openPesquisa.hide()
								    	}
								    })
									return
								}
						        return
						        
								$.getJSON(urlPreparacao,{
							        method		: "verificaRegrasPainel",
							        codPaciente	: codPacienteValor,
							        codPainel	: painelAtual,
							        codCID		: codCID,
							        ficha 		: ficha,
							        fichaSeq	: fichaSeq,
							        dataPEP		: dataPEP
							    },function(retorno){
								    if (retorno.status!=1){
										var result = DevExpress.ui.dialog.confirm(retorno.mensagem, "Prosseguir?");
									    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
									    result.done(function(dialogResult) {
									        if (!dialogResult){
										        return
											}
											if (sairMenu){
										    	fechaPanel = true
												carregaGauges()		
										    	openPesquisa.hide()
										    	painelAtual = ""
										    	return
											}
											if (painelAtual==meuIDMenu){
												$.getJSON(urlPreparacao,{
											        method		: "recPainelIrmao",
											        paciente	: codPacienteValor,
											        idPainel	: painelAtual,
											        codCID		: codCID,
											        ficha 		: ficha,
											        fichaSeq	: fichaSeq,
											        dataPEP		: dataPEP
											    },function(retorno){
											    	if (retorno.sequencia){
								        				meuID = retorno.sequencia
									        			meuIDMenu = retorno.sequencia
												    	abrePainel(meuID,"")
											    	}else{
												    	fechaPanel = true
												    	painelAtual = ""
														carregaGauges()		
												    	openPesquisa.hide()
											    	}
											    })
												return
											}
									    });					    
								    }else{
											if (sairMenu){
										    	fechaPanel = true
										    	painelAtual = ""
												carregaGauges()		
										    	openPesquisa.hide()
										    	return
											}
											if (painelAtual==meuIDMenu){
												$.getJSON(urlPreparacao,{
											        method		: "recPainelIrmao",
											        paciente	: codPacienteValor,
											        idPainel	: painelAtual,
											        codCID		: codCID,
											        ficha 		: ficha,
											        fichaSeq	: fichaSeq,
											        dataPEP		: dataPEP
											    },function(retorno){
											    	if (retorno.sequencia){
								        				meuID = retorno.sequencia
									        			meuIDMenu = retorno.sequencia
												    	abrePainel(meuID,"")
											    	}else{
												    	fechaPanel = true
														carregaGauges()		
												    	openPesquisa.hide()
											    	}
											    })
												return
											}
								    }
							    })
						    },
					        dragEnabled: false,
					        closeOnOutsideClick: false,
							toolbarItems: [{
								location:"before",
								toolbar :"top",
							},{
								widget: "dxButtonGroup",
								location:"after",
								toolbar :"top",
								options: { 
				        			elementAttr:{
					        			class: "btHistLimp"
				        			},						
									height	: "25px",
									items:[{
										text: "Evolução",
										icon: "far fa-list-alt",
										hint: "Evolução"
									},{
										icon: "fas fa-book-medical",
										hint: "Exibir passagens anteriores do paciente"
									},{
										icon: "fas fa-eraser",
										hint: "Limpar dados preenchidos"
									}],
		                			onItemClick : function(obj){
			                			if (obj.itemIndex==0){
			                				exibirEvolucao(3)
			                			}
			                			if (obj.itemIndex==1){
			                				abreHistorico()
			                			}
			                			if (obj.itemIndex==2){
			                				limparCampos("")
			                			}
			                		}
								}
								/*widget: "dxButton",
								location:"after",
								toolbar :"top",
								options: { 
				        			elementAttr:{
					        			class: "btLimpar"
				        			},						
									height	: "25px",
									width	: "100px",
									type	: "default",
									icon	: "clear",
									hint	: "Excluir dados preenchidos",
		                			text	: "Limpar", 
		                			onClick : function(){
			                			limparCampos("")
			                		}
								}*/
							},{
								widget: "dxButton",
								location:"before",
								toolbar:"bottom",
								options: { 
									width	: "90px",
									type	: "default",
									icon	: "close",
		                			text	: "Fechar",  //Sair
		                			onClick : function(){
        							    if (idRetorno=="" && $("#openPesquisa").html()!=""){
									    	$("#openPesquisa").dxPopup("hide");
									    	return;
									    }
			                			sairMenu = 1
			                			voltar = painelAnteriorArray.pop()
			                			painelAtual = painelAnteriorArray[painelAnteriorArray.length-1]
			                			painelAnterior = painelAnteriorArray[painelAnteriorArray.length-1]
			                			verificaRegrasPainel(voltar,"","","",1)
			                		}
								}
							},{
								template: "<div id='btnPopupCenter'></div>",
								location:"center",
								toolbar:"bottom",
							},{
								widget: "dxButton",
								location:"after",
								toolbar:"bottom",
								options: { 
									visible	: false,
									width	: "90px",
									type	: "default",
									icon	: "check",
		                			text	: "Ok", 
		                			onClick : function(obj){
			                			if (obj.element[0].innerText=="Próximo"){
								            var abas = $("#detalhesTabs").dxTabs("instance")
								            abaAtual = abas.option("selectedIndex")
								            totalAbas = abas.option("items").length-1
								            if (abaAtual==totalAbas) return
								            abas.option("selectedIndex",painelIndexAtual+1)
							    			
			                				return
			                			}
			                			if (obj.element[0].innerText=="Prescrever"){
								            //alert()
								            //carregaLinhaTratamento(codPacienteValor)
							    			//Alteração da PRescrição - 29/11/2021
							    			//Bloqueada a Linha Abaixo e Inserido a abreTratamento()
							    			//carregaSugestaoPrescricao(obj.component._options.sequencia)
			                				abreTratamento()
			                				return
			                			}
			                			if (obj.element[0].innerText=="Regimes Terapêuticos"){
			                				abrePainelSub(obj.component._options.sequencia,'','')
			                				return
			                			}
			                			if (obj.element[0].innerText=="Intercorrência"){
			                				$("#dvAddIntercorrencia").css("z-index",20320);
											$("#dvAddIntercorrencia").dxPopup("show");
			                				dSIntercorrencia.reload();
											objFormAddIntercorrencia = $("#formAddIntercorrencia").dxForm("instance");
											objFormAddIntercorrencia.getEditor("sequencia").option("value", "");
											objFormAddIntercorrencia.getEditor("data").option("value", "");
											objFormAddIntercorrencia.getEditor("ocorrencia").option("value", "");
			                				return
			                			}
			                			if (obj.element[0].innerText=="Gravar"){
											var result = DevExpress.ui.dialog.confirm("Deseja dar continuidade na conduta terapêutica?", "Conduta Terapêutica");
										    result.done(function(dialogResult) {
											    selecionaOpcaoTratamento()
										    })
			                				
			                			}
			                			if (painelAtual==1290){
				                			sairMenu = 1
				                			verificaRegrasPainel("","","","",1)
				                			return
			                			}
			                			sairMenu = 0
			                			verificaRegrasPainel(idRetorno)
			                		}
								}
							}],			        
					    }		
				     }
				    if ($("#openPesquisa").html()!=""){
				    	pesquisaExames.dispose()
				    	openPesquisa.dispose()
				    }
		   			$("#openPesquisa").addClass("Layout"+layout)
		   			$("#openPesquisa").removeClass("colorAtendimentoMenu")
		   			$("#openPesquisa").removeClass("colorCondutaMenu")
		   			$("#openPesquisa").removeClass("colorTratamentoMenu")
		   			//if (estilo==""||estilo==undefined) estilo = "colorAtendimentoMenu"
		   			$("#openPesquisa").addClass(estilo)
	   				$("#openPesquisa").css({"position":"relative","zIndex":2000}).html("<div id='pesquisaExames'></div>")
	   				openPesquisa = $("#openPesquisa").dxPopup(popupOptions).dxPopup("instance")
				    if (codCID == "C90.0" && id == 1319 && rBloCondTera == 1 ) {
					  setTimeout(function(){  
					    abrePainelSub("regimeTerapeutico","","","","")
					  }, 1);
					  return;
				    }				    
					preparaPainel(retornoPainel)
		   			//dx-overlay-content dx-popup-normal dx-resizable
		   			$("#openPesquisa>div>div").css("border-radius","")
		   			$("#openPesquisa>div>div").css("border-color","")
					fechaPanel = false
			    })
			    $.ajaxSetup({async: true});
				
			}, 5);
		}		
		
		function selecionaOpcaoTratamento(){

			 popupOptions = {
		        width		: "550px",
		        height		: "150px",
		        showTitle	: true,
		        title		:"Qual tipo de prescrição?",
		        shading		: true,
		        visible		: true,
		        dragEnabled	: true,
		        closeOnOutsideClick: false,
		    }		
		    if ($("#openPesquisa").html()!=""){
		    	pesquisaExames.dispose()
		    	openPesquisa.dispose()
		    }
		    $("#openPesquisa").removeClass("Layout"+layout)
   			$("#openPesquisa").removeClass("colorAtendimentoMenu")
   			$("#openPesquisa").removeClass("colorCondutaMenu")
   			$("#openPesquisa").removeClass("colorTratamentoMenu")
   			$("#openPesquisa").css({"position":"relative","zIndex":995}).html("<div id='pesquisaExames'></div>")
			openPesquisa = $("#openPesquisa").dxPopup(popupOptions).dxPopup("instance")
			pesquisaExames = $("#pesquisaExames").dxForm({
				scrollingEnabled	: true,
				colCount			: 2,
				items: [{
					itemType	: "button",
					cssClass	: "btnDestaqueInicialIntermediario",
					horizontalAlignment: "center",
					buttonOptions : {
						width		: "100%",
						type	: "default",
			            text: "Conduta Terapêutica do MAPPA",
			            onClick: function() {
				            openPesquisa.hide()
				            abrePainel(1319)
			            }
					}
				},{
					itemType: "button",
					cssClass	: "btnDestaqueInicialIntermediario",
					horizontalAlignment: "center",
					buttonOptions : {
						width		: "100%",
						type	: "default",
			            text: "Prescrever seu próprio tratamento",
			            onClick: function() {
				            openPesquisa.hide()
				            abrePrescricao("")
			            }
	                }
				}]
			}).dxForm("instance")
		}
		var templatePositivoNegativo = function(obj){
			borda = ""
			ID = obj.editorOptions.Sequencia
			valor = obj.editorOptions.Valor
            if (valor==""){
	            borderYes = ""
	            borderNo = ""
            }else if (valor==1){
	            borderYes = bordaYesNo
	            borderNo = ""
            }else {
	            borderYes = ""
	            borderNo = bordaYesNo
            }
			return "<div id='"+ID+"Yes' class='btnPositivo' style='"+borderYes+"' onclick=respostaDetalhe('"+ID+"',1,2)></div>&nbsp;&nbsp;&nbsp;<div id='"+ID+"No' class='btnNegativo' style='"+borderNo+"' onclick=respostaDetalhe('"+ID+"',0,2,1)></div>"
		}
		
		var templateAbreAbaixo = function(e) {
			dxFormulario.itemOption(e.component._options.elementAttr.caminho,"visible",Number(e.value))
		    corrigeLayout()
			return true
		}
		
		function findElement(objForm,element){
			achou = findOnLevel(objForm._options.items[0].items,element)
			return achou
		}
		
		function findOnLevel(level,element){
			var level = level
			var achou=""
			for (var i=0;i<=level.length-1;i++){
				if (level[i].dataField!=undefined){
					if (level[i].dataField==element){
						achou=level[i].dataField
						return achou
					}
				}
				if (level[i].name!=undefined){
					if (level[i].name==element){
						achou=level[i].name
						return achou
					}
				}
				if (level[i].items!=undefined){
					achou = findOnLevel(level[i].items,element)
					if (achou!=0){
						if (level[i].name!=undefined){
							achou = level[i].name + "." +achou
						}else if (level[i].caption!=undefined){
							achou = level[i].caption + "." +achou
						}
						return achou
					} 
				}
			}
			if (achou!=""){
				return achou
			} 
			return achou
		}
				
		function montaDataSource(vetor){
			return new DevExpress.data.DataSource({
		        store: eval(vetor),
        		key: "Codigo",
        		group: "group"
    		});
		}
		var templateAbreAbaixoGrupo = function(e) {
			var abaixo = $(e.element).parents("#dvSelecaoAbaixoSub").length
			if (abaixo>0){
				formTemp = $("#dvSelecaoAbaixoSub").dxForm("instance")
				carregaTemplate(e,formTemp)
			}else{
				carregaTemplate(e,dxFormulario)
			}
			return true
		}
		function carregaTemplate(e,formTemp){
			var altera=0
			var imagens=""
			valor = e.value
			var valoresComposicao = 0
			if (e.component._options.elementAttr.composicao){
				valorForm = formTemp.option("formData")
				composicao = e.component._options.elementAttr.composicao
				for (i=0;i<composicao.length;i++){
					comp = composicao[i]
					valoresComposicao = valoresComposicao + Number(valorForm[comp])
				}
				valor="0"
				if (valoresComposicao) valor="1"
			}
			caminho = eval("e.component._options.elementAttr.caminho"+valor)
			if (caminho!=undefined){
				caminhoSplit = caminho.split(".")
				caminhoStr = caminhoSplit[caminhoSplit.length-1]
				caminho = findElement(formTemp,caminhoStr)
			}
			for(var nome in e.component._options.elementAttr) {
				if (nome=="composicao") continue
				if ("caminho"+valor!=nome){
					caminhoOcultar = eval("e.component._options.elementAttr."+nome)
					caminhoOcultarSplit = caminhoOcultar.split(".")
					caminhoStr = caminhoOcultarSplit[caminhoOcultarSplit.length-1]
					caminhoOcultar = findElement(formTemp,caminhoStr)
					if (formTemp.itemOption(caminhoOcultar).visible){
						if (!altera) formTemp.beginUpdate()
						altera=1
						formTemp.itemOption(caminhoOcultar,"visible",0)
					}
				}
			}	
			if (caminho!=undefined){
				if (!formTemp.itemOption(caminho).visible){
					if (!altera) formTemp.beginUpdate()
					formTemp.itemOption(caminho,"visible",1)
					if (formTemp.itemOption(caminho).imagem){
						imagens = formTemp.itemOption(caminho)
					}
					altera=1
				}
			}
			if (altera){
				lista = []
				$(".buttonsDetalhes").each(function(){
					sel = 0
					for (var i=0;i<$(this)[0].classList.length;i++){
						if ($(this)[0].classList[i]=="btnSelected"){
							sel = 1
						}
					}
					if (sel){
						lista.push($(this)[0].classList[1])
					}
				})
				scrollTop = formTemp._scrollable.scrollTop()
    			formTemp.endUpdate()
				formTemp.repaint()
				//corrigeLayout()
				//setTimeout(function(){ corrigeLayout(); }, 10);
				$(".buttonsDetalhes").removeClass("btnSelected")
				for (var i=0;i<lista.length;i++){
					id = lista[i]
					$("."+id).addClass("btnSelected")
				}
		        formTemp._scrollable.scrollBy(scrollTop)
				if (imagens){
					montaImagem(imagens,"detalhesSub",1,0)
				}else{
					if ($("#btnRodape").html()!=undefined){
			    		$("#btnRodape").dxButton("instance").dispose()
						$("#btnPopupCenter").html("")
					}
				}
			}
			return true
		}

		var templateAbreAbaixoGrupoNovo = function(e) {
			valor = e.value
			var valoresComposicao = 0
			if (e.component._options.elementAttr.composicao){
				valorForm = dxFormulario.option("formData")
				composicao = e.component._options.elementAttr.composicao
				for (i=0;i<composicao.length;i++){
					comp = composicao[i]
					valoresComposicao = valoresComposicao + Number(valorForm[comp])
				}
				valor="0"
				if (valoresComposicao) valor="1"
			}
			caminho = eval("e.component._options.elementAttr.caminho"+valor)
			for(var nome in e.component._options.elementAttr) {
				if (nome=="composicao") continue
				if ("caminho"+valor!=nome){
					caminhoOcultar = eval("e.component._options.elementAttr."+nome)
					$("."+caminhoOcultar).hide()
				}
			}	
			if (caminho!=undefined){
				$("."+caminho).show()

			}
			corrigeLayout()
			return true
		}

		var templateAbreAbaixoGrupoDesabilita = function(e) {
			scrollTop = dxFormulario._scrollable.scrollTop()
			valor = e.value
			caminho = eval("e.component._options.elementAttr.caminho"+valor)
			for(var nome in e.component._options.elementAttr) {
				if ("caminho"+valor!=nome){
					caminhoOcultar = eval("e.component._options.elementAttr."+nome)
					if (dxFormulario.itemOption(caminhoOcultar).disabled!=1){
						dxFormulario.itemOption(caminhoOcultar,"disabled",1)
					}
				}
			}	
			if (caminho!=undefined){
				dxFormulario.itemOption(caminho,"disabled",0)
			}

			

			return true
		}
		
		var templatePositivoNegativoTexto = function(obj,obj2){
			borda = ""
			ID = obj.editorOptions.Sequencia
			valor = obj.editorOptions.Valor
            if (valor==""){
	            borderYes = ""
	            borderNo = ""
            }else if (valor==1){
	            borderYes = bordaYesNo
	            borderNo = ""
            }else {
	            borderYes = ""
	            borderNo = bordaYesNo
            }
			return "<div id='"+ID+"Yes' class='btnPositivo' style='"+borderYes+"' onclick=respostaDetalhe('"+ID+"',1,2)></div>&nbsp;&nbsp;&nbsp;<div id='"+ID+"No' class='btnNegativo' style='"+borderNo+"' onclick=respostaDetalhe('"+ID+"',0,2,1)></div>"
		}
		
		function abreHistorico(pEvolucao){
		    if (typeof pEvolucao == "undefined") {
		    	pEvolucao = 0;
		    }
		    if ($("#openHistorico").html()!=""){
		    	formHistorico.dispose()
		    	openHistorico.dispose()
		    }
			$("#openHistorico").css({"position":"relative","zIndex":20001}).html("<div id='headerHistorico' class='header1' style='height:30px'></div><div id='formHistorico'></div>")
			openHistorico = $("#openHistorico").dxPopup({
		        width: '95%',
		        height: '90%',
		        showTitle: true,
		        title: "Exibir Passagens Anteriores do Paciente",
		        visible: true,
		        dragEnabled: false,
		        closeOnOutsideClick: false,
				toolbarItems: [{
					location:"before",
					toolbar :"top",
				},{
					widget: "dxButton",
					location:"before",
					toolbar:"bottom",
					options: { 
						width	: "130px",
						type	: "default",
						icon	: "close",
            			text	: "Fechar", 
            			onClick : function(){
                			openHistorico.hide()
                		}
					}
				}],			        
			}).dxPopup("instance")			
			listaResultadosExames(pEvolucao)
		}
		function limparCampos(painelLimp,subForm){
			if (painelLimp==""){
				var painelAberto = 1
				painelLimp = painelAtual
			}
			$.getJSON(urlPreparacao,{
		        method		: "recPainelName",
		        paciente	: codPacienteValor,
		        idPainel	: painelLimp,
		        codCID		: codCID,
		        abas		: $("#detalhesTabs").length
		    },function(retorno){
			    var result = DevExpress.ui.dialog.confirm("Deseja excluir os dados referente a '"+retorno.descricao+"'?", "Confirma exclusão de dados?");
			    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
			    result.done(function(dialogResult) {
			        if (!dialogResult){
				        return
					}
					$.getJSON(urlPreparacao,{
				        method		: "limpaPainel",
				        paciente	: codPacienteValor,
				        idPainel	: painelLimp,
				        codCID		: codCID,
				        ficha 		: ficha,
				        fichaSeq	: fichaSeq,
				        dataPEP		: dataPEP,
				        abas		: $("#detalhesTabs").length
				    },function(retorno){
					    if (retorno.erro){
						    DevExpress.ui.notify(retorno.mensagem, "warning", 4000);
					    }else{
						    recuperaEstadiamento(codPacienteValor)
						    //recuperaEstadiamentoBotao(codPacienteValor)
						    atualizaGauge(codPacienteValor,painelLimp)
						    if (subForm==1){
							    refreshDataSourceAreas(painelLimp)
							    abreSubOpcoes(painelLimp)
							    return
						    }
						    if (painelAberto==1){
							    tabbed = $("#detalhesTabs").length
						    	var painelAtual1 = painelAtual
						    	var painelAnterior2 = painelAnterior
						    	painelAtual = ""
						    	abrePainelSub(painelAtual1,"",retornoPainel.formul.length,tabbed)
						    	painelAnterior = painelAnterior2
						    }else{
						        carregaGauges()	
						    }
					    }
				    })
			    })
		    })
		}
		function atualizaGauge(codPacienteValor,meuId){
			return
			$.getJSON(urlPreparacao,{
		        method		: "recPercentual",
		        paciente	: codPacienteValor,
		        idPainel	: meuId,
		        codCID		: codCID,
		        ficha 		: ficha,
		        fichaSeq	: fichaSeq,
		        dataPEP		: dataPEP
		    },function(retorno){
			    meuId = retorno.idPainel
			    if (retorno.alerta==1){
				    montaAlerta(meuId,retorno.alertaTexto)
			    }else{
				    removeAlerta(meuId)
			    }
				//
				montaToolTipGauge(meuId,retorno.pendentes,retorno.percentual)
				//
			    var cor = calculaCor(retorno.percentual)
			    $("#gauge_"+meuId).dxCircularGauge({
				    value : retorno.percentual,
				    rangeContainer:{
					    ranges: [
				    		{ startValue: 0, endValue: retorno.percentual, color: cor },
				    		{ startValue: retorno.percentual, endValue: 100, color: "#FFf" }
				    	]
				    }
				})
				loadPanel.hide();
		    })
		}
		
		function montaToolTipGauge(meuId,pendentes,percentual){
			//
			var cor = calculaCor(percentual)
			if ($("#gaugeTxt_"+meuId).html()!=undefined){
				$("#gaugeTxt_"+meuId).html("<p>"+Number(percentual).toFixed(0)+"%</p>")
			}else{
			    $("#gauge_"+meuId).append("<div id='gaugeTxt_"+meuId+"' class='legendGauge"+layout+"'><p>"+Number(percentual).toFixed(0)+"%</p></div>")	    
			    $("#gauge_"+meuId).append("<div id='tooltipG_"+meuId+"' class='tooltips'></div>")
			}
			//
		 	$("#tooltipG_"+meuId).dxTooltip({
		        target: "#gaugeTxt_"+meuId,
		        elementAttr : {
			        id 		: "tooltipG_"+meuId,
			        texto	: pendentes,
			        perc	: percentual,
		        },
		        cornerRadius: 15,
		        position :"top",
		        showEvent: "mouseenter",
		        hideEvent: "mouseleave",
		        closeOnOutsideClick: true,
				contentTemplate: function(data) {
		            var cor = calculaCor($(this)[0]._options.elementAttr.perc)
		            var pendentes = ""
		            if ($(this)[0]._options.elementAttr.texto!=""){
		            	pendentes = "<table class='tbToolTip'><tr><th colspan=2>Percentual concluído por sub-grupo:</th></tr>"+
		            	$(this)[0]._options.elementAttr.texto+
		            	"</table>"
		            }
		            data.html(
		            	"<div class='ToolTip' style='color:"+cor+"'>Percentual Concluído (Geral): "+$(this)[0]._options.elementAttr.perc + "%</div>"+pendentes+""
		            	
		            );
		        }		
		    });
		    //			
		}

		function montaAlerta(meuId,texto){
		    if ($("#alert_"+meuId).html()==undefined){
		    	$("#idBoxTile"+meuId).css("background","linear-gradient(180deg,"+corAlerta+","+corAlerta+" 80%,"+corT1+" 51%)")
		    	$("#idBoxTile"+meuId).css("color",corAlertaFonte)
		    	$("#idBoxTile"+meuId).append("<i id='tooltipAlert_"+meuId+"' class='tooltips'></div>")
		    }
		 	$("#tooltipAlert_"+meuId).dxTooltip({
		        target: "#idBoxTile"+meuId,
		        elementAttr : {
			        id 		: "tooltipAlert_"+meuId,
			        texto	: texto
		        },
		        cornerRadius: 15,
		        position :"left",
		        showEvent: "mouseenter",
		        hideEvent: "mouseleave",
		        closeOnOutsideClick: true,
				contentTemplate: function(data) {
		            var pendentes = ""
		            if ($(this)[0]._options.elementAttr.texto!=""){
		            	pendentes = "<table class='tbToolTip'><tr><th colspan=3>Campos de Atenção:</th></tr>"+
		            	$(this)[0]._options.elementAttr.texto+
		            	"</table>"
		            }
		            data.html(
		            	pendentes
		            	
		            );
		        }		
		    });
		}
		
		function removeAlerta(meuId){
	    	$("#idBoxTile"+meuId).css("background","linear-gradient(180deg,"+corTerciaria+","+corTerciaria+" 80%,"+corT1+" 51%)")
	    	$("#idBoxTile"+meuId).css("color",corFonteCaixas)
		    if ($("#tooltipAlert_"+meuId).html()!=undefined){
		    	$("#tooltipAlert_"+meuId).remove()
		    }
		}
		
		function calculaCor(perc){
		    var cor = "#03c04a"
		    if (Number(perc)<80) {
			    cor = "rgb(215,215,0)"
		    }
		    if (Number(perc)<20) {
			    cor = "red"
		    }
		    return cor
		}
		function preparaPainel(objeto,tabbed){
			sairMenu = 1
			if (!tabbed){
		        pesquisaExames = $("#pesquisaExames").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
				    onContentReady		: function(e){
					    if (objeto.tabs.length<1){
			          		e.element.dxScrollable("instance").option("useNative", false);  
			          		e.element.dxScrollable("instance").option("showScrollbar","always");
					    }
				    },			        
			        width				: "100%",
			        height				: "100%",
				    scrollingEnabled	: true,
			        items: [{
				        template: (painelAtual=="TRAT"?"<div id='detalhes' class='detalhesTrat'></div>":"<div id='detalhes'></div>")
			        }]
		        }).dxForm("instance")
			}
			if (layout==2){
				$("#detalhes").empty()
				$("#btnRodape").remove()
				$("#btnPopupCenter").html("")
			}
			$("#detalhes").css("min-width","500px")
	        imagem=0
			if (objeto.formul.length>0) {
				$("#detalhes").append("<div id='detalhesFormulario' class='formularioDetalhe'>")
		        colCount = 1
   		        if (objeto.formul.dividir==1&&objeto.formul.length>10){
		        	colCount = 2
		        }
		        dxFormulario = $("#detalhesFormulario").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
			        activeStateEnabled	: true,
			        formData			: objeto.formulDados,
			        width				: "100%",
				    scrollingEnabled	: true,
				    focusStateEnabled	: true,
				    onContentReady		: function(e){
			        	e.element.dxScrollable("instance").option("useNative", false);  
			        	e.element.dxScrollable("instance").option("showScrollbar","always");
					    $(".subGrupos.invisivel").each(function(){
							$(this).hide()
						})
					    corrigeLayout()
				    },
				    alignItemLabels	: true,
				    alignItemLabelsInAllGroups : true,
			        items				: [{
				        itemType	: "group",
				        colCount	: colCount,
				        cssClass	: "formularios"+layout,
				        items		: objeto.formul,
			        }],
   					onFieldDataChanged	: function(obj){
	   					if (naoSalvar){
		   					return
	   					}
	   					if (alterarMult==0) {
		   					alterarMult = 1
		   					return
	   					}
	   					campo = obj.dataField
	   					if (campo=="SelecaoImagem") return
	   					if (campo=="SelecaoImagemBaixo") return
	   					if (campo=="anterior") return
	   					if (campo=="proximo") return
	   					if (obj.dataField.indexOf("mult-")>=0){
		   					if (obj.value==undefined){
			   					return
		   					}
	   						separado = obj.dataField.split("_")
	   						separadGroup = separado[0].split("-")[1];
			   				for (var xi=0;xi<=10;xi++){
		   						for (var i=0;i<=4;i++){
			   						if (typeof dxFormulario.getEditor("mult-"+xi+"_"+i+"_"+separado[2])=="undefined"){
				   						continue
			   						}
			   						if (i!=separado[1]||xi!=separadGroup) {
				   						alterarMult = 0
			   							dxFormulario.getEditor("mult-"+xi+"_"+i+"_"+separado[2]).option("value","")
			   						}
		   						}
			   				}
	   						campo = separado[2]
	   						alterarMult = 1
	   					}
	   					if (obj.value!=""){
							if (obj.value==true) obj.value=1
							if (obj.value==false) obj.value=0
	   					}
	   					if (obj.value==null) {
		   					obj.value = ""
	   					}
	   					//Salvar painel quando sair do campo
						$.getJSON(urlPreparacao,{
					        method		: "salvaPainel",
					        codPaciente	: codPacienteValor,
					        dataField	: campo,
					        valor		: JSON.stringify(obj.value),
					        codCID		: codCID,
					        ficha 		: ficha,
					        fichaSeq	: fichaSeq,
					        dataPEP		: dataPEP
					    },function(retorno){
						    if (retorno.alerta){
							   DevExpress.ui.notify(retorno.alerta, "warning", 4000);
							   dxFormulario.updateData(obj.dataField ,"")
							   obj.value="" 
							   return
						    }
						    if (campo == "38537^0") {
								xValor1 = new Number(JSON.stringify(obj.value));
								xValor2 = new Number(dxFormulario.getEditor("38538^0").option("value"));
								if (xValor1 > 0 && xValor2 > 0) {
									xXcalc = xValor1/xValor2;
									dxFormulario.getEditor("38539").option("value",xXcalc)	
								}
							}
						    if (campo == "38538^0") {
								xValor1 = new Number(JSON.stringify(obj.value));
								xValor2 = new Number(dxFormulario.getEditor("38537^0").option("value"));
								if (xValor1 > 0 && xValor2 > 0) {
									xXcalc = xValor2/xValor1;
									dxFormulario.getEditor("38539").option("value",xXcalc)	
								}
							}
						    if (campo == "47429^0") {
								xValor1 = new Number(JSON.stringify(obj.value));
								xValor2 = new Number(dxFormulario.getEditor("47430^0").option("value"));
								if (xValor1 > 0 && xValor2 > 0) {
									xXcalc = xValor1/xValor2;
									dxFormulario.getEditor("47431").option("value",xXcalc)	
								}
							}
						    if (campo == "47430^0") {
								xValor1 = new Number(JSON.stringify(obj.value));
								xValor2 = new Number(dxFormulario.getEditor("47429^0").option("value"));
								if (xValor1 > 0 && xValor2 > 0) {
									xXcalc = xValor2/xValor1;
									dxFormulario.getEditor("47431").option("value",xXcalc)	
								}
							}						    
							if (campo == "47405^0") {
								xValor1 = new Number(JSON.stringify(obj.value));
								xValor2 = new Number(dxFormulario.getEditor("47406^0").option("value"));
								if (xValor1 > 0 && xValor2 > 0) {
									xXcalc = xValor1/xValor2;
									dxFormulario.getEditor("47407").option("value",xXcalc)	
								}
							}
						    if (campo == "47406^0") {
								xValor1 = new Number(JSON.stringify(obj.value));
								xValor2 = new Number(dxFormulario.getEditor("47405^0").option("value"));
								if (xValor1 > 0 && xValor2 > 0) {
									xXcalc = xValor2/xValor1;
									dxFormulario.getEditor("47407").option("value",xXcalc)	
								}
							}
							if (retorno.atualizar == 1) {
									id = painelAtual;
									painelAtual = "";
									abrePainelSub(id,xSubId, xFormulario, xTabbed, xFlVoltar)
							    atualizaGauge(codPacienteValor,campo)
									recuperaEstadiamento(codPacienteValor)
									return
								}
								atualizaRespostaPai(obj,"detalhesFormulario")
						    if (retorno.campoAssociado!=""){
						    	dxFormulario.updateData(retorno.campoAssociado,retorno.valorAssociado)
						    }
						    atualizaGauge(codPacienteValor,campo)
						    recuperaEstadiamento(codPacienteValor)
						    //recuperaEstadiamentoBotao(codPacienteValor)
						    
						})
					    
	   					if (campo.indexOf("ciclo_")>=0){
							if (dxFormulario.getEditor("ciclo_inicio_1")==undefined){
								numeroCiclos = dxFormulario.getEditor("ciclo_inicio_2").option("elementAttr").numeroCiclos
							}else{
								numeroCiclos = dxFormulario.getEditor("ciclo_inicio_1").option("elementAttr").numeroCiclos
							}
		   					ciclo = campo.split("_")
		   					if (ciclo[1]=="inicio"){
			   					intervalo = dxFormulario.getEditor("ciclo_inicio_"+ciclo[2]).option("elementAttr").intervalo
			   					if (intervalo>0){
			   						var date = new Date(obj.value);
    								date.setDate(date.getDate() + Number(intervalo)-1);
			   						dxFormulario.updateData("ciclo_fim_"+ciclo[2],date)
			   					}
		   					}
		   					if (ciclo[1]=="fim"){
		   						var date = new Date(obj.value);
			   					//
			   					proxCiclo = Number(ciclo[2])+1
			   					if (proxCiclo<=numeroCiclos){
   									date.setDate(date.getDate() + 1);
		   							dxFormulario.updateData("ciclo_inicio_"+proxCiclo,date)
		   						}
		   					}
		   					if (ciclo[1]=="conclusao"){
			   					if (obj.value==0){
				   					dxFormulario.itemOption("tratamento.ciclo_"+ciclo[2]+".ciclo_inicio_"+ciclo[2],"cssClass","labelDetalhes cicloAtual")
				   					dxFormulario.itemOption("tratamento.ciclo_"+ciclo[2]+".ciclo_conclusao_"+ciclo[2],"cssClass","labelDetalhes cicloAtual")
				   					dxFormulario.itemOption("tratamento.ciclo_"+ciclo[2]+".ciclo_fim_"+ciclo[2],"cssClass","labelDetalhes cicloAtual")
			   						dxFormulario.getEditor("ciclo_fim_"+ciclo[2]).option("disabled",1)
			   						for (var i=Number(ciclo[2])+1;i<=numeroCiclos;i++){
				   						$("#cicloAtualAst"+i).html("")
				   						dxFormulario.getEditor("ciclo_inicio_"+i).option("disabled",1)
				   						dxFormulario.getEditor("ciclo_conclusao_"+i).option("disabled",1)
				   						dxFormulario.updateData("ciclo_conclusao_"+i,0)
				   						dxFormulario.getEditor("ciclo_fim_"+i).option("disabled",1)
					   					dxFormulario.itemOption("tratamento.ciclo_"+i+".ciclo_inicio_"+i,"cssClass","labelDetalhes cicloPendente")
					   					dxFormulario.itemOption("tratamento.ciclo_"+i+".ciclo_conclusao_"+i,"cssClass","labelDetalhes cicloPendente")
					   					dxFormulario.itemOption("tratamento.ciclo_"+i+".ciclo_fim_"+i,"cssClass","labelDetalhes cicloPendente")
			   						}
			   					}else{
			   						dxFormulario.getEditor("ciclo_fim_"+ciclo[2]).option("disabled",0)
			   						dxFormulario.getEditor("ciclo_inicio_"+ciclo[2]).option("disabled",0)
				   					dxFormulario.itemOption("tratamento.ciclo_"+ciclo[2]+".ciclo_inicio_"+ciclo[2],"cssClass","labelDetalhes cicloConcluido")
				   					dxFormulario.itemOption("tratamento.ciclo_"+ciclo[2]+".ciclo_conclusao_"+ciclo[2],"cssClass","labelDetalhes cicloConcluido")
				   					dxFormulario.itemOption("tratamento.ciclo_"+ciclo[2]+".ciclo_fim_"+ciclo[2],"cssClass","labelDetalhes cicloConcluido")
				   					proxCiclo = Number(ciclo[2])+1
				   					if (proxCiclo<=numeroCiclos){
					   					$("#cicloAtualAst"+proxCiclo).html("*")
					   					dxFormulario.itemOption("tratamento.ciclo_"+proxCiclo+".ciclo_inicio_"+proxCiclo,"cssClass","labelDetalhes cicloAtual")
					   					dxFormulario.itemOption("tratamento.ciclo_"+proxCiclo+".ciclo_conclusao_"+proxCiclo,"cssClass","labelDetalhes cicloAtual")
					   					dxFormulario.itemOption("tratamento.ciclo_"+proxCiclo+".ciclo_fim_"+proxCiclo,"cssClass","labelDetalhes cicloAtual")
				   						dxFormulario.getEditor("ciclo_inicio_"+proxCiclo).option("disabled",0)
				   						dxFormulario.getEditor("ciclo_conclusao_"+proxCiclo).option("disabled",0)
				   					}
			   					}
		   					}
		   					$(".ciclosAtuais").each(function(){
			   					$(this).html("")
			   				})
		   					//$(".cicloAtual")[0].firstChild.children[0].children[0].children[0].innerHTML = "*"
	   					}
   					}

			    }).dxForm("instance")
			    $(".dvPosNegTexto").dxTextArea({
					width: '100%',
					height: '30px'
					
				})
				$(".btnPositivo").dxButton({
					width	: "130px",
					type	: "success",
					icon	: "check",
        			text	: "Positivo", 
				})										            
				$(".btnNegativo").dxButton({
					width	: "130px",
					type	: "danger",
					icon	: "clear",
        			text	: "Negativo", 
				})	
				$(".btnSim").dxButton({
					icon	: "check",
        			text	: "Sim", 
				})										            
				$(".btnNao").dxButton({
					icon	: "clear",
        			text	: "Não", 
				})	
				$(".helpBt").each(function(){
					var id = $(this).attr("id")
				 	$("#"+id+"Div").dxTooltip({
				        target: "#"+id,
				        cornerRadius: 15,
				        position :"right",
				        showEvent: "mouseenter",
				        hideEvent: "mouseleave",
				        closeOnOutsideClick: true,
				    });
				})
				var botoes = $(".btnSimF").length
				if (botoes>opcoesSimNao){
					opcoesSimNao = botoes
				}
				/*if (objeto.exames){
					listaResultadosExames()
				}*/
			}
			if (objeto.imagemTexto==1) {
				imagem = 2
			}
	        if (objeto.imagem.length>0) {
		        montaImagem(objeto,"detalhes",objeto.formul.length,0)
		        imagem = 1

	        }else{
		        baseHeight = 50
		        itemMargin = 20,
		        classeTela = "boxTileDetalheSubGrupo"
		        if (objeto.blocosL.length>0){
					$("#detalhes").append("<table width=100%><tr><td><div id='detalhesBlocoLeft'></div></td><td><div id='detalhesBlocoRight'></div></td></tr></table>")
			    }
	        }
			if (objeto.imagem.length<1&&objeto.blocosL.length>0){
		        $("#detalhesBlocoLeft").dxTileView({
			        items			:	objeto.blocosL,
			        height			: 	$("#pesquisaExames").height(),
					baseItemHeight	:   baseHeight,
					itemMargin		:   itemMargin,
					baseItemWidth	: 	$("#detalhesBlocoLeft").width()-50,
				    showScrollbar	: 	true,
					direction		: 	"vertical",
					itemTemplate: function (itemData, itemIndex, itemElement) {
			            align = "center"
			            var borda = ""
			            if (itemData.Tipo=="8"){
				            if (itemData.Valor=="1"){
					            borda = "border:2px solid yellow"
				            }
			            }
		            	retorno = "<div id='divMP"+itemData.ID+"' class='"+classeTela+"' style='"+borda+"' onclick=respostaDetalhe('"+itemData.ID+"',-1,"+objeto.formul.length+")><p>"+itemData.Caption;
			            return retorno
			        },
			    }).dxTileView("instance");
			}
			if (objeto.imagem.length<1&&objeto.blocosR.length>0){
		        $("#detalhesBlocoRight").dxTileView({
			        items			:	objeto.blocosR,
			        height			: 	$("#pesquisaExames").height(),
					itemMargin		:   itemMargin,
					baseItemWidth	: 	$("#detalhesBlocoRight").width()-50,
					baseItemHeight	:   baseHeight,
				    showScrollbar	: 	true,
					direction		: 	"vertical",
					itemTemplate: function (itemData, itemIndex, itemElement) {
			            align = "center"
			            var borda = ""
			            if (itemData.Tipo=="8"){
				            if (itemData.Valor=="1"){
					            borda = "border:2px solid yellow"
				            }
			            }
		            	retorno = "<div id='divMP"+itemData.ID+"' class='"+classeTela+"' style='"+borda+"' onclick=respostaDetalhe('"+itemData.ID+"',-1,"+objeto.formul.length+")><p>"+itemData.Caption;
			            return retorno
			        },
			    }).dxTileView("instance");
			}
			if (objeto.imagem.length==0&&objeto.blocos.length>0) {
				$("#detalhes").append("<div id='detalhesBloco'>")
		        $("#detalhesBloco").dxTileView({
			        items			:	objeto.blocos,
				    height			: 	"100%",
				    width			: 	"100%",
					itemMargin		: 	20,
					baseItemHeight	: 	78,
					baseItemWidth	: 	$("#pesquisaExames").width()-50,
				    showScrollbar	: 	true,
					direction		: 	"vertical",
					itemTemplate: function (itemData, itemIndex, itemElement) {
			            align = "center"
			            if (itemData.Tipo=="2"){
				            if (itemData.Valor==""){
      				            borderYes = ""
					            borderNo = ""
				            }else if (itemData.Valor==1){
					            borderYes = bordaYesNo
					            borderNo = ""
				            }else {
					            borderYes = ""
					            borderNo = bordaYesNo
				            }
				            retorno = "<div class='boxTileDetalheSN'><p>"+itemData.Caption;
				            botao="<div id='"+itemData.ID+"Yes' class='btnSim' style='"+borderYes+"' onclick=respostaDetalhe('"+itemData.ID+"',1,"+objeto.formul.length+",1)></div>&nbsp;&nbsp;&nbsp;<div id='"+itemData.ID+"No' class='btnNao' style='"+borderNo+"' onclick=respostaDetalhe('"+itemData.ID+"',0,"+objeto.formul.length+",1)></div>"
				            retorno = retorno+"<div class='rodape' style='width:100%;text-align:"+align+";padding:5px'>"+botao+"</div></p></div>"
			            }else{
			            	retorno = "<div class='boxTileDetalhe' onclick=verificaRegrasPainel('"+itemData.ID+"')><p>"+itemData.Caption;
			            }
			            
			            return retorno
			        },
			    }).dxTileView("instance");
				$(".btnSim").dxButton({
					width	: "130px",
					height	: "30px",
					type	: "success",
					icon	: "check",
        			text	: "Sim", 
				})										            
				$(".btnNao").dxButton({
					width	: "130px",
					height	: "30px",
					type	: "danger",
					icon	: "clear",
        			text	: "Não", 
				})	
			}
			if (objeto.tabs.length>0) {
				painelAnteriorArray = []
				$("<div id='tabs'>").insertBefore("#detalhes")
				$("#tabs").append("<div id='detalhesTabs'>")
				$("#detalhes").css("height",$("#pesquisaExames").height()-30)
				$("#detalhes").css("min-width","500px")
	          	//pesquisaExames.dxScrollable("instance").option("useNative", false);  
	          	//pesquisaExames.dxScrollable("instance").option("showScrollbar","never");
				$("#pesquisaExames").addClass("bordaFormularioPrincipal")
				cancelaSelecao=1
				$("#detalhesTabs").dxTabs({
					width: function(){
						return $("#pesquisaExames")[0].offsetWidth
					},
					dataSource: objeto.tabs,
					selectedIndex: 0,
					onOptionChanged: function(e){
						if (e.name!="selectedItem"){
							return
						}
						if (cancelaSelecao==1) {
							return
						}
						if (e.value.id==e.previousValue.id){
							return
						}
						painelAnteriorArray = []
						verificaRegrasPainel(e.value.id,"","",1)
					}
				})
				verificaRegrasPainel(objeto.tabs[0].id,"",1,1)
				cancelaSelecao=0
				return
			}
			if ($("#detalhesTabs").html()==undefined){
				$("#pesquisaExames").removeClass("bordaFormularioPrincipal")
			}
		    idRetorno = objeto.pai
			if (layout==2&&meuIDMenu==painelAtual){
				idRetorno = ""
			}
		    if (idRetorno==""){
			    openPesquisa.option("toolbarItems[2].options.icon","close")
		    	openPesquisa.option("toolbarItems[2].options.text","Fechar") //Sair
		    }else{
			    openPesquisa.option("toolbarItems[2].options.icon","back")
			    openPesquisa.option("toolbarItems[2].options.text","Voltar")
		    }
		    if (objeto.formul.length>0||$(".btnSim").length>1||objeto.imagem.length>0){
			    openPesquisa.option("toolbarItems[4].options.visible",true)
		    }else{
			    openPesquisa.option("toolbarItems[4].options.visible",false)
		    }
		    openPesquisa.option("toolbarItems[4].options.width","90px")
		    if ((codCID == "C91.1" && xId == 1320) || (codCID == "C90.0" && xId == 44386)) { //Avaliação de Resposta
			    openPesquisa.option("toolbarItems[4].options.rtlEnabled",false)
			    openPesquisa.option("toolbarItems[4].options.icon","check")
			    openPesquisa.option("toolbarItems[4].options.text","Ok")
			    openPesquisa.option("toolbarItems[4].options.proximo","")
			    openPesquisa.option("toolbarItems[4].options.sequencia","")
			}else if (objeto.titulo=="Tratamento Atual"){
			    openPesquisa.option("toolbarItems[4].options.visible",true)
			    openPesquisa.option("toolbarItems[4].options.rtlEnabled",false)
			    openPesquisa.option("toolbarItems[4].options.icon","fas fa-pen")
			    openPesquisa.option("toolbarItems[4].options.width","150px")
			    openPesquisa.option("toolbarItems[4].options.text","Intercorrência")
			    //openPesquisa.option("toolbarItems[4].options.sequencia",objeto.opcoesRegimeTerapeutico)
			}else if (objeto.opcoesRegimeTerapeutico){
			    openPesquisa.option("toolbarItems[4].options.visible",true)
			    openPesquisa.option("toolbarItems[4].options.rtlEnabled",false)
			    openPesquisa.option("toolbarItems[4].options.icon","fas fa-bong")
			    openPesquisa.option("toolbarItems[4].options.width","150px")
			    openPesquisa.option("toolbarItems[4].options.text","Regimes Terapêuticos")
			    openPesquisa.option("toolbarItems[4].options.sequencia",objeto.opcoesRegimeTerapeutico)
		    }else if (objeto.opcoesTerapeuticas){
				//Alteração da PRescrição - 29/11/2021
				//Inserido a condição abaixo para bloqueio do Botão prescrição
			    openPesquisa.option("toolbarItems[4].options.visible",(xId=="TRAT"?false:true))
			    openPesquisa.option("toolbarItems[4].options.rtlEnabled",false)
			    openPesquisa.option("toolbarItems[4].options.icon","fas fa-pills")
			    openPesquisa.option("toolbarItems[4].options.text","Prescrever")
			    openPesquisa.option("toolbarItems[4].options.sequencia",objeto.opcoesTerapeuticas)
		    }else if (objeto.proximaAba&&$("#detalhesTabs").length&&$("#detalhesTabs").dxTabs("instance").option("selectedIndex")<($("#detalhesTabs").dxTabs("instance").option("items").length-1)){
			    openPesquisa.option("toolbarItems[4].options.visible",true)
			    openPesquisa.option("toolbarItems[4].options.rtlEnabled",true)
			    openPesquisa.option("toolbarItems[4].options.icon","chevronright")
			    openPesquisa.option("toolbarItems[4].options.text","Próximo")
			    openPesquisa.option("toolbarItems[4].options.proximo",objeto.proximaAba)
		    }else if (objeto.proximaAba&&$("#detalhesTabs").length&&MAPPALEAN){
			    openPesquisa.option("toolbarItems[4].options.visible",true)
			    openPesquisa.option("toolbarItems[4].options.rtlEnabled",false)
			    openPesquisa.option("toolbarItems[4].options.icon","fas fa-save")
			    openPesquisa.option("toolbarItems[4].options.width","150px")
			    openPesquisa.option("toolbarItems[4].options.text","Gravar")
			    openPesquisa.option("toolbarItems[4].options.sequencia",objeto.opcoesRegimeTerapeutico)
		    }else{
			    openPesquisa.option("toolbarItems[4].options.rtlEnabled",false)
			    openPesquisa.option("toolbarItems[4].options.icon","check")
			    openPesquisa.option("toolbarItems[4].options.text","Ok")
			    openPesquisa.option("toolbarItems[4].options.proximo","")
			    openPesquisa.option("toolbarItems[4].options.sequencia","")
		    }
		    openPesquisa.option("toolbarItems[0].html",objeto.titulo)
			
		    //
		    if (imagem){
		    	montaResumoDasInformacoes(imagem)
		    }else if (objeto.opcoesCadeiaImagens){
				if ($("#formRodape").html()!=undefined){
		    		$("#formRodape").dxForm("instance").dispose()
				}
   			    $("#btnPopupCenter").removeClass("dx-item-content dx-toolbar-item-content")
   			    $("#btnPopupCenter").html("<div id='formRodape'></div>")
				$("#formRodape").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
			        width				: "100%",
				    scrollingEnabled	: false,
				    colCount: 3,
				    formData: {
					    selecionado: Number(objeto.opcoesCadeiaImagens)
				    },
			        items: [{
				        dataField	: "anterior",
				    	itemType : "button",
				    	buttonOptions: {
					    	type	: "back",
					    	icon	: "chevronleft",
					    	onClick : function(){
						    	var obj = $("#formRodape").dxForm("instance").getEditor("selecionado")
						    	var anterior = obj._options.selectedItem.anterior
		       					if (anterior==""||anterior==null) return
							    tabbed = $("#detalhesTabs").length
							    var painelAnterior1 = painelAnterior
								abrePainelSub(anterior,"","",tabbed)
								painelAnteriorArray.pop()
								painelAnterior = painelAnterior1
						    }
				    	}
				    },{
					    cssClass	: "formRodape",
				        dataField	: "selecionado",
						label :{
							visible: false
						},
				        editorType	: "dxSelectBox",
						editorOptions : {
							height		: "26px",
							width		: "220px",
            	        	dataSource	: new DevExpress.data.DataSource({
					            store: new DevExpress.data.CustomStore({
						            loadMode: "raw",
						            load: function(args) {
					                    return $.getJSON(urlPreparacao,{
					    	            	method		:"listaCadeia",
					    	            	codCID		: codCID,
					    	            	sequencia 	: objeto.opcoesCadeiaImagens
						                },function(ret){
							                /*$(ret).each(function(){
								            	if (this.Codigo==objeto.opcoesCadeiaImagens){
									            	$("#formRodape").dxForm("instance").getEditor("anterior").option("disabled",this.anterior==""?true:false)
									            	$("#formRodape").dxForm("instance").getEditor("proximo").option("disabled",this.proximo==""?true:false)
									            	return
								            	}
								            })*/
							            });
						            }
						        })
	       					}),
	       					onValueChanged: function(obj){
		       					if (obj.value==""||obj.value==null||obj.value==undefined) return
							    tabbed = $("#detalhesTabs").length
							    var painelAnterior1 = painelAnterior
								abrePainelSub(obj.value,"","",tabbed)
								painelAnteriorArray.pop()
								painelAnterior = painelAnterior1
		       				},
    		    			valueExpr 	: "Codigo",
							displayExpr : "Descricao",
							searchEnabled : 1
						}
			        },{
				        dataField	: "proximo",
				    	itemType : "button",
				    	buttonOptions: {
					    	type	: "back",
					    	icon	: "chevronright",
					    	onClick : function(){
						    	var obj = $("#formRodape").dxForm("instance").getEditor("selecionado")
						    	var proximo = obj._options.selectedItem.proximo
		       					if (proximo==""||proximo==null) return
							    tabbed = $("#detalhesTabs").length
							    var painelAnterior1 = painelAnterior
								abrePainelSub(proximo,"","",tabbed)
								painelAnteriorArray.pop()
								painelAnterior = painelAnterior1
						    }
					    	
				    	}
				    }]
				})  
 			    
		    }
		    if ($("#detalhesSub").html()!=undefined){
			    caminho = $("#detalhesSub").attr("caminho")
			    imagens = dxFormulario.itemOption(caminho)
			    montaImagem(imagens,"detalhesSub",1,0)
		    }
			for (var property in objeto.formulDados){
				if (property.indexOf("|")>=0) continue
				if (property.indexOf("^")>=0) continue
				var texto = "vetorRadio.F"+property+"='"+objeto.formulDados[property]+"'"
				eval(texto)
			}		    
		    loadPanel.hide();

		}
	    
	    function mudaSelecaoImagem(tipo,param2){
		    if (tipo==1){
		    	var obj = dxFormulario.getEditor("SelecaoImagem")
		    	if (obj._options.selectedItem==null){
			    	var anterior = param2
		    	}else{
			    	var anterior = obj._options.selectedItem.anterior
		    	}
				if (anterior==""||anterior==null) return
				dxFormulario.updateData("SelecaoImagem",anterior)
				//abreSubOpcoes(anterior)
		    }else{
		    	var obj = dxFormulario.getEditor("SelecaoImagem")
		    	if (obj._options.selectedItem==null){
			    	var proximo = param2
		    	}else{
		    		var proximo = obj._options.selectedItem.proximo
		    	}
				if (proximo==""||proximo==null) return
				dxFormulario.updateData("SelecaoImagem",proximo)
				//abreSubOpcoes(proximo)
		    }
	    }
	    function montaImagem(objeto,origem,objetoFormul,somenteVisualiza){
			opcoesSimNao = 2
	        baseHeight = 40
	        itemMargin = 5,
	        tamanho=205,paddingLeft=100
	        widthDeta = $("#"+origem)[0].scrollWidth
	        tamImagem = 50
	        if (origem!="detalhes"){
		        tamImagem = 75
	        }
	        if (origem=="detalhesSubImagens"){
		        tamImagem = 20
	        }
	        altImagem = $("#pesquisaExames").height()-tamImagem
	        if (widthDeta<600){
		        tamanho 	= 100
		        paddingLeft = 50
	        }
	        tabbed = $("#detalhesTabs").length
	        topDist=0
	        padding=0
	        if (tabbed){
	        	topDist=40
	        	padding=0
	        }
	        
	        tamanhoImagem = (widthDeta/2)-70
	        if (widthDeta<600){
		        tamanhoImagem = tamanhoImagem + 10
	        }
			$("#"+origem).append("<div id='detalhesBlocoLeft' style='padding-left:"+paddingLeft+"px;padding-top:"+padding+"px;border:0px;position:absolute;top:"+topDist+"px;width:"+tamanho+"px'></div><div id='divMPCorpo' style='border:0px solid blue;position:absolute;top:"+topDist+"px;width:180px;left:"+(tamanhoImagem)+"px;z-index:-1;'><img id='imgCorpo' src='"+ygif+objeto.urlImagem+"' height='"+(altImagem)+"'></div><div id='detalhesBlocoRight' style='position:absolute;top:"+topDist+"px;width:"+tamanho+"px;left:"+(widthDeta - tamanho-paddingLeft)+"px;border:0px;padding-top:"+padding+"px;'></div>")
			var stringA = ""
			var stringB = ""
			for (var cont=0;cont<objeto.imagem.length;cont++){
	            align = "center"
	            var borda = ""
	            classeTela = "boxTileDetalheImagem"
	            if (objeto.imagem[cont].Tipo=="7"){
		            if (objeto.imagem[cont].Valor=="1"){
			            classeTela = "boxTileDetalheImagemBorda"
		            }
	            }
	            if (objeto.imagem[cont].lado==1){
		            stringA = stringA+"<div id='divMP"+objeto.imagem[cont].ID+"' class='"+classeTela+"' style='width:"+tamanho+"px;' "+(somenteVisualiza==1?"onclick=abreDetalheImagem('"+objeto.imagem[cont].ID+"')":"onclick=respostaDetalhe('"+objeto.imagem[cont].ID+"',-1,"+objetoFormul+")")+"><font>"+objeto.imagem[cont].Caption+"</font></div><div style='height:4px' />"
	            }else{
					stringB = stringB+"<div id='divMP"+objeto.imagem[cont].ID+"' class='"+classeTela+"' style='width:"+tamanho+"px;' "+(somenteVisualiza==1?"onclick=abreDetalheImagem('"+objeto.imagem[cont].ID+"')":"onclick=respostaDetalhe('"+objeto.imagem[cont].ID+"',-1,"+objetoFormul+")")+"><font>"+objeto.imagem[cont].Caption+"</font></div><div style='height:4px' />"
	            }
			}
			if (objeto.blocosR){
				for (var cont=0;cont<objeto.blocosR.length;cont++){
		            classeTela = "boxTileDetalheImagem"
		            if (objeto.blocosR[cont].Valor=="1"){
			            classeTela = "boxTileDetalheImagemBorda"
		            }
					stringA = stringA+"<div id='divMP"+objeto.blocosR[cont].ID+"' class='"+classeTela+"' style='width:"+tamanho+"px;' "+(somenteVisualiza==1?"onclick=abreDetalheImagem('"+objeto.blocosR[cont].ID+"')":"onclick=respostaDetalhe('"+objeto.blocosR[cont].ID+"',1,"+objetoFormul+")")+"><font>"+objeto.blocosR[cont].Caption+"</font></div><div style='height:4px' />"
				}
			}
			if (objeto.blocosL){
				for (var cont=0;cont<objeto.blocosL.length;cont++){
		            classeTela = "boxTileDetalheImagem"
		            if (objeto.blocosL[cont].Valor=="1"){
			            classeTela = "boxTileDetalheImagemBorda"
		            }
					stringB = stringB+"<div id='divMP"+objeto.blocosL[cont].ID+"' class='"+classeTela+"' style='width:"+tamanho+"px;' "+(somenteVisualiza==1?"onclick=abreDetalheImagem('"+objeto.blocosL[cont].ID+"')":"onclick=respostaDetalhe('"+objeto.blocosL[cont].ID+"',1,"+objetoFormul+")")+"><font>"+objeto.blocosL[cont].Caption+"</font></div><div style='height:4px' />"
				}
			}
			$("#detalhesBlocoLeft").html(stringA)
			$("#detalhesBlocoRight").html(stringB)
			//
			desenhar(objeto.imagem,origem)	
			if (!somenteVisualiza){    
				montaResumoDasInformacoes(1)
			}
			return 
	    }
	    
	    function abreDetalheImagem(sequencia){
		    dxFormulario.updateData("SelecaoImagem",sequencia)
		    openPesquisa3.hide()
	    }
	    
	    function montaResumoDasInformacoes(tipo){
		    //tipo = 1
			if ($("#btnRodape").html()!=undefined){
	    		$("#btnRodape").dxButton("instance").dispose()
			}
		    $("#btnPopupCenter").addClass("dx-item-content dx-toolbar-item-content")
		    $("#btnPopupCenter").html("<div id='btnRodape'></div>")
			if (tipo==2){
				$("#btnPopupCenter").html("<div id='btnRodape'></div>&nbsp;<div id='btnRodape2'></div>")
			}
			$("#btnRodape").dxButton({
				width	: "190px",
				type	: "default",
				icon	: "menu",
    			text	: "Resumo das Informações",
    			hint	: "Clique para exibir o resumo das informações inseridas", 
    			onClick : function(e){
        			exibeDiagnosticoImagem()
        		}
			}) 
			if (tipo==2){
				$("#btnRodape2").dxButton({
					width	: "190px",
					type	: "default",
					icon	: "fas fa-male",
	    			text	: "Mapa das Áreas",
	    			hint	: "Clique para exibir o mapa das áreas com alguma resposta", 
	    			onClick : function(e){
	        			exibeImagem()
	        		}
				}) 
			}
	    }
	    
	    function exibeImagem(){
			loadPanel.show();
			setTimeout(function(){ 
				$.ajaxSetup({async: false});
				$.get(urlPreparacao,{
				        method		: "recImagemAreas",
				        codPaciente	: codPacienteValor,
				        codPainel	: painelAtual,
				        dataPEP		: dataPEP,
				        codCID		: codCID,
				        ficha 		: ficha,
				        fichaSeq	: fichaSeq,
				        layout		: layout,
				        codIDMenu	: meuIDMenu,
				    },function(retorno){
					    eval("retornoPainel = "+retorno);

					    if ($("#openPesquisa3").html()!=""){
					    	openPesquisa3.dispose()
					    	pesquisaExames3.dispose()
					    }
					    $("#openPesquisa3").css({"position":"relative","z-index":"20012"}).html("<div id='pesquisaExames3'></div>")
						openPesquisa3 = $("#openPesquisa3").dxPopup({
							visible: true,
							width: 850,
							height:  570,
							position: {
								my: "center",
								at: "center",
								of: window
							},
							dragEnabled: true,
							toolbarItems: [{
									location:"before",
									toolbar :"top",
									html: "Visualizar áreas selecionadas"
								},{
									widget: "dxButton",
									location:"before",
									toolbar:"bottom",
									options: { 
										width	: "130px",
										type	: "default",
										icon	: "close",
				            			text	: "Fechar", 
				            			onClick : function(){
				                			openPesquisa3.hide()
				                		}
									}
								}]				
						}).dxPopup("instance");
					    
						pesquisaExames3 = $("#pesquisaExames3").dxForm({
							screenByWidth: function(width) {
					            return "lg";
					        },
					        width				: "100%",
					        height				: "100%",
						    scrollingEnabled	: true,
					        items: [{
						        cssClass	: "semBordas",
						        template	: "<div id='detalhesSubImagens' style='position:relative;top:-40px'></div>"
					        }]
						}).dxForm("instance")				    
					    
					    montaImagem(retornoPainel,"detalhesSubImagens",retornoPainel.formul.length,1)
					    ;
						loadPanel.hide();
						$.ajaxSetup({async: true});
				    })
			},100)
	    }
	    
	    function exibeDiagnosticoImagem(){
		    if ($("#openHistorico").html()!=""){
		    	formHistorico.dispose()
		    	openHistorico.dispose()
		    }
			$("#openHistorico").css({"position":"relative","z-index":"20012"}).html("<div id='formHistorico'></div>")
			openHistorico = $("#openHistorico").dxPopup({
		        width: '750px',
		        height: '500px',
		        showTitle: true,
		        title: "Resumo das Informações Inseridas",
		        visible: true,
		        dragEnabled: false,
		        closeOnOutsideClick: false,
				toolbarItems: [{
					location:"before",
					toolbar :"top",
				},{
					widget: "dxButton",
					location:"before",
					toolbar:"bottom",
					options: { 
						width	: "130px",
						type	: "default",
						icon	: "close",
            			text	: "Fechar", 
            			onClick : function(){
                			openHistorico.hide()
                		}
					}
				}],			        
			}).dxPopup("instance")
			//
			$.getJSON(urlPreparacao,{
				method		:"listaResultadosImagem",
				paciente	: codPacienteValor,
				codCID		: codCID,
				painelAtual : painelAtual,
				ficha 		: ficha
			},function(retorno){
				formHistorico = $("#formHistorico").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
			        width				: "100%",
			        height				: "100%",
				    scrollingEnabled	: true,
			        items: [{
				        template: "<div id='detalhesTratamento'>"+retorno.dados+"</div>"
			        }]

				}).dxForm("instance")
			})
		}
		
		function atualizaRespostaPai(obj,formPai){
			var dxFormTemp = $("#"+formPai).dxForm("instance")
		    var resp = findElement(dxFormTemp,obj.dataField)
		    if (resp!=""){
			    resp = resp.split(".")
			    for (i=0;i<=resp.length-1;i++){
				    var subResp = resp[i]
				    if (subResp.indexOf("^")>=0){
					    var resp2 = subResp.split("^")
					    var resp3 = resp2[0].split(";")
						var campoPai = resp3[0]
						var respPai = resp3[1]
						if (obj.component.getEditor(campoPai)!=undefined){
							if (!obj.component.getEditor(campoPai).option("naoAtualizaAuto")){
								obj.component.updateData(campoPai,Number(respPai))
							}
						}
				    }
			    }
		    }
		}
		
	    function corrigeLayout(){
		    $("#detalhesFormulario .dx-field-item-label-text").each(function(){
		    	texto = $(this)[0].innerText
	    		texto = texto.split("\n").join("<br>")
		    	$(this)[0].innerText = texto
		    	$(this)[0].innerHTML = texto
		    })
		    $("#detalhesFormulario .dx-field-item-help-text").each(function(){
				tamanhoCampo = $(this).prev()[0].children[0].offsetWidth
				topPai = Number($(this).prev()["0"].offsetTop)
				leftPai = Number($(this).prev()["0"].offsetLeft)
				left = Number($(this)["0"].offsetLeft)
				altura = Number($(this)["0"].offsetTop)
				$(this)[0].style.position="absolute"
				$(this)[0].style.left=leftPai+tamanhoCampo+5+"px"
				$(this)[0].style.top=topPai+3+"px"
			})
			inicializaClicksRadios()
	    }
		
		function inicializaClicksRadios(){
		    $(".dx-radiogroup:not(.conteudoRadioGroup)").off("click").on("click",function(){
			    name 	= $(this)[0].children[0].name
			    value 	= $(this)[0].children[0].value
			    if (name.indexOf("|")>=0) return
			    if (name.indexOf("^")>=0) return
			    if (eval("vetorRadio.F"+name) == value){
				    value=""
				    dxFormulario.updateData(name,"");
			    }
		    	var texto = "vetorRadio.F"+name+"='"+value+"'"
			    eval(texto)
			})
		}
			    
	    function listaResultadosExames(pEvolucao){
		    if (typeof pEvolucao == "undefined") {
		    	pEvolucao = 0;
			    xPainelAtual = painelAtual
		    }else if (pEvolucao == 0) {
			    xPainelAtual = painelAtual
		    }else{
			    xPainelAtual = 2001
			    if (codCID == "C90.0") xPainelAtual = 48255
		    }
		    selectedCampo = 0
			formHistorico = $("#formHistorico").dxDataGrid({
				dataSource: new DevExpress.data.DataSource({
					store: new DevExpress.data.CustomStore({
						load: function(args) {
				        	var d = $.Deferred();
							$.getJSON(urlPreparacao,{
								method		:"listaResultadosPEPPremium",
								paciente	: codPacienteValor,
								codCID		: codCID,
								ficha 		: ficha,
								painelAtual : xPainelAtual
							},function(retorno){
								d.resolve(retorno.dataGrid);
								$("#headerHistorico").html("Passagens Anteriores: "+retorno.header)
								$("#formHistorico").dxDataGrid("instance").option("columns",retorno.columns)
								$("#formHistorico").dxDataGrid("instance").repaint()
							});
							return d.promise();
						}					
					})
				}),
				onContentReady: function(){
					selectedCampo=0
					$(".selecionaResultado").each(function(){
						meuId = $(this).attr("id")
						texto = $(this).attr("texto")
						$(this).dxButton({
					        elementAttr : {
						        meuId	: meuId,
						        texto   : texto
					        },
							height	: "22px",
							width	: "40px",
							icon	: "check",
	            			hint	: "Clique para utilizar o resultado de exame mais recente do paciente no preenchimento do prontuário", 
	            			onClick : function(e){
								meuId = e.component._options.elementAttr.meuId
								texto = e.component._options.elementAttr.texto
		            			importaResultadoExame(meuId,texto)
		            		}
						})
					})
				},
    			onCellPrepared: function(e) {
		            if(e.rowType === "header") {
			            if (e.cellElement[0].innerText.indexOf("||")>-1){
				            texto = e.cellElement[0].innerText.split("||")[0]
				            valor = e.column.dataField
				            e.cellElement[0].innerHTML = texto+" <div id='"+valor+"' texto='"+texto+"' class='selecionaResultado'></div>"
			            }
		            }
					if (e.rowType=="data"&&e.column.dataType=="string"){
						e.cellElement[0].innerHTML = e.text
					}
		        },
				sorting:{mode:'none'},
        		allowColumnResizing	: true,
				cellHintEnabled		: true,
				//columnAutoWidth		: true,
				//columnMinWidth		: "200px",
				filterRow: { visible: false },
				hoverStateEnabled: true,
				headerFilter: {
					visible:false
				},		
				filterRow:{
					visible:false
				},
				groupPanel: {
					visible: false
				},
				width: "99%",
				height: "99%",
				paging: { enabled: false },
				showBorders: true,
				showRowLines: true,
				columnChooser: {
					enabled: false
				},
				scrolling:{
					showScrollbar: 'always',
					useNative : false
				},
				rowAlternationEnabled: true,
				wordWrapEnabled:true
			}).dxDataGrid("instance")
		}
	    
	    function templateSimNaoForm(campo,valor){
		    align = "center"
	        if (valor==""){
	            borderYes = ""
	            borderNo = ""
	        }else if (valor==1){
	            borderYes = bordaYesNo
	            borderNo = ""
	        }else {
	            borderYes = ""
	            borderNo = bordaYesNo
	        }
	        return "<div id='"+campo+"Yes' class='btnSim'  style='"+borderYes+"' onclick=respostaDetalhe('"+campo+"',1,'',1)></div>&nbsp;"+
	        	   "<div id='"+campo+"No' class='btnNao' style='"+borderNo+"' onclick=respostaDetalhe('"+campo+"',0,'',1)></div>"
		}
	    
	    function desenhar(objeto,origem){
		    var origem = origem
		    if ($("#imgCorpo").width()==0){
		    	setTimeout(function(){ desenhar(objeto,origem); }, 100);
		    	return
		    }

			var myDIVs = [];
			var myLink = [];
			var item = {}
			item.name = "divMPCorpo"
			myDIVs.push(item)
			tamanhoCorpo = $("#imgCorpo").height()
			larguraCorpo = $("#imgCorpo").width()
			for (var cont=0;cont<objeto.length;cont++){
				var coorX = objeto[cont].CoordenadaX
				var coorY = objeto[cont].CoordenadaY
				ncoorY = tamanhoCorpo*coorY/1000
				//
				calcCorpo = larguraCorpo*1000/tamanhoCorpo
				//
				ncoorX = larguraCorpo*coorX/calcCorpo
				var item = {}
				item.name = "divMP"+objeto[cont].ID+":"+(ncoorX)+";"+(ncoorY)
				myDIVs.push(item)
				var link = {}
				link.source = cont+1
				link.target = 0
				myLink.push(link)
			}
	        if (layout==1){
		        altImagem = $("#pesquisaExames").height()-10
		        largura = $("#pesquisaExames").width()+20
	        }else{
		        altImagem = $("#atendimentoClinicoDeta").height()-70
		        largura = $("#atendimentoClinicoDeta").width()+20
	        }
	        altBloco = $("#detalhesBlocoLeft").height()+50
	        altImagemCalc = altImagem-40
	        if (altBloco>altImagemCalc) {
		        altImagemCalc = altBloco
	        }
		    //$("#btnRodape").css("top",altImagemCalc)
			var nodes = myDIVs,
			links = myLink;
			tabbed = $("#detalhesTabs").length
			topDist=0
			if (tabbed){
				topDist=40
			}
			leftDist=0
			if (origem=="detalhesSub"){
				leftDist=-10
			}
  		    var svg = d3.select('#'+origem).append('svg')
			      .attr('width', largura)
			      .attr('height', altImagemCalc)
			      .attr('style', "position:absolute;z-index:-1;top:"+topDist);
				defs = svg.append('defs')
				marker = defs.append('marker')
				.attr('id','arrow')
				.attr('viewBox','0 0 10 10')
				.attr('refX','10')
				.attr('refY','5')
				.attr('markerUnits','strokeWidth')
				.attr('markerWidth','2')
				.attr('markerHeight','2')
				.attr('orient','auto');
				path = marker.append('path')
				.attr('d','M 0 0 L 10 5 L 0 10 z')
				.attr('fill',corLinha)
				
			    var force = d3.layout.force()
			      .nodes(nodes)
			      .links(links)

			    var link = svg.selectAll('.link')
			      .data(links)
			      .enter().append('line')
			      .attr('class', 'link')
			      .attr('marker-end',"url(#arrow)");

			    var node = d3.selectAll('div')
			      .data(nodes)
			    force.on('end', function() {
			      	link
			      	.attr('x1', function(d) {
				      nome = d.source.name.split(":")[0]
				      leftPai = $("#"+nome).parent()["0"].offsetLeft+leftDist
				      leftFilho = $("#"+nome)["0"].offsetLeft
				      widthFilho = $("#"+nome)["0"].offsetWidth
			          left = leftPai + leftFilho
			          if (leftPai==0){
				      	left = left + widthFilho
			          }
			          return left
			        })
			        .attr('y1', function(d) {
				        nome = d.source.name.split(":")[0]
				        topFilho = $("#"+nome)["0"].offsetTop
				        heightFilho = $("#"+nome)["0"].offsetHeight
				        topCalc = topFilho + (heightFilho/2)
			          return topCalc
			        })
			        .attr('x2', function(d) {
				      	leftOrigem = Number($("#"+d.target.name)["0"].offsetLeft)+Number($("#"+d.target.name)["0"].clientLeft)
				      	mapeamento = d.source.name.split(":")[1]
				      	mapLeft = Number(mapeamento.split(";")[0])
				      	leftCalc = leftOrigem + mapLeft+leftDist
			          return leftCalc
			        })
			        .attr('y2', function(d) {
				      	topOrigem = Number($("#"+d.target.name)["0"].offsetTop)+Number($("#"+d.target.name)["0"].clientTop)
				      	mapeamento = d.source.name.split(":")[1]
				      	mapTop = Number(mapeamento.split(";")[1])
				      	topCalc = topOrigem + mapTop - topDist
			          return topCalc
			        });
			    });
			    
			    force.start();
			    for (var i = 0; i < 100; ++i) force.tick();
			    force.stop();	
		   	 	svg.selectAll("line").sort(function (a, b) { // select the parent and sort the path's
      				return 10;                             // a is the hovered element, bring "a" to the front
  				});
		}

	    
	    
	    function respostaDetalhe(id,resp,formulario,duplaOpcao){
		    if (formulario==""&&retornoPainel.formul){
			    formulario = retornoPainel.formul.length
		    }
		    if (resp==-1){
			    if (duplaOpcao){
				    verificaRegrasPainel(id,1,formulario)
			    }else{
					verificaRegrasPainel(id,"",formulario)
			    }
			    return
		    }
			$.getJSON(urlPreparacao,{
		        method		: "salvaPainel",
		        codPaciente	: codPacienteValor,
		        dataField	: id,
		        valor		: resp,
		        codCID		: codCID,
		        ficha 		: ficha,
		        fichaSeq	: fichaSeq,
		        dataPEP		: dataPEP
		    },function(){
			    recuperaEstadiamento(codPacienteValor)
				atualizaGauge(codPacienteValor,id)
				//recuperaEstadiamentoBotao(codPacienteValor)
			})
		    if (resp==1){
		    	$("#"+id+"Yes").css("border",bordaYesNo.split(":")[1])
		    	$("#"+id+"No").css("border","")
		    }else{
			    $("#"+id+"Yes").css("border","")
				$("#"+id+"No").css("border",bordaYesNo.split(":")[1])		    
		    }
		    if (resp==1){
			    if (duplaOpcao){
				    verificaRegrasPainel(id,1,formulario)
			    }else{
					verificaRegrasPainel(id,"",formulario)
			    }
		    }else{
				if ($(".btnSim").length==1&&formulario<1){
				    if (layout==2){
						carregaAtendimentoClinico(codPacienteValor,0)
				    }
					openPesquisa.hide()
				}
		    }
	    }


	    function respostaDetalheForm(id,resp,duplaOpcao){
		    formulario = retornoPainel.formul.length
		    if (resp==-1){
			    verificaRegrasPainel(id,1,formulario)
			    return
		    }
		    
			$.getJSON(urlPreparacao,{
		        method		: "salvaPainel",
		        codPaciente	: codPacienteValor,
		        dataField	: id,
		        valor		: resp,
		        codCID		: codCID,
		        ficha 		: ficha,
		        fichaSeq	: fichaSeq,
		        dataPEP		: dataPEP
		    },function(){
			    recuperaEstadiamento(codPacienteValor)
				atualizaGauge(codPacienteValor,id)
				//recuperaEstadiamentoBotao(codPacienteValor)
			})
		    if (resp==1){
		    	$(".btn"+id+"Yes").addClass("btnSelected")
		    	$(".btn"+id+"No").removeClass("btnSelected")
		    }else{
			    $(".btn"+id+"Yes").removeClass("btnSelected")
			    $(".btn"+id+"No").addClass("btnSelected")
		    }
		    verificaRegrasPainel(id,resp,formulario)
		    return
		    if (resp==1){
			    verificaRegrasPainel(id,1,formulario)
		    }else{
			    verificaRegrasPainel(id,0,formulario)
				if ($(".btnSimF").length==1&&formulario<2){
				    if (layout==2){
						carregaAtendimentoClinico(codPacienteValor,0)
				    }
					openPesquisa.hide()
				}
		    }
	    }
	
		function confirmaDataExames(id,subId,formulario,tabbed,flVoltar){
            $.getJSON(urlPreparacao,{
                method		: "recCampoData",
                codPaciente : codPacienteValor,
		        ficha 		: ficha,
		        codCID		: codCID,
		        painel		: painelAtual
            },function(retorno){
	            if (retorno.achou==0){
	            	confirmaData=0
	            }else{
					$("#dvConfirmaDataExame").dxPopup({
						visible: true,
						title: "Confirmar a Data de Realização dos Exames",
						width: 500,
						height:  200,
						position: {
							my: "center",
							at: "center",
							of: window
						},
						onHidden: function(){
							confirmaData = 1
						},
						toolbarItems: [{
							location:"before",
							toolbar :"top",
						},{
							widget: "dxButton",
							location:"before",
							toolbar:"bottom",
							options: { 
								width	: "130px",
								type	: "default",
								icon	: "close",
		            			text	: "Fechar", 
		            			onClick : function(){
			            			$("#dvConfirmaDataExame").dxPopup("instance").hide()
		                		}
							}
						},{
							widget: "dxButton",
							location:"after",
							toolbar:"bottom",
							options: { 
								width	: "130px",
								type	: "default",
								icon	: "check",
		            			text	: "Confirmar", 
		            			onClick : function(){
			            			if (!$("#dvConfirmaDataExameDialog").dxForm("instance").validate().isValid){
				            			DevExpress.ui.notify("Campo data não pode ser maior que a data de hoje", "warning", 4000);
				            			return
			            			}
				                    $.getJSON(urlPreparacao,{
					                    method		: "gravaDataExame",
						                codPaciente : codPacienteValor,
								        ficha 		: ficha,
					                    sequencia 	: $("#dvConfirmaDataExameDialog").dxForm("instance").option("formData").Sequencia,
					                    codCID		: codCID,
								        dataExame	: JSON.stringify($("#dvConfirmaDataExameDialog").dxForm("instance").option("formData").dataExame)
				                    },function(retorno){
					                    if (retorno==1){
						                    $("#dvConfirmaDataExame").dxPopup("instance").hide()
					                    }else{
						                	DevExpress.ui.notify(retorno.mensagem, "error", 4000);    
					                    }
					                })


		                		}
							}
						}],				
						dragEnabled: true,
						contentTemplate: function(e) {
							conteudoDialog = $("<div id='dvConfirmaDataExameDialog' style='overflow-y:auto;height:500px;'></div>")
							e.append(conteudoDialog);
						},
						onContentReady : function(){
							$("#dvConfirmaDataExameDialog").dxForm({
								screenByWidth: function(width) {
						            return "lg";
						        },
						        formData		: retorno,
								items:[{
									dataField	: "dataExame",
									label		: {
										text	: "Data dos Exames"
									},
					                editorType	: "dxDateBox",	    
					                validationRules: [{ type: "required" }],        
					                editorOptions: {
					                	max				: new Date(),
					                	useMaskBehavior	: true
					                }
								}]					
							})
						}
					});

	            }
            })
		}

		function confirmaSomasCampos(id,subId,formulario,tabbed){
            $.getJSON(urlPreparacao,{
                method		: "recCampoSomas",
                codPaciente : codPacienteValor,
		        ficha 		: ficha,
		        codCID		: codCID,
		        painel		: painelAtual
            },function(retorno){
	            if (retorno.achou==0){
	            	confirmaSomas=1
	            }else{
					var result = DevExpress.ui.dialog.confirm("A soma dos percentuais é diferente de 100%. Confirma?", "Confirma diferença de Percentuais");
				    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
				    result.done(function(dialogResult) {
				        if (!dialogResult){
					        confirmaSomas=2
					        return
						}
						confirmaSomas=1
					});
					result.fail(function(dialogResult) {
						confirmaSomas=2
					})

	            }
            })
		}
		
		function verificaRegrasPainel(id,subId,formulario,tabbed,flVoltar){
			//if (formulario=="fechar"){
				confirmaData=-1
				retorno = confirmaDataExames(id,subId,formulario,tabbed,flVoltar)
				aguardaRegrasPainel(id,subId,formulario,tabbed,flVoltar)
			//}else{
			//	verificaRegrasPainel2(id,subId,formulario,tabbed,flVoltar)
			//}
		}

		function verificaRegrasPainelSomas(id,subId,formulario,tabbed,flVoltar){
			confirmaSomas=-1
			retorno = confirmaSomasCampos(id,subId,formulario,tabbed,flVoltar)
			aguardaRegrasPainelSomas(id,subId,formulario,tabbed,flVoltar)
		}
		
		function aguardaRegrasPainel(id,subId,formulario,tabbed,flVoltar){
			if (confirmaData>=0){
				verificaRegrasPainelSomas(id,subId,formulario,tabbed,flVoltar)
			}else{
				setTimeout(function(){
					aguardaRegrasPainel(id,subId,formulario,tabbed,flVoltar)
				},100)
			}
		}

		function aguardaRegrasPainelSomas(id,subId,formulario,tabbed,flVoltar){
			if (confirmaSomas>=0){
				//if (confirmaSomas==2){
				//	return
				//}
				if (formulario=="fechar"){
					if (confirmaSomas==2){
						return
					}
					fechaPanel = true
					openPesquisa.hide()
				}else{
					verificaRegrasPainel2(id,subId,formulario,tabbed,flVoltar)
				}
			}else{
				setTimeout(function(){
					aguardaRegrasPainelSomas(id,subId,formulario,tabbed,flVoltar)
				},100)
			}
		}

	    function verificaRegrasPainel2(id,subId,formulario,tabbed,flVoltar){
			//
		    if (id==""){
		    	openPesquisa.hide()
		    	return
		    }
			if (layout==2){
				if (abrirMenu!=""){
					abrePainel(abrirMenu,abreMenuResposta)
					abreMenuResposta = ""
					abrirMenu = ""
					return
				}
			    tabbed = $("#detalhesTabs").length
				abrePainelSub(id,subId,formulario,tabbed,flVoltar)
				return
				if (id!=meuIDMenu){
				}
				if (painelAtual==meuIDMenu){
					$.getJSON(urlPreparacao,{
				        method		: "recPainelIrmao",
				        paciente	: codPacienteValor,
				        idPainel	: painelAtual,
				        codCID		: codCID,
				        ficha 		: ficha,
				        fichaSeq	: fichaSeq,
				        dataPEP		: dataPEP
				    },function(retorno){
				    	if (retorno.sequencia){
	        				meuID = retorno.sequencia
		        			meuIDMenu = retorno.sequencia
					    	abrePainel(meuID,"")
				    	}else{
					    	openPesquisa.hide()
				    	}
				    })
					return
				}
			    if (opcoesSimNao<2){
				    openPesquisa.hide()
				    return
			    }
			    return
			}
			abrePainelSub(id,subId,formulario,tabbed)
	    }
	    
	    function abrePainelSub(id,subId,formulario,tabbed,flVoltar){
		    opcoesSimNao = 0
		    id = id;
		    subId = subId;
		    formulario = formulario
		    tabbed = tabbed;
		    loadPanel.show();
			if (id==1349) {
				id = 1319
			}
			xSubId = subId;
			xFormulario = formulario;
			xTabbed = tabbed;
			xFlVoltar = flVoltar;	
			if (painelAtual == id){
				return
			}
			if (painelAnterior!=painelAtual){
				painelAnteriorArray.push(painelAtual)
			}
			painelAnterior = painelAtual
			$.get(urlPreparacao,{
		        method		: "recPainel",
		        codPaciente	: codPacienteValor,
		        codPainel	: id,
		        codOpcaoPainel		: subId,
		        codCID		: codCID,
		        ficha 		: ficha,
		        fichaSeq	: fichaSeq,
		        dataPEP		: dataPEP,
		        layout		: layout,
		        codIDMenu	: meuIDMenu
		        
		    },function(retorno){
			    painelAtual = id
			    painelIndexAtual = -1
			    if ($("#detalhesTabs").html()!=undefined){
			    	painelIndexAtual = $("#detalhesTabs").dxTabs("instance").option("selectedIndex")
			    }
			    if (retorno.indexOf("~")>-1){
				    eval(retorno.split("~")[1])
				    retorno = retorno.split("~")[0]
			    }
			    retornoPainelAnt = retornoPainel
			    eval("retornoPainel = "+retorno);
			    if (retornoPainel.achou==0){
				    painelAnteriorArray.pop()
				    painelAtual=""
				    if (tabbed==1){
					    loadPanel.hide();
					    return
				    }
					if ($(".btnSimF").length>1||(retornoPainelAnt.formul.length>2)){
						retornoPainel = retornoPainelAnt
						loadPanel.hide();
					    return
					}
					if ($(".btnSimF").length<2){
						openPesquisa.hide()
					}
				    if (painelAtual==id){
					    openPesquisa.hide()
				    }
				    loadPanel.hide();
				    return
			    }
			    if (retornoPainel.blocos.length<1&&retornoPainel.formul.length<1&&retornoPainel.imagem.length<1&&retornoPainel.blocosL.length<1&&retornoPainel.tabs.length<1){
				    loadPanel.hide();
			    	return
			    }
			    idRetorno = retornoPainel.pai
				preparaPainel(retornoPainel,tabbed)
		    })
		}
	    
	    function editarResumoClinico() {
		   if (codCID == "C90.0") {
			   abrePainel(48251,"","colorAtendimentoMenu");
		   }
		   if (codCID == "C91.1") {
			   abrePainel(1998,"","colorAtendimentoMenu");
		   }
	    }
	    
	    function carregarPaciente(paciente){
			if (paciente==null||paciente==""){
				codPacienteValor = ""
				sexoPaciente = ""
				codCID = ""
				painelAtual = ""
			    $("#cdPaciente").val("")
			    $(".bodyResumo").html("<span style='cursor: pointer;' onClick='editarResumoClinico();'><span class='headerSub2'>Resumo clínico:</span> <i class='fas fa-edit'></i> </span>")
			    $(".bodyResumo").attr("title","")
			    formularioDadosGeraisExib.resetValues()
			    formularioDadosPaciente.resetValues
   				$("#idade,#inicioTrat,#ultimoAtend").html("")

			    formularioDadosPaciente.updateData("codPaciente","")
		        carregaFicha()
				return
			}
   	        loadPanel.show();
			$.getJSON(urlPreparacao,{
		        method:"recPaciente",
		        codPaciente:paciente
		    },function(retorno){
			    //console.log(retorno)
			    if (retorno.erro){
				    DevExpress.ui.notify("Paciente inválido", "warning", 4000);
		            loadPanel.hide();
				    return
			    }
			    if (formularioDadosPaciente.option("formData").codPaciente==paciente){
		            loadPanel.hide();
		            return
	            }
			    sexoPaciente = retorno.sexo
			    if (retorno.CodCID==""){
					var result = DevExpress.ui.dialog.confirm("Paciente não possuí diagnóstico cadastrado. Deseja abrir o prontuário primário do paciente?", "Abrir PEP Primário?");
				    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
					result.fail(function(dialogResult) {
						paciente = ""
						carregarPaciente("")
					})
				    result.done(function(dialogResult) {
				        if (!dialogResult){
					        paciente = ""
					        carregarPaciente("")
					        return
						}
						codPacienteValor = paciente
						montaDashboard("",0);
							
					    ficha=1
						abrePEPPrimario()
				    })
				    return
			    }
	            $("#cdPaciente").val(paciente)

	            codPacienteValor = paciente
	            montaDashboard("",0);
							
			    if ($("#openPesquisa").html()!=""){
		            openPesquisa.hide()
			    }
			    //
				var d = new Date();
				horaInicio = d.getTime();
				carregaHorario()
			    //
			    //
			    if (retorno.CodCID == "C90.0") {
				    $("#dadosPacienteTituloTexto").html("MAPPA - Discrasias Plasmáticas")
			    }else if (retorno.CodCID == "C91.1") {
				    $("#dadosPacienteTituloTexto").html("MAPPA - Leucemia Linfoide Crônica - LLC")
			    }			    
			    
				if (retorno.CodCID == "C90.0" || (YBED != "JULIO" && YBED != "JAMIL" && YBED != "PATRICIA")) {
			        MAPPALEAN = 0
				    codCID = retorno.CodCID
				    ficha = retorno.ficha
			    	$(".bodyResumo").html("<span style='cursor: pointer;' onClick='editarResumoClinico();'><span class='headerSub2'>Resumo clínico:</span> <i class='fas fa-edit'></i> "+retorno.resumo+"</span>")
			    	$(".bodyResumo").attr("title",retorno.resumo.replace("<b>","").replace("</b>",""))
					formularioDadosPaciente.option("formData", retorno)
					formularioDadosGeraisConsulta.option("formData", retorno)
					$("#idade").html(retorno.idade)
					$("#inicioTrat").html(retorno.inicioTrat)
					$("#ultimoAtend").html(retorno.ultimoAtend)
					formularioDadosGeraisExib.option("formData", retorno)
				    loadPanel.hide();
				    carregaFicha()
					return;
				}else{
		    		var result = DevExpress.ui.dialog.confirm("Deseja inserir apenas os dados para o cálculo do estadiamento?", "Ativar o LEAN MAPPA?");
					result.fail(function(dialogResult) {
				        MAPPALEAN = 0
					    codCID = retorno.CodCID
					    ficha = retorno.ficha
				    	$(".bodyResumo").html("<span style='cursor: pointer;' onClick='editarResumoClinico();'><span class='headerSub2'>Resumo clínico:</span> <i class='fas fa-edit'></i> "+retorno.resumo+"</span>")
				    	$(".bodyResumo").attr("title",retorno.resumo.replace("<b>","").replace("</b>",""))
						formularioDadosPaciente.option("formData", retorno)
						formularioDadosGeraisConsulta.option("formData", retorno)
						$("#idade").html(retorno.idade)
						$("#inicioTrat").html(retorno.inicioTrat)
						$("#ultimoAtend").html(retorno.ultimoAtend)
						formularioDadosGeraisExib.option("formData", retorno)
					    loadPanel.hide();
					    carregaFicha()
					})
				    result.done(function(dialogResult) {
				        MAPPALEAN = dialogResult?1:0
					    codCID = retorno.CodCID
					    ficha = retorno.ficha
					    $(".bodyResumo").html("<span class='headerSub2'><span style='cursor: pointer;' onClick='editarResumoClinico();'>Resumo clínico:</span> <i class='fas fa-edit'></i> "+retorno.resumo+"</span>")
				    	$(".bodyResumo").attr("title",retorno.resumo.replace("<b>","").replace("</b>",""))
						formularioDadosPaciente.option("formData", retorno)
						formularioDadosGeraisConsulta.option("formData", retorno)
						$("#idade").html(retorno.idade)
						$("#inicioTrat").html(retorno.inicioTrat)
						$("#ultimoAtend").html(retorno.ultimoAtend)
						formularioDadosGeraisExib.option("formData", retorno)
					    loadPanel.hide();
					    carregaFicha()
					    //abrePrescricao()
				    })
				}
		    })
	    }
		
		function carregaFicha(){
			if (MAPPALEAN){
				$("#descBotoes").html("Exames")
				$("#boxAtendimentoMenuBotoesPEP,#boxAtendimentoMenuBotoesPrescricao,#boxAtendimentoMenuRelatoriosBtAtestado,#boxAtendimentoMenuRelatoriosDiagnostico,#boxAtendimentoMenuRelatoriosBtDashboard").hide()
			}else{
				$("#descBotoes").html("Prontuário, receituário e exames")
				$("#boxAtendimentoMenuBotoesPEP,#boxAtendimentoMenuBotoesPrescricao,#boxAtendimentoMenuRelatoriosBtAtestado,#boxAtendimentoMenuRelatoriosDiagnostico,#boxAtendimentoMenuRelatoriosBtDashboard").show()
			}
			preparaLinhaTempo()
			if (layout==1){
				preparaPainelAcc()
			}else{
				preparaAtendimentoClinico()
			}
			resizeMe()
	    	carregaAtendimentoClinico(codPacienteValor,0)
		    recuperaEstadiamento(codPacienteValor)
   	        loadPanel.hide();
		}
		
		function carregaLinhaTratamento(codPaciente){
            //console.log(codPaciente+"|"+codCID+"|"+ficha+"|"+dataPEP+"|"+tema)
            $.getJSON(urlPreparacao,{
            	method		: "carregaLinhaTratamento",
		        paciente	: codPaciente,
		        codCID		: codCID,
		        ficha 		: ficha,
		        dataPEP		: dataPEP,
		        tema		: tema
	    	},function(result){
				//console.log(result)
		    	$("#dvLinhaTempoDesc").html(": "+result.tratamento)
		    	if (result.dados==undefined){
			    	if ($("#linhaTempoChart").css("display")!="none"){
				    	toggleLinhaTempo()
				    	$("#buttonHideLT").hide()
			    	}
		    		return
		    	}
		    	$("#buttonHideLT").show()
		    	if ($("#linhaTempoChart").css("display")=="none"){
			    	toggleLinhaTempo()
		    	}
		    	var string = ""
		    	string = "<table width='100%'><tr>"
		    	primeiro=1
		    	$(result.series).each(function(){
			    	var nome = $(this)[0].name
			    	var cor = $(this)[0].color
			    	var corf = $(this)[0].colorf
			    	if (nome!="ocultar"){
				    	if (!primeiro){
					    	string = string +"<td><div class='fas fa-caret-right setas' style='color:"+ultCor+"'></div></td>"
				    	}
			    		string = string +"<td><div class='caixaTratamento' style='background-color:"+cor+";' onclick=abreTratamento()><font style='color:"+corf+"'>"+nome+"</font></div></td>"
			    		ultCor = cor
			    		primeiro=0
			    	}
			    })
			    string = string+"</tr></table>"
		    	$("#linhaTempoChart").html(string)
				var scrollViewWidget = $("#scrollview").dxScrollView({
					direction		: "horizontal",
			        scrollByContent	: true,
			        scrollByThumb	: true,
			        showScrollbar	: "always",
			        useNative		: false
			    }).dxScrollView("instance");	        
		    	
	    	})
			
		}

		function abreTratamento(){
			$.getJSON(urlPreparacao,{
            	method	:"abreTratamento",
            	paciente: codPacienteValor,
            	codCID	: codCID,
            	ficha	: ficha,
            	dataPEP	: dataPEP
	    	},function(result){
		    	if (result.campo.valor!="x"){
			    	DevExpress.ui.notify("Tratamento iniciado nesta consulta. Não é possível alterar os ciclos.", "warning", 4000);
			    	return
		    	}
		    	abrePainel(result.campo.predecessor,0,"colorTratamentoMenu")
	    	})		
	   	}
		function atualizaTempo(){
		    //carregaAtendimentoClinico(codPacienteValor)
		    carregaGauges()		
		    recuperaEstadiamento(codPacienteValor)
		    if (layout==2){
			    carregaAtendimentoClinico(codPacienteValor,0)
			    if ($("#openPesquisa").css("display")=="block"&&painelAtual){
			    	setTimeout(function(){loadPanel.show();abrePainel(painelAtual,'',0)},100)
			    }else{
				    loadPanel.hide();
			    }
		    }else{
		    	loadPanel.hide();
		    }
		}
		
		function carregaAtendimentoClinico(paciente,tipo){
            $.get(urlPreparacao,{
            	method	:"carregaAtendimento",
            	paciente: paciente,
            	dataPEP	: dataPEP,
            	codCID	: codCID,
		        ficha 		: ficha,
		        fichaSeq	: fichaSeq,
            	layout	: layout,
            	MAPPALEAN : MAPPALEAN
	    	},function(result){
		    	eval("result = "+result);
		    	arrayAtendimentoClinico = result.array
		    	arrayAtendimentoClinicoDestaque = result.arrayDestaque
		    	tituloWindow = result.titulo //"Ficha Diagnóstico"
		    	$("#boxAtendimentoTitle").html("<div style='width: 100%;border: 0px solid red;text-align:right;' class='divMinimizarPainelDiag' onClick='minimizarPainelDiag(3);' title='Minimizar o Painel de Diagnóstico e Seguimento'><i class='fas fa-angle-left'></i></div><div id='divMinimizarPainelDiagTitle' conteudo='Diagnóstico e Seguimento'>Diagnóstico e Seguimento</div>")
		    	$("#linhaDadosGeraisConsultaCab").html(tituloWindow)
				if (layout==1){
					if (tipo==0||tipo==1){
						$("#TitledivFormAtendimentoClinico").html("Diagnóstico e Seguimento")
						boxAtendimento.option("items",result.array)
					}
					if (tipo==0||tipo==2){
						$("#boxAtendimentoDestaqueRelatorios").empty()
						if (result.arrayBaixo){
							for (var i=0;i<result.arrayBaixo.length;i++){
								linha = result.arrayBaixo[i]
								$("#boxAtendimentoDestaqueRelatorios").addClass("atendimentoDestaque")
								$("#boxAtendimentoDestaqueRelatorios").append("<div id='"+linha.dataField+"'></div>&nbsp;")
								$("#"+linha.dataField).dxButton({
							        elementAttr : {
								        tipoImp	: linha.tipoImp,
							        },
									width	: "250px",
									height	: "60px",
									icon	: linha.buttonOptions.icon,
			            			text	: linha.buttonOptions.text, 
			            			onClick : function(e){
				            			tipoImp = e.component._options.elementAttr.tipoImp
				            			title = "Relatório Diagnóstico"
				            			if (tipoImp!=0){
					            			title = "Solicitação de Tratamento"
				            			}
				            			imprimir(tipoImp,title)
				            		}
								})
							}
						}
					}
					if (tipo==0||tipo==3){		
						if (typeof boxAtendimentoDestaque!="undefined"){
							boxAtendimentoDestaque.option("items",result.arrayDestaque)							
						}
					}
					carregaGauges()		
				}
				//boxAtendimentoMenu.option("items",result.array)
				// Menu Esquerda
				montaMenu(result)
				montaBotoesCondutaTratamento(result)
				//
				// Menu Direita
				montaBotoesDiversos(result)
				montaRelatorios()
								

				//boxAtendimentoMenuRelatorios.option("items",result.arrayRelatorio)
				resizeMe()
	    	})
		}
		
		function minimizarPainelDadosGeraisMouse(pOpcao) {
			if (pOpcao == 1) {
				$("#divFormDadosGerais").css("visibility", "visible");
				$("#divFormDadosGeraisIcone").css("visibility", "hidden");
				$("#divDadosGeraisConsultaIcone").html("<i title='Fixar o Painel' class='fas fa-check-double' style='cursor:pointer;width:10px;' onClick='minimizarPainelDadosGerais(3);'></i>");
				$("#divFormDadosGerais").css("zIndex",2005);
				if (!$("#menuAcao").length) $("<div id='menuAcao'>").appendTo("body").css({"position":"absolute","zIndex":2004,"top":0,"left":0,"right":0,"bottom":0,"backgroundColor":"rgba(0,0,0,.0)"}).mouseover(function(){minimizarPainelDadosGeraisMouse(2);$(this).remove();});			
			}else{
				$("#divFormDadosGerais").css("visibility", "hidden");
				$("#divFormDadosGeraisIcone").css("visibility", "visible");
				$("#divDadosGeraisConsultaIcone").html("<i title='Expandir o Painel' class='fas fa-angle-left'></i>");
				$("#divFormDadosGerais").css("zIndex",989);
			}
		}
		
		function minimizarPainelDadosGerais(pOpcao){
			if (pOpcao == 3) pOpcao	= opcaoMenuResumo;
 			widthJanela = window.innerWidth
		 	if (pOpcao == 1) {
				$("#divFormDadosGerais").css("visibility", "hidden");
				$("#divFormDadosGeraisIcone").css("visibility", "visible");
				$("#divDadosGeraisConsultaIcone").html("<i title='Expandir o Painel' style='cursor:pointer;' class='fas fa-angle-right'></i>");
				if (opcaoMenu == 2) {
					$("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais+140)
				}else{
					$("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais-widthMenu+200)
				}
				opcaoMenuResumo = 2;
			}else{
				$("#menuAcao").remove();			
				$("#divDadosGeraisConsultaIcone").html("<i title='Minimizar o Painel' onClick='minimizarPainelDadosGerais(3);' style='cursor:pointer;' class='fas fa-angle-right'></i>");
				if (opcaoMenu == 2) {
					$("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais-35)
				}else{
					$("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais-widthMenu+30)
				}
				$("#divFormDadosGerais").css("zIndex",989);
				setTimeout(function(){ 
					opcaoMenuResumo = 1;
				},10)
			}
			if (xId!="") {
				abrePainel(xId,xSubId,xWstilo,xFlVoltar);
			}
			/*alert("Aqqui")
			console.log($("#gridResultadoExames"))
			if ($("#gridResultadoExames") != undefined) {
				console.log($("#gridResultadoExames"))
			}*/
		}
		
		
		function minimizarPainelDiagMouse(pOpcao){
			if ($("#divFormAtendimentoClinico").css("width") != "55px" &&
					$("#divFormAtendimentoClinico").css("width") != (widthMenu+"px")) return;
			if (pOpcao == 1) {
				$(".claMenuDiagnosticoIcone").css("display", "none");
				$(".claMenuDiagnosticoTexto").css("display", "inline");
				$(".divMinimizarPainelDiag").attr('Title', 'Fixar Painel de Diagnóstico e Seguimento')
				$(".divMinimizarPainelDiag").html("<i class='fas fa-check-double' onClick='minimizarPainelDiag(3);'></i>");
				$("#divFormAtendimentoClinico").css("width", widthMenu);
				$("#boxAtendimentoMenu").css("width", "200px");
				$("#boxAtendimentoTitleTratamento").html($("#boxAtendimentoTitleTratamento").attr("conteudo"));
				$("#divMinimizarPainelDiagTitle").html($("#divMinimizarPainelDiagTitle").attr("conteudo"));
				$("#divFormAtendimentoClinico").css("zIndex",2005);
				if (!$("#menuAcao").length) $("<div id='menuAcao'>").appendTo("body").css({"position":"absolute","zIndex":2004,"top":0,"left":0,"right":0,"bottom":0,"backgroundColor":"rgba(0,0,0,.0)"}).mouseover(function(){minimizarPainelDiagMouse(2);$(this).remove();});			
			}else{
				$(".claMenuDiagnosticoIcone").css("display", "block");
				$(".claMenuDiagnosticoTexto").css("display", "none");
				$(".divMinimizarPainelDiag").attr('Title', 'Expandir o Painel de Diagnóstico e Seguimento')
				$(".divMinimizarPainelDiag").html("<i class='fas fa-angle-right'></i>");
				$("#boxAtendimentoMenu").css("width", "40px");
				$("#divFormAtendimentoClinico").css("width", "55px");
				$("#boxAtendimentoTitleTratamento").html("&nbsp;");
				$("#divMinimizarPainelDiagTitle").html("&nbsp;");
				$("#divFormAtendimentoClinico").css("zIndex",990);
			}
		}
		
		function minimizarPainelDiag(pOpcao){
			if (pOpcao == 3) pOpcao	= opcaoMenu;
 			widthJanela = window.innerWidth
		 	if (pOpcao == 1) {
				$(".claMenuDiagnosticoIcone").css("display", "block");
				$(".claMenuDiagnosticoTexto").css("display", "none");
				$("#boxAtendimentoMenu").css("width", "40px");
				$("#divFormAtendimentoClinico").css("width", "55px");
				$(".divMinimizarPainelDiag").attr('Title', 'Expandir o Painel de Diagnóstico e Seguimento')
				$(".divMinimizarPainelDiag").html("<i class='fas fa-angle-right'></i>");
				//$("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais-65+30)
				if (opcaoMenuResumo == 2) {
					$("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais+140)
				}else{
					$("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais-35)
				}
				$("#divFormAtendimentoClinicoSugestao").css("left", "38px")
				$("#divFormLinhaTempo").css("width",widthJanela-widthDadosGerais-65+30)
				$("#divFormLinhaTempo").css("left", "38px")
				$("#boxAtendimentoTitleTratamento").html("&nbsp;");
				$("#divMinimizarPainelDiagTitle").html("&nbsp;");
				opcaoMenu = 2;
			}else{
				$(".claMenuDiagnosticoIcone").css("display", "none");
				$(".claMenuDiagnosticoTexto").css("display", "inline");
				$("#divFormAtendimentoClinico").css("width", widthMenu - 6);
				//$("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais-widthMenu+30)
				if (opcaoMenuResumo == 2) {
					$("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais-widthMenu+200)
				}else{
					$("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais-widthMenu+30)
				}
				$("#divFormAtendimentoClinicoSugestao").css("left", widthMenu-24)
				$("#divFormLinhaTempo").css("width",widthJanela-widthDadosGerais-widthMenu+30)
				$("#divFormLinhaTempo").css("left", widthMenu-24)
				$("#boxAtendimentoMenu").css("width", "200px");
				$(".divMinimizarPainelDiag").attr('Title', 'Minimizar o Painel de Diagnóstico e Seguimento')
				$(".divMinimizarPainelDiag").html("<i class='fas fa-angle-left'></i>");
				$("#boxAtendimentoTitleTratamento").html($("#boxAtendimentoTitleTratamento").attr("conteudo"));
				$("#divMinimizarPainelDiagTitle").html($("#divMinimizarPainelDiagTitle").attr("conteudo"));
				opcaoMenu = 1;
			}
			if (xId!="") {
				abrePainel(xId,xSubId,xWstilo,xFlVoltar);
			}
			if ($("#gridResultadoExames") != undefined) {
				///xWidthRes = new Number($("#divFormAtendimentoClinicoSugestao").css("width").split("px")[0])-100;
				$("#gridResultadoExames").dxDataGrid("instance").option("width",200);
			}
		}
		
		function montaMenu(result){
			menu = ""
			$(result.array).each(function(){
				menu += "<div id='boxAtendimentoMenu"+this.ID+"'></div>"
			})
			$("#boxAtendimentoMenu").html(menu)
			$(result.array).each(function(){
				$("#boxAtendimentoMenu"+this.ID).dxButton({
					elementAttr:{
	        			class: "botoesMenuTratamento tema"+$("#tema").prop("checked"),
	        			meuID : this.ID
					},
					width	: "200px",
					height	: "30px",
					//icon	: linha.buttonOptions.icon,
	    			//template	: "<div id='gauge_"+this.ID+"' style='position:absolute;left:2px;'></div><div class='dx-button-text' style='position:relative;left:15px;'>"+this.Caption+"</div>",
	    			//template	: "<div class='dx-button-text'>"+this.Caption+"</div>",
	    			template: "<div class='dx-button-text'><span class='claMenuDiagnosticoIcone' style='display: none; margin-top:5px!important;' title='"+this.Caption+"'><i class='"+this.icon+"' style='font-size: 20px;'></i></span><span class='claMenuDiagnosticoTexto'>"+this.Caption+"</span></div>",
	    			onClick : function(e){
						$(".botoesMenuTratamento").each(function(){
							this.style.backgroundColor = ""
						})
						e.element[0].style.backgroundColor = corBotaoSelecionado
						
	        			abrirMenu = ""
	    				meuID = e.component.option("elementAttr.meuID")
	        			meuIDMenu = meuID
	        			painelAnteriorArray = []
						abrePainel(meuID,'','colorAtendimentoMenu')
	        		}
				})
			})			
			carregaGauges()		
		}

		function montaBotoesCondutaTratamento(result){
			var botoes = ""
			$(result.arrayConduta).each(function(){
				botoes += "<div id='boxAtendimentoMenuTratamentoBt"+this.ID+"'></div>"
			})
			$("#boxAtendimentoMenuTratamento").html(botoes)
			$(result.arrayConduta).each(function(){
				$("#boxAtendimentoMenuTratamentoBt"+this.ID).dxButton({
					elementAttr:{
	        			class: "botoesMenuTratamento tema"+$("#tema").prop("checked"),
	        			meuID : this.ID
					},
					width	: "200px",
					height	: "30px",
					//icon	: linha.buttonOptions.icon,
        			//text	: this.Caption,
        			template: "<div class='dx-button-text'><span class='claMenuDiagnosticoIcone' style='display: none; margin-top:5px!important;' title='"+this.Caption+"'><i class='"+this.icon+"' style='font-size: 20px;'></i></span><span class='claMenuDiagnosticoTexto'>"+this.Caption+"</span></div>",
	    			onClick : function(e){
	        			painelAnteriorArray = []
						$(".botoesMenuTratamento").each(function(){
							this.style.backgroundColor = ""
						})
						e.element[0].style.backgroundColor = corBotaoSelecionado
            			abrirMenu = ""
        				meuID = e.component.option("elementAttr.meuID")
	        			meuIDMenu = meuID
						abrePainel(meuID,'','colorCondutaMenu')
            		}
				})
			})
		}
		
		function montaBotoesDiversos(result){
			diversos = ""
			diversos += "<div id='boxAtendimentoMenuBotoesPEP' style='margin-left:2px;margin-right:2px;"+(MAPPALEAN?"display:none":"")+"'></div>"
			diversos += "<div id='boxAtendimentoMenuBotoesPrescricao'  style='margin-left:2px;margin-right:2px;"+(MAPPALEAN?"display:none":"")+"'></div>"
			diversos += "<div id='boxAtendimentoMenuBotoesExames' style='margin-left:2px;margin-right:2px;'></div>"
			$("#boxAtendimentoMenuBotoes").html(diversos)
			$("#boxAtendimentoMenuBotoesPEP").dxButton({
				elementAttr:{
        			class: "botoesMenuTratamento tema"+$("#tema").prop("checked"),
        			opcao : this.opcao
				},
				width	: "210px",
				height	: "30px",
				icon	: "fas fa-notes-medical",
    			text	: "Prontuário Primário",
    			onClick : function(e){
	    			abrePEPPrimario()
				}	
			})
			$("#boxAtendimentoMenuBotoesPrescricao").dxButton({
				elementAttr:{
        			class: "botoesMenuTratamento tema"+$("#tema").prop("checked"),
        			opcao : this.opcao
				},
				width	: "210px",
				height	: "30px",
				icon	: "fas fa-pills",
    			text	: "Receituário",
    			onClick : function(e){
	    			abrePrescricao("")
				}	
			})			
			$("#boxAtendimentoMenuBotoesExames").dxButton({
				elementAttr:{
        			class: "botoesMenuTratamento tema"+$("#tema").prop("checked"),
        			opcao : this.opcao
				},
				width	: "204px",
				height	: "30px",
				icon	: "fas fa-vial",
    			text	: "Pedido de Exames",
    			onClick : function(e){
	    			abreExamesMedicos()
				}	
			})			
		}
		function montaRelatorios(){
			relatorios = ""
			relatorios += "<div id='boxAtendimentoMenuRelatoriosConsulta' icon='fas fa-notes-medical' caption='Consulta' impressao=8 size=2 style='margin-left:2px;margin-right:2px;border:0px solid red;'></div>"
			relatorios += "<div id='boxAtendimentoMenuRelatoriosDiagnostico' style='margin-left:2px;margin-right:2px;"+(MAPPALEAN?"display:none":"")+"' icon='fas fa-laptop-medical' caption='Diagnóstico' impressao=0 size=2></div>"
			relatorios += "<div id='boxAtendimentoMenuRelatoriosTratamento' icon='fas fa-bong' caption='Tratamento' impressao=9 size=2 style='margin-left:2px;margin-right:2px;'></div>"
			relatorios += "<div id='boxAtendimentoMenuRelatoriosBtAtestado' style='margin-left:2px;pmargin-right:2px;"+(MAPPALEAN?"display:none":"")+"' icon='fas fa-file-medical' caption='Atestado' impressao=6 size=2></div>"
			relatorios += "<div id='boxAtendimentoMenuRelatoriosBtDashboard' style='margin-left:2px;pmargin-right:2px;"+(MAPPALEAN?"display:none":"")+"' icon='fas fa-tachometer-alt' caption='Analytics' impressao='Dashboard' size=2></div>"
			$("#boxAtendimentoMenuRelatorios").html(relatorios)
			$("#boxAtendimentoMenuRelatorios div").each(function(){
				var icon = $(this).attr("icon")
				var caption = $(this).attr("caption")
				var impressao = $(this).attr("impressao")
				var size = $(this).attr("size")
				
				$("#"+this.id).dxButton({
					elementAttr:{
	        			class: "botoesMenuRelatorios tema"+$("#tema").prop("checked"),
	        			impressao : impressao
					},
					width	: (size==2?"100px":"210px"),
					height	: "30px",
					icon	: icon,
        			text	: caption,
        			onClick : function(e){
	        			title=e.component._options.text
            			impressao = e.component.option("elementAttr.impressao")
            			if (impressao == "Dashboard") {
		            		montaDashboard("",1)
		            		//abrePainel("Dashboard","","colorAtendimentoMenu")
	            			return	
            			}
            			if (impressao==9){
	            			abreDadosTratamento(impressao,title)
            			}else{
        					imprimir(impressao,title)
            			}
            		}
				})

			})
			relatoriosIcone = ""
			relatoriosIcone += "<div id='boxAtendimentoMenuRelatoriosConsultaIcone' icon='fas fa-notes-medical' caption='Consulta' impressao=8 size=2 style='margin-left:2px;margin-right:2px;border:0px solid red;'></div>"
			relatoriosIcone += "<div id='boxAtendimentoMenuRelatoriosDiagnosticoIcone' style='margin-left:2px;margin-right:2px;"+(MAPPALEAN?"display:none":"")+"' icon='fas fa-laptop-medical' caption='Diagnóstico' impressao=0 size=2></div>"
			relatoriosIcone += "<div id='boxAtendimentoMenuRelatoriosTratamentoIcone' icon='fas fa-bong' caption='Tratamento' impressao=9 size=2 style='margin-left:2px;margin-right:2px;'></div>"
			relatoriosIcone += "<div id='boxAtendimentoMenuRelatoriosBtAtestadoIcone' style='margin-left:2px;pmargin-right:2px;"+(MAPPALEAN?"display:none":"")+"' icon='fas fa-file-medical' caption='Atestado' impressao=6 size=2></div>"
			relatoriosIcone += "<div id='boxAtendimentoMenuRelatoriosBtDashboardIcone' style='margin-left:2px;pmargin-right:2px;"+(MAPPALEAN?"display:none":"")+"' icon='fas fa-tachometer-alt' caption='Analytics' impressao='Dashboard' size=2></div>"
			$("#boxAtendimentoMenuRelatoriosIcone").html(relatoriosIcone)
			$("#boxAtendimentoMenuRelatoriosIcone div").each(function(){
				var icon = $(this).attr("icon")
				var caption = $(this).attr("caption")
				var impressao = $(this).attr("impressao")
				var size = $(this).attr("size")
				$("#"+this.id).dxButton({
					elementAttr:{
	        			class: "botoesMenuRelatorios tema"+$("#tema").prop("checked"),
	        			impressao : impressao
					},
					width	: 48,
					height	: "30px",
					icon: icon,
        			//text	: caption,
        			onClick : function(e){
	        			title=e.component._options.text
            			impressao = e.component.option("elementAttr.impressao")
            			if (impressao == "Dashboard") {
		            		montaDashboard("",1)
		            		//abrePainel("Dashboard","","colorAtendimentoMenu")
	            			return	
            			}
            			if (impressao==9){
	            			abreDadosTratamento(impressao,title)
            			}else{
        					imprimir(impressao,title)
            			}
            		}
				})
			})		
		}
		
		function abreDadosTratamento(impressao,title){
			$.getJSON(urlPreparacao,{
		        method		: "recTratamentoImpr",
		        codPaciente	: codPacienteValor,
		        codCID		: codCID,
		        ficha 		: ficha
			},function(retorno){
				if (!retorno.status){
					DevExpress.ui.notify(retorno.mensagem, "warning", 4000);
					return
				}
			    if ($("#openPesquisa3").html()!=""){
			    	openPesquisa3.dispose()
			    	pesquisaExames3.dispose()
			    }
			    $("#openPesquisa3").css({"position":"relative","zIndex":10002}).html("<div id='pesquisaExames3'></div>")
				openPesquisa3 = $("#openPesquisa3").dxPopup({
					visible: true,
					width: 800,
					height:  580,
					position: {
						my: "center",
						at: "center",
						of: window
					},
					onHidden: function(){
						$("#openPesquisa3").css("z-index","994");
					},
					dragEnabled: true,
					toolbarItems: [{
							location:"before",
							toolbar :"top",
							html: "Edita Impressão de Tratamento"
						},{
							widget: "dxButton",
							location:"before",
							toolbar:"bottom",
							options: { 
								width	: "130px",
								type	: "default",
								icon	: "close",
		            			text	: "Fechar", 
		            			onClick : function(){
		                			openPesquisa3.hide()
		                		}
							}
						},{
							widget: "dxButton",
							location:"after",
							toolbar:"bottom",
							options: { 
								width	: "130px",
								type	: "default",
								icon	: "fa fa-print",
		            			text	: "Imprimir", 
		            			onClick : function(){
			            			dados = pesquisaExames3.option("formData")
									$.post(urlPreparacao,{
								        method		: "salvaImpressaoTratamento",
								        codPaciente	: codPacienteValor,
								        codCID		: codCID,
								        ficha 		: ficha,
								        dados		: JSON.stringify(dados)
									},function(retorno){
										if (!retorno.status){
											DevExpress.ui.notify(retorno.status, "error");
											return
										}
				            			imprimir(impressao,title)
									},"json")
		                		}
							}
						}]				
				}).dxPopup("instance");
				pesquisaExames3 = $("#pesquisaExames3").dxForm({
					formData : retorno,
					screenByWidth: function(width) {
			            return "lg";
			        },
			        width				: "100%",
			        height				: "100%",
				    scrollingEnabled	: true,
				    labelLocation		: 'top',
			        items: [{
						dataField	: "descricao",
						label:{
							text: "Descrição"
						},
						editorType	: "dxTextArea",
						editorOptions:{
							height: "90px"
						}
			        },{
						dataField	: "tratamento",
						label:{
							text: "Tratamento"
						},
				        editorType	: "dxDataGrid",
						editorOptions:{
							height: "180px",
							dataSource: retorno.medicamentos
						}
			        },{
						dataField	: "referencias",
						label:{
							text: "Referências"
						},
						editorType	: "dxTextArea",
						editorOptions:{
							height: "130px"
						}
			        }]
				}).dxForm("instance")
			})
		}
		
		function carregaTratamento(campo,opcao){
			
			abrePainelTratamento(campo,opcao)
			return
            $.get(urlPreparacao,{
            	method	:"carregaTratamento",
            	paciente: paciente,
            	dataPEP	: dataPEP,
            	codCID	: codCID,
		        ficha 		: ficha,
		        fichaSeq	: fichaSeq,
            	layout	: layout
	    	},function(result){
		    	eval("result = "+result);
		    	arrayAtendimentoClinicoDestaque = result.arrayDestaque
				if (tipo==0||tipo==2){
					$("#boxAtendimentoDestaqueRelatorios").empty()
					if (result.arrayBaixo){
						for (var i=0;i<result.arrayBaixo.length;i++){
							linha = result.arrayBaixo[i]
							$("#boxAtendimentoDestaqueRelatorios").addClass("atendimentoDestaque")
							$("#boxAtendimentoDestaqueRelatorios").append("<div id='"+linha.dataField+"'></div>")
							$("#"+linha.dataField).dxButton({
						        elementAttr : {
							        tipoImp	: linha.tipoImp,
						        },
								width	: "200px",
								height	: "60px",
								icon	: linha.buttonOptions.icon,
		            			text	: linha.buttonOptions.text, 
		            			onClick : function(e){
			            			tipoImp = e.component._options.elementAttr.tipoImp
			            			title = "Relatório Diagnóstico"
			            			if (tipoImp!=0){
				            			title = "Solicitação de Tratamento"
			            			}
			            			imprimir(tipoImp,title)
			            		}
							})
						}
					}
				}
	    	})
		}

		function abrePainelTratamento(id,subId){
	        if (codPacienteValor==""){
		        DevExpress.ui.notify("Informe o paciente", "warning", 4000);
		        return
	        }
			opcoesSimNao = 0
			$.get(urlPreparacao,{
		        method		: "recPainel",
		        codPaciente	: codPacienteValor,
		        codPainel	: id,
		        codOpcaoPainel	: subId,
		        dataPEP		: dataPEP,
		        codCID		: codCID,
		        ficha 		: ficha,
		        fichaSeq	: fichaSeq,
		        layout		: layout,
		        codIDMenu	: meuIDMenu
		    },function(retorno){
			    painelIndexAtual = -1
			    if ($("#detalhesTabs").html()!=undefined){
			    	painelIndexAtual = $("#detalhesTabs").dxTabs("instance").option("selectedIndex")
			    }
			    if (retorno.indexOf("~")>-1){
				    eval(retorno.split("~")[1])
				    retorno = retorno.split("~")[0]
			    }
			    eval("retornoPainel = "+retorno);
			    painelAtual = id
		     	idRetorno = retornoPainel.pai
				preparaPainelTratamento(retornoPainel)
				fechaPanel = false
				$("#boxAtendimentoDestaqueCorpo").addClass("Layout"+layout)
				//boxAtendimentoDestaque
		    })
		}		
		
		function preparaPainelTratamento(objeto,tabbed){
			opcoesSimNao = 0
			if (!tabbed){
		        pesquisaExamesTratamento = $("#boxAtendimentoDestaqueCorpo").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
			        width				: "100%",
			        height				: "100%",
				    scrollingEnabled	: true,
			        items: [{
				        cssClass: "linhaDadosTratamento",
				        template: "<div id='detalhesTratamento'></div>"
			        }]
		        }).dxForm("instance")
			}
			$("#detalhesTratamento").empty()
	        imagem=0
			if (objeto.formul.length>0) {
				$("#detalhesTratamento").append("<div id='detalhesFormulario' class='formularioDetalhe'>")
		        colCount = 1
		        if (objeto.formul.dividir==1&&objeto.formul.length>10){
		        	colCount = 2
		        }
		        dxFormulario = $("#detalhesFormulario").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
					screenByWidth: function(width) {
			            return "lg";
			        },
			        activeStateEnabled	: true,
			        formData			: objeto.formulDados,
			        width				: "100%",
				    scrollingEnabled	: true,
				    focusStateEnabled	: true,
				    onContentReady		: function(e){
					    $(".subGrupos.invisivel").each(function(){
							$(this).hide()
						})
					    e.component._scrollable.option("showScrollbar", "always");  
					    corrigeLayout()
				    },
				    alignItemLabels	: true,
				    alignItemLabelsInAllGroups : true,
			        items				: [{
				        itemType	: "group",
				        colCount	: colCount,
				        cssClass	: "formularios"+layout,
				        items		: objeto.formul,
			        }],
   					onFieldDataChanged	: function(obj){
	   					if (alterarMult==0) {
		   					alterarMult = 1
		   					return
	   					}
	   					campo = obj.dataField
	  					if (obj.dataField.indexOf("mult-")>=0){
		   					if (obj.value==undefined){
			   					return
		   					}
	   						separado = obj.dataField.split("_")
	   						separadGroup = separado[0].split("-")[1];
			   				for (var xi=0;xi<=10;xi++){
		   						for (var i=0;i<=4;i++){
			   						if (typeof dxFormulario.getEditor("mult-"+xi+"_"+i+"_"+separado[2])=="undefined"){
				   						continue
			   						}
			   						if (i!=separado[1]||xi!=separadGroup) {
				   						alterarMult = 0
			   							dxFormulario.getEditor("mult-"+xi+"_"+i+"_"+separado[2]).option("value","")
			   						}
		   						}
			   				}
	   						campo = separado[2]
	   						alterarMult = 1
	   					}
						if (obj.value!=""){
							if (obj.value==true) obj.value=1
							if (obj.value==false) obj.value=0
						}
	   					if (obj.value==null) {
		   					obj.value = ""
	   					}
						$.getJSON(urlPreparacao,{
					        method		: "salvaPainel",
					        codPaciente	: codPacienteValor,
					        dataField	: campo,
					        valor		: JSON.stringify(obj.value),
					        codCID		: codCID,
					        ficha 		: ficha,
					        fichaSeq	: fichaSeq,
					        dataPEP		: dataPEP
					    },function(){
						    recuperaEstadiamento(codPacienteValor)
							atualizaGauge(codPacienteValor,campo)
							//recuperaEstadiamentoBotao(codPacienteValor)
						})
   					}

			    }).dxForm("instance")
			    $(".dvPosNegTexto").dxTextArea({
					width: '100%',
					height: '30px'
					
				})
				$(".btnPositivo").dxButton({
					width	: "130px",
					type	: "success",
					icon	: "check",
        			text	: "Positivo", 
				})										            
				$(".btnNegativo").dxButton({
					width	: "130px",
					type	: "danger",
					icon	: "clear",
        			text	: "Negativo", 
				})	
				$(".btnSim").dxButton({
					icon	: "check",
        			text	: "Sim", 
				})										            
				$(".btnNao").dxButton({
					icon	: "clear",
        			text	: "Não", 
				})	
				$(".helpBt").each(function(){
					var id = $(this).attr("id")
				 	$("#"+id+"Div").dxTooltip({
				        target: "#"+id,
				        cornerRadius: 15,
				        position :"right",
				        showEvent: "mouseenter",
				        hideEvent: "mouseleave",
				        closeOnOutsideClick: true,
				    });
				})
				var botoes = $(".btnSimF").length
				if (botoes>opcoesSimNao){
					opcoesSimNao = botoes
				}
			}
			if (objeto.imagemTexto) {
				imagem = 2
			}
	        if (objeto.imagem.length>0) {
		        montaImagem(objeto,"detalhes",objeto.formul.length,0)
				imagem = 1
	        }else{
		        baseHeight = 50
		        itemMargin = 20,
		        classeTela = "boxTileDetalheSubGrupo"
		        if (objeto.blocosL.length>0){
					$("#detalhesTratamento").append("<table width=100%><tr><td><div id='detalhesBlocoLeft'></div></td><td><div id='detalhesBlocoRight'></div></td></tr></table>")
			    }
	        }
			if (objeto.blocosL.length>0){
		        $("#detalhesBlocoLeft").dxTileView({
			        items			:	objeto.blocosL,
			        height			: 	$("#pesquisaExamesTratamento").height(),
					baseItemHeight	:   baseHeight,
					itemMargin		:   itemMargin,
					baseItemWidth	: 	$("#detalhesBlocoLeft").width()-50,
				    showScrollbar	: 	true,
					direction		: 	"vertical",
					itemTemplate: function (itemData, itemIndex, itemElement) {
			            align = "center"
			            var borda = ""
			            if (itemData.Tipo=="8"){
				            if (itemData.Valor=="1"){
					            borda = "border:2px solid yellow"
				            }
			            }
		            	retorno = "<div id='divMP"+itemData.ID+"' class='"+classeTela+"' style='"+borda+"' onclick=respostaDetalhe('"+itemData.ID+"',-1,"+objeto.formul.length+")><p>"+itemData.Caption;
			            return retorno
			        },
			    }).dxTileView("instance");
			}
			if (objeto.blocosR.length>0){
		        $("#detalhesBlocoRight").dxTileView({
			        items			:	objeto.blocosR,
			        height			: 	$("#pesquisaExamesTratamento").height(),
					itemMargin		:   itemMargin,
					baseItemWidth	: 	$("#detalhesBlocoRight").width()-50,
					baseItemHeight	:   baseHeight,
				    showScrollbar	: 	true,
					direction		: 	"vertical",
					itemTemplate: function (itemData, itemIndex, itemElement) {
			            align = "center"
			            var borda = ""
			            if (itemData.Tipo=="8"){
				            if (itemData.Valor=="1"){
					            borda = "border:2px solid yellow"
				            }
			            }
		            	retorno = "<div id='divMP"+itemData.ID+"' class='"+classeTela+"' style='"+borda+"' onclick=respostaDetalhe('"+itemData.ID+"',-1,"+objeto.formul.length+")><p>"+itemData.Caption;
			            return retorno
			        },
			    }).dxTileView("instance");
			}
			if (objeto.imagem.length==0&&objeto.blocos.length>0) {
				$("#detalhesTratamento").append("<div id='detalhesBloco'>")
		        $("#detalhesBloco").dxTileView({
			        items			:	objeto.blocos,
				    height			: 	"100%",
				    width			: 	"100%",
					itemMargin		: 	20,
					baseItemHeight	: 	78,
					baseItemWidth	: 	$("#pesquisaExamesTratamento").width()-50,
				    showScrollbar	: 	true,
					direction		: 	"vertical",
					itemTemplate: function (itemData, itemIndex, itemElement) {
			            align = "center"
			            if (itemData.Tipo=="2"){
				            if (itemData.Valor==""){
      				            borderYes = ""
					            borderNo = ""
				            }else if (itemData.Valor==1){
					            borderYes = bordaYesNo
					            borderNo = ""
				            }else {
					            borderYes = ""
					            borderNo = bordaYesNo
				            }
				            retorno = "<div class='boxTileDetalheSN'><p>"+itemData.Caption;
				            botao="<div id='"+itemData.ID+"Yes' class='btnSim' style='"+borderYes+"' onclick=respostaDetalhe('"+itemData.ID+"',1,"+objeto.formul.length+",1)></div>&nbsp;&nbsp;&nbsp;<div id='"+itemData.ID+"No' class='btnNao' style='"+borderNo+"' onclick=respostaDetalhe('"+itemData.ID+"',0,"+objeto.formul.length+",1)></div>"
				            retorno = retorno+"<div class='rodape' style='width:100%;text-align:"+align+";padding:5px'>"+botao+"</div></p></div>"
			            }else{
			            	retorno = "<div class='boxTileDetalhe' onclick=verificaRegrasPainel('"+itemData.ID+"')><p>"+itemData.Caption;
			            }
			            
			            return retorno
			        },
			    }).dxTileView("instance");
				$(".btnSim").dxButton({
					width	: "130px",
					height	: "35px",
					type	: "success",
					icon	: "check",
        			text	: "Sim", 
				})										            
				$(".btnNao").dxButton({
					width	: "130px",
					height	: "30px",
					type	: "danger",
					icon	: "clear",
        			text	: "Não", 
				})	
			}
			if (objeto.tabs.length>0) {
				painelAnteriorArray = []
				$("<div id='tabs'>").insertBefore("#detalhesTratamento")
				$("#tabs").append("<div id='detalhesTabs'>")
				$("#detalhesTratamento").css("height",$("#pesquisaExamesTratamento").height()-50)
				$("#pesquisaExamesTratamento").addClass("bordaFormularioPrincipal")
				cancelaSelecao=1
				$("#detalhesTabs").dxTabs({
					width: function(){
						return $("#pesquisaExames")[0].offsetWidth
					},
					dataSource: objeto.tabs,
					selectedIndex: 0,
					onOptionChanged: function(e){
						if (e.name!="selectedItem"){
							return
						}
						if (cancelaSelecao==1) {
							return
						}
						verificaRegrasPainel(e.value.id,"","",1)
					}
				})
				verificaRegrasPainel(objeto.tabs[0].id,"",1,1)

			}
			if ($("#detalhesTabs").html()==undefined){
				$("#pesquisaExamesTratamento").removeClass("bordaFormularioPrincipal")
			}
		    idRetorno = objeto.pai
			if ($("#detalhesTabs").html()!=undefined){
			    idRetorno = ""
			}
			if (layout==2&&meuIDMenu==painelAtual){
				//idRetorno = ""
			}
		    loadPanel.hide();

		}
		
		
		function carregaGauges(){
			return
			$.getJSON(urlPreparacao,{
		        method		: "recPercentual",
		        paciente	: codPacienteValor,
		        codCID		: codCID,
		        ficha 		: ficha,
		        fichaSeq	: fichaSeq,
		        dataPEP		: dataPEP
		    },function(retorno){
			    for (var cont=0;cont<retorno.length;cont++){
				    meuId = retorno[cont].idPainel
				    alerta = retorno[cont].alerta
				    alertaTexto = retorno[cont].alertaTexto
					//
				    percentual = Number(retorno[cont].percentual)
				    pendentes = retorno[cont].pendentes
				    //
				    if (alerta==1){
						montaAlerta(meuId,alertaTexto)
				    }
				    var cor = calculaCor(percentual)
				    //
				    montaToolTipGauge(meuId,pendentes,percentual)
				    //
				    $("#gauge_"+meuId).dxCircularGauge({
					    size: {
					    	height:layout==1?28:23,
					    	width:layout==1?28:30
					    },
				        rangeContainer: {
					        offset:10,
				            ranges: [
				                { startValue: 0, endValue: percentual, color: cor },
				                { startValue: percentual, endValue: 100, color: colorRangeFinal }
				            ],
				            width:3
				        },
				        valueIndicator: {
					        color: "black",
				        	type:"triangleMarker",
				        	horizontalOrientation:"left",
				        	length	: 0,
				        	width	: 0,
				        	size	: 0,
				        	verticalOrientation:"bottom",
				    	},
				        label:{
					        visible:false
				        },
				        scale:{
					        label:{
						        visible:false
					        },
					        tick:{
						        visible:false
					        }
				        },
				        tooltip:{
					        enabled:false
				        }
					});
			    }
			})
		}
		
		function abreTelaInicial(){
			 popupOptions = {
		        width: "100%",
		        height: "100%",
		        animation: {
			      show: {
				      duration: 0  
			      }
		        },
		        showTitle: false,
		        shading: true,
		        visible: true,
		        dragEnabled: false,
		        closeOnOutsideClick: false,
		        onHiding: function(e){
			        if (codPacienteValor==null||codPacienteValor==""){
		        		e.cancel = true
		        		var result = DevExpress.ui.dialog.confirm("Deseja sair do MAPPA?", "Sair do MAPPA?");
					    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
						result.fail(function(dialogResult) {
						})
					    result.done(function(dialogResult) {
					        if (!dialogResult){
						        return
							}
							if (abreDireto){
								window.top.location.href="#($$getLoginPage^WWWLogin())#"
								return
							}
							window.close()
					    })
			        }
		        }
		    }		
		    if ($("#openPesquisa").html()!=""){
		    	pesquisaExames.dispose()
		    	openPesquisa.dispose()
		    }
		    $("#openPesquisa").removeClass("Layout"+layout)
   			$("#openPesquisa").css({"position":"relative","zIndex":995}).html("<div id='pesquisaExames'></div>")
			openPesquisa = $("#openPesquisa").dxPopup(popupOptions).dxPopup("instance")
			$.getJSON(urlPreparacao,{
				method : "verificaOpcoesIniciais"
			},function(retorno){
				var tamanhoBotao = "100%"	
				pesquisaExames = $("#pesquisaExames").dxForm({
					scrollingEnabled	: true,
	 				screenByWidth: function (width) {
			            if (width < 768)  return "xs";
			            if (width < 992)  return "sm";
			            if (width < 1200) return "md";
			            return "lg";
			        },				
					items: [{
						template: "<div class='divTitulo'>M.A.P.P.A.<br>Plataforma de Assistência de Precisão - Doenças Hematológicas</div>"
					},{
						itemType	: "group",
						colCountByScreen: {
		         		   "xs": 1, "md": 3,
		            		"sm": 2, "lg": 4
		        		},
						items: [{					
							itemType	: "button",
							cssClass	: "btnDestaqueInicial",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno["C91.1"]==1?false:true,
								width		: tamanhoBotao,
					            text		: "Leucemia Linfoide Crônica - LLC",
					            onClick: function() {
						            codCID = "C91.1" 
							        if (token==''){
								        autenticacaoBirdID()
							        }else{
								        abrePacienteNovoOuExistente()
							            //abrePesquisaPacientes()
							        }
					            }
			                }
						},{
							itemType: "button",
							cssClass	: "btnDestaqueInicial",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno["C90.0"]==1?false:true,
								width		: tamanhoBotao,
					            text: "Discrasias Plasmáticas",
					            onClick: function() {
						            codCID = "C90.0" 
							        if (token==''){
								        autenticacaoBirdID()
							        }else{
								        abrePacienteNovoOuExistente()
							            //abrePesquisaPacientes()
							        }
					            }
			                }
						},{
							itemType: "button",
							cssClass	: "btnDestaqueInicial",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno["C92.1"]==1?false:true,
								width		: tamanhoBotao,
					            text: "Leucemia Mieloide Cronica - LMC",
					            onClick: function() {
						            codCID = "C92.1" 
							        if (token==''){
								        autenticacaoBirdID()
							        }else{
								        abrePacienteNovoOuExistente()
							            //abrePesquisaPacientes()
							        }
					            }
			                }
						},{
							itemType: "button",
							cssClass	: "btnDestaqueInicial",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno.dp==1?false:true,
								width		: tamanhoBotao,
					            text: "Discrasias Plasmocitárias",
					            onClick: function() {
					            }
			                }
						},{
							itemType: "button",
							cssClass	: "btnDestaqueInicial",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno["C91.0"]==1?false:true,
								width		: tamanhoBotao,
					            text: "Leucemia Linfóide Aguda - LLA",
					            onClick: function() {
					            }
			                }
						},{
							itemType: "button",
							cssClass	: "btnDestaqueInicial",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno["C92.0"]==1?false:true,
								width		: tamanhoBotao,
					            text: "Leucemia Mieloide Aguda - LMA",
					            onClick: function() {
					            }
			                }
						},{
							itemType: "button",
							cssClass	: "btnDestaqueInicial",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno["C81"]==1?false:true,
								disabled	: true,
								width		: tamanhoBotao,
					            text: "Linfoma de Hodgkin",
					            onClick: function() {
					            }
			                }
						}]
					},{
						template : "<hr>"
					},{
						itemType	: "group",
						colCountByScreen: {
		         		   "xs": 1, "md": 3,
		            		"sm": 2, "lg": 4
		        		},
						items: [{					
						itemType: "button",
							cssClass	: "btnDestaqueInicial2",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno["D50"]==1?false:true,
								width		: tamanhoBotao,
					            text: "Anemias",
					            onClick: function() {
					            }
			                }
						},{
							itemType: "button",
							cssClass	: "btnDestaqueInicial2",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno.trombofilia==1?false:true,
								width		: tamanhoBotao,
					            text: "Trombofilia",
					            onClick: function() {
					            }
			                }
						},{
							itemType: "button",
							cssClass	: "btnDestaqueInicial2",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno.neutropenias==1?false:true,
								width		: tamanhoBotao,
					            text: "Neutropenias",
					            onClick: function() {
					            }
			                }
						},{
							itemType: "button",
							cssClass	: "btnDestaqueInicial2",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: retorno.plaquetopenia==1?false:true,
								width		: tamanhoBotao,
					            text: "Plaquetopenia",
					            onClick: function() {
					            }
			                }
						}]
					},{
						template : "<hr>"
					},{
						itemType	: "group",
						colCountByScreen: {
		         		   "xs": 1, "md": 3,
		            		"sm": 2, "lg": 4
		        		},
						items: [{					
						itemType: "button",
							cssClass	: "btnDestaqueInicial3",
							horizontalAlignment: "center",
							buttonOptions : {
								disabled	: false,
								width		: tamanhoBotao,
					            text: "Analytics",
					            onClick: function() {
						            montaDashboard("Geral",1);
					            }
			                }
						}]
					}]
						
				}).dxForm("instance")


			})
			
			
		}
		
		function abrePacienteNovoOuExistente(){
			 popupOptions = {
		        width		: "550px",
		        height		: "190px",
		        showTitle	: true,
		        title		: "Cadastro de Pacientes",
		        shading		: true,
		        visible		: true,
		        dragEnabled	: true,
		        closeOnOutsideClick: false,
		    }		
		    if ($("#openPesquisa").html()!=""){
		    	pesquisaExames.dispose()
		    	openPesquisa.dispose()
		    }
		    $("#openPesquisa").removeClass("Layout"+layout)
   			$("#openPesquisa").removeClass("colorAtendimentoMenu")
   			$("#openPesquisa").removeClass("colorCondutaMenu")
   			$("#openPesquisa").removeClass("colorTratamentoMenu")
   			$("#openPesquisa").css({"position":"relative","zIndex":995}).html("<div id='pesquisaExames'></div>")
			openPesquisa = $("#openPesquisa").dxPopup(popupOptions).dxPopup("instance")
			pesquisaExames = $("#pesquisaExames").dxForm({
				scrollingEnabled	: true,
				colCount			: 2,
				items: [{
					colSpan		: 2,
					template	: "<span style='font-size:14px;padding-bottom:6px;'>Selecione o tipo de paciente para essa consulta:"
				},{
					colSpan		: 2,
					template	: "<div style='height:5px'>&nbsp</div>"
				},{
					itemType	: "button",
					cssClass	: "btnDestaqueInicialIntermediario",
					horizontalAlignment: "center",
					buttonOptions : {
						type	: "default",
						width	: "100%",
						icon	: "fas fa-users",
			            text	: "Cadastrar novo paciente",
			            onClick: function() {
				            cadastraPaciente("")
			            }
					}
				},{
					itemType: "button",
					cssClass	: "btnDestaqueInicialIntermediario",
					horizontalAlignment: "center",
					buttonOptions : {
						type	: "default",
						width	: "100%",
						icon	: "search",
			            text	: "Abrir paciente existente",
			            onClick: function() {
				            abrePesquisaPacientes()
			            }
	                }
				}]
			}).dxForm("instance")
		}
		
		function abrePesquisaPacientes(){
			 popupOptions = {
		        width: "90%",
		        height: "90%",
		        showTitle: true,
		        title: "Lista de Pacientes",
		        visible: true,
		        dragEnabled: false,
		        closeOnOutsideClick: false,
		        onHiding: function(e){
			        if (codPacienteValor==null||codPacienteValor==""){
		        		e.cancel = true
		        		var result = DevExpress.ui.dialog.confirm("Deseja sair do MAPPA?", "Sair do MAPPA?");
					    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
						result.fail(function(dialogResult) {
						})
					    result.done(function(dialogResult) {
					        if (!dialogResult){
						        return
							}
							if (abreDireto){
								window.top.location.href="#($$getLoginPage^WWWLogin())#"
								return
							}
							window.close()
					    })
			        }
		        },
				toolbarItems: [{
						location:"before",
						toolbar :"top",
					},{
						widget: "dxButton",
						location:"before",
						toolbar:"bottom",
						options: { 
							width	: "130px",
							type	: "default",
							icon	: "close",
                			text	: "Sair", 
                			onClick : function(){
	                			openPesquisa.hide()
	                		}
						}
					},{
						widget: "dxButton",
						location:"before",
						toolbar:"bottom",
						options: { 
							width	: "140px",
							type	: "default",
							icon	: "fas fa-key",
	            			text	: "Alterar Senha", 
	            			onClick : function(){
	                			alterarSenha()
	                		}
						}
					},{
						widget: "dxButton",
						location:"before",
						toolbar:"bottom",
						options: { 
							width	: "140px",
							type	: "default",
							icon	: "fas fa-question-circle",
	            			text	: "Manual", 
	            			onClick : function(){
		            			window.open(ygif+"MAPPA/Manual_MAPPA_.pdf","manual")
	                		}
						}
					},{
						widget: "dxButton",
						location:"before",
						toolbar:"bottom",
						options: { 
							width	: "140px",
							type	: "default",
							icon	: "fas fa-file-video",
	            			text	: "Tutorial", 
	            			onClick : function(){
	                			abreTutorial()
	                		}
						}
					},{
						widget: "dxButton",
						location:"after",
						toolbar:"bottom",
						options: { 
							width	: "190px",
							type	: "default",
							icon	: "fas fa-users",
                			text	: "Novo Paciente", 
                			onClick : function(){
	                			cadastraPaciente("")
                			}
						}
					}],			        
		    }		
		    if ($("#openPesquisa").html()!=""){
		    	pesquisaExames.dispose()
		    	openPesquisa.dispose()
		    }
		    $("#openPesquisa").removeClass("Layout"+layout)
   			$("#openPesquisa").css({"position":"relative","z-index":"20010"}).html("<div id='pesquisaExames'></div>")
   			$("#openPesquisa").removeClass("colorAtendimentoMenu")
   			$("#openPesquisa").removeClass("colorCondutaMenu")
   			$("#openPesquisa").removeClass("colorTratamentoMenu")

			openPesquisa = $("#openPesquisa").dxPopup(popupOptions).dxPopup("instance")
			preparaPesquisaPacientes()
		}		
		
		function cadastraPaciente(paciente){
			loadPanel.show();
		    if ($("#openPesquisaSub").html()!=""){
		    	pesquisaExamesSub.dispose()
		    	openPesquisaSub.dispose()
		    }
		    $("#openPesquisaSub").removeClass("Layout"+layout)
   			$("#openPesquisaSub").css({"position":"relative","z-index":"20011"}).html("<div id='pesquisaExamesSub'></div>")
			preparaCadastraPaciente(paciente)
			
		}
		
		function preparaCadastraPaciente(paciente){
	        $.getJSON(urlPreparacao,{
	            method:"getPacienteCadastro",
	            codigo: paciente
	        },function(retorno){
			    if (retorno.erro){
				    DevExpress.ui.notify("Paciente inválido", "warning", 4000);
			    }
		        if (retorno.cid==undefined) {
			        retorno.cid = codCID
		        }
		    	pesquisaExamesSub = $("#pesquisaExamesSub").dxForm({
					screenByWidth: function(width) {
			            return "lg";
			        },
			    	formData	: retorno,
			    	onContentReady: function(){
	    				openPesquisaSub = $("#openPesquisaSub").dxPopup({
					        width: '95%',
					        height: '90%',
					        showTitle: true,
					        title: "Cadastra Pacientes",
					        visible: true,
					        dragEnabled: false,
					        closeOnOutsideClick: false,
							toolbarItems: [{
								location:"before",
								toolbar :"top",
							},{
								widget: "dxButton",
								location:"before",
								toolbar:"bottom",
								options: { 
									width	: "130px",
									type	: "default",
									icon	: "close",
			            			text	: "Fechar", 
			            			onClick : function(){
			                			openPesquisaSub.hide()
			                		}
								}
							},{
								widget: "dxButton",
								location:"after",
								toolbar:"bottom",
								options: { 
									width	: "130px",
									type	: "default",
									icon	: "check",
			            			text	: "Salvar", 
			            			onClick : function(){
			                			salvarPaciente()
			                		}
								}
							}],			        

	    				}).dxPopup("instance")
	    				loadPanel.hide();

				    },
					scrollingEnabled	: true,
			        items: [{
			            itemType: "group",
			            cssClass: "first-group",
			            items: [{
					        itemType: "group",
				            items: [{
				            	itemType: "group",
					            colCount: 5,
				            	items:[{
					            		cssClass: "imagem",
			                			template: "<center><div class='form-avatar-cad' style='height:125px;width:125px;'></div><div id=carregaPhoto name=carregaPhoto style='position:relative;left:26px;'></div></center>"
									},{
										itemType: "group",
										colSpan : 4,
										colCount:8,
										items:[{
								            dataField	: "Nome",
								            colSpan		: 8,
											validationRules: [{
							                    type: "required"
							                }],				            
								        },{
								            dataField: "Sexo",
			                                editorType: "dxSelectBox",
								            colSpan		: 3,
											validationRules: [{
							                    type: "required"
							                }],				            
											editorOptions: {
					            		        valueExpr: "Codigo", 
												displayExpr: "Descricao",
						                        items: [{"Codigo":1,"Descricao":"Masculino"},{"Codigo":2,"Descricao":"Feminino"}]
						                    }
								        },{
								            dataField	: "DataDeNascimento",
								            editorType	: "dxDateBox",
								            label: { text:"Data Nascimento"},
								            editorOptions: {
									            useMaskBehavior: true,
					             				max		: new Date()
								            },
											validationRules: [{
							                    type: "required"
							                }],				            
								            colSpan		: 4
								        },{
								            dataField	: "NãoInformada",
								            editorType	: "dxCheckBox",
								            colSpan		: 1
								        },{
								            dataField	: "DataDeObito",
								            label: { text:"Data Óbito"},
								            editorType	: "dxDateBox",
								            editorOptions: {
									            useMaskBehavior: true,
					             				max		: new Date()
								            },
								            colSpan		: 4
								        },{
								            dataField	: "RacaCorEtnia",
								            label: { text:"Raça/Cor/Etnia"},
								            editorType: "dxSelectBox",
								            colSpan		: 4,
											editorOptions: {
					            		        dataSource: new DevExpress.data.DataSource({
													store: new DevExpress.data.CustomStore({
														loadMode: "raw",   
														load: function() {
															return $.getJSON(urlPreparacao,{method:"GetVARPARA",DescParametro:"RACACORETNIA",pExibirCod:0});
														}
													})
												}),
												searchEnabled: true,
												valueExpr: "Codigo", 
												displayExpr: "Descricao",
						                    },
								        },{
								            dataField: "CPF",
								            colSpan		: 4
								        },{
								            dataField: "RG",
								            colSpan		: 4
								        },{
								            dataField: "CNS",
								            colSpan		: 4
								    	},{
								            dataField: "Prontuário",
								            colSpan		: 4
								        },{
									        colSpan		: 4,
								            dataField	: "Classificação",
							    	        editorType	: "dxSelectBox",
							        	    editorOptions: {
						  						items: [{
													"codigo":"1",
													"descricao":"Início de Tratamento"
												},{
													"codigo":"2",
													"descricao":"Em Tratamento"
												},{
													"codigo":"3",
													"descricao":"Óbito"
												}],										        
												valueExpr: "codigo", 
												displayExpr: "descricao",
							        	    },
															            
							        	},{
								            dataField	: "cid",
								            label:{
									            text	: "Diagnóstico"
								            },
							    	        editorType	: "dxSelectBox",
							        	    colSpan		: 4,
							        	    editorOptions:{
												valueExpr: "Codigo", 
												displayExpr: "Descricao",
												searchEnabled: true,
												dataSource: new DevExpress.data.DataSource({
										            store: new DevExpress.data.CustomStore({
									                byKey: function(args) {
									                    return $.getJSON(urlPreparacao,{
										                    method:"getCID",
										                    codigo: args
										                });
									                },
										            load: function(args) {
									                    return $.getJSON(urlPreparacao,{
										                    method:"getCID",
								                        	usuario: YBED,
								                        	skip:args.skip,
								                        	take:args.take,
								                        	filter:JSON.stringify(args.filter),
								                        	searchValue:args.searchValue
										                });
										                }
										            })
										        })
						        			}
							        	}]
							      }]
					        }]
		                },{
				            dataField	: "Alergias",
			    	        editorType	: "dxTextArea",
			        	    colSpan		: 3
			        	},{
					        itemType: "group",
		                    caption: "Contato",
				            colCount: 3,
				            items: [{
					            dataField	: "Telefone1"
					        },{
					            dataField	: "Telefone2"
					        },{
					            dataField	: "PerdaDeContato",
					            editorType	: "dxCheckBox",
					        },{
					            dataField	: "Email",
					            colSpan		: 3,
								//validationRules: [{
							    	//type: "required"
							    //}],					            
					            
					        }]
					    },{
					        itemType: "group",
		                    caption: "Endereço",
	   			            colCount: 2,

				            items: [{
					            dataField	: "Logradouro"
					        },{
					            dataField	: "Número"
					        },{
					            dataField	: "Complemento"
					        },{
					            dataField	: "Bairro"
					        },{
					            dataField	: "CEP"
					        },{
					            dataField	: "Cidade"
					        },{
					            dataField	: "Estado",
								editorType	: "dxSelectBox",
					            editorOptions: {
		            		        valueExpr: "Codigo", 
									displayExpr: "Descricao",
									searchEnabled: true,
									dataSource: new DevExpress.data.DataSource({
							            store: new DevExpress.data.CustomStore({
						                byKey: function(args) {
						                    return $.getJSON(urlPreparacao,{
							                    method:"GetUFs",
							                    codigo: args
							                });
						                },
							            load: function(args) {
							                    return $.getJSON(urlPreparacao,{
								                    method:"GetUFs",
						                        	usuario: YBED,
						                        	skip:args.skip,
						                        	take:args.take,
						                        	searchValue:args.searchValue
								                });
							                }
							            })
							        }),
			                        value: ""
					            },				            
					        }]
					    },{
					        itemType: "group",
		                    caption: "Dados da Mãe do Paciente",
				            colCount: 3,
				            items: [{
					            dataField	: "NomeDaMãe",
					            colSpan		: 2,
					        },{
					            dataField	: "DataDeNasc",
					            editorType	: "dxDateBox",
					            editorOptions: {
						            useMaskBehavior: true
					            }
					        }]
					    }
		             ]
			        }]
		    	}).dxForm("instance")
		    	$("#carregaPhoto").dxFileUploader({
					selectButtonText: "Selecione a foto",
			        labelText: "",
			        accept: "image/*",
			        uploadMode: "instantly"	,
			        uploadUrl: urlPreparacao+"&method=uploadPhoto",
					onUploaded: function(e) {
						openFotoAvatar()
			        }			        
		    	})
				openFotoAvatar()
		    });
					
		}
		
		function openFotoAvatar(){
	        $.getJSON(urlPreparacao,{
	            method		:"recPhotoTemp",
	        },function(retorno){
				$(".form-avatar-cad").css("background-image","url("+retorno.ImageSRC+")")
	        })
		}
		
		function salvarPaciente(){
	        if (!pesquisaExamesSub.validate().isValid){
		        DevExpress.ui.notify("Favor preencher os campos obrigatórios","warning");
		        return
	        }
	        /*console.log(pesquisaExamesSub)
	        return*/
	        $.getJSON(urlPreparacao,{
	            method		:"salvaPaciente",
	            dados		: JSON.stringify(pesquisaExamesSub.option("formData"))
	        },function(retorno){
	            if (retorno.status==1){
	            	DevExpress.ui.notify("Dados Salvos com Sucesso!","success");
	            	carregarPaciente(retorno.codigo)
	            	openPesquisaSub.hide()
	            	//openPesquisa.hide()
	            }else{
					DevExpress.ui.notify("Erro: "+retorno.status,"error");
		        }
	        })
		}
		
		function preparaPesquisaPacientes(){
			exibirTodos = 0
	        pesquisaExames = $("#pesquisaExames").dxDataGrid({
				dataSource:  new DevExpress.data.CustomStore({
            		load: function(args) {
	            		var deferred = $.Deferred()
			            $.getJSON(urlPreparacao,{
        	            	method	:"pesquisaPacientes",
        	            	codCID	: codCID,
        	            	exTodos	: exibirTodos,
        	            	filter	: JSON.stringify(args.filter),
        	            	sort	: JSON.stringify(args.sort),
        	            	take	: JSON.stringify(args.take),
        	            	skip	: JSON.stringify(args.skip)
	        	    	},function(result){
							deferred.resolve(
								result.data, {
									totalCount: result.totalCount
								});
						});
						return deferred.promise();
    	    		}	
    			}),
		        allowColumnResizing: true,
    			remoteOperations	: true,
    			columns:[{
	    				dataField : "PatientID",
	    				caption   : "Código",
	    				width	  : "100px"
	    			},{
		    			dataField : "Name",
		    			caption   : "Nome",
	    			},{
		    			dataField : "CID",
		    			caption   : "Diagnóstico",
	    			},{
		    			dataField : "DOB",
		    			caption   : "Data Nasc.",
		    			width	  : "100px",
		    			dataType  : "date"
	    			},{
		    			dataField : "Gender",
		    			caption   : "Sexo",
		    			width	  : "100px"
	    			},{
		    			dataField : "Classificacao",
		    			caption   : "Classificação",
		    			width	  : "200px"
	    			},{
		    			dataField : "Email",
		    			caption   : "E-mail",
		    			width	  : "200px"
	    			},{
		    			dataField : "Editar",
		    			caption   : "Editar",
		    			width	  : "55px",
		    			disabled	: true,
						cellTemplate: function (container, options) {
		                    $("<div style='cursor:pointer' onclick=cancelaSelecao=1;cadastraPaciente('"+options.data.PatientID+"')>")
		                        .append($("<center><i class='fas fa-user-edit'></i>"))
		                        .appendTo(container);
		                }		    			
	    			}
	    		],
	    		selection: { mode: "single" },
				filterRow: { visible: true },
				hoverStateEnabled: true,
				paging: { enabled: true },
				height: "100%",	
				showBorders: true,
				showRowLines: true,
				rowAlternationEnabled: true,
				columnFixing: {
		            enabled: true
		        },
				onSelectionChanged: function(selectedItems) {
					if (cancelaSelecao==1){
						cancelaSelecao=0
						pesquisaExames.clearSelection()
						return
					}
					if (selectedItems.selectedRowsData.length>0){
						codPaciente = selectedItems.selectedRowKeys[0].PatientID
						if (selectedItems.selectedRowKeys[0].CID==""){
							var result = DevExpress.ui.dialog.confirm("Paciente não possuí diagnóstico cadastrado. Deseja abrir o prontuário primário do paciente?", "Abrir PEP Primário?");
						    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
							result.fail(function(dialogResult) {
								codPaciente = ""
							})
						    result.done(function(dialogResult) {
						        if (!dialogResult){
							        codPaciente = ""
							        return
								}
								codPacienteValor = codPaciente
								ficha=1
								abrePEPPrimario(1)
						    })
						    return
						}else{
							codCID = selectedItems.selectedRowKeys[0].codCID;
							if (codCID == "C90.0") {
								$(".classRiscoTromboseTit").parent().css("display","flex");
								$(".classRiscoTromboseCont").parent().css("display","flex");
							}else{
								$(".classRiscoTromboseTit").parent().css("display","none");
								$(".classRiscoTromboseCont").parent().css("display","none");
							}
							carregarPaciente(codPaciente)
							return
						}
						openPesquisa.hide()
					}
				},
				onToolbarPreparing: function(e) {
					e.toolbarOptions.items.unshift({
						location: "after",
						widget: "dxCheckBox",
						options: {
							text: "Exibir Todos os Paciente",
							hint: "Exibir Todos os Paciente",
							onValueChanged: function(e) {
								exibirTodos = e.value==true?1:0
								pesquisaExames.getDataSource().reload()
							}
						}
					})
				}				

			}).dxDataGrid("instance")
		}
		function importaResultadoExame(meuId,texto){
			var result = DevExpress.ui.dialog.confirm("Deseja utilizar os resultados do dia "+texto+" nesta consulta?", "Importar resultados");
		    $(".dx-overlay-content.dx-popup-normal.dx-popup-draggable.dx-resizable.dx-popup-inherit-height").css("z-index","100000")
		    result.done(function(dialogResult) {
		        if (!dialogResult){
			        return
				}
		        $.getJSON(urlPreparacao,{
			        method		: "importarResultado",
			        meuId		: meuId,
	            	paciente	: codPacienteValor,
	            	dataPEP		: dataPEP,
	            	codCID		: codCID,
			        ficha 		: ficha,
			        fichaSeq	: fichaSeq,
			        painelAtual : painelAtual
			    },function(retorno){
				    if (retorno.erro){
					    DevExpress.ui.notify(retorno.mensagem, "warning", 4000);
				    }else{
					    DevExpress.ui.notify(retorno.mensagem, "success", 4000);
					    tabbed = $("#detalhesTabs").length
					    var painelAtual1 = painelAtual
					    painelAtual = ""
				    	abrePainelSub(painelAtual1,"",retornoPainel.formul.length,tabbed)
				    	openHistorico.hide()
				    }
				});
		    });					    
			
			
		}
		
		function toggleLinhaTempo(){
			if ($("#buttonHideLT").css("display")=="none"){
				return
			}
	        widthDadosGerais = dadosGerais.option("width")
	        widthOpcoesGerais = opcoesGerais.option("width")
		    widthJanela = window.innerWidth
		    heightJanela = window.innerHeight
		    if (widthJanela<900) widthJanela = 900
		    if (heightJanela<500) heightJanela = 500
	        
	        if ($("#linhaTempoChart").css("display")=="none"){
		        $.getJSON(urlPreparacao,{
			        method	: "setToggle",
			        painel	: "linhaTempo",
			        exibir	: 1
			    },function(rs){});
		        $("#linhaTempoChart").animate({height:'show'})
		        $(".linhaTempoForm"+layout).animate({padding:'10px'})
				var altDestaque = 0
				if (layout==1){
				    altDestaque = 95
		        	$("#divFormAtendimentoClinicoAcc").animate({top:"163px"})
				}
				$("#buttonHideLT").css("transition","transform .5s")
				$("#buttonHideLT").css("transform","rotate(0deg)")
				if (layout==2){
				    $("#divFormLinhaTempo").animate({top:heightJanela-79+"px"})
				    $("#pesquisaExamesPre").css("height",heightJanela-tamanhoToolBar-formularioLinhaTempo.option("height")+22+"px")
				    $("#atendimentoClinicoDeta").css("height",heightJanela-tamanhoToolBar-formularioLinhaTempo.option("height")+13+"px")
					openPesquisa.repaint()
					
				}else{
					setTimeout(function(){ 
						$("#divFormAtendimentoClinicoAcc").animate({top:"163px"})
						formAtendimentoClinicoAcc.option("height",heightJanela-tamanhoToolBar-formularioLinhaTempo.option("height")+5)
						formBox.option("height",heightJanela-tamanhoToolBar-formularioLinhaTempo.option("height")-65)
						//carregaGauges();
					},200)
				}
	        }else{
		        $.getJSON(urlPreparacao,{
			        method	: "setToggle",
			        painel	: "linhaTempo",
			        exibir	: 0
			    });
	        	$("#linhaTempoChart").animate({height:'hide'})
		        $(".linhaTempoForm"+layout).animate({padding:'0px'})
				var altDestaque = 0
				if (layout==1){
				    altDestaque = 95
					$("#divFormAtendimentoClinicoAcc").animate({top:"136px"})
				}
				$("#buttonHideLT").css("transition","transform .5s")
				$("#buttonHideLT").css("transform","rotate(180deg)")
				if (layout==2){
					$("#divFormLinhaTempo").animate({top:heightJanela-26+"px"})
					$("#pesquisaExamesPre").css("height",heightJanela-tamanhoToolBar-30+"px")
					$("#atendimentoClinicoDeta").css("height",heightJanela-tamanhoToolBar-39+"px")
					if ($("#openPesquisa").html()!=""){
						setTimeout(function(){openPesquisa.repaint()}, 500);
					}
				}else{
					$("#divFormAtendimentoClinicoAcc").animate({top:"116px"})
					formAtendimentoClinicoAcc.option("height",heightJanela-tamanhoToolBar+100)
					formBox.option("height",heightJanela-tamanhoToolBar-120)
					//carregaGauges();
				}
	        }
		}


		function toggleOpcoes(){
	        widthDadosGerais = dadosGerais.option("width")
	        widthOpcoesGerais = opcoesGerais.option("width")
		    widthJanela = window.innerWidth
		    heightJanela = window.innerHeight
		    if (widthJanela<900) widthJanela = 900
		    if (heightJanela<500) heightJanela = 500
	        
	        if ($("#divFormOpcoesGerais").css("display")=="none"){
		        $.getJSON(urlPreparacao,{
			        method	: "setToggle",
			        painel	: "opcoes",
			        exibir	: 1
			    });
		        $("#botaoExibeOpcoesGerais").animate({width:'hide'})
				$("#divFormOpcoesGerais").animate({width:'show',left:widthJanela-widthOpcoesGerais+10})
	        }else{
		        $.getJSON(urlPreparacao,{
			        method	: "setToggle",
			        painel	: "opcoes",
			        exibir	: 0
			    });
		        $("#botaoExibeOpcoesGerais").animate({width:'show'})
				$("#divFormOpcoesGerais").animate({width:'hide',left:window.innerWidth})
	        }
		}
		
		function itemTemplateRecTerapeutica(itemData, _, itemElement){
            itemElement
                .parent().addClass("conteudoRadioGroup")
                .html(itemData.Name+(itemData.Recomendado==1?"<font color='"+corHints+"'> *</font>":""));
		}
		
	    function resizeMe(){
		    widthJanela = window.innerWidth
		    heightJanela = window.innerHeight
		    //tamanhoToolBar = $("#toolbar").height()+14
		    tamanhoToolBar = $("#toolbar").height()+4
		  	//if (widthJanela<1100) widthJanela = 1100
		    if (heightJanela<500) heightJanela = 500
		    //$("#toolbar").width(widthJanela-18)
		    $("#toolbar").width(widthJanela)
		    if (layout==1){
			    tamanhoBotoes = 75
			    widthOpcoesGerais = opcoesGerais.option("width")
			    leftTema = -325
			    if ($("#divFormOpcoesGerais").css("display")=="none"){
			    	widthOpcoesGerais = 12
			    	leftTema = -75
			    }
			    var altLinhaTempo=0
			    if (typeof formularioLinhaTempo!="undefined"){
			    	altLinhaTempo = formularioLinhaTempo.option("height")-5 
			    }
			    topLinhaTempo = 97
			    if ($("#linhaTempoChart").css("display")=="none"){
					altLinhaTempo = 49
					topLinhaTempo = 36
			    }
			    altDestaque = 106
			    widthDadosGerais = dadosGerais.option("width")+3
			    left = widthDadosGerais -6
			    
			    $("#divFormOpcoesGerais").css("left",widthJanela-widthOpcoesGerais+10)
			    formularioOpcoesGeraisExib.option("height",heightJanela+10)
			    $("#divFormLinhaTempo").css("top",89)
			    $("#divFormLinhaTempo").css("left",left-5)
			    $("#divFormLinhaTempo").css("width",widthJanela - widthDadosGerais - 12 + 26)
			    //
			    alturaBox = heightJanela-tamanhoToolBar - altLinhaTempo-altDestaque-18
			    //
			    $("#divFormAtendimentoClinicoAcc").css("top",topLinhaTempo+tamanhoToolBar-15)
			    $("#divFormAtendimentoClinicoAcc").css("left",left+5)
			    $("#divFormAtendimentoClinicoAcc").css("width",widthJanela - widthDadosGerais - 5)
			    //
			    if (typeof boxEscolhaFicha!="undefined"){
				    boxEscolhaFicha.option("height",alturaBox + 85)
			    }
			    //
		    	if (typeof formAtendimentoClinicoAcc!="undefined"){
		    		formAtendimentoClinicoAcc.option("height",heightJanela-tamanhoToolBar-altLinhaTempo+17)
		    	}
		    	if (typeof formBox!="undefined"){
		    		formBox.option("height",alturaBox + 1000)
		    	}
		    	$("#divFormDadosGerais").css("width",225)
		    	$("#divFormDadosGerais").css("left",-5)
		    	$("#divFormDadosGerais").css("top",85+5)
			    formularioDadosGerais.option("height",heightJanela-256)

		    	$("#divFormDadosGeraisIcone").css("width",225)
		    	$("#divFormDadosGeraisIcone").css("left",-5)
		    	$("#divFormDadosGeraisIcone").css("top",85+5)
			    formularioDadosGeraisIcone.option("height",heightJanela-256)

			    
		    }else{
			    //widthOpcoesGerais = opcoesGerais.option("width")
			    tamanhoBotoes = 41
			    widthDadosGerais = dadosGerais.option("width")
			    widthMenu = 220
			    if (opcaoMenu == 2) {
			    	widthMenu = 63;
			    }
			    //if ($("#boxAtendimentoMenu .dx-menu-item-content").length){
			    	//widthMenu = $("#boxAtendimentoMenu .dx-menu-item-content")[0].scrollWidth+18
			    //}
			    if (widthMenu>400) widthMenu = 300
			    leftTema = -325
			    if ($("#divFormOpcoesGerais").css("display")=="none"){
			    	widthOpcoesGerais = 12
			    	leftTema = -75
			    }
			    altLinhaTempo = 0
			    if (typeof formularioLinhaTempo!="undefined"){
			    	altLinhaTempo = formularioLinhaTempo.option("height")-5 
			    }
			    
			    topLinhaTempo = 105
			    if ($("#linhaTempoChart").css("display")=="none"){
					altLinhaTempo = 48
					topLinhaTempo = 44
			    }
			    widthDadosGerais = dadosGerais.option("width")
			    left = widthDadosGerais -10
			    $("#divFormOpcoesGerais").css("left",widthJanela-widthOpcoesGerais+4)
			    formularioOpcoesGeraisExib.option("height",heightJanela+10)
			    //aqui
			    formularioDadosGerais.option("height",heightJanela-155)
				$("#divFormDadosGerais").css("left",widthJanela-widthDadosGerais)
			    $("#divFormDadosGerais").css("top",tamanhoToolBar+5)
				formularioDadosGeraisIcone.option("height",heightJanela-155) //122
				$("#divFormDadosGeraisIcone").css("left",widthJanela-50)
			    $("#divFormDadosGeraisIcone").css("top",tamanhoToolBar+5)

			    $("#divFormLinhaTempo").css("top",(heightJanela- altLinhaTempo+22))
			    $("#divFormLinhaTempo").css("left",widthMenu-24)
			    $("#divFormLinhaTempo").css("width",widthJanela - widthDadosGerais -widthMenu + 30)
			    $("#divFormAtendimentoClinico").css("top",tamanhoToolBar+4)
			    $("#divFormAtendimentoClinico").css("height",heightJanela-550)
			    $("#divFormAtendimentoClinico").css("left",-10)
			    $("#divFormAtendimentoClinico").css("width",widthMenu-8)
			    var tamanhoConsulta = $("#divDadosGeraisConsulta")[0].clientHeight+55
			    var tamanhoBotoes = $("#linhaDadosGeraisExib")[0].clientHeight+55
			    var tamanhoImpr = $("#linhaDadosGeraisImpr")[0].clientHeight+55
			    var tamanhoEsta = $("#linhaDadosGeraisEsta")[0].clientHeight
			    
				var novoTamanho = heightJanela - tamanhoToolBar - tamanhoConsulta - tamanhoBotoes - tamanhoImpr
				if (novoTamanho>tamanhoEsta){
			    	//formularioDadosGeraisEsta.option("height",novoTamanho)
				}
				
				tamanhoRelatorio = 0
				if (typeof boxAtendimentoMenu!="undefined"){
				    tamanhoTratamento = 185
				    tamanhoRelatorio = 85
				    tamanhoRelatorio = 0
				    ;
			    	$("#boxAtendimentoMenu").height(heightJanela - tamanhoToolBar - tamanhoTratamento - 2 - 20)
			    }
			    //
			    $("#divFormAtendimentoClinicoSugestao").css("top",tamanhoToolBar+4)
			    $("#divFormAtendimentoClinicoSugestao").css("left",widthMenu-24)
			    $("#divFormAtendimentoClinicoSugestao").css("width",widthJanela-widthDadosGerais-widthMenu+30+(opcaoMenuResumo==2?170:0))
			    if (typeof atendimentoClinicoDeta!="undefined"){
				    atendimentoClinico.option("height", heightJanela-87) //heightJanela-87)
			    	//atendimentoClinicoDeta.option("height",heightJanela-tamanhoToolBar-altLinhaTempo-8)
			    }
			    //
				$("#pesquisaExamesPre").css("height",heightJanela-tamanhoToolBar-altLinhaTempo+18+"px")
				$("#atendimentoClinicoDeta").css("height",heightJanela-tamanhoToolBar-altLinhaTempo-19+"px")
				//
				setTimeout(function () {
					corrigeLayout()
					tabbed = $("#detalhesTabs").length
					if (tabbed){
						$("#detalhes").height($("#pesquisaExames").height()-30)
						$("#detalhes").css("min-width","500px")
						$("#detalhesTabs").dxTabs("instance").option("width",$("#pesquisaExames")[0].offsetWidth)
					}
				},100)					
				//
			    widthMenu = 220
			   	if (opcaoEvolucao == 1) {
	 			    if (codPaciente == "") {
					    $("#dvEvolucao").css({zIndex:10000000,top:heightJanela-141,left:widthJanela-220,visibility:"hidden"});
				    }else{
					    $("#dvEvolucao").css({zIndex:100000000,top:heightJanela-141,left:widthJanela-220,visibility:"visible"});
				    }
			   	}else if (opcaoEvolucao == 3) {
					$("#dvEvolucao").css({top:0,left:widthJanela-220});
			   	}else{
				    $("#dvEvolucao").css({top:heightJanela-585,left:widthJanela-500});
			   	}
		    }
		    if ($("#detalhesBlocoLeft").html()){
			    setTimeout(function () {
				    tabbed = $("#detalhesTabs").length
			    	var painelAtual1 = painelAtual
			    	painelAtual = ""
					abrePainelSub(painelAtual1,"",formulario,tabbed)
			    },1000)
		    }
		}

        DevExpress.localization.locale("pt");
        
		loadPanel = $("#loadpanel").dxLoadPanel({
	        shadingColor: '#(corLoadPanel)#',
	        visible: true,
	        showIndicator: true,
	        showPane: true,
	        shading: true,
	        closeOnOutsideClick: false,
			onShown: function(){
				clearTimeout(tempoPanel)
	             tempoPanel = setTimeout(function () { 
	                 loadPanel.hide();          
	             }, 10000);
	         }	        
	    }).dxLoadPanel("instance");

		
		function autenticacaoBirdID(){
		    if ($("#openPesquisa").html()!=""){
		    	pesquisaExames.dispose()
		    	openPesquisa.dispose()
		    }
		    $("#openPesquisa").removeClass("Layout"+layout)
   			$("#openPesquisa").removeClass("colorAtendimentoMenu")
   			$("#openPesquisa").removeClass("colorCondutaMenu")
   			$("#openPesquisa").removeClass("colorTratamentoMenu")
			$("#openPesquisa").css({"position":"relative","zIndex":995}).html("<div id='pesquisaExames'></div>")
			openPesquisa = $("#openPesquisa").dxPopup({
		        width: '450px',
		        height: '300px',
		        showTitle: true,
		        title: "Autenticar no BirdID?",
		        visible: true,
		        dragEnabled: true,
		        closeOnOutsideClick: false,
		        onHidden: function(){
			        if ($("#cdPaciente").val()==""){
				        abrePacienteNovoOuExistente()
			    		//abrePesquisaPacientes()
			        }
			    },
				toolbarItems: [
				{
					location:"before",
					toolbar :"top",
				},{
					widget: "dxButton",
					location:"before",
					toolbar:"bottom",
					options: { 
						width	: "130px",
						type	: "default",
						icon	: "close",
            			text	: "Fechar", 
            			onClick : function(){
                			openPesquisa.hide()
                		}
					}
				},{
					widget: "dxButton",
					location:"after",
					toolbar:"bottom",
					options: { 
						width	: "130px",
						type	: "default",
						icon	: "check",
            			text	: "Autenticar", 
            			onClick : function(){
							if (!pesquisaExames.validate().isValid){
								DevExpress.ui.notify("Há campos inválidos", "warning", 4000);
								return
							}
							loadPanel.show();
					        $.getJSON(urlPreparacao,{
						        method	: "authBirdID",
						        username: pesquisaExames.option("formData")["Usuário"],
						        password: pesquisaExames.option("formData")["Código atual (OTP)"]
		    				},function(ret){
			    				loadPanel.hide();
			    				if (ret.status==1){
				    				openPesquisa.hide()
				    				DevExpress.ui.notify(ret.mensagem, "success", 4000);
				    				return
			    				}
			    				DevExpress.ui.notify(ret.mensagem, "warning", 4000);
			    			});
                		}
					}
				}]		        
			}).dxPopup("instance")
			
			pesquisaExames = $("#pesquisaExames").dxForm({
				screenByWidth: function(width) {
		            return "lg";
		        },
		        width:"100%",
		        colCount:10,
		        items: [{
			        template: "<img src='"+ygif+"/birdID.svg' width='100'></img>"
		        },{
			        colSpan:9,
			        template: "Para autorizar MAPPA a fazer uma assinatura utilizando o seu Bird ID, preencha os campos abaixo:<br><br>"
		        },{
			        colSpan:10,
			        dataField	: "Usuário",
			        editorOptions:{
			        	value	: '#(userBird)#',
			        },
					validationRules: [{
	                    type: "required"
	                }],				            
		        },{
			        colSpan:10,
			        dataField	: "Código atual (OTP)",
			        editorType	: "dxTextBox",
			        editorOptions	: {
				        mode	: "password"
			        },
					validationRules: [{
	                    type: "required"
	                }],				            
		        }]
			}).dxForm("instance")
			loadPanel.hide();
		}
		       
		$(document)
			.ajaxSuccess(function(jqxhr, textStatus, error) {
				loadPanel.hide();
			})
			.ajaxError(function(jqxhr, textStatus, error) {
				var err = textStatus.status + ", " + textStatus.statusText;
	    		DevExpress.ui.notify("Problema no acesso à internet. Favor verificar (code: "+err+")", "error", 4000);
				loadPanel.hide();
			});	        
			
         setInterval(function () { 
             verificaConexao(); 
         }, 30000);

	  	function verificaConexao(){
	  		$.getJSON(urlPreparacao,{
		  		method:"verificaConexao"
		  	},function(status){
		        if (status == 0) {
		            alert('Usuário não está logado ou a sessão expirou.')
		            window.location.replace(URLLogin)
		        }
		  	})
	  	}
			
        $(document).ready(function () {
            prepareSearchInputs();
            if ("#(+opcoes)#"=="0"){
  				$("#divFormOpcoesGerais").hide()
            }
            resizeMe()
            if ("#(codPaciente)#"==""){
		        abreTelaInicial()
            }else{
           		carregarPaciente("#(codPaciente)#")
            }
        });
		window.onbeforeunload = function() {
	        $.getJSON(urlPreparacao,{
		        method	: "limpaTemporarias"
		    });
		};
        
		$(window).resize(function() {
		  resizeMe()
		});	
		
    </script>
</body>

</html>
