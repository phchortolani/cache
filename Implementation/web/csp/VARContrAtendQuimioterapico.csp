<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-br">
	<script language="Cache" runat="server">
		do ^WWWVAR
 
		set YUSER = $get(%request.Data("YUSER", 1))
		set YBED = $get(%request.Data("YBED", 1))
		set YM = $get(%request.Data("YM", 1))
		set YLOCATION = $get(%request.Data("YLOCATION", 1))
		set READONLY = $get(%request.Data("RO", 1))

		set PortCache = $get(%request.CgiEnvs("SERVER_PORT"))
		set PageURL = $get(%request.CgiEnvs("CACHE_URL"))
		set PageName = %request.PageName
		set app = %request.Application
		set host = %request.CgiEnvs("HTTP_HOST")
		set url = "http://"_host_app

		set URLPreparacao = "VAR.CSP.VARContrAtendQuimioterapico.cls"
		set URLPreparacaoQui = "VAR.CSP.VARContrAtendQuimioterapico.cls"
    set URLPreparacaoPEP = "VAR.CSP.VARProntuarioEletronico.cls?EP=1&YBED="_YBED_"&YUSER="_YUSER_"&YLOCATION="_YLOCATION
		set URLPreparacaoTransf 	= "VAR.CSP.VARContrAtendTransfusional.cls"
		set URLPreparacaoSangTer 	= "VAR.CSP.VARContrAtendSangriaTerapeutica.cls"
		set URLLogin = "COMLogin.cls"
		set URLLink = "www.cls"

		set nomeLocal = YLOCATION_" - "_$$SQLGetLocationName^VARSQL(YLOCATION)

		//Verifica se a sessão
		set status = $$VerifySession^VARCSPUtils(YBED, YUSER, url)
		
		set pAdmissao 			= $get(%request.Data("pAdmissao",1)) 
		set pCodProntuario 	= $get(%request.Data("pCodProntuario",1))
		
		Set flagUsuarioMedico = +$$GetChecaMedico^VARSQL(YBED)
		
	</script>
	<head>
		<title>Prontuário Quimioterapia</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Bootstrap CSS -->
		<link rel="stylesheet" type="text/css" href=" #(YGIF)#global/plugins/bootstrap/css/bootstrap.min.css">

		<!-- Font Awesome -->
		<link href=" #(YGIF)#global/plugins/fontawesome/5.4.1/css/all.css" rel="stylesheet" type="text/css">

		<!-- Custom Elements -->
		<link href=" #(YGIF)#global/css/components-rounded.css" rel="stylesheet" id="style_components" type="text/css" />
		<link href=" #(YGIF)#global/css/plugins.css" rel="stylesheet" type="text/css" />
		<link href=" #(YGIF)#global/css/layout.css" rel="stylesheet" type="text/css" />
		<link href=" #(YGIF)#global/css/themes/light.css" rel="stylesheet" type="text/css" id="style_color" />
		<link href=" #(YGIF)#global/css/custom.min.css" rel="stylesheet" type="text/css" />

		<!-- DevExtreme themes -->
    <link rel="stylesheet" type="text/css" href=" #(YGIF)#global/plugins/extreme19.2.4/css/dx.common.css" />
    <link rel="stylesheet" type="text/css" href=" #(YGIF)#global/plugins/extreme19.2.4/css/dx.light.css" />

		<style>
		*{
			font-family: Arial, Helvetica, sans-serif;
		}
		.normal {
			padding: 2px;
			border: 0px solid green;
			text-align: center;
		}
		.titulo {
			padding: 2px;
			padding-top: 5px;
			padding-right: 3px;
			border: 0px solid red;
			text-align: right;
			font-weight: bold;
		}
		.tituloNormal {
			padding: 2px;
			padding-top: 5px;
			padding-right: 3px;
			border: 0px solid red;
			text-align: left;
		}		
		.tituloRadio {
			padding: 2px;
			padding-top: 5px;
			padding-right: 3px;
			border: 0px solid red;
			text-align: right;
			font-weight: bold;
		}
		.tituloRadioNormal {
			padding: 2px;
			padding-top: 3px;
			padding-right: 3px;
			border: 0px solid red;
			text-align: right;
		}
		.campo {
			padding: 2px;
			border: 0px solid blue;
		}
		.divAvatar {
		  position: absolute;
			margin-top: 10px;
			margin-left: 2px;	
		}
		.divCicleAvatar {
		  background-color: #aaa;
		  border-radius: 50%;
		  width: 100px;
		  height: 100px;
		  overflow: hidden;
		  position: relative;
	    border: 1px solid #e9e9e9;
		}
		.divAvatar img {
		  position: absolute;
		  bottom: 0;
		  width: 100%;
		  padding: 0px;
		}
		@keyframes fa-blink {
			0% { opacity: 1; }
			50% { opacity: 0.5; }
			100% { opacity: 0; }
		}
		.fa-blink {
			color: red;
			-webkit-animation: fa-blink 2.2s linear infinite;
			-moz-animation: fa-blink 2.2s linear infinite;
			-ms-animation: fa-blink 2.2s linear infinite;
			-o-animation: fa-blink 2.2s linear infinite;
			animation: fa-blink 2.2s linear infinite;
		}	
	</style>

		<link rel="stylesheet" type="text/css" href=" #(YGIF)#global/themes/css/alphalinc.css" id="style_color" />

	</head>
	<script type="text/javascript">
	var status = "#(status)#";
	var URLLogin = "#(URLLogin)#";
	if (status == 0) {
		alert("Usuário não está logado ou a sessão expirou.")
		window.location.replace(URLLogin)
	}
	</script>
	<body>
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">Controle de Atendimento Ambulatorial - Quimioterapia</a>
				</div>
				<CSP:IF CONDITION="'READONLY"> <!-- quando apenas leitura não exibir botões -->
					<ul class="nav navbar-nav navbar-right">
						<li>
							<button type="button" class="btn btn-info navbar-btn" id="btnSalvar">
								<span class="fa fa-save"></span> Salvar
							</button>
						</li>
						<li>
							<button type="button" class="btn btn-info navbar-btn" id="btnAssinar" style="display:#($Select(flagUsuarioMedico=0:"none",1:"block"))#">
								<span class="fas fa-signature" id="spAssinar"></span> <span id="spAssinarTexto">Assinar</span>
							</button>
						</li>
						<li>
							<button type="button" class="btn btn-info navbar-btn" id="btnImprimirEtiqueta">
								<span class="fa fa-print"></span> Imp. Etiqueta &nbsp;
							</button>
						</li>					
						<li>
							<button type="button" title="Imprimir" class="btn btn-info navbar-btn" id="btnImprimir">
								<span class="fa fa-print"></span> Imprimir
							</button>
						</li>
						<li>
							<button type="button" title="Imprimir Termo de Consetimento" class="btn btn-info navbar-btn" 
							id="btnImpTermo">
								<span class="fa fa-exclamation-circle"></span> Termo
							</button>
						</li>
						<li>
							<button type="button" class="btn btn-info navbar-btn" id="btnFinalizar">
								&nbsp; Finalizar &nbsp;
							</button>
						</li>
						<li>
							<button type="button" class="btn btn-info navbar-btn" id="btnArquivos">
								&nbsp;Arquivos&nbsp;
							</button>
						</li>							
						<li>
							<button type="button" class="btn btn-info navbar-btn" id="btnFechar">
								<span class="fas fa-times"></span> Fechar
							</button>
						</li>
					</ul>
				</CSP:IF>
			</div>
		</nav>
		<div class="container-fluid" style="margin:2px; margin-top:58px;min-width: 1280px;">
			<div class="row">
				<!--<div class="col-md-1">
					<div class="row">
						<div class="col-md-12">
							<div class="divAvatar"> 
								<div class="divCicleAvatar">
									<img class="imgAvatar" src="#(YGIF)#global/assets/images/avatars/profile_girl.jpg">
								</div>
							</div>
						</div>
					</div>
				</div>-->
				<div class="col-md-7">
					<div class="row">
						<div class="col-md-2 titulo">Prontuário/Código:</div>
						<div class="col-md-2 campo"><div id="textPronturario"></div></div>
						<div class="col-md-2 titulo">Admissão:</div>
						<div class="col-md-2 campo"><div id="textAdmissao"></div></div>
						<div class="col-md-2 titulo">Data/Hora:</div>
						<div class="col-md-2 campo"><div id="textDataHora"></div></div>
					</div>
					<div class="row">
						<div class="col-md-2 titulo">Sala:</div>
						<div class="col-md-4 campo"><div id="selectSala"></div></div>
						<div class="col-md-2 titulo">Leito:</div>
						<div class="col-md-4 campo"><div id="selectLeito"></div></div>
					</div>
					<div class="row">
						<div class="col-md-2 titulo">Paciente:</div>
						<div class="col-md-10 campo"><div id="textPaciente"></div></div>
					</div>
					<div class="row">
						<div class="col-md-3 titulo">Data Nascimento:</div>
						<div class="col-md-2 campo"><div id="textDataNascimento"></div></div>
						<div class="col-md-1 titulo">Idade:</div>
						<div class="col-md-2 campo"><div id="textIdade"></div></div>
						<div class="col-md-1 titulo">Sexo:</div>
						<div class="col-md-3 campo"><div id="textSexo"></div></div>
					</div>
				</div>
				<div class="col-md-4">
					<div class="row">
						<div class="col-md-4 titulo">Protocolo/Esquema:</div>
						<div class="col-md-8 campo"><div id="textProtocoloEsquema"></div></div>
					</div>
					<div class="row">
						<div class="col-md-4 titulo">Nº do Ciclo:</div>
						<div class="col-md-2 campo"><div id="textNumeroCiclo"></div></div>
						<div class="col-md-4 titulo">Dia do Ciclo:</div>
						<div class="col-md-2 campo"><div id="textDiaCiclo"></div></div>
					</div>
					<div class="row">
						<div class="col-md-4 titulo">Diagnóstico:</div>
						<div class="col-md-8 campo"><div id="textDiagnostico"></div></div>
					</div>
					<div class="row">
						<div class="col-md-4 titulo">Médico Responsável:</div>
						<div class="col-md-6 campo"><div id="selectMedicoExterno"></div></div>
						<div class="col-md-2 campo"><div id="divMedicoExternoAdd"></div></div>
					</div>
					<div class="row">
						<div class="col-md-4 titulo" id="divExibirAssinaturaTitulo">&nbsp;</div>
						<div class="col-md-8 tituloNormal" id="divExibirAssinatura" style="text-align: left">&nbsp;</div>
					</div>
				</div>
				<div class="col-md-1">
					<div class="row">
						<div class="col-md-12 normal">
							<div id="divIcones"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12" style="height:5px;"></div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<div id="divAbas"></div>
				</div>
			</div>
		</div>	
		<div id="divCadastrarQuimio"></div>
		<div id="divImprimirEtiqueta"></div>
		<div id="divImprimirEtiquetaDados"></div>
		<div id="openPesquisaCID"></div>
		<div id="openPesquisaArquivo"></div>
		<div id="divCadastrarMedico"></div>
		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src=" #(YGIF)#global/plugins/extreme19.2.4/js/jquery.min.js"></script>

		<!-- JSZip library -->
		<script type="text/javascript" src=" #(YGIF)#global/plugins/extreme19.2.4/js/jszip.min.js"></script>

	  <!-- A DevExtreme library -->
	  <script type="text/javascript" src=" #(YGIF)#global/plugins/extreme19.2.4/js/dx.web.js"></script>
	  
	  <!-- DevExtreme-Intl module -->
	  <script type="text/javascript" src=" #(YGIF)#global/plugins/extreme19.2.4/js/localization/dx.messages.pt.js"></script>

		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src=" #(YGIF)#global/plugins/bootstrap-3.3.7/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="#(YGIF)#Zebra/BrowserPrint.js/BrowserPrint-2.0.0.75.min.js"></script>

		<!--Definições globais e criação de funcionalidades encapsuladas-->
		<script type="text/javascript">
		//Deixando variáveis disponíveis no cliente
		var urlPreparacao 	= "#(URLPreparacao)#";
		var urlPreparacaoQui= "#(URLPreparacaoQui)#";
		var urlPreparacaoPEP = "#(URLPreparacaoPEP)#";
		var urlPreparacaoTransf = "#(URLPreparacaoTransf)#";
		var urlPreparacaoSangTer = "#(URLPreparacaoSangTer)#";
		var urlLink 				= "#(URLLink)#";
		var YBED 						= "#(YBED)#";
		var YUSER 					= "#(YUSER)#";
		var YLOCATION 			= "#(YLOCATION)#";
		var nomeLocal 			= "#(nomeLocal)#";
		var pAdmissao				= "#(pAdmissao)#";
		var pCodProntuario	= "#(pCodProntuario)#";
		var carregarTela		= 1;
		var CategoriaAnt		= "";
		var selected_device;
		var flagUsuarioMedico = "#(flagUsuarioMedico)#";
		var READONLY 					= "#(READONLY)#";
		//
		var height = window.innerHeight - 260;
		//
		DevExpress.config({decimalSeparator: ",",thousandsSeparator: "."});
		DevExpress.localization.locale("pt");
		//
		$(document).ready(function () {
			if (pCodProntuario != "") {
				recuperaProntuario(pCodProntuario);			
			}
			if (READONLY) {fnReadOnly(); setInterval(fnReadOnly, 1000);}
		});
		
		function fnReadOnly(){
			$('.dx-toolbar-button, .dx-button, .btn').css("visibility","hidden");
			$('#divReacaoTransfusional .dx-toolbar-button').css("visibility","hidden");
			$('.aba .dx-textbox').each(function(){ try { $(this).dxTextArea('instance').option('readOnly',true) } catch (ex) {} })
			$('.aba .dx-texteditor').each(function(){ try { $(this).dxTextBox('instance').option('readOnly',true) } catch (ex) {} })
			$('.aba .dx-checkbox').each(function(){ try { $(this).dxCheckBox('instance').option('readOnly',true) } catch (ex) {} })
			$('.aba .dx-selectbox').each(function(){ try { $(this).dxSelectBox('instance').option('readOnly',true) } catch (ex) {} })
			$('.aba .dx-selectbox').each(function(){ try { $(this).dxTagBox('instance').option('readOnly',true) } catch (ex) {} })
			$('.aba .dx-numberbox').each(function(){ try { $(this).dxNumberBox('instance').option('readOnly',true) } catch (ex) {} })
			$('.aba .dx-radiogroup').each(function(){ try { $(this).dxRadioGroup('instance').option('disabled',true) } catch (ex) {} })
			$('.aba .dx-checkbox-icon').each(function(){ try { $(this).dxCheckBox('instance').option('disabled',true) } catch (ex) {} })
			$('.aba .dx-datebox').each(function(){ try { $(this).dxDateBox('instance').option('disabled',true) } catch (ex) {} })
		}
		//
		campoProntuario = $("#textPronturario").dxTextBox({readOnly: true, height: 27}).dxTextBox("instance");
		campoAdmissao = $("#textAdmissao").dxTextBox({readOnly: true, height: 27, value: pAdmissao}).dxTextBox("instance");
		campoDataHora = $("#textDataHora").dxTextBox({readOnly: true, height: 27}).dxTextBox("instance");
		campoSala = $("#selectSala").dxTextBox({readOnly: true, height: 27}).dxTextBox("instance");
		campoLeito = $("#selectLeito").dxSelectBox({
			valueExpr: "Codigo", displayExpr: "Descricao", height: 27, onValueChanged: function (e) {  
				if (e.value != "" && e.value != null && carregarTela != 1) {
					$.getJSON(urlPreparacao,{method:"AlteraLeito",pCodProntuario:pCodProntuario,pAdmissao:pAdmissao,
						pCodLeito:e.value},function(objeto){
							if (objeto.status==1){
								DevExpress.ui.notify("Leito alterado com Sucesso!","success");
							}else{
								DevExpress.ui.notify("Erro: "+objeto.status,"error");
							}
					});
				}
				carregarTela = "";
			}
		}).dxSelectBox("instance");
		campoPaciente = $("#textPaciente").dxTextBox({readOnly: true, height: 27}).dxTextBox("instance");
		campoDataNascimento = $("#textDataNascimento").dxTextBox({readOnly: true, height: 27}).dxTextBox("instance");
		campoIdade = $("#textIdade").dxTextBox({readOnly: true, height: 27}).dxTextBox("instance");
		campoSexo = $("#textSexo").dxTextBox({readOnly: true, height: 27}).dxTextBox("instance");
		campoProtocoloEsquema = $("#textProtocoloEsquema").dxTextBox({height: 27}).dxTextBox("instance");
		campoNumeroCiclo = $("#textNumeroCiclo").dxNumberBox({height: 27, min: 0, format: "#0"}).dxNumberBox("instance");
		campoDiaCiclo = $("#textDiaCiclo").dxNumberBox({height: 27, min: 0, format: "#0"}).dxNumberBox("instance");
		campoDiagnostico  = $("#textDiagnostico").dxTagBox({
			valueExpr: "Codigo", 
			displayExpr: "Descricao",
			searchEnabled: true,
			buttons: [{
				name: "btnPesquisarDiagnostico",
				location: "before",
				options: {
					hint: "Pesquisar",
					icon: "fa fa-search",
					type: "normal",
					onClick: function() {
						abrePesquisaCID(campoDiagnostico, campoDiagnostico.option("value"));
					}
				}
			}],
			itemTemplate: function (data, itemIndex, element) {
				if (CategoriaAnt != data.Categoria){
					retorno = "<b><i>"+data.Categoria+"</i></b><br><br>"
					CategoriaAnt = data.Categoria
					element.append(retorno)
				}
				return element.append(data.Descricao)
      },							
			dataSource: new DevExpress.data.DataSource({
				store: new DevExpress.data.CustomStore({
					byKey: function(args) {
						return $.getJSON(urlPreparacao,{
							method:"getCID",
							codigo: args
						});
					},
					load: function(args) {
						return $.getJSON(urlPreparacao,{
							method:"getCID",
							usuario: YBED,
							skip:args.skip,
							take:args.take,
							searchValue:args.searchValue
						});
					}
				})
			})
		}).dxTagBox("instance");
		//
		dataSourceMedico = new DevExpress.data.DataSource({
			store: new DevExpress.data.CustomStore({
				load: function(args) {
					return $.getJSON(urlPreparacaoQui,{
						method:"CarregaProfissional", 
						pFiltro: args.searchValue,
						pTake: args.take, 
						pSkip: args.skip, 
						YLOCATION: YLOCATION, 
						//pFlagExterno: "E",
						pLicenseType: "2231"
					});
				},
				byKey: function(args) {
					return $.getJSON(urlPreparacaoQui,{
						method:"CarregaProfissional", 
						pKey: args, 
						YLOCATION: YLOCATION, 
						//pFlagExterno: "E"
					});
				}
			})
		});
		campoMedicoExterno = $("#selectMedicoExterno").dxSelectBox({
			dataSource: dataSourceMedico,valueExpr: "CodProvider", displayExpr: "DescProvider", height: 27,searchEnabled: true}
		).dxSelectBox("instance");
		buttonAddMedico = $("#divMedicoExternoAdd").dxButton({
			icon: "add",
			hint: "Adicionar Médico",
			type: "normal",
			height: 27,
			onClick: function(){
				$("#divCadastrarMedico").dxPopup("show");
			}
		}).dxButton("instance");	
		//
		$("#text").find("input").css({ "background": "red" });
		//
		campoAbas = $("#divAbas").dxForm({
			showColonAfterLabel: false,
			labelLocation: "left",
			showRequiredMark: false,
			items: [{
				itemType: "tabbed",
				tabPanelOptions: {
  			  deferRendering: false, 
  			  selectedIndex: 2,
				},
				tabs: [
					/// Aba Pendentes
					{ title: "Intercorrências", name: "tabEventosAdversos", items: [
						{ template: function (data, itemElement) {
								itemElement.append("<div id='divEventosAdversos' style='height:"+height+"px;border:0px solid red;overflow-Y: auto;'>")
	          	}		                           	
			    	}	
					]},
					{ title: "Anamnese", name: "tabAnamnese", items: [
						{ template: function (data, itemElement) {
								itemElement.append("<div id='divAnamnese' class='aba' style='height:"+height+"px;border:0px solid red;overflow-Y: auto;'>")
	          	}		                           	
			    	}	
					]},
					{ title: "Aplicação de Quimio", name: "tabContDadosVitais", items: [
						{ template: function (data, itemElement) {
								itemElement.append("<div id='divContDadosVitais' class='aba' style='height:"+height+"px;border:0px solid red;overflow-Y: auto;'>")
	          	}		                           	
			    	}	
					]},
					{ title: "Reação", name: "tabReacao", items: [
						{ template: function (data, itemElement) {
								itemElement.append("<div id='divReacao' class='aba' style='height:"+height+"px;border:0px solid red;overflow-Y: auto;'>")
	          	}		                           	
			    	}	
					]},
					{ title: "Observações", name: "tabObservacoes", items: [
						{ template: function (data, itemElement) {
								itemElement.append("<div id='divObservacoes' class='aba' style='height:"+height+"px;border:0px solid red;overflow-Y: auto;'>")
	          	}		                           	
			    	}	
					]},
					{ title: "Prescrição para Atendimento", name: "tabPrescricaoAtendimento", items: [
						{ template: function (data, itemElement) {
								itemElement.append("<div id='divPrescricaoAtendimento' class='aba' style='height:"+height+"px;border:0px solid red;overflow-Y: auto;'>")
	          	}		                           	
			    	}	
					]},
					/*{ title: "Aplicação de Medicamento", name: "tabAplicMedicamento", items: [
						{ template: function (data, itemElement) {
								itemElement.append("<div id='divAplicMedicamento' style='height:"+height+"px;border:0px solid red;overflow-Y: auto;'>")
	          	}		                           	
			    	}	
					]}*/{ title: "Receituário", name: "tabReceituario", items: [
						{ template: function (data, itemElement) {
								itemElement.append("<div id='divReceituario' class='aba' style='height:"+height+"px;border:0px solid red;overflow-Y: auto;'>")
	          	}		                           	
			    	}	
					]},{ title: "Relatório", name: "tabDeclaracao", visible: (flagUsuarioMedico == 0 ? false : true), items: [
						{ template: function (data, itemElement) {
								itemElement.append("<div id='divDeclaracao' style='height:"+height+"px;border:0px solid red;overflow-Y: auto;'>")
	          	}		                           	
			    	}	
					]}
					/*{ title: "Prescrição Ambulatorial", name: "tabPrescAmbulatorial", items: [
						{ template: function (data, itemElement) {
								itemElement.append("<div id='divPrescAmbulatorial' style='height:"+height+"px;border:0px solid red;overflow-Y: auto;'>")
	          	}		                           	
			    	}	
					]},*/
				]
			}]
		});
		
		$("#divAnamnese").load("VARContrAtendQuimioterapicoAnamnese.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#");
		$("#divContDadosVitais").load("VARContrAtendQuimioterapicoContDadosVitais.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#");
		$("#divObservacoes").load("VARContrAtendQuimioterapicoObservacoes.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#");
		$("#divAplicMedicamento").load("VARContrAtendQuimioterapicoAplicMedicamento.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#");
		$("#divPrescAmbulatorial").load("VARContrAtendQuimioterapicoPrescAmbulatorial.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#");
		$("#divEventosAdversos").load("VARContrAtendEventosAdversos.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#");
		$("#divReceituario").load("VARContrAtendReceituario.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#&YGIF=#(YGIF)#");
		$("#divPrescricaoAtendimento").load("VARContrAtendPrescricaoAtendimento.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#");
		//$("#divIntercorrencias").load("VARContrAtendIntercorrencias.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#&YGIF=#(YGIF)#");
		$("#divReacao").load("VARContrAtendQuimioterapicoReacao.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#");
		$("#divDeclaracao").load("VARContrAtendAtestado.csp?YBED=#(YBED)#&YUSER=#(YUSER)#&YM=0&YLOCATION=#(YLOCATION)#&YGIF=#(YGIF)#");

		function recuperaProntuario(pCodProntuario){
			$.getJSON(urlPreparacao,{method:"GetProntuario",pCodProntuario:pCodProntuario},function(objeto){
				campoProntuario.option("value",objeto.codPaciente);
				campoDataHora.option("value",objeto.dataHora);
				campoSala.option("value",objeto.codSala);
				campoLeito.option({dataSource: eval(objeto.dSLeito), value: eval(objeto.codLeito)});
				campoPaciente.option("value",objeto.paciente);
				campoDataNascimento.option("value",objeto.dataNascimento);
				campoIdade.option("value",objeto.idade);
				campoSexo.option("value",objeto.sexo);
				campoProtocoloEsquema.option("value",objeto.protocoloEsquema);
				campoNumeroCiclo.option("value",objeto.numCiclo);
				campoDiaCiclo.option("value",objeto.diaCiclo);
				campoDiagnostico.option("value",objeto.diagnostico);
				campoMedicoExterno.option("value",objeto.medicoExterno);
				//
				if (objeto.dataHoraAssinatura != "") {
					$("#spAssinar").css("color","green")
					$("#btnAssinar").attr("title", "PEP assinado por: "+objeto.assinatura+" ("+objeto.dataHoraAssinatura+")");
					$("#spAssinarTexto").css("color","green");
					$("#btnFinalizar").attr("bloquear","0")
					$("#btnFinalizar").attr("title", "PEP assinado por: "+objeto.assinatura+" ("+objeto.dataHoraAssinatura+")");
					$("#divExibirAssinaturaTitulo").html("PEP assinado por:");
					$("#divExibirAssinatura").html(objeto.assinatura+" ("+objeto.dataHoraAssinatura+")");
					
					//LEAN-259
					//Bloqueia todos os campos de todas as abas, somente para visualização quando PEP estiver finalizado
					$('.aba .dx-toolbar-button, .aba .dx-button').css("visibility","hidden")
					$('.aba .dx-textbox').each(function(){ try { $(this).dxTextArea('instance').option('readOnly',true) } catch (ex) {} })
					$('.aba .dx-texteditor').each(function(){ try { $(this).dxTextBox('instance').option('readOnly',true) } catch (ex) {} })
					$('.aba .dx-checkbox').each(function(){ try { $(this).dxCheckBox('instance').option('readOnly',true) } catch (ex) {} })
					$('.aba .dx-selectbox').each(function(){ try { $(this).dxSelectBox('instance').option('readOnly',true) } catch (ex) {} })
					$('.aba .dx-selectbox').each(function(){ try { $(this).dxTagBox('instance').option('readOnly',true) } catch (ex) {} })
					$('.aba .dx-numberbox').each(function(){ try { $(this).dxNumberBox('instance').option('readOnly',true) } catch (ex) {} })
					$('.aba .dx-radiogroup').each(function(){ try { $(this).dxRadioGroup('instance').option('disabled',true) } catch (ex) {} })
					$('.aba .dx-checkbox-icon').each(function(){ try { $(this).dxCheckBox('instance').option('disabled',true) } catch (ex) {} })
					$('.aba .dx-datebox').each(function(){ try { $(this).dxDateBox('instance').option('disabled',true) } catch (ex) {} })
					
				}else{
					$("#spAssinar").css("color","#ffffff");
					$("#spAssinarTexto").css("color","#ffffff");
					$("#btnAssinar").attr("title", "Assinar");
					$("#btnFinalizar").css("background-color","#Cccccc")
					$("#btnFinalizar").css("border-color","#cccccc");
					$("#btnFinalizar").attr("bloquear","1")
					$("#btnFinalizar").attr("title", "Prontuário pendente de assinatura do Médico.");
					$("#divExibirAssinaturaTitulo").html("");
					$("#divExibirAssinatura").html("");
				}
				//
				//Anamnese
				//campoMolestiaPregressas.option({"value":objeto.comorbidades});
				//campoCID.option({"value":objeto.cid});
				campoComorbidades.option({"value":objeto.comorbidades});
				campoComorbidadesDM.option("value",objeto.comorbidadesDM);
				campoComorbidadesHAS.option("value",objeto.comorbidadesHAS);
				campoComorbidadesIRC.option("value",objeto.comorbidadesIRC);
				campoComorbidadesICC.option("value",objeto.comorbidadesICC);
				campoComorbidadesAVC.option("value",objeto.comorbidadesAVC);
				campoComorbidadesCodronariopatia.option("value",objeto.comorbidadesCodronariopatia);
				campoComorbidadesOutros.option("value",objeto.comorbidadesOutros);
				campoCirugiasAnteriores.option("value",objeto.cirugiasAnteriores);
				campoCirugiasAnterioresOnde.option("value",objeto.cirugiasAnterioresOnde);
				campoAlergia.option("value",objeto.alergia);
				campoAlergiaAQue.option("value",objeto.alergiaAQue);
				campoMedicamentoUso.option("value",objeto.medicamentoUso);
				campoInfusaoVeiaPeriferica.option("value",objeto.infusaoVeiaPeriferica);
				campoInfusaoPort.option("value",objeto.infusaoPort);
				campoInfusaoPICC.option("value",objeto.infusaoPICC);
				campoInfusaoSC.option("value",objeto.infusaoSC);
				campoInfusaoIM.option("value",objeto.infusaoIM);
				campoInfusao.option("value",objeto.infusao);
				campoFluxoCateter.option("value",objeto.fluxoCateter);
				campoFinalizacao.option("value",objeto.finalizacao);
				campoIncidente.option("value",objeto.incidente);
				campoIncidenteQual.option("value",objeto.incidenteQual);
				campoPeso.option("value",objeto.peso);
				campoAltura.option("value",objeto.altura);
				campoSC.option("value",objeto.sC);
				campoRiscoFlebite.option("value",objeto.riscoFlebite);
				campoNeuropsiquiatrico.option("value",objeto.neuropsiquiatrico);
				campoPadraoRespiratorio.option("value",objeto.padraoRespiratorio);
				campoRitmoCardiaco.option("value",objeto.ritmoCardiaco);
				campoPeleMucosa.option("value",objeto.peleMucosa);
				campoDor.option("value",objeto.dor);
				campoDorDescricao.option("value",objeto.dorDescricao);
				campoRedeVenoso.option("value",objeto.redeVenoso);
				campoRedeVenosoDescricao.option("value",objeto.redeVenosoDescricao);
				campoMedoApreensao.option("value",objeto.medoApreensao);
				campoMedoApreensaoDescricao.option("value",objeto.medoApreensaoDescricao);
				campoInternacaoSocial.option("value",objeto.internacaoSocial);
				campoInternacaoSocialDescricao.option("value",objeto.internacaoSocialDescricao);
				campoHemograma.option("value",objeto.hemograma);
				campoFuncaoRenal.option("value",objeto.funcaoRenal);
				campoHipatica.option("value",objeto.hipatica);
				campoNeurologicas.option("value",objeto.neurologicas);
				campoConferirPaciente.option("value",objeto.conferirPaciente);
				campoConferirPrescricao.option("value",objeto.conferirPrescricao);
				campoConferirEtiqueta.option("value",objeto.conferirEtiqueta);
				campoConferirSinais.option("value",objeto.conferirSinais);
				//Observações
				campoDispensacao.option("value",objeto.dispensacao);
				campoObservadoPor.option("value",objeto.observadoPor);
				campoIntercorrencia.option("value",objeto.intercorrencia);
				campoIntercorrenciaQual.option("value",objeto.intercorrenciaQual);
				campoOutrasObservacoes.option("value",objeto.outrasObservacoes);
				campoObservacoesEnfermagem.option("value",objeto.observacoesEnfermagem);
				// Aplicação de Medicamento
				/*campoDiagnosticoPerdaSanguinea.option("value",objeto.aplicMedicamentosPerdSa);
				campoDiagnosticoBariatrica.option("value",objeto.aplicMedicamentosBariatr);
				campoDiagnosticoOutros.option("value",objeto.aplicMedicamentosOutrosD509);
				campoTextDiagnosticoOutros.option("value",objeto.aplicMedicamentosOutros);*/
				//campoApliMedAlerta.option("value",objeto.aplicMedicamentosAlerta);
				//campoApliMedDiagnostico.option("value",objeto.aplicMedicamentosDiagnosticoSecundario);
				//Prescrição Ambulatorial
				campoPrescAmbIntervalo.option("value",objeto.prescAmbIntervalo);
				campoPrescAmbNCiclo.option("value",objeto.prescAmbNCiclo);
				campoPrescAmbInicioAplic.option("value",objeto.prescAmbInicioAplic);
				campoPrescAmbDias.option("value",objeto.prescAmbDias);
				campoPrescAmbHb.option("value",objeto.prescAmbHb);
				campoPrescAmbHtc.option("value",objeto.prescAmbHtc);
				campoPrescAmbPlaq.option("value",objeto.prescAmbPlaq);
				campoPrescAmbLeuc.option("value",objeto.prescAmbLeuc);
				campoPrescAmbNeutrof.option("value",objeto.prescAmbNeutrof);
				campoPrescAmbMedido.option("value",objeto.prescAmbMedido);
				campoPrescAmbBombainf.option("value",objeto.prescAmbBombainf);
				//
				//
				campoNomeMedicamento.option("value",objeto.nomeMedicamento);
				campoNomeFabriacente.option("value",objeto.nomeFabriacente);
				campoDataInicio.option("value",objeto.dataInicio);
				campoDataAparecimento.option("value",objeto.dataAparecimento);
				campoReacaoMedLote.option("value",objeto.reacaoMedLote);
				campoReacaoMedValidad.option("value",objeto.reacaoMedValidad);
				campoReacaoMedPeso.option("value",objeto.reacaoMedPeso);
				campoReacaoMedAlt.option("value",objeto.reacaoMedAlt);
				campoMedicacoesAntes.option("value",objeto.medicacoesAntes);
				campoMedicacoesAntesFreq.option("value",objeto.medicacoesAntesFreq);
				campoMedicacosAntesFreqEsp.option("value",objeto.medicacosAntesFreqEsp);
				campoGotejamento.option("value",objeto.gotejamento);
				campoDiluicao1.option("value",objeto.diluicao1);
				campoDiluicao2.option("value",objeto.diluicao2);
				campoGotejamentoSF.option("value",objeto.gotejamentoSF);
				campoBolus.option("value",objeto.bolus);
				campoBolusDuracao.option("value",objeto.bolusDuracao);
				campoIntramoscular.option("value",objeto.intramoscular);
				//campoIntramoscularDuracao.option("value",objeto.intramoscularDuracao);
				campoOral.option("value",objeto.oral);
				campoOralPosologia.option("value",objeto.oralPosologia);
				campoIngestao.option("value",objeto.ingestao);
				campoSinaisSintomas.option("value",objeto.sinaisSintomas);
				campoIrritante.option("value",objeto.irritante);
				campoVesicante.option("value",objeto.vesicante);
				campoIncidenteLocalNao.option("value",objeto.incidenteLocalNao);
				campoIncidenteLocal.option("value",objeto.incidenteLocal);
				campoCompressaQuente.option("value",objeto.compressaQuente);
				campoCompressaFria.option("value",objeto.compressaFria);
				campoCompressaNao.option("value",objeto.compressaNao);
				campoCondutaAcompanhamento.option("value",objeto.condutaAcompanhamento);
				campoConclusao.option("value",objeto.conclusao);
				campoHistorico.option("value",objeto.historico);
				textMedico.option("value",objeto.medico);
				data = objeto.dataHora
				if (objeto.dataHora.indexOf(" ")>-1){
					data = objeto.dataHora.split(" ")[0]
				}
				textData.option("value",data);		
				preencherIcones();
				//
				preencherIcones();
				//
				PopulaEnvendoAnamnese()
			});
		}
		
		$("#btnFechar").click(function(){
			window.opener.carregaSala();
			window.close();
		});
		
		$("#btnImpTermo").click(function(){
			$.post(urlPreparacao,{method:"Imprimir",pCodProntuario:pCodProntuario,pTipo:"T",YBED:YBED},function(retorno){
				eval(retorno);
			})				
		});
		
		$("#btnImprimir").click(function(){
			$.post(urlPreparacao,{method:"Imprimir",pCodProntuario:pCodProntuario,pTipo:"I",YBED:YBED},function(retorno){
				eval(retorno);
			})				
		});			
		$("#btnArquivos").click(function(){
			$("#openPesquisaArquivo").dxPopup("show");
		});				
		$("#btnFinalizar").click(function(){

			if ($("#btnFinalizar").attr("bloquear") == "1") {
				DevExpress.ui.notify("Prontuário pendente de assinatura do Médico.","warning",1500);
				return
			}

			var result = DevExpress.ui.dialog.confirm("<i>Confirmar a finalização do atendimento?</i>", "Confirmação?");
			result.done(function(dialogResult) {
				if (dialogResult) {
					var result = DevExpress.ui.dialog.confirm("<i>Término da Requisição?</i>", "Confirmação?");
					result.done(function(dialogResult) {
						var terminoPedido = 0;
						if (dialogResult) {
							terminoPedido = 1;
						}
						$.getJSON(urlPreparacao,{method:"ArmFinalizar",pCodProntuario:pCodProntuario,pAdmissao:pAdmissao,origem:"Q",
							pTerminoPedido:terminoPedido},function(rs){
							window.opener.carregaSala();
							window.close();
						});
					});
				}
			});
		});
		
		function PopulaEnvendoAnamnese(){
			$.getJSON(urlPreparacao,{method:"RecuperaUltimoEventoAdverso",pAdmissao:pAdmissao},function(objRetorno){
				campoDataEventosA.option({"value":objRetorno.data});
				campoHoraEventosA.option({"value":objRetorno.hora});
				campoDescicaoEventosA.option({"value":objRetorno.descricao});
				campoCondutaEventosA.option({"value":objRetorno.conduta});
			})
			
		}
		$("#btnImprimirEtiqueta").click(function(){
			$("#divImprimirEtiqueta").dxPopup("show");
		});

		$("#btnAssinar").click(function(){
			salvarDados(1);
			dataSourceDados.reload();
		});
		$("#btnSalvar").click(function(p1){
			salvarDados(0);
		});		

		function salvarDados(flagAssinar){
			var pCodLeito = campoLeito.option("value");
			var pProtocoloEsquema	= campoProtocoloEsquema.option("value");
			var pNumCiclo	= campoNumeroCiclo.option("value");
			var pDiaCiclo	= campoDiaCiclo.option("value");
			var pDiagnostico	= campoDiagnostico.option("value");
			var pMedicoExterno	= campoMedicoExterno.option("value");
			//Anamnese
			var pCID = ""; //campoCID.option("value");
			var pComorbidades = campoComorbidades.option("value"); //campoMolestiaPregressas.option("value"); //campoComorbidades.option("value");
			var pComorbidadesDM = campoComorbidadesDM.option("value");
			var pComorbidadesHAS = campoComorbidadesHAS.option("value");
			var pComorbidadesIRC = campoComorbidadesIRC.option("value");
			var pComorbidadesICC = campoComorbidadesICC.option("value");
			var pComorbidadesAVC = campoComorbidadesAVC.option("value");
			var pComorbidadesCodronariopatia = campoComorbidadesCodronariopatia.option("value");
			var pComorbidadesOutros = campoComorbidadesOutros.option("value");
			var pCirugiasAnteriores = campoCirugiasAnteriores.option("value");
			var pCirugiasAnterioresOnde = campoCirugiasAnterioresOnde.option("value");
			var pAlergia = campoAlergia.option("value");
			var pAlergiaAQue = campoAlergiaAQue.option("value");
			var pMedicamentoUso	= campoMedicamentoUso.option("value");
			var pInfusaoVeiaPeriferica = campoInfusaoVeiaPeriferica.option("value");
			var pInfusaoPort = campoInfusaoPort.option("value");
			var pInfusaoPICC = campoInfusaoPICC.option("value");
			var pInfusaoSC = campoInfusaoSC.option("value");
			var pInfusaoIM = campoInfusaoIM.option("value");
			var pInfusao = campoInfusao.option("value");
			var pFluxoCateter = campoFluxoCateter.option("value");
			var pFinalizacao = campoFinalizacao.option("value");
			var pIncidente = campoIncidente.option("value");
			var pIncidenteQual = campoIncidenteQual.option("value");
			var pPeso = campoPeso.option("value");
			var pAltura = campoAltura.option("value");
			var pSC = campoSC.option("value");
			var pRiscoFlebite = campoRiscoFlebite.option("value");
			var pNeuropsiquiatrico = campoNeuropsiquiatrico.option("value");
			var pPadraoRespiratorio = campoPadraoRespiratorio.option("value");
			var pRitmoCardiaco = campoRitmoCardiaco.option("value");
			var pPeleMucosa = campoPeleMucosa.option("value");
			var pDor = campoDor.option("value");
			var pDorDescricao = campoDorDescricao.option("value");
			var pRedeVenoso = campoRedeVenoso.option("value");
			var pRedeVenosoDescricao = campoRedeVenosoDescricao.option("value");
			var pMedoApreensao = campoMedoApreensao.option("value");
			var pMedoApreensaoDescricao = campoMedoApreensaoDescricao.option("value");
			var pInternacaoSocial = campoInternacaoSocial.option("value");
			var pInternacaoSocialDescricao = campoInternacaoSocialDescricao.option("value");
			var pHemograma = campoHemograma.option("value");
			var pFuncaoRenal = campoFuncaoRenal.option("value");
			var pHipatica = campoHipatica.option("value");
			var pNeurologicas = campoNeurologicas.option("value");
			var pConferirPaciente = campoConferirPaciente.option("value");
			var pConferirPrescricao = campoConferirPrescricao.option("value");
			var pConferirEtiqueta = campoConferirEtiqueta.option("value");
			var pConferirSinais = campoConferirSinais.option("value");
			//Observações
			var pDispensacao = campoDispensacao.option("value");
			var pObservadoPor = campoObservadoPor.option("value");
			var pIntercorrencia = campoIntercorrencia.option("value");
			var pIntercorrenciaQual = campoIntercorrenciaQual.option("value");
			var pOutrasObservacoes = campoOutrasObservacoes.option("value");
			var pObservacoesEnfermagem = campoObservacoesEnfermagem.option("value");
			// Aplicação de Medicamento
			var pAplicMedicamentosPerdSa = ""; //campoDiagnosticoPerdaSanguinea.option("value");
			var pAplicMedicamentosBariatr = ""; // = campoDiagnosticoBariatrica.option("value");
			var pAplicMedicamentosOutrosD509 = ""; // = campoDiagnosticoOutros.option("value");
			var pAplicMedicamentosOutros = ""; // = campoTextDiagnosticoOutros.option("value");
			var pAplicMedicamentosAlerta = ""; //campoApliMedAlerta.option("value");
			var pApliMedDiagnostico = ""; //campoApliMedDiagnostico.option("value");
			//Prescrição Ambulatorial
			var pPrescAmbIntervalo = campoPrescAmbIntervalo.option("value");
			var pPrescAmbNCiclo = campoPrescAmbNCiclo.option("value");
			var pPrescAmbInicioAplic = campoPrescAmbInicioAplic.option("value");
			var pPrescAmbDias = campoPrescAmbDias.option("value");

			var pPrescAmbHb =	campoPrescAmbHb.option("value");
			var pPrescAmbHtc = campoPrescAmbHtc.option("value");
			var pPrescAmbPlaq =	campoPrescAmbPlaq.option("value");
			var pPrescAmbLeuc =	campoPrescAmbLeuc.option("value");
			var pPrescAmbNeutrof = campoPrescAmbNeutrof.option("value");
			var pPrescAmbMedido =	campoPrescAmbMedido.option("value");
			var pPrescAmbBombainf =	campoPrescAmbBombainf.option("value");
			//
			if (pCID) pCID = pCID.join(",");
			if (pDiagnostico) pDiagnostico = pDiagnostico.join(",");
			if (pMedicamentoUso) pMedicamentoUso = pMedicamentoUso.join(",");
			//if (pComorbidades) pComorbidades = pComorbidades.join(",");
			if (pApliMedDiagnostico) pApliMedDiagnostico = pApliMedDiagnostico.join(",");
			//
			
			var pNomeMedicamento = campoNomeMedicamento.option("value");
			var pNomeFabriacente = campoNomeFabriacente.option("value");
			var pDataInicio = campoDataInicio.option("text");
			var pDataAparecimento = campoDataAparecimento.option("text");
			var pReacaoMedLote = campoReacaoMedLote.option("value");
			var pReacaoMedValidad = campoReacaoMedValidad.option("text");
			var pReacaoMedPeso = campoReacaoMedPeso.option("value");
			var pReacaoMedAlt = campoReacaoMedAlt.option("value");
			var pMedicacoesAntes = campoMedicacoesAntes.option("value");
			var pMedicacoesAntesFreq = campoMedicacoesAntesFreq.option("value");
			var pMedicacosAntesFreqEsp = campoMedicacosAntesFreqEsp.option("value");
			var pGotejamento = campoGotejamento.option("value");
			var pDiluicao1 = campoDiluicao1.option("value");
			var pDiluicao2 = campoDiluicao2.option("value");
			var pGotejamentoSF = campoGotejamentoSF.option("value");
			var pBolus = campoBolus.option("value");
			var pBolusDuracao = campoBolusDuracao.option("value");
			var pIntramoscular = campoIntramoscular.option("value");
			var pIntramoscularDuracao = ""; //campoIntramoscularDuracao.option("value");
			var pOral = campoOral.option("value");
			var pOralPosologia = campoOralPosologia.option("value");
			var pIngestao = campoIngestao.option("value");
			var pSinaisSintomas = campoSinaisSintomas.option("value");
			var pIrritante = campoIrritante.option("value");
			var pVesicante = campoVesicante.option("value");
			var pIncidenteLocalNao = campoIncidenteLocalNao.option("value");
			var pIncidenteLocal = campoIncidenteLocal.option("value");
			var pCompressaQuente = campoCompressaQuente.option("value");
			var pCompressaFria = campoCompressaFria.option("value");
			var pCompressaNao = campoCompressaNao.option("value");			
			var pCondutaAcompanhamento = campoCondutaAcompanhamento.option("value");			
			var pConclusao = campoConclusao.option("value");			
			var pHistorico = campoHistorico.option("value");			
			var pMedico = textMedico.option("value");
			//
			$.post(urlPreparacao,{method:"ArmProntuario",pCodProntuario:pCodProntuario,pAdmissao:pAdmissao,
				pCodLeito:pCodLeito,pProtocoloEsquema:pProtocoloEsquema,pNumCiclo:pNumCiclo,pDiaCiclo:pDiaCiclo,
				pDiagnostico:pDiagnostico,pAssinar: flagAssinar,pCID:pCID,pComorbidades:pComorbidades,pComorbidadesDM:pComorbidadesDM,
				pComorbidadesHAS:pComorbidadesHAS,pComorbidadesIRC:pComorbidadesIRC,pComorbidadesICC:pComorbidadesICC,
				pComorbidadesAVC:pComorbidadesAVC,pComorbidadesCodronariopatia:pComorbidadesCodronariopatia,
				pComorbidadesOutros:pComorbidadesOutros,pCirugiasAnteriores:pCirugiasAnteriores,
				pCirugiasAnterioresOnde:pCirugiasAnterioresOnde,pAlergia:pAlergia,pAlergiaAQue:pAlergiaAQue,
				pInfusaoVeiaPeriferica:pInfusaoVeiaPeriferica,pInfusaoPort:pInfusaoPort,pInfusaoPICC:pInfusaoPICC,
				pInfusaoSC:pInfusaoSC,pInfusaoIM:pInfusaoIM,pInfusao:pInfusao,pFluxoCateter:pFluxoCateter,
				pFinalizacao:pFinalizacao,pIncidente:pIncidente,pIncidenteQual:pIncidenteQual,pPeso:pPeso,pAltura:pAltura,
				pSC:pSC,pRiscoFlebite:pRiscoFlebite,pNeuropsiquiatrico:pNeuropsiquiatrico,
				pPadraoRespiratorio:pPadraoRespiratorio,pRitmoCardiaco:pRitmoCardiaco,
				pPeleMucosa:pPeleMucosa,pDor:pDor,pDorDescricao:pDorDescricao,pRedeVenoso:pRedeVenoso,
				pRedeVenosoDescricao:pRedeVenosoDescricao,pMedoApreensao:pMedoApreensao,
				pMedoApreensaoDescricao:pMedoApreensaoDescricao,pInternacaoSocial:pInternacaoSocial,
				pInternacaoSocialDescricao:pInternacaoSocialDescricao,pHemograma:pHemograma,pFuncaoRenal:pFuncaoRenal,
				pHipatica:pHipatica,pNeurologicas:pNeurologicas,pConferirPaciente:pConferirPaciente,
				pConferirPrescricao:pConferirPrescricao,pConferirEtiqueta:pConferirEtiqueta,pConferirSinais:pConferirSinais,
				pDispensacao:pDispensacao,pObservadoPor:pObservadoPor,pIntercorrencia:pIntercorrencia,
				pIntercorrenciaQual:pIntercorrenciaQual,pAplicMedicamentosPerdSa:pAplicMedicamentosPerdSa,
				pAplicMedicamentosBariatr:pAplicMedicamentosBariatr,pAplicMedicamentosOutrosD509:pAplicMedicamentosOutrosD509,
				pAplicMedicamentosOutros:pAplicMedicamentosOutros,pAplicMedicamentosAlerta:pAplicMedicamentosAlerta,
				pOutrasObservacoes:pOutrasObservacoes,pObservacoesEnfermagem:pObservacoesEnfermagem,pPrescAmbHb:pPrescAmbHb,pPrescAmbHtc:pPrescAmbHtc,
				pPrescAmbPlaq:pPrescAmbPlaq,pPrescAmbLeuc:pPrescAmbLeuc,pPrescAmbNeutrof:pPrescAmbNeutrof,
				pPrescAmbMedido:pPrescAmbMedido,pPrescAmbBombainf:pPrescAmbBombainf,
				pPrescAmbIntervalo:pPrescAmbIntervalo,pPrescAmbNCiclo:pPrescAmbNCiclo,
				pPrescAmbInicioAplic:pPrescAmbInicioAplic,pPrescAmbDias:pPrescAmbDias,YBED:YBED,
				pApliMedDiagnostico:pApliMedDiagnostico,pMedicamentoUso:pMedicamentoUso,
				
				pNomeMedicamento: pNomeMedicamento,pNomeFabriacente: pNomeFabriacente,pDataInicio: pDataInicio,
				pDataAparecimento: pDataAparecimento,pReacaoMedLote: pReacaoMedLote,pReacaoMedValidad: pReacaoMedValidad,
				pReacaoMedPeso: pReacaoMedPeso,pReacaoMedAlt: pReacaoMedAlt,pMedicacoesAntes: pMedicacoesAntes,
				pMedicacoesAntesFreq: pMedicacoesAntesFreq,pMedicacosAntesFreqEsp: pMedicacosAntesFreqEsp,
				pGotejamento: pGotejamento,pDiluicao1: pDiluicao1,pDiluicao2: pDiluicao2,pGotejamentoSF: pGotejamentoSF,
				pBolus: pBolus,pBolusDuracao: pBolusDuracao,pIntramoscular: pIntramoscular,
				pIntramoscularDuracao: pIntramoscularDuracao,pOral: pOral,pOralPosologia: pOralPosologia,
				pIngestao: pIngestao,pSinaisSintomas: pSinaisSintomas,pIrritante: pIrritante,pVesicante: pVesicante,
				pIncidenteLocalNao: pIncidenteLocalNao,pIncidenteLocal: pIncidenteLocal,pCompressaQuente: pCompressaQuente,
				pCompressaFria: pCompressaFria,pCompressaNao: pCompressaNao,
				pCondutaAcompanhamento: pCondutaAcompanhamento, pConclusao: pConclusao,
				pHistorico: pHistorico,pMedico: pMedico,pMedicoExterno:pMedicoExterno

			},function(objeto){
				if (objeto.status==1){
					if (objeto.dataHoraAssinatura != "") {
						$("#spAssinar").css("color","green")
						$("#btnAssinar").attr("title", "PEP assinado");
						$("#spAssinarTexto").css("color","green");
						$("#btnFinalizar").attr("bloquear","0")
						$("#btnFinalizar").css("background-color","")
						$("#btnFinalizar").css("border-color","");
					}else{
						$("#spAssinar").css("color","#ffffff");
						$("#spAssinarTexto").css("color","#ffffff");
						$("#btnAssinar").attr("title", "Assinar");
						$("#btnFinalizar").css("background-color","#Cccccc")
						$("#btnFinalizar").css("border-color","#cccccc");
						$("#btnFinalizar").attr("bloquear","1")
						$("#btnFinalizar").attr("title", "Prontuário pendente de assinatura do Médico.");
						$("#divExibirAssinaturaTitulo").html("");
						$("#divExibirAssinatura").html("");
					}
					if (flagAssinar) {
						DevExpress.ui.notify("PEP Assinado com Sucesso!","success");
					}else{
						DevExpress.ui.notify("Dados Salvos com Sucesso!","success");
					}
					preencherIcones();
				}else{
					DevExpress.ui.notify("Erro: "+objeto.status,"error");
				}
			},"json");
		};
		
		function preencherIcones(){
			$.get(urlPreparacao,{method:"ImprimirIcones",pCodProntuario:pCodProntuario, pCodSetor: "QUIMIOTERAPIA"},
			function(rs){
				$("#divIcones").html(rs);
			});
		}		
		
		function alertaPrescricao(){
			/*var retorno = #server(VAR.CSP.VARContrAtendQuimioterapico.AlertaPrescricao(pCodProntuario))#
			if (retorno == 0) {
				$("#divAlertaPrescricao").html("&nbsp;");
			}else{
				$("#divAlertaPrescricao").html("Prescrição para Atendimento");
			}*/
		}			

		function abrePesquisaCID(objRetornoCID, conteudoCampo){
			 popupOptions = {
		        width: "90%",
		        height: "90%",
		        showTitle: true,
		        title: "Pesquisa CID",
		        visible: true,
		        dragEnabled: false,
		        closeOnOutsideClick: false,
		        onHidden: function(){
							var arrayCID	= [];
							openPesquisaCIDLista.getSelectedRowsData().then(function (rowData) {
								$.each(rowData, function(count, dados) {
									arrayCID.push(dados.CodigodoCID);
								});
							}).done(function(){
				      	objRetornoCID.option("value", arrayCID)  
							});
			      }
		    
		    }		
		    if ($("#openPesquisaCID").html()!=""){
		    	openPesquisaCID.dispose()
		    	openPesquisaCIDLista.dispose()
		    }
	 			$("#openPesquisaCID").html("<div id='openPesquisaCIDLista'></div>")
				openPesquisaCID = $("#openPesquisaCID").dxPopup(popupOptions).dxPopup("instance")
				preparaPesquisaCID(conteudoCampo)
		}		
		
		function preparaPesquisaCID(pConteudoCampo){
	      openPesquisaCIDLista = $("#openPesquisaCIDLista").dxDataGrid({
				dataSource:  new DevExpress.data.DataSource({
					store: new DevExpress.data.CustomStore({
						key: "CodigodoCID",
						loadMode: "raw",
						load: function(){
		        	var d = $.Deferred();
							$.getJSON(urlPreparacao, {method: "getListCID"},function(retorno){
								d.resolve(retorno);
								openPesquisaCIDLista.selectRows(pConteudoCampo, true); 
							});
							return d.promise();
						}
					})
				}),
				columns: [
					{dataField: "CodigodoCID",caption: "Código"},
					{dataField: "DescricaoResumida", caption: "Descrição"},
					{dataField: "DescCategoria",caption: "Categoria", groupIndex: 0},
				],	
				allowColumnReordering: true,
				columnAutoWidth: true,
				selection: { mode: "multiple", deferred: true },
				allowColumnResizing: true,
				height: "100%",	
				headerFilter: { visible: false },
				hoverStateEnabled: true,
				filterRow: { visible: true },
				showBorders: true,
				showRowLines: true,
				grouping: { autoExpandAll: false },
				searchPanel: { visible: false }, 
				groupPanel: { visible: false },
				export: { enabled: false },
				stateStoring: { enabled: false }, 
				columnChooser: { enabled: false, mode: "dragAndDrop" },
				sorting: { mode: "multiple" },
				rowAlternationEnabled: true,
				wordWrapEnabled:true,
				pager: {
					showPageSizeSelector: true,
					allowedPageSizes: [20, 50, 100, 150, 200],
					showInfo: true,
					showNavigationButtons: true,
					visible: true 
				},
				paging: { enabled: true, pageSize: 20 }
			}).dxDataGrid("instance")
		}
		
		dataSourceDrogaQuimio = new DevExpress.data.DataSource({
			store: new DevExpress.data.CustomStore({
				load: function(args) {
					return $.getJSON(urlPreparacao,{method:"CarregaProdutos", pFiltro: args.searchValue,
						pTake: args.take, pSkip: args.skip, YLOCATION: YLOCATION, pContaContabil: '00000782'});
				},
				byKey: function(args) {
					return $.getJSON(urlPreparacao,{method:"CarregaProdutos", pKey: args, YLOCATION: YLOCATION, pContaContabil: '00000782'});
				}
			})
		});
				
		$("#divCadastrarQuimio").dxPopup({
			visible: false,
			title: "Cadastrar Quimio",
			width: 650,
			height: 580,
			position: {
				my: "center",
				at: "center",
				of: window
			},
			dragEnabled: true,
			contentTemplate: function(e) {
				formCadastrarEtiqueta = $("<div id='formCadastrarQuimio'>").dxForm({
					readOnly: false,
					alignItemLabels: true,
					showColonAfterLabel: true,
					labelLocation: "top",
					colCount: 4,
					items: [
						{dataField: "Quimio", colSpan: 2, editorOptions: {readOnly: true}},
						{},{},
						{dataField: "Medicamento", colSpan: 4, editorType: "dxSelectBox",
							editorOptions: {
								dataSource: dataSourceDrogaQuimio,
								displayExpr: "DescProduto",
								valueExpr: "CodProduto",
								searchEnabled: true,
								onValueChanged: function (e) {  
									if (e.value != "" && e.value != null) {
										$.getJSON(urlPreparacao,{method:"ChecaInteracoes", pCodProntuario:pCodProntuario, 
										pCodProduto: e.value},function(objeto){
											if (objeto.status==1){
												$("#formCadastrarQuimio").dxForm("instance").getEditor("InteracaoConduta").option({"readOnly": false, "value": ""});
												DevExpress.ui.notify(objeto.mensagem,"warning",3000);
											}else{
												$("#formCadastrarQuimio").dxForm("instance").getEditor("InteracaoConduta").option({"readOnly": true, "value": ""});	
											}		
										});
									}else{
										$("#formCadastrarQuimio").dxForm("instance").getEditor("InteracaoConduta").option({"readOnly": true, "value": ""});
									}
								}
							}
						},
						{dataField: "Dose", colSpan: 2},
						{dataField: "Diluente", label: { text: "Diluente (ml)"}, colSpan: 2},
						{dataField: "ViaInfusao", label: { text: "Via de Infusão"}, colSpan: 2},
						{dataField: "TempoInfusao", label: { text: "Tempo de Infusão"}, colSpan: 2},
						{dataField: "DataInicio", label: { text: "Data de Início"}, editorType: "dxDateBox",},
						{dataField: "HoraInicio", label: { text: "Hora de Início"},},
						{dataField: "DataTermino", label: { text: "Data de Término"}, editorType: "dxDateBox",},
						{dataField: "HoraTermino", label: { text: "Hora de Término"}},
						{dataField: "InteracaoConduta", colSpan: 4, label: { text: "Interação (Conduta)"}, 
							editorType: "dxTextArea", editorOptions: {readOnly: true}},
						{},
						{itemType: "button", horizontalAlignment: "right", buttonOptions: {
	           	text: "Salvar", icon: "save",
							onClick: function(){
								var pQuimio = $("#formCadastrarQuimio").dxForm("instance").getEditor("Quimio").option("value");
								var pMedicamento = $("#formCadastrarQuimio").dxForm("instance").getEditor("Medicamento").option("value");
								var pDose = $("#formCadastrarQuimio").dxForm("instance").getEditor("Dose").option("value");
								var pDiluente = $("#formCadastrarQuimio").dxForm("instance").getEditor("Diluente").option("value");
								var pViaInfusao = $("#formCadastrarQuimio").dxForm("instance").getEditor("ViaInfusao").option("value");
								var pTempoInfusao = $("#formCadastrarQuimio").dxForm("instance").getEditor("TempoInfusao").option("value");
								var pDataInicio = $("#formCadastrarQuimio").dxForm("instance").getEditor("DataInicio").option("text");
								var pHoraInício = $("#formCadastrarQuimio").dxForm("instance").getEditor("HoraInicio").option("value");
								var pDataTermino = $("#formCadastrarQuimio").dxForm("instance").getEditor("DataTermino").option("text");
								var pHoraTermino = $("#formCadastrarQuimio").dxForm("instance").getEditor("HoraTermino").option("value");
								var pInteracaoConduta = $("#formCadastrarQuimio").dxForm("instance").getEditor("InteracaoConduta").option("value");
								if (pMedicamento == "") {
									DevExpress.ui.notify("É obrigatório preencher o campo Medicamento.","warning",1500);
									return;
								}
								$.getJSON(urlPreparacao,{method:"ArmQuimio", pCodProntuario:pCodProntuario, 
									pQuimio:pQuimio, pMedicamento:pMedicamento, pDose:pDose, pDiluente:pDiluente, 
									pViaInfusao:pViaInfusao, pTempoInfusao:pTempoInfusao,pDataInicio:pDataInicio, 
									pHoraInício:pHoraInício,pDataTermino:pDataTermino,pHoraTermino:pHoraTermino,
									pInteracaoConduta:pInteracaoConduta},function(objeto){
									if (objeto.status==1){
										dataSourceQuimio.reload();
										DevExpress.ui.notify("Dados Salvos com Sucesso!","success");
										$("#divCadastrarEtiqueta").dxPopup("hide");
								}else{
										DevExpress.ui.notify("Erro: "+objeto.status,"error");
									}
								});
							}}
						},
						{itemType: "button", horizontalAlignment: "left", buttonOptions: {
	          	text: "Fechar", icon: "close",
							onClick: function(){
								$("#divCadastrarQuimio").dxPopup("hide");
							}}
						}
					]
				});
				
				e.append(formCadastrarEtiqueta);
			}        		
		});

		var devices = [];
		var devicesCampo = [];
		BrowserPrint.getDefaultDevice("printer", function(device) {
			BrowserPrint.getLocalDevices(function(device_list){
				if (device_list.length == 0) return;
				var qtdeImpressora = device_list.length - 1;
				for(var i = 0; ; i++){
					//Add device to list of devices and to html select element
					var device = device_list[i];
					devices.push(device);
					listDevice = {"name": device.name, "uid": i}
					devicesCampo.push(listDevice);
					if (i == qtdeImpressora) return; 
				}
			}, function(){
				DevExpress.ui.notify("Erro ao obter dispositivos locais","error");
			},"printer");
		}, function(error){
			DevExpress.ui.notify("Erro ao obter dispositivos locais","error");
		})

		$("#divImprimirEtiqueta").dxPopup({
			visible: (YBED == "JULIO" ? false : false),
			title: "Imprimir Etiqueta",
			width: 650,
			height: 280,
			position: {
				my: "center",
				at: "center",
				of: window
			},
			dragEnabled: true,
			contentTemplate: function(e) {
				formImprimirEtiqueta = $("<div id='formImprimirEtiqueta'>").dxForm({
					readOnly: false,
					alignItemLabels: true,
					showColonAfterLabel: true,
					labelLocation: "top",
					colCount: 4,
					items: [
						{dataField: "Modelo", colSpan: 4, editorType: "dxSelectBox",
							editorOptions: {
								dataSource: [{id: 1, text: "Pedido Médico"},{id: 2, text: "Amostra"}], //dataSourceDrogaQuimio,
								displayExpr: "text",
								valueExpr: "id",
								value: 1,
								//showClearButton: true,
								//searchEnabled: true,
							}
						},
						{dataField: "Impressora", colSpan: 3, editorType: "dxSelectBox",
							editorOptions: {
								dataSource: devicesCampo, //dataSourceDrogaQuimio,
								displayExpr: "name",
								valueExpr: "uid",
								//showClearButton: true,
								//searchEnabled: true,
							}
						},
						{dataField: "Quantidade", colSpan: 1, editorType: "dxNumberBox",
							editorOptions: {
				        value: 1,
				        min: 1,
				        max: 20,
							}
						},
						{itemType: "button", colSpan: 2, horizontalAlignment: "right", buttonOptions: {
	           	text: "Imprimir", icon: "print",
							onClick: function(){
								writeToSelectedPrinter("");
							}}
						},
						{itemType: "button", colSpan: 2, horizontalAlignment: "left", buttonOptions: {
	          	text: "Fechar", icon: "close",
							onClick: function(){
								$("#divImprimirEtiqueta").dxPopup("hide");
							}}
						}
					]
				});
				
				e.append(formImprimirEtiqueta);
			}        		
		});

		function writeToSelectedPrinter(dataToWrite){
			
			if ($("#formImprimirEtiqueta").dxForm("instance").getEditor("Impressora").option("value") == null) {
				DevExpress.ui.notify("Selecione a impressora","warning");
				return
			}
			
			$.getJSON(urlPreparacaoQui,{method:"recuperarEtiqueta", pCodProntuario: pCodProntuario, 
			pAdmissao: pAdmissao, YBED: YBED},function(objeto){
				
				if ($("#formImprimirEtiqueta").dxForm("instance").getEditor("Modelo").option("value") == 1) {
					dataToWrite =  ""
					dataToWrite += "^XA~TA000~JSN^LT0^MNW^MTT^PON^PMN^LH0,0^JMA^PR2,2~SD30^JUS^LRN^CI0^XZ\n" //BASIC-59
					dataToWrite += "^XA\n"
					dataToWrite += "^MD20\n"			//MD - Media Darkness LEAN-75 LEAN-89
					dataToWrite += "^MMT\n"
					dataToWrite += "^PW831\n"
					dataToWrite += "^LL0220\n"
					dataToWrite += "^LS0\n"

					dataToWrite += "^FT220,55^A0N,22,22^FH\^FD"+""+objeto.paciente+"^FS\n"
					dataToWrite += "^FT220,87^A0N,20,20^FH\^FD"+"NASC.: "+objeto.dataNasc+"    PRONTUARIO: "+objeto.prontuario+"^FS\n"
					dataToWrite += "^FT220,119^A0N,20,20^FH\^FD"+"MAE: "+objeto.mae+"^FS\n"
					dataToWrite += "^FT220,152^A0N,20,20^FH\^FD"+"ADMISSAO: "+pAdmissao+" - "+objeto.dataAdm+"^FS\n"
					dataToWrite += "^PQ"+$("#formImprimirEtiqueta").dxForm("instance").getEditor("Quantidade").option("value")+",0,1,Y^XZ\n"
					
				}else{
					dataToWrite =  ""
					dataToWrite += "^XA~TA000~JSN^LT0^MNW^MTT^PON^PMN^LH0,0^JMA^PR2,2~SD30^JUS^LRN^CI0^XZ\n" //BASIC-59
					dataToWrite += "^XA\n"
					dataToWrite += "^MD20\n"			//MD - Media Darkness LEAN-75 LEAN-89
					dataToWrite += "^MMT\n"
					dataToWrite += "^PW831\n"
					dataToWrite += "^LL0220\n"
					dataToWrite += "^LS0\n"

					dataToWrite += "^FT220,42^A0N,20,20^FH\^FD"+""+objeto.paciente+"^FS\n"
					dataToWrite += "^FT220,64^A0N,18,18^FH\^FD"+"NASC.: "+objeto.dataNasc+"    PRONTUARIO: "+objeto.prontuario+"^FS\n"
					dataToWrite += "^FT220,88^A0N,18,18^FH\^FD"+"ADMISSAO: "+pAdmissao+" - "+objeto.dataAdm+"^FS\n"
					dataToWrite += "^FT210,100^A0N,16,16^FH\^FD"+"-------------------------------------------------------------"+"^FS\n"
					dataToWrite += "^FT220,116^A0N,18,18^FH\^FD"+"MEDICAMENTO: "+"^FS\n"
					dataToWrite += "^FT220,138^A0N,18,18^FH\^FD"+"SOLUCAO:"+"^FS\n"
					dataToWrite += "^FT220,160^A0N,18,18^FH\^FD"+"RESPONSAVEL: "+objeto.responsavel+"^FS\n"

					dataToWrite += "^PQ"+$("#formImprimirEtiqueta").dxForm("instance").getEditor("Quantidade").option("value")+",0,1,Y^XZ\n"
				}
			
				selected_device = devices[$("#formImprimirEtiqueta").dxForm("instance").getEditor("Impressora").option("value")];
				//selected_device = devices[0];
				selected_device.send(dataToWrite);
			});
			
		}
	
	
		$("#divImprimirEtiquetaDados").dxPopup({
			visible: false,
			title: "Imprimir Etiqueta Dados",
			width: 650,
			height: 200,
			position: {
				my: "center",
				at: "center",
				of: window
			},
			dragEnabled: true,
			contentTemplate: function(e) {
				formImprimirEtiquetaDados = $("<div id='formImprimirEtiquetaDados'>").dxForm({
					readOnly: false,
					alignItemLabels: true,
					showColonAfterLabel: true,
					labelLocation: "top",
					colCount: 4,
					items: [
						{dataField: "Impressora", colSpan: 3, editorType: "dxSelectBox",
							editorOptions: {
								dataSource: devicesCampo, //dataSourceDrogaQuimio,
								displayExpr: "name",
								valueExpr: "uid",
								//showClearButton: true,
								//searchEnabled: true,
							}
						},
						{dataField: "Quantidade", colSpan: 1, editorType: "dxNumberBox",
							editorOptions: {
				        value: 1,
				        min: 1,
				        max: 20,
							}
						},
						{itemType: "button", colSpan: 2, horizontalAlignment: "right", buttonOptions: {
	           	text: "Imprimir", icon: "print",
							onClick: function(){
								writeToSelectedPrinterDados("");
							}}
						},
						{itemType: "button", colSpan: 2, horizontalAlignment: "left", buttonOptions: {
	          	text: "Fechar", icon: "close",
							onClick: function(){
								$("#divImprimirEtiquetaDados").dxPopup("hide");
							}}
						}
					]
				});
				
				e.append(formImprimirEtiquetaDados);
			}        		
		});


		function writeToSelectedPrinter(dataToWrite){
			
			if ($("#formImprimirEtiqueta").dxForm("instance").getEditor("Impressora").option("value") == null) {
				DevExpress.ui.notify("Selecione a impressora","warning");
				return
			}
			
			$.getJSON(urlPreparacaoQui,{method:"recuperarEtiqueta", pCodProntuario: pCodProntuario, 
			pAdmissao: pAdmissao, YBED: YBED},function(objeto){
				
				if ($("#formImprimirEtiqueta").dxForm("instance").getEditor("Modelo").option("value") == 1) {
					dataToWrite =  ""
					dataToWrite += "^XA~TA000~JSN^LT0^MNW^MTT^PON^PMN^LH0,0^JMA^PR2,2~SD30^JUS^LRN^CI0^XZ\n" //BASIC-59
					dataToWrite += "^XA\n"
					dataToWrite += "^MD20\n"			//MD - Media Darkness LEAN-75 LEAN-89
					dataToWrite += "^MMT\n"
					dataToWrite += "^PW831\n"
					dataToWrite += "^LL0220\n"
					dataToWrite += "^LS0\n"

					dataToWrite += "^FT220,55^A0N,22,22^FH\^FD"+objeto.paciente+"^FS\n"
					dataToWrite += "^FT220,87^A0N,20,20^FH\^FD"+"NASC.: "+objeto.dataNasc+"    PRONTUARIO: "+objeto.prontuario+"^FS\n"
					dataToWrite += "^FT220,119^A0N,20,20^FH\^FD"+"MAE: "+objeto.mae+"^FS\n"
					dataToWrite += "^FT220,152^A0N,20,20^FH\^FD"+"ADMISSAO: "+pAdmissao+" - "+objeto.dataAdm+"^FS\n"
					dataToWrite += "^PQ"+$("#formImprimirEtiqueta").dxForm("instance").getEditor("Quantidade").option("value")+",0,1,Y^XZ\n"
					
				}else{
					dataToWrite =  ""
					dataToWrite += "^XA~TA000~JSN^LT0^MNW^MTT^PON^PMN^LH0,0^JMA^PR2,2~SD30^JUS^LRN^CI0^XZ\n" //BASIC-59
					dataToWrite += "^XA\n"
					dataToWrite += "^MD20\n"			//MD - Media Darkness LEAN-75 LEAN-89
					dataToWrite += "^MMT\n"
					dataToWrite += "^PW831\n"
					dataToWrite += "^LL0220\n"
					dataToWrite += "^LS0\n"

					dataToWrite += "^FT220,42^A0N,20,20^FH\^FD"+""+objeto.paciente+"^FS\n"
					dataToWrite += "^FT220,64^A0N,18,18^FH\^FD"+"NASC.: "+objeto.dataNasc+"    PRONTUARIO: "+objeto.prontuario+"^FS\n"
					dataToWrite += "^FT220,88^A0N,18,18^FH\^FD"+"ADMISSAO: "+pAdmissao+" - "+objeto.dataAdm+"^FS\n"
					dataToWrite += "^FT210,100^A0N,16,16^FH\^FD"+"-------------------------------------------------------------"+"^FS\n"
					dataToWrite += "^FT220,116^A0N,18,18^FH\^FD"+"MEDICAMENTO: "+"^FS\n"
					dataToWrite += "^FT220,138^A0N,18,18^FH\^FD"+"SOLUCAO:"+"^FS\n"
					dataToWrite += "^FT220,160^A0N,18,18^FH\^FD"+"RESPONSAVEL: "+objeto.responsavel+"^FS\n"

					dataToWrite += "^PQ"+$("#formImprimirEtiqueta").dxForm("instance").getEditor("Quantidade").option("value")+",0,1,Y^XZ\n"
				}
			
				selected_device = devices[$("#formImprimirEtiqueta").dxForm("instance").getEditor("Impressora").option("value")];
				//selected_device = devices[0];
				selected_device.send(dataToWrite);
			});
			
		}
		
		function writeToSelectedPrinterDados(dataToWrite){
			
			if ($("#formImprimirEtiquetaDados").dxForm("instance").getEditor("Impressora").option("value") == null) {
				DevExpress.ui.notify("Selecione a impressora","warning");
				return
			}
			
			$.getJSON(urlPreparacaoQui,{method:"recuperarEtiqueta", pCodProntuario: pCodProntuario, 
			pAdmissao: pAdmissao, YBED: YBED},function(objeto){
				
				dataToWrite =  ""
				dataToWrite += "^XA~TA000~JSN^LT0^MNW^MTT^PON^PMN^LH0,0^JMA^PR2,2~SD30^JUS^LRN^CI0^XZ\n" //BASIC-59
				dataToWrite += "^XA\n"
				dataToWrite += "^MD20\n"			//MD - Media Darkness LEAN-75 LEAN-89
				dataToWrite += "^MMT\n"
				dataToWrite += "^PW831\n"
				dataToWrite += "^LL0220\n"
				dataToWrite += "^LS0\n"

				dataToWrite += "^FT220,42^A0N,20,20^FH\^FD"+""+objeto.paciente+"^FS\n"
				dataToWrite += "^FT220,64^A0N,18,18^FH\^FD"+"NASC.: "+objeto.dataNasc+"    PRONTUARIO: "+objeto.prontuario+"^FS\n"
				dataToWrite += "^FT220,88^A0N,18,18^FH\^FD"+"ADMISSAO: "+pAdmissao+" - "+objeto.dataAdm+"^FS\n"
				dataToWrite += "^FT210,100^A0N,16,16^FH\^FD"+"-------------------------------------------------------------"+"^FS\n"
				dataToWrite += "^FT220,116^A0N,18,18^FH\^FD"+"MEDICAMENTO: "+medicamentoDados+"^FS\n"
				dataToWrite += "^FT220,138^A0N,18,18^FH\^FD"+"SOLUCAO: "+solucaoDados+"^FS\n"
				dataToWrite += "^FT220,160^A0N,18,18^FH\^FD"+"RESPONSAVEL: "+objeto.responsavel+"^FS\n"

				dataToWrite += "^PQ"+$("#formImprimirEtiquetaDados").dxForm("instance").getEditor("Quantidade").option("value")+",0,1,Y^XZ\n"
			
				selected_device = devices[$("#formImprimirEtiquetaDados").dxForm("instance").getEditor("Impressora").option("value")];
				//selected_device = devices[0];
				selected_device.send(dataToWrite);
			});
			
		}
	
	
		dataSourceArquivo = new DevExpress.data.DataSource({ 
			store: new DevExpress.data.CustomStore({
				loadMode: "raw",
				load: function(){
					return $.getJSON(urlPreparacaoQui, {method: "getArquivos", pAdmissao: pAdmissao, YGIF: #(YGIF)#},function(retorno){
					});
				},
				remove : function(args){
					#server(VAR.CSP.VARContrAtendQuimioterapico.removerArquivo(args.Arquivo))#
				}
			})
		});		
		$("#openPesquisaArquivo").dxPopup({
			visible: false,
			title: "Anexos",
			width: 650,
			height: 500,
			position: {
				my: "center",
				at: "center",
				of: window
			},
			dragEnabled: true,
			contentTemplate: function(e) {
				gridArquivos = $("<div id='gridArquivos'>").dxDataGrid({
					dataSource: dataSourceArquivo,
					columns: [
						{dataField: "Documento"},
						{dataField: "dataModificacao", caption: "Data"},
					],	
					editing: {
						mode: "row",
						allowDeleting: true,
						useIcons: true
					},
					allowColumnReordering: true,
					columnAutoWidth: true,
					allowColumnResizing: true,
					height: "100%",	
					headerFilter: { visible: false },
					hoverStateEnabled: true,
					filterRow: { visible: true },
					showBorders: true,
					showRowLines: true,
					grouping: { autoExpandAll: false },
					searchPanel: { visible: false }, 
					groupPanel: { visible: false },
					export: { enabled: false },
					stateStoring: { enabled: false }, 
					columnChooser: { enabled: false, mode: "dragAndDrop" },
					sorting: { mode: "multiple" },
					rowAlternationEnabled: true,
					wordWrapEnabled:true,
					onRowClick: function(e){
						if (e.rowType == "data") {
							window.open(e.key.Arquivo,"Visualizar")
						}
					},
					pager: {
						showPageSizeSelector: true,
						allowedPageSizes: [20, 50, 100, 150, 200],
						showInfo: true,
						showNavigationButtons: true,
						visible: true 
					},
					paging: { enabled: true, pageSize: 20 },
					onToolbarPreparing: function(e) {
						e.toolbarOptions.items.unshift({
							location: "after",
							widget: "dxButton",
							options: {
								icon: "fa fa-upload",
								height: 36,
								width: 36,
								hint: "Upload de Prontuário",
								onClick: function(e) {
									window.open("VARUploadArquivoPEPEnfermagem.csp?pAdmissao="+pAdmissao,"uploadArquivo","width=450,height=200,"+
									"scrollbars=0,resizable=0,menubar=0,location=0,top=100,left=100")
									//uploadExames()
								}
							}
						})
					}
				});
				
				e.append(gridArquivos);
			}        		
		});

		$("#divCadastrarMedico").dxPopup({
			visible: false,
			title: "Cadastrar Médico",
			width: 650,
			height: 280,
			position: {
				my: "center",
				at: "center",
				of: window
			},
			dragEnabled: true,
			contentTemplate: function(e) {
				formCadastrarMedico = $("<div id='formCadastrarMedico'>").dxForm({
					readOnly: false,
					alignItemLabels: true,
					showColonAfterLabel: true,
					labelLocation: "top",
					colCount: 4,
					items: [
						{dataField: "Nome", label: { text: "Nome"}, colSpan: 4},
						{dataField: "CRMUF", label: { text: "U.F. CRM"}, colSpan: 1},
						{dataField: "CRMNumero", label: { text: "Número CRM"}, colSpan: 1, editorType: "dxNumberBox"},
						{},
						{},
						{},
						{itemType: "button", horizontalAlignment: "right", buttonOptions: {
	           	text: "Salvar", icon: "save",
							onClick: function(){
								var pNome = $("#formCadastrarMedico").dxForm("instance").getEditor("Nome").option("value");
								var pUFCRM = $("#formCadastrarMedico").dxForm("instance").getEditor("CRMUF").option("value");
								var pCRM = $("#formCadastrarMedico").dxForm("instance").getEditor("CRMNumero").option("value");
								//pré medicaçãoPreMedicacao
								if (pNome == "" || pUFCRM == "" || pCRM == "" ) {
									DevExpress.ui.notify("É obrigatório preencher todos os campos","warning",1500);
									return;
								}
								$.get(urlPreparacaoTransf,{method:"ArmMedico", pNome:pNome, 
									pUFCRM:pUFCRM, pCRM:pCRM,YBED:YBED},function(objeto){
									var array = objeto.split("|")
									if (array[0]==1){
										dataSourceMedico.reload();
										DevExpress.ui.notify("Dados Salvos com Sucesso!","success");
										$("#divCadastrarMedico").dxPopup("hide");
										campoMedicoExterno.option("value",array[1])
								}else{
										DevExpress.ui.notify("Erro: "+array[0],"error");
									}
								});
							}}
						},
						{itemType: "button", horizontalAlignment: "left", buttonOptions: {
	          	text: "Fechar", icon: "close",
							onClick: function(){
								$("#divCadastrarMedico").dxPopup("hide");
							}}
						}
					]
				});
				
				e.append(formCadastrarMedico);
			}        		
		});

	</script>
	</body>
</html>