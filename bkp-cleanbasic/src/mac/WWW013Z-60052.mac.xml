<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWW013Z" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWW013Z   ;WWW013Z;DT;ZEITERFASSUNG;07.08.1997  ; Compiled March 7, 2005 13:44:19
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		ZEITERFASSUNG
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	07.08.1997  
	;|
	;\------------------------------------------------------------------/
	;
	;
	;LISTE DER ANWESENDE UND ABWESENDEN ;list the And 
	SET BETRIEB=$GET(YLOCATION)
	IF BETRIEB="" SET BETRIEB=$ORDER(^WWW0121(0,YM,""))
	IF BETRIEB="" SET BETRIEB=1
	WRITE "<TABLE BORDER=0 NOWRAP CELLSPACING=0>"
	S YHTMFORM="WWW"
	DO KOPF
	WRITE "<TR>"
	WRITE "<TD ALIGN=middle>"
	WRITE $$^WWWTEXT(3176)  ; "Abwesend"
	WRITE "&nbsp;"
	WRITE "</TD>"
	WRITE "<TD VALIGN=middle align=right>"
	DO NUMMER
	WRITE "</TD>"
	WRITE "<TD ALIGN=middle>"
	WRITE $$^WWWTEXT(3175)  ;"Anwesend"
	WRITE "&nbsp;"
	WRITE "</TD>"
	WRITE "</TR>"
	WRITE "<TR>"
	WRITE "<TD>"
	DO ABWESEND
	WRITE "</TD>"
	WRITE "<TD align=middle VALIGN=middle>"
	DO STEMPEL
	WRITE "</TD>"
	WRITE "<TD>"
	DO ANWESEND
	WRITE "</TD>"
	WRITE "</TR>"
	WRITE "</TABLE>"
	QUIT
	;
	
STEMPEL ;
	;
	DO
	. WRITE "<A onClick='return doLink(this)' HREF=""JavaScript:SAVENOW();"">"
	. W "<bgsound src=""kasse.wav"">"
	. WRITE "<IMG SRC="""_YGIF_"tstamp.gif"" TITLE=""stempeln"" border=0></A>"
	QUIT
	;
	
ABWESEND ;
	;
	DO
	. WRITE "<A onClick='return doLink(this)' HREF=""JavaScript:document."_YHTMFORM_".Y"_YFORM_"M1.value='ABWESEND'; "
	. WRITE "SAVENOW();"
	. WRITE """>"
	. WRITE "<IMG SRC="""_YGIF_"tboard.gif"" height=150 TITLE=""Abwesend"" border=0></A>"
	QUIT
	;
	
ANWESEND ;
	;
	DO
	. WRITE "<A onClick='return doLink(this)' HREF=""JavaScript:"
	. WRITE "document."_YHTMFORM_".Y"_YFORM_"M1.value='ANWESEND'; "
	. WRITE "SAVENOW();"
	. WRITE """>"
	. WRITE "<IMG SRC="""_YGIF_"tboard.gif"" height=150 TITLE=""Anwesend"" border=0></A>"
	QUIT
	;
	
NUMMER ;
	;
	SET PERS=$PIECE($GET(^WWW013(0,YBED,1)),Y,22)
	;IF PERS="" SET PERS=YBED    ;AUSGESCHALT; 27449;FAN;07.03.05
	WRITE $$^WWWTEXT(3177)," "  ; "Personalnummer "
	WRITE "<INPUT TYPE=TEXT SIZE=12 NAME='Y"_YFORM_"M1' VALUE="""_PERS_""">"
	WRITE YCR
	WRITE "<BR>"
	WRITE $$^WWWTEXT(2)," "  ; "BEDIENERKENNUNG "
	WRITE "<INPUT TYPE=TEXT SIZE=12 NAME='Y"_YFORM_"M2' VALUE="""_YBED_""">"
	QUIT
	;
	
KOPF ;
	;
	WRITE "<TR>"
	WRITE "<TH COLSPAN=3 ALIGN=LEFT VALIGN=TOP>"
	DO ^WWWFRAME(0)
	WRITE "<TR>"  ;<TH ALIGN=LEFT VALIGN=TOP NOWRAP>"
	WRITE "<FONT SIZE=3>"
	SET A1=$$^WWWTEXT(30022) WRITE $PIECE(A1,",",$$^WWWDAY($H))
	WRITE ", "
	WRITE $$^WWWDATE($HOROLOG)
	WRITE "&nbsp;"
	WRITE "&nbsp;"
	WRITE "&nbsp;"
	WRITE " "_$$^WWWTIME($HOROLOG)_" " WRITE $$^WWWTEXT(3178)  ;Uhr ;timepiece 
	WRITE "&nbsp;"
	IF $DATA(^TERMIN9(0,SPRACHE,+$HOROLOG,1)) WRITE " <FONT COLOR=BLUE><B>"_^(1)_"</B></FONT>"
	;
	WRITE "&nbsp;"
	WRITE "&nbsp;"
	;
	;WRITE "</TH>"
	WRITE "</TR>"
	DO ^WWWFRAME(1)
	WRITE "</TR>"
	QUIT
	;
	
INOUT ;EINSPRUNG BEI SAVE DATENDATZ ;next to 
	;
	SET DH=$HOROLOG IF $PIECE($HOROLOG,",",2)<3600 SET DH=(+$HOROLOG-1)_","_((24*3600)+$PIECE($HOROLOG,".",2))
	DO ^WWWKOPF($$^WWWTEXT(34150))   ;personalkarte
	DO
	. WRITE "<TABLE BORDER=0>"
	. WRITE "<TR>"
	. WRITE "<TD>"
	. WRITE "<A HREF="""_YAKTION_"EP=WWWFORM&amp;YFORM="_YFORM
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE "<IMG SRC="""_YGIF_"hback.gif"" TITLE="""_$$^WWWTEXT(99)_""" border=0></A>"
	. WRITE "</TD>"
	. WRITE "</TR>"
	. WRITE "</TABLE>"
	. QUIT
	;
	;
	DO ^WWWFRAME(0)
	DO KOPF
	DO PERSON
	DO ^WWWFRAME(1)
	QUIT
	;
	
PERSON ;SUCHEN PERSON ;seek person 
	;
	SET PERS=$GET(%(YQUERY,"Y"_YFORM_"M1"))  ;PERSONALNUMMER
	IF PERS="ANWESEND" DO EINSP1 QUIT
	IF PERS="ABWESEND" DO EINSP2 QUIT
	IF PERS'="" SET MIT=$ORDER(^WWW013s(0,3,PERS,"")) IF MIT'=""  DO  QUIT
	. SET NAME=$PIECE($GET(^WWW013(0,MIT,1)),Y,1)
	. SET BETRIEB=+$PIECE($GET(^WWW013(0,MIT,1)),Y,44)
	. SET DH=$HOROLOG IF $PIECE($HOROLOG,",",2)<3600 SET DH=(+$HOROLOG-1)_","_((24*3600)+$PIECE($HOROLOG,".",2))
	. DO SPEI
	. QUIT
	SET PERS=$GET(%(YQUERY,"Y"_YFORM_"M2"))  ;PERSONALNUMMER
	IF PERS'="" IF $DATA(^WWW013(0,PERS,1)) SET MIT=PERS DO  QUIT
	. SET NAME=$PIECE($GET(^WWW013(0,MIT,1)),Y,1)
	. SET BETRIEB=+$PIECE($GET(^WWW013(0,MIT,1)),Y,44)
	. SET DH=$HOROLOG IF $PIECE($HOROLOG,",",2)<3600 SET DH=(+$HOROLOG-1)_","_((24*3600)+$PIECE($HOROLOG,".",2))
	. DO SPEI
	. QUIT
	WRITE "<TR>"
	WRITE "<TD>"
	WRITE PERS WRITE $$^WWWTEXT(3179)  ;"? Falsche Personalnummer"
	WRITE "</TD>"
	WRITE "</TR>"
	QUIT
	;
	;
	
EINSP1 ;EINSPRUNG ANWESEND
	;
	SET MIT=YBED
	WRITE "<TR>"
	WRITE "<TD>"  ;"<TD BGCOLOR="_YDARKGRAY_">"
	WRITE "<FONT SIZE=1>"
	WRITE "<STRONG><CENTER>"
	WRITE $$^WWWTEXT(3175)  ; "Anwesend"
	WRITE "</STRONG></CENTER>"
	WRITE "</TD>"
	WRITE "<TD>"
	WRITE "<FONT SIZE=1>"
	WRITE "<STRONG><CENTER>"
	WRITE $$^WWWTEXT(3180)  ; "seit Uhrzeit"
	WRITE "</STRONG></CENTER>"
	WRITE "</TD>"
	WRITE "<TD>"
	WRITE "<FONT SIZE=1>"
	WRITE "<STRONG><CENTER>"
	WRITE $$^WWWTEXT(3181)  ; "Gesamt heute"
	WRITE "</STRONG></CENTER>"
	WRITE "</TD>"
	WRITE "</TR>"
	SET YDDSATZ=1
	SET M="" FOR  SET M=$ORDER(^WWW013Z(YM,BETRIEB,+DH,M)) QUIT:M=""  DO
	. SET U="" F  SET U=$ORDER(^WWW013Z(YM,BETRIEB,+DH,M,U),-1) Q:U=""  IF U'="" IF $DATA(^WWW013Z(YM,BETRIEB,+DH,M,U,1,1)) DO  Q
	. . IF $DATA(^WWW013Z(YM,BETRIEB,+DH,M,U,1,1)) SET SATZ=^(1) DO
	. . . WRITE "<TR"
	. . . IF $GET(YDDSATZ)#2=1 WRITE " BGCOLOR="_YWHITE
	. . . IF $G(YDDSATZ)#2=0 WRITE " BGCOLOR="_YGRAY
	. . . WRITE ">"
	. . . WRITE "<TD ALIGN=LEFT>"
	. . . WRITE "<FONT SIZE=1>"
	. . . WRITE $PIECE($GET(^WWW013(0,M,1)),Y,1)
	. . . WRITE "</TD>"
	. . . WRITE "<TD>"
	. . . WRITE "<FONT SIZE=1>"
	. . . WRITE $$^WWWTIME(U)
	. . . WRITE "&nbsp;"
	. . . WRITE "</TD>"
	. . . WRITE "<TD>"
	. . . WRITE "<FONT SIZE=1>"
	. . . SET MIT=M
	. . . DO GESAMT
	. . . WRITE "&nbsp;"
	. . . WRITE ANWESEND
	. . . WRITE "</TD>"
	. . . WRITE "</TR>"
	. . . SET YDDSATZ=YDDSATZ+1
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
	;
	
EINSP2 ;EINSPRUNG ABWESEND ;absent 
	;
	SET MIT=YBED
	WRITE "<TR>"
	WRITE "<TD>"
	WRITE "<FONT SIZE=1>"
	WRITE "<STRONG><CENTER>"
	WRITE $$^WWWTEXT(3176)  ; "Abwesend"
	WRITE "</CENTER></STRONG>"
	W "</FONT>"
	WRITE "</TD>"
	WRITE "<TD>"
	WRITE "<FONT SIZE=1>"
	WRITE "<STRONG><CENTER>"
	WRITE $$^WWWTEXT(3182)  ; "letzte Anwesenheit"
	WRITE "</CENTER></STRONG>"
	W "</FONT>"
	WRITE "</TD>"
	WRITE "</TR>"
	SET YDDSATZ=1
	SET M="" FOR  SET M=$ORDER(^WWW013(0,M)) QUIT:M=""  DO
	. SET Q=0
	. SET U="" F  SET U=$ORDER(^WWW013Z(YM,BETRIEB,+DH,M,U),-1) Q:U=""  IF U'="" IF $DATA(^WWW013Z(YM,BETRIEB,+DH,M,U,1,1)) DO  Q
	. . IF $DATA(^WWW013Z(YM,BETRIEB,+DH,M,U,1,1)) SET Q=1
	. . QUIT
	. QUIT:Q=1
	. WRITE "<TR"
	. IF $GET(YDDSATZ)#2=1 WRITE " BGCOLOR="_YWHITE
	. IF $G(YDDSATZ)#2=0 WRITE " BGCOLOR="_YGRAY
	. WRITE ">"
	. WRITE "<TD ALIGN=LEFT>"
	. W "<FONT SIZE=1>"
	. WRITE $PIECE($GET(^WWW013(0,M,1)),Y,1)
	. WRITE "</TD>"
	. WRITE "<TD>"
	. W "<FONT SIZE=1>"
	. SET KSATZ=$QUERY(^WWW013Z(YM,BETRIEB,+DH,M,99999999),-1)
	. SET SATZ=""
	. IF KSATZ'="" IF $TRANSLATE($PIECE(KSATZ,",",4),"""")=M SET SATZ=@KSATZ
	. WRITE $$^WWWDATE($PIECE(SATZ,Y,1))
	. WRITE "&nbsp;"
	. WRITE $PIECE(SATZ,Y,2)
	. WRITE "</TD>"
	. WRITE "</TR>"
	. SET YDDSATZ=YDDSATZ+1
	. QUIT
	QUIT
	;
	;
	;
	
SPEI ;SPEICHRN
	;
	SET KG=1  ;KOMMT
	SET UHR=$ORDER(^WWW013Z(YM,BETRIEB,+DH,MIT,""),-1) IF UHR'=""  DO
	. SET KG1=$ORDER(^WWW013Z(YM,BETRIEB,+DH,MIT,UHR,"")) IF KG1'=""  DO
	. . IF KG1=0 SET KG=1   ;GEGANGEN UND KOMMT ;And 
	. . IF KG1=1 SET KG=0   ;GEKOMMEN UND GEHT ;And 
	. . QUIT
	. QUIT
	SET BETR=+$PIECE($GET(^WWW013(0,MIT,1)),Y,44)
	SET ^WWW013Z(YM,BETRIEB,+DH,MIT,+$PIECE(DH,",",2),KG,1)=$$^WWWDATE(DH)_Y_$$^WWWTIME(DH)_Y_BETR
	DO ^WWWSSORT("WWW013Z",BETRIEB_","_+DH_","_MIT_","_+$PIECE(DH,",",2)_","_KG)  ;AUFBEREITEN SORTKEY;FIS;24554;07.11.03
	;
	;
	
FENSTER ;
	;
	WRITE YCR,"<TR>"
	WRITE YCR,"    <TD ALIGN=RIGHT>"
	WRITE $$^WWWTEXT(3183)_":"  ; "Name:"
	WRITE "</TD>"
	WRITE YCR,"    <TD ALIGN=LEFT>"
	WRITE $$^WWWUML(NAME)
	WRITE "</TD>"
	WRITE YCR,"</TR>"
	WRITE YCR,"<TR>"
	WRITE YCR,"    <TD ALIGN=RIGHT>"
	WRITE $$^WWWTEXT(3184)_":"  ; "Personal-Nr.:"          
	WRITE "</TD>"
	WRITE YCR,"    <TD>"
	WRITE $PIECE($GET(^WWW013(0,MIT,1)),Y,22)          ;FAN;07.03.05
	WRITE "&nbsp;"
	WRITE YCR,"</TD>"
	WRITE YCR,"</TR>"
	WRITE YCR,"<TR>"
	WRITE YCR,"    <TD ALIGN=RIGHT>"
	WRITE $$^WWWTEXT(2)_":"  ; "B.:"                   ;FAN;07.03.05
	WRITE "</TD>"
	WRITE YCR,"<TD>"
	WRITE MIT
	WRITE "&nbsp;"
	WRITE "</TD>"
	WRITE "</TR>"
	WRITE YCR,"<TR>"
	WRITE "<TD>"
	SET TAT=$PIECE($GET(^WWW013(0,MIT,1)),Y,42)
	IF TAT'="" WRITE $$^WWWUML($PIECE($GET(^WWW101(0,"TAETIGKEIT",SPRACHE,TAT,1)),Y,1))
	WRITE "&nbsp;"
	WRITE "</TD>"
	WRITE YCR,"<TD>"
	WRITE "&nbsp;"
	WRITE "</TD>"
	WRITE "</TR>"
	WRITE "<TR>"
	WRITE "<TD ALIGN=RIGHT>"
	WRITE "<STRONG>"
	IF KG=1 WRITE " "_$$^WWWTEXT(3185)_":"  ; " gekommen:"
	IF KG=0 WRITE " "_$$^WWWTEXT(3186)_":"  ; " gegangen:"
	WRITE "</STRONG>"
	WRITE "</TD>"
	WRITE "<TD ALIGN=LEFT>"
	WRITE $$^WWWTIME($HOROLOG)_" " WRITE $$^WWWTEXT(3178)  ;" Uhr"
	WRITE "</TD>"
	WRITE "</TR>"
	WRITE "<TR>"
	WRITE "<TD ALIGN=RIGHT>"
	WRITE $$^WWWTEXT(3175)_":" DO GESAMT ; "Anwesenheit:" 
	WRITE "</TD>"
	WRITE "<TD>"
	WRITE ANWESEND
	WRITE "</TD>"
	WRITE "</TR>"
	QUIT
	;
	
GESAMT ;
	;
	SET ANWESEND=0
	SET VON=0
	DO
	. SET U="" FOR  SET U=$ORDER(^WWW013Z(YM,BETRIEB,+DH,MIT,U)) QUIT:U=""  DO
	. . SET KG=$ORDER(^WWW013Z(YM,BETRIEB,+DH,MIT,U,""))
	. . IF KG=1 SET VON=U QUIT
	. . IF KG=0 IF VON'=0 SET ANWESEND=ANWESEND+(U-VON) SET VON=0
	. . QUIT
	. QUIT
	IF ANWESEND=0 IF VON'=0 SET ANWESEND=ANWESEND+($PIECE($HOROLOG,",",2)-VON) SET VON=0
	SET ANWESEND=$$^WWWTIME(ANWESEND)_" " WRITE $$^WWWTEXT(3187)  ;Stunden"
	QUIT 
	;
	;
	;
	;
	;
	;
]]></Routine>
</Export>