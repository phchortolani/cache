<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFTEILELIST" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFTEILELIST(YKEY)	;INAUFTEILELIST;FIS;AUFTRAGSÜBERGREIFENDE UNTERTEILESTRUKTUR;FIS;07.11.2003
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		AUFTRAGSÜBERGREIFENDE UNTERTEILESTRUKTUR
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FIS	FIS
	;|
	;\------------------------------------------------------------------/
	;
	NEW AUF,POS,TEIL,YDDSATZ
	SET YKEY=$GET(YKEY)
	SET AUF=$PIECE(YKEY,",",1)
	QUIT:AUF=""
	SET POS=$PIECE(YKEY,",",2)
	QUIT:POS=""
	SET TEIL=$PIECE(YKEY,",",3)
	IF TEIL'="" DO
	. SET TEIL=$TRANSLATE(TEIL,".",",")
	. IF $EXTRACT($REVERSE(TEIL))="," SET TEIL=$REVERSE($PIECE($REVERSE(TEIL),",",2,99))
	. QUIT
	KILL ^WWWSOR(YUSER)
	DO ^WWWBACK
	;WRITE YCR,"<CENTER>"
	WRITE YCR,"<B>"
	;WRITE YKOPF
	WRITE $$^WWWTEXT(32047)_": "_AUF_"-"_POS
	WRITE "&nbsp;"
	IF $GET(YFORM)'="" IF $GET(SPRACHE)'="" WRITE $PIECE($GET(^WWW124(0,YFORM,SPRACHE,26,1)),Y,1)    ;BEC;05.12.03;ÜBERSCHRIFT AUS BUTTODATEI ;superscription out of 
	WRITE YCR,"</B>"
	;WRITE YCR,"</CENTER>"
	;WRITE YCR,"<BR>"
	SET YDDSATZ=0
	DO START1^WWWTAB
	DO NL^WWWTAB
	FOR YI=4,1,5 DO  ;,"A"
	. DO NH^WWWTAB
	. WRITE "<FONT SIZE=2>"
	. IF +YI'=0 WRITE $$^WWWFELDNAME("INAUFPT","D",YI)
	. ;IF YI="A" WRITE $$^WWWTEXT(32047)  ;AUFTRAG
	. WRITE "&nbsp;"
	. DO EH^WWWTAB
	. QUIT
	DO EL^WWWTAB
	DO VOR^INAUFBERECHT       ;ACCAL,ACCRE,ACCKD... VORBEREITEN FÜR BERECHTUNGEN
	DO LIST(0,AUF,POS,TEIL)
	DO STOP^WWWTAB
	KILL ^WWWSOR(YUSER)
	QUIT
	
LIST(EBENE,AUF,POS,TEILKEY)  ;DURCHLAUF TEILESTRUKTUR
	NEW YDATEI,YDATEI1,YI,YFELD,TEIL,YII,ACC,AUF1
	SET AUF=$GET(AUF)
	QUIT:AUF=""
	SET POS=$GET(POS)
	QUIT:POS=""
	SET TEILKEY=$GET(TEILKEY)
	IF TEILKEY="" SET TEILKEY=0
	SET EBENE=+$GET(EBENE)
	QUIT:EBENE>10  ;DATEI ZU GROSS ;data file within 
	QUIT:$DATA(^WWWSOR(YUSER,"ERL",AUF,POS,TEILKEY))  ;BEREITS GEDRUCKT ;yet 
	SET ^WWWSOR(YUSER,"ERL",AUF,POS,TEILKEY)=""
	SET AUF1=$GET(^INAUF(YM,AUF,1))
	SET ACC=$$^INAUFBERECHT(AUF1)     ;=1 BERECHTIGUNG
	DO NL^WWWTAB
	FOR YII=1:1:3 DO
	. DO NFL^WWWTAB
	. WRITE "<FONT SIZE=2>"
	. WRITE "<B>"
	. IF YII=1 DO
	. . IF +$GET(EBENE)'=0 FOR YI=0:1:EBENE WRITE "&nbsp;&nbsp;&nbsp;"
	. . WRITE $PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,4)
	. . QUIT
	. IF YII=2 DO
	. . WRITE $PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,1)
	. . WRITE "&nbsp;"
	. . ;BEC;24.11.03;LINK UND BERECHTIGUNGEN ERGÄNTZT ;And 
	. . IF ACC=1 DO
	. . . NEW YKEY,YFORM
	. . . WRITE "<A HREF="_""""_YAKTION_"EP=WWWFORM&YFORM=INAUF&YKEY="_AUF_","_POS
	. . . SET YBACK="INAUFP,"
	. . . DO ^WWWCGI
	. . . WRITE """"
	. . . WRITE "TITLE="_""""_$$^WWWTEXT(374)_""""  ;DATENSATZ WÄHLEN ;data record pick out 
	. . . WRITE ">"
	. . . QUIT
	. . WRITE "("_$$^WWWTEXT(32047)_": "_AUF_"-"_POS_")"
	. . IF ACC=1 WRITE "</A>"
	. . QUIT
	. WRITE "&nbsp;"
	. WRITE "</B>"
	. WRITE YCR
	. DO EF^WWWTAB
	. QUIT
	DO EL^WWWTAB
	SET YDATEI="^INAUFPXL("_""""_YM_""""_","_""""_AUF_""""_","_POS
	IF TEILKEY'=0 FOR YI=1:1  QUIT:$PIECE(TEILKEY,",",YI,99)=""  SET YDATEI=YDATEI_","_$PIECE(TEILKEY,",",YI)
	SET YDATEI=YDATEI_")"
	SET YDATEI1=YDATEI
	FOR  DO  QUIT:YDATEI1=""
	. SET YDATEI1=$QUERY(@YDATEI1)
	. ;IF $PIECE(YDATEI1,",",2)'=AUF SET YDATEI1="" QUIT  ;02.07.2004;FAN;alphanumerische Aufträge ;25888  ;25794
	. IF $TRANSLATE($PIECE(YDATEI1,",",2),"""")'=AUF SET YDATEI1="" QUIT  ;02.07.2004;FAN;alphanumerische Aufträge ;25888  ;25794
	. IF $PIECE(YDATEI1,",",3)'=POS SET YDATEI1="" QUIT  ;FALSCHE POSITION
	. SET TEIL=$TRANSLATE($PIECE(YDATEI1,",",4,99),",)","..")
	. IF TEILKEY'=0 IF $PIECE($PIECE(YDATEI1,",",4,4+$LENGTH(TEILKEY,",")),")",1)'=TEILKEY SET YDATEI1="" QUIT
	. SET YFELD=@YDATEI1
	. ;
	. IF $PIECE(YFELD,Y,26)=2 QUIT  ;LEISTUNG ;performance 
	. IF $DATA(@YDATEI1)=10!($DATA(@YDATEI1)=11) QUIT  ;FERTIGUNG, DA UNTERTEILE
	. ;
	. DO NL^WWWTAB
	. DO NFL^WWWTAB
	. WRITE "<FONT SIZE=2>"
	. IF +$GET(EBENE)'=0 FOR YI=0:1:EBENE WRITE "&nbsp;&nbsp;&nbsp;"
	. IF TEIL'="" FOR YI=0:1:$LENGTH(TEIL,".")-2 WRITE "&nbsp;&nbsp;&nbsp;"
	. WRITE "|_"
	. WRITE $PIECE(YFELD,Y,4)
	. WRITE "&nbsp;"
	. WRITE YCR
	. DO EF^WWWTAB
	. ;
	. DO NFL^WWWTAB
	. WRITE "<FONT SIZE=2>"
	. WRITE $PIECE(YFELD,Y,1)
	. WRITE "&nbsp;"
	. WRITE YCR
	. DO EF^WWWTAB
	. ;
	. DO NFR^WWWTAB
	. WRITE "<FONT SIZE=2>"
	. WRITE $$^WWWZAHL($PIECE(YFELD,Y,5),0,$LENGTH($PIECE($PIECE(YFELD,Y,5),".",2)))
	. WRITE "&nbsp;"
	. IF $PIECE(YFELD,Y,40)'="" DO
	. . ;WRITE $PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(YFELD,Y,40),1)),Y,1)
	. . WRITE $PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(YFELD,Y,40),1)),Y,1)        ;BEC;25866;07.06.04;DA ZENTRALE DATEI
	. . WRITE "&nbsp;"
	. . QUIT
	. WRITE YCR
	. DO EF^WWWTAB
	. ;
	. ;DO NFL^WWWTAB
	. ;WRITE "<FONT SIZE=2>"
	. ;WRITE AUF_"-"_POS
	. ;WRITE "&nbsp;"
	. ;WRITE YCR
	. ;DO EF^WWWTAB
	. DO EL^WWWTAB
	. ;
	. IF TEIL'="" IF $DATA(^INWEAUFPT(YM,AUF,POS,TEIL)) DO  ;SUCHEN LAGER-ENTNAHMEN ;seek 
	. . NEW BET,LAP,WED
	. . SET BET="" FOR  SET BET=$ORDER(^INWEAUFPT(YM,AUF,POS,TEIL,BET)) QUIT:BET=""  DO
	. . . SET LAP="" FOR  SET LAP=$ORDER(^INWEAUFPT(YM,AUF,POS,TEIL,BET,LAP)) QUIT:LAP=""  DO
	. . . . SET WED="" FOR  SET WED=$ORDER(^INWEAUFPT(YM,AUF,POS,TEIL,BET,LAP,WED)) QUIT:WED=""  DO
	. . . . . SET WE1=$GET(^INWEAUFPT(YM,AUF,POS,TEIL,BET,LAP,WED,1))
	. . . . . QUIT:$PIECE(WE1,Y,28)=""  ;OHNE URSPRUNGSAUFTRAG ;without 
	. . . . . QUIT:$PIECE(WE1,Y,29)=""
	. . . . . IF $PIECE(WE1,Y,28)=AUF IF $PIECE(WE1,Y,29)=POS QUIT    ;SELBST ;self 
	. . . . . DO LIST(EBENE+1,$PIECE(WE1,Y,28),$PIECE(WE1,Y,29))      ;REKURSIV !
	. . . . . QUIT
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. QUIT
	QUIT
]]></Routine>
</Export>