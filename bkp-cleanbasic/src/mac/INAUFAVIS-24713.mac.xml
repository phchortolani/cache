<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFAVIS" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFAVIS ;INAUFAVIS:FIS;ÜBERTRAGEN LIEFERINFORMATIONEN AN KUNDENAUFTRAG;16.05.2002 ;transport upon customer´s order 
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		ÜBERTRAGEN LIEFERINFORMATIONEN AN KUNDENAUFTRAG
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| 	16.05.2002 
	;|
	;\------------------------------------------------------------------/
	;
	NEW AUF,POS,REL,CAUF,CPOS,YOK,CPOS1,CAUF1,SATZ,SATZ1
	SET YKEY=$GET(YKEY)
	SET AUF=$PIECE(YKEY,",",1)
	QUIT:AUF=""
	SET POS=$PIECE(YKEY,",",2)
	QUIT:POS=""
	SET REL=$PIECE(YKEY,",",3)
	QUIT:REL=""
	SET YFELD=$GET(YFELD)
	QUIT:YFELD=""
	;SPEICHERN LIEFERAVIS IN LF-BESTELLUNG  ALS  AUSLIEFERUNG IN KUNDENAUFTRAG ! ;Save within when handover within customer´s order 
	IF REL'=0 DO
	. SET SATZ=$GET(^INAUFPREL(YM,AUF,POS,REL,1))
	. IF $PIECE(SATZ,Y,35)'="" DO
	. . SET CAUF=$PIECE($PIECE(SATZ,Y,35),"-",1)  ;KUNDENAUFTRAG ;customer´s order 
	. . QUIT:CAUF=""
	. . SET CPOS=$PIECE($PIECE(SATZ,Y,35),"-",2)  ;KUNDENPOSITION
	. . QUIT:CPOS=""
	. . IF $DATA(^INAUFP(YM,CAUF,CPOS,1)) SET CPOS1=^(1) DO
	. . . SET $PIECE(CPOS1,Y,90)=1  ;AUSLIEFERUNGSFÄHIG
	. . . SET $PIECE(CPOS1,Y,91)=$PIECE(YFELD,Y,1)  ;LIEFERSCHEINNUMMER
	. . . SET $PIECE(CPOS1,Y,92)=$PIECE(YFELD,Y,2)  ;LIEFERDATUM
	. . . IF $PIECE(CPOS1,Y,92)="" SET $PIECE(CPOS1,Y,92)=+$H
	. . . SET YOK=$$^WWWSPEI("INAUFP",CAUF_","_CPOS,CPOS1,1)
	. . . QUIT
	. . IF $DATA(^INAUF(YM,CAUF,1)) SET CAUF1=^(1) DO
	. . . SET $PIECE(CAUF1,Y,91)=$PIECE(YFELD,Y,1)  ;LIEFERSCHEINNUMMER
	. . . SET $PIECE(CAUF1,Y,92)=$PIECE(YFELD,Y,2)  ;LIEFERDATUM
	. . . IF $PIECE(CAUF1,Y,92)="" SET $PIECE(CAUF1,Y,92)=+$H
	. . . SET YOK=$$^WWWSPEI("INAUF",CAUF,CAUF1,1)
	. . . QUIT
	. . QUIT
	. QUIT
	;SPEICHERN LIEFERAVIS FÜR KUNDENAUFTRAG ;Save to customer´s order 
	IF REL=0 DO
	. SET SATZ=$GET(^INAUFP(YM,AUF,POS,1))
	. SET $PIECE(SATZ,Y,90)=1  ;AUSLIEFERUNGSFÄHIG
	. SET $PIECE(SATZ,Y,91)=$PIECE(YFELD,Y,1)  ;LIEFERSCHEINNUMMER
	. SET $PIECE(SATZ,Y,92)=$PIECE(YFELD,Y,2)  ;LIEFERDATUM
	. IF $PIECE(SATZ,Y,92)="" SET $PIECE(SATZ,Y,92)=+$H
	. SET YOK=$$^WWWSPEI("INAUFP",AUF_","_POS,SATZ,1)
	. IF $DATA(^INAUF(YM,AUF,1)) SET SATZ1=^(1) DO
	. . SET $PIECE(SATZ1,Y,91)=$PIECE(YFELD,Y,1)  ;LIEFERSCHEINNUMMER
	. . SET $PIECE(SATZ1,Y,92)=$PIECE(YFELD,Y,2)  ;LIEFERDATUM
	. . IF $PIECE(SATZ1,Y,92)="" SET $PIECE(SATZ1,Y,92)=+$H
	. . SET YOK=$$^WWWSPEI("INAUF",AUF,SATZ1,1)
	. . QUIT
	. QUIT
	QUIT
	
KILL ;LÖSCHEN VERSANDINFORMATIONEN AUS KUNDENAUFTRAG ;Delete out of customer´s order 
	NEW AUF,POS,REL,CAUF,CPOS,YOK,CPOS1,CAUF1,SATZ
	SET YKEY=$GET(YKEY)
	SET AUF=$PIECE(YKEY,",",1)
	QUIT:AUF=""
	SET POS=$PIECE(YKEY,",",2)
	QUIT:POS=""
	SET REL=$PIECE(YKEY,",",3)
	QUIT:REL=""
	SET YFELD=$GET(YFELD)
	QUIT:YFELD=""
	;LÖSCHEN VON LIEFERAVIS IN LF-BESTELLUNG  =  AUSLIEFERUNG IN KUNDENAUFTRAG STORNIEREN ! ;Delete within handover within customer´s order 
	IF REL'=0 DO
	. SET SATZ=$GET(^INAUFPREL(YM,AUF,POS,REL,1))
	. IF $PIECE(SATZ,Y,35)'="" DO
	. . SET CAUF=$PIECE($PIECE(SATZ,Y,35),"-",1)  ;KUNDENAUFTRAG ;customer´s order 
	. . QUIT:CAUF=""
	. . SET CPOS=$PIECE($PIECE(SATZ,Y,35),"-",2)  ;KUNDENPOSITION
	. . QUIT:CPOS=""
	. . IF $DATA(^INAUFP(YM,CAUF,CPOS,1)) SET CPOS1=^(1) DO
	. . . SET $PIECE(CPOS1,Y,90)=0  ;NICHT AUSLIEFERUNGSFÄHIG ;Not 
	. . . SET $PIECE(CPOS1,Y,91)=""  ;LIEFERSCHEINNUMMER
	. . . SET $PIECE(CPOS1,Y,92)=""  ;LIEFERDATUM
	. . . SET YOK=$$^WWWSPEI("INAUFP",CAUF_","_CPOS,CPOS1,1)
	. . . QUIT
	. . IF $DATA(^INAUF(YM,CAUF,1)) SET CAUF1=^(1) DO
	. . . SET $PIECE(CAUF1,Y,91)=""  ;LIEFERSCHEINNUMMER
	. . . SET $PIECE(CAUF1,Y,92)=""  ;LIEFERDATUM
	. . . SET YOK=$$^WWWSPEI("INAUF",CAUF,CAUF1,1)
	. . . QUIT
	. . QUIT
	. QUIT
	;LÖSCHEN LIEFERAVIS ;Delete 
	IF REL=0 DO
	. SET SATZ=$GET(^INAUFP(YM,AUF,POS,1))
	. SET $PIECE(SATZ,Y,90)=0  ;AUSLIEFERUNGSFÄHIG
	. SET $PIECE(SATZ,Y,91)=""  ;LIEFERSCHEINNUMMER
	. SET $PIECE(SATZ,Y,92)=""  ;LIEFERDATUM
	. SET YOK=$$^WWWSPEI("INAUFP",AUF_","_POS,SATZ,1)
	. IF $DATA(^INAUF(YM,AUF,1)) SET SATZ1=^(1) DO
	. . SET $PIECE(SATZ1,Y,91)=""  ;LIEFERSCHEINNUMMER
	. . SET $PIECE(SATZ1,Y,92)=""  ;LIEFERDATUM
	. . SET YOK=$$^WWWSPEI("INAUF",AUF,SATZ1,1)
	. . QUIT
	. QUIT
	QUIT
]]></Routine>
</Export>