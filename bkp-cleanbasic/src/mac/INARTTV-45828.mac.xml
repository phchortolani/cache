<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INARTTV" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INARTTV
#include COMSYS
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		ARTIKELTEILESTRUKTUR TABELLE ANZEIGE eines Artikels bei Artikelteileanlage
	;	DIESES PROGRAMM ZEIGT DIE TABELLE DER TEILE IN DER ARTIKELSTRUKTURERFASSUNG AN
	;	VERSCHIEBEN DER TEILE ;defer the 
	;
	; Inputs : 
	;
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 16-Aug-2005	GRF		SR13215 : Doco; /3600; use strListen
	; 15.01.2000	DT		(C) BY DITMAR TYBUSSEK
	;-------------------------------------------------------------------------------
	NEW ART,ARTT,ARTX,DATUM,DAUER,GEWICHT,KEINEUNTERTEILE,RDAUER,strListen,TART,TEILE,WERT,YALT,ZUSATZ
	
	;+++++++++++++++++++++++++++++++++++++++
	;  ART(1)		objINART	Item Master
	;+++++++++++++++++++++++++++++++++++++++
	
	;ACHTUNG YPARA=DIE STRUKTUR ZURUECK ZUM OBERARTIKEL (WENN AUSWAHL UNTER/UNTERARTIKEL) ;estimation texture Selection 
	QUIT:YKEY=""
	SET ART   = $PIECE(YKEY,",",1)
	SET DATUM = $PIECE(YKEY,",",2)
	;QUIT:DATUM=""
	QUIT:ART=""
	
	SET VERSCHNITT=$PIECE($GET(^INVORG(YM,YM,1)),Y,10)  ;VERSCHNITT IN % ;within 
	set YLISTEN=$get(YLISTEN)
	set strListen = "<FONT SIZE="_$select(YLISTEN=1:1,1:2)_">"
	;	write strListen                                               ; 16-Aug-2005
	;		replaces 
	;	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	;	IF YLISTEN=1 WRITE "<FONT SIZE=1>"
	
	IF YPARA="" SET YPARA=","  ;ARTIKELTEIL
	SET YPARAX  = YPARA  ;SICHERN YPARA FÜR SPÄTERE VERWENDUNG ;safeguard to 
	;FÜR DIE GESAMMTSUMME ;to who 
	SET GEWICHT = 0
	SET DAUER   = 0
	SET RDAUER  = 0    
	SET WERT	= 0
	set ZUSATZ  = 0
	SET YDDSATZ = 0  ;ANZEIGE WEISS ;Show 
	WRITE "<TABLE BORDER=0 WIDTH=100%>"
	WRITE "<TR>"
	
	WRITE "<TD NOWRAP WIDTH=30% ALIGN=LEFT>"
	WRITE "<FONT SIZE=2>"
	IF $TRANSLATE(YPARA,",")'="" DO   ;ZURUECK ZU OBERARTIKEL ;within 
	. NEW YPARA,YPARA1,YPARA2,YKEY,YBACK,YI,TEILETEXT
	. ;
	. SET YKEY  = $PIECE(YPARAX,",",$LENGTH(YPARAX,",")-1)
	. SET YPARA = $PIECE(YPARAX,",",1,$LENGTH(YPARAX,",")-2)_","
	. WRITE "<A"
	. WRITE " TITLE=""" DO  WRITE """"  ;TEXT
	. . FOR YI=2:1 QUIT:$PIECE(YPARAX,",",YI)=""  DO  ;Teile aufbauen ;parts construct 
	. . . IF YI=2 WRITE "   "
	. . . IF YI'=2 DO
	. . . . WRITE $CHAR(13)
	. . . . FOR YI(1)=1:1:YI WRITE "   "
	. . . . WRITE "\__"
	. . . ;
	. . . WRITE $PIECE(YPARAX,",",YI)_" "_$PIECE($GET(^INART(YM,$PIECE(YPARAX,",",YI),1)),Y,1)
	. . ;
	. . WRITE $CHAR(13)
	. . FOR YI(1)=1:1:YI WRITE "   "
	. . WRITE "\__"
	. . SET TEILETEXT="("_ART_") "_$PIECE($GET(^INART(YM,ART,1)),Y,1)
	. . WRITE TEILETEXT   ;DERZEITIGER UNTERTEILE ARTIKEL ;item 
	. ;
	. WRITE " HREF="""_YAKTION_"EP=WWWFORM&YFORM=INARTTV1"
	. ;SET YBACK="INART,"   ;YBACK
	. DO ^WWWCGI
	. WRITE """>"
	. WRITE "<B>",$$^WWWTEXT(32108),"</B>"  ;ÜBERGEORDNETE ARTIKEL ;item 
	. ;WRITE YCR,"<IMG SRC="""_YGIF_"teile.gif"" TITLE="""_$$^WWWTEXT(32108)_""" width=18 height=18 border=0 VSPACE=0>"   ;übergeordneter Artikel
	. WRITE "</A>"
	. WRITE "&nbsp;"
	. WRITE "&nbsp;"
	. WRITE "&nbsp;"
	. WRITE "&nbsp;"
	. WRITE "&nbsp;"
	. WRITE "<B>"_$GET(TEILETEXT)_"</B>"
 
	WRITE "</TD>"
	
	WRITE "<TD NOWRAP ALIGN=LEFT>"
	write strListen
	;WRITE "<B>"
	IF ART'="" IF ART'=" " DO  
	. NEW YBACK
	. WRITE "&nbsp;"
	. WRITE "&nbsp;"
	. WRITE "&nbsp;"
	. WRITE "&nbsp;"
	. WRITE "&nbsp;"
	. WRITE "&nbsp;"
	. WRITE "&nbsp;"
	. WRITE "<A"
	. WRITE " TITLE="""_$$^WWWTEXT(32124)_"""" 
	. WRITE " HREF="""_YAKTION_"EP=WWWMANU&YFORM=INART&YEXEC=D|^INARTIU"
	. SET YBACK="INART,"
	. DO ^WWWCGI
	. WRITE """>"
	. IF $DATA(^INARTTVs(YM,1,$$^WWWUMLAU(ART,1))) WRITE $$^WWWTEXT(32073)   ;IST KEIN UNTERTEIL ;no 
	. IF '$DATA(^INARTTVs(YM,1,$$^WWWUMLAU(ART,1))) WRITE $$^WWWTEXT(32074)  ;ARTIKEL IST SELBER EIN TEIL ;item self uni- whack 
	. WRITE "</A>"
	WRITE "</TD>"
	
	WRITE "</TR>"
	WRITE "</TABLE>"
	
	
	;Start anzeige
	;ANZEIGE ERFASSTE WERTE ;Show 
	DO ^WWWFRAME(0)
	WRITE YCR
	DO KOPF ;DRUCKEN KOPFZEILE ;print 
	
	;EINZELTEILE ANZEIGEN ;display 
	SET ARTX=0   ;KEINE TEILE ;no 
	IF DATUM'="" SET ARTT="" FOR  SET ARTT=$ORDER(^INARTTV(YM,ART,DATUM,ARTT)) QUIT:ARTT=""  DO
	. NEW BEZEICH
	. SET TEILE=$GET(^INARTTV(YM,ART,DATUM,ARTT,1))
	. SET TART=$PIECE(TEILE,Y,1)
	. SET ^INARTTV(YM,ART,DATUM,ARTT,1)=TEILE
	. IF TART="" KILL ^INARTTV(YM,ART,DATUM,ARTT) QUIT  ;KEIN ARTIKEL ;no item 
	. SET ART(1)=$GET(^INART(YM,TART,1))
	. SET BEZEICH=$PIECE(ART(1),Y,1)
	. IF BEZEICH'="" SET $PIECE(TEILE,Y,3)=BEZEICH
	. IF ART(1)="" KILL ^INARTTV(YM,ART,DATUM,ARTT) QUIT  ;ARTIKEL NICHT MEHR VORHANDEN ;item Not more on hand 
	. NEW YTEILSUM
	. SET YTEILSUM=""
	. IF YLISTEN=1 DO
	. . DO  ;IF $PIECE(TEILE,Y,40)'=1 DO  ;AUSWERTEN DER MENGEN, WENN TEILE GLEICH
	. . . NEW YARTTX,Q,YARTTC,TEILE1
	. . . SET TEILE1=TEILE
	. . . SET YTEILSUM=1
	. . . SET Q=0
	. . . SET YARTTX=ARTT
	. . . FOR  SET ARTT=$ORDER(^INARTTV(YM,ART,DATUM,ARTT)) QUIT:ARTT=""  DO  QUIT:Q=1
	. . . . SET YARTTC=$GET(^INARTTV(YM,ART,DATUM,ARTT,1))  ;TEILE INFO
	. . . . IF $PIECE(YARTTC,Y,1)=$PIECE(TEILE1,Y,1) SET $PIECE(TEILE,Y,3)=BEZEICH
	. . . . IF $PIECE(YARTTC,Y,1,40)'=$PIECE(TEILE1,Y,1,40) SET Q=1 SET ARTT=YARTTX QUIT  ;NICHT GLEICH ;Not without delay 
	. . . . SET YARTTX=ARTT
	. . . . ;
	. . . . SET YTEILSUM=YTEILSUM+1
	. . . . ;SET $PIECE(TEILE,Y,4)=$PIECE(TEILE,Y,4)+$PIECE(YARTTC,Y,4)    ;MEHRERE STUECKE ALLES GLEICH  MENGE
	. . . . SET $PIECE(TEILE,Y,6) =$PIECE(TEILE,Y,6)+$PIECE(YARTTC,Y,6)    ;MEHRERE STUECKE ALLES GLEICH  GEWICHT ;divers whatsoever without delay wt. 
	. . . . SET $PIECE(TEILE,Y,7) =$PIECE(TEILE,Y,7)+$PIECE(YARTTC,Y,7)    ;MEHRERE STUECKE ALLES GLEICH  ZEIT ;divers whatsoever without delay time 
	. . . . SET $PIECE(TEILE,Y,70)=$PIECE(TEILE,Y,70)+$PIECE(YARTTC,Y,70)  ;MEHRERE STUECKE ALLES GLEICH  RUESTZEIT ;divers whatsoever without delay 
	. . . . SET $PIECE(TEILE,Y,8) =$PIECE(TEILE,Y,8)+$PIECE(YARTTC,Y,8)    ;MEHRERE STUECKE ALLES GLEICH  WERT ;divers whatsoever without delay worthy 
	. . . ;
	. . . IF ARTT="" SET ARTT=$ORDER(^INARTTV(YM,ART,DATUM,ARTT),-1)
	. ;
	. DO ANZEIGE
	
	IF $get(YDDSATZ)<10 DO
	. NEW YBLANKLINE
	. SET YBLANKLINE=$GET(YDDSATZ)
	. FOR YBLANKLINE=YBLANKLINE:1:10 DO
	. . WRITE "<TR>"
	. . SET YDDSATZ=YDDSATZ+1
	. . FOR YI=1:1:17 DO
	. . . WRITE "<TD NOWRAP VALIGN=TOP"
	. . . IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . . WRITE ">"
	. . . WRITE "<FONT SIZE=2>"
	. . . WRITE "&nbsp;"
	. . . WRITE "</TD>",YCR
	
	DO GESAMT   ;SUMMENZEILE
	DO ^WWWFRAME(1)
	IF ARTX=0 WRITE YCR,$$^WWWTEXT(32109),YCR   ;kein ARTIKEL vorhanden ;not item on hand 
	QUIT
	
GESAMT ;ENDEZEILE GESAMTWERTE
	
	;---------------------------------------
	
	WRITE "<TR>"
	
	FOR YI=1:1:10 DO
	. WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. write strListen
	. WRITE "&nbsp;"  ;POSITIONIERUNG
	. WRITE YCR,"</TH>"
	
	WRITE "<TH ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	write strListen
	WRITE $$^WWWZAHL(GEWICHT,0,1)
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	WRITE "<TH ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	IF YLISTEN'=1 WRITE "<FONT SIZE=2>"
	IF YLISTEN=1  WRITE "<FONT SIZE=1>"
	WRITE $$^WWWTIME(DAUER)
	WRITE "&nbsp;</FONT>"
	WRITE YCR,"</TH>"
	
	WRITE "<TH ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	write strListen
	WRITE $$^WWWTIME(RDAUER)
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	WRITE "<TH NOWRAP ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	write strListen
	WRITE $$^WWWZAHL(WERT,0,2,YWHR)
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	FOR YI=1:1:3 DO
	. WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. write strListen
	. WRITE "&nbsp;"  ;längen
	. WRITE YCR,"</TH>"
	
	WRITE YCR,"</TR>"
	
	;---------------------------------------
	
	;		D74		$$$INARTToolCosts()
	;		D75		$$$INARTExtraCosts()
	SET ZUSATZ=$PIECE($GET(^INART(YM,ART,1)),Y,74)+$PIECE($GET(^INART(YM,ART,1)),Y,75)
	IF +ZUSATZ'=0 DO
	. WRITE "<TR>"
	. ;
	. FOR YI=1:1:13 DO
	. . WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. . write strListen
	. . WRITE "&nbsp;"  ;POSITIONIERUNG
	. . WRITE YCR,"</TH>"
	. ;
	. WRITE "<TH NOWRAP ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	. write strListen
	. WRITE $$^WWWZAHL(ZUSATZ,0,2,YWHR)
	. WRITE "&nbsp;"
	. WRITE YCR,"</TH>"
	. ;
	. FOR YI=1:1:3 DO
	. . WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. . write strListen
	. . WRITE "&nbsp;"  ;längen
	. . WRITE YCR,"</TH>"
	. WRITE YCR,"</TR>"
	
	;---------------------------------------
	
	WRITE "<TR>"
	FOR YI=1:1:12 DO
	. WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. write strListen
	. WRITE "&nbsp;"  ;POSITIONIERUNG
	. WRITE YCR,"</TH>"
	
	SET RWERT=0
	DO
	. NEW WG,BETR,STDWERT
	. SET BETR=$GET(YLOCATION)
	. IF BETR="" SET BETR=$ORDER(^INKALK(YM,""))
	. IF BETR="" SET BETR=$ORDER(^WWW0121(0,YM,""))
	. IF BETR="" SET BETR=1
	. SET WG=$PIECE($GET(^INVORG(YM,YM,1)),Y,13)
	. IF WG="" SET WG=$ORDER(^INKALK(YM,BETR,""))
	. IF WG="" SET WG=0
	. SET STDWERT=$PIECE($GET(^INKALK(YM,BETR,WG,1)),Y,1)/3600
	. SET RWERT=$JUSTIFY(RDAUER*STDWERT,0,2)
	
	WRITE "<TH ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	write strListen
	WRITE $$^WWWZAHL(RWERT,0,2)
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	WRITE "<TH NOWRAP ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	write strListen
	WRITE $$^WWWZAHL(WERT+RWERT+ZUSATZ,0,2,YWHR)
	WRITE "&nbsp;"
	WRITE YCR,"</TH>"
	
	FOR YI=1:1:3 DO
	. WRITE "<TH BGCOLOR="_YDARKGRAY_">"
	. write strListen
	. WRITE "&nbsp;"  ;längen
	. WRITE YCR,"</TH>"
	
	WRITE YCR,"</TR>"
	
	;---------------------------------------
	
	QUIT
	
ANZEIGE ;DER ARTIKELTEILE ;the 
	SET ARTX=1  ;TEIL VORHANDEN ;whack on hand 
	SET YDDSATZ=YDDSATZ+1  ;ANZEIGE WEISS ;Show 
	WRITE YCR
	WRITE "<TR>"
	;LÖSCHEN ;Delete 
	WRITE "<TD NOWRAP VALIGN=MIDDLE"
	;I YDDSATZ#2=1 W " BGCOLOR="_YWHITE
	SET YALT=$$^WWWTEXT(41)
	IF $PIECE(TEILE,Y,20)'="" DO   ;FARBKENNUNG UND TEXT ;And Text 
	. NEW YCOL
	. SET YCOL=$PIECE($GET(^INARTPARA(YM,SPRACHE,$PIECE(TEILE,Y,20),1)),Y,2)
	. SET YALT=$PIECE($GET(^INARTPARA(YM,SPRACHE,$PIECE(TEILE,Y,20),1)),Y,1)
	. IF YCOL'="" WRITE " BGCOLOR="_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,YCOL,1)),Y,1)
	
	WRITE " WIDTH=24>"
	WRITE "<A onClick='return doLink(this)' HREF=""JavaScript:if (confirm(' ("_ARTT_") "_$TRANSLATE($PIECE(TEILE,Y,3),"'""","´")_"  "_$$^WWWTEXT(321)_"')) window.location='"
	WRITE YAKTION_"EP=WWWMANU&YEXEC=*D|PROC^INARTTV"
	WRITE "&YPARA1="_ART_","_DATUM_","_ARTT
	WRITE "&YFUNCT1=KILL"
	DO ^WWWCGI
	WRITE "';"">"
	WRITE YCR,"<IMG SRC="""_YGIF_"del.gif"" TITLE="""_YALT_""" width=18 height=18 border=0 VSPACE=0>"
	WRITE "</A>"
	WRITE "</TD>",YCR
	
	;TEILE DER TEILE ;the 
	SET KEINEUNTERTEILE=1  
	IF $PIECE(TEILE,Y,1)'="" IF $DATA(^INARTT(YM,$PIECE(TEILE,Y,1))) SET KEINEUNTERTEILE=0  ;ARTIKEL HAT UNTERTEILE ;item 
	;IF $DATA(^INARTT(YM,ART,ARTT,1)) DO
	;.;SET KEINEUNTERTEILE(1)=$PIECE($GET(^INARTT(YM,ART,ARTT,1)),Y,1)  ;BEC;22840;28.07.03;DIE ARTIKELNUMMER STEHT IN TEILE
	;. SET KEINEUNTERTEILE(1)=$PIECE($GET(^INARTT(YM,ART,ARTT,1)),Y,1)  
	;. IF KEINEUNTERTEILE(1)'="" DO  ;ARTIKELNR VORHANDEN
	;. . IF $DATA(^INARTT(YM,KEINEUNTERTEILE(1))) SET KEINEUNTERTEILE=0  ;TEIL IM TEIL VORHANDEN
	
	DO  ;TEILE der teile ;who 
	. WRITE YCR
	. SET YBACK1=YBACK
	. NEW YPARA,YBACK,YKEY
	. SET YPARA=YPARAX_ART_","  ;NEUES UNTERTEIL ;something new 
	. SET YKEY=TART
	. WRITE "<TD NOWRAP VALIGN=MIDDLE"
	. ;I YDDSATZ#2=1 W " BGCOLOR="_YWHITE
	. IF $PIECE(TEILE,Y,20)'="" DO   ;FARBKENNUNG
	. . NEW YCOL
	. . SET YCOL=$PIECE($GET(^INARTPARA(YM,SPRACHE,$PIECE(TEILE,Y,20),1)),Y,2)
	. . IF YCOL'="" WRITE " BGCOLOR="_$PIECE($GET(^WWW100(0,"FARBE",SPRACHE,YCOL,1)),Y,1)
	. ;
	. WRITE " WIDTH=24>"
	. write strListen
	. ;WRITE "<A HREF="""_YAKTION_"EP=WWWFORM&YFORM=INARTTV1"
	. ;SET YBACK=""   ;YBACK1
	. ;DO ^WWWCGI
	. ;WRITE """>"
	. IF KEINEUNTERTEILE=1 WRITE YCR,"<IMG SRC="""_YGIF_"blank.gif"" TITLE="""_$$^WWWTEXT(33415)_""" width=18 height=18 border=0 VSPACE=0>"   ;bec;22840;sprachentxt;bei versionen Unterteile können nur im Artikel bearbeitet werden
	. IF KEINEUNTERTEILE=0 WRITE YCR,"<IMG SRC="""_YGIF_"teile.gif"" TITLE="""_$$^WWWTEXT(33415)_""" width=18 height=18 border=0 VSPACE=0>"
	. ;WRITE "</A>"
	
	WRITE "</TD>"
	WRITE YCR
	;AUF UND UP ;upon And 
	WRITE YCR
	WRITE "<TD NOWRAP VALIGN=MIDDLE"
	;I YDDSATZ#2=1 W " BGCOLOR="_YWHITE
	WRITE " WIDTH=20>"
	write strListen
	;EINE POSITION HOCHRÜCKEN ;one 
	WRITE "<A HREF="""_YAKTION_"EP=WWWMANU&YEXEC=*D|PROC^INARTTV"
	DO
	. SET YBACK1=YBACK
	. NEW YBACK
	. WRITE "&YPARA1="_ART_","_DATUM_","_ARTT
	. WRITE "&YFUNCT1=UP"
	. SET YBACK=YBACK1
	. DO ^WWWCGI
	
	WRITE """>"
	WRITE "<IMG SRC="""_YGIF_"scrup.gif"" TITLE="""_$$^WWWTEXT(32015)_""" border=0 VSPACE=0>"
	WRITE "</A>"
	;EINE POSITION HERUNTER ;one 
	WRITE "<A HREF="""_YAKTION_"EP=WWWMANU&YEXEC=*D|PROC^INARTTV"
	DO
	. SET YBACK1=YBACK
	. NEW YBACK
	. WRITE "&YPARA1="_ART_","_DATUM_","_ARTT
	. WRITE "&YFUNCT1=DOWN"
	. SET YBACK=YBACK1
	. DO ^WWWCGI
	
	WRITE """>"
	WRITE "<IMG SRC="""_YGIF_"scrdown.gif"" TITLE="""_$$^WWWTEXT(32016)_""" border=0 VSPACE=0>"
	WRITE "</A>"
	WRITE "</TD>"
	WRITE YCR
	DO  ;TEILENUMMER
	. ;
	. SET YBACK1=YBACK
	. NEW YBACK,YKEY
	. SET YKEY=ART_","_ARTT
	. WRITE "<TD NOWRAP VALIGN=MIDDLE"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE " ALIGN=RIGHT>"
	. write strListen
	. WRITE "<A TITLE="""_$$^WWWTEXT(32061)_""" HREF="""_YAKTION_"EP=WWWFORM&YFORM=INARTTV"
	. SET YBACK=YBACK1_"INARTTV1,"
	. DO ^WWWCGI
	. WRITE """>"
	. WRITE ARTT
	. WRITE "&nbsp;"
	. WRITE "</A>"
	. WRITE "</TD>"
	
	IF TART'="" IF $PIECE(ART(1),Y,1)'="" SET $PIECE(TEILE,Y,3)=$PIECE(ART(1),Y,1)  ;BEZEICHNUNG AKTUELLER ARTIKEL ;notation item 
	;AUF UND UP  ZEICHNUNGSPOSITIONEN ;upon And 
	WRITE YCR
	WRITE "<TD NOWRAP VALIGN=MIDDLE"
	;I YDDSATZ#2=1 W " BGCOLOR="_YWHITE
	WRITE " WIDTH=20>"
	write strListen
	;EINE POSITION + IN DER ZEICHNUNG ;one within the drawing 
	WRITE "<A HREF="""_YAKTION_"EP=WWWMANU&YEXEC=*D|PROCZ^INARTTV"
	DO
	. SET YBACK1=YBACK
	. NEW YBACK
	. WRITE "&YPARA1="_ART_","_DATUM_","_ARTT
	. WRITE "&YFUNCT1=UP"
	. SET YBACK=YBACK1
	. DO ^WWWCGI
	
	WRITE """>"
	WRITE "<IMG SRC="""_YGIF_"scrup.gif"" TITLE="""_$$^WWWTEXT(32015)_""" border=0 VSPACE=0>"
	WRITE "</A>"
	;EINE POSITION - IN DER ZEICHNUNG ;one within the drawing 
	WRITE "<A HREF="""_YAKTION_"EP=WWWMANU&YEXEC=*D|PROCZ^INARTTV"
	DO
	. SET YBACK1=YBACK
	. NEW YBACK
	. WRITE "&YPARA1="_ART_","_DATUM_","_ARTT
	. WRITE "&YFUNCT1=DOWN"
	. SET YBACK=YBACK1
	. DO ^WWWCGI
	
	WRITE """>"
	WRITE "<IMG SRC="""_YGIF_"scrdown.gif"" TITLE="""_$$^WWWTEXT(32016)_""" border=0 VSPACE=0>"
	WRITE "</A>"
	WRITE "</TD>"
	WRITE YCR
	FOR YI=18,1,3,4,5,6,7,70,8,15,16,17 DO  ;AUSGABE DER DATENTABELLE ;expenses the 
	. WRITE YCR
	. SET YBACK1=YBACK
	. NEW YBACK,YKEY
	. SET YKEY=ART_","_DATUM_","_ARTT
	. ;WRITE "<TD NOWRAP VALIGN=MIDDLE"
	. WRITE "<TD"
	. IF YLISTEN'=1 WRITE " NOWRAP"
	. WRITE " VALIGN=MIDDLE"
	. IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. IF (YI=4)!(YI=6)!(YI=7)!(YI=8)!(YI=18)!(YI=1) WRITE " ALIGN=RIGHT"
	. WRITE ">"
	. write strListen
	. IF (YI=1) || (YI=3) DO   ;IN ARTIKEL SPRINGEN UND ARTIKEL ÄNDERN ;within item leap And item alter 
	. . NEW YPARA,YKEY  ;KEINE TEILESTURKTUR ÜBERNEHMEN ;no assume 
	. . SET YKEY=TART  ;NEUER HAUPTARTIKEL
	. . WRITE "<A"
	. . WRITE " TITLE="""
	. . IF +VERSCHNITT=0!(YI'=8) WRITE $$^WWWTEXT(32060)   ;ARTIKEL BEARBEITEN ;item 
	. . IF +VERSCHNITT'=0&(YI=8) WRITE $$^WWWTEXT(32120)_" "_VERSCHNITT_"%"
	. . IF (YI=3) || (YI=5) DO
	. . . NEW YARTART
	. . . QUIT:$PIECE(TEILE,Y,1)=""
	. . . SET YARTART=$PIECE($GET(^INART(YM,$PIECE(TEILE,Y,1),1)),Y,26)
	. . . IF YARTART'="" WRITE $CHAR(13)_$PIECE($GET(^WWW101(0,"ARTIKEL-ART",SPRACHE,YARTART,1)),Y,1)
	. . ;
	. . WRITE """"
	. . WRITE " HREF="""_YAKTION_"EP=WWWFORM&YFORM=INART"
	. . SET YBACK=YBACK1_"INARTTV1,"  ; ZURÜCK ;retro- 
	. . DO ^WWWCGI
	. ;
	. IF YI'=1 IF YI'=3 DO    ;IN TEILEÄNDERUNG MIT ÜBERTEILESTURKTUR ;within by means of 
	. . WRITE "<A"
	. . IF +VERSCHNITT=0!(YI'=8) WRITE " TITLE="""_$$^WWWTEXT(32061)   ;ARTIKELTEILE BEARBEITEN
	. . IF +VERSCHNITT'=0&(YI=8) WRITE " TITLE="""_$$^WWWTEXT(32120)_" "_VERSCHNITT_"%"
	. . IF (YI=3)!(YI=5) DO
	. . . NEW YARTART
	. . . QUIT:$PIECE(TEILE,Y,1)=""
	. . . SET YARTART=$PIECE($GET(^INART(YM,$PIECE(TEILE,Y,1),1)),Y,26)
	. . . IF YARTART'="" WRITE $CHAR(13)_$PIECE($GET(^WWW101(0,"ARTIKEL-ART",SPRACHE,YARTART,1)),Y,1)
	. . ;
	. . WRITE """"
	. . WRITE " HREF="""_YAKTION_"EP=WWWFORM&YFORM=INARTTV"
	. . SET YBACK=YBACK1_"INARTTV1,"  ; ZURÜCK ;back 
	. . DO ^WWWCGI
	. ;
	. WRITE """>"
	. SET YTYPE=6  ;TEXTFORMAT
	. IF YI=3 IF $piece(TEILE,Y,30)'="" DO  ;SONDER BENENNUNG
	. . WRITE $piece(TEILE,Y,30)
	. . WRITE "&nbsp;"
	. ;
	. IF YI=6  SET YTYPE=12   ;GEWICHT ;wt. 
	. IF YI=15 SET YTYPE=12   ;LÄNGE   ;length
	. IF YI=16 SET YTYPE=12   ;BREITE  ;width 
	. IF YI=17 SET YTYPE=12   ;HÖHE    ;highness 
	. IF YI=4  SET YTYPE=12   ;MENGE   ;quantity 
	. IF YI=7  SET YTYPE=7    ;UHRZEITFORMAT
	. IF YI=70 SET YTYPE=7    ;UHRZEITFORMAT
	. IF YI=8  SET YTYPE=8   ;BETRAGSFORMAT
	. IF YI=5 IF $PIECE(TEILE,Y,YI)'="" SET $PIECE(TEILE,Y,YI)=$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE(TEILE,Y,YI),1)),Y,1)  ;EINHEIT ZUORDNEN FÜR DEN AUSDRUCK ;unity refer to term 
	. IF YI=4 IF $GET(YTEILSUM)>1 WRITE YTEILSUM_"X"   ;ANZAHL DER SUMMEN ;Number the purr 
	. WRITE $$^WWWTR(0,YTYPE,$PIECE(TEILE,Y,YI))  ;MIT UMFORMUNG ;by means of transformation 
	. ;IF YI=1 IF $PIECE(TEILE,Y,YI)="" WRITE $PIECE(TEILE,Y,YI+1)  ;WENN KEINE ARTIKELNUMMER DANN LEISTUNGSNUMMER
	. IF YI=6  SET GEWICHT = GEWICHT+$PIECE(TEILE,Y,YI)  ;ADDIEREN ;sum up 
	. IF YI=7  SET DAUER   = DAUER  +$PIECE(TEILE,Y,YI)  ;ADDIEREN ;sum up 
	. IF YI=70 SET RDAUER  = RDAUER +$PIECE(TEILE,Y,YI)  ;ADDIEREN ;sum up 
	. IF YI=8  SET WERT    = WERT   +$PIECE(TEILE,Y,YI)  ;ADDIEREN ;sum up 
	. WRITE "&nbsp;"
	. WRITE "</A>"
	. WRITE "</TD>", YCR
	
	WRITE "</TR>",YCR
	QUIT
	
KOPF ;kopf der anzeigetabelle ;who 
	WRITE "<THEAD>"
	IF YLISTEN=1 DO
	. WRITE "<TR>"
	. NEW YI
	. FOR YI=1:1:17 DO
	. . WRITE "<TH VALIGN=TOP NOWRAP ALIGN=LEFT"
	. . WRITE " BGCOLOR="_YDARKGRAY
	. . WRITE ">"
	. . WRITE "<FONT SIZE=1>"
	. . IF YI=8 DO 
	. . . QUIT:ART=""
	. . . WRITE "("_ART_")"  ;ARTIKEL ;item 
	. . . WRITE "  ",$PIECE($GET(^INART(YM,ART,1)),Y,1)
	. . WRITE "&nbsp;"
	. . WRITE "</TH>",YCR
	. WRITE "</TR>",YCR
	
	WRITE "<TR>"
	WRITE "<TH BGCOLOR="_YDARKGRAY_" >"
	write strListen
	WRITE "&nbsp;"   ;LÖSCHEN
	WRITE YCR,"</TH>"
	
	WRITE "<TH BGCOLOR="_YDARKGRAY_" WIDTH=24>"
	write strListen
	WRITE "&nbsp;"    ;TEILE DER TEILE VORHANDEN
	WRITE YCR,"</TH>"
	
	WRITE "<TH BGCOLOR="_YDARKGRAY_" WIDTH=20>"
	write strListen
	WRITE "<A TITLE="""_$$^WWWTEXT(32151)_""""  ;FERTIGUNGSPOSITION
	WRITE " HREF=#>"
	WRITE "&nbsp;P&nbsp;"  ;POSITIONIERUNG
	WRITE "</A>"
	WRITE YCR,"</TH>"
	
	WRITE "<TH NOWRAP ALIGN=RIGHT BGCOLOR="_YDARKGRAY_">"
	write strListen
	WRITE "<A TITLE="""_$$^WWWTEXT(32151)_""""  ;FERTIGUNGSPOSITION
	WRITE " HREF=#>"
	SET TEXT=$PIECE($GET(^WWW0021(0,"INARTTV",3,SPRACHE,1)),Y,1)  ;SPRACHENTEXT
	IF TEXT="" SET TEXT=$PIECE($GET(^WWW002(0,"INARTTV",3,1)),Y,2)  ;POSITION
	WRITE "P-"_TEXT
	WRITE "</A>"
	WRITE YCR,"</TH>"
	
	WRITE "<TH BGCOLOR="_YDARKGRAY_" WIDTH=20>"
	write strListen
	WRITE "<A TITLE="""_$$^WWWTEXT(32152)_""""  ;ZEICHNUNGSPOSITION
	WRITE " HREF=#>"
	WRITE "&nbsp;Z&nbsp;"  ;ZEICHNUNGS POSITIONIERUNG
	WRITE "</A>"
	WRITE YCR,"</TH>"
	
	FOR YI=18,1,3,4,5,6,7,70,8,15,16,17 DO
	. WRITE "<TH ALIGN=LEFT NOWRAP BGCOLOR="_YDARKGRAY_">"
	. write strListen
	. IF YI=18 WRITE "<A TITLE="""_$$^WWWTEXT(32152)_"""" WRITE " HREF=#>" ;ZEICHNUNGSPOSITION
	. SET TEXT=$PIECE($GET(^WWW0031(0,"INARTTV",YI,SPRACHE,1)),Y,1)  ;SPRACHENTEXT
	. IF TEXT="" SET TEXT=$PIECE($GET(^WWW003(0,"INARTTV",YI,1)),Y,2)  ;DATENFELD ;data item 
	. WRITE TEXT
	. IF YI=18 WRITE "</A>"
	. WRITE YCR,"</TH>"
	
	WRITE YCR,"</TR>"
	WRITE "<THEAD>"
	QUIT
	
PROC
	;-------------------------------------------------------------------------------
	;	BEARBEITUNG DER FUNKTIONEN BEI BUTTON AUF AB UND LÖSCHEN / ACHTUNG EINSPRUNG AUS INARTTV2 ;adaptation the next to upon Confirm. And Delete estimation out of 
	;
	; History:
	; 05-Feb-2008	GRF		SR15627: Call MasterfileChanged to use $$$Save; quits
	;-------------------------------------------------------------------------------
	KILL ^WWWSOR(YUSER,"NEU")
	NEW YI
	
	SET YFUNCT1 = $GET(%(YQUERY,"YFUNCT1"))  ;FUNKTION (UP DOWN KILL)
	SET YPARA1  = $GET(%(YQUERY,"YPARA1"))   ;ARTIKEL UND TEILENUMMER ;item And 
	SET ART     = $PIECE(YPARA1,",",1)
	SET DATUM   = $PIECE(YPARA1,",",2)
	SET ARTT    = $PIECE(YPARA1,",",3)
	
	IF YFUNCT1="KILL" DO   ;LÖSCHEN DATENSATZ ;Delete data record 
	. IF ART'="" IF ARTT'="" DO
	. . NEW YI,ARTTX,YFORM,YVOR
	. . SET YFORM="INARTTV"
	. . DO ^WWWKILL("INARTTV",ART_","_DATUM_","_ARTT)  ;ARTIKEL LÖSCHEN ;item Delete 
	. . SET ARTTX=""
	. . FOR  SET ARTTX=$ORDER(^INARTTV(YM,ART,DATUM,ARTTX)) QUIT:ARTTX=""  DO
	. . . SET ^WWWSOR(YUSER,"NEU",ART,ARTTX,1)=^INARTTV(YM,ART,DATUM,ARTTX,1)  ;NEUE REIHENFOLGE FESTLEGENU ;row 
	. . . DO ^WWWKILL("INARTTV",ART_","_DATUM_","_ARTTX)  ;ARTIKEL LÖSCHEN ;item Delete 
	. . ;
	. . SET ARTTX=""
	. . FOR YI=1:1 SET ARTTX=$ORDER(^WWWSOR(YUSER,"NEU",ART,ARTTX)) QUIT:ARTTX=""  DO
	. . . SET YTEIL1=$GET(^WWWSOR(YUSER,"NEU",ART,ARTTX,1))  ;NEUE REIHENFOLGE ;row 
	. . . SET YOK=$$^WWWSPEI("INARTTV",ART_","_DATUM_","_YI,YTEIL1,1)   ;SPEICHERN ARTIKELTEIL ;Save 
	
	IF YFUNCT1="UP" DO   ;EINE POSITION HERAUF ;one upwards 
	. IF ART'="" IF ARTT'="" DO
	. . NEW YI,ARTTX,YFORM,YVOR
	. . SET YFORM="INARTTV"
	. . QUIT:ARTT=1
	. . QUIT:'$DATA(^INARTTV(YM,ART,DATUM,ARTT))  ;NICHT VORHANDEN ;Not on hand 
	. . QUIT:'$DATA(^INARTTV(YM,ART,DATUM,(ARTT-1)))  ;NICHT VORHANDEN ;Not on hand 
	. . SET YI(1)=^INARTTV(YM,ART,DATUM,ARTT-1,1)
	. . DO ^WWWKILL("INARTTV",ART_","_DATUM_","_(ARTT-1))  ;ARTIKEL LÖSCHEN ;item Delete 
	. . SET YI(2)=^INARTTV(YM,ART,DATUM,ARTT,1)
	. . DO ^WWWKILL("INARTTV",ART_","_DATUM_","_ARTT)  ;ARTIKEL LÖSCHEN ;item Delete 
	. . SET YOK=$$^WWWSPEI("INARTTV",ART_","_DATUM_","_(ARTT-1),YI(2),1)   ;SPEICHERN ARTIKELTEIL ;Save 
	. . SET YOK=$$^WWWSPEI("INARTTV",ART_","_DATUM_","_ARTT,YI(1),1)   ;SPEICHERN ARTIKELTEIL ;Save 
	   
	IF YFUNCT1="DOWN" DO   ;EINE POSITION HERAUF ;one upwards 
	. IF ART'="" IF ARTT'="" DO
	. . NEW YI,ARTTX,YFORM,YVOR
	. . SET YFORM="INARTTV"
	. . QUIT:'$DATA(^INARTTV(YM,ART,DATUM,(ARTT+1)))  ;NICHT VORHANDEN ;Not on hand 
	. . QUIT:'$DATA(^INARTTV(YM,ART,DATUM,ARTT))  ;NICHT VORHANDEN ;Not on hand 
	. . SET YI(1)=^INARTTV(YM,ART,DATUM,(ARTT+1),1)
	. . DO ^WWWKILL("INARTTV",ART_","_DATUM_","_(ARTT+1))  ;ARTIKEL LÖSCHEN ;item Delete 
	. . SET YI(2)=^INARTTV(YM,ART,DATUM,ARTT,1)
	. . DO ^WWWKILL("INARTTV",ART_","_DATUM_","_ARTT)  ;ARTIKEL LÖSCHEN ;item Delete 
	. . SET YOK=$$^WWWSPEI("INARTTV",ART_","_DATUM_","_(ARTT+1),YI(2),1)   ;SPEICHERN ARTIKELTEIL ;Save 
	. . SET YOK=$$^WWWSPEI("INARTTV",ART_","_DATUM_","_ARTT,YI(1),1)   ;SPEICHERN ARTIKELTEIL ;Save 
	
	IF YFUNCT1="EDIT" DO   ;EINE POSITION ;one 
	. IF ART'="" IF ARTT'="" DO
	. . QUIT:'$DATA(^INARTTV(YM,ART,DATUM,ARTT))    ;NICHT VORHANDEN ;Not on hand 
	. . SET YI=$GET(^INARTTV(YM,ART,DATUM,ARTT,1))  ;ZWISCHENSPEICHER
	. . SET %("VAR","YKEY")=ART_","_ARTT
	
	; do nothing block commented
	;IF ART'="" DO
	;. ;QUIT:+$GET(YOPTION)=1  ;SCHNELLERFASSUNG
	;. ;IF +$GET(YOPTION)=0 DO ^INARTNEU(ART) 
	;. ;DO ^INARTXL(ART,YOPTION)  ;ARTIKELSTRUKTUR NEU  
	
	;SPEICHERN ÄNDERUNGSMITARBEITER ;Save 
	;IF ART'="" DO
	;. SET $PIECE(^INART(YM,ART,1),Y,24)=$HOROLOG
	;. SET $PIECE(^INART(YM,ART,1),Y,25)=YBED
	set YOK = $$MasterfileChanged^INARTMaster(ART,YBED)
	
	QUIT:$GET(YSONDERFUNKTION)=1  ;SONDERFUNKTIONSAUFRUF AUS INARTTV2 ;out of 
	
	SET YFORM="INARTTV1"
	SET %(YQUERY,"YFORM")=YFORM
	SET %("VAR","YFORM")=YFORM
	DO ^WWWFORM
	QUIT
	
PROCZ ;BEARBEITUNG DER FUNKTIONEN BEI BUTTON AUF AB UND LÖSCHEN  FÜR ZEICHNUNGSPOSITIONEN ;adaptation the next to upon Confirm. And Delete to 
	NEW YI
	
	SET YFUNCT1 = $GET(%(YQUERY,"YFUNCT1"))  ;FUNKTION (UP DOWN KILL)
	SET YPARA1  = $GET(%(YQUERY,"YPARA1"))   ;ARTIKEL UND TEILENUMMER ;item And 
	SET ART     = $PIECE(YPARA1,",",1)
	SET DATUM   = $PIECE(YPARA1,",",2)
	SET ARTT    = $PIECE(YPARA1,",",3)
	
	IF YFUNCT1="UP" DO   ;EINE POSITION HERAUF ;one upwards 
	. IF ART'="" IF ARTT'="" DO
	. . NEW YI
	. . SET YI=$PIECE($GET(^INARTTV(YM,ART,DATUM,ARTT,1)),Y,18)
	. . SET YI=YI+1
	. . SET $PIECE(^INARTTV(YM,ART,DATUM,ARTT,1),Y,18)=YI
	    
	IF YFUNCT1="DOWN" DO   ;EINE POSITION HERAUF ;one upwards 
	. IF ART'="" IF ARTT'="" DO
	. . NEW YI
	. . SET YI=$PIECE($GET(^INARTTV(YM,ART,DATUM,ARTT,1)),Y,18)
	. . SET YI=YI-1
	. . IF YI<1 SET YI=""  ;KEINE ZEICHNUNGS POSITIONSNR ;no 
	. . SET $PIECE(^INARTTV(YM,ART,DATUM,ARTT,1),Y,18)=YI
	
	SET YFORM="INARTTV1"
	SET %(YQUERY,"YFORM")=YFORM
	SET %("VAR","YFORM")=YFORM
	DO ^WWWFORM
	QUIT
	
LIST(YKEY) ;LISTE DER ANGEBOTSTEILE ;list the 
	NEW YLISTEN
	
	SET YLISTEN=1
	DO ^WWWBACK
	DO INARTTV
	QUIT
]]></Routine>
</Export>