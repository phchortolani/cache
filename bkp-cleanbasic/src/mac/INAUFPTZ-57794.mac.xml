<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFPTZ" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFPTZ	;INAUFPTZ;FIS;PRÜFEN FERTIGUNGSZEITEN;18.09.2003
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		PRÜFEN FERTIGUNGSZEITEN
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| FIS	18.09.2003
	;|
	;\------------------------------------------------------------------/
	;
	NEW AUF,POS,TEIL,LFN,TIME,TEIL1,ARBBEGINN,LFD,TERMIN
	SET YKEY=$GET(YKEY)
	SET AUF=$PIECE(YKEY,",",1)
	QUIT:AUF=""
	SET POS=$PIECE(YKEY,",",2)
	QUIT:POS=""
	SET TEIL=$PIECE(YKEY,",",3)
	QUIT:TEIL=""
	SET LFD=$PIECE(YKEY,",",4)
	SET TERMIN=$PIECE($GET(YFELD),Y,1)
	SET TEIL1=$GET(^INAUFPT(YM,AUF,POS,TEIL,1))
	QUIT:TEIL1=""
	SET TIME=0
	SET LFN=0 FOR  SET LFN=$ORDER(^INAUFPTZ(YM,AUF,POS,TEIL,LFN)) QUIT:LFN=""  DO
	. SET TIME=TIME+$PIECE($GET(^INAUFPTZ(YM,AUF,POS,TEIL,LFN,1)),Y,3)
	. QUIT
	SET ARBBEGINN=$PIECE($GET(^INAUFPTZ(YM,AUF,POS,TEIL,0,1)),Y,2)
	IF ARBBEGINN="" SET ARBBEGINN=$PIECE($GET(^INVORG(YM,YM,1)),Y,152)
	IF ARBBEGINN="" SET ARBBEGINN=$$^WWWTIME1("08:00:00")
	IF LFD'=0 DO
	. IF TIME<$PIECE(TEIL1,Y,45) DO
	. . SET ^INAUFPTZ(YM,AUF,POS,TEIL,0,1)=$PIECE(TEIL1,Y,168)_Y_ARBBEGINN_Y_($PIECE(TEIL1,Y,45)-TIME)
	. . QUIT
	. IF TIME=$PIECE(TEIL1,Y,45) DO
	. . SET ^INAUFPTZ(YM,AUF,POS,TEIL,0,1)=$PIECE(TEIL1,Y,168)_Y_ARBBEGINN_Y_$PIECE($GET(^INAUFPTZ(YM,AUF,POS,TEIL,LFD,1)),Y,3)
	. . KILL ^INAUFPTZ(YM,AUF,POS,TEIL,LFD)
	. . QUIT
	. IF TIME>$PIECE(TEIL1,Y,45) DO
	. . KILL ^INAUFPTZ(YM,AUF,POS,TEIL,LFD)
	. . QUIT
	. QUIT
	IF LFD=0 DO  ;KORRIGIEREN HAUPTTEIL
	. NEW YKEY,YFELD,YVOR
	. SET YKEY=AUF_","_POS_","_TEIL
	. SET YFELD=$GET(^INAUFPT(YM,AUF,POS,TEIL,1))
	. SET $PIECE(YFELD,Y,168)=$PIECE($GET(^INAUFPTZ(YM,AUF,POS,TEIL,LFD,1)),Y,1)
	. SET $PIECE(YFELD,Y,45)=(TIME+$PIECE($GET(^INAUFPTZ(YM,AUF,POS,TEIL,LFD,1)),Y,3))
	. DO SET^INAUFPT  ;LÖSCHT INAUFPTZ, DA MANUELLE TERMINVERGABE !!!
	. QUIT
	DO ^INAUF1SEL()
	QUIT
]]></Routine>
</Export>