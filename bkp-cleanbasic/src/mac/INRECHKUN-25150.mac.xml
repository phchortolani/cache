<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INRECHKUN" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INRECHKUN ;INRECHKUN;FIS;DRUCKEN ALLE RECHNUNGEN VON KUNDEN;15.05.2003  ; Compiled March 9, 2005 11:05:03
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		DRUCKEN ALLE RECHNUNGEN VON KUNDEN
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;| 13-Apr-2006		JW			Removed + from user id's in lock check
	;| 30-May-2005		RobertW		SR12056: Attempt at Performance Increase
	;| FIS	15.05.2003  
	;|
	;\------------------------------------------------------------------/
	;
	;
	;BEC;05.07.04;25635;LAYOUT DYN. ANPASSEN
	NEW AUF,AUF1,POS,POS1,YAUFTRAG,YMULTIPLE,ANZM,WH,RG,KUNDE,KUNDES,ABGE,DAT,YSAMMEL,SORTS,SATZ,YQ,LF,OLDDATE
	SET VORG(1)=$GET(VORG(1))       ;VON KUNDE ;customer 
	SET VORG(2)=$GET(VORG(2))       ;BIS KUNDE ;until customer 
	SET VORG(3)=$GET(VORG(3))       ;VON AUFTRAG ;order 
	SET VORG(4)=$GET(VORG(4))       ;BIS AUFTRAG ;until order 
	SET VORG(5)=$GET(VORG(5))       ;VON LIEFERDATUM
	SET VORG(6)=$GET(VORG(6))       ;BIS LIEFERDATUM ;until 
	SET VORG(7)=+$GET(VORG(7))      ;ALLE OFFENEN RECHNUNGEN
	SET VORG(8)=+$GET(VORG(8))      ;WIEDERHOLUNGSDRUCK
	SET VORG(9)=+$GET(VORG(9))      ;NUR WENN VOLLSTÄNDIG GELIEFERT ;only when integral 
	SET VORG(10)=+$GET(VORG(10))    ;NUR KUNDEN MIT SAMMELRECHNUNGSDRUCK ;only by means of 
	SET VORG(11)=+$GET(VORG(11))    ;KEINE EINZELBELÄGE, NUR SAMMELBELEGE
	SET VORG(12)=+$GET(VORG(12))    ;INNERHALB KUNDEN NACH PROJEKTNUMMER SORTIEREN ;inside within assortment 
	SET VORG(13)=$GET(VORG(13))     ;NUR FÜR BELEGVERSANDART AUSGEBEN ;only to 
	SET VORG(13)=$TRANSLATE(VORG(13),";",",")
	SET VORG(14)=+$GET(VORG(14))    ;MIT ZWISCHENSUMME ;by means of subtotal 
	SET VORG(15)=+$GET(VORG(15))    ;MIT AUFLISTUNG DER KONTEN UND KOSTENSTELLEN;FIS;10.12.04;26705
	SET VORG(16)=$GET(VORG(16))     ;ALTERNATIVES BUCHUNGSDATUM
	IF VORG(16)'="" SET VORG(16)=$$^INRECHDAT(VORG(16))  ;PRÜFEN RECHNUNGSDATUM AUF GÜLTIGKEIT
	SET YTEST=$GET(YTEST)           ;ONLY TESTPRINT
	;
	IF YTEST'=1 IF VORG(10)=0 IF VORG(7)=1 IF VORG(1)="" DO ^WWWINFO($$^WWWTEXT(32310)) QUIT  ;KEINE AUSWAHL GETROFFEN ;no Selection 
	IF VORG(2)="" SET VORG(2)=VORG(1)  ;NUR 1 KUNDE ;only customer 
	IF YTEST'=1 IF VORG(7)=0 IF VORG(3)="" IF VORG(4)="" IF VORG(5)="" IF VORG(6)="" IF VORG(9)=0 DO ^WWWINFO($$^WWWTEXT(32310)) QUIT  ;KEINE AUSWAHL GETROFFEN ;no Selection 
	IF VORG(7)=1 SET (VORG(3),VORG(4),VORG(5),VORG(6),VORG(9))=""
	;
	SET VORG(99)=""
	IF VORG(11)=1 IF VORG(10)=1 SET VORG(99)=1    ;NO PRINT
	KILL ^WWWSOR(YUSER)
	KILL ^WWWSOR(YUSER_"-SUM")    ;BEC;26820;02.12.04
	SET ANZM=0
	SET AUF=""
	;
	IF VORG(99)'=1 DO LOW^%PRIO
	WRITE YCR,"<FONT SIZE=2></FONT>"  ;TRICK GEGEN TIMEOUT
	;
	SET DRUCKOK=0
	;
	NEW YBELEG1,ANZKOP,STYLE,PRE,YA,LOCK
	;
	SET YBELEG=7    ;RECHNUNG ;tab 
	SET YBELEG1=$GET(^INDRPARA(YM,YLOCATION,YBELEG,SPRACHE,1))  ;DRUCKPARAMETER FÜR BELEGE ;to 
	IF $DATA(^INDRPARARS(YM,YLOCATION,YBELEG,SPRACHE,1)) SET YBELEG1=^(1)    ;BEC;25635;28.06.04
	SET ANZKOP=$PIECE(YBELEG1,Y,2)  ;ANZAHL BELEGE
	IF +ANZKOP=0 SET ANZKOP=1
	;
	SET STYLE=""  ;BEC;09.07.04;25635  
	IF YTEST=1 SET VORG(99)=1
	SET PRE=0      ;=1 PRE FORMATET
	IF +$PIECE(YBELEG1,Y,7)=10!(+$PIECE(YBELEG1,Y,7)=19) SET PRE=1     ;NUR BEI PRE UND COURIER UND LUCIDA ;only next to And And 
	;
	IF $PIECE(YBELEG1,Y,250)=1 DO
	. SET STYLE=$PIECE($GET(^INDRPARAHTML(YM,YLOCATION,7,SPRACHE,0,1)),Y,6)    ;BEC;09.07.04;25635  
	. ;SET STYLE=$PIECE(STYLE,"</STYLE>",1)_"</STYLE>"
	. ;SET STYLE="<STYLE"_$PIECE(STYLE,"<STYLE",2)
	. new strSTYLE
	. set strSTYLE=$zconvert(STYLE,"U")
	. ;IF '$FIND($$^WWWUPER(STYLE),"<STYLE>") SET STYLE="<STYLE>|"_STYLE
	. IF '$FIND(strSTYLE,"<STYLE>") SET STYLE="<STYLE>|"_STYLE
	. ;IF '$FIND($$^WWWUPER(STYLE),"</STYLE>") SET STYLE=STYLE_"|</STYLE>"
	. IF '$FIND(strSSTYLE,"</STYLE>") SET STYLE=STYLE_"|</STYLE>"
	. SET STYLE=$$^WWWTRANSLATE(STYLE,"|",YCR)
	. IF PRE=1 SET STYLE=""
	. QUIT
	IF VORG(99)=1 DO
	. IF STYLE="" DO ^WWWSTART() QUIT
	. WRITE YCR,"<HTML><HEAD>",YCR
	. WRITE STYLE 
	. WRITE YCR,"</HEAD><BODY>",YCR
	. QUIT
	IF VORG(99)=1 DO ^WWWBACK    ;NUR BEI EINZELBRUCK ;only next to 
	;
	SET KUNDE=""
	KILL LOCK
	DO:YTEST=""                 ;WENN KEIN TESTPRINT ;when no 
	. IF VORG(16)'="" SET OLDDATE=$ZUTIL(71,VORG(16))  ;ALTERNATIVES BUCHUNGSDATUM
	. IF VORG(1)'="" SET KUNDE=$ORDER(^INKUNDE(YM,VORG(1)),-1)  ;AB KUNDE ;Confirm. customer 
	. IF VORG(2)="" SET VORG(2)=$ORDER(^INKUNDE(YM,VORG(1)),-1)  ;BIS KUNDE ;until customer 
	. FOR  SET KUNDE=$ORDER(^INKUNDE(YM,KUNDE)) QUIT:KUNDE=""  QUIT:KUNDE]]VORG(2)  DO  ;BIS KUNDE ;until customer 
	. . SET YSAMMEL=$PIECE($GET(^INKUNDE(YM,KUNDE,1)),Y,223)
	. . IF VORG(10)=1 QUIT:YSAMMEL'=1  ;NUR WENN SAMMELDRUCK ;only when 
	. . IF YSAMMEL=1 KILL ^WWWSOR(YUSER,"SAMMEL")
	. . IF YSAMMEL=1 KILL ^WWWSOR(YUSER,"SAMMELPOS")
	. . IF YSAMMEL=1 KILL ^WWWSOR(YUSER,"SAMMELYREF")
	. . ;
	. . KILL ^WWWSOR(YUSER,"SORT")  ;ZWISCHENDATEI FÜR SORTIERUNG;FIS;10.03.04;25298
	. . SET KUNDES=$$^WWWUMLAU(KUNDE,1)
	. . SET DAT="" FOR  SET DAT=$ORDER(^INAUFs(YM,21,KUNDES,DAT)) QUIT:DAT=""  FOR ABGE=" ",0 DO  QUIT:$DATA(LOCK(KUNDE))  ;FIS;26966;KEINE SAMMELRECHNUNG, WENN MIN. 1 AUFTRAG GELOCKT;21.01.05 ; SR14010
	. . . SET AUF="" FOR  SET AUF=$ORDER(^INAUFs(YM,21,KUNDES,DAT,ABGE,AUF)) QUIT:AUF=""  DO  QUIT:$DATA(LOCK(KUNDE))  ;FIS;26966;KEINE SAMMELRECHNUNG, WENN MIN. 1 AUFTRAG GELOCKT;21.01.05
	. . . . IF VORG(3)'="" QUIT:VORG(3)]]AUF  ;FALSCHER AUFTRAG ;order 
	. . . . IF VORG(4)'="" QUIT:AUF]]VORG(4)  ;FALSCHER AUFTRAG ;order 
	. . . . SET AUF1=$GET(^INAUF(YM,AUF,1))
	. . . . QUIT:+$PIECE(AUF1,Y,2)'=0  ;NUR KUNDENAUFTRÄGE ;only 
	. . . . ;
	. . . . NEW YA,YA1,XUSER
	. . . . SET YA="" FOR  SET YA=$ORDER(^WWW006(0,YA)) QUIT:YA=""  DO  ;FIS;26966;KEINE SAMMELRECHNUNG, WENN MIN. 1 AUFTRAG GELOCKT;21.01.05
	. . . . . IF +YA'=+$HOROLOG KILL ^WWW006(0,YA) QUIT  ;LÖSCHEN ALTE LOCKFILE ;Delete 
	. . . . . SET YA1="" FOR  SET YA1=$ORDER(^WWW006(0,YA,YA1)) QUIT:YA1=""  DO
	. . . . . . SET XUSER=$PIECE($GET(^WWW006(0,YA,YA1,1)),Y,1)
	. . . . . . IF XUSER=YUSER KILL ^WWW006(0,YA,YA1) QUIT
	. . . . . . IF '$DATA(^WWWUSER(0,XUSER)) KILL ^WWW006(0,YA,YA1) QUIT  ;tybd;5,08,2003;zu lange gelocked
	. . . . . . IF $FIND(YA1,"INAUF/"_YM_"."_AUF_".")!($FIND(YA1,"INAUFP/"_YM_"."_AUF_".")) DO
	. . . . . . . SET LOCK(KUNDE)=AUF
	. . . . . . QUIT
	. . . . . QUIT
	. . . . QUIT:$DATA(LOCK(KUNDE))  ;FIS;26966;KEINE SAMMELRECHNUNG, WENN MIN. 1 AUFTRAG GELOCKT;21.01.05
	. . . . SET SORTS=AUF  ;NACH AUFTRÄGEN SORTIERT ;within 
	. . . . IF VORG(12)=1 SET SORTS=$PIECE(AUF1,Y,8)    ;PROJEKT ;scheme 
	. . . . IF VORG(12)=2 SET SORTS=$PIECE(AUF1,Y,300)  ;EXT. BESTELLNUMMER;FIS;13.04.04;25507
	. . . . IF SORTS="" SET SORTS=" "
	. . . . SET ^WWWSOR(YUSER,"SORT",SORTS,AUF)=""      ;ZWISCHENDATEI FÜR SORTIERUNG;FIS;10.03.04;25298
	. . . . QUIT
	. . . QUIT
	. . IF $DATA(LOCK(KUNDE)) DO  QUIT  ;FIS;26966;KEINE SAMMELRECHNUNG, WENN MIN. 1 AUFTRAG GELOCKT;21.01.05
	. . . WRITE $$^WWWTEXT(32047)_" "_$GET(LOCK(KUNDE))_" "_$$^WWWTEXT(32285)_" "_$$^WWWTEXT(10004)_"!"  ;AUFTRAG XXX GESPERRT
	. . . QUIT
	. . IF YSAMMEL=1 IF $DATA(^WWWSOR(YUSER,"SORT")) SET ^WWWSOR(YUSER,"SAMMELYREF")=$$^WWWNEXT("INDRPARARS")  ;BELEGNUMMER SAMMELRECHNUNG;FIS;31.01.05;26967
	. . SET SORTS="" FOR  SET SORTS=$ORDER(^WWWSOR(YUSER,"SORT",SORTS)) QUIT:SORTS=""  DO
	. . . SET AUF="" FOR  SET AUF=$ORDER(^WWWSOR(YUSER,"SORT",SORTS,AUF)) QUIT:AUF=""  DO
	. . . . SET AUF1=$GET(^INAUF(YM,AUF,1))
	. . . . ;
	. . . . ;RECHNUNGEN/GUTSCHRIFTEN
	. . . . DO
	. . . . . KILL YAUFTRAG
	. . . . . SET WH=""
	. . . . . SET RG=""
	. . . . . SET LF=""
	. . . . . SET POS="" FOR  SET POS=$ORDER(^INAUFP(YM,AUF,POS)) QUIT:POS=""  DO
	. . . . . . SET POS1=$GET(^INAUFP(YM,AUF,POS,1))
	. . . . . . QUIT:$PIECE(POS1,Y,205)=1  ;GESPERRT ;DISABLED 
	. . . . . . QUIT:$PIECE(POS1,Y,9)=1  ;STORNIERT
	. . . . . . IF $PIECE(POS1,Y,5)'<0 IF $PIECE($GET(^INVORG(YM,YM,1)),Y,150)=1 IF +$PIECE(POS1,Y,90)'=1 QUIT   ;NUR AUSLIEFERUNGSFÄHIGE DRUCKEN;TYBD;27,07,2003;UL (TONY)
	. . . . . . IF $PIECE(POS1,Y,5)'<0 IF $PIECE($GET(^INVORG(YM,YM,1)),Y,150)=2 IF $PIECE(POS1,Y,92)="" QUIT   ;NUR GELIEFERTE DRUCKEN;FIS;26043;31.08.04
	. . . . . . IF $PIECE(POS1,Y,5)'<0 IF VORG(16)'="" IF $PIECE($GET(^INVORG(YM,YM,1)),Y,150)=2 IF $PIECE(POS1,Y,92)>VORG(16) QUIT   ;LIEFERUNG NACH BUCHUNGSZEITRAUM;FIS;26967;03.02.05
	. . . . . . IF +$PIECE(POS1,Y,7)=0 IF $PIECE(POS1,Y,4)'="" IF $PIECE($GET(^INART(YM,$PIECE(POS1,Y,4),1)),Y,29)'=1 SET WH="X"  ;KEINE WH DEFINIERT  ;ÄNDERUNGEN GGF. AUCH IN INRECH1 ! ;BEC;22.05.03;ARTIKEL OHNE BESTAND
	. . . . . . IF $PIECE(POS1,Y,92)="" IF $PIECE(POS1,Y,103)'="" SET $PIECE(POS1,Y,92)=+$PIECE(POS1,Y,103)
	. . . . . . ;
	. . . . . . ;IF VORG(9)=1 IF $PIECE(POS1,Y,97)="" SET RG="X"  ;NOCH NICHT BERECHNET;FIS;23320;30.05.03 -> SIEHE UNTEN
	. . . . . . IF VORG(9)=1 IF $PIECE(POS1,Y,92)="" SET LF="X"  ;NOCH NICHT vollständig geliefert;FIS;23320;03.05.04
	. . . . . . IF VORG(5)'=""!(VORG(6)'="") QUIT:$PIECE(POS1,Y,92)=""  ;NOCH NICHT GELIEFERT ;yet Not 
	. . . . . . IF VORG(5)'="" QUIT:VORG(5)]]$PIECE(POS1,Y,92)  ;FALSCHES LIEFERDATUM
	. . . . . . IF VORG(6)'="" QUIT:$PIECE(POS1,Y,92)]]VORG(6)  ;FALSCHES LIEFERDATUM
	. . . . . . IF VORG(16)'="" IF VORG(8)'=0 IF $PIECE(POS1,Y,97)>VORG(16) QUIT  ;RECHNUNG NACH BUCHUNGSZEITRAUM;FIS;26967;03.02.05
	. . . . . . ;
	. . . . . . IF VORG(8)=0 IF $PIECE(POS1,Y,97)="" SET YAUFTRAG(POS)=""   ;GESAMTDRUCK
	. . . . . . IF VORG(8)'=0 IF $PIECE(POS1,Y,97)'="" SET YAUFTRAG(POS)=""   ;WIEDERHOLUNGSDRUCK
	. . . . . . QUIT
	. . . . . ;
	. . . . . ;IF VORG(9)=1 IF RG="X" QUIT  ;NICHT ALLE POSITIONEN BERECHNET
	. . . . . IF VORG(9)=1 IF LF="X" QUIT  ;NICHT ALLE POSITIONEN GELIEFERT ;Not 
	. . . . . ;IF $PIECE($GET(^INVORG(YM,YM,1)),Y,141)'=1 IF VORG(8)'=0 IF WH="X" QUIT  ;NICHT ALLE WH ERFASST  ;BEC;23605;22.0503
	. . . . . IF $PIECE($GET(^INVORG(YM,YM,1)),Y,141)'=1 IF WH="X" QUIT  ;FIS;06.05.04
	. . . . . QUIT:'$DATA(YAUFTRAG)  ;KEINE Positionen ;no Order Line Items
	. . . . . ;
	. . . . . SET YAUFTRAG=AUF
	. . . . . IF VORG(8)'=0 SET YCOPY=1  ;WIEDERHOLUNGSDRUCK
	. . . . . SET YSEND=0                ;VERSANDART
	. . . . . SET YBELEG=7               ;RECHNUNG ;tab 
	. . . . . SET YMULTIPLE=$GET(YMULTIPLE)+1  ;MEHRERE AUFTRÄGE ;divers 
	. . . . . IF YMULTIPLE>1 IF YSEND=0 IF VORG(99)'=1 DO FF^WWWW()  ;SEITENVORSCHUB
	. . . . . ;
	. . . . . NEW YCOPY1
	. . . . . SET YCOPY1=$GET(YCOPY)
	. . . . . IF $GET(VORG(13))'="" DO  QUIT     ;BEC;26820;24.11.04;BELEGART
	. . . . . . NEW YISU,YSENDART,YXAUFTRAG
	. . . . . . KILL YXAUFTRAG
	. . . . . . MERGE YXAUFTRAG=YAUFTRAG
	. . . . . . FOR YISU=1:1 QUIT:$PIECE(VORG(13),",",YISU,999)=""  DO
	. . . . . . . NEW YAUFTRAG  ;FIS;07.02.05;27268
	. . . . . . . KILL YAUFTRAG  ;FIS;07.02.05;27268
	. . . . . . . MERGE YAUFTRAG=YXAUFTRAG  ;FIS;07.02.05;27268;YAUFTRAG GEHT VERLOREN
	. . . . . . . SET YCOPY=YCOPY1
	. . . . . . . SET YSTOP=""
	. . . . . . . SET VORG(99)=""
	. . . . . . . IF VORG(11)=1 IF VORG(10)=1 SET VORG(99)=1
	. . . . . . . SET YSENDART=$PIECE(VORG(13),",",YISU)
	. . . . . . . QUIT:YSENDART=""
	. . . . . . . IF +YSENDART'=0 IF VORG(11)=1 IF YCOPY'=1 IF YSEND'=0 SET VORG(99)=1    ;NO PRINT
	. . . . . . . DO ^INDRUCK     ;DRUCK DER ANFRAGE ;printing the 
	. . . . . . . IF VORG(99)'=1 DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPARTNER     ;FAN;13.03.2003;23059
	. . . . . . . SET ANZM=ANZM+1
	. . . . . . . IF $GET(DRUCKOK)'=1 IF $GET(YSTOP)'=1 SET DRUCKOK=1    ;BEC;24.11.04;26820
	. . . . . . . IF $GET(YSTOP)'=1 SET ^WWWSOR(YUSER_"-SUM",YAUFTRAG,1)=$GET(YAUFTRAG)_Y_$GET(YSEND)_Y_$GET(INFO)
	. . . . . . . QUIT
	. . . . . . QUIT
	. . . . . ;
	. . . . . DO ^INDRUCK     ;DRUCK DER RECHNUNGEN ;printing the 
	. . . . . IF VORG(99)'=1 DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPATNER     ;FAN;13.03.2003;23059
	. . . . . SET ANZM=ANZM+1
	. . . . . QUIT
	. . . . ;
	. . . . ;TEIL-/ANZAHLUNGSRECHNUNGEN
	. . . . DO
	. . . . . NEW DATUM,YAUFTRAG,INAUFPZ1,AUF1,DATUMB
	. . . . . SET DATUM=""
	. . . . . IF VORG(5)'="" SET DATUM=$ORDER(^INAUFPZ(YM,AUF,DATUM),-1)
	. . . . . SET DATUMB=VORG(6)
	. . . . . IF DATUMB="" SET DATUMB=$ORDER(^INAUFPZ(YM,AUF,""),-1)
	. . . . . FOR  SET DATUM=$ORDER(^INAUFPZ(YM,AUF,DATUM)) QUIT:DATUM=""  QUIT:DATUM]]DATUMB  DO
	. . . . . . SET INAUFPZ1=$GET(^INAUFPZ(YM,AUF,DATUM,1))
	. . . . . . IF VORG(8)'=0 SET YCOPY=1  ;WIEDERHOLUNGSDRUCK
	. . . . . . IF VORG(8)'=1 QUIT:$PIECE(INAUFPZ1,Y,4)'=""   ;BEREITS GEDRUCKT ;yet 
	. . . . . . ;
	. . . . . . KILL YAUFTRAG
	. . . . . . SET YAUFTRAG=AUF
	. . . . . . SET YPZDATUM=DATUM
	. . . . . . QUIT:$GET(YPZDATUM)=""
	. . . . . . IF +$GET(VORG(8))'=0 SET YCOPY=1  ;WIEDERHOLUNGSDRUCK
	. . . . . . SET YSEND=0    ;VERSANDART
	. . . . . . SET YBELEG=12  ;TEILZAHLUNGSRECHNUNG
	. . . . . . SET YMULTIPLE=$GET(YMULTIPLE)+1  ;MEHRERE AUFTRÄGE ;divers 
	. . . . . . IF YMULTIPLE>1 IF YSEND=0 IF VORG(99)'=1 DO FF^WWWW()  ;SEITENVORSCHUB
	. . . . . . IF $GET(YCOPY)="" SET YCOPY=0  ;KEINE WIEDERHOLUNG ;no repetition 
	. . . . . . IF +YCOPY=0 IF $PIECE(INAUFPZ1,Y,4)'="" SET YCOPY=1  ;WIEDERHOLUNGSDRUCK, DA SONST KEIN DRUCK
	. . . . . . ;
	. . . . . . ;
	. . . . . . NEW YCOPY1
	. . . . . . SET YCOPY1=$GET(YCOPY)
	. . . . . . IF $GET(VORG(13))'="" DO  QUIT     ;BEC;26820;24.11.04;BELEGART
	. . . . . . . NEW YISU,YSENDART,YXAUFTRAG
	. . . . . . . KILL YXAUFTRAG
	. . . . . . . MERGE YXAUFTRAG=YAUFTRAG
	. . . . . . . FOR YISU=1:1 QUIT:$PIECE(VORG(13),",",YISU,999)=""  DO
	. . . . . . . . NEW YAUFTRAG  ;FIS;07.02.05;27268
	. . . . . . . . KILL YAUFTRAG  ;FIS;07.02.05;27268
	. . . . . . . . MERGE YAUFTRAG=YXAUFTRAG  ;FIS;07.02.05;27268;YAUFTRAG GEHT VERLOREN
	. . . . . . . . SET YCOPY=YCOPY1
	. . . . . . . . SET YSTOP=""
	. . . . . . . . SET VORG(99)=""
	. . . . . . . . SET YSENDART=$PIECE(VORG(13),",",YISU)
	. . . . . . . . QUIT:YSENDART=""
	. . . . . . . . IF +YSENDART'=0 IF VORG(11)=1 IF YCOPY'=1 IF YSEND'=0 SET VORG(99)=1    ;NO PRINT
	. . . . . . . . DO ^INDRUCK     ;DRUCK DER ANFRAGE ;printing the 
	. . . . . . . . DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPATNER     ;FAN;13.03.2003;23059
	. . . . . . . . IF $GET(DRUCKOK)'=1 IF $GET(YSTOP)'=1 SET DRUCKOK=1    ;BEC;24.11.04;26820
	. . . . . . . . I $G(YAUFTRAG)'="" IF $GET(YSTOP)'=1 SET ^WWWSOR(YUSER_"-SUM",YAUFTRAG,1)=$GET(YAUFTRAG)_Y_$GET(YSEND)_Y_$GET(INFO)
	. . . . . . . . QUIT
	. . . . . . . QUIT
	. . . . . . ;
	. . . . . . QUIT:'$DATA(YAUFTRAG)  ;KEINE Positionen ;no Order Line Items
	. . . . . . DO ^INDRUCK     ;DRUCK ;printing 
	. . . . . . DO ^INDRUCKZHD  ;DRUCK KOPIE ZU ANSPRECHENPATNER  ;printing copy within 
	. . . . . . SET ANZM=ANZM+1
	. . . . . . QUIT 
	. . . . . QUIT
	. . . . QUIT
	. . . QUIT
	. . ;
	. . IF YSAMMEL=1 DO
	. . . SET RNUMMER=$GET(^WWWSOR(YUSER,"SAMMELYREF"))  ;FIS;31.01.05;26967
	. . . IF RNUMMER="" SET RNUMMER=$$^WWWNEXT("INDRPARARS")
	. . . FOR YANZ=1:1:ANZKOP DO
	. . . . IF YANZ>1 DO FF^WWWW()  ;SEITENVORSCHUB
	. . . . DO SAMMEL
	. . . . QUIT
	. . . KILL ^WWWSOR(YUSER,"SAMMEL")
	. . . KILL ^WWWSOR(YUSER,"SAMMELPOS")
	. . . QUIT
	. . QUIT
	. IF VORG(16)'="" SET OLDDATE=$ZUTIL(71,0)
	. QUIT
	;
	IF YTEST=1 DO    ;NUR TESTDRUCK ;only 
	. SET YSAMMEL=1
	. SET VORG(11)=1  ;NUR EINZELDRUCK ;only 
	. ;FOR YANZ=1:1:10 DO ^INDRUCK
	. ;IF YANZ>1 DO FF^WWWW()  ;SEITENVORSCHUB
	. DO ^INDRUCK
	. DO SAMMEL
	. SET ANZM=1 
	. KILL ^WWWSOR(YUSER,"SAMMEL")
	. KILL ^WWWSOR(YUSER,"SAMMELPOS")
	. QUIT
	;
	IF ANZM=0 WRITE $$^WWWTEXT(46)  ;KEINE DATEN VORHANDEN ;no on hand
	;
	KILL ^WWWSOR(YUSER)
	KILL ^WWWSOR(YUSER_"-SUM")
	IF VORG(99)'=1 DO NORMAL^%PRIO
	QUIT
	;
	;
	
SAMMEL	;DRUCKEN SAMMELAUFLISTUNG ;print 
	;
	;IF YBED="FIS" IF +$HOROLOG=59903 DO ^INRECHKUNSAMMEL QUIT  ;IN INDMS SPEICHERN;FIS;26934;03.01.05
	;
	NEW AUF,REF,PREIS,BELEG,GESAMT,AUF1,ADR,YI,YKUNDE,LFN,PAGE,ZWSUM,YDDSATZ,MAXLF,NETTOGES,MWSTGES
	NEW YTAB,KUNDE1,FONT,YVOR,SIZE,UEBTR,UEBTRF
	IF '$DATA(^WWWSOR(YUSER,"SAMMEL")) QUIT
	KILL ^WWWSOR(YUSER,"SAMMELSORT")
	KILL ^WWWSOR(YUSER,"LAYOUT")
	;
	;DEFAULT SETZTEN
	IF $PIECE(YBELEG1,Y,66)'="" SET UEBTRF=$PIECE(YBELEG1,Y,66)
	IF $PIECE(YBELEG1,Y,15)="" SET $PIECE(YBELEG1,Y,15)=40
	IF $PIECE(YBELEG1,Y,25)="" SET $PIECE(YBELEG1,Y,25)=15
	IF $PIECE(YBELEG1,Y,14)="" SET $PIECE(YBELEG1,Y,14)=9
	IF $PIECE(YBELEG1,Y,9)="" SET $PIECE(YBELEG1,Y,9)=9
	;
	SET FONT="ARIAL"
	SET YVOR=$GET(^WWW012(0,YM,1))
	IF $PIECE(YVOR,Y,9)'="" SET FONT=$PIECE($GET(^WWW100(0,"SCHRIFTART",SPRACHE,$PIECE(YVOR,Y,9),1)),Y,1)
	IF $PIECE(YBELEG1,Y,7)'="" SET FONT=$PIECE($GET(^WWW100(0,"SCHRIFTART",SPRACHE,$PIECE(YBELEG1,Y,7),1)),Y,1)
	IF STYLE'="" SET FONT=""
	SET SIZE=2
	IF $PIECE(YVOR,Y,7)'="" SET SIZE= $PIECE(YVOR,Y,7)
	IF $PIECE(YBELEG1,Y,8)'="" SET SIZE=$PIECE(YBELEG1,Y,8)
	;
	SET MAXLF=15             ;MAX ANZ ZEILEN
	IF +$PIECE(YBELEG1,Y,64)'=0 SET MAXLF=+$PIECE(YBELEG1,Y,64)  ;ÜBERTRAG AB ZEILE
	IF +$PIECE(YBELEG1,Y,3)'=0 SET MAXLF=+$PIECE(YBELEG1,Y,3)  ;ANZAHL ZEILEN JE SEITE
	IF +$PIECE(YBELEG1,Y,77)=0 SET $PIECE(YBELEG1,Y,77)=$PIECE(YBELEG1,Y,3)
	IF +$PIECE(YBELEG1,Y,77)=0 SET $PIECE(YBELEG1,Y,77)=70
	;
	SET PAGE=0
	SET GESAMT=0
	SET NETTOGES=0
	SET MWSTGES=0
	SET LFN=0
	SET ZWSUM=0
	IF $GET(RNUMMER)="" SET RNUMMER=$$^WWWNEXT("INDAPRARS")   
	IF VORG(11)'=1 DO FF^WWWW()  ;SEITENVORSCHUB
	DO NEWPAGE
	SET AUF="" FOR  SET AUF=$ORDER(^WWWSOR(YUSER,"SAMMEL",AUF)) QUIT:AUF=""  DO
	. SET REF="" FOR  SET REF=$ORDER(^WWWSOR(YUSER,"SAMMEL",AUF,REF)) QUIT:REF=""  DO
	. . SET SORTS=AUF  ;SORTIERUNG ;sorting 
	. . IF VORG(12)=1 SET SORTS=$PIECE($GET(^INAUF(YM,AUF,1)),Y,8)
	. . IF VORG(12)=2 SET SORTS=$PIECE($GET(^INAUF(YM,AUF,1)),Y,300)  ;EXT. BESTELLNUMMER;FIS;13.04.04;25507
	. . IF SORTS="" SET SORTS=" "
	. . SET ^WWWSOR(YUSER,"SAMMELSORT",SORTS,AUF,REF)=""  ;ZWISCHENDATEI FÜR SORTIERUNG;FIS;10.03.04;25298
	. . QUIT
	. QUIT
	SET SORTS="" FOR  SET SORTS=$ORDER(^WWWSOR(YUSER,"SAMMELSORT",SORTS)) QUIT:SORTS=""  DO
	. IF VORG(14)=1 DO ZWHEAD  ;SOERTIERUNG MIT ZWISCHENSUMME;FIS;13.04.04;25507
	. SET AUF="" FOR  SET AUF=$ORDER(^WWWSOR(YUSER,"SAMMELSORT",SORTS,AUF)) QUIT:AUF=""  SET REF="" FOR  SET REF=$ORDER(^WWWSOR(YUSER,"SAMMELSORT",SORTS,AUF,REF)) QUIT:REF=""  DO
	. . SET PREIS=$GET(^WWWSOR(YUSER,"SAMMEL",AUF,REF))  ;PIECE: 1=NETTO, 2=MWST, 3=BRUTTO
	. . SET AUF1=$GET(^INAUF(YM,AUF,1))
	. . SET BELEG=$GET(^INDMSA(YM,REF,1))  ;BELEG INFORMATIONEN ;proof 
	. . SET LFN=LFN+1
	. . IF LFN>MAXLF DO NEWPAGE
	. . DO NL^WWWTAB
	. . DO NFLCSS^WWWTAB(1,1,1)
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . WRITE "&nbsp;"
	. . WRITE AUF  ;AUFTRAG ;mandate  ;order 
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . ;
	. . DO NFLCSS^WWWTAB(1,,1)
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . WRITE "&nbsp;"
	. . WRITE $$^WWWDATE($PIECE(BELEG,Y,1))  ;DRUCKDATUM
	. . IF YTEST=1 IF $$^WWWDATE($PIECE(BELEG,Y,1))="" WRITE $$^WWWDATE(+$HOROLOG)
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . ;
	. . DO NFLCSS^WWWTAB(1,,1)
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . WRITE "&nbsp;"
	. . IF $PIECE($GET(^WWW012(0,YM,1)),Y,94)'="GEM mbH Karlsruhe" IF YBED'="FIS" WRITE $EXTRACT($PIECE(AUF1,Y,8),1,28)    ;PROJEKT ;scheme 
	. . IF $PIECE($GET(^WWW012(0,YM,1)),Y,94)="GEM mbH Karlsruhe"!(YBED="FIS") WRITE $EXTRACT($PIECE(AUF1,Y,302),1,28)    ;KUNDENAUFTRAGSNUMMER
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EL^WWWTAB
	. . ;
	. . DO NFLCSS^WWWTAB(1,,1)
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . WRITE "&nbsp;"
	. . WRITE $PIECE($PIECE(BELEG,Y,3)," ",2,99)    ;BELEG (RECHNUNG xxx, ANZAHLUNG....)
	. . ;IF $PIECE(BELEG,Y,4)'="" WRITE " ("_$PIECE(BELEG,Y,4)_")"  ;VERSANDART;BEC;30;06;04
	. . IF YTEST=1 IF $PIECE($PIECE(BELEG,Y,3)," ",2,99)="" WRITE $RANDOM(58971)
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EL^WWWTAB
	. . ;
	. . DO NFRCSS^WWWTAB(1,,1)
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . ;WRITE $$^WWWZAHL($PIECE(PREIS,Y,1),0,2,YWHR)
	. . WRITE $$FORMATBETRAG($PIECE(PREIS,Y,1))        ;BEC;09.06.04;25635
	. . SET NETTOGES=NETTOGES+$PIECE(PREIS,Y,1)  ;TOTAL NETTO ;whole 
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . ;
	. . DO NFRCSS^WWWTAB(1,,1)
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . ;WRITE $$^WWWZAHL($PIECE(PREIS,Y,2),0,2,YWHR)
	. . WRITE $$FORMATBETRAG($PIECE(PREIS,Y,2))     ;BEC;09.06.04;25635
	. . SET MWSTGES=MWSTGES+$PIECE(PREIS,Y,2)  ;TOTAL MWST ;whole Tax 
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . ;
	. . DO NFRCSS^WWWTAB(1,,1)
	. . ;WRITE $$^WWWZAHL($PIECE(PREIS,Y,3),0,2,YWHR)
	. . WRITE $$FORMATBETRAG($PIECE(PREIS,Y,3))    ;BEC;09.06.04;25635
	. . IF STYLE="" WRITE "</FONT>"
	. . SET ZWSUM=ZWSUM+$PIECE(PREIS,Y,3)
	. . SET GESAMT=GESAMT+$PIECE(PREIS,Y,3)  ;TOTAL RECHNUNGSBETRAG ;whole invoice amount 
	. . WRITE "&nbsp;"      ;BEC;26717;08.11.04
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . DO EL^WWWTAB
	. . ;
	. . ;;IF VORG(15)=1 DO  ;ANZEIGEN KONTEN UND KOSTENSTELLEN DES KUNDEN;FIS;26980;13.12.2004
	. . . NEW UEB,NETTOGES,MWSTGES,BRUTTOGES,SIZE,FONT,REF1,REF2,LAST
	. . . SET SIZE=1
	. . . SET FONT="arial"
	. . . SET NETTOGES=0
	. . . SET MWSTGES=0
	. . . SET BRUTTOGES=0
	. . . ;SET UEB=$$^WWWTEXT(216)_Y_$$^WWWTEXT(32022)_Y_$P($$^WWWFELDNAME("INAUFP","D",384)," ",1)_Y_$P($$^WWWFELDNAME("INAUFP","D",385)," ",1)_Y_$$^WWWTEXT(32470)_Y_$$^WWWTEXT(33541)_Y_$$^WWWTEXT(33110)
	. . . SET UEB=$$^WWWTEXT(31406)_" / "_$$^WWWTEXT(32024)_" /<BR> "_$$^WWWTEXT(127)  ;POS/ARTIKEL / Bezeichnung
	. . . SET UEB=UEB_Y_$$^WWWTEXT(32022)_" /<BR> "_$$^WWWTEXT(32162)  ;LIEFERANT/E-RECHNUNGS#
	. . . SET UEB=UEB_Y_$$^WWWTEXT(31407)_"/"_$$^WWWTEXT(34128)_" /<BR>"_$PIECE($$^WWWFELDNAME("INAUFP","D",284)," ",1)  ;MENGE/EINHEIT / FREE (AUFTRAGSNUMMER)
	. . . SET UEB=UEB_Y_$PIECE($$^WWWFELDNAME("INAUFP","D",384)," ",1)_" /<BR> "_$PIECE($$^WWWFELDNAME("INAUFP","D",385)," ",1)  ;KONTO/KST
	. . . SET UEB=UEB_Y_$$^WWWTEXT(31409)_" /<BR>"_$$^WWWTEXT(32470)  ;EINZEL / NETTO-VK
	. . . SET UEB=UEB_Y_$$^WWWTEXT(33541)
	. . . SET UEB=UEB_Y_$$^WWWTEXT(33110)
	. . . DO HEADERCSS^WWWTAB(UEB,SIZE,,"L",1,1,2,0,1,FONT)
	. . . ;
	. . . SET POS="" FOR  SET POS=$ORDER(^WWWSOR(YUSER,"SAMMELPOS",AUF,REF,POS)) QUIT:POS=""  DO
	. . . . SET REF1=$GET(^WWWSOR(YUSER,"SAMMELPOS",AUF,REF,POS))
	. . . . IF +POS'=0 DO  ;AUFTRAGSPOSITIONEN
	. . . . . SET POS1=$GET(^INAUFP(YM,AUF,POS,1))
	. . . . . QUIT:POS1=""
	. . . . . SET KONT=$PIECE(POS1,Y,384)
	. . . . . IF KONT="" SET KONT=" "
	. . . . . SET KST=$PIECE(POS1,Y,385)
	. . . . . IF KST="" SET KST=" "
	. . . . . QUIT
	. . . . IF +POS=0 DO  ;ZUSATZKOSTEN (YFRACHT, YVERSICH, YZUABSCHLAG, ... )
	. . . . . SET KONT=" "
	. . . . . SET KST=" "
	. . . . . QUIT
	. . . . SET NETTOGES=NETTOGES++$PIECE(REF1,Y,1)  ;NETTO GESAMT
	. . . . SET MWSTGES=MWSTGES++$PIECE(REF1,Y,2)  ;UST GESAMT
	. . . . SET BRUTTOGES=BRUTTOGES++$PIECE(REF1,Y,3)  ;NETTO GESAMT
	. . . . SET LAST=0
	. . . . IF $ORDER(^WWWSOR(YUSER,"SAMMELPOS",AUF,REF,POS))="" SET LAST=1
	. . . . DO ANZKST(KONT,KST,REF1)
	. . . . SET LFN=LFN+2
	. . . . IF LFN>MAXLF DO
	. . . . . DO
	. . . . . . NEW NOUEBER,FONT,SIZE
	. . . . . . SET FONT="ARIAL"
	. . . . . . SET YVOR=$GET(^WWW012(0,YM,1))
	. . . . . . IF $PIECE(YVOR,Y,9)'="" SET FONT=$PIECE($GET(^WWW100(0,"SCHRIFTART",SPRACHE,$PIECE(YVOR,Y,9),1)),Y,1)
	. . . . . . IF $PIECE(YBELEG1,Y,7)'="" SET FONT=$PIECE($GET(^WWW100(0,"SCHRIFTART",SPRACHE,$PIECE(YBELEG1,Y,7),1)),Y,1)
	. . . . . . IF STYLE'="" SET FONT=""
	. . . . . . SET SIZE=2
	. . . . . . IF $PIECE(YVOR,Y,7)'="" SET SIZE= $PIECE(YVOR,Y,7)
	. . . . . . IF $PIECE(YBELEG1,Y,8)'="" SET SIZE=$PIECE(YBELEG1,Y,8)
	. . . . . . SET NOUEBER=1
	. . . . . . DO NEWPAGE
	. . . . . . QUIT
	. . . . . DO HEADERCSS^WWWTAB(UEB,SIZE,,"L",1,1,2,0,1,FONT)
	. . . . . QUIT
	. . . . QUIT
	. . . QUIT
	. . QUIT
	. ;
	. IF VORG(14)=1 DO ZWSUM  ;SORTIERUNG MIT ZWISCHENSUMME;FIS;13.04.04;25507
	. QUIT
	;
	;DO HEADERCSS^WWWTAB($$^WWWTEXT(350)_": "_$$^WWWZAHL(GESAMT,0,2,YWHR),SIZE,7,"R",1,1,1,2,1,FONT)
	;DO HEADERCSS^WWWTAB($$^WWWTEXT(350)_": "_$$FORMATBETRAG(GESAMT),SIZE,7,"R",1,1,1,2,1,FONT)      ;BEC;09.06.04;25635
	DO  ;FIS;NETTO UND MWST SUMMIEREN;26043;01.09.04
	. NEW UEB
	. SET UEB="&nbsp;"_Y_"&nbsp;"_Y_"&nbsp;"_Y_"&nbsp;"_Y_$$FORMATBETRAG(NETTOGES)_Y_$$FORMATBETRAG(MWSTGES)_Y_$$FORMATBETRAG(GESAMT)
	. DO HEADERCSS^WWWTAB(UEB,SIZE,,"R",1,1,2,2,1,FONT)      ;BEC;09.06.04;25635
	. QUIT
	DO STOP^WWWTAB
	DO
	. SET LFN=LFN+1
	. IF PRE'=1 WRITE "<BR>" 
	. WRITE YCR
	. DO
	. . ;LASTSCHRIFT VERMERK    ;BEC;09.06.04;25635
	. . QUIT:$PIECE(YBELEG1,Y,196)=""
	. . IF $PIECE(KUNDE1,Y,102)=3 DO FILTERN($PIECE(YBELEG1,Y,196),)  ;LASTSCHRIFT ;direct debit 
	. . IF PRE'=1 WRITE "<BR>" 
	. . WRITE YCR
	. . QUIT
	. DO FILTERN($PIECE(YBELEG1,Y,70),1)    ;ABSCHLUSSTEXT  ;BEC;09.06.04;25635
	. QUIT
	;
	DO FUSS     ;BEC;09.06.04;25635
	KILL ^WWWSOR(YUSER,"SAMMELSORT")
	;
	IF VORG(15)'=1 QUIT
	WRITE YCR
	;DO FF^WWWW()  ;SEITENVORSCHUB
	;DO ^INRECHKUNK
	QUIT
	;
	;
	
NEWPAGE    ;NEUE SEITE ;side 
	;
	;SET LFN=0      ;BEC;26717;08.11.04;muss unten erfolgen
	SET PAGE=PAGE+1
	NEW UEBTR,UEBTRF
	SET UEBTR=$$^WWWTEXT(170)
	IF $PIECE(YBELEG1,Y,65)'="" SET UEBTR=$PIECE(YBELEG1,Y,65)
	SET UEBTRF=UEBTR
	IF PAGE'=1 DO
	. SET LFN=LFN+1
	. ;DO HEADERCSS^WWWTAB(UEBTR_": "_$$^WWWZAHL(GESAMT,0,2,YWHR),SIZE,7,"R",,,1,,1,FONT)
	. DO HEADERCSS^WWWTAB(UEBTR_": "_$$FORMATBETRAG(GESAMT),SIZE,7,"R",,,1,,1,FONT)    ;BEC;09.06.04;25635
	. DO STOP^WWWTAB
	. DO
	. . ;LASTSCHRIFT VERMERK   ;BEC;09.06.04;25635
	. . QUIT:$PIECE(YBELEG1,Y,196)=""
	. . IF $PIECE(KUNDE1,Y,102)=3 DO FILTERN($PIECE(YBELEG1,Y,196),1)  ;LASTSCHRIFT ;direct debit 
	. . IF PRE'=1 WRITE "<BR>" 
	. . WRITE YCR
	. . QUIT
	. DO FILTERN($PIECE(YBELEG1,Y,70),1)     ;ABSCHLUSSTEXT;BEC;09.06.04;25635
	. DO FUSS   ;TEXT FUSS    ;BEC;09.06.04;25635
	. DO FF^WWWW()  ;SEITENVORSCHUB
	. SET LFN=0       ;BEC;26717;08.11.04;muss am Seitenende erfolgen
	. QUIT
	IF PRE=1 WRITE "<PRE>",YCR
	IF PRE='1 WRITE "<BR>",YCR
	IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	;
	;LOGO GIF ;BEC;09.06.04;25635
	IF $PIECE(YBELEG1,Y,5)'="" DO
	. NEW YFAUS,A,PIC
	. SET PIC=$PIECE(YBELEG1,Y,5)
	. IF PAGE'=1 IF $PIECE(YBELEG1,Y,4)="" QUIT  ;FIS;02.09.04;25635
	. IF PAGE'=1 IF $PIECE(YBELEG1,Y,4)'="" SET PIC=$PIECE(YBELEG1,Y,4)
	. SET A=""
	. SET YFAUS="LEFT"
	. IF $PIECE(YBELEG1,Y,6)=3 SET YFAUS="RIGHT"
	. IF $PIECE(YBELEG1,Y,6)=2 SET YFAUS="CENTER"
	. SET A="</PRE>"
	. DO 
	. . SET A=A_"<P align="_YFAUS_" STYLE="_""""_"margin-bottom:0pt;margin-top:0pt;"_""""_"><img src="_""""
	. . DO            
	. . . IF $PIECE(YBELEG1,Y,197)=0 SET A=A_YGIF1_PIC_""""_" </p>" QUIT
	. . . IF $PIECE(YBELEG1,Y,197)="" SET A=A_YGIF1_PIC_""""_" height="_""""_100_""""_"></p>" QUIT
	. . . SET A=A_YGIF1_PIC_""""_" height="_""""_+$PIECE(YBELEG1,Y,197)_""""_"></p>"
	. . . QUIT
	. . QUIT
	. WRITE A,YCR
	. QUIT
	;
	;ABSENDER KOPF;FIS;11.01.05
	IF $GET(YSEND)=1!($GET(YSEND)=2)!($GET(YSEND)=0) IF $PIECE(YBELEG1,Y,12)'="" DO
	. IF $GET(YSEND)=0 IF $PIECE(YBELEG1,Y,191)'=1 QUIT
	. NEW YI,YII,B,YTAB
	. SET B=""
	. IF $GET(YVOR)'="" DO     ;BEC;26964;09.12.04
	. . SET YFACE=$PIECE(YVOR,Y,9)
	. . SET YSIZE=$PIECE(YVOR,Y,7)
	. . SET YFACE=$PIECE(YBELEG1,Y,7)      ;BEC;25440;26.03.04
	. . IF YFACE'="" IF YFACE'=10 IF YFACE'=19 SET YFACE=""  ;FIS;20.07.04 ;UNGÜLTIGE SCHRIFTARTEN
	. . SET YSIZE=$PIECE(YBELEG1,Y,8)
	. . IF YFACE'=""!(YSIZE'="") DO  ;FIS;14.07.04;SIZE AUCH OHNE FACE SETZEN ;too without typeset 
	. . . SET B=B_"<FONT"
	. . . IF YFACE'="" SET B=B_" FACE="_""""_$PIECE($GET(^WWW100(0,"SCHRIFTART",SPRACHE,YFACE,1)),Y,1)_""""
	. . . IF YSIZE'="" SET B=B_" SIZE="_YSIZE
	. . . SET B=B_">"
	. . . QUIT
	. . QUIT
	. IF $PIECE(YBELEG1,Y,12)'="" DO  ;TEXT VORHANDEN ;Text on hand 
	. . SET TEXT=$PIECE(YBELEG1,Y,12)
	. . IF $FIND(TEXT,"<PRE>") SET TEXT=$TRANSLATE(TEXT,"|","")  ;BEC;26964;15.12.04 
	. . ;FOR YI=1:1 SET TEXT1=$PIECE(TEXT,"|",YI) QUIT:$PIECE(TEXT,"|",YI,999)=""  DO
	. . IF '$FIND(TEXT,"<PRE>") FOR YI=1:1 SET TEXT1=$PIECE(TEXT,"|",YI) QUIT:$PIECE(TEXT,"|",YI,999)=""  DO
	. . . SET A=""
	. . . FOR YII=1:1 QUIT:$PIECE(TEXT1," ",YII,999)=""  DO  SET A=A_$PIECE(TEXT1," ",YII)_" "   
	. . . . IF $LENGTH(A_$EXTRACT($PIECE(TEXT1," ",YII),1,26))>90 WRITE A SET A=""
	. . . . QUIT
	. . . IF $TRANSLATE(A," ")'="" WRITE A
	. . . IF $TRANSLATE(A," ")="" IF YII=1 WRITE A
	. . . QUIT
	. . IF $FIND(TEXT,"<PRE>") SET A=TEXT_B WRITE A    ;BEC;26964;09.12.04
	. . QUIT
	. QUIT
	;
	;ADRESSE ;address 
	IF PRE=1 WRITE "<PRE>"
	IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	SET YKUNDE=KUNDE
	SET KUNDE1=""
	IF YTEST=1 DO
	. SET KUNDE=100275    ;TESTKUNDE 
	. IF '$DATA(^INKUNDE(YM,KUNDE)) SET KUNDE=$ORDER(^INKUNDE(YM,""),-1)
	. QUIT
	IF KUNDE'="" SET KUNDE1=$GET(^INKUNDE(YM,KUNDE,1))
	IF $PIECE(KUNDE1,Y,38)'="" DO   ;ANDERE KUNDE IST RECHNUNGSANSCHRIFT ;customer 
	. IF $DATA(^INKUNDE(YM,$PIECE(KUNDE1,Y,38))) SET YKUNDE=$PIECE(KUNDE1,Y,38) SET KUNDE1=$GET(^INKUNDE(YM,$PIECE(KUNDE1,Y,38),1))
	. QUIT
	;
	DO
	. IF PAGE'=1 IF $PIECE(YBELEG1,Y,11)'=1 QUIT       ;ANSCHRIFT AUF FOLGESEITE ;upon 
	. SET ADR=$$^INADRES(KUNDE1)
	. FOR YI=1:1:10  QUIT:$PIECE(ADR,"|",YI,99)=""  DO
	. . SET SATZ=$PIECE(ADR,"|",YI)
	. . IF PRE'=1 DO
	. . . IF STYLE="" SET SATZ="<TR><TD WIDTH="_$PIECE(YBELEG1,Y,15)_"% nowrap>"_"<FONT SIZE="_SIZE_">"_"<FONT FACE="_FONT_">"_SATZ_"&nbsp;<TD></TR>"
	. . . IF STYLE'="" SET SATZ="<TR><TD WIDTH="_$PIECE(YBELEG1,Y,15)_"% nowrap>"_SATZ_"&nbsp;<TD></TR>"
	. . . QUIT
	. . SET ^WWWSOR(YUSER,"LAYOUT",+$GET(PAGE),(+YI+$PIECE(YBELEG1,Y,9)),1)=SATZ
	. . QUIT
	. ;BETREFFKENKEICHEN
	. SET YI(1)=$TRANSLATE($PIECE(YBELEG1,Y,17),";",",")   ;WELCHE HINWEISE DATUM USW.
	. IF $GET(YI(1))="" SET YI(1)="0,1,9,21,12"          
	. FOR YI=1:1 SET YI(2)=$PIECE(YI(1),",",YI) QUIT:YI(2)=""  DO
	. . IF $FIND(",3,4,5,6,7,8,10,11,13,14,15,16,17,19,20,22,23,99,",","_ YI(2)_",") QUIT   ;BEC;25635;BELEGLAYOUT DYNAMISCH GESTALTET ;high-powered 
	. . SET YI(4)=$PIECE($GET(^WWW101(0,"BETREFF",SPRACHE,YI(2),1)),Y,1)  ;TEXT FÜR DRUCK ;Text to printing 
	. . IF PRE=1 SET YI(5)=$EXTRACT(YI(4)_"                                    ",1,13)_": "  ;FORMAT
	. . IF PRE'=1 SET YI(5)=YI(4)_"&nbsp;"
	. . SET YI(4)=YI(5)
	. . IF PRE'=1 SET YI(4)=""
	. . IF PRE'=1 DO
	. . . ;SET YI(4)=YI(5) ;table-mat 
	. . . SET YI(4)=YI(5)_"</FONT></TD><TD nowrap>:&nbsp;</TD>"
	. . . SET YI(4)=YI(4)_"<TD nowrap>"
	. . . IF STYLE="" SET YI(4)=YI(4)_"<FONT SIZE="_SIZE_"><FONT FACE="_FONT_">"
	. . . QUIT
	. . IF YI(2)=0 DO  ;ORT, DATUM
	. . . SET YI(4)=YI(4)_$PIECE($GET(^WWW0121(0,YM,YLOCATION,1)),Y,8)  ;ORT DES BETRIEBES ;village 
	. . . IF YI(4)'="" SET YI(4)=YI(4)_", "
	. . . SET YI(4)=YI(4)_$$^WWWDATE(YDATE)      ;DATUM ;Date  ;Date Date 
	. . . QUIT
	. . IF YI(2)=1 SET YI(4)=YI(4)_YBED      ;BED.
	. . IF YI(2)=2 IF YBELEG'=9 SET YI(4)=YI(4)_$PIECE($GET(^WWW013(0,YBED,1)),Y,31)  ;TELEFON MITARBEITER
	. . IF YI(2)=9 SET YI(4)=YI(4)_YKUNDE
	. . IF YI(2)=18 IF YKUNDE'="" DO
	. . . NEW VERBANDNR
	. . . SET VERBANDNR=$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,1)
	. . . QUIT:VERBANDNR=""
	. . . SET YI(4)=YI(4)_VERBANDNR       ;VERBANDSNUMMER
	. . . SET YI(4)=YI(4)_"/"_$PIECE($GET(^INKUNDE(YM,YKUNDE,1)),Y,2)   ;ZENTRALREG.-NR.
	. . . QUIT
	. . IF YI(2)=21 SET YI(4)=YI(4)_$PIECE($GET(^INFIBPAR(0,YM,YLOCATION,1)),Y,40)   ;STEUERNUMER
	. . IF YI(2)=24 DO  ;UST ID NUMMER;FIS;24855;23.12.03
	. . . NEW STNR
	. . . SET STNR=$PIECE($GET(^INFIBPAR(0,YM,YLOCATION,1)),Y,20)
	. . . IF STNR'="" SET YI(4)=YI(4)_STNR
	. . . QUIT
	. . IF YI(2)=12 SET YI(4)=YI(4)_PAGE 
	. . IF PRE=1 DO
	. . . SET SATZ=$GET(^WWWSOR(YUSER,"LAYOUT",+$GET(PAGE),+$GET(LFN)+$PIECE(YBELEG1,Y,14),1))
	. . . SET SATZ=SATZ_"                                                                           "
	. . . SET SATZ=$EXTRACT(SATZ,1,+$PIECE(YBELEG1,Y,15))
	. . . SET SATZ=SATZ_YI(4)
	. . . SET ^WWWSOR(YUSER,"LAYOUT",+$GET(PAGE),+$GET(LFN)+$PIECE(YBELEG1,Y,14),1)=SATZ
	. . . QUIT
	. . ;
	. . IF PRE'=1 DO
	. . . SET SATZ=$GET(^WWWSOR(YUSER,"LAYOUT",+$GET(PAGE),(+$GET(LFN)+$PIECE(YBELEG1,Y,14)),1))
	. . . IF SATZ="" DO
	. . . . IF STYLE="" SET SATZ="<TR><TD WIDTH="_$PIECE(YBELEG1,Y,15)_"% nowrap>"_"<FONT SIZE="_SIZE_">"_"<FONT FACE="_FONT_">&nbsp;</TD><TD>&nbsp;</TD>"
	. . . . IF STYLE'="" SET SATZ="<TR><TD WIDTH="_$PIECE(YBELEG1,Y,15)_"% nowrap>&nbsp;</TD><TD>&nbsp;</TD>"
	. . . . QUIT
	. . . SET SATZ=SATZ_"<TD nowrap>"
	. . . IF STYLE="" SET SATZ=SATZ_"<FONT SIZE="_SIZE_">"_"<FONT FACE="_FONT_">"
	. . . SET SATZ=SATZ_YI(4)_"</TD></TR>"
	. . . SET ^WWWSOR(YUSER,"LAYOUT",+$GET(PAGE),+$GET(LFN)+$PIECE(YBELEG1,Y,14),1)=SATZ
	. . . QUIT
	. . SET LFN=LFN+1
	. . QUIT
	. QUIT
	;
	;
	IF PRE'=1 WRITE "<TABLE BORDER=0 hspace=0 vspace=0 cellpadding=0 cellspacing=0 >",YCR
	;
	NEW SA]]><![CDATA[TZ,YII
	SET LFN=0
	;
	SET YII="" SET YII=$ORDER(^WWWSOR(YUSER,"LAYOUT",+$GET(PAGE),YII),-1)
	;FOR YI=1:1:$PIECE(YBELEG1,Y,25) DO    ;BEC;08.09.04;
	FOR YI=1:1:YII DO
	. SET SATZ=$GET(^WWWSOR(YUSER,"LAYOUT",+$GET(PAGE),YI,1))
	. IF PRE'=1 IF SATZ="" SET SATZ="<TR><TD>&nbsp;</TD<TR>"
	. WRITE SATZ,YCR
	. SET LFN=LFN+1
	. QUIT
	;
	FOR YI=+YII:1:+$PIECE(YBELEG1,Y,25) DO
	. IF PRE'=1 WRITE "<TR><TD>&nbsp;</TD<TR>"
	. WRITE YCR
	. SET LFN=LFN+1
	. QUIT 
	;
	IF PRE'=1 WRITE "</TR></TABLE>",YCR
	WRITE YCR
	IF PRE=1 WRITE "</PRE>"
	IF $PIECE(YBELEG1,Y,21) WRITE "<B>"
	WRITE "<FONT SIZE="
	IF $PIECE(YBELEG1,Y,22)'="" WRITE $PIECE(YBELEG1,Y,22)
	IF $PIECE(YBELEG1,Y,22)="" WRITE 3
	WRITE ">"
	IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	WRITE $PIECE(YBELEG1,Y,23)
	IF $PIECE(YBELEG1,Y,23)="" WRITE $$^WWWTEXT(33780)        ;SAMMELRECHNUNG
	IF PRE=1 WRITE " "
	IF PRE'=1 WRITE "&nbsp;"
	WRITE $GET(RNUMMER)
	WRITE "</FONT>"
	IF $PIECE(YBELEG1,Y,21) WRITE "</B>"
	IF PRE=1 WRITE "<PRE>",YCR
	IF PRE'=1 WRITE "<BR><BR>"
	SET LFN=LFN+1
	;
	;EINLEITUNGSTEXT
	IF $PIECE(YBELEG1,Y,28)'="" DO
	. DO FILTERN($PIECE(YBELEG1,Y,28),1)    ;BEC;09.06.04;25635
	. QUIT
	;
	;AUFLISTUNG
	DO START1000^WWWTAB
	;
	;SET YDDSATZ=0 ;table-mat 
	DO HEADERCSS^WWWTAB(" ",SIZE,7,"L",,,,1,1,FONT)
	IF PAGE'=1 IF $G(NOUEBER)'=1 DO HEAD1
	IF VORG(14)'=1 IF PAGE=1 DO HEAD
	QUIT
	;
	;
	
ZWHEAD
	;
	NEW TXT
	SET LFN=LFN+1
	SET TXT=$$^WWWTEXT(32799)  ;ZWISCHENSUMME ;subtotal 
	IF VORG(12)=1 SET TXT=$$^WWWFELDNAME("INAUF","D",8)
	IF VORG(12)=2 SET TXT=$$^WWWFELDNAME("INAUF","D",300)
	DO HEADERCSS^WWWTAB(TXT_": "_SORTS_"&nbsp;",SIZE,7,"L",1,1,,,1,FONT)
	DO HEAD
	SET ZWSUM=0  ;RÜCKSETZTEN
	QUIT
	;
	;
	
ZWSUM
	;
	SET LFN=LFN+1
	;
	;DO HEADERCSS^WWWTAB($$^WWWZAHL(ZWSUM,0,2,YWHR),SIZE,7,"R",1,1,1,1,1,FONT)
	DO HEADERCSS^WWWTAB($$FORMATBETRAG(ZWSUM),SIZE,7,"R",1,1,1,1,1,FONT)    ;BEC;09.06.04;25635
	;
	;DO HEADERCSS^WWWTAB("&nbsp;",2,7,"R",1,1,,,1)
	SET ZWSUM=0  ;RÜCKSETZTEN
	QUIT
	;
	
HEAD
	IF $PIECE($GET(^WWW012(0,YM,1)),Y,94)'="GEM mbH Karlsruhe" IF $PIECE($GET(^WWW012(0,YM,1)),Y,94)'="Development" DO
	. DO HEADERCSS^WWWTAB($$^WWWTEXT(32047)_Y_$$^WWWTEXT(124)_Y_$$^WWWFELDNAME("INAUF","D",8)_Y_$$^WWWTEXT(31417)_Y_$$^WWWTEXT(32470)_Y_$$^WWWTEXT(33541)_Y_$$^WWWTEXT(33110),SIZE,,,1,1,1,1,1,FONT)
	. QUIT
	IF $PIECE($GET(^WWW012(0,YM,1)),Y,94)="GEM mbH Karlsruhe"!($PIECE($GET(^WWW012(0,YM,1)),Y,94)="Development") DO
	. DO HEADERCSS^WWWTAB($$^WWWTEXT(32047)_Y_$$^WWWTEXT(124)_Y_$$^WWWFELDNAME("INAUF","D",302)_Y_$$^WWWTEXT(31417)_Y_"Netto"_Y_$$^WWWTEXT(33541)_Y_"Gesamt",SIZE,,,1,1,1,1,1,FONT)
	. QUIT
	SET LFN=LFN+1
	;
	;IF PAGE'=1 SET LFN=LFN+1 DO HEADERCSS^WWWTAB(UEBTR_": "_$$^WWWZAHL(GESAMT,0,2,YWHR),SIZE,7,"R",1,1,1,1,1,FONT)       ;Übertrag 
	;IF PAGE'=1 SET LFN=LFN+1 DO HEADERCSS^WWWTAB($GET(UEBTR)_": "_$$FORMATBETRAG(GESAMT),SIZE,7,"R",1,1,1,1,1,FONT)       ;Übertrag ;BEC;09.06.04;25635;bec;26717;08.11.04;ausgeschaltet
	QUIT
	;
	
HEAD1
	;
	;
	;IF PAGE'=1 SET LFN=LFN+1 DO HEADERCSS^WWWTAB(UEBTRF_": "_$$^WWWZAHL(GESAMT,0,2,YWHR),SIZE,7,"R",1,1,1,1,1,FONT)       ;Übertrag 
	IF PAGE'=1 SET LFN=LFN+1 DO HEADERCSS^WWWTAB($GET(UEBTRF)_": "_$$FORMATBETRAG(GESAMT),SIZE,7,"R",1,1,1,1,1,FONT)       ;Übertrag  ;Transmit 
	;
	;DO HEADERCSS^WWWTAB($$^WWWTEXT(32047)_Y_$$^WWWTEXT(124)_Y_$$^WWWFELDNAME("INAUF","D",8)_Y_$$^WWWTEXT(31417)_Y_$$^WWWTEXT(32470)_Y_$$^WWWTEXT(33541)_Y_$$^WWWTEXT(33110),SIZE,,,1,1,1,1,1,FONT) ;BEC;09.06.04;25635
	SET LFN=LFN+1
	QUIT
	;
	;
	
LINK	;LINK TO SUBFORM IF EXIST;BEC;25635
	;
	;
	IF $PIECE($GET(YKEY),",",2)=7 QUIT
	SET YQ=1,$PIECE(YA,Y,9)=""  ;DISABLE AND HIDE BUTTON
	QUIT
	;
	;
	
FILTERN(TEXT,COUNT)
	;
	NEW TEXT1
	SET COUNT=$GET(COUNT)
	DO
	. FOR  QUIT:$EXTRACT($REVERSE(TEXT))'="|"  do
	. . SET TEXT=$REVERSE($EXTRACT($REVERSE(TEXT),2,99999))
	. . QUIT
	. IF PRE'=1 SET TEXT=$$^WWWTRANSLATE(TEXT,"|","<BR>")      
	. IF PRE=1 SET TEXT=$$^WWWTRANSLATE(TEXT,"|",YCR)      
	. QUIT
	IF COUNT=1 IF PRE'=1 SET LFN=LFN+$LENGTH(TEXT,"<BR>")
	IF COUNT=1 IF PRE=1 SET LFN=LFN+$LENGTH(TEXT,YCR)
	WRITE "<FONT SIZE="_SIZE_">"
	IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	WRITE TEXT
	WRITE "</FONT>"
	QUIT
	;
	
FUSS   ;TEXT FUSS
	;
	DO    
	. NEW YI
	. IF PRE'=1 FOR YI=LFN:1:+$PIECE(YBELEG1,Y,77) WRITE "<BR>",YCR
	. IF PRE=1 FOR YI=LFN:1:+$PIECE(YBELEG1,Y,77) WRITE YCR
	. DO FILTERN($PIECE(YBELEG1,Y,76),1)     ;TEXT FUSS
	. QUIT
	IF PRE=1 WRITE "</PRE>"
	QUIT
	;
	
FORMATBETRAG(TEXT)
	;
	SET TEXT=$GET(TEXT)
	NEW RETURN,VALUE
	SET RETURN="&nbsp;"
	IF $PIECE(YBELEG1,Y,7)=10!($PIECE(YBELEG1,Y,7)=9) DO
	. SET RETURN=RETURN_"<FONT FACE=TIMES>"
	. SET RETURN=RETURN_"<FONT SIZE="_SIZE_">"
	. SET RETURN=RETURN_$PIECE($$^WWWZAHL(TEXT,0,2,YWHR)," ",1)_"&nbsp;"
	. SET RETURN=RETURN_"</FONT>"
	.  IF STYLE="" SET RETURN=RETURN_"<FONT FACE="_FONT_">"
	. SET RETURN=RETURN_"<FONT SIZE="_SIZE_">"
	. SET RETURN=RETURN_$PIECE($$^WWWZAHL(TEXT,0,2,YWHR)," ",2)
	. QUIT
	DO
	. QUIT:$PIECE(YBELEG1,Y,7)=10
	. QUIT:$PIECE(YBELEG1,Y,7)=9
	. IF STYLE="" SET RETURN=RETURN_"<FONT FACE="_FONT_">"
	. SET RETURN=RETURN_"<FONT SIZE="_SIZE_">"
	. SET VALUE=$$^WWWZAHL(TEXT,0,2,YWHR)    
	. IF $$^WWWWHR(YWHR)'="" IF $FIND(VALUE,$$^WWWWHR(YWHR)_" ") DO      ;BEC;17.05.04;25724;NUR WENN wÄHRUNGEN VORHANDEN
	. . SET VALUE=$$^WWWTRANSLATE($$^WWWTRANSLATE(VALUE,"   ","  "),"  "," ")
	. . SET VALUE=$PIECE(VALUE," ",2)_" "_$PIECE(VALUE," ",1)
	. . QUIT
	. SET RETURN=RETURN_VALUE
	. QUIT
	QUIT RETURN
	;
	
ANZKST(KONT,KST,REF1)
	;
	IF $GET(KONT)'="" IF $GET(KST)'="" DO
	. SET REF1=$GET(REF1)
	. DO
	. . DO NL^WWWTAB
	. . ;IF +$GET(POS)'=0 DO NFRCSS^WWWTAB(1,1,1)  ;POSITION
	. . DO NFLCSS^WWWTAB(1,1,1,LAST)  ;POSITION
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . WRITE "&nbsp;"
	. . IF +$GET(POS)'=0 WRITE $GET(POS)_"&nbsp;/&nbsp;"_$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,4)_"<br>&nbsp;"_$EXTRACT($PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,1),1,25)
	. . IF $GET(POS)="YVERPACK" WRITE $PIECE($$^WWWFELDNAME("INAUF","D",182)," ",1)
	. . IF $GET(POS)="YFRACHT" WRITE $PIECE($$^WWWFELDNAME("INAUF","D",183)," ",1)
	. . IF $GET(POS)="YVERSICH" WRITE $PIECE($$^WWWFELDNAME("INAUF","D",184)," ",1)
	. . IF $GET(POS)="YKMGELD" WRITE $PIECE($$^WWWFELDNAME("INAUF","D",185)," ",1)
	. . IF $GET(POS)="YZUSCHLAG" WRITE $PIECE($GET(^INAUF(YM,AUF,1)),Y,210)
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . ;
	. . DO NFLCSS^WWWTAB(1,,1,LAST)  ;LIEFERANT
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . SET LIEF=$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,12)
	. . IF LIEF="" SET LIEF=$PIECE($GET(^INAUF(YM,AUF,1)),Y,12)
	. . WRITE "&nbsp;"
	. . IF LIEF'="" DO
	. . . WRITE $EXTRACT($PIECE($GET(^INLIEF(YM,LIEF,1)),Y,8),1,15)
	. . . NEW RECH
	. . . IF '$DATA(^INERECH1(YM,AUF,POS,LIEF)) QUIT
	. . . WRITE "<BR>&nbsp;"
	. . . SET RECH="" FOR  SET RECH=$ORDER(^INERECH1(YM,AUF,POS,LIEF,RECH)) QUIT:RECH=""  DO
	. . . . WRITE RECH
	. . . . IF $ORDER(^INERECH1(YM,AUF,POS,LIEF,RECH))'="" WRITE ", "
	. . . . QUIT
	. . . QUIT
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . ;
	. . DO NFLCSS^WWWTAB(1,,1,LAST)  ;FREE FELD (AUFTRAGSNUMMER)
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . WRITE "&nbsp;"
	. . WRITE $PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,5)
	. . IF $PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,40)'="" WRITE " "_$PIECE($GET(^WWW101(0,"EINHEIT",SPRACHE,$PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,40),1)),Y,1)
	. . WRITE "<BR>"
	. . WRITE "&nbsp;"
	. . WRITE $PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,284)
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . ;
	. . DO NFLCSS^WWWTAB(1,,1,LAST)  ;KONTO/KOSTENSTELLE
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . WRITE "&nbsp;"
	. . WRITE KONT
	. . WRITE "<BR>&nbsp;"
	. . WRITE KST
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . ;
	. . DO NFRCSS^WWWTAB(1,,1,LAST)  ;NETTO
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . ;WRITE $$^WWWZAHL($PIECE(REF1,Y,1),0,2)
	. . DO
	. . . IF $GET(POS)="YVERPACK" QUIT
	. . . IF $GET(POS)="YFRACHT" QUIT
	. . . IF $GET(POS)="YVERSICH" QUIT
	. . . IF $GET(POS)="YKMGELD" QUIT
	. . . IF $GET(POS)="YZUSCHLAG" QUIT
	. . . WRITE $$FORMATBETRAG^INRECHKUN($PIECE($GET(^INAUFP(YM,AUF,POS,1)),Y,118))
	. . . QUIT
	. . ;WRITE "&nbsp;"
	. . WRITE "<BR>"
	. . WRITE $$FORMATBETRAG^INRECHKUN($PIECE(REF1,Y,1))
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . ;
	. . DO NFRCSS^WWWTAB(1,,1,LAST)  ;MWST
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . ;WRITE $$^WWWZAHL($PIECE(REF1,Y,2),0,2)
	. . WRITE "<BR>"
	. . WRITE $$FORMATBETRAG^INRECHKUN($PIECE(REF1,Y,2))
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . ;
	. . DO NFRCSS^WWWTAB(1,,1,LAST)  ;BRUTO
	. . IF STYLE="" WRITE "<FONT SIZE="_SIZE_">"
	. . IF STYLE="" WRITE "<FONT FACE="_FONT_">"
	. . ;WRITE $$^WWWZAHL($PIECE(REF1,Y,3),0,2)
	. . WRITE "<BR>"
	. . WRITE $$FORMATBETRAG^INRECHKUN($PIECE(REF1,Y,3))
	. . WRITE "&nbsp;"
	. . WRITE YCR
	. . DO EF^WWWTAB
	. . DO EL^WWWTAB
	. . QUIT
	. QUIT
	QUIT
]]></Routine>
</Export>