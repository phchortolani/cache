<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INARTCOPY" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INARTCOPY
#include COMSYS
#include INConst
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		KOPIEREN EINES GESAMTEN ARTIKELS
	;
	; Inputs : 
	;	VORG(#)  1-12,14
	;
	; ByRef :
	;
	;
	; Returns :
	;
	;
	; History :
	; 01-Feb-2008	GRF		Quits; expand commands; code cleanup; missing </FONT>;
	; 							Naked References
	; 16-Jun-2005	GRF		Clean up; FIXME
	; 20.09.2000	DT
	;-------------------------------------------------------------------------------
	NEW YI,ARTALT,ARTNEU,DIM,ART,BEZ,BEZALT
	
	SET VORG(1)  = $GET(VORG(1))    ;ARTIKELNUMMER
	SET VORG(2)  = $GET(VORG(2))    ;NEUE ARTIKEL ;item 
	SET VORG(3)  = $GET(VORG(3))    ;MANUELLE EINGABE
	SET VORG(4)  = $GET(VORG(4))    ;LIEFERANTENKONDITIONEN NICHT KOPIEREN ;Not 
	SET VORG(5)  = $GET(VORG(5))    ;ARTIEKLRABATTE NICHT KOPIEREN ;Not 
	SET VORG(6)  = $GET(VORG(6))    ;ALTERNATIVARTIKEL NICHT KOPIEREN ;Not 
	SET VORG(7)  = $GET(VORG(7))    ;DIMENSION 1. ;measurement 
	SET VORG(8)  = $GET(VORG(8))    ;DIMENSION 2. ;measurement 
	SET VORG(9)  = $GET(VORG(9))    ;DIMENSION 3. ;measurement 
	SET VORG(10) = $GET(VORG(10))   ;DIMENSION 4. ;measurement 
	SET VORG(11) = $GET(VORG(11))   ;DIMENSION 5. ;measurement 
	SET VORG(12) = $GET(VORG(12))   ;VORHANDENEN ARTIKEL ÃBERSCHREIBEN ;item 
	SET VORG(14) = $GET(VORG(14))   ;ZUSATZARTIKEL NICHT KOPIEREN    ;FAN;04.03.04;25216
	
	KILL ^WWWSOR(YUSER)
	IF VORG(1)="" DO ^WWWINFO($$^WWWTEXT(32141)) QUIT  ;NICHT KOPIEREN ;Not 
	;IF VORG(3)'="" IF $LENGTH(VORG(3))<3 DO ^WWWINFO($$^WWWTEXT(32141)) QUIT  ;NICHT KOPIEREN
	IF VORG(7)="" IF VORG(2)'=1 IF VORG(3)="" DO ^WWWINFO($$^WWWTEXT(32141)) QUIT  ;NICHT KOPIEREN ;Not 
	IF VORG(7)="" IF VORG(3)'="" IF $DATA(^INART(YM,VORG(3))) IF VORG(12)'=1 DO ^WWWINFO($$^WWWTEXT(32141)) QUIT  ;NICHT KOPIEREN ;Not 
	SET ARTALT=VORG(1)
	SET ARTNEU=VORG(3)
	IF VORG(7)=""  IF ARTNEU="" SET ARTNEU=$$^WWWNEXT("INART")
	IF VORG(7)'="" IF ARTNEU="" IF VORG(2)=1  SET ARTNEU=$$^WWWNEXT("INART")
	IF VORG(7)=""  IF ARTNEU'="" DO COPY1                       QUIT     ;OHNE DIMENSION ;without measurement 
	IF VORG(7)=""  IF ARTNEU=""  DO ^WWWINFO($$^WWWTEXT(32141)) QUIT     ;OHNE DIMENSION, OHNE ARTIKEL,NICHT KOPIEREN
	IF VORG(7)'="" DO           ;MIT DIMENSION ;by means of measurement 
	. SET DIM0=0
	. IF ARTNEU="" SET ARTNEU=ARTALT            ; ERST ARTIKEL  ;only item 
	. SET BEZALT=$PIECE($GET(^INART(YM,ARTALT,1)),Y,1)
	. IF VORG(12)=1  SET BEZ=BEZALT DO COPY2
	. IF VORG(12)'=1 SET BEZ=BEZALT IF '$DATA(^INART(YM,ARTNEU)) DO COPY2
	. SET ARTALT=ARTNEU
	. SET DIM0=1
	. SET DIM(7)=""
	. FOR  SET DIM(7)=$ORDER(^INDIMENSION(YM,VORG(7),DIM(7))) QUIT:DIM(7)=""  DO
	. . SET ARTNEU(7)=ARTALT_"-"_DIM(7)
	. . SET BEZ=BEZALT_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(7),DIM(7),1)),Y,1)
	. . IF VORG(8)="" SET ARTNEU=ARTNEU(7)  DO COPY2  QUIT
	. . SET DIM(8)=""
	. . FOR  SET DIM(8)=$ORDER(^INDIMENSION(YM,VORG(8),DIM(8))) QUIT:DIM(8)=""  DO
	. . . SET ARTNEU(8)=ARTNEU(7)_"-"_DIM(8)
	. . . SET BEZ=BEZALT_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(7),DIM(7),1)),Y,1)_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(8),DIM(8),1)),Y,1)
	. . . IF VORG(9)="" SET ARTNEU=ARTNEU(8) DO COPY2 QUIT
	. . . SET DIM(9)=""
	. . . FOR  SET DIM(9)=$ORDER(^INDIMENSION(YM,VORG(9),DIM(9))) QUIT:DIM(9)=""  DO
	. . . . SET ARTNEU(9)=ARTNEU(8)_"-"_DIM(9)
	. . . . SET BEZ=BEZALT_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(7),DIM(7),1)),Y,1)_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(8),DIM(8),1)),Y,1)_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(9),DIM(9),1)),Y,1)
	. . . . IF VORG(10)="" SET ARTNEU=ARTNEU(9) DO COPY2 QUIT
	. . . . SET DIM(10)=""
	. . . . FOR  SET DIM(10)=$ORDER(^INDIMENSION(YM,VORG(10),DIM(10))) QUIT:DIM(10)=""  DO
	. . . . . SET ARTNEU(10)=ARTNEU(9)_"-"_DIM(10)
	. . . . . SET BEZ=BEZALT_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(7),DIM(7),1)),Y,1)_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(8),DIM(8),1)),Y,1)_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(9),DIM(9),1)),Y,1)_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(10),DIM(10),1)),Y,1)
	. . . . . IF VORG(11)="" SET ARTNEU=ARTNEU(10) DO COPY2 QUIT
	. . . . . SET DIM(11)=""
	. . . . . ; FIXME : This loop is not indented - presumably ends AFTER the "set ARTNEU" line <GRF>
	. . . . . FOR  SET DIM(11)=$ORDER(^INDIMENSION(YM,VORG(11),DIM(11))) QUIT:DIM(11)=""  DO
	. . . . . SET ARTNEU(11)=ARTNEU(10)_"-"_DIM(11)
	. . . . . SET BEZ=BEZALT_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(7),DIM(7),1)),Y,1)_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(8),DIM(8),1)),Y,1)_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(9),DIM(9),1)),Y,1)_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(10),DIM(10),1)),Y,1)_"-"_$PIECE($GET(^INDIMENSION(YM,VORG(11),DIM(11),1)),Y,1)
	. . . . . SET ARTNEU=ARTNEU(11) DO COPY2 QUIT
	. DO VARSAVE
	
	DO         ;INFOLIST MIT LÖSCHEN FUNKTION, FOMULAR "INARTCOPYOK" RUF INFO2^INARTCOPY
	. NEW YFROM,YKEY
	. SET %("VAR","YFORM")="INARTCOPYOK"
	. SET %(YQUERY,"YAUSWAHL")=VORG(1)
	. DO ^WWWFORM
	
	QUIT
	
COPY1    ;OHNE DIMESION ;without 
	DO COPYART
	DO COPYALL
	DO INFO1
	QUIT
	
COPY2    ;MIT DIMESION, BEZEICHUNG ERWEITEN
	IF VORG(12)'=1 IF $GET(ARTNEU)'="" IF $DATA(^INART(YM,ARTNEU)) QUIT
	DO COPYART
	DO COPYBEZ
	DO COPYALL
	QUIT
	
COPYART    ;ALLE ARTIKEL DATEI KOPIE ;item data file copy 
	; 11-Apr-2011	shobby	SR17703: Reindexed some merge globals
	IF $GET(ARTNEU)'="" {
		MERGE ^INART(YM,ARTNEU)=^INART(YM,ARTALT)
		DO ^WWWSSORT("INART",ARTNEU)						;SR17703
	}
	QUIT
	
COPYBEZ    ;MIT DIMENSION, BEZEICHUNG ERWEITET
	;IF $GET(ARTNEU)'="" SET $PIECE(^INART(YM,ARTNEU,1),Y,1)=BEZ   // SR14746
	IF $GET(ARTNEU)'="" DO
	. NEW SATZ
	. SET SATZ=$GET(^INART(YM,ARTNEU,1))
	. SET $PIECE(SATZ,Y,1)=BEZ
	. set strStatus=$$$Save("INART",ARTNEU,SATZ,$$$YES) // SR14746
	QUIT
	
COPYALL     ;REST KOPIE ;residue copy 
	; 11-Apr-2011	shobby	SR17703: Reindexed some merge globals
	; 02-Nov-2010	shobby	SR17599: Removed called to INARTHIST
	IF $GET(ARTNEU)="" QUIT
	SET ART1=$GET(^INART(YM,ARTNEU,1))
	SET ^WWWSOR(YUSER,ARTNEU,1)=$PIECE(ART1,Y,1)
	SET $PIECE(ART1,Y,22)=$HOROLOG
	SET $PIECE(ART1,Y,23)=$GET(YBED)
	SET $PIECE(ART1,Y,24)=""
	SET $PIECE(ART1,Y,25)=""
	
	IF $GET(DIM0)=1 DO
	. SET $PIECE(ART1,Y,357)=ARTALT  ;FIS;SPEICHERN VARIANTE HAUPTARTIKEL;25887;28.06.04
	. FOR YI=7:1:11  QUIT:VORG(YI)=""  SET YI(1)=VORG(YI) IF YI(1)'="" DO
	. . SET $PIECE(ART1,Y,(363+YI-7))=YI(1),$PIECE(ART1,Y,(368+YI-7))=$PIECE(ARTNEU,"-",(YI-5))
	
	DO
	. NEW YFORM,YKEY,YVOR,YOK
	. ;SET YOK=$$^WWWSPEI("INART",ARTNEU,ART1,1)    // SR14746;SPEICHERN MIT WWWSPEI WEGEN DCM;25887;28.06.04 ;Save by means of quibble 
	. SET strStatus=$$$Save("INART",ARTNEU,ART1,$$$YES) // SR14746
	
	IF $GET(VORG(6))'=1 {
		MERGE ^INARTA(YM,ARTNEU)=^INARTA(YM,ARTALT)
		DO ^WWWSSORT("INARTA",ARTNEU)
	}
	
	IF $GET(VORG(14))'=1 {
		MERGE ^INARTZUS(YM,ARTNEU)=^INARTZUS(YM,ARTALT)
		DO ^WWWSSORT("INARTZUS",ARTNEU)
		MERGE ^INARTZUS1(YM,ARTNEU)=^INARTZUS1(YM,ARTALT)
		DO ^WWWSSORT("INARTZUS1",ARTNEU)
	}
	
	IF $GET(VORG(4))'=1 {
		MERGE ^INARTK(YM,ARTNEU)=^INARTK(YM,ARTALT)
		DO ^WWWSSORT("INARTK",ARTNEU)
	}
	
	IF $GET(VORG(15))'=1 {
		MERGE ^INARTKR(YM,ARTNEU)=^INARTKR(YM,ARTALT)    ;Artikelrabatt Einkauf;FAN;27.05.04;25789
		DO ^WWWSSORT("INARTKR",ARTNEU)
	}
	
	IF $GET(VORG(5))'=1 {
		MERGE ^INARTR(YM,ARTNEU)=^INARTR(YM,ARTALT)
		DO ^WWWSSORT("INARTR",ARTNEU)
	}
	
	MERGE ^INARTSP(YM,ARTNEU)=^INARTSP(YM,ARTALT)
	DO ^WWWSSORT("INARTSP",ARTNEU)						;SR17703
	MERGE ^INARTPACK(YM,ARTNEU)=^INARTPACK(YM,ARTALT)
	DO ^WWWSSORT("INARTPACK",ARTNEU)					;SR17703
	
	MERGE ^INARTT(YM,ARTNEU)=^INARTT(YM,ARTALT)
	DO ^WWWSSORT("INARTT",ARTNEU)
	
	MERGE ^INARTXL(YM,ARTNEU)=^INARTXL(YM,ARTALT)
	IF $GET(^INARTXL(YM,ARTNEU))'="" {
		SET $PIECE(^INARTXL(YM,ARTNEU),Y,4)=ARTNEU
	}
	DO ^WWWSSORT("INARTXL",ARTNEU)						;SR17703
	;SR17599 DO ^INARTHIST(ARTNEU)
	QUIT
	
VARSAVE ;SPEICHERN VARIANTEN-STRUKTUR IN ARTIKEL;25887 ;Save within item 
	IF $GET(ARTALT)="" QUIT
	NEW VARIANTE,YI
	SET VARIANTE=""
	FOR YI=7:1:11  {
		QUIT:VORG(YI)=""
		
		SET YI(1)=VORG(YI)
	;	IF YI(1)'="" SET:VARIANTE'="" VARIANTE=VARIANTE_"|" SET VARIANTE=VARIANTE_"("_(YI-6)_")"_YI(1)
		IF YI(1)'="" SET VARIANTE=VARIANTE_YI(1)_";"  ;FIS;28.07.04;25887
	}
	
	;IF $TRANSLATE(VARIANTE,"- ")'="" SET $PIECE(^INART(YM,ARTALT,1),Y,358)=VARIANTE
	;IF VARIANTE'="" SET $PIECE(^INART(YM,ARTALT,1),Y,358)=VARIANTE
	IF VARIANTE'="" DO
	. NEW SATZ,YOK,YFORM,YVOR
	. SET SATZ=$GET(^INART(YM,ARTALT,1))
	. SET $PIECE(SATZ,Y,358)=VARIANTE
	. SET YOK=$$^WWWSPEI("INART",ARTALT,SATZ,1)  ;WWWSEPO WEGEN DCM;FIS;16.08.04 ;quibble 
	. QUIT
	QUIT
	
INFO1 ;
	SET YI=""
	DO
	. NEW YBACK,YKEY
	. SET YBACK=""
	. SET YI=YAKTION_"EP=WWWFORM&YFORM=INART&YKEY="_ARTNEU
	. DO VAR^WWWCGI
	
	DO ^WWWINFO($$^WWWTEXT(32142)_": "_ARTNEU,0,YI) QUIT  ;"KOPIEREN OK"
	QUIT
	
INFO2  ;
	NEW TEXT
	SET VORG(1)=$GET(%(YQUERY,"YAUSWAHL"))
	IF '$DATA(^WWWSOR(YUSER)) DO ^WWWINFO($$^WWWTEXT(32141)) QUIT  ;NICHT KOPIEREN ;Not 
	DO      
	. NEW YFORM,YKEY,YBACK
	. WRITE "<A HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INART&YKEY="_VORG(1) ;
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE "<img src="_YGIF_"hback.gif border=0 TITLE="_""""_$$^WWWTEXT(99)_""""_">"  ;ZURÜCK ;retro- 
	. WRITE "<FONT SIZE=2><B>",YCR
	. ;WRITE $$^WWWTEXT(32142)
	. IF VORG(1)'="" WRITE " ("_VORG(1)_") "_$PIECE($GET(^INART(YM,VORG(1),1)),Y,1)              ;_" "_$$^WWWTEXT(32142)  ;NAME
	. WRITE "</FONT></B>"
	. WRITE "</A>"
	
	DO START100^WWWTAB  ;STARTEN DER ÜBERSCHRIFT ;launching the superscription 
	WRITE "<THEAD>"
	SET YDDSATZ=0
	WRITE YCR
	;kopf der anzeigetabelle ;who 
	SET TEXT=$$^WWWTEXT(41)    ;LÖSCHEN ;Delete 
	DO
	. IF $DATA(^WWW0021(0,"INART",1,SPRACHE,1)) SET TEXT=TEXT_Y_$PIECE(^WWW0021(0,"INART",1,SPRACHE,1),Y,1) QUIT   ; Naked Ref
	. SET TEXT=TEXT_Y_$PIECE($GET(^WWW002(0,"INART",1,1)),Y,1)
	
	DO
	. IF $DATA(^WWW0031(0,"INART",1,SPRACHE,1)) SET TEXT=TEXT_Y_$PIECE(^WWW0031(0,"INART",1,SPRACHE,1),Y,1) QUIT   ; Naked Ref
	. SET TEXT=TEXT_Y_$PIECE($GET(^WWW003(0,"INART",1,1)),Y,1)
	
	WRITE "<TR>"
	FOR YI=1:1:3 DO
	. WRITE "<TH VALIGN=TOP NOWRAP VALIGN=TOP ALIGN=LEFT"
	. WRITE " BGCOLOR="_YDARKGRAY
	. WRITE ">"
	. WRITE "<FONT SIZE=2>"
	. IF TEXT'="" WRITE $PIECE(TEXT,Y,YI)
	. WRITE "&nbsp;</FONT>"
	. WRITE YCR,"</TH>"
	
	WRITE YCR,"</TR>"
	WRITE "</THEAD>"
	SET LFN=0
	SET ART=""
	FOR  SET ART=$ORDER(^WWWSOR(YUSER,ART))  QUIT:ART=""  DO
	. SET LFN=LFN+1
	. DO ANZ
	
	IF LFN=0 DO LEERZEILE
	DO STOP^WWWTAB  ;TABLE AUS ;out of 
	KILL ^WWWSOR(YUSER)
	QUIT
	
ANZ ;einzelne ANZs
	WRITE YCR
	DO NL^WWWTAB    
	DO NF^WWWTAB
	SET YKEY=ART
	DO PRUEFUNG^INARTKILL
	IF Q=0 IF VORG(1)'=ART DO    ;IF KEIN AUFTRAG VORHAND,KEIN BESTANDEN UND NICHT VORG(1)
	. WRITE YCR,"<FONT SIZE=2>"    ;NR
	. WRITE "<INPUT NAME="_""""_"LFN"_LFN_""""_" TYPE=CHECKBOX VALUE="_""""_""""
	. ;
	. WRITE " onClick='if (confirm("_""""_$$^WWWTEXT(321,,1)_""""_")) {retval = EventValue("_""""_YUCI_""""_","_""""_YUSER_""""_","_""""_"INARTCOPYOK"_""""_","
	. WRITE """"_"FIX"_""""_","_""""_"INARTKILL1"_""""_","_""""_""""_","_""""_"6"_""""_","_""""_ART_"~"_LFN_""""_");} else document."_YHTMFORM_"."_"LFN"_LFN_".checked="_0_";'"
	. WRITE ">"
	. WRITE "&nbsp;"
	. WRITE YCR,"<INPUT NAME=DUMMY"_LFN_" SIZE=15 TABINDEX=9999 VALUE="_""""_""""_" readOnly unselectable"
	. IF $GET(YDDSATZ)#2=1 WRITE YCR," STYLE="_""""_"background-color:"_"'"_YWHITE_"'"_""""
	. IF $GET(YDDSATZ)#2=0 WRITE YCR," STYLE="_""""_"background-color:"_"'"_YGRAY_"'"_""""
	. WRITE YCR," STYLE="_""""_"border:"_"'"_"0px"_"'"_" ;background-color:"_"'"_"lightgrey"_"'"_" ;padding-top:"_"'"_"0"_"'"_""""_">"
	. WRITE YCR,"</FONT>"
	
	IF (Q=1) || (VORG(1)=ART) DO          ;NICHT LÖSCHBAR ;Not 
	. WRITE YCR,"<FONT SIZE=2>"    ;NR
	. WRITE YCR,"<INPUT NAME=DUMMY"_LFN_" SIZE=25 TABINDEX=9999 VALUE="_""""_$$^WWWTEXT(45)_""""_" readOnly unselectable"
	. IF $GET(YDDSATZ)#2=1 WRITE YCR," STYLE="_""""_"background-color:"_"'"_YWHITE_"'"_""""
	. IF $GET(YDDSATZ)#2=0 WRITE YCR," STYLE="_""""_"background-color:"_"'"_YGRAY_"'"_""""
	. WRITE YCR," STYLE="_""""_"border:"_"'"_"0px"_"'"_" ;background-color:"_"'"_"lightgrey"_"'"_" ;padding-top:"_"'"_"0"_"'"_""""_">"
	. WRITE YCR,"</FONT>"
	
	DO ZWL^WWWTAB
	WRITE YCR,"<FONT SIZE=2>"   ;ART ;Type  ;Type Type 
	DO      
	. NEW YFORM,YKEY,YBACK
	. WRITE "<A HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INART&YKEY="_ART   ;
	. ;WRITE "&YBACK=INART,"
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE ART  ;
	. WRITE "</A>"
	
	WRITE "&nbsp;"
	WRITE YCR,"</FONT>"
	DO ZWL^WWWTAB
	WRITE YCR,"<FONT SIZE=2>"   ;ART ;Type  ;Type Type 
	DO      
	. NEW YFORM,YKEY,YBACK
	. WRITE "<A HREF="_""""
	. WRITE YAKTION_"EP=WWWFORM&YFORM=INART&YKEY="_ART   ;
	. ;WRITE "&YBACK=INART,"
	. DO ^WWWCGI
	. WRITE """"
	. WRITE ">"
	. WRITE $GET(^WWWSOR(YUSER,ART,1))
	. WRITE "</A>"
	
	WRITE "&nbsp;"
	WRITE YCR,"</FONT>"
	DO EL^WWWTAB
	QUIT
	
LEERZEILE
	WRITE YCR
	DO NL^WWWTAB    
	DO NF^WWWTAB
	WRITE $$^WWWTEXT(32141)
	DO ZWL^WWWTAB
	WRITE "&nbsp;"
	DO ZWL^WWWTAB
	WRITE "&nbsp;"
	DO EL^WWWTAB
	QUIT
	
DRUCK ; EINSPRUNG ALT TYBD; WICHTIG
	QUIT
	
]]></Routine>
</Export>