<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="INAUFBANZ1" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
INAUFBANZ1
#include INConst
#include COMSYS
#include WWWConst
	;-------------------------------------------------------------------------------
	; Description of Function :
	;		LISTEN AUFTRÄGE
	;	GGF EINSPRUNG IN "ANZ^INAUFBANZ1"
	;	EINSPRUNG MIT AUF=AUFTRAGSNUMMER ;by means of 
	;
	; Inputs : 
	;
	;
	; ByRef :
	;	YUSER
	;	YNR			Sequence number
	;	AUF			idOrder   : ^WWWSOR(YUSER,888,YNR)
	;	AUF1		objOrder  : ^INAUF(YM,AUF,1)
	;
	; Returns :
	;
	;
	; History :
	; 06-Dec-2006	GRF		SR15272: Doco; <TD Fix
	; 21-Nov-2006	JW		SR15224: Correct SR14651: quit -> continue
	; 18-Sep-2006	GRF		BR014242: Notes; !=>||, &=>&&; FIX ME
	; 22-Aug-2006	GRF		Remove line left over from 23-May-2006; Doco; quits
	; 23-May-2006	Steve S	SR14651: Clean up/Doco
	; 14.01.2000  	DT		Created
	;-------------------------------------------------------------------------------
	new AB,ABCHECK,BE,BLACK,BLUE,COLOR,curDiscTotal,curNetSales,FIBU,GRAY,LIE,NAME
	new POS,POS1,RECHN,RED,strSparePart,TOUR,WH,YI,YZ,YZEIGE
	
	
	; Edit Open Orders/Demands/Supplies                                                                                             Form INAUFBANZ
	;--------------------------------------------------------------------------------------------------------
	; Order No.: [               ]    No. To Display [     ]     1 2 3                                                                  ^INAUFBANZ
	;==================================================================================================================================
	;Order|Type|Customer/Supplier|Project|Date|L.I.|Source|Pur/Prod Order|Confirm.|Receipt|Traffic|Delivery|Invoice|I-Inv.|Total Price| ^INAUFBANZ2
	;-----+----+-----------------+-------+----+----+------+--------------+--------+-------+-------+--------+-------+------+-----------+
	;     |    |                 |       |    |    |      |              |        |       |       |        |       |      |           |   separate
	;-----+----+-----------------+-------+----+----+------+--------------+--------+-------+-------+--------+-------+------+-----------+    column
	;     |    |                 |       |    |    |      |              |        |       |       |        |       |      |           |  processing
	;-----+----+-----------------+-------+----+----+------+--------------+--------+-------+-------+--------+-------+------+-----------+
	;32036 32038   32039           32114 32040 32041 32042    32043        32044    32045   32046   32105    32048  32101    31410     
	;  1    2          3             4      5    6     7        8            9       10      11       12      13     14     15 (Restricted)
	; <------------------  ANZ  ------------------>   WH       BP           AB       WE      TO       LE      AR     <----  ER  ----> 
	
	
	;+++++++++++++++++++++++++++++++++++++++
	;	AUF1		objINAUF
	;	POS1		objINAUFP
	;	YINVORG		objINVORG  (also an array containing individual pieces)
	;+++++++++++++++++++++++++++++++++++++++
	
	
	
	WRITE YCR
	SET WH="X"  ;X=KEINER VORHANDEN ;if "X", indicates none on hand 
	
	;SUCHEN POSITIONEN ;seek 
	KILL POS
	SET POS        = 0  ;POSITIONEN
	SET ABCHECK    = 0  ;AB NICHT GEDRUCKT ;Confirm. Not 
	SET ALLESOK    = 0  ;ALLES OK ;whatsoever 
	SET LIEFERUNG  = 0  ;GELIEFERTE
	SET LIEFERF    = 0  ;LIEFERFÄHIG
	SET GESAMT     = 0  ;GESAMTBETRAG
	SET SELBSTKOST = 0  ;EK BETRAG ;Planned Cost Sum 
	KILL RED
	KILL BLACK
	KILL BLUE
	KILL GRAY
	KILL ^WWWSOR(YUSER,"POS")
	
	set YI=""
	for {
		set YI = $order(^INAUFP(YM,AUF,YI))
		quit:(YI="")
		
		set POS1 = $GET(^INAUFP(YM,AUF,YI,1))
		
		if ($$$INAUFPItemType(POS1)=2) && ($$$INAUFPSource(POS1)="") {
			set $$$INAUFPSource(POS1)=4
			set $$$INAUFPSource(^INAUFP(YM,AUF,YI,1))=4
		}
		
		set strSparePart=$$$INAUFPComplaintSparePart(POS1)
		
		continue:($extract(YAUSWAHL)=4)&&(strSparePart'=1)&&(strSparePart'=3)	//SR15224
		continue:$$$INAUFPCancellation(POS1)
 
		set POS=POS+1  ;ANZAHL DER POSITIONEN ;Number the 
		set ^WWWSOR(YUSER,"POS",YI)=POS1  ;POSITIONEN SPEICHERN  ;FIS;13.05.03;23614;<STORE> ERROR
		
		set curDiscTotal = $$$INAUFDiscountTotal(AUF1)
		set curNetSales  = $$$INAUFPNetSalesPrice(POS1)
		
		if curDiscTotal'=0 {
			set $$$INAUFPNetSalesPrice(POS1) = curNetSales-(curNetSales*curDiscTotal/100)
		}
		
		;GESAMTPREIS DER POSITION mit RABATT ohne SKONTO ;the by means of deduction Without 
		set GESAMT     = GESAMT     + $$$INAUFPNetSalesPrice(POS1)
		set SELBSTKOST = SELBSTKOST + $$$INAUFPCost(POS1)+$$$INAUFPAmountOfPreparationTime(POS1)  ;EKPREIS SELBSTKOSTEN ;total production costs 
		
		if $$$INAUFPInvoiceNumber(POS1)'="" SET ALLESOK=ALLESOK+1               ;ALLES ABGESCHLOSSEN ;whatsoever 
		if $$$INAUFPQuantity(POS1)'<0 IF $$$INAUFPSource(POS1)'="" SET WH=WH+1  ;WARENHERKUNFT+1; NUR WENN DIE MENGE NICHT NEGATIV;TYBD;8,4,2004;25519;
		
		if ($$$INAUFPSource(POS1)=1) && ($$$INAUFPOrderPrintedDate(POS1)="") {
			continue:'$data(^INWEAUF(YM,AUF,YI))   ;KEINE BESTELLUN UND KEIN WE 	//SR15224
		}
		
		if $$$INAUFPReadyForDelivery(POS1) {
			if $$$INAUFPDeliveryDate(POS1)="" set LIEFERF=LIEFERF+1    ;LIEFERFÄHIG
		}
		
		if $$$INAUFPReadyForDelivery(POS1) {
			if ($$$INAUFPDeliveryDate(POS1)'="") && ($$$INAUFPDeliveryDate(POS1)'<$horolog) {
				set LIEFERF=LIEFERF+1   ;LIEFERFÄHIG
			}
		}
		
		if $$$INAUFPDeliveryNotePrintedDate(POS1)'="" {
			set LIEFERUNG = LIEFERUNG+1
			set LIEFERF   = LIEFERF  +1   ;AUSGELIEFERT;FIS;25910;14.06.04;LF-NUMMER KANN AUCH ALPHANUM.
		}
	}
	
	IF $PIECE(AUF1,Y,2)=5 IF $PIECE(AUF1,Y,266)'="" set WH=POS,ALLESOK=POS  ;REQUISITION BEARBEITET;TYBD;20,11,2003
	
	IF SUCH="OFFEN" IF POS=0 IF $DATA(^INAUFP(YM,AUF)) QUIT  ;ALLE POS ERLEDIGT ODER SELEKTION REKLA ODER AUFTRAG ;Or Or order 
	
	;+++++++++++++++++++++++++++++++++++++++
	;   IMPLICITLY DROPS THROUGH TO ANZ
	;+++++++++++++++++++++++++++++++++++++++
	
ANZ
	;-------------------------------------------------------------------------------
	;EINSPRUNG VON ANDEREN PROGRAMMEN MIT  POS(N)=POSITIONEN ;by means of 
	;
	; History :
	; 23-May-2006	Steve S	SR14651: General clean up
	;-------------------------------------------------------------------------------
	SET YDDSATZ=$GET(YDDSATZ)+1
	
	IF '$GET(YINVORG(30)) DO
	. SET YINVORG=$GET(^INVORG(YM,YM,1))
	. FOR YI=22,29,30,31,35,62,63,64 SET YINVORG(YI)=$PIECE(YINVORG,Y,YI)  ;VORGABEN
 
	;----------------------------------------------------------------AUFTRAG
	WRITE YCR,"<TR>",YCR
	WRITE "<TD NOWRAP VALIGN=TOP"
	
	;+++++++++++++++++++++++++++++++++++++++
	; (*1*) Order Number
	;+++++++++++++++++++++++++++++++++++++++
	
	; B/Ground Colour
	DO        
	. IF WH="X" WRITE " BGCOLOR=RED" QUIT         ;ACHTUNG KEINE WH ;estimation no 
	. IF WH'="X" DO                               ;WH SCHON ERFASST ;yet 
	. . IF POS=ALLESOK DO  QUIT                   ;KEINE FARBE WENN ALLES OK ;no colour when all okay 
	. . . IF YLEAUF=AUF                 WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	. . . IF YLEAUF'=AUF IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. . ;
	. . IF WH'=POS WRITE " BGCOLOR=YELLOW" QUIT  ;NICHT ALLE BEARBEITET WH ;Not 
	. . IF WH=POS DO  ;ALLE WH´S ERLEDIGT
	. . . ;IF LIEFERUNG=POS WRITE " BGCOLOR=LIGHTBLUE" QUIT  ;ALLE GELIEFERT OHNE RECHNUNG
	. . . ;IF LIEFERUNG=POS IF $PIECE(AUF1,Y,2)=2 IF '$DATA(^INERECH1(YM,AUF)) WRITE " BGCOLOR=LIGHTBLUE" QUIT  ;ALLE GELIEFERT OHNE RECHNUNG
	. . . IF LIEFERUNG=POS IF $PIECE(AUF1,Y,2)=0 WRITE " BGCOLOR=LIGHTBLUE"   QUIT  ;ALLE GELIEFERT OHNE RECHNUNG;NICHT BLAU BEI LF-BESTELLUNGEN;FIS;26339;30.08.04
	. . . IF LIEFERF'<POS                        WRITE " BGCOLOR=LIGHTGREEN"  QUIT  ;ALLE LIEFERFAEHIG
	. . . IF YLEAUF=AUF                          WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	. . . IF YLEAUF'=AUF IF YDDSATZ#2=1          WRITE " BGCOLOR="_YWHITE
 
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	
	; Tool Tip
	DO    
	. WRITE "<A"
	. NEW SPERR
	. NEW SPERR,MITARBEITER
	. SET MITARBEITER=""
	. IF $$$INAUFResponsible(AUF1)'="" SET MITARBEITER=$$^WWWTEXT(159)_": "_$$$WWW013Name($GET(^WWW013(0,$$$INAUFResponsible(AUF1),1)))
	. IF $$$INAUFLocation(AUF1)'=""    SET MITARBEITER=MITARBEITER_YCR_$$^WWWFELDNAME("INAUF","D",6)_": ("_$$$INAUFLocation(AUF1)_") "_$$$WWW0121LocationName($GET(^WWW0121(0,YM,$$$INAUFLocation(AUF1),1)))  ;FIS;23.12.03;23191;BETRIEB
	. ;
	. SET SPERR=""
	. IF POS=ALLESOK DO  QUIT
	. . IF MITARBEITER'="" WRITE " TITLE="_""""_MITARBEITER_""""
	. ;
	. IF MITARBEITER'="" SET MITARBEITER=YCR_MITARBEITER
	. IF $$$INAUFBlockPurchaseOrder(AUF1) SET SPERR=$CHAR(13)_$$^WWWTEXT(10004)   ;GESPERRT ;DISABLED 
	. IF WH="X"             WRITE " TITLE="_""""_$$^WWWTEXT(32075)_SPERR_MITARBEITER_"""" QUIT   ;ACHTUNG KEINE WH ;estimation no 
	. IF WH'="X" IF WH'=POS WRITE " TITLE="_""""_$$^WWWTEXT(32076)_SPERR_MITARBEITER_"""" QUIT   ;NICHT ALLE BEARBEITET WH ;Not 
	. ;IF LIEFERUNG=POS     WRITE " TITLE="_""""_$$^WWWTEXT(32102)_SPERR_MITARBEITER_"""" QUIT   ;KEINE RECHNUNG
	. IF LIEFERUNG=POS IF $PIECE(AUF1,Y,2)=0 WRITE " TITLE="_""""_$$^WWWTEXT(32102)_SPERR_MITARBEITER_"""" QUIT   ;KEINE RECHNUNG;FIS:NUR BEI KUNDENAUFTRAG;FIS;23.12.03;23191
	. IF LIEFERF=POS        WRITE " TITLE="_""""_$$^WWWTEXT(32103)_SPERR_MITARBEITER_"""" QUIT   ;AUSLIEFERUNGSFÄHIG
	. WRITE " TITLE="_""""_$$^WWWTEXT(374)_SPERR_MITARBEITER_""""   ;AUFTRAG BEARBEITEN ;order 
 
	; Hyperlink
	write " HREF="
	write YAKTION_"EP=WWWFORM&YFORM=INAUF&YKEY="_AUF_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL     ;bec;26998;15.12.04;
	SET YBACK="INAUFBANZ,"
	DO ^WWWCGI
	write ">"
	
	write:$$$INAUFBlockPurchaseOrder(AUF1) "<STRIKE>"  ;GESPERRT ;DISABLED 
	write AUF
	write:$$$INAUFBlockPurchaseOrder(AUF1) "</STRIKE>"
	write "</A>"
	write "&nbsp;</TD>",YCR
 
	;+++++++++++++++++++++++++++++++++++++++
	; (*2*) Order Type
	;+++++++++++++++++++++++++++++++++++++++
	
	write "<TD NOWRAP ALIGN=MIDDLE VALIGN=TOP"
	IF YLEAUF=AUF                 write " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YDDSATZ#2=1 write " BGCOLOR="_YWHITE
	write "><FONT SIZE=2><A title="""_$$$AppEnum("AUFTRAGSART",$$$INAUFOrderType(AUF1))_""""
	write " HREF="
	write "#>"
	
	write:$$$INAUFBlockPurchaseOrder(AUF1) "<STRIKE>"  ;GESPERRT ;DISABLED 
	write $$$INAUFOrderType(AUF1)
	write:$$$INAUFBlockPurchaseOrder(AUF1) "</STRIKE>"
	
	write "</A>"
	write "</TD>",YCR
 
	;+++++++++++++++++++++++++++++++++++++++
	; (*3*) Customer/Supplier
	;+++++++++++++++++++++++++++++++++++++++
	
	SET YLIEFERANT=""
	write "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF                 write " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YDDSATZ#2=1 write " BGCOLOR="_YWHITE
	write "><FONT SIZE=2>"
	SET KREDITOK=1
 
	IF $$^WWWACCESS("",$GET(YINVORG(35)))=1 DO   ;BERECHTIGUNG
	. IF (+$$$INAUFOrderType(AUF1)=0)&&($$$INAUFCustomerNumber(AUF1)'="") QUIT:'$DATA(^INKUNDE(YM,$$$INAUFCustomerNumber(AUF1),1))  ;WERBEADRESSE=KEIN LINK
	. write "<A"
	. write " TITLE="_""""_$TRANSLATE($PIECE(AUF1,Y,1)_$PIECE(AUF1,Y,12)_" "_$PIECE(AUF1,Y,13),"""")_""""   ;NUMMER UND TEXT ;numeral And Text 
	. write " HREF="
	. DO
	. . IF +$PIECE(AUF1,Y,2)=0 WRITE YAKTION_"EP=WWWFORM&YFORM=INKUNDE&YKEY="_$PIECE(AUF1,Y,1)_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL QUIT   ;KUNDE ;lore  ;customer 
	. . ;IF +$PIECE(AUF1,Y,2)=1!($PIECE(AUF1,Y,12)="") WRITE YAKTION_"EP=WWWFORM&YFORM=INAUF&YKEY="_AUF_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL QUIT  ;EIGEN
	. . IF +$PIECE(AUF1,Y,2)=2 IF $PIECE(AUF1,Y,12)'="" WRITE YAKTION_"EP=WWWFORM&YFORM=INLIEF&YKEY="_$PIECE(AUF1,Y,12)_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL QUIT  ;LIEFERANT ;purveyor  ;supplier 
	. . write "#"      ;BESTELLUNG ODER EINGENEAUFTRAG KEINE LINK FAN 27.02.02 ;sales order Or no buff 
	. ;
	. SET YBACK="INAUFBANZ,"
	. DO ^WWWCGI
	. write ">"
	
	IF $$$INAUFBlockPurchaseOrder(AUF1) WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
 
	DO:+YAUSWAHL'=0  IF +YAUSWAHL=0 IF $$^WWWACCESS("",$GET(YINVORG(35)))=1 DO   ;BERECHTIGUNG
	. IF +$PIECE(AUF1,Y,2)=0 DO   ;KUNDE ;customer 
	. . IF $PIECE(AUF1,Y,1)'="" DO  QUIT
	. . . WRITE $EXTRACT($PIECE($GET(^INKUNDE(YM,$PIECE(AUF1,Y,1),1)),Y,8),1,17) 
	. . . ;
	. . . IF $PIECE($GET(^INKUNDE(YM,$PIECE(AUF1,Y,1),1)),Y,229)=1 DO OK(1) QUIT ;TYBD
	. . . DO OK(2)  ;NICHT ALLE OK NUR WENN LIEFERANT OK
	. . ;
	. . IF $PIECE(AUF1,Y,1)="" WRITE $PIECE(AUF1,Y,13)        
	. ;
	. IF +$PIECE(AUF1,Y,2)=1 DO  ;EIGENAUFTRAG
	. . WRITE $$^WWWTEXT(32037)  ;"EIGENAUFTRAG"
	. ;
	. IF +$PIECE(AUF1,Y,2)=5 DO  ;REQUISITION
	. . IF $PIECE(AUF1,Y,12)'="" SET YLIEFERANT=$EXTRACT($PIECE($GET(^INLIEF(YM,$PIECE(AUF1,Y,12),1)),Y,8),1,17) WRITE YLIEFERANT
	. . ;IF $PIECE(AUF1,Y,12)="" WRITE $PIECE(AUF1,Y,13)
	. . WRITE $$^WWWTEXT(33669)  ;"EIGENAUFTRAG"REQUISITION"
	. ;
	. IF +$PIECE(AUF1,Y,2)=2 DO  ;LIEFERANT ;supplier 
	. . IF $PIECE(AUF1,Y,12)'="" SET YLIEFERANT=$EXTRACT($PIECE($GET(^INLIEF(YM,$PIECE(AUF1,Y,12),1)),Y,8),1,17) WRITE YLIEFERANT
	. . IF $PIECE(AUF1,Y,12)="" WRITE $PIECE(AUF1,Y,13)
	. ;
	. IF +$PIECE(AUF1,Y,2)=3 DO  ;BARVERKAUF
	. . WRITE $$^WWWTEXT(33463)  ;BARVERKAUF
 
 
	;IF +YAUSWAHL=0 IF $$^WWWACCESS("",$PIECE($GET(^INVORG(YM,YM,1)),Y,35))=0 DO   ;KEINE BERECHTIGUNG
	IF +YAUSWAHL=0 IF $$^WWWACCESS("",$GET(YINVORG(35)))=0 DO   ;KEINE BERECHTIGUNG ;no 
	. IF +$PIECE(AUF1,Y,2)=0 DO   ;KUNDE ;customer 
	. . WRITE $PIECE(AUF1,Y,1)  
	. . QUIT
	. IF +$PIECE(AUF1,Y,2)=1 DO  ;EIGENAUFTRAG
	. . WRITE $$^WWWTEXT(32037)  ;"EIGENAUFTRAG"
	. . QUIT
	. IF +$PIECE(AUF1,Y,2)=2 DO  ;LIEFERANT ;supplier 
	. . WRITE $PIECE(AUF1,Y,12)
 
	write "&nbsp;"
	
	;DO:YAUSWAHL'=0  IF YAUSWAHL=0 IF $$^WWWACCESS("",$PIECE($GET(^INVORG(YM,YM,1)),Y,35))=1 DO   ;KEINE BERECHTIGUNG
	DO:YAUSWAHL'=0  IF YAUSWAHL=0 IF $$^WWWACCESS("",$GET(YINVORG(35)))=1 DO   ;KEINE BERECHTIGUNG ;no 
	. WRITE "</A>"
	
	IF $$$INAUFBlockPurchaseOrder(AUF1) WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	WRITE "</TD>",YCR
 
	;+++++++++++++++++++++++++++++++++++++++
	; (*4*) Project
	;+++++++++++++++++++++++++++++++++++++++
	
	write "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF                 write " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF if YDDSATZ#2=1 write " BGCOLOR="_YWHITE
	write ">"
	write "<FONT SIZE=2>"
	
	IF $$$INAUFProject(AUF1)'="" DO   ;ANZEIGE DER PROJEKTE ; "Project Information" 
	. NEW YPARA,YFORM,YBACK
	. write "<A "
	. write " TITLE="_""""_$$^WWWTEXT(32114)_" "_$$^WWWTEXT(6)_$CHAR(13)_$TRANSLATE($$$INAUFProject(AUF1),"""")_""""   ;ALLE INFORMATION DES PROJECTS
	. write " HREF="_""""
	. write YAKTION_"EP=WWWMANU&YEXEC=*DO|CALL^INPROJCHART&YFORM=INPROJCHART&YPARA="_$$$INAUFProject(AUF1)  ;FIS; PROJECT CHART; 10,01,2005
	. SET YBACK="INAUFBANZ,"
	. do ^WWWCGI
	. write """"
	. write " TARGET="_""""_"TEILEFRAME2"_""""               ;FIS; PROJECT CHART; 05,01,2005
	. write ">"
	. if $$$INAUFBlockPurchaseOrder(AUF1) WRITE "<STRIKE>"   ;GESPERRT ;DISABLED 
	. write $EXTRACT($$$INAUFProject(AUF1),1,10)
	. if $$$INAUFBlockPurchaseOrder(AUF1) WRITE "</STRIKE>" 
	. write "</A>"
 
	write "&nbsp;"
	write "</TD>",YCR
 
	;+++++++++++++++++++++++++++++++++++++++
	; (*5*) Order Date
	;+++++++++++++++++++++++++++++++++++++++
	
	write "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF                 write " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YDDSATZ#2=1 write " BGCOLOR="_YWHITE
	write ">"
	write "<FONT SIZE=2>"
	write "<A"
	write " TITLE="_""""
	
	IF $$$INAUFRequiredDeliveryDate(AUF1)'="" {
		write $$^WWWTEXT(32083)_" "_$$^WWWDATE($$$INAUFRequiredDeliveryDate(AUF1))_" "     ; "Requested Delivery Date" ;GEWÜNSCHTER LIEFERTERMIN 
	}
 
	IF $$$INAUFPriority(AUF1)'="" write $$^WWWTEXT(31005)," ",$$$AppEnum("PRIORITAET",$$$INAUFPriority(AUF1))   ; "Priority"
	write $$$DBLQUOTE," HREF="
 
	do
	. write YAKTION_"EP=WWWFORM&YFORM=INAUF&YKEY="_AUF_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL
	. set YBACK="INAUFBANZ,"
	. do ^WWWCGI
 
	write ">"
	
	DO
	. NEW COLOR,PRIOC
	. SET COLOR=""                                           ;PRIORITAET
	. SET PRIOC=""
	. IF $$$INAUFBlockPurchaseOrder(AUF1) write "<STRIKE>"   ;GESPERRT ;DISABLED 
	. IF $$$INAUFPriority(AUF1)'="" SET PRIOC=$PIECE($GET(^WWW101(0,"PRIORITAET",SPRACHE,$$$INAUFPriority(AUF1),1)),Y,2) IF PRIOC'="" SET COLOR=$$$SysEnum("FARBE",PRIOC)
	. IF COLOR'="" WRITE "<FONT COLOR="_COLOR_">"
	. write $$^WWWDATE($$$INAUFOrderDate(AUF1))              ;AUFTRAGSDATUM
	. IF COLOR'="" WRITE "</FONT>"
	. IF $$$INAUFBlockPurchaseOrder(AUF1) write "</STRIKE>"
	
	write "&nbsp;"
	write "</A>"
	write "</TD>",YCR
 
	;+++++++++++++++++++++++++++++++++++++++
	; (*6*) Order Line (L.I.) 
	;+++++++++++++++++++++++++++++++++++++++
	
	write "<TD NOWRAP ALIGN=RIGHT VALIGN=TOP"
	IF YLEAUF=AUF                 write " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YDDSATZ#2=1 write " BGCOLOR="_YWHITE
	write ">"
	write "<FONT SIZE=2>" 
	
	IF +POS>0 DO            ;ANZEIGE ALLER POSITIONEN ;Show all lines 
	. write "<A "
	. write " HREF="_""""
	. write YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',999,1,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. SET YBACK="INAUFBANZ,"
	. DO ^WWWCGI
	. write """"
	. write " TARGET=TEILEFRAME2>"
 
	IF +POS=0 write "<FONT COLOR=RED>"                                ;KEINE POSITION ;no line
	IF $$$INAUFConfirmationNo(AUF1)'=""  write "<FONT COLOR=GREEN>"   ;WENN AB GEDRUCKT IST  ;when Confirm. 
	IF $$$INAUFBlockPurchaseOrder(AUF1) write "<STRIKE>"              ;GESPERRT ;DISABLED 
	write +POS
	IF $$$INAUFBlockPurchaseOrder(AUF1) write "</STRIKE>" 
	IF +POS>0 write "</A>"
	IF $$$INAUFConfirmationNo(AUF1)'="" write "</FONT>"
	write "&nbsp;"
	write "</TD>",YCR
	
	;------------------------------------------ZUVIEL POSITION
	SET YZ=0      ;EINZEL ANZEIGEN ;display 
	
	IF $GET(YINVORG(63))'="" DO
	. IF POS'<$GET(YINVORG(63)) SET YZ=1                ;GESAMT ANZEIGEN ;total display 
	. SET COLOR = $GET(YINVORG(64))
	. IF COLOR'="" SET COLOR = $PIECE($GET(^WWW100(0,"FARBE",SPRACHE,COLOR,1)),Y,1)
	
	; (1):BESCHAFFUNG  (2):BEST./PRO.  (3):AB  (4):WE  (5):VERSAND  (6):LIEFER  (7):AUS-RG.  (8):EIN-RG.
	
	;+++++++++++++++++++++++++++++++++++++++
	;   IMPLICITLY DROPS THROUGH TO WH
	;+++++++++++++++++++++++++++++++++++++++
	
WH
	;-------------------------------------------------------------------------------
	;	(*7*) Source
	;	ANZAHL DER WH /BESCHAFFUNG
	; 
	; History:
	; 06-Dec-2006	GRF		SR15272: Remove Duplicate <TD opening; macro
	;-------------------------------------------------------------------------------
	;write "<TD NOWRAP VALIGN=TOP"         ; SR15272
	write "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF  IF YZ=0                            write " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YZ=0 IF YDDSATZ#2=1             write " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR="" IF YLEAUF=AUF                 write " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YZ=1 IF COLOR="" IF YLEAUF'=AUF IF YDDSATZ#2=1 write " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR'=""                              write " BGCOLOR="_""""_COLOR_""""
	write ">"
	write "<FONT SIZE=2>"
	
	IF $$$INAUFOrderType(AUF1)'=5 SET YI="" FOR YI1=0:1 SET YI=$ORDER(^WWWSOR(YUSER,"POS",YI)) QUIT:YI=""  DO  KILL POS(YI)  ;FIS;13.05.03;23614;<STORE> ERROR; TYBD; NUR WENN KEINE REQUISITION;17,11,2003
	. SET POS(YI)=$GET(^WWWSOR(YUSER,"POS",YI))
	. NEW WH,LINKS
	. IF $$$INAUFPQuantity(POS(YI))<0 quit  ;KEINE BESCHAFFUNG BEI RETOURLIEFERUNG  ;FIS;11.10.2001 ;no Source next to 
	. IF $$$INAUFPNetSalesPrice(POS(YI))<0 quit  ;KEINE BESCHAFFUNG BEI GUTSCHRIFT ;no Source next to 
	. IF YZ=0 IF YI1'=0 IF YI1#6=0 write "<BR>" 
	. IF YZ=0 write YCR
	. IF YZ=0 SET LINKS=0  ;OHNE LINKS
	. IF YZ=0 IF ($PIECE(POS(YI),Y,7)="") || (+$PIECE(POS(YI),Y,5)-$PIECE(POS(YI),Y,6)'=0) SET LINKS=1   ;WH FASST LEGEN
	. IF YZ=0 IF ($PIECE(POS(YI),Y,7)=1) || ($PIECE(POS(YI),Y,7)=2) || ($PIECE(POS(YI),Y,7)=5)  DO    ;27235;FAN;WH ZURÜCKZUNEHEMN;25.01.05
	. . ;QUIT:$PIECE(POS(YI),Y,83)'=""  ;BESELLUNG GEDRUCKT;TYBD
	. . IF $PIECE(POS(YI),Y,7)=1 QUIT:$DATA(^INWEAUF(YM,AUF,YI))         ;WARENEINGANG  ;27492;FAN 04.04.05
	. . ;IF $DATA(^INAUFPA(YM,AUF,YI)) QUIT  ;AB VORHANDEN  ;27492;FAN AUSSCHALTEN. 04.04.05
	. . QUIT:$PIECE(AUF1,Y,2)=2                       ;LIEFERRAND bESTELLUNG. 27492;FAN;02.05.05
	. . QUIT:$PIECE(POS(YI),Y,92)'=""                 ;LIEFERSCHEIN GEDRUCKT
	. . QUIT:$DATA(^INARTT(YM,$PIECE(POS(YI),Y,4)))   ;UNTERTEIL
	. . ;	D207	$$$INVORGWarenherkunftzuruecknehmb()   UndoSourcing
	. . QUIT:$PIECE($GET(^INVORG(YM,YM,1)),Y,207)'=$$$YES  ;NICHT ERLAUBT
	. . SET LINKS=2                                   ;ZURÜCKNEHMENBAR
	. ;
	. IF YZ=0 WRITE "<A"
	. SET WH=$$^WWWTEXT(32075)_"]"              ;"No Source For Item"
	. IF $PIECE(AUF1,Y,2)=2 IF $PIECE(AUF1,Y,12)="" SET $PIECE(POS(YI),Y,7)=""  ;BESTELLUNG OHNE LIEFERANT;FIS;23856;01.07.03
	. IF $PIECE(POS(YI),Y,7)'="" IF $PIECE(POS(YI),Y,7)'=2 SET $PIECE(POS(YI),Y,6)=$PIECE(POS(YI),Y,5)   ;RESTMENGE=0
	. IF $PIECE(POS(YI),Y,7)'="" SET WH=$PIECE($GET(^WWW101(0,"WARENHERKUNFT",SPRACHE,$PIECE(POS(YI),Y,7),1)),Y,1)
	. IF $PIECE(POS(YI),Y,7)=1 IF $PIECE(POS(YI),Y,12)'="" SET WH=WH_" "_$$^WWWTEXT(32096)_" "_$PIECE($GET(^INLIEF(YM,$PIECE(POS(YI),Y,12),1)),Y,8)_" "_$PIECE(POS(YI),Y,12)    ;FAN;22.12.2004;26983;Beispiel:"Bestellung bei Wooddream 711423"
	. IF YZ=0 WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_WH_$CHAR(13)_$$^WWWTEXT(32025)_":"_$PIECE(POS(YI),Y,5)_""""   ;ARTIKELNUMMER UND BEZEICHNUNG UND WARENHERKUNFT  UND MENGE ;And notation And And quantity 
	. IF YZ=0 WRITE " HREF="
	. IF YZ=0 IF ($PIECE(POS(YI),Y,205)'=1) || ($PIECE(POS(YI),Y,169)=5) DO
	. . IF $PIECE(POS(YI),Y,123)'<0  IF LINKS=1 DO   ;WENN WH NOCH NICHT ERFASST ;when yet Not 
	. . . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFWH&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;WH DER POSITION BESTIMMEN ;the ordain 
	. . . SET YBACK="INAUFBANZ,"
	. . . DO ^WWWCGI
	. ;
	. IF YZ=0 IF ($PIECE(POS(YI),Y,205)'=1) || ($PIECE(POS(YI),Y,169)=5) DO
	. . IF $PIECE(POS(YI),Y,123)'<0  IF LINKS=2 DO   ;ZURÜCKNEHMENBAR; ;27235;FAN;25.01.05
	. . . WRITE """"
	. . . WRITE "JAVASCRIPT:if (confirm('"_$$^WWWTEXT(34129,,1)_"')) window.location='"       ;Warenherkunft zurückzunehmen?  
	. . . WRITE YAKTION_"EP=WWWMANU&YEXEC=DO|^INAUFPUNSOURCE&YFORM=INAUFBANZ&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION BEABEITEN
	. . . SET YBACK="INAUFBANZ,"
	. . . DO ^WWWCGI
	. . . WRITE "';"
	. . . WRITE " else window.location='"
	. . . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFBANZ&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION BEABEITEN
	. . . SET YBACK="INAUFBANZ,"
	. . . DO ^WWWCGI
	. . . WRITE "';"
	. . . WRITE """"
	. ;
	. IF YZ=0 IF $PIECE(POS(YI),Y,205)=1 IF $PIECE(POS(YI),Y,169)'=5 WRITE "#"
	. IF YZ=0 IF $PIECE(POS(YI),Y,7)'="" IF +$PIECE(POS(YI),Y,5)-$PIECE(POS(YI),Y,6)=0 WRITE "#"  ;WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFP&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION BEABEITEN
	. IF YZ=0 WRITE ">"
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. IF YZ=0 IF $PIECE(POS(YI),Y,123)'<0 IF ($PIECE(POS(YI),Y,7)="") || (+$PIECE(POS(YI),Y,5)-$PIECE(POS(YI),Y,6)'=0) WRITE "<FONT COLOR=RED>"   ;WARENHERKUNFT NICHT GEGEBEN ;Not 
	. IF YZ=0 IF $PIECE(POS(YI),Y,123)'<0 IF $PIECE(POS(YI),Y,7)'="" IF $PIECE(POS(YI),Y,6)'=0 IF $PIECE(POS(YI),Y,6)<$PIECE(POS(YI),Y,5) WRITE "<FONT COLOR=BLUE>"   ;WARENHERKUNFT NUR TEILWEISE FESTGELEGT ;only 
	. IF YZ=0 IF $PIECE(POS(YI),Y,5)>0    IF $PIECE(POS(YI),Y,7)=2   IF $PIECE(POS(YI),Y,6)=0  IF $PIECE($GET(^INVORG(YM,YM,1)),Y,211)=1  WRITE "<FONT COLOR=BLUE>"   ;WARENHERKUNFT WIRD ERST SPÄTER (BEREITSTELLUNG) FESTGELEGT;FIS;21.02.05;26869 
	. IF YZ=1 IF $PIECE(POS(YI),Y,123)'<0 IF ($PIECE(POS(YI),Y,7)="") || (+$PIECE(POS(YI),Y,5)-$PIECE(POS(YI),Y,6)'=0) SET RED(1)=$GET(RED(1))+1
	. IF YZ=0 IF LINKS=2 WRITE "<U>"
	. IF YZ=0 WRITE YI
	. IF YZ=0 IF LINKS=2 WRITE "</U>"
	. IF YZ=0 WRITE " "
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. IF YZ=0 IF $PIECE(POS(YI),Y,123)'<0 IF ($PIECE(POS(YI),Y,7)="") || ($PIECE(POS(YI),Y,5)-$PIECE(POS(YI),Y,6)'=0) WRITE "</FONT>"   ;WARENHERKUNFT NICHT GEGEBEN ;Not 
	. IF YZ=0 WRITE "</A>"
	
	IF YZ=1 SET BLACK(1) = POS-$GET(RED(1))
	IF YZ=1 IF +$GET(BLACK(1))'=0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32642)_""""   ;BEARBEITEN      "Line Item Summary By Condition"   "Summe der bearbeiteten Positionen" (edited)
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',1,1,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT SIZE=2>"   
	. WRITE +BLACK(1)_" "
	. WRITE "</FONT>"   
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</A>"
	
	IF YZ=1 IF +$GET(RED(1))'=0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32643)_""""   ;BEARBEITEN     "Line Item Summary By Condition"   "Summe der unbearbeiteten Positionen" (raw state)
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',1,2,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT FONT SIZE=2 COLOR=RED>"   ;WARENHERKUNFT NICHT GEGEBEN ;Not 
	. WRITE +RED(1)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"   ;WARENHERKUNFT NICHT GEGEBEN ;Not 
	. WRITE "</A>"
	
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
BP
	;-------------------------------------------------------------------------------
	;	(*8*) Pur/Prod Order
	;	BESTELLDATUM/PRODUKTION
	; 
	; History:
	; 14-May-2010	PPP		SR17300: Remove the Link for Printing
	; 06-Dec-2006	GRF		SR15272: Remove Duplicate <TD opening
	;-------------------------------------------------------------------------------
	;WRITE "<TD NOWRAP VALIGN=TOP"                 ; SR15272
	WRITE "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF  IF YZ=0                            WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YZ=0             IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR="" IF YLEAUF=AUF                 WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YZ=1 IF COLOR="" IF YLEAUF'=AUF IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR'=""                              WRITE " BGCOLOR="_""""_COLOR_""""
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	SET YII=-1
	
	SET YI=""
	;FOR  SET YI=$ORDER(POS(YI)) QUIT:YI=""  DO
	FOR  SET YI=$ORDER(^WWWSOR(YUSER,"POS",YI)) QUIT:YI=""  DO  KILL POS(YI)  ;FIS;13.05.03;23614;<STORE> ERROR
	. SET POS(YI)=$GET(^WWWSOR(YUSER,"POS",YI))
	. NEW DATE
	. IF $PIECE(POS(YI),Y,7)'=1 IF $PIECE(POS(YI),Y,7)'=3 IF $PIECE(POS(YI),Y,7)'=4 QUIT   ;NUR BEI BESTELLUNG ODER PRODUKTION ;only next to sales order Or production 
	. IF $PIECE(POS(YI),Y,7)=4  QUIT:$ORDER(^INAUFPXL(YM,AUF,POS,""))=""  ;KEINE TEILE ;no 
	. IF YZ=0 SET YII=$GET(YII)+1
	. IF YZ=0 IF YII'=0 IF YII#6=0 WRITE "<BR>"
	. IF YZ=0 WRITE YCR
	. ;IF YZ=0 IF $$^WWWACCESS("",$PIECE($GET(^INVORG(YM,YM,1)),Y,31))=1 DO   ;BESTELLBERCHTIGUNG
	. IF YZ=0 IF $$^WWWACCESS("",$GET(YINVORG(31)))=1 DO   ;BESTELLBERCHTIGUNG
	. . IF YZ=0 WRITE "<A"
	. . SET DATE=""
	. . IF $PIECE(POS(YI),Y,83)'=""  SET DATE=$$^WWWDATE($PIECE(POS(YI),Y,83))  ;DATUM DER BESTELLUNG ;Date the sales order 
	. . IF $PIECE(POS(YI),Y,165)'="" SET DATE=$PIECE(POS(YI),Y,165)_"   "_$$^WWWDATE($PIECE(POS(YI),Y,83))   ;STEMPELNUMMER
	. . IF $PIECE(POS(YI),Y,7)'=""   SET WH=$PIECE($GET(^WWW101(0,"WARENHERKUNFT",SPRACHE,$PIECE(POS(YI),Y,7),1)),Y,1)
	. . IF YZ=0 WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_WH_": "_DATE_""""   ;DATUM DES BESTELLDRUCKS ;Date 
	. . //SR17300
	. . //IF YZ=0 WRITE " HREF="
	. . //IF YZ=0 IF $PIECE(POS(YI),Y,205)=1 WRITE "#"
	. . //IF YZ=0 IF $PIECE(POS(YI),Y,205)'=1 DO
	. . . //IF $PIECE(POS(YI),Y,123)<0 WRITE "#"
	. . . //IF $PIECE(POS(YI),Y,123)'<0 DO  ;WENN KEINE GUTSCHRIFT ;when no 
	. . . . //IF $PIECE(POS(YI),Y,7)=1 DO
	. . . . . //IF $DATA(^INWEAUF(YM,AUF,YI,1)) && ($PIECE($GET(^INAUF(YM,AUF,1)),Y,263)="") || $DATA(^INWEAUFALT(YM,AUF,YI)) WRITE "#" QUIT  ;BEREITS GELIEFERT -  GILT NICHT FÜR KOMMISSIONSWARE,ULM,26.03.03 
	. . . . . ;WRITE YAKTION_"EP=WWWMANU&YEXEC=DO|^INAUFBES2('"_AUF_"','"_YI_"')&YFORM=INAUFBES&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION BEABEITEN
	. . . . . ;SET YBACK="INAUFBANZ,"
	. . . . . ;DO ^WWWCGI
	. . . . . ;BEC 10.02.03 ÄNDERUNG VON FIS EINGESCHALTET ;alteration 
	. . . . . //WRITE """"
	. . . . . //WRITE "JAVASCRIPT:if (confirm('"_$$^WWWTEXT(33288,,1)_"')) window.location='"  ;positionen je lieferant zusammenfassen ? ;once provider summarize 
	. . . . . //WRITE YAKTION_"EP=WWWMANU&YEXEC=DO|^INAUFBES2(\'"_AUF_"\',"_YI_",1)&YFORM=INAUFBES&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION BEABEITEN
	. . . . . //SET YBACK="INAUFBANZ,"
	. . . . . //DO ^WWWCGI
	. . . . . //WRITE "';"
	. . . . . //WRITE " else window.location='"
	. . . . . //WRITE YAKTION_"EP=WWWMANU&YEXEC=DO|^INAUFBES2(\'"_AUF_"\',"_YI_")&YFORM=INAUFBES&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION BEABEITEN
	. . . . . //SET YBACK="INAUFBANZ,"
	. . . . . //DO ^WWWCGI
	. . . . . //WRITE "';"
	. . . . . //WRITE """"
	. . . . ;
	. . . . IF ($PIECE(POS(YI),Y,7)=3) || ($PIECE(POS(YI),Y,7)=4) DO 
	. . . . . IF $PIECE(POS(YI),Y,169)'=1   IF $PIECE(POS(YI),Y,169)'=3 WRITE "#" QUIT  ;KEINE REKLA ;no 
	. . . . . IF ($PIECE(POS(YI),Y,169)=1) || ($PIECE(POS(YI),Y,169)=3) WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INPROPRODU1('"_AUF_"','"_YI_"')&YFORM=INPROAUF&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;FERTIGUNG, WENN REKLAMATION/ERSATZTEIL
	. . . . . SET YBACK="INAUFBANZ,"
	. . . . . DO ^WWWCGI
	. . ;
	. . IF YZ=0 WRITE ">"
	. ;
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. IF YZ=0 IF ($PIECE(POS(YI),Y,169)=1) || ($PIECE(POS(YI),Y,169)=3) IF $PIECE(POS(YI),Y,123)'<0 IF $PIECE(POS(YI),Y,83)="" IF $PIECE(POS(YI),Y,165)="" WRITE "<FONT COLOR=RED>"   ;NOCH KEIN BESTELLDRUCK UND FERTIGUNGSDRUCK ;yet no And 
	. IF YZ=0 IF $PIECE(POS(YI),Y,7)=1 IF $PIECE(POS(YI),Y,83)="" WRITE "<FONT COLOR=RED>"   ;NOCH KEIN BESTELLDRUCK ;yet no 
	. IF YZ=0 WRITE YI_" "
	. IF YZ=0 IF ($PIECE(POS(YI),Y,169)=1) || ($PIECE(POS(YI),Y,169)=3) IF $PIECE(POS(YI),Y,123)'<0 IF $PIECE(POS(YI),Y,83)="" IF $PIECE(POS(YI),Y,165)="" WRITE "</FONT>"   ;NOCH KEIN BESTELLDRUCK UND FERTIGUNG ;yet no And 
	. IF YZ=0 IF $PIECE(POS(YI),Y,7)=1 IF $PIECE(POS(YI),Y,83)="" WRITE "</FONT>"   ;NOCH KEIN BESTELLDRUCK ;yet no 
	. IF YZ=1 IF ($PIECE(POS(YI),Y,169)=1) || ($PIECE(POS(YI),Y,169)=3) IF $PIECE(POS(YI),Y,123)'<0 IF $PIECE(POS(YI),Y,83)="" IF $PIECE(POS(YI),Y,165)="" SET RED(2)=$GET(RED(2))+1   ;NOCH KEIN BESTELLDRUCK UND FERTIGUNG ;yet no And 
	. IF YZ=1 IF $PIECE(POS(YI),Y,7)=1 IF $PIECE(POS(YI),Y,83)="" SET RED(2)=$GET(RED(2))+1
	. IF YZ=1 IF $PIECE(POS(YI),Y,169)'=1 IF $PIECE(POS(YI),Y,169)'=3 IF $PIECE(POS(YI),Y,7)=1 IF $PIECE(POS(YI),Y,83)'="" SET BLACK(2)=$GET(BLACK(2))+1
	. IF YZ=1 IF $PIECE(POS(YI),Y,169)'=1 IF $PIECE(POS(YI),Y,169)'=3 IF $PIECE(POS(YI),Y,7)=3 SET BLACK(2)=$GET(BLACK(2))+1
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. ;IF YZ=0 IF $$^WWWACCESS("",$PIECE($GET(^INVORG(YM,YM,1)),Y,31))=1 DO   ;BESTELLBERCHTIGUNG
	. IF YZ=0 IF $$^WWWACCESS("",$GET(YINVORG(31)))=1 DO   ;BESTELLBERCHTIGUNG
	. . IF YZ=0 WRITE "</A>"
	
	IF YZ=1 IF +$GET(BLACK(2))'=0 DO  
	. WRITE YCR
	. DO
	. . //SR17300
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32642)_""""   ;BEARBEITEN
	. . //WRITE " HREF="_""""
	. . //WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',2,1,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . //SET YBACK="INAUFBANZ,"
	. . //DO ^WWWCGI
	. . //WRITE """"
	. . //WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT SIZE=2>"  
	. WRITE +BLACK(2)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"  
	. WRITE "</A>"
	
	IF YZ=1 IF +$GET(RED(2))'=0 DO
	. WRITE YCR
	. DO
	. . //SR17300
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32643)_""""   ;UNBEARBEITEN
	. . //WRITE " HREF="_""""
	. . //WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',2,2,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . //SET YBACK="INAUFBANZ,"
	. . //DO ^WWWCGI
	. . //WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT FONT SIZE=2 COLOR=RED>"   
	. WRITE +RED(2)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"  
	. WRITE "</A>]]><![CDATA["
	
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;+++++++++++++++++++++++++++++++++++++++
	;   IMPLICITLY DROPS THROUGH TO AB
	;+++++++++++++++++++++++++++++++++++++++
	
AB
	;-------------------------------------------------------------------------------
	;		(*9*) Order Confirmation
	;		AUFTRAGSBESTÄTIGUNG
	; 
	; History:
	; 06-Dec-2006	GRF		SR15272: Remove Duplicate <TD opening
	;-------------------------------------------------------------------------------
	;WRITE "<TD NOWRAP VALIGN=TOP"                ; SR15272
	WRITE "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF  IF YZ=0                            WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YZ=0             IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR="" IF YLEAUF=AUF                 WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YZ=1 IF COLOR="" IF YLEAUF'=AUF IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR'=""                              WRITE " BGCOLOR="_""""_COLOR_""""
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	SET YII=-1
	
	SET YI=""
	;FOR  SET YI=$ORDER(POS(YI)) QUIT:YI=""  DO
	FOR  SET YI=$ORDER(^WWWSOR(YUSER,"POS",YI)) QUIT:YI=""  DO  KILL POS(YI)  ;FIS;13.05.03;23614;<STORE> ERROR
	. SET POS(YI)=$GET(^WWWSOR(YUSER,"POS",YI))
	. NEW LIEFAB,ABNUM,ABLITM,ABMK,ABSEND,LIEFER
	. IF $PIECE(POS(YI),Y,7)'=1  IF $PIECE(POS(YI),Y,7)'=3      QUIT   ;NUR BEI BESTELLUNG oder Produktion ;only next to sales order or production 
	. IF $PIECE(POS(YI),Y,60)=1  IF $PIECE(POS(YI),Y,217)'=""   QUIT   ;MANUELL ABGESCHLOSSEN
	. IF $PIECE(POS(YI),Y,83)="" IF '$DATA(^INWEAUF(YM,AUF,YI)) QUIT   ;noch keine Bestellung gedruckt;ABER SCHON WE;TYBD;7,10,2004
	. SET ABSEND=0   ;KEINE AB VON LIEFERANTEN ;no Confirm. 
	. SET LIEFAB=$ORDER(^INAUFPA(YM,AUF,YI,""),-1)  ;LETZTER LIEFERANT ;last supplier 
	. SET LIEFER=LIEFAB
	. IF LIEFER="" SET LIEFER=$PIECE(AUF1,Y,12)
	. IF LIEFER="" SET LIEFER=$PIECE(POS(YI),Y,12)
	. IF LIEFER'="" IF $PIECE($GET(^INLIEF(YM,LIEFER,1)),Y,34)=1 SET ABSEND=1  ;LIEFERANT MIT AB ;supplier by means of Confirm. 
	. IF ABSEND'=1 QUIT  ;KEINE AB ;no Confirm. 
	. IF YZ=0 SET YII=YII+1
	. IF YZ=0 IF YII'=0 IF YII#6=0 WRITE "<BR>" 
	. IF YZ=0 WRITE YCR
	. IF YZ=0 WRITE "<A"
	. SET ABNUM=""
	. SET ABLITM=""
	. SET ABMK=""
	. ;
	. IF LIEFAB'="" SET ABNUM=$ORDER(^INAUFPA(YM,AUF,YI,LIEFAB,""),-1)  ;LETZTE AB ;last Confirm. 
	. IF ABNUM'="" DO
	. . SET ABLITM=$$^WWWDATE($PIECE($GET(^INAUFPA(YM,AUF,YI,LIEFAB,ABNUM,1)),Y,23))  ;LIEFERTERMIN ;time of delivery 
	. . SET ABMK=$PIECE($GET(^INAUFPA(YM,AUF,YI,LIEFAB,ABNUM,1)),Y,24)  ;ABMERKER
	. . IF ABMK'="" SET ABMK=$PIECE($GET(^INABMERKER(YM,ABMK,1)),Y,1)  ;TEXT ABMERKER
	. ;
	. SET GLITM=$$^WWWDATE($PIECE(AUF1,Y,19))  ;GEWÜNSCHTER LIEFERTERMIN AUFTRAG ;time of delivery order 
	. IF $PIECE(POS(YI),Y,19)'="" SET GLITM=$$^WWWDATE($PIECE(POS(YI),Y,19))  ;GEWÜNSCHTER LIEFERTERMIN POSITION ;time of delivery 
	. ;IF ABNUM="" SET ABNUM=0
	. IF LIEFAB="" SET LIEFAB=$PIECE(POS(YI),Y,12)  ;LIEFERANT DER Position ;supplier the Line Item 
	. IF LIEFAB="" SET LIEFAB=$PIECE(AUF1,Y,12)     ;LIEFANTEN BESTELLUNG  ;sales order 
	. SET YLIEFERANT=""
	. IF LIEFER'="" SET YLIEFERANT=$EXTRACT($PIECE($GET(^INLIEF(YM,LIEFER,1)),Y,8),1,17)_$CHAR(13)
	. IF YZ=0 WRITE " TITLE="_""""_YLIEFERANT_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_"#:"_ABNUM_" TM:"_GLITM_"/"_ABLITM_$CHAR(13)_"?:"_ABMK
	. IF YZ=0 IF $PIECE(POS(YI),Y,242)'="" WRITE $CHAR(13)_$$^WWWTEXT(32677)_$PIECE(POS(YI),Y,242)  
	. IF YZ=0 IF $PIECE(POS(YI),Y,243)'="" WRITE $CHAR(13)_$$^WWWTEXT(32678)_$PIECE(POS(YI),Y,243)
	. IF YZ=0 WRITE """"   ;DATUM DES BESTELLDRUCKS ;Date 
	. IF YZ=0 WRITE " HREF="
	. ;IF $P(POS(YI),Y,205)=1 W "#"
	. ;IF $P(POS(YI),Y,205)'=1 W """" DO
	. IF YZ=0 WRITE """" DO
	. . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFPA&YFKEY="_AUF_","_YI_","_LIEFAB_","_ABNUM_"&YKEY="_AUF_","_YI_","_LIEFAB_","_ABNUM_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION BEABEITEN
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. ;
	. IF YZ=0 WRITE ">"
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. IF YZ=0 IF ABSEND=1 IF $ORDER(^INWEAUF(YM,AUF,YI,""))=""  IF $ORDER(^INWEAUFALT(YM,AUF,YI,""))="" IF '$DATA(^INAUFPA(YM,AUF,YI)) WRITE "<FONT COLOR=RED>"   ;AB NICHT VORHANDEN  ;SENDET AB ; KEIN WE
	. IF YZ=1 IF ABSEND=1 IF $ORDER(^INWEAUF(YM,AUF,YI,""))=""  IF $ORDER(^INWEAUFALT(YM,AUF,YI,""))="" IF '$DATA(^INAUFPA(YM,AUF,YI)) SET RED(3)=$GET(RED(3))+1
	. IF YZ=1 IF ABSEND=1 IF $DATA(^INAUFPA(YM,AUF,YI)) SET BLACK(3)=$GET(BLACK(3))+1
	. IF YZ=0 WRITE YI
	. IF YZ=0 IF ABSEND=1 IF $ORDER(^INWEAUF(YM,AUF,YI,""))="" IF $ORDER(^INWEAUFALT(YM,AUF,YI,""))="" IF '$DATA(^INAUFPA(YM,AUF,YI)) WRITE "</FONT>"   ;AB NICHT VORHANDEN ;SENDET AB ; KEIN WE
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. IF YZ=0 WRITE "</A>"
	. ;INFO BEIM LIEFERANTEN
	. IF YZ=0 IF ABNUM'="" IF LIEFAB'="" DO
	. . NEW YURL
	. . SET YURL=$PIECE($GET(^INLIEF(YM,LIEFAB,1)),Y,120)   ;URL DER AUFTRAGSINFORMATION ;URL the 
	. . QUIT:YURL=""
	. . ;WRITE "&nbsp;"
	. . SET YURL=YURL_ABNUM
	. . WRITE YCR
	. . WRITE "<A HREF="_""""
	. . WRITE "http://"_YURL_""""
	. . WRITE " TARGET=ARTTIKELINFO"
	. . WRITE ">"
	. . WRITE YCR,"<IMG SRC="_""""_YGIF_"left.gif"_""""_" BORDER=0 TITLE='"_$$^WWWTEXT(32197)_"'></A>"
	. . ;
	. . WRITE "&nbsp;"
	
	IF YZ=1 IF $GET(BLACK(3))>0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32642)_""""   ;BEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',3,1,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT SIZE=2>"   
	. WRITE +BLACK(3)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"   
	. WRITE "</A>"
	
	IF YZ=1 IF $GET(RED(3))>0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32643)_""""   ;BEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',3,2,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"   ;GESPERRT ;DISABLED 
	. WRITE "<FONT FONT SIZE=2 COLOR=RED>"   
	. WRITE +RED(3)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"  
	. WRITE "</A>"
	
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;+++++++++++++++++++++++++++++++++++++++
	;   IMPLICITLY DROPS THROUGH TO WE
	;+++++++++++++++++++++++++++++++++++++++
	
WE
	;-------------------------------------------------------------------------------
	;	(*18*) Receipt
	;	WE UND FERTIGSTELLUNG - ACHTUNG FARBCODES GGF AUCH IN ^INERECHA ÄNDERN -
	; 
	; History:
	; 04-Feb-2010	PPP		SR17162: Edit Open Orders clicking on the Rec column to
	; 							be directed to New Receipt
	; 21-Jan-2010	PPP		SR17141: Received orders to update the Edit Open Orders
	;							screen with outstanding Qty
	; 17-Jul-2007	GRF		SR15572: naked reference - use objGroupReceipt and remove
	; 							unneeded lines
	; 06-Dec-2006	GRF		SR15272: Remove Duplicate <TD opening
	; 18-Apr-2006	JW		SR14421: Go to INREC form if no receipt exists
	;-------------------------------------------------------------------------------
	;WRITE "<TD NOWRAP VALIGN=TOP"                ; SR15272
	WRITE "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF  IF YZ=0                            WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YZ=0             IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR="" IF YLEAUF=AUF                 WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YZ=1 IF COLOR="" IF YLEAUF'=AUF IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR'=""                              WRITE " BGCOLOR="_""""_COLOR_""""
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	SET YII=-1
	
	SET YI=""
	;FOR  SET YI=$ORDER(POS(YI)) QUIT:YI=""  DO   
	FOR  SET YI=$ORDER(^WWWSOR(YUSER,"POS",YI)) QUIT:YI=""  DO  KILL POS(YI)  ;FIS;13.05.03;23614;<STORE> ERROR 
	. SET POS(YI)=$GET(^WWWSOR(YUSER,"POS",YI)) 
	. NEW DAT,BETR,LAP,DAT1,ALT,MENGE,LIEF,KURZWE,KWED,WEOK,LEOK,WESCHNELLOK
	. SET (DAT,BETR,LAP,DAT1,ALT,MENGE)=""
	. SET KURZWE=0
	. IF $PIECE(POS(YI),Y,7)'=1 IF $PIECE(POS(YI),Y,7)'=3    QUIT   ;NUR BEI BESTELLUNG oder Produktion ;only next to sales order or production 
	. ;IF $PIECE(POS(YI),Y,7)=1 IF $PIECE(POS(YI),Y,83)=""   QUIT   ;NOCH NICHT GEDRUCK ;AUSGESCHALTETET, DA WE VOR DRUCKERFOLGEN KANN
	. IF $PIECE(POS(YI),Y,7)=3  IF $PIECE(POS(YI),Y,165)=""  QUIT   ;NOCH KEINE FERIGUNGSNUMMER BEI EIGENENTWICKLUNG ;yet no next to 
	. IF $PIECE(POS(YI),Y,60)=1 IF $PIECE(POS(YI),Y,217)'="" QUIT   ;MANUELL ABGESCHLOSSEN
	. IF $DATA(^INWEAUF(YM,AUF,YI)) DO
	. . SET BETR(1)=""
	. . FOR  SET BETR(1)=$ORDER(^INWEAUF(YM,AUF,YI,BETR(1))) QUIT:BETR(1)=""  DO
	. . . SET BETR=BETR(1)
	. . . SET LAP(1)=""
	. . . FOR  SET LAP(1)=$ORDER(^INWEAUF(YM,AUF,YI,BETR(1),LAP(1))) QUIT:LAP(1)=""  DO   ;LAGERPL
	. . . . SET LAP=LAP(1)
	. . . . SET DAT(1)=""
	. . . . FOR  SET DAT(1)=$ORDER(^INWEAUF(YM,AUF,YI,BETR(1),LAP(1),DAT(1))) QUIT:DAT(1)=""  DO   ;WEDATUM
	. . . . . SET DAT=DAT(1)
	. . . . . SET MENGE=MENGE+$PIECE($GET(^INWEAUF(YM,AUF,YI,BETR(1),LAP(1),DAT(1),1)),Y,4)
	. ;
	. IF $DATA(^INWEAUF(YM,AUF,YI)) DO
	. . SET WEOK=0
	. . SET LEOK=0
	. . NEW BET,LAP,WE,WEM
	. . SET BET=""
	. . FOR  SET BET=$ORDER(^INWEAUF(YM,AUF,YI,BET)) QUIT:BET=""  DO
	. . . SET LAP=""
	. . . FOR  SET LAP=$ORDER(^INWEAUF(YM,AUF,YI,BET,LAP)) QUIT:LAP=""  DO
	. . . . ;SET WE=""  SET WE=$ORDER(^INWEAUF(YM,AUF,YI,BET,LAP,WE),-1)  DO               ;WENN LATZT OK DANN OK
	. . . . SET WE=""
	. . . . FOR  SET WE=$ORDER(^INWEAUF(YM,AUF,YI,BET,LAP,WE)) QUIT:WE=""  DO
	. . . . . SET WEM=$PIECE($GET(^INWEAUF(YM,AUF,YI,BET,LAP,WE,1)),Y,10)
	. . . . . IF WEM="" SET WEOK=1 QUIT
	. . . . . IF $PIECE($GET(^INWEMERKER(YM,WEM,1)),Y,2)=1 SET WEOK=1
	. . . . . IF $PIECE($GET(^INWEMERKER(YM,WEM,1)),Y,3)=1 SET LEOK=1
	. ;
	. IF $PIECE(POS(YI),Y,7)=1 IF $PIECE(POS(YI),Y,5)>MENGE SET WEOK=0  ;NOCH NICHT VOLLSTÄNDIG;FIS;02.10.03 ;yet Not integral 
	. IF $DATA(^INWEAUFALT(YM,AUF,YI)) DO  ;SCHON AUSGELIEFERT ;yet 
	. . SET ALT=1
	. . SET BETR(1)=""
	. . FOR  SET BETR(1)=$ORDER(^INWEAUFALT(YM,AUF,YI,BETR(1))) QUIT:BETR(1)=""  DO
	. . . SET BETR=BETR(1)
	. . . SET LAP(1)=""
	. . . FOR  SET LAP(1)=$ORDER(^INWEAUFALT(YM,AUF,YI,BETR(1),LAP(1))) QUIT:LAP(1)=""  DO   ;LAGERPL
	. . . . SET LAP=LAP(1)
	. . . . SET DAT(1)=""
	. . . . FOR  SET DAT(1)=$ORDER(^INWEAUFALT(YM,AUF,YI,BETR(1),LAP(1),DAT(1))) QUIT:DAT(1)=""  DO   ;WEDATUM
	. . . . . SET DAT=DAT(1)
	. . . . . SET MENGE=MENGE+$PIECE($GET(^INWEAUFALT(YM,AUF,YI,BETR(1),LAP(1),DAT(1),1)),Y,4)
	. ;
	. IF DAT="" IF $DATA(^INWESCHNELLs(YM,2,$$^WWWUMLAU(AUF,1),$$^WWWUMLAU(YI,1),$PIECE(POS(YI),Y,4))) DO  ;BEREITS ALS SCHNELL-WE ERFASST ;yet when 
	. . NEW LIEF
	. . ;SET WESCHNELLOK=0 ;table-mat 
	. . SET BETR(1)=""
	. . FOR  SET BETR(1)=$ORDER(^INWESCHNELLs(YM,2,$$^WWWUMLAU(AUF,1),$$^WWWUMLAU(YI,1),$PIECE(POS(YI),Y,4),BETR(1))) QUIT:BETR(1)=""  DO
	. . . SET BETR=BETR(1)
	. . . SET LIEF(1)=""
	. . . ; SR15572 vvv
	. . . FOR  SET LIEF(1)=$ORDER(^INWESCHNELL(YM,$PIECE(POS(YI),Y,4),BETR(1),AUF,YI,LIEF(1))) QUIT:LIEF(1)=""  DO   ;LAGERPL
	. . . . new objGroupReceipt
	. . . . set objGroupReceipt = $GET(^INWESCHNELL(YM,$PIECE(POS(YI),Y,4),BETR(1),AUF,YI,LIEF(1),1))
	. . . . SET MENGE = MENGE+$PIECE(objGroupReceipt,Y,1)
	. . . . SET KWED  = $PIECE(objGroupReceipt,Y,5)                    ; Naked Ref
	. . . . SET LAP   = $PIECE($GET(^INVORGB(YM,YM,BETR(1),1)),Y,1)
	. . . . IF LAP="" SET LAP = $ORDER(^INLP(YM,BETR,""))
	. . . . SET KURZWE=1
	. . . ;FOR  SET LIEF(1)=$ORDER(^INWESCHNELL(YM,$PIECE(POS(YI),Y,4),BETR(1),AUF,YI,LIEF(1))) QUIT:LIEF(1)=""  DO   ;LAGERPL
	. . . ;. NEW WESCHNELLM
	. . . ;. SET YLIEFERANT=LIEF(1)
	. . . ;. SET MENGE=MENGE+$PIECE($GET(^INWESCHNELL(YM,$PIECE(POS(YI),Y,4),BETR(1),AUF,YI,LIEF(1),1)),Y,1)
	. . . ;. SET WESCHNELLM=$PIECE($GET(^INWESCHNELL(YM,$PIECE(POS(YI),Y,4),BETR(1),AUF,YI,LIEF(1),1)),Y,2)
	. . . ;. ;I WESCHNELLM'="" IF $PIECE($GET(^INWEMERKER(YM,WESCHNELLM,1)),Y,2)=1 SET WESCHNELLOK=1
	. . . ;. SET KWED=$PIECE($GET(^ (1)),Y,5)
	. . . ;. SET LAP=$PIECE($GET(^INVORGB(YM,YM,BETR(1),1)),Y,1)
	. . . ;. IF LAP="" SET LAP=$ORDER(^INLP(YM,BETR,""))
	. . . ;. SET KURZWE=1
	. . . ; SR15572 ^^^
	. ;
	. IF $DATA(^INWEAUFVOR(YM,AUF,YI)) DO  ;WE IN VORERFASSUNG;FIS;30.08.04;25661
	. . SET BETR(1)=""
	. . FOR  SET BETR(1)=$ORDER(^INWEAUFVOR(YM,AUF,YI,BETR(1))) QUIT:BETR(1)=""  DO
	. . . SET BETR=BETR(1)
	. . . SET LAP(1)=""
	. . . FOR  SET LAP(1)=$ORDER(^INWEAUFVOR(YM,AUF,YI,BETR(1),LAP(1))) QUIT:LAP(1)=""  DO   ;LAGERPL
	. . . . SET LAP=LAP(1)
	. . . . SET DAT(1)=""
	. . . . FOR  SET DAT(1)=$ORDER(^INWEAUFVOR(YM,AUF,YI,BETR(1),LAP(1),DAT(1))) QUIT:DAT(1)=""  DO   ;WEDATUM
	. . . . . SET MENGE=MENGE+$PIECE($GET(^INWEAUFVOR(YM,AUF,YI,BETR(1),LAP(1),DAT(1),1)),Y,4)        ;MENGE     ;quantity 
	. . . . . SET YLIEFERANT=$PIECE($GET(^INWEAUFVOR(YM,AUF,YI,BETR(1),LAP(1),DAT(1),1)),Y,7)         ;LIEFERANT ;supplier 
	. . . . . ; FIXME : <GRF> WESCHNELLM not actually used in this routine.  Is it passed back?
	. . . . . SET WESCHNELLM=$PIECE($GET(^INWEAUFVOR(YM,AUF,YI,BETR(1),LAP(1),DAT(1),1)),Y,10)        ;WE-MERKER
	. . . . . SET KWED=DAT(1)
	. . . . . SET KURZWE=1
	. ;
	. SET DAT1=DAT
	.;IF (DAT="") || ($PIECE(POS(YI),Y,7)=3) SET DAT=$PIECE(POS(YI),Y,164)  ;FERTIGSTELLUNG BEI EIGENPRODUKTION
	. IF (DAT="") || ($PIECE(POS(YI),Y,7)=3) SET DAT=$PIECE(POS(YI),Y,264)  ;FERTIGSTELLUNG BEI EIGENPRODUKTION  ;FIS, 31.01.03
	. IF $DATA(^INWEAUF(YM,AUF,YI)) IF (LEOK=1) || (WEOK=1) SET $PIECE(POS(YI),Y,90)=1 SET $PIECE(^INAUFP(YM,AUF,YI,1),Y,90)=1      ;AUSLIEFERFÄHIG
	. ;
	. DO               ;------------EINZEL ERSCHEINEN
	. . IF YZ=0 SET YII=YII+1
	. . IF YZ=0 IF YII'=0 IF YII#6=0 WRITE "<BR>" 
	. . IF YZ=0 WRITE YCR
	. . IF YZ=0 WRITE "<A"
	. . ;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	. . ;IF YZ=0 IF $PIECE(POS(YI),Y,7)=1 DO  ;TIPP FÜR DIE LAGERWARE   ;WEM;24697;16.12.2003;OLD LINE
	. . ;. SET YLIEFERANT=""
	. . ;. IF $PIECE(POS(YI),Y,12)'="" SET YLIEFERANT=$EXTRACT($PIECE($GET(^INLIEF(YM,$PIECE(POS(YI),Y,12),1)),Y,8),1,17)_$CHAR(13)
	. . ;. IF DAT'=""             WRITE " TITLE="_""""_YLIEFERANT_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(32054)_": "_BETR_" - "_LAP_$CHAR(13)_$$^WWWTEXT(32025)_":"_MENGE_"/"_$PIECE(POS(YI),Y,5)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . ;. IF DAT="" IF KURZWE=1  WRITE " TITLE="_""""_YLIEFERANT_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(32563)_": "_$$^WWWDATE(KWED)_$CHAR(13)_$$^WWWTEXT(32025)_":"_MENGE_"/"_$PIECE(POS(YI),Y,5)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . ;. IF DAT="" IF KURZWE=0  WRITE " TITLE="_""""_YLIEFERANT_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(32099)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . ;
	. . ;IF YZ=0 IF $PIECE(POS(YI),Y,7)=3 DO  ;TIPP FÜR DIE FERTIGUNGSWARE   ;WEM;24697;16.12.2003;OLD LINE
	. . ;. IF DAT'="" WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWDATE(DAT)_" "_$$^WWWTIME($PIECE(DAT,",",2))   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . ;. IF DAT=""  WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . ;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	. . ;
	. . DO   ;WEM;24697;16.12.2003;NEW LINE
	. . . NEW VAL
	. . . SET VAL=$$INAUFBANZ^INAUFPWECHECK(AUF,YI)
	. . . IF VAL=0 IF YZ=0 IF $PIECE(POS(YI),Y,7)'=3 WRITE " TITLE="_""""_$$^WWWTEXT(185)_"! "_$$^WWWTEXT(33697)_"""" QUIT   ; ACHTUNG! ES WURDE NOCH KEINE BESTELLUNG GEDRUCKT. ;it were yet no sales order 
	. . . IF YZ=0 IF $PIECE(POS(YI),Y,7)=1 DO  ;TIPP FÜR DIE LAGERWARE ;to who 
	. . . . SET YLIEFERANT=""
	. . . . IF $PIECE(POS(YI),Y,12)'="" SET YLIEFERANT=$EXTRACT($PIECE($GET(^INLIEF(YM,$PIECE(POS(YI),Y,12),1)),Y,8),1,17)_$CHAR(13)
	. . . . //SR17141 vvvvvv
	. . . . //IF DAT'=""             WRITE " TITLE="_""""_YLIEFERANT_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(32054)_": "_BETR_" - "_LAP_$CHAR(13)_$$^WWWTEXT(32025)_":"_MENGE_"/"_$PIECE(POS(YI),Y,5)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . . . //IF DAT="" IF KURZWE=1  WRITE " TITLE="_""""_YLIEFERANT_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(32563)_": "_$$^WWWDATE(KWED)_$CHAR(13)_$$^WWWTEXT(32025)_":"_MENGE_"/"_$PIECE(POS(YI),Y,5)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . . . //IF DAT="" IF KURZWE=0  WRITE " TITLE="_""""_YLIEFERANT_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(32099)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . . . set fltRec = +$piece(POS(YI),Y,109) set:fltRec KURZWE=1
	. . . . write " TITLE="_""""_YLIEFERANT_$translate($piece(POS(YI),Y,4)_" "_$piece(POS(YI),Y,1),"""")_$char(13)_$$^WWWTEXT(32025)_":"_fltRec_"/"_$piece(POS(YI),Y,5) //Rec Qty/Total Qty
	. . . . //SR17141 ^^^^^^
	. . . ;
	. . . IF YZ=0 IF $PIECE(POS(YI),Y,7)=3 DO  ;TIPP FÜR DIE FERTIGUNGSWARE ;to who 
	. . . . IF DAT'="" WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWDATE(DAT)_" "_$$^WWWTIME($PIECE(DAT,",",2))   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . . . IF DAT=""  WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . ;
	. . ;vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv DISABLED BLOCK START
	. . ;IF YZ=0 IF $PIECE(POS(YI),Y,7)=1 DO  ;TIPP FÜR DIE LAGERWARE   ;WEM;24697;16.12.2003;OLD LINE
	. . ;. SET YLIEFERANT=""
	. . ;. IF $PIECE(POS(YI),Y,12)'="" SET YLIEFERANT=$EXTRACT($PIECE($GET(^INLIEF(YM,$PIECE(POS(YI),Y,12),1)),Y,8),1,17)_$CHAR(13)
	. . ;. IF DAT'=""             WRITE " TITLE="_""""_YLIEFERANT_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(32054)_": "_BETR_" - "_LAP_$CHAR(13)_$$^WWWTEXT(32025)_":"_MENGE_"/"_$PIECE(POS(YI),Y,5)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;campsite Date 
	. . ;. IF DAT="" IF KURZWE=1  WRITE " TITLE="_""""_YLIEFERANT_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(32563)_": "_$$^WWWDATE(KWED)_$CHAR(13)_$$^WWWTEXT(32025)_":"_MENGE_"/"_$PIECE(POS(YI),Y,5)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;stock location Date 
	. . ;. IF DAT="" IF KURZWE=0  WRITE " TITLE="_""""_YLIEFERANT_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(32099)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;stock location Date 
	. . ;
	. . ;IF YZ=0 IF $PIECE(POS(YI),Y,7)=3 DO  ;TIPP FÜR DIE FERTIGUNGSWARE  ;WEM;24697;16.12.2003;OLD LINE
	. . ;. IF DAT'="" WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWDATE(DAT)_" "_$$^WWWTIME($PIECE(DAT,",",2))   ;LAGERPLATZ DATUM DES WARENEINGANGES ;stock location Date 
	. . ;. IF DAT=""  WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)   ;LAGERPLATZ DATUM DES WARENEINGANGES ;stock location Date 
	. . ;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ DISABLED BLOCK END
	. . ; 
	. . IF YZ=0 IF $PIECE(POS(YI),Y,243)'="" WRITE $CHAR(13)_$$^WWWTEXT(32678)_$PIECE(POS(YI),Y,243)
	. . IF YZ=0 IF $PIECE(POS(YI),Y,242)'="" WRITE $CHAR(13)_$$^WWWTEXT(32677)_$PIECE(POS(YI),Y,242) 
	. . IF YZ=0 WRITE """"
	. . IF YZ=0 WRITE " HREF="
	. . ;IF YZ=0 IF $P(POS(YI),Y,205)=1 W "#"
	. . ;IF YZ=0 IF $P(POS(YI),Y,205)'=1 W """" DO
	. . IF YZ=0 WRITE """" DO
	. . . IF YZ=0 IF $PIECE(POS(YI),Y,7)=1 DO  ;LINK FÜR DIE LAGERWARE ;to who 
	. . . . DO   ;WEM;24697;16.12.2003;NEW LINE
	. . . . . NEW VAL
	. . . . . SET VAL=$$INAUFBANZ^INAUFPWECHECK(AUF,YI)
	. . . . . ;
	. . . . . IF VAL=1 DO
	. . . . . . IF KURZWE=1 IF $DATA(^INWEAUFVOR(YM,AUF,YI)) WRITE YAKTION_"EP=WWWFORM&YFORM=INWEAUFVOR&YKEY="_AUF_","_YI_","_BETR_","_LAP_","_KWED_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL QUIT  ;VORERFASSUNG BEARBEITEN;FIS;30.08.04;25661
	. . . . . . ;IF ALT'=1 WRITE YAKTION_"EP=WWWFORM&YFORM=INWEAUF&YKEY="_AUF_","_YI_","_BETR_","_LAP_","_DAT1_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION WE BEABEITEN ;In 
	. . . . . . //IF ALT'=1 do
	. . . . . . . //if (BETR'="")&&(LAP'="")&&(DAT1'="")&&$data(^INWEAUF(YM,AUF,YI,BETR,LAP,DAT1)) do  quit
	. . . . . . . . //WRITE YAKTION_"EP=WWWFORM&YFORM=INWEAUF&YKEY="_AUF_","_YI_","_BETR_","_LAP_","_DAT1_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;INWEAUF form
	. . . . . . .;WRITE YAKTION_"EP=WWWMANU&YFORM=INAUFBANZ&YEXEC=DO|GoToNewReceipt^INREC('"_AUF_"','"_YI_"')"  ;SR14421 INREC form
	. . . . . . WRITE YAKTION_"EP=WWWMANU&YFORM=INAUFBANZ&YEXEC=DO|GoToNewReceipt^INReceiptLink('"_AUF_"')"	//SR17162
	. . . . . . ;
	. . . . . . //IF ALT=1 WRITE YAKTION_"EP=WWWFORM&YFORM=INWEAUFALT&YKEY="_AUF_","_YI_","_BETR_","_LAP_","_DAT1_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION WE BEABEITEN ;In 
	. . . . . ;
	. . . . . IF VAL'=1 WRITE "#" QUIT
	. . . . ;
	. . . . ;IF ALT'=1 WRITE YAKTION_"EP=WWWFORM&YFORM=INWEAUF&YKEY="_AUF_","_YI_","_BETR_","_LAP_","_DAT1_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION WE BEABEITEN  ;WEM;24697;16.12.2003;OLD LINE
	. . . . ;IF ALT=1  WRITE YAKTION_"EP=WWWFORM&YFORM=INWEAUFALT&YKEY="_AUF_","_YI_","_BETR_","_LAP_","_DAT1_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION WE BEABEITEN  ;WEM;24697;16.12.2003;OLD LINE
	. . . ;
	. . . IF YZ=0 IF $PIECE(POS(YI),Y,7)=3 DO  ;LINK FÜR DIE EIGENFERTIGUNG ;to who 
	. . . . SET MENGE=+$PIECE(POS(YI),Y,5)
	. . . . IF $PIECE(POS(YI),Y,165)'="" IF $PIECE($GET(^INPROSTEMP(YM,$PIECE(POS(YI),Y,165),1)),Y,24)=1 SET DAT=" "  ;FERTIGMELDUNG MANUELL FERITGGESTELLT
	. . . . ;IF $PIECE(POS(YI),Y,164)=""  WRITE YAKTION_"EP=WWWFORM&YFORM=INPROSTEMP&YKEY="_$PIECE(POS(YI),Y,165)_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION FERTIGUNG BEABEITEN
	. . . . ;IF $PIECE(POS(YI),Y,164)'="" WRITE YAKTION_"EP=WWWFORM&YFORM=INPROSTEMP1&YKEY="_$PIECE(POS(YI),Y,165)_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION FERTIGUNG BEABEITEN
	. . . . IF $PIECE(POS(YI),Y,165)'="" IF $GET(^INPROSTEMP1(YM,$PIECE(POS(YI),Y,165),1))="" WRITE YAKTION_"EP=WWWFORM&YFORM=INPROSTEMP&YKEY="_$PIECE(POS(YI),Y,165)_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION FERTIGUNG BEABEITEN
	. . . . IF $PIECE(POS(YI),Y,165)'="" IF $GET(^INPROSTEMP1(YM,$PIECE(POS(YI),Y,165),1))'="" WRITE YAKTION_"EP=WWWFORM&YFORM=INPROSTEMP1&YKEY="_$PIECE(POS(YI),Y,165)_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;POSITION FERTIGUNG BEABEITEN
	. . . ;
	. . . IF YZ=0 SET YBACK="INAUFBANZ,"
	. . . IF YZ=0 DO ^WWWCGI
	. . . IF YZ=0 WRITE """"
	. . . IF YZ=0 QUIT
	. . ;
	. . IF YZ=0 WRITE ">"
	. . IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. . IF YZ=0 IF DAT="" WRITE "<FONT COLOR=RED SIZE=2>"   ;AUSLIEFERUNGSFÄHIG
	. . IF YZ=1 IF DAT="" SET RED(4)=$GET(RED(4))+1
	. . IF YZ=0 IF DAT'="" IF $DATA(^INWEAUF(YM,AUF,YI)) IF WEOK=0 WRITE "<FONT COLOR=BLUE SIZE=2>"     ;PRÜFUNG WAREEINGANGSMERKER ;quiz 
	. . IF YZ=1 IF DAT'="" IF $DATA(^INWEAUF(YM,AUF,YI)) IF WEOK=0 SET BLUE(4)=$GET(BLUE(4))+1 
	. . IF YZ=1 IF DAT'="" IF $DATA(^INWEAUF(YM,AUF,YI)) IF WEOK=1 SET BLACK(4)=$GET(BLACK(4))+1  
	. . IF YZ=1 IF DAT'="" IF $DATA(^INWEAUFALT(YM,AUF,YI)) SET BLACK(4)=$GET(BLACK(4))+1
	. . ;IF YZ=0 IF $PIECE($GET(^INVORG(YM,YM,1)),Y,62)'=1 IF KURZWE=1 WRITE "<FONT COLOR=SLATEGRAY SIZE=2>"     
	. . ;IF YZ=0 IF $GET(YINVORG(62))'=1 IF KURZWE=1 WRITE "<FONT COLOR=SLATEGRAY SIZE=2>"       
	. . IF YZ=0 IF KURZWE=1 WRITE "<FONT COLOR=SLATEGRAY SIZE=2>"       
	. . ;IF YZ=1 IF $PIECE($GET(^INVORG(YM,YM,1)),Y,62)'=1 IF KURZWE=1 SET GRAY(4)=$GET(GRAY(4))+1  
	. . ;IF YZ=1 IF $GET(YINVORG(62))'=1 IF KURZWE=1 SET GRAY(4)=$GET(GRAY(4))+1 ;table-mat 
	. . ;IF YZ=1 IF KURZWE=1 SET GRAY(4)=$GET(GRAY(4))+1 ;table-mat 
	. . IF YZ=0  WRITE "<FONT SIZE=2>"_YI_" "_"</FONT>"
	. . IF YZ=0 IF DAT="" WRITE "</FONT>"   ;AUSLIEFERUNGSFÄHIG
	. . IF YZ=0 IF DAT'="" IF $DATA(^INWEAUF(YM,AUF,YI)) IF WEOK=0 WRITE "</FONT>"
	. . ;IF YZ=0 IF $PIECE($GET(^INVORG(YM,YM,1)),Y,62)'=1 IF KURZWE=1 WRITE "</FONT>"  
	. . ;IF YZ=0 IF $GET(YINVORG(62))'=1 IF KURZWE=1 WRITE "</FONT>"  
	. . IF YZ=0 IF KURZWE=1 WRITE "</FONT>"          
	. . IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. . IF YZ=0 WRITE "</A>"
	
	IF YZ=1 IF +$GET(BLACK(4))>0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32642)_""""   ;BEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',4,1,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT SIZE=2>"  
	. WRITE +BLACK(4)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"  
	. WRITE "</A>"
	
	IF YZ=1 IF +$GET(BLUE(4))>0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32646)_""""   ;TEILBEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',4,3,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT FONT SIZE=2 COLOR=BLUE>"   
	. WRITE +BLUE(4)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"  
	. WRITE "</A>"
	
	IF YZ=1 IF +$GET(GRAY(4))>0 DO
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32646)_""""   ;TEILBEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',4,4,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT FONT SIZE=2 COLOR=SLATEGRAY>"   
	. WRITE +GRAY(4)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"   
	. WRITE "</A>"
	
	IF YZ=1 IF +$GET(RED(4))>0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32643)_""""   ;BEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',4,2,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT FONT SIZE=2 COLOR=RED>"   
	. WRITE +RED(4)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"   
	. WRITE "</A>"
	
	IF $PIECE($GET(^INAUF(YM,AUF,1)),Y,263)'="" WRITE $$^WWWTEXT(33297)  ;KOMMISSION ;errand 
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;IF +$PIECE(AUF1,Y,2)'=0 DO  QUIT   ;KEINE WEITERE BEARBEITUNG BEI EIGEN UND LIEFERANTENBESTELLUNG
	;. WRITE "</TR>"
	
	;+++++++++++++++++++++++++++++++++++++++
	;   IMPLICITLY DROPS THROUGH TO TO
	;+++++++++++++++++++++++++++++++++++++++
	
TO
	;-------------------------------------------------------------------------------
	;		(*11*) Traffic
	;		TOUR GEPLANT? AUSLIEFERUNGSFÄHIG
	; History:
	; 06-Dec-2006	GRF		SR15272: Remove Duplicate <TD opening
	; 21-Dec-2005	Steve S	SR13993: Check tour date
	;-------------------------------------------------------------------------------
	;WRITE "<TD NOWRAP VALIGN=TOP"              ; SR15272
	WRITE "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF  IF YZ=0                            WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YZ=0             IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR="" IF YLEAUF=AUF                 WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YZ=1 IF COLOR="" IF YLEAUF'=AUF IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR'=""                              WRITE " BGCOLOR="_""""_COLOR_""""
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	SET YII=-1
	
	;IF +$PIECE(AUF1,Y,2)=0 SET YI="" FOR  SET YI=$ORDER(POS(YI)) QUIT:YI=""  DO  ;FIS;13.05.03;23614;<STORE> ERROR
	IF +$PIECE(AUF1,Y,2)=0 SET YI="" FOR  SET YI=$ORDER(^WWWSOR(YUSER,"POS",YI)) QUIT:YI=""  DO  KILL POS(YI)
	. SET POS(YI)=$GET(^WWWSOR(YUSER,"POS",YI))
	. NEW DATE,TOUR
	. ;IF $PIECE(POS(YI),Y,7)'=2 QUIT:$PIECE(POS(YI),Y,90)'=1   ;NICHT AUSLIEFERFÄHIG
	. IF $PIECE(POS(YI),Y,7)=1 IF ($PIECE(POS(YI),Y,241)=$$$YES) || ($PIECE(AUF1,Y,215)=$$$YES) QUIT   ;FIS;08.08.03;DIREKTLIEFERUNG VON LIEFERANT ;supplier 
	. IF $PIECE(POS(YI),Y,7)'=2 IF $PIECE(POS1,Y,4)'="" IF '$DATA(^INDRPITEM(YM,YLOCATION,$PIECE(POS1,Y,4))) QUIT:$PIECE(POS(YI),Y,90)'=1   ;NICHT AUSLIEFERFÄHIG ;Not 
	. IF YZ=0 SET YII=YII+1
	. IF YZ=0 IF YII'=0 IF YII#6=0 WRITE "<BR>"
	. IF YZ=0 WRITE YCR,"<A"
	. SET TOUR=$PIECE(POS(YI),Y,95)
	. SET DATE=""
	. ;SR13993: Check Tour Date
	. IF $PIECE(POS(YI),Y,76)'="" SET DATE=$$^WWWDATE($PIECE(POS(YI),Y,76)) IF DATE'="" if $$IncludeTour^INTOURCHECK($PIECE(POS(YI),Y,76)) SET ^INTOUR(YM,$PIECE(POS(YI),Y,76),1)=""  ;AUSLIEFERUNGSDATUM
	. IF YZ=0 IF $PIECE(POS(YI),Y,76)'="" WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_DATE_" "_$$^WWWTEXT(32046)_": "_TOUR_""""   ;DATUM TOUR ;Date voyage 
	. IF YZ=0 IF $PIECE(POS(YI),Y,76)=""  WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(32100)_""""  ;Tourenplanung ;Trafic Planning 
	. IF YZ=0 WRITE " HREF="
	. IF YZ=0 IF $PIECE(POS(YI),Y,205)=$$$YES WRITE "#"         ; Line-Item Barrier
	. IF YZ=0 IF $PIECE(POS(YI),Y,205)'=$$$YES DO
	. . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFTO&YKEY="_AUF_","_YI_"&YAUSWAHL="_DATE_"&YSORTBY="_YSORTBY  ;TOURENPLANUNG
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. IF YZ=0 WRITE ">"
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "<STRIKE>"  ;GESPERRT ;DISABLED (Block Purchase Order or Line-Item Barrier)
	. IF YZ=0 IF DATE="" IF $PIECE(POS(YI),Y,90)=1 WRITE "<FONT COLOR=RED>"        ;AUSLIEFERUNGSFÄHIG ABER KEINE TOUR ;yet no voyage 
	. IF YZ=0 IF DATE=""                           WRITE "<FONT COLOR=RED>"
	. IF YZ=1 IF DATE=""  IF $PIECE(POS(YI),Y,90)=1 SET RED(5)=$GET(RED(5))+1       ; Ready For Delivery
	. IF YZ=1 IF DATE'="" IF $PIECE(POS(YI),Y,90)=1 SET BLACK(5)=$GET(BLACK(5))+1
	. IF YZ=0 WRITE YI
	. IF YZ=0 IF DATE="" IF $PIECE(POS(YI),Y,90)=1 WRITE "</FONT>"   ;AUSLIEFERUNGSFÄHIG ABER KEINE TOUR ;yet no voyage 
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "</STRIKE>"
	. IF YZ=0 WRITE "</A>"
	. ;INFO BEIM VERSANDT
	. IF YZ=0 SET TRACK=$PIECE(POS(YI),Y,104)  ;TRACKING NUMMER ;numeral 
	. IF YZ=0 IF TRACK'="" DO
	. . NEW URL,VERSAND
	. . SET VERSAND=$PIECE(POS(YI),Y,95)  ;VERSENDER
	. . IF VERSAND'="" DO
	. . . SET URL=$PIECE($GET(^INSPED(YM,VERSAND,1)),Y,27)  ;TRACKING URL
	. . . IF URL'="" DO
	. . . . SET URL=URL_TRACK
	. . . . WRITE "<A HREF="_""""
	. . . . WRITE URL
	. . . . WRITE """"
	. . . . WRITE " TARGET=ARTTIKELINFO"
	. . . . WRITE ">"
	. . . . WRITE YCR,"<IMG SRC="_""""_YGIF_"left.gif"_""""_" BORDER=0 TITLE='tracking'></A>"
	. . . . WRITE "&nbsp;"
	
	IF YZ=1 IF +$GET(BLACK(5))>0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32642)_""""   ;BEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',5,1,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT SIZE=2>"   
	. WRITE +BLACK(5)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"   
	. WRITE "</A>"
	
	IF YZ=1 IF +$GET(RED(5))>0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32643)_""""   ;BEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',5,2,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT FONT SIZE=2 COLOR=RED>"   
	. WRITE +RED(5)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<]]><![CDATA[/FONT>"   
	. WRITE "</A>"
	
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;+++++++++++++++++++++++++++++++++++++++
	;   IMPLICITLY DROPS THROUGH TO LE
	;+++++++++++++++++++++++++++++++++++++++
	
LE
	;-------------------------------------------------------------------------------
	;		(*12*) Delivery Note
	;		Lieferschein gedruckt?
	; 
	; History:
	; 06-Dec-2006	GRF		SR15272: Remove Duplicate <TD opening
	;-------------------------------------------------------------------------------
	;WRITE "<TD NOWRAP VALIGN=TOP"      ; SR15272
	WRITE "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF  IF YZ=0                            WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YZ=0             IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR="" IF YLEAUF=AUF                 WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YZ=1 IF COLOR="" IF YLEAUF'=AUF IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR'=""                              WRITE " BGCOLOR="_""""_COLOR_""""
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	SET YII=-1
	
	; Customer Order			D2	$$$INAUFOrderType()
	;---------------------------------------
	IF +$PIECE(AUF1,Y,2)=0 SET YI="" FOR  SET YI=$ORDER(^WWWSOR(YUSER,"POS",YI)) QUIT:YI=""  DO  KILL POS(YI)  ;FIS;13.05.03;23614;<STORE> ERROR
	. SET POS(YI)=$GET(^WWWSOR(YUSER,"POS",YI))
	. NEW LIEFERD
	. QUIT:$PIECE(POS(YI),Y,7)=""        ; Unsourced
	. QUIT:$PIECE(POS(YI),Y,309)=$$$YES  ; No Delivery Note   ;LIEFERSCHEIN UNTERDRÜCKEN ;packing slip stifle
	. IF $PIECE(POS(YI),Y,7)=1 IF ($PIECE(POS(YI),Y,241)=$$$YES) || ($PIECE(AUF1,Y,215)=$$$YES) QUIT   ;FIS;08.08.03;DIREKTLIEFERUNG VON LIEFERANT ;supplier 
	. IF $PIECE(POS(YI),Y,7)'=2 QUIT:$PIECE(POS(YI),Y,90)'=$$$YES     ; Not "Ready for Delivery"   ;NICHT AUSLIEFERFÄHIG
	. IF YZ=0 SET YII=YII+1
	. IF YZ=0 IF YII'=0 IF YII#6=0 WRITE "<BR>"      
	. IF YZ=0 WRITE YCR
	. IF YZ=0 WRITE "<A"
	. SET LIEFERD=$PIECE(POS(YI),Y,92)                     ; Delivery Note Printed Date
	. ;
	. IF YZ=0 IF LIEFERD'="" WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWDATE(LIEFERD)_""""   ;DATUM LIEFERSCHEINDRUCK ;Date 
	. IF YZ=0 IF LIEFERD=""  WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(374)_""""   ;AUFTRAGSPOSITION BEARBEITEN
	. IF YZ=0 WRITE " HREF="
	. IF YZ=0 IF $PIECE(POS(YI),Y,205)=$$$YES WRITE "#"    ; Line Item-Barrier
	. IF YZ=0 IF $PIECE(POS(YI),Y,205)'=$$$YES DO
	. . NEW YPRINT
	. . IF $PIECE(POS(YI),Y,123)<0 WRITE "#"               ; Net Sales Price
	. . IF $PIECE(POS(YI),Y,123)'<0 DO
	. . . WRITE """"
	. . . WRITE "JAVASCRIPT:if (confirm('"_$$^WWWTEXT(32153)_"')) window.location='"
	. . . WRITE YAKTION_"EP=WWWMANU&YEXEC=DO|GESAMT^INAUFLI1&YFORM=INAUFLI&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;LIEFERSCHEIN NEU ;packing slip recent 
	. . . SET YBACK="INAUFBANZ,"
	. . . DO ^WWWCGI
	. . . WRITE "';"
	. . . WRITE " else window.location='"
	. . . WRITE YAKTION_"EP=WWWMANU&YEXEC=DO|WIEDERHOLUNG^INAUFLI1&YFORM=INAUFLI1&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;LIEFERSCHEIN WIEDERHOLUNG ;packing slip repetition 
	. . . SET YBACK="INAUFBANZ,"
	. . . DO ^WWWCGI
	. . . WRITE "';"
	. . . WRITE """"
	. ;
	. IF YZ=0 WRITE ">"
	. IF YZ=0 IF LIEFERD="" WRITE "<FONT COLOR=RED>"    ;AUSLIEFERUNGSFÄHIG ABER KEIN LIEFERSCHEIN ;yet no packing slip 
	. IF YZ=1 IF LIEFERD=""                              SET RED(6)  =$GET(RED(6))+1
	. IF YZ=1 IF $PIECE(POS(YI),Y,123)'<0 IF LIEFERD'="" SET BLACK(6)=$GET(BLACK(6))+1             ;AUSLIEFERUNGSFÄHIG ABER KEIN LIEFERSCHEIN ;yet no packing slip 
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=$$$YES) || ($PIECE(POS(YI),Y,205)=$$$YES) WRITE "<STRIKE>"     ;GESPERRT ;DISABLED (Block Purchase Order)
	. IF YZ=0 IF $PIECE(POS(YI),Y,123)'<0 WRITE YI                                                 ;NUR WENN KEINE GUTSCHRIFT ;only when no 
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=$$$YES) || ($PIECE(POS(YI),Y,205)=$$$YES) WRITE "</STRIKE>"  
	. IF YZ=0 IF LIEFERD="" WRITE "</FONT>" 
	. IF YZ=0 WRITE "</A>"
	
	IF YZ=1 IF +$GET(BLACK(6))>0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32642)_""""   ;BEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',6,1,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=$$$YES WRITE "<STRIKE>"  ;GESPERRT ;"Block Purchase Order" DISABLED 
	. WRITE "<FONT SIZE=2>"   
	. WRITE +BLACK(6)_" "
	. IF $PIECE(AUF1,Y,38)=$$$YES WRITE "</STRIKE>" 
	. WRITE "</FONT>"   
	. WRITE "</A>"
	
	IF YZ=1 IF +$GET(RED(6))>0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32643)_""""   ;BEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',6,2,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. 
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT FONT SIZE=2 COLOR=RED>"   
	. WRITE +RED(6)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"  
	. WRITE "</A>"
	
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;+++++++++++++++++++++++++++++++++++++++
	;   IMPLICITLY DROPS THROUGH TO AR
	;+++++++++++++++++++++++++++++++++++++++
	
AR
	;-------------------------------------------------------------------------------
	;		(*13) Invoice         (Sales Calculation printed? Transferred to Finance?)
	;		AUSGANGSRECHNUNG GEDRUCKT? IN FIBU ÜBERTRAGEN?
	;
	; History :
	; 07-Apr-2006	RPW		SR14502: Invoicing now goes back to the order
	;-------------------------------------------------------------------------------
	WRITE "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF  IF YZ=0                            WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YZ=0             IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR="" IF YLEAUF=AUF                 WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YZ=1 IF COLOR="" IF YLEAUF'=AUF IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR'="" WRITE " BGCOLOR="_""""_COLOR_""""
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	SET YII  = -1
	SET YIII = 0  ;PRÜFEN OB POSITION VORHANDEN ;check whether on hand 
	
	; Customer Order			D2	$$$INAUFOrderType()
	;---------------------------------------
	;IF +$PIECE(AUF1,Y,2)=0 SET YI="" FOR  SET YI=$ORDER(POS(YI)) QUIT:YI=""  DO  ;FIS;13.05.03;23614;<STORE> ERROR
	IF +$PIECE(AUF1,Y,2)=0 SET YI="" FOR  SET YI=$ORDER(^WWWSOR(YUSER,"POS",YI)) QUIT:YI=""  DO  KILL POS(YI)
	. SET POS(YI)=$GET(^WWWSOR(YUSER,"POS",YI))
	. NEW RECHN,DATE
	. ;
	. ;QUIT:$PIECE(POS(YI),Y,7)=""
	. IF $PIECE(POS(YI),Y,5)>0 IF $PIECE(POS(YI),Y,97)="" QUIT:$PIECE(POS(YI),Y,7)=""  ;KEINE WARENHERKUNFT BEI RETOURLIEFERUNGEN ;FIS;11.10.2001 ;no next to 
	. IF $PIECE(POS(YI),Y,5)>0 IF $PIECE(POS(YI),Y,97)="" IF $PIECE(POS(YI),Y,7)'=2 QUIT:$PIECE(POS(YI),Y,90)'=$$$YES   ;NICHT AUSLIEFERFÄHIG ;Not 
	. ;IF $PIECE(POS(YI),Y,123)'<0 IF $PIECE(POS(YI),Y,90)=1 IF $PIECE(POS(YI),Y,97)="" QUIT:$PIECE(POS(YI),Y,92)=""   ;NICHT VERFÜGBAR UND NOCH NICHT AUSGELIEFERT ODER BERECHNET
	. IF $PIECE(POS(YI),Y,123)'<0 IF $PIECE(POS(YI),Y,90)=$$$YES IF $PIECE(POS(YI),Y,97)="" IF $PIECE(POS(YI),Y,309)'=$$$YES QUIT:$PIECE(POS(YI),Y,92)=""   ;NICHT VERFÜGBAR UND NOCH NICHT AUSGELIEFERT ODER BERECHNET ;Not available And yet Not Or 
	. ;QUIT:$PIECE(POS(YI),Y,76)>(+$H+3)   ;EINGETEILT ABER NOCH NICHT AUSGELIEFERT DATUM
	. ;
	. IF YZ=0 SET YII=YII+1
	. IF YZ=0 IF YII'=0 IF YII#6=0 WRITE "<BR>" 
	. IF YZ=0 WRITE YCR
	. IF YZ=0 IF ($$^WWWACCESS("",$GET(YINVORG(29)))=$$$OK) || ($$^WWWACCESS("",$GET(YINVORG(30)))=$$$OK) DO   ;BERECHTIGUNG ;authorised
	. . IF +$PIECE(AUF1,Y,169)=$$$NO IF $$^WWWACCESS("",$GET(YINVORG(29)))'=$$$OK QUIT         ;NUR REKLA BERECHTIGUNG ;Not a Complaint/Spare Part-Order 
	. . WRITE "<A"
	. . SET RECHN=$PIECE(POS(YI),Y,96)  ;RECHNUNGSNUMMER
	. . SET DATE=""
	. . IF RECHN=""  WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_$$^WWWTEXT(374)_""""   ;AUFTRAG BEARBEITEN ;order 
	. . IF RECHN'="" SET DATE=$$^WWWDATE($PIECE(POS(YI),Y,97))   ;RECHNUNGSDATUM ;date of invoice 
	. . IF RECHN'="" WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_DATE_" #: "_RECHN_" = "_$$^WWWZAHL($PIECE(POS(YI),Y,119),0,2,YWHR)_""""   ;DATUM DES RECHNUNG ;Date tab 
	. . WRITE " HREF="
	. . IF $PIECE(POS(YI),Y,205)=$$$YES  WRITE "#"              ; Line Item-Barrier
	. . IF $PIECE(POS(YI),Y,205)'=$$$YES WRITE """" DO
	. . . ;NEW YPRINT
	. . . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUF&YKEY="_AUF_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL     ;bec;26998;15.12.04; // SR14502
	. . . SET YBACK="INAUFBANZ," // SR14502
	. . . DO ^WWWCGI // SR14502
	. . . ;WRITE "JAVASCRIPT:if (confirm('"_$$^WWWTEXT(32153)_"')) window.location='" // SR14502
	. . . ;WRITE YAKTION_"EP=WWWMANU&YEXEC=DO|GESAMT^INRECH1&YFORM=INRECH&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;AUFTRAGSBEARBEITUNG ;sales order processing  // SR14502
	. . . ;SET YBACK="INAUFBANZ," // SR14502
	. . . ;DO ^WWWCGI // SR14502
	. . . ;WRITE "';" // SR14502
	. . . ;WRITE " else window.location='" // SR14502
	. . . ;WRITE YAKTION_"EP=WWWMANU&YEXEC=DO|WIEDERHOLUNG^INRECH1&YFORM=INRECH1&YKEY="_AUF_","_YI_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;AUFTRAGSBEARBEITUNG ;sales order processing  // SR14502
	. . . ;SET YBACK="INAUFBANZ," // SR14502
	. . . ;DO ^WWWCGI // SR14502
	. . . ;WRITE "';" // SR14502
	. . . WRITE """"
	. . WRITE ">"
	. ;
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=$$$YES) || ($PIECE(POS(YI),Y,205)=$$$YES) WRITE "<STRIKE>"  ;GESPERRT ; "Block Purchase Order" or "Line Item-Barrier" DISABLED 
	. IF YZ=0 IF $PIECE(POS(YI),Y,96)="" WRITE "<FONT COLOR=RED>"                               ;EINGETEILT ABER NICHT BERECHNET ;no Invoice Number 
	. IF YZ=1 IF $PIECE(POS(YI),Y,96)=""  SET RED(7)  =$GET(RED(7))+1
	. IF YZ=1 IF $PIECE(POS(YI),Y,96)'="" SET BLACK(7)=$GET(BLACK(7))+1
	. IF YZ=0 WRITE YI_" "
	. IF $PIECE(POS(YI),Y,96)'="" SET YIII=YIII+1                                               ;ANZAHL GEDRUCKT POSITIONEN ;Number 
	. IF YZ=0 IF $PIECE(POS(YI),Y,96)="" WRITE "</FONT>"
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=$$$YES) || ($PIECE(POS(YI),Y,205)=$$$YES) WRITE "</STRIKE>"
	. IF YZ=0 IF ($$^WWWACCESS("",$GET(YINVORG(29)))=$$$OK) || ($$^WWWACCESS("",$GET(YINVORG(30)))=$$$OK) DO   ;BERECHTIGUNG ;authorised
	. . IF +$PIECE(AUF1,Y,169)=$$$NO IF $$^WWWACCESS("",$GET(YINVORG(29)))'=$$$OK QUIT                         ;NUR REKLA BERECHTIGUN
	. . WRITE "</A>"
	
	IF YIII=0 DO  ;KEINE A-RECHNUNG GEDRUCK = PRÜFEN OB TEILZAHLUNGSRECHNUNG VORHANDEN ;FIS, 22.11.01
	. NEW TEILZ,ZDAT
	. SET TEILZ=""
	. SET ZDAT=""
	. FOR  SET ZDAT=$ORDER(^INAUFPZ(YM,AUF,ZDAT)) QUIT:ZDAT=""  DO
	. . IF $PIECE($GET(^INAUFPZ(YM,AUF,ZDAT,1)),Y,4)'="" SET TEILZ=TEILZ_YCR_$$^WWWDATE($PIECE(^INAUFPZ(YM,AUF,ZDAT,1),Y,4))
	. ;
	. IF TEILZ'="" DO  ;TEILZAHLUNGERECHNUNGEN
	. . NEW YKEY,YFORM
	. . WRITE "<A HREF="_""""
	. . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUFPZ&YKEY="_AUF
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32336)_TEILZ_""""_">"
	. . WRITE "<FONT COLOR=BLUE>0 </FONT>"
	. . WRITE "</A>"
	
	IF YZ=1 IF +$GET(BLACK(7))>0 DO
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32642)_""""   ;BEARBEITEN
	. . WRITE " HREF="_""""
	. . ;WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',7,1,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ" // SR14502
	. . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUF&YKEY="_AUF_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL     ;bec;26998;15.12.04; // SR14502
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . ;WRITE " TARGET=TEILEFRAME2>"
	. . WRITE ">"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT SIZE=2>"   
	. WRITE +BLACK(7)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"   
	. WRITE "</A>"
	
	IF YZ=1 IF +$GET(RED(7))>0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32643)_""""   ;UNBEARBEITEN
	. . WRITE " HREF="_""""
	. . ;WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',7,2,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ" // SR14502
	. . WRITE YAKTION_"EP=WWWFORM&YFORM=INAUF&YKEY="_AUF_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL     ;bec;26998;15.12.04; // SR14502
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . ;WRITE " TARGET=TEILEFRAME2>"
	. . WRITE ">"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT FONT SIZE=2 COLOR=RED>"   
	. WRITE +RED(7)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"   
	. WRITE "</A>"
	
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;+++++++++++++++++++++++++++++++++++++++
	;   IMPLICITLY DROPS THROUGH TO ER
	;+++++++++++++++++++++++++++++++++++++++
	
ER
	;-------------------------------------------------------------------------------
	;		(*14*) I-Inv.     Purchase Invoice
	;		EINGANGSRECHNUNG
	;-------------------------------------------------------------------------------
	NEW RENR,REOK,LIEF,REM
	
	WRITE "<TD NOWRAP VALIGN=TOP"
	IF YLEAUF=AUF  IF YZ=0                            WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YLEAUF'=AUF IF YZ=0             IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR="" IF YLEAUF=AUF                 WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	IF YZ=1 IF COLOR="" IF YLEAUF'=AUF IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	IF YZ=1 IF COLOR'=""                              WRITE " BGCOLOR="_""""_COLOR_""""
	WRITE ">"
	WRITE "<FONT SIZE=2>"
	SET YII=-1
	
	;SET YI="" FOR  SET YI=$ORDER(POS(YI)) QUIT:YI=""  DO
	SET YI="" FOR  SET YI=$ORDER(^WWWSOR(YUSER,"POS",YI)) QUIT:YI=""  DO  KILL POS(YI)  ;FIS;13.05.03;23614;<STORE> ERROR
	. SET POS(YI)=$GET(^WWWSOR(YUSER,"POS",YI))
	. NEW LIEFER,RECHN
	. IF $PIECE(POS(YI),Y,7)'=1 QUIT  ;NUR BEI BESTELLUNGEN ;only next to 
	. IF $PIECE(POS(YI),Y,83)="" IF '$DATA(^INWEAUF(YM,AUF,YI)) QUIT   ;NOCH NICHT BESTELLT;ABER SCHON WE;TYBD;7,10,2004
	. IF $PIECE(POS(YI),Y,60)=1  IF $PIECE(POS(YI),Y,217)'=""   QUIT   ;MANUELL ABGESCHLOSSEN
	. IF YZ=0 SET YII=YII+1
	. IF YZ=0 IF YII'=0 IF YII#6=0 WRITE "<BR>" 
	. IF YZ=0 WRITE YCR
	. IF YZ=0 WRITE "<A"
	. SET LIEFER=""
	. SET RECHN=""
	. ;SET LIEFER=$ORDER(^INERECH1(YM,AUF,YI,""),-1)  ;LETZTER LIEFERANT
	. ;IF LIEFER'="" SET RECHN=$ORDER(^INERECH1(YM,AUF,YI,LIEFER,""),-1)  ;LETZTE RECHNUNGSNUMMER
	. DO                                  ;FIS ;NUR WARENLIEFERANTEN;08.09.04;25736
	. . NEW LIEFER1,RECH1
	. . SET LIEFER1=""
	. . FOR  SET LIEFER1=$ORDER(^INERECH1(YM,AUF,YI,LIEFER1),-1) QUIT:LIEFER1=""  DO  QUIT:LIEFER'=""  ;LETZTER WAREN-LIEFERANT ;last 
	. . . SET RECH1=""
	. . . FOR  SET RECH1  =$ORDER(^INERECH1(YM,AUF,YI,LIEFER1,RECH1),-1) QUIT:RECH1=""  DO  QUIT:LIEFER'=""
	. . . . IF $PIECE($GET(^INERECH1(YM,AUF,YI,LIEFER1,RECH1,1)),Y,80)="" SET LIEFER=LIEFER1,RECHN=RECH1
	. ;
	. IF YZ=0 WRITE " TITLE="_""""_$TRANSLATE($PIECE(POS(YI),Y,4)_" "_$PIECE(POS(YI),Y,1),"""")_$CHAR(13)_"#:"_RECHN_""""   ;EINGANGSRECHNUNG
	. IF YZ=0 WRITE " HREF="_""""
	. ; 
	. ; FIXME : Should disable or redirect this link <GRF> BR014242
	. ; 
	. IF YZ=0 WRITE YAKTION_"EP=WWWFORM&YFORM=INERECH1"_"&YKEY="_AUF_","_YI_","_LIEFER_","_$TRANSLATE(RECHN,"#","~")_"&YFKEY="_AUF_","_YI_","_LIEFER_"&YSORTBY="_YSORTBY_"&YAUSWAHL="_YAUSWAHL  ;UEBERTRAG IN FIBU ;within 
	. IF YZ=0 SET YBACK="INAUFBANZ,"
	. IF YZ=0 DO ^WWWCGI
	. IF YZ=0 WRITE """"_">"
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. SET REOK=0
	. IF YZ=0 IF '$DATA(^INERECH1(YM,AUF,YI)) || (LIEFER="") WRITE "<FONT COLOR=RED>"   ;KEINE EINGANGSRECHNUNG ;no 
	. IF YZ=1 IF '$DATA(^INERECH1(YM,AUF,YI)) || (LIEFER="") SET RED(8)=$GET(RED(8))+1
	. IF $DATA(^INERECH1(YM,AUF,YI)) DO
	. . SET LIEF=""
	. . FOR  SET LIEF=$ORDER(^INERECH1(YM,AUF,YI,LIEF)) QUIT:LIEF=""  DO
	. . . SET RENR=""
	. . . FOR  SET RENR=$ORDER(^INERECH1(YM,AUF,YI,LIEF,RENR)) QUIT:RENR=""  DO
	. . . . QUIT:$PIECE(^INERECH1(YM,AUF,YI,LIEF,RENR,1),Y,80)'=""  ;SERVICE RECHNUNG;FIS;08.09.04;25736
	. . . . SET REM=$PIECE(^INERECH1(YM,AUF,YI,LIEF,RENR,1),Y,24)
	. . . . IF REM'="" IF $PIECE($GET(^INERECHMERKER(YM,REM,1)),Y,2)=1 SET REOK=1
	. ;
	. IF YZ=0 IF $DATA(^INERECH1(YM,AUF,YI)) && (LIEFER'="") IF REOK=0 WRITE "<FONT COLOR=BLUE>"   ; EINGANGSRECHNUNG NICHT VOLLSTÄTIGEN MENGE ;Not quantity 
	. IF YZ=1 IF $DATA(^INERECH1(YM,AUF,YI)) && (LIEFER'="") IF REOK=0 SET BLUE(8)=$GET(BLUE(8))+1
	. IF YZ=1 IF $DATA(^INERECH1(YM,AUF,YI)) && (LIEFER'="") IF REOK=1 SET BLACK(8)=$GET(BLACK(8))+1
	. IF YZ=0 WRITE YI_" "
	. IF YZ=0 IF $DATA(^INERECH1(YM,AUF,YI)) && (LIEFER'="") IF REOK=0 WRITE "</FONT>"   ;KEINE EINGANGSRECHNUNG ;no 
	. IF YZ=0 IF '$DATA(^INERECH1(YM,AUF,YI)) || (LIEFER="")   WRITE "</FONT>"        ;KEINE EINGANGSRECHNUNG ;no 
	. IF YZ=0 IF ($PIECE(AUF1,Y,38)=1) || ($PIECE(POS(YI),Y,205)=1) WRITE "</STRIKE>"      ;GESPERRT ;DISABLED 
	. IF YZ=0 WRITE "</A>"
	
	IF YZ=1 IF +$GET(BLACK(8))'=0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32642)_""""   ;BEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',8,1,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT SIZE=2>"   ;WARENHERKUNFT NICHT GEGEBEN ;Not 
	. WRITE +BLACK(8)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"   ;WARENHERKUNFT NICHT GEGEBEN ;Not 
	. WRITE "</A>"
	
	IF YZ=1 IF +$GET(BLUE(8))'=0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32646)_""""   ;TEILBEARBEITEN    "Subset Of Status"
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',8,3,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. ;
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "<FONT SIZE=2 COLOR=BLUE>"   
	. WRITE +BLUE(8)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"  ;GESPERRT ;DISABLED 
	. WRITE "</FONT>"   
	. WRITE "</A>"
	
	IF YZ=1 IF +$GET(RED(8))'=0 DO  
	. WRITE YCR
	. DO
	. . WRITE "<A "
	. . WRITE " TITLE="_""""_$$^WWWTEXT(32643)_""""   ;UNBEARBEITEN
	. . WRITE " HREF="_""""
	. . WRITE YAKTION_"EP=WWWMANU&YEXEC=D|^INAUFBANZPOS('"_AUF_"',8,2,'"_YSORTBY_"','"_YAUSWAHL_"')"_"&YFORM=INAUFBANZ"
	. . SET YBACK="INAUFBANZ,"
	. . DO ^WWWCGI
	. . WRITE """"
	. . WRITE " TARGET=TEILEFRAME2>"
	. 
	. IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"   ;GESPERRT ;DISABLED 
	. WRITE "<FONT FONT SIZE=2 COLOR=RED>"  
	. WRITE +RED(8)_" "
	. IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>" 
	. WRITE "</FONT>"   
	. WRITE "</A>"
	
	WRITE "&nbsp;"
	WRITE "</TD>",YCR
	
	;+++++++++++++++++++++++++++++++++++++++
	; (*15*) Total Price (Access Restricted)      ; GESAMTBETRAG
	;+++++++++++++++++++++++++++++++++++++++
	
	;IF $$^WWWACCESS("",$PIECE($GET(^INVORG(YM,YM,1)),Y,22))=1 DO   ;KEINE BERECHTIGUNG
	IF $$^WWWACCESS("",$GET(YINVORG(22)))=$$$OK DO   ;KEINE BERECHTIGUNG ;no 
	. NEW KAA
	. WRITE "<TD NOWRAP VALIGN=TOP ALIGN=RIGHT"
	. IF YLEAUF=AUF                 WRITE " BGCOLOR=LIGHTGOLDENRODYELLOW"
	. IF YLEAUF'=AUF IF YDDSATZ#2=1 WRITE " BGCOLOR="_YWHITE
	. WRITE ">"
	. WRITE "<FONT SIZE=2>"
	. SET UNTER=1
	. SET KAA="-"
	. IF +MINDAUFSCHLAG=0 SET UNTER=0               ;KEINE AUSWERTUNG ;no 
	. IF +GESAMT'=0 IF +SELBSTKOST'=0 DO
	. . SET KAA=$JUSTIFY((GESAMT/SELBSTKOST)-1*100,0,2)
	. . IF KAA>MINDAUFSCHLAG SET UNTER=0            ;GENUG KALULIERT ;sufficiently 
	. ;
	. IF +$PIECE(AUF1,Y,2)=0 DO 
	. . WRITE "<A"
	. . IF UNTER'=1 WRITE " TITLE="_""""_"("_$$^WWWZAHL(KAA,0,2)_")"_""""                      ;UNTERKALULIERTE WARE ;wares 
	. . IF UNTER=1  WRITE " TITLE="_""""_$$^WWWTEXT(32156)_" ("_$$^WWWZAHL(KAA,0,2)_")"_""""   ;UNTERKALULIERTE WARE ;wares 
	. . WRITE " HREF=#>"
	. . IF UNTER=1 WRITE "<FONT COLOR=RED>"        ;KEIN BETRAG VORHANDEN ;no Sum on hand 
	. . IF $PIECE(AUF1,Y,38)=1 WRITE "<STRIKE>"    ;GESPERRT ;DISABLED 
	. . IF +GESAMT'=0 WRITE $$^WWWZAHL(GESAMT,0,2)
	. . IF $PIECE(AUF1,Y,38)=1 WRITE "</STRIKE>"   ;GESPERRT ;DISABLED 
	. . IF $PIECE(AUF1,Y,38)'=1 SET TOTAL=$GET(TOTAL)+GESAMT
	. . IF UNTER=1 WRITE "</FONT COLOR>"           ;KEIN BETRAG VORHANDEN ;no Sum on hand 
	. . WRITE "</A>"
	. ;
	. WRITE "&nbsp;"
	. WRITE "</TD>"
	
	WRITE YCR
	WRITE "</TR>"
	KILL ^WWWSOR(YUSER,"POS")
	
	QUIT
	
	;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	
OK(PARA)
	;-------------------------------------------------------------------------------
	;		ALLES OK
	; History:
	; 17-Jul-2007	GRF		SR15572: Naked Reference - use strSupBlanketOrder
	; 13-Dec-2004	TYBD	AUFTRAG SOFORT ERLEDIGT;26704
	;-------------------------------------------------------------------------------
	NEW POSX1,POSX,YVOR
	
	;AUFTRAG SOFORT ERLEDIGT
	SET POSX="" FOR  SET POSX=$ORDER(^INAUFP(YM,AUF,POSX)) QUIT:POSX=""  DO  ;DUCHSUCHEN DER POSITIONEN ;the 
	. SET POSX1=$GET(^INAUFP(YM,AUF,POSX,1))
	. IF PARA=2 IF $PIECE(POSX1,Y,12)="" QUIT 
	. IF PARA=2 IF $PIECE(AUF1,Y,1)'="" do
	. . new strSupBlanketOrder
	. . set strSupBlanketOrder = $PIECE($GET(^INKUNDELIEF(YM,$PIECE(AUF1,Y,1),$PIECE(POSX1,Y,12),1)),Y,34)
	. . IF strSupBlanketOrder'="" IF $PIECE($GET(^INRAHMEN(YM,strSupBlanketOrder,1)),Y,245)=1 SET PARA=1  ;RAHMENVERTRAGS=ERLEDIG ; SR15572 Naked Ref
	. IF PARA=2 IF $PIECE($GET(^INLIEF(YM,$PIECE(POSX1,Y,12),1)),Y,245)'=1 QUIT  ;NICHT ALLE ERLEDIGT
	. QUIT:$PIECE(POSX1,Y,83)=""                       ;NOCH NICHT BESTELLT
	. QUIT:$PIECE(POSX1,Y,91)'=""                      ;SCHON OK 
	. SET $PIECE(POSX1,Y,90)=1                         ;AUSLIEFERFÄHIG
	. SET $PIECE(POSX1,Y,91)="AUTO"                    ;LIEFERSCHEIN
	. SET $PIECE(POSX1,Y,92)=+$HOROLOG                 ;DRUCKDATUM
	. SET $PIECE(POSX1,Y,93)=$PIECE($HOROLOG,",",2)    ;UHRZEIT
	. SET $PIECE(POSX1,Y,94)="SYSTEM"
	. IF $PIECE(POSX1,Y,12)'="" IF ($PIECE($GET(^INKUNDELIEF(YM,$PIECE(AUF1,Y,1),$PIECE(POSX1,Y,12),1)),Y,32)=1) || ($PIECE(AUF1,Y,210)="") DO   ;KEINE SPEZIALZUSCHLÄGE ALLES ERLEDIGT;14,12,2004
	. . QUIT:$PIECE(POSX1,Y,4)=$PIECE($GET(^INKUNDELIEF(YM,$PIECE(AUF1,Y,1),$PIECE(POSX1,Y,12),1)),Y,30)  ;DIES IST DER ARTIKEL DER GEBÜHREN;TYB;14,12,2004
	. . SET $PIECE(POSX1,Y,96)="AUTO"                  ;RECHNUNG
	. . SET $PIECE(POSX1,Y,97)=+$HOROLOG               ;DRUCKDATUM
	. . SET $PIECE(POSX1,Y,98)=$PIECE($HOROLOG,",",2)  ;UHRZEIT
	. . SET $PIECE(POSX1,Y,99)="SYSTEM"  ;
	. ; 
	. SET ^WWWSOR(YUSER,"POS",POSX)=POSX1
	. SET YFORM="INAUFP"
	. SET YOK=$$^WWWSPEI("INAUFP",AUF_","_POSX,POSX1,1)
	
	QUIT
	
]]></Routine>
</Export>