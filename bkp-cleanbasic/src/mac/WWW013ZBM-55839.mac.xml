<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="CACHE" ts="2001-01-01 00:00:00">
<Routine name="WWW013ZBM" type="MAC" languagemode="0" timestamp="58440,0"><![CDATA[
WWW013ZBM(YFERTIGUNG,YMIT,YDATUM,YUHR,YZEITAKTION,YBETRIEB,YDATENBEAB,YARBGANG) ;WWW013ZBM;DT;BETICHTIGEN VERTIGUNGSPROTOKOLL;03.02.2002
	;
	;/------------------------------------------------------------------\
	;| Description of Function :
	;|		BETICHTIGEN VERTIGUNGSPROTOKOLL
	;|
	;| Inputs : 
	;|
	;|
	;| ByRef :
	;|
	;|
	;| Returns :
	;|
	;|
	;| History :
	;|
	;| DT	03.02.2002
	;|
	;\------------------------------------------------------------------/
	;
	SET VORG(1)=$GET(YFERTIGUNG)
	SET VORG(2)=$GET(YMIT)
	SET VORG(3)=$GET(YDATUM)
	SET VORG(4)=$GET(YUHR)
	SET VORG(5)=$GET(YZEITAKTION)
	SET VORG(6)=$GET(YBETRIEB)
	IF VORG(6)="" SET VORG(6)=YLOCATION
	SET VORG(7)=$GET(YDATENBEAB)
	IF VORG(7)="" SET VORG(7)=1
	SET VORG(8)=$GET(YARBGANG)  ;ARBEITSGANG (STEMPEL-UNTERNUMMER)  ;FIS,26.03.02
	SET %("VAR","YAUSWAHL")=VORG(1)_","_VORG(2)_","_VORG(3)_","_VORG(4)_","_VORG(5)_","_VORG(6)_","_VORG(7)_","_VORG(8)
	SET %("VAR","YFORM")="WWW013ZBM"
	DO ^WWWFORM
	QUIT
	
SAVE ;SPEICHERN NEUE DATEN
	DO
	. NEW YFORM,YVOR,YDATEI,YKEY,YFELD,AUFTRAG,POSITION,YFERTIGUNG,YUNTERNUMMER,YFELDOLD
	. ;IF VORG(1)="" QUIT  ;OHNE FERTIGUNG MÖGLICH
	. IF VORG(2)="" QUIT
	. IF VORG(3)="" QUIT
	. IF VORG(4)="" QUIT
	. IF VORG(5)="" QUIT
	. IF VORG(6)="" QUIT
	. SET YDATEI="WWW013Z"
	. SET YKEY=VORG(6)_","_VORG(3)_","_VORG(2)_","_VORG(4)_","_VORG(5)
	. SET YFELD=$GET(^WWW013Z(YM,VORG(6),VORG(3),VORG(2),VORG(4),VORG(5),1))
	. SET YFELDOLD=YFELD
	. SET YFERTIGUNG=$PIECE($PIECE($PIECE(VORG(1)," ",1),"-",1),".",1)
	. SET YUNTERNUMMER=$TRANSLATE($PIECE(VORG(1),YFERTIGUNG,2),"-. ")
	. IF VORG(8)'="" SET YUNTERNUMMER=VORG(8)
	. IF YUNTERNUMMER="" SET YUNTERNUMMER=$PIECE(YFELD,Y,10)
	. DO
	. . SET AUFTRAG=""
	. . SET POSITION=""
	. . IF VORG(1)'="" IF $DATA(^INPROSTEMP(YM,VORG(1),1)) SET AUFTRAG=$PIECE(^(1),Y,1),POSITION=$PIECE(^(1),Y,3)
	. . IF VORG(1)'="" IF $DATA(^INPROSTEMP1(YM,VORG(1),1)) SET AUFTRAG=$PIECE(^(1),Y,1),POSITION=$PIECE(^(1),Y,3)
	. . IF AUFTRAG="" SET AUFTRAG=0
	. . IF POSITION="" SET POSITION=0
	. . QUIT
	. SET $PIECE(YFELD,Y,1)=$$^WWWDATE(VORG(3))  ;DATUM ;Date  ;Date Date 
	. SET $PIECE(YFELD,Y,2)=$$^WWWTIME(VORG(4))  ;ZEIT ;time 
	. SET $PIECE(YFELD,Y,3)=$GET(YBED)  ;BED
	. SET $PIECE(YFELD,Y,5)=YFERTIGUNG  ;FERTIGUNG
	. SET $PIECE(YFELD,Y,6)=AUFTRAG  ;AUF ;upon 
	. SET $PIECE(YFELD,Y,7)=POSITION  ;POS
	. SET $PIECE(YFELD,Y,10)=YUNTERNUMMER  ;UNTERNUMMER
	. ;
	. IF VORG(7)=3 DO  QUIT
	. . DO ^WWWKILL(YDATEI,YKEY)
	. . DO PROT
	. . QUIT
	. ;
	. QUIT:VORG(7)=3  ;NUR LÖSCHEN ;only Delete 
	. SET YOK=$$^WWWSPEI(YDATEI,YKEY,YFELD,1)
	. DO PROT
	. ;.IF STARTSTOP=4 DO ^INPROSTART
	. ;.IF STARTSTOP=5 DO ^INPROFERTIG
	. ;.QUIT
	. QUIT
	SET %("VAR","YAUSWAHL")=VORG(1)_","_VORG(2)_","_VORG(3)_","_VORG(4)_","_VORG(5)_","_VORG(6)_","_VORG(7)_","_VORG(8)
	SET %("VAR","YFORM")="WWW013ZBM"
	DO ^WWWFORM
	QUIT
	
PROT   ;PROTOKOLLDATEI 
	NEW YUHR
	IF $PIECE($GET(^WWW120(0,YDATEI,1)),Y,29)'=1 QUIT  ;KEIN PROTOKOLL ;no protocol 
	SET YUHR=$PIECE($HOROLOG,",",2)
	IF VORG(7)'=1 SET ^WWWPRO(YM,YDATEI,+$HOROLOG,YUHR,YBED,$TRANSLATE(YKEY,"/",","),0,1)=YFELDOLD
	IF VORG(7)'=3 SET ^WWWPRO(YM,YDATEI,+$HOROLOG,YUHR,YBED,$TRANSLATE(YKEY,"/",","),1,1)=YFELD
	QUIT
	
SET   ;SETZEN DER VORGABEN ;typeset the 
	NEW YI
	FOR YI=1:1:8 SET VORG(YI)=$PIECE($GET(YAUSWAHL),",",YI)
	IF VORG(7)="" SET VORG(7)=1
	QUIT
	
KILLBUTTON ;ANZEIGEN KILLBUTTON ;display 
	DO
	. WRITE YCR
	. WRITE "<A HREF="_""""
	. ;W "JavaScript:if (confirm('"_$$^WWWTEXT(321)_"')) window.location='"
	. WRITE YAKTION_"EP=WWWMANU1&YEXEC=D|KILL^WWW013ZBM('"_YAUSWAHL_"')"
	. DO ^WWWCGI
	. ;WRITE "';"
	. WRITE """"
	. WRITE ">"
	. WRITE YCR,"<IMG SRC="_""""_YGIF_"del.gif"_""""_" ALIGN=ABSBOTTOM TITLE="_""""_$$^WWWTEXT(41)_""""_" border=0>"
	. WRITE "</A>"
	. QUIT
	QUIT    
	
KILL(YAUSWAHL) ;LÖSCHEN DATEN ;Delete 
	FOR YI=1:1:8 SET VORG(YI)=$PIECE(YAUSWAHL,",",YI)
	DO   ;LÖSCHEN DATEN ;Delete 
	. NEW YFELD,YVOR
	. IF VORG(2)="" QUIT
	. IF VORG(3)="" QUIT
	. IF VORG(4)="" QUIT
	. IF VORG(5)="" QUIT
	. IF VORG(6)="" QUIT
	. SET YDATEI="WWW013Z"
	. SET YKEY=VORG(6)_","_VORG(3)_","_VORG(2)_","_VORG(4)_","_VORG(5)
	. DO ^WWWKILL(YDATEI,YKEY)
	. QUIT
	DO ^WWW013ZBM(VORG(1),VORG(2),VORG(3),"",VORG(5),VORG(6),1,VORG(8))  ;NEUERFASSUNG
	QUIT
]]></Routine>
</Export>